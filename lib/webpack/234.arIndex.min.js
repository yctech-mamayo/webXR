(self.webpackChunkmifly_ar=self.webpackChunkmifly_ar||[]).push([[234],{234:()=>{window.addEventListener("message",(e=>{let o=JSON.parse(e.data);if(console.log("agriculture: _message",e,JSON.parse(e.data)),"cust_proj_scene_done"==o.type){let e=0,o=null,t=null,n=0,i=gsap.timeline(),a=!1;window.argTL=i;let c,s,l,r,d="00開場松果兒",b="松果兒",m=[{n:"",baseName:"00開場松果兒",CDName:"05疏散避難",CDNames:[],audioName:"極端氣候"},{n:"",baseName:"05疏散避難",CDName:"05疏散避難",CDNames:[{n:"05疏散避難",t:"image"},{n:"05-1疏散避難",t:"image"},{n:"06-避難",t:"image"},{n:"06-1避難",t:"image"},{n:"松果兒",t:"model"}],audioName:"RC格樑與錨釘"},{n:"",baseName:"04RC格樑與錨釘",CDName:"04RC格樑與錨釘",CDNames:[{n:"04RC格樑與錨釘",t:"image"},{n:"AG009",t:"model"}],audioName:"疏散避難"},{n:"",baseName:"03落石防護網",CDName:"03落石防護網",CDNames:[{n:"03落石防護網",t:"image"},{n:"AG011",t:"model"}],audioName:"落石防護網"},{n:"",baseName:"02地錨護坡",CDName:"02地錨護坡",CDNames:[{n:"02地錨護坡",t:"image"},{n:"AG006-1",t:"model"}],audioName:"地錨護坡"},{n:"",baseName:"01防砂壩 ",CDName:"01防砂壩",CDNames:[{n:"01防砂壩",t:"image"},{n:"AG013",t:"model"}],audioName:"防砂壩"}],j=[];window.stable_objs=j;let u=[];if(window.clickableObj=u,window&&window.makarUserData&&makarUserData.scenesData&&Array.isArray(makarUserData.scenesData.scenes)){makarUserData.scenesData.scenes[0].objs.forEach((e=>{e.generalAttr&&e.generalAttr.obj_name&&e.generalAttr.obj_id&&(e.generalAttr.obj_name==d&&(c=e.generalAttr.obj_id,s=document.getElementById(c)),e.generalAttr.obj_name==b&&"model"==e.main_type&&(l=e.generalAttr.obj_id,r=document.getElementById(l)))})),m.forEach((e=>{let o,t,n,i,a,c,s,l=[];makarUserData.scenesData.scenes[0].objs.forEach((r=>{if(r.generalAttr&&r.generalAttr.obj_name&&r.generalAttr.obj_id){if((r.generalAttr.obj_name==e.baseName&&"model"==r.main_type||"00開場松果兒"==e.baseName&&r.generalAttr.obj_name==e.baseName&&"image"==r.main_type)&&(o=r.generalAttr.obj_id,i=document.getElementById(o),s=e.baseName),r.generalAttr.obj_name==e.CDName&&"image"==r.main_type&&(t=r.generalAttr.obj_id,a=document.getElementById(t)),e.CDNames.find((e=>e.n==r.generalAttr.obj_name&&e.t==r.main_type))){let e=document.getElementById(r.generalAttr.obj_id);e&&e.object3D&&l.push(e)}r.generalAttr.obj_name==e.audioName&&"audio"==r.main_type&&(n=r.generalAttr.obj_id,c=document.getElementById(n))}})),i&&i.object3D&&a&&a.object3D&&c&&c.object3D&&(i.object3D.behav=[],j.push({type:"stableObject",baseName:s,clickObj:i,clickObj_id:o,showObj:a,showObjs:l,showObj_id:t,audio:c,audio_id:n}),u.push(i.object3D))}));let e=[{c:"聲音_開始",s:[{n:"none",t:"none"}],a:"開始",animationObj:""},{c:"落石",s:[{n:"落石介紹",t:"image"},{n:"rain落石",t:"model"}],a:"落石",animationObj:"落石01"},{c:"土石流",s:[{n:"土石流介紹",t:"image"},{n:"rain_土石流",t:"model"}],a:"土石流",animationObj:"土石流04"},{c:"崩塌",s:[{n:"崩塌介紹",t:"image"},{n:"rain崩塌",t:"model"}],a:"崩塌",animationObj:"崩塌01"},{c:"地滑",s:[{n:"地滑介紹",t:"image"},{n:"rain_地滑",t:"model"}],a:"地滑",animationObj:"地滑01"},{c:"大規模崩塌",s:[{n:"大規模崩塌介紹",t:"image"},{n:"rain_大規模",t:"model"}],a:"大規模崩塌",animationObj:"大規模崩塌01"}],o=[];window.originLogicObjs=o,e.forEach(((e,t)=>{let n,i,a,c,s,l;makarUserData.scenesData.scenes[0].objs.forEach((o=>{if(o.generalAttr&&o.generalAttr.obj_name&&o.generalAttr.obj_id){if("image"==o.main_type&&o.generalAttr.obj_name==e.c){let e=document.getElementById(o.generalAttr.obj_id);e&&e.object3D&&(n=e,i=o.generalAttr.obj_id)}if("audio"==o.main_type&&o.generalAttr.obj_name==e.a){let e=document.getElementById(o.generalAttr.obj_id);e&&e.object3D&&(s=e)}if("model"==o.main_type&&o.generalAttr.obj_name==e.animationObj){let e=document.getElementById(o.generalAttr.obj_id);e&&e.object3D&&(l=e)}e.s.forEach((e=>{if(o.main_type==e.t&&o.generalAttr.obj_name==e.n)if("model"==e.t){let e=document.getElementById(o.generalAttr.obj_id);e&&e.object3D&&(a=e)}else if("image"==e.t){let e=document.getElementById(o.generalAttr.obj_id);e&&e.object3D&&(c=e)}}))}})),n&&s&&(o.push({clickObj:n,showObj_model:a,showObj_image:c,audioObj:s,animationObj:l}),j.push({type:"logicObject",action:"showAndPlayAudio",clickObj:n,clickObj_id:i,audioObj:s,showObj_model:a,showObj_image:c}),u.push(n.object3D))})),makarUserData.scenesData.scenes[0].objs.forEach((e=>{if(e.generalAttr&&e.generalAttr.obj_name&&e.generalAttr.obj_id&&"06-1避難"==e.generalAttr.obj_name&&"image"==e.main_type){let o=document.getElementById(e.generalAttr.obj_id);o.object3D&&(o.object3D.behav=[],u.push(o.object3D),o.object3D&&o.object3D.children[0]&&o.object3D.children[0].isMesh&&(o.object3D.children[0].renderOrder=1),j.push({type:"controlObject",action:"playRunAnimation",clickObj:o,clickObj_id:e.generalAttr.obj_id}))}}))}!function(){let c=document.getElementById("arfScene");if(window.arController&&c&&c.renderer&&c.renderer.domElement){let O=new THREE.Raycaster,p=c.renderer.domElement;function d(e){}function b(e){}function m(a){let c=arController.getMouse(a);O.setFromCamera(c,arController.camera);let d=O.intersectObjects(u,!0);if(0!=d.length){let a=arController.getMakarObject(d[0].object);if(a){let c=a.el.id;console.log("_cust_click_",a);let d=function(e){let o=!1;return j.forEach((t=>{t.clickObj_id==e&&(o=t)})),o}(c);d&&"stableObject"==d.type?(console.log("endEvent: intersects 1 =",d),function(n){console.log("_checkAgStatusAndActive_ =",e),g(),originLogicObjs&&originLogicObjs.forEach((e=>{e.audioObj&&e.audioObj.components.sound&&e.audioObj.components.sound.stopSound(),e.showObj_model&&e.showObj_model.object3D&&e.showObj_model.setAttribute("visible",!1),e.showObj_image&&e.showObj_image.object3D&&e.showObj_image.setAttribute("visible",!1),e.animationObj&&e.animationObj.object3D&&e.animationObj.object3D.children&&e.animationObj.object3D.children[0]&&e.animationObj.object3D.children[0].animationSlices&&e.animationObj.object3D.children[0].animationSlices.forEach((o=>{if(o.name&&"stop"==o.name.toLowerCase()&&o.uid){let t={obj_id:e.animationObj.id,behav_type:"Animation",uid:o.uid,loop:!0,reset:!1};arController.triggerEvent(t)}}))})),0==e&&null==o?(e=1,o=n,o.clickObj&&o.clickObj.object3D&&o.showObj&&o.showObj.object3D&&o.audio&&o.audio&&o.audio.components.sound&&o.audio.components&&o.audio.components.sound&&s&&s.object3D&&(o.clickObj.object3D==s.object3D||(s.object3D.visible=!1,o.clickObj.object3D.visible=!1),o.showObjs.forEach((e=>{e&&e.object3D&&(e.object3D.visible=!0)})),D(o.audio),_(o.audio).then((t=>{console.log("_checkAgStatusAndActive_, _setAudioEnd, then ",o),e=0,s.object3D.visible=!0,o.clickObj.object3D.visible=!0,o.showObjs.forEach((e=>{e&&e.object3D&&(e.object3D.visible=!1)})),o=null})))):1==e&&null==t?(t=n,o.clickObj&&o.clickObj.object3D&&o.showObj&&o.showObj.object3D&&o.audio&&o.audio&&o.audio.components.sound&&o.audio.components&&o.audio.components.sound&&s&&s.object3D&&(o.clickObj.object3D==s.object3D?s.object3D.visible=!1:o.clickObj.object3D.visible=!0,o.showObjs.forEach((e=>{e&&e.object3D&&(e.object3D.visible=!1)})),h(o.audio)),t.clickObj&&t.clickObj.object3D&&t.showObj&&t.showObj.object3D&&t.audio&&t.audio&&t.audio.components.sound&&t.audio.components&&t.audio.components.sound&&s&&s.object3D&&(o=t,t=null,o.clickObj.object3D.visible=!1,o.showObj.object3D.visible=!0,o.showObjs.forEach((e=>{e&&e.object3D&&(e.object3D.visible=!0)})),D(o.audio),_(o.audio).then((t=>{console.log("_checkAgStatusAndActive_, _setAudioEnd, then ",o),e=0,s.object3D.visible=!0,o.clickObj.object3D.visible=!0,o.showObjs.forEach((e=>{e&&e.object3D&&(e.object3D.visible=!1)})),o=null})))):console.log("__checkAgStatusAndActive__: weired ",e,n,o)}(d),d.baseName):d&&"controlObject"==d.type?(console.log("endEvent: intersects 2 =",d),new Promise(((e,o)=>{r&&l&&(console.log("_checkAgStatusAndControlAnimation_: _animationStatus",n),0==n&&(n=1,r.object3D.visible=!0,i.play()))}))):d&&"logicObject"==d.type?(console.log("endEvent: intersects 3 =",d),g(),0==e&&null==o?s.object3D.visible=!1:1==e&&null==t&&o.clickObj&&o.clickObj.object3D&&o.showObj&&o.showObj.object3D&&o.audio&&o.audio&&o.audio.components.sound&&o.audio.components&&o.audio.components.sound&&s&&s.object3D&&(o.clickObj.object3D==s.object3D?s.object3D.visible=!1:o.clickObj.object3D.visible=!0,Array.isArray(o.showObjs)&&o.showObjs.forEach((e=>{e&&e.object3D&&(e.object3D.visible=!1)})),h(o.audio),e=0,o=null)):console.log("endEvent: intersects 4 =",d)}}}function g(){if(r&&r.object3D){let e=r.object3D;e.originTransform&&e.originTransform.position&&(e.position.copy(e.originTransform.position),e&&e.children&&e.children[0]&&e.children[0].animationSlices&&e.children[0].animationSlices.forEach((o=>{if("idle"==o.name&&"idle"==o.animationName){let t={obj_id:e.el.id,behav_type:"Animation",uid:o.uid,loop:!0,reset:!1};arController.triggerEvent(t)}}))),i.pause(),i.seek(0),n=0}}function D(e){e.setAttribute("sound","loop:false"),e.components.sound.playSound()}function _(e){return new Promise(((o,t)=>{let n=function(t){e.components.sound.stopSound(),e.soundEndedEvent=null,e.removeEventListener("sound-ended",n),o()};e.soundEndedEvent=n,e.addEventListener("sound-ended",n)}))}function h(e){e.components.sound.stopSound(),null!=e.soundEndedEvent&&e.removeEventListener("sound-ended",e.soundEndedEvent)}p.addEventListener("touchend",m,!1),p.addEventListener("mouseup",m,!1),p.addEventListener("touchmove",d,!1),p.addEventListener("mousemove",d,!1),p.addEventListener("touchstart",b,!1),p.addEventListener("mousedown",b,!1),r&&function(e){if(0!=a)return void console.log("_setObjMoveTimeLine_: already set");a=!0;let o=e.object3D;i.pause(),i.to(o.position,{duration:.4,ease:"none",z:23}),i.to(o.position,{duration:.4,ease:"none",z:15}),i.to(o,{duration:.01,onComplete:function(){o&&o.children&&o.children[0]&&o.children[0].animationSlices&&o.children[0].animationSlices.forEach((e=>{if("jump"==e.name&&"jump"==e.animationName){let t={obj_id:o.el.id,behav_type:"Animation",uid:e.uid,loop:!0,reset:!1};arController.triggerEvent(t)}}))}}),i.to(o.position,{duration:4,ease:"none",x:210}),i.to(o.position,{duration:1,ease:"none",y:25}),i.to(o,{duration:.01,onComplete:function(){o&&o.children&&o.children[0]&&o.children[0].animationSlices&&o.children[0].animationSlices.forEach((e=>{if("idle"==e.name&&"idle"==e.animationName){let t={obj_id:o.el.id,behav_type:"Animation",uid:e.uid,loop:!0,reset:!1};arController.triggerEvent(t)}}))}}),i.to(o.position,{duration:.4,ease:"none",z:23}),i.to(o.position,{duration:.4,ease:"none",z:15}),i.to(o,{duration:.01,onComplete:function(){n=0}})}(r)}}()}}))}}]);