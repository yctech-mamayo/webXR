(()=>{"use strict";var e,r,t,n,o,s,a={325:(e,r,t)=>{function n(e){if(!e)return console.warn(" _projDataBasicCheck : _projData not exist "),-1;let r=e.editor_ver;if(!r||"string"!=typeof r)return console.warn(" _projDataBasicCheck_: editor_ver error ",r),-1;let t=r.split(".");return 3!=t.length&&4!=t.length?(console.warn(" _projDataBasicCheck_: vArr error ",t),-1):void 0}function o(e){if(!e)return console.warn(" _sceneBasicCheck_ : _sceneData not exist "),-1;let r=e.editor_ver;if(!r||"string"!=typeof r)return console.warn(" _sceneBasicCheck_: editor_ver error ",r),-1;let t=r.split(".");return 3!=t.length&&4!=t.length?(console.warn(" _sceneBasicCheck_: vArr error ",t),-1):void 0}function s(e){let r=e.split("."),t={},n=!0;return r.forEach((e=>{Number.isInteger(Number(e))||(n=!1)})),n&&(t.v0=Number(r[0]),t.v1=Number(r[1]),t.v2=Number(r[2]),3==r.length||4==r.length&&(t.v3=Number(r[3]))),t}t.d(r,{F:()=>a});const a=new class{getOneProj(e){let r={};if(e){if(n(e)<0)return{};r=e}return r}getSceneLogicXML(e,r){let t="";if(e){if(o(e)<0)return t;let n=s(e.editor_ver),a=n.v0,i=n.v1;if(n.v2,n.v3,3==a&&i>=5){let n=e.scenes;n[r]&&(t=n[r].xml_url)}}return t}getProjDataEditorVer(e){return n(e)<0?{}:s(e.editor_ver)}getScenes(e){if(o(e)<0)return[];let r=s(e.editor_ver),t=r.v0,n=r.v1,a=(r.v2,r.v3,[]);return 3==t&&n>=5?e&&Array.isArray(e.scenes)&&(a=e.scenes,console.log(" _getScenes_: success ",r,a)):console.warn(" _getScenes_: vo error ",r),a}checkSceneIncludeAR(e){if(o(e)<0)return!1;let r=s(e.editor_ver),t=r.v0,n=r.v1,a=(r.v2,r.v3,!1);if(3==t&&n>=5&&e&&Array.isArray(e.scenes)){let r=e.scenes;for(let e=0;e<r.length;e++){let t=r[e];t&&t.info&&"ar"==t.info.type&&(a=!0)}}return a}checkSceneIncludeVR(e){if(o(e)<0)return!1;let r=s(e.editor_ver),t=r.v0,n=r.v1,a=(r.v2,r.v3,!1);if(3==t&&n>=5&&e&&Array.isArray(e.scenes)){let r=e.scenes;for(let e=0;e<r.length;e++){let t=r[e];t&&t.info&&"vr"==t.info.type&&(a=!0)}}return a}checkSceneIncludeXR(e){if(o(e)<0)return!1;let r=s(e.editor_ver),t=r.v0,n=r.v1,a=(r.v2,r.v3,!1);if(3==t&&n>=5&&e&&Array.isArray(e.scenes)){let r=e.scenes;for(let e=0;e<r.length;e++){let t=r[e];t&&t.info&&"ar_slam"==t.info.type&&(a=!0)}}return a}getSceneType(e,r){if(o(e)<0)return"";let t=s(e.editor_ver),n=t.v0,a=t.v1,i=(t.v2,t.v3,"");if(3==n&&a>=5){if(e&&Array.isArray(e.scenes)){let t=e.scenes;t[r]&&t[r].info&&t[r].info.type&&(i=t[r].info.type),console.log(" _getSceneType_ : success ",i)}}else console.warn(" _getSceneType_ : error ",r,e);return i}getSceneObjs(e,r){if(o(e)<0)return[];let t=s(e.editor_ver),n=t.v0,a=t.v1,i=(t.v2,t.v3,[]);if(3==n&&a>=5){if(e&&Array.isArray(e.scenes)){let n=e.scenes;n[r]&&Array.isArray(n[r].objs)&&(i=n[r].objs),console.log(" _getSceneObjs_ : success ",t,n)}}else console.warn(" _getSceneObjs_ : vo error ",t);return i}getSceneBehav(e,r){if(o(e)<0)return[];let t=s(e.editor_ver),n=t.v0,a=t.v1,i=(t.v2,t.v3,[]);if(3==n&&a>=5){if(e&&Array.isArray(e.scenes)){let t=e.scenes;t[r]&&Array.isArray(t[r].behav)&&(i=t[r].behav),console.log(" _getSceneBehav_ : success ",i)}}else console.warn(" _getSceneBehav_ : error ",r,e);return i}setBehavIntoObj(e,r,t){if(o(e)<0)return[];let n=s(e.editor_ver),a=n.v0,i=n.v1,l=(n.v2,n.v3,[]);if(3==a&&i>=5){if(e&&Array.isArray(e.scenes)){let n=e.scenes;n[r]&&Array.isArray(n[r].behav)&&(l=n[r].behav),l.forEach((e=>{e.trigger_obj_id&&e.trigger_obj_id==t.generalAttr.obj_id&&(t.behav&&Array.isArray(t.behav)&&t.behav.length>0?t.behav.push(e):t.behav=[e])}))}}else console.warn(" _setBehavIntoObj_ : version error ",r,e)}getObjTransform(e,r){if(o(e)<0)return{};let t=s(e.editor_ver),n=t.v0,a=t.v1,i=(t.v2,t.v3,{position:null,rotation:null,scale:null,quaternion:null});if(3==n&&a>=5){if(r.generalAttr&&"2d"==r.generalAttr.obj_type)if(r.transformAttr&&r.transformAttr.rect_transform&&r.transformAttr.rect_transform[0]){i.position=(new THREE.Vector3).fromArray(r.transformAttr.rect_transform[0].position.split(",").map((e=>Number(e))));let e=r.transformAttr.rect_transform[0].rotation.split(",").map((e=>Number(e)));i.quaternion=new THREE.Quaternion(e[0],e[1],e[2],e[3]);let t=(new THREE.Euler).setFromQuaternion(i.quaternion,"YXZ");i.rotation=new THREE.Vector3(t.x,1*t.y,-1*t.z),i.scale=(new THREE.Vector3).fromArray(r.transformAttr.rect_transform[0].scale.split(",").map((e=>Number(e))))}else console.warn(" _getObjTransform_ : v3.5.0 type 2d error ",r);else if(r.generalAttr&&"3d"==r.generalAttr.obj_type)if(r.transformAttr&&r.transformAttr.transform){i.position=(new THREE.Vector3).fromArray(r.transformAttr.transform[0].split(",").map((e=>Number(e))));let e=r.transformAttr.transform[1].split(",").map((e=>Number(e)));i.quaternion=new THREE.Quaternion(e[0],e[1],e[2],e[3]);let t=(new THREE.Euler).setFromQuaternion(i.quaternion,"YXZ");i.rotation=new THREE.Vector3(t.x,1*t.y,1*t.z),i.scale=(new THREE.Vector3).fromArray(r.transformAttr.transform[2].split(",").map((function(e){return Number(e)})))}else console.warn(" _getObjTransform_ : v3.5.0.0 type 3d error ",r)}else console.warn(" _getObjTransform_ :  error ",r);return i}getObjObjType(e,r){if(o(e)<0)return"";let t=s(e.editor_ver),n=t.v0,a=t.v1,i=(t.v2,t.v3,"");return 3==n&&a>=5?r.generalAttr&&r.generalAttr.obj_type&&(i=r.generalAttr.obj_type):console.warn(" _getObjObjType_ :  error ",r),i}getObj2DTransform(e,r){if(4==Object.keys(e).length){let n,o=Number(e.v0),s=Number(e.v1);return Number(e.v2),o>3||3==o&&s>=5?(console.log("呼叫 getObj2DTransform","表示這裡是v3.5.1.1"),n=t()):n=t(),n.rectP&&n.rectSizeDelta&&n.rectScale?n:(console.warn(" _getObj2DInfo_ :  error ",r),!1)}{let e=t();return!!(e.rectP&&e.rectSizeDelta&&e.rectScale)&&e}function t(){let e,t,n,o,s={};if(r.transformAttr.rect_transform&&Array.isArray(r.transformAttr.rect_transform)&&r.transformAttr.rect_transform.length>0){Number.isFinite(self.selectedResolutionIndex)||(console.log(" _getObj2DInfo350: error, missing _selectedResolutionIndex"),self.selectedResolutionIndex=0);let a=r.transformAttr.rect_transform[self.selectedResolutionIndex];if(a.position&&a.size_delta&&a.rotation&&a.scale){e=a.position.split(",").map((function(e){return Number(e)})),t=a.size_delta.split(",").map((function(e){return Number(e)})),n=a.scale.split(",").map((function(e){return Number(e)})),o=a.rotation.split(",").map((function(e){return Number(e)}));let r=new THREE.Quaternion(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])),i=(new THREE.Euler).setFromQuaternion(r,"YXZ"),l=new THREE.Vector3(i.x,i.y,i.z);l.z=-1*l.z,s={rectP:e,rectSizeDelta:t,rectScale:n,rectR:l}}}return s}}}},19:(e,r,t)=>{t.d(r,{A:()=>n});const n=new class{constructor(){this.url="https://test1.makar.app/Makar/","object"==typeof parent&&parent.serverUrl&&(this.url=parent.serverUrl),this.webVersion="3.5.0.0"}sendPost(e,r){let t=this;return new Promise((function(n,o){let s={ver:t.webVersion,cid:5,data:r};fetch(e,{body:JSON.stringify(s),headers:{"content-type":"application/json"},method:"POST",cache:"no-cache",credentials:"same-origin",mode:"cors"}).then((e=>e.json())).then((function(e){setTimeout((function(){n(e)}),1)}))}))}async getTest(e,r=[]){let t=this.url+"get_test",n={user_id:e,wanted_info_keys:r},o=this.sendPost(t,n);return await o}async getProjectInfoList(e,r){if(!Array.isArray(e))return console.warn("_getProjectInfoList_: error",e),!1;let t=this.url+"WebXR/GetProjects",n={login_user_id:r,project_ids:e},o=this.sendPost(t,n);return await o}async getProjectSceneList(e){if(!Array.isArray(e))return console.warn("_getProjectSceneList_: error",e),!1;let r=this.url+"WebXR/GetProjectSceneList",t={project_ids:e},n=this.sendPost(r,t);return await n}async getTargetList(e){if(!Array.isArray(e))return console.warn("_getTargetList_: error",e),!1;let r=this.url+"WebXR/GetTargetList",t={target_ids:e},n=this.sendPost(r,t);return await n}async getUserInfo(e){if(!e||"string"!=typeof e)return console.warn("_getUserInfo_: error",e),!1;let r=this.url+"WebXR/GetUserInfo",t={user_id:e},n=this.sendPost(r,t);return await n}async getUserOnlineResources(e){if(!e||"string"!=typeof e)return console.warn("_getUserOnlineResources_: error",e),!1;let r=this.url+"WebXR/GetUserOnlineResources",t={user_id:e,language:""},n=this.sendPost(r,t);return await n}async getUserPublishedProjects(e,r){if(!e||"string"!=typeof e)return console.warn("_getUserPublishedProjects_: error",e),!1;let t=[];Array.isArray(r)&&(t=r);let n=this.url+"WebXR/GetUserPublishedProjects",o={user_id:e,proj_type:t},s=this.sendPost(n,o);return await s}async getUserResources(e){if(!e||"string"!=typeof e)return console.warn("_getUserResources_: error",e),!1;let r=this.url+"WebXR/GetUserResources",t={user_id:e},n=this.sendPost(r,t);return await n}async getUserTargetList(e){if(!e||"string"!=typeof e)return console.warn("_getUserTargetList_: error",e),!1;let r=this.url+"WebXR/GetUserTargetList",t={user_id:e},n=this.sendPost(r,t);return await n}async GetUserMaterials(e){if(!e||"string"!=typeof e)return console.warn("_getUserMaterials_: error",e),!1;let r=this.url+"Editor/GetUserMaterials",t={user_id:e},n=this.sendPost(r,t);return await n}async getRecordModule(e,r){let t=this.url+"get_record_module",n={playing_user_id:e,proj_id:r},o=this.sendPost(t,n);return await o}async updateRecordModule(e){let r=this.url+"update_record_module",t=this.sendPost(r,e);return await t}async pointCardLog(e){let r=this.url+"point_card_log";return this.sendPost(r,e)}async quizLog(e){let r=this.url+"quiz_log";return this.sendPost(r,e)}}}},i={};function l(e){var r=i[e];if(void 0!==r)return r.exports;var t=i[e]={exports:{}};return a[e](t,t.exports,l),t.exports}l.m=a,r=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var o=Object.create(null);l.r(o);var s={};e=e||[null,r({}),r([]),r(r)];for(var a=2&n&&t;"object"==typeof a&&!~e.indexOf(a);a=r(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>t[e]));return s.default=()=>t,l.d(o,s),o},l.d=(e,r)=>{for(var t in r)l.o(r,t)&&!l.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((r,t)=>(l.f[t](e,r),r)),[])),l.u=e=>e+".arIndex.min.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t={},n="mifly-ar:",l.l=(e,r,o,s)=>{if(t[e])t[e].push(r);else{var a,i;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var f=c[u];if(f.getAttribute("src")==e||f.getAttribute("data-webpack")==n+o){a=f;break}}a||(i=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,l.nc&&a.setAttribute("nonce",l.nc),a.setAttribute("data-webpack",n+o),a.src=e),t[e]=[r];var d=(r,n)=>{a.onerror=a.onload=null,clearTimeout(p);var o=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(n))),r)return r(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),i&&document.head.appendChild(a)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var r=l.g.document;if(!e&&r&&(r.currentScript&&(e=r.currentScript.src),!e)){var t=r.getElementsByTagName("script");if(t.length)for(var n=t.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=t[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e})(),(()=>{var e={792:0};l.f.j=(r,t)=>{var n=l.o(e,r)?e[r]:void 0;if(0!==n)if(n)t.push(n[2]);else{var o=new Promise(((t,o)=>n=e[r]=[t,o]));t.push(n[2]=o);var s=l.p+l.u(r),a=new Error;l.l(s,(t=>{if(l.o(e,r)&&(0!==(n=e[r])&&(e[r]=void 0),n)){var o=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;a.message="Loading chunk "+r+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,n[1](a)}}),"chunk-"+r,r)}};var r=(r,t)=>{var n,o,[s,a,i]=t,c=0;if(s.some((r=>0!==e[r]))){for(n in a)l.o(a,n)&&(l.m[n]=a[n]);i&&i(l)}for(r&&r(t);c<s.length;c++)o=s[c],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0},t=self.webpackChunkmifly_ar=self.webpackChunkmifly_ar||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})(),o=l(19),s=l(325),window.startARWithVersionControl=()=>{let e=[];if(parent&&parent.selectedProject&&parent.selectedProject.proj_id){e.push(parent.selectedProject.proj_id);const r=localStorage.getItem("MakarUserID");o.A.getProjectInfoList(e,r).then((async function(e){if(console.log(" _pScenes_: ",e),e&&e.data&&Array.isArray(e.data.projects)&&1==e.data.projects.length){let r=e.data.projects[0],t=s.F.getProjDataEditorVer(r);if(3==t.v0&&t.v1>=5&&Number.isInteger(Number(t.v3)))console.log(" _startARWithVersionControl_ : ver 3.5.0.0 and above ",r,t),await l.e(605).then(l.bind(l,605)),parent.location.pathname.includes("/15b8c2fc-4222-4922-aadd-13ae441f9052/f22d9da4-a359-45a1-b677-1aba895a8b84")&&await l.e(977).then(l.t.bind(l,977,23)),(parent.location.pathname.includes("/a8b05d24-e6ea-4d4f-a8f0-f6a3f41c90b5/62afc6bc-f3e1-40b3-adf1-cb8a596b8e6d")||parent.location.pathname.includes("/a8b05d24-e6ea-4d4f-a8f0-f6a3f41c90b5/5f0e2e5a-9a6b-419b-9ef5-cf98d545b7b1")||parent.location.pathname.includes("/a8b05d24-e6ea-4d4f-a8f0-f6a3f41c90b5/541820ff-3a92-470f-96f2-189dc0ca0fa2"))&&await l.e(234).then(l.t.bind(l,234,23)),window.startARProcess&&startARProcess(r);else if(3==t.v0&&t.v1<5){console.log(" _startARWithVersionControl_ : ver below 3.5.0.0, use 3.4.0 ",r,t);let e=document.createElement("script");e.setAttribute("src","../lib/webpack/makarThree.min.js"),document.body.appendChild(e);let n=setInterval((function(){window.ARController&&window.startARProcess?(clearInterval(n),console.log(" _startARWithVersionControl_ with AR: ARController load done"),window.startARProcess()):console.log(" _startARWithVersionControl_ with AR: ARController load not done")}),500)}}}))}}})();