(self.webpackChunkmifly_ar=self.webpackChunkmifly_ar||[]).push([[977],{977:()=>{window.addEventListener("message",(e=>{let o=JSON.parse(e.data);if(console.log("feibxr: _message",e,JSON.parse(e.data)),"cust_proj_scene_done"==o.type){let e,o,t=0,n=0,a=null,r=null,l=gsap.timeline(),s=null,i=null,d="base_CD",c=[{n:"原始",baseName:"wood_shelf_1",CDName:"base_CD_1",audioName:"1_origin"},{n:"藍調",baseName:"wood_shelf_2",CDName:"base_CD_2",audioName:"2_blue"},{n:"鄉村",baseName:"wood_shelf_3",CDName:"base_CD_3",audioName:"3_country"},{n:"爵士",baseName:"wood_shelf_4",CDName:"base_CD_4",audioName:"4_jazz"},{n:"搖滾",baseName:"wood_shelf_5",CDName:"base_CD_5",audioName:"5_rock"},{n:"古典",baseName:"wood_shelf_6",CDName:"base_CD_6",audioName:"6_Classical"}],b=[];window.stable_objs=b;let u=[];window&&window.makarUserData&&makarUserData.scenesData&&Array.isArray(makarUserData.scenesData.scenes)&&(makarUserData.scenesData.scenes[0].objs.forEach((t=>{t.generalAttr&&t.generalAttr.obj_name&&t.generalAttr.obj_id&&t.generalAttr.obj_name==d&&(e=t.generalAttr.obj_id,o=document.getElementById(e))})),c.forEach((e=>{let o,t,n,a,r,l;makarUserData.scenesData.scenes[0].objs.forEach((s=>{s.generalAttr&&s.generalAttr.obj_name&&s.generalAttr.obj_id&&(s.generalAttr.obj_name==e.baseName&&(o=s.generalAttr.obj_id,a=document.getElementById(o)),s.generalAttr.obj_name==e.CDName&&(t=s.generalAttr.obj_id,r=document.getElementById(t)),s.generalAttr.obj_name==e.audioName&&(n=s.generalAttr.obj_id,l=document.getElementById(n)))})),a&&a.object3D&&r&&r.object3D&&l&&l.object3D&&(r.object3D.behav=[],b.push({type:"stableObject",base:a,base_id:o,obj:r,obj_id:t,audio:l,audio_id:n}),u.push(r.object3D))})),makarUserData.scenesData.scenes[0].objs.forEach((e=>{e.generalAttr&&e.generalAttr.obj_name&&e.generalAttr.obj_id&&("CDplayer_stop"==e.generalAttr.obj_name?(i=document.getElementById(e.generalAttr.obj_id),u.push(i.object3D),b.push({type:"controlObject",action:"pause",obj:i,obj_id:e.generalAttr.obj_id})):"CDplayer_play"==e.generalAttr.obj_name&&(s=document.getElementById(e.generalAttr.obj_id),u.push(s.object3D),b.push({type:"controlObject",action:"play",obj:s,obj_id:e.generalAttr.obj_id})))}))),function(){let e=document.getElementById("arfScene");if(window.arController&&e&&e.renderer&&e.renderer.domElement){let _=new THREE.Raycaster,j=e.renderer.domElement;function s(e){let o=arController.getMouse(e);_.setFromCamera(o,arController.camera);let l=_.intersectObjects(u,!0);if(0!=l.length){let e=arController.getMakarObject(l[0].object);if(e){let o=function(e){let o=!1;return b.forEach((t=>{t.obj_id==e&&(o=t)})),o}(e.el.id);o&&"stableObject"==o.type?(console.log("endEvent: intersects 1 =",o),function(e){console.log("_checkFeibxrStatusAndActive_ =",t),0==t&&null==r?(t=1,i(e).then((()=>{t=2,r=e}))):1==t||(2==t&&r&&r.obj&&e.obj_id==r.obj.id?(t=1,n=0,r.audio.components.sound.stopSound(),d(e).then((()=>{t=0,r=null}))):2==t&&e.obj_id!=r.obj.id?(t=1,n=0,r.audio.components.sound.stopSound(),d(r).then((()=>{i(e).then((()=>{t=2,r=e}))}))):console.log("_checkFeibxrStatusAndActive_: weired ",t,e,r))}(o)):o&&"controlObject"==o.type&&(console.log("endEvent: intersects 2 =",o),function(e){0==t&&null==r||1==t||(2==t&&r&&"stableObject"==r.type&&r.obj&&r.audio?"play"==e.action?0==n&&(n=1,a=r.audio,r.audio.components.sound.playSound()):"pause"==e.action&&(0==n||1==n&&(n=0,r.audio.components.sound.pauseSound())):console.log("_checkFeibxrStatueAndControlAudio_: weired ",t,r))}(o))}}}function i(e){return console.log("_moveObjToMain_: ",e),new Promise(((t,n)=>{if(e&&e.obj&&e.obj.object3D&&o&&o.id&&o.object3D){let n=e.obj.object3D,a=o.object3D,r=a.getWorldPosition(new THREE.Vector3),s=a.getWorldQuaternion(new THREE.Quaternion),i=a.getWorldScale(new THREE.Vector3),d=n.parent.worldToLocal(r.clone()),c=i.divide(n.parent.getWorldScale(new THREE.Vector3)),b=n.parent.getWorldQuaternion(new THREE.Quaternion).clone().inverse().multiply(s.clone()),u=(new THREE.Euler).setFromQuaternion(b);l.to(n.position,{duration:.5,z:n.position.z+3});let m=1;l.to(n.position,{duration:m,delay:0,x:d.x,y:d.y}),l.to(n.scale,{duration:m,delay:0,x:c.x,y:c.y,z:c.z},"-="+m),l.to(n.rotation,{duration:m,delay:0,x:u.x,y:u.y,z:u.z},"-="+m),l.to(n.position,{duration:.5,z:n.position.z,onComplete:function(){t()}})}else t()}))}function d(e){return console.log("_moveObjBack_: ",e),new Promise(((o,t)=>{if(e&&e.obj&&e.obj.object3D){let t=e.obj.object3D,n=t.originTransform.position,a=t.originTransform.scale;l.to(t.position,{duration:.5,z:t.position.z+3});let r=1;l.to(t.position,{duration:r,delay:0,x:n.x,y:n.y}),l.to(t.scale,{duration:r,delay:0,x:a.x,y:a.y,z:a.z},"-="+r),l.to(t.position,{duration:.5,z:n.z,onComplete:function(){o()}})}else o()}))}function c(e){}function m(e){}j.addEventListener("touchend",s,!1),j.addEventListener("mouseup",s,!1),j.addEventListener("touchmove",c,!1),j.addEventListener("mousemove",c,!1),j.addEventListener("touchstart",m,!1),j.addEventListener("mousedown",m,!1)}}()}}))}}]);