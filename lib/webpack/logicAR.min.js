window.Logic||(window.Logic=class{constructor(){this.xmlDoc=null,this.variableList=[],this.timelineDict={},this.intervalList=[],this.onclickObjectDict={},this.logicSystemState=-1}loadXMLtoDoc(e){let t=this;return new Promise((function(l){let r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(e){if(4===r.readyState)if(200===r.status){let e=(new DOMParser).parseFromString(r.responseText,"text/xml");t.xmlDoc=e,console.log("logicSystem.js: _loadXMLtoDoc: xmlDoc = ",t.xmlDoc),t.logicSystemState=0,l(t)}else console.error(r.statusText)},r.onerror=function(e){console.error(r.statusText)},r.send(null)}))}parseXML(){let e=this;if(e.logicSystemState=1,console.log("logicSystem.js: _parseXML",this),this.xmlDoc&&"xml"==this.xmlDoc.children[0].tagName){let t=this.xmlDoc.children[0];if("variables"==t.children[0].tagName){let e=t.children[0];e.children.length>0&&this.registLogicVariables(e.children)}let l=[];if(t.children.length>1)for(let e=1;e<t.children.length;e++)console.log("Parse",t.children[e]),l[e]=this.parseBlock(t.children[e]);e.logicSystemState=2,console.log("logicSystem.js: _parseXML: _blockRetList=",l)}}stopLogic=function(){let e=this,t=Object.values(e.timelineDict);t.forEach((e=>{e.pause()})),t.forEach((e=>{e.kill()})),e.timelineDict={},Object.values(e.onclickObjectDict).forEach((e=>{e.forEach((e=>{e.length=0}))})),e.onclickObjectDict={},e.intervalList.forEach((e=>{clearInterval(e)})),e.intervalList.length=0,e.variableList.length=0,e.logicSystemState=0,console.log("logicSystem.js: _stopLogic: done")};registLogicVariables=function(e){for(let t=0;t<e.length;t++){let l=new Object;l.name=e[t].textContent,l.data=null,this.variableList.push(l)}console.log(this.variableList)};getContentByFieldName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].textContent;return null};getBlockByValueName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].children[0];return null};parseBlock=function(e,t=null){if(!e)return;let l;switch(e.getAttribute("type").split("_")[0]){case"transform":l=this.parse_transform_block(e,t);break;case"actions":l=this.parse_actions_block(e,t);break;case"controls":l=this.parse_controls_block(e,t);break;case"operators":l=this.parse_operators_block(e);break;case"data":l=this.parse_data_block(e,t);break;case"items":l=this.parse_items_block(e);break;case"events":l=this.parse_events_block(e,t);break;case"variables":l=this.parse_variables_block(e,t);break;case"debug":l=this.parse_debug_block(e,t)}return l};clear=function(){this.xmlDoc=null,this.variableList.length=0};checkObjectWorldVisible=function(e){let t=!0;if(0==e.object3D.visible)t=!1;else{let l=!0;e.object3D.traverseAncestors((function(r){"Scene"!=r.type?0==r.visible&&(l=!1):t=1==l&&1==e.object3D.visible}))}return t};checkObjectBehav=function(e){if(e.data&&"TEXT"==e.data.type){let t,l=e.data.value;if(t="function"==typeof arController.getProjectVersion?arController.getProjectVersion(arController.currentProjectIndex):arController.editor_version,Array.isArray(t)&&t[0]<=3&&t[1]<=4){let e=arController.ARSceneResult[arController.currentProjectIndex].data.scene_objs_v2.objs.find((e=>e.obj_id==l));if(e&&e.blockly)return!0}else{if("object"!=typeof t||4!=Object.keys(t).length)return!1;{let e=Number(t.v0),r=Number(t.v1);if(Number(t.v2),e>3||3==e&&r>=5){let e=arController.scenesData.scenes[arController.currentSceneIndex].objs.find((e=>e.generalAttr.obj_id==l));if(e&&e.generalAttr.logic)return!0}}}return!1}return!0}}),Logic.prototype.parse_transform_block=function(e,t){let l=this,r=e.getAttribute("type"),a=new Object;switch(r){case"transform_move_in_second":a.tl=l.transform_move_in_second(e);break;case"transform_move_target_in_second":a.tl=l.transform_move_target_in_second(e);break;case"transform_rotate_in_second":a.tl=l.transform_rotate_in_second(e);break;case"transform_rotate_with_radius_in_second":a.tl=l.transform_rotate_with_radius_in_second(e);break;case"transform_rotate_with_radius_in_second_forever":a.tl=l.transform_rotate_with_radius_in_second_forever(e);break;case"transform_rotate_with_axis_in_second":a.tl=l.transform_rotate_with_axis_in_second(e);break;case"transform_rotate_from_origin_with_axis_in_second":a.tl=l.transform_rotate_from_origin_with_axis_in_second(e);break;case"transform_scale_by_in_second":a.tl=l.transform_scale_by_in_second(e);break;case"transform_set_position":a.tl=l.transform_set_position(e);break;case"transform_get_position":a.data=l.transform_get_position(e);break;case"transform_get_distance":a.data=l.transform_get_distance(e);break;case"transform_set_rotation":a.tl=l.transform_set_rotation(e);break;case"transform_to_look_at_gameobject":a.tl=l.transform_to_look_at_gameobject(e);break;case"transform_to_look_at":a.tl=l.transform_to_look_at(e);break;case"transform_get_rotation":a.data=l.transform_get_rotation(e);break;case"transform_get_rotation_in_space":a.data=l.transform_get_rotation_in_space(e);break;case"transform_get_scale":a.data=l.transform_get_scale(e);break;case"transform_get_scale_in_space":a.data=l.transform_get_scale_in_space(e);break;case"transform_get_scale_axis_in_space":a.data=l.transform_get_scale_axis_in_space(e);break;case"transform_set_scale":a.tl=l.transform_set_scale(e);break;case"transform_set_scale_by_axis":a.tl=l.transform_set_scale_by_axis(e)}return"next"==e.children[e.children.length-1].tagName?a.tl?a.tl.eventCallback("onComplete",(function(){l.parseBlock(e.children[e.children.length-1].children[0],t)})):l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(a.tl?a.tl.eventCallback("onComplete",(function(){t()})):t()),a},Logic.prototype.transform_move_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let r=this.getBlockByValueName(e,"GAME_OBJECT");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"METER");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"NUM"!=c.type)return;let s=document.getElementById(a.value);if(null==s)return;let u=s.object3D.position.clone(),d=new THREE.Vector3;switch(l){case"FORWARD":d.set(0,0,1);break;case"BACKWARD":d.set(0,0,-1);break;case"RIGHT":d.set(-1,0,0);break;case"LEFT":d.set(1,0,0);break;case"UP":d.set(0,1,0);break;case"DOWN":d.set(0,-1,0)}d=d.applyEuler(s.object3D.rotation),d.multiplyScalar(o.value);let h=96;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(h=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(h=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}if(s.object3D.obj_parent_id){let e=d.y;d.y=-e,d.multiplyScalar(-2540/h)}else{let e=d.z;d.z=-e,d.multiplyScalar(-5080/h)}u.add(d);let p=gsap.timeline();return t.timelineDict[e.id]=p,p.to(s.object3D.position,{duration:c.value,delay:0,ease:"none",x:u.x,y:u.y,z:u.z}),p},Logic.prototype.transform_move_target_in_second=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let o=this.getBlockByValueName(e,"SECOND");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"NUM"!=i.type)return;let c=document.getElementById(r.value);if(null==c)return;let s=96,u=512,d=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(s=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],u=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],d=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{console.log("transform_move_target_in_second","v350"),Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(s=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],u=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],d=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}if(c.object3D.obj_parent_id){let e=n.value.z;n.value.z=-e,n.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(2540/s))}else{let e=n.value.y,t=n.value.z;n.value.y=t,n.value.z=e,n.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(5080/s)).add(new THREE.Vector3(25.4*u/s/2,25.4*d/s/2,0))}let h=gsap.timeline();return t.timelineDict[e.id]=h,h.to(c.object3D.position,{duration:i.value,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),h},Logic.prototype.transform_rotate_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"DEGREE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"DEGREE"!=n.type)return;let o=this.getBlockByValueName(e,"SECOND");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"NUM"!=i.type)return;let c=document.getElementById(r.value);if(null==c)return;let s=c.object3D.rotation.clone();switch(t){case"CLOCKWISE":s.y-=Math.PI*n.value/180;break;case"COUNTERCLOCKWISE":s.y+=Math.PI*n.value/180}let u=gsap.timeline();return this.timelineDict[e.id]=u,u.to(c.object3D.rotation,{duration:i.value,delay:0,ease:"none",y:s.y}),u},Logic.prototype.rotateAboutPoint=function(e,t,l,r,a){(a=void 0!==a&&a)&&e.parent.localToWorld(e.position),e.position.sub(t),e.position.applyAxisAngle(l,r),e.position.add(t),a&&e.parent.worldToLocal(e.position),e.rotateOnWorldAxis(l,r)},Logic.prototype.transform_rotate_with_radius_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let r=this.getBlockByValueName(e,"GAME_OBJECT");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"DEGREE");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"DEGREE"!=o.type)return;let i=this.getBlockByValueName(e,"RADIUS");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"NUM"!=c.type)return;c.value<0&&(c.value=0);let s=this.getBlockByValueName(e,"SECOND");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"NUM"!=u.type)return;let d=document.getElementById(a.value);if(null==d)return;let h=96;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(h=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(h=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}d.object3D.obj_parent_id?c.value*=2540/h:c.value*=5080/h;let p=new THREE.Vector3(0,0,-1).applyEuler(d.object3D.rotation),g=d.object3D.up.clone().applyEuler(d.object3D.rotation),_=d.object3D.position.clone().add(p.multiplyScalar(c.value));switch(l){case"CLOCKWISE":o.value=-o.value;break;case"COUNTERCLOCKWISE":o.value=o.value}let m=gsap.timeline();t.timelineDict[e.id]=m;let f=0;return d.object3D.roundTheta=0,m.to(d.object3D,{duration:u.value,delay:0,ease:"none",roundTheta:o.value,onUpdate:function(){t.rotateAboutPoint(d.object3D,_,g,(d.object3D.roundTheta-f)/180*Math.PI),f=d.object3D.roundTheta}}),m},Logic.prototype.transform_rotate_with_radius_in_second_forever=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let r=this.getBlockByValueName(e,"GAME_OBJECT");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"RADIUS");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;o.value<0&&(o.value=0);let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"NUM"!=c.type)return;let s=document.getElementById(a.value);if(null==s)return;let u=96;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(u=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(u=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}s.object3D.obj_parent_id?o.value*=2540/u:o.value*=5080/u;let d,h=new THREE.Vector3(0,0,-1).applyEuler(s.object3D.rotation),p=s.object3D.up.clone().applyEuler(s.object3D.rotation),g=s.object3D.position.clone().add(h.multiplyScalar(o.value));switch(l){case"CLOCKWISE":d=-360;break;case"COUNTERCLOCKWISE":d=360}let _=gsap.timeline();t.timelineDict[e.id]=_;let m=0;return s.object3D.loopTheta=0,_.to(s.object3D,{repeat:-1,duration:c.value,delay:0,ease:"none",loopTheta:d,onUpdate:function(){t.rotateAboutPoint(s.object3D,g,p,(s.object3D.loopTheta-m)/180*Math.PI),m=s.object3D.loopTheta}}),_},Logic.prototype.transform_rotate_with_axis_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"ROTATION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let o=this.getBlockByValueName(e,"DEGREE");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"DEGREE"!=i.type)return;let c=this.getBlockByValueName(e,"SECOND");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=document.getElementById(r.value);if(null==u)return;switch(u.object3D.obj_parent_id,n.value.z=-n.value.z,n.value.normalize(),t){case"CLOCKWISE":i.value=-i.value;break;case"COUNTERCLOCKWISE":i.value=i.value}let d=gsap.timeline();this.timelineDict[e.id]=d;let h=0;return u.object3D.axisTheta=0,d.to(u.object3D,{duration:s.value,delay:0,ease:"none",axisTheta:i.value,onUpdate:function(){u.object3D.rotateOnAxis(n.value,(u.object3D.axisTheta-h)/180*Math.PI),h=u.object3D.axisTheta}}),d},Logic.prototype.transform_rotate_from_origin_with_axis_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let r=this.getContentByFieldName(e,"ORIGIN_SPACE");if(null==r)return;let a=this.getContentByFieldName(e,"AXIS_SPACE");if(null==a)return;let n=this.getBlockByValueName(e,"GAME_OBJECT");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"TEXT"!=o.type)return;let i=this.getBlockByValueName(e,"ORIGIN");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"VEC3"!=c.type)return;let s=this.getBlockByValueName(e,"AXIS");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"VEC3"!=u.type)return;let d=this.getBlockByValueName(e,"DEGREE");if(null==d)return;let h=this.parseBlock(d).data;if(null==h||"DEGREE"!=h.type)return;let p=this.getBlockByValueName(e,"SECOND");if(null==p)return;let g=this.parseBlock(p).data;if(null==g||"NUM"!=g.type)return;let _=document.getElementById(o.value);if(null==_)return;switch(l){case"CLOCKWISE":h.value=-h.value;break;case"COUNTERCLOCKWISE":h.value=h.value}let m=96,f=512,y=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(m=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],f=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],y=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(m=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],f=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],y=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}switch(r){case"SPACE_LOCAL":_.object3D.obj_parent_id?c.value.multiply(new THREE.Vector3(1,1,-1)).multiplyScalar(2540/m):c.value.multiply(new THREE.Vector3(1,1,-1)).multiplyScalar(5080/m),c.value=c.value.applyMatrix4(_.object3D.matrix);break;case"SPACE_GLOBAL":let e;if(_.object3D.traverseAncestors((function(t){t.targetRoot&&(e=t)})),e){let t=e.matrix.clone(),l=_.object3D.matrix.clone(),r=c.value.y,a=c.value.z;c.value.y=a,c.value.z=r,c.value.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*f/m/2,25.4*y/m/2,0)).applyMatrix4(t),c.value=_.object3D.worldToLocal(c.value).applyMatrix4(l)}}switch(a){case"SPACE_LOCAL":u.value.multiply(new THREE.Vector3(1,1,-1)),u.value.normalize(),u.value=u.value.applyEuler(_.object3D.rotation);break;case"SPACE_GLOBAL":let e;if(_.object3D.traverseAncestors((function(t){t.targetRoot&&(e=t)})),e){let t=e.matrix.clone(),l=_.object3D.matrix.clone(),r=u.value.clone(),a=r.y,n=r.z;r.y=n,r.z=a,r=_.object3D.worldToLocal(r.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*f/m/2,25.4*y/m/2,0)).applyMatrix4(t)).applyMatrix4(l);let o=new THREE.Vector3(0,0,0);o=_.object3D.worldToLocal(o.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*f/m/2,25.4*y/m/2,0)).applyMatrix4(t)).applyMatrix4(l);let i=(new THREE.Vector3).subVectors(r,o).normalize();u.value=i}}let v=gsap.timeline();t.timelineDict[e.id]=v;let b=0;return _.object3D.Theta=0,v.to(_.object3D,{duration:g.value,delay:0,ease:"none",Theta:h.value,onUpdate:function(){t.rotateAboutPoint(_.object3D,c.value,u.value,(_.object3D.Theta-b)/180*Math.PI),b=_.object3D.Theta}}),v},Logic.prototype.transform_scale_by_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"SCALE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=this.getBlockByValueName(e,"SECOND");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=document.getElementById(l.value);if(null==i)return;let c=i.object3D.scale.clone();c.multiplyScalar(a.value);let s=gsap.timeline();return this.timelineDict[e.id]=s,s.to(i.object3D.scale,{duration:o.value,delay:0,ease:"none",x:c.x,y:c.y,z:c.z}),s},Logic.prototype.transform_set_position=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let o=document.getElementById(r.value);if(null==o)return;let i=96,c=512,s=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(i=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],c=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],s=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(i=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],c=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],s=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}if(o.object3D.obj_parent_id){let e=n.value.z;n.value.z=-e,n.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(2540/i))}else{let e=n.value.y,t=n.value.z;n.value.y=t,n.value.z=e,n.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(5080/i)).add(new THREE.Vector3(25.4*c/i/2,25.4*s/i/2,0))}let u=gsap.timeline();return u.to(o.object3D.position,{duration:.01,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),u},Logic.prototype.transform_get_position=function(e){let t=this,l=this.getContentByFieldName(e,"SPACE");if(null==l)return;let r=this.getBlockByValueName(e,"GAME_OBJECT");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let o=new Object;o.type="VEC3";let i=96,c=512,s=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(i=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],c=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],s=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(i=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],c=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],s=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}switch(l){case"SPACE_GLOBAL":o.value=n.object3D.getWorldPosition().clone();let e,t=n.object3D.getWorldPosition().clone();if(n.object3D.traverseAncestors((function(t){t.targetRoot&&(e=t)})),e){let l=e.matrix.clone(),r=(new THREE.Matrix4).getInverse(l),a=t.clone().applyMatrix4(r);a.add(new THREE.Vector3(25.4*-c/i/2,25.4*-s/i/2,0)).multiplyScalar(i/5080);let n=a.y,u=a.z;a.y=u,a.z=n,o.value=a.clone()}break;case"SPACE_LOCAL":let l=n.object3D.position.clone();if(n.object3D.obj_parent_id){l.multiplyScalar(i/2540);let e=l.z;l.z=-e}else{l.add(new THREE.Vector3(25.4*-c/i/2,25.4*-s/i/2,0)).multiplyScalar(i/5080);let e=l.y,t=l.z;l.y=t,l.z=e}o.value=l.clone()}return o.value.x=Math.round(1e4*o.value.x)/1e4,o.value.y=Math.round(1e4*o.value.y)/1e4,o.value.z=Math.round(1e4*o.value.z)/1e4,o},Logic.prototype.transform_get_distance=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let o=document.getElementById(r.value);if(null==o)return;let i=new THREE.Vector3;o.object3D.getWorldPosition(i);let c=document.getElementById(n.value);if(null==c)return;let s=new THREE.Vector3;c.object3D.getWorldPosition(s);let u=new Object;u.type="NUM",u.value=i.distanceTo(s);let d=96;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(d=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(d=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}return u.value=Math.round(u.value/(5080/d)*1e4)/1e4,u},Logic.prototype.transform_set_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"ROTATION");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"VEC3"!=a.type)return;let n=document.getElementById(l.value);if(null==n)return;if(n.object3D.obj_parent_id){a.value.multiply(new THREE.Vector3(-1,-1,1));let e=new THREE.Euler(a.value.x/180*Math.PI,a.value.y/180*Math.PI,a.value.z/180*Math.PI,"YXZ");e.reorder("XYZ"),a.value.x=180*e.x/Math.PI,a.value.y=180*e.y/Math.PI,a.value.z=180*e.z/Math.PI}else{let e=a.value.x,t=a.value.y,l=a.value.z;a.value.x=0-e,a.value.y=-t,a.value.z=l;let r=new THREE.Euler(a.value.x/180*Math.PI,a.value.y/180*Math.PI,a.value.z/180*Math.PI,"YXZ");r.reorder("XYZ"),a.value.x=180*r.x/Math.PI+90,a.value.y=180*r.y/Math.PI,a.value.z=180*r.z/Math.PI}let o=gsap.timeline();return o.to(n.object3D.rotation,{duration:.01,delay:0,ease:"none",x:a.value.x/180*Math.PI,y:a.value.y/180*Math.PI,z:a.value.z/180*Math.PI}),o},Logic.prototype.transform_to_look_at_gameobject=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(l.value);if(null==n)return;let o=document.getElementById(a.value);if(null==o)return;let i=new THREE.Vector3;o.object3D.getWorldPosition(i);let c=gsap.timeline();return c.to(n.object3D,{duration:.01,delay:0,ease:"none",onStart:function(){n.object3D.lookAt(i),n.object3D.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI)}}),c},Logic.prototype.transform_to_look_at=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let o=document.getElementById(r.value);if(null==o)return;let i,c=96,s=512,u=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)){const e={v340:()=>{Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(c=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],s=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],u=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID])},v350:()=>{Number(arController.currentSceneIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID]&&(c=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],s=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID],u=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentSceneIndex].GCSSID])}};t.versionControlThenRun(e)}if(o.object3D.traverseAncestors((function(e){e.targetRoot&&(i=e)})),i){let e=i.matrix.clone(),t=n.value.clone(),l=t.y,r=t.z;t.y=r,t.z=l,t.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*s/c/2,25.4*u/c/2,0)).applyMatrix4(e),n.value=t}let d=gsap.timeline();return d.to(gsapEmpty,{duration:.01,delay:0,ease:"none",onStart:function(){o.object3D.lookAt(n.value),o.object3D.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI)}}),d},Logic.prototype.transform_get_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);if(null==r)return;let a=new Object;return a.type="VEC3",a.value=r.object3D.rotation.clone(),a.value.x=a.value.x/Math.PI*180,a.value.y=-a.value.y/Math.PI*180,a.value.z=-a.value.z/Math.PI*180,a},Logic.prototype.transform_get_rotation_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=document.getElementById(r.value);if(null==a)return;let n=new Object;switch(n.type="VEC3",t){case"SPACE_GLOBAL":let e=new THREE.Quaternion;a.object3D.getWorldQuaternion(e);let t,l=new THREE.Euler;l.setFromQuaternion(e,"YXZ"),n.value=l;let r,o=a.object3D.matrix.clone();if(a.object3D.traverseAncestors((function(e){e.targetRoot?(t=e,r=o.clone()):o=e.matrix.clone().multiply(o)})),t){let e=r.clone(),t=new THREE.Quaternion,l=new THREE.Vector3,a=new THREE.Vector3;e.clone().decompose(l,t,a);let o=new THREE.Euler;o.setFromQuaternion(t);let i=o.x,c=o.y;n.value=new THREE.Euler,n.value.x=i-90*Math.PI/180,n.value.y=c,n.value.z=o.z}break;case"SPACE_LOCAL":a.object3D.obj_parent_id?n.value=a.object3D.rotation.clone():(n.value=a.object3D.rotation.clone(),n.value.x-=90*Math.PI/180)}return n.value.x=Math.round(n.value.x/Math.PI*180*1e4)/1e4,n.value.y=Math.round(-n.value.y/Math.PI*180*1e4)/1e4,n.value.z=Math.round(-n.value.z/Math.PI*180*1e4)/1e4,n},Logic.prototype.transform_get_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);if(null==r)return;let a=new Object;return a.type="NUM",a.value=r.object3D.scale.clone().x,r.object3D.obj_parent_id?a.value=Math.round(1e4*r.object3D.scale.clone().x)/1e4:a.value=Math.round(r.object3D.scale.clone().x/2*1e4)/1e4,a},Logic.prototype.transform_get_scale_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=document.getElementById(r.value);if(null==a)return;let n=new Object,o=new THREE.Vector3;switch(n.type="NUM",t){case"SPACE_GLOBAL":a.object3D.getWorldScale(o),n.value=Math.round(o.x/2*1e4)/1e4;break;case"SPACE_LOCAL":a.object3D.obj_parent_id?n.value=Math.round(a.object3D.scale.clone().x/1*1e4)/1e4:n.value=Math.round(a.object3D.scale.clone().x/2*1e4)/1e4}return n},Logic.prototype.transform_get_scale_axis_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=document.getElementById(r.value);if(null==a)return;let n=new Object;switch(n.value=new THREE.Vector3,n.type="VEC3",t){case"SPACE_GLOBAL":let e=a.object3D.getWorldScale(n.value);e.x=Math.round(1e4*e.x)/1e4,e.y=Math.round(1e4*e.y)/1e4,e.z=Math.round(1e4*e.z)/1e4,n.value=e.clone();break;case"SPACE_LOCAL":let t=a.object3D.scale.clone();t.x=Math.round(1e4*t.x)/1e4,t.y=Math.round(1e4*t.y)/1e4,t.z=Math.round(1e4*t.z)/1e4,a.object3D.obj_parent_id||t.multiplyScalar(.5),n.value=t.clone()}return n},Logic.prototype.transform_set_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"SCALE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=document.getElementById(l.value);if(null==n)return;a.value*=2;let o=gsap.timeline();return o.to(n.object3D.scale,{duration:.01,delay:0,ease:"none",x:a.value,y:a.value,z:a.value}),o},Logic.prototype.transform_set_scale_by_axis=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"AXIS");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"VEC3"!=a.type)return;a.value.multiplyScalar(2);let n=document.getElementById(l.value);if(null==n)return;let o=gsap.timeline();return o.to(n.object3D.scale,{duration:.01,delay:0,ease:"none",x:a.value.x,y:a.value.y,z:a.value.z}),o},Logic.prototype.versionControlThenRun=function(e){let t;if(t="function"==typeof arController.getProjectVersion?arController.getProjectVersion(arController.currentProjectIndex):arController.editor_version,Array.isArray(t)&&t[0]<=3&&t[1]<=4)e.v340();else{if("object"!=typeof t||4!=Object.keys(t).length)return!1;{let l=Number(t.v0),r=Number(t.v1);Number(t.v2),(l>3||3==l&&r>=5)&&e.v350()}}},Logic.prototype.parse_actions_block=function(e,t){let l=this,r=e.getAttribute("type"),a=new Object,n=null;switch(r){case"actions_set_color":l.actions_set_color(e);break;case"actions_set_visibility":l.actions_set_visibility(e);break;case"actions_set_opacity":l.actions_set_opacity(e);break;case"actions_set_animation":l.actions_set_animation(e);break;case"actions_set_animation_by_id":l.actions_set_animation_by_id(e);break;case"actions_play_sound_until_finished":n=l.actions_play_sound_until_finished(e,t);break;case"actions_play_sound":l.actions_play_sound(e);break;case"actions_stop_sound":l.actions_stop_sound(e);break;case"actions_play_video_until_finished":n=l.actions_play_video_until_finished(e,t);break;case"actions_play_video":l.actions_play_video(e);break;case"actions_pause_video":l.actions_pause_video(e);break;case"actions_stop_video":l.actions_stop_video(e);break;case"actions_set_light_color":l.actions_set_light_color(e);break;case"actions_set_light_intensity":l.actions_set_light_intensity(e);break;case"actions_set_text":n=l.actions_set_text(e,t);break;case"actions_set_text_color":n=l.actions_set_text_color(e,t);break;case"actions_set_text_bgcolor":n=l.actions_set_text_bgcolor(e,t)}return"next"==e.children[e.children.length-1].tagName?n||l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(n||t()),a},Logic.prototype.actions_set_color=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let r=this.getBlockByValueName(e,"COLOUR");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type&&"COLOUR"!=a.type)return;let n=10*parseFloat(l[2])+parseFloat(l[3]),o=10*parseFloat(l[0])+parseFloat(l[1]),i=document.getElementById(t);if(null==i)return;let c=-1,s=-1;if(i.object3D.children.length>0&&i.object3D.children[0].ModelJson&&i.object3D.children[0].ModelJson.meshes&&i.object3D.children[0].ModelJson.materials&&i.object3D.children[0].ModelJson.nodes){let e=i.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,n==t){c=e[l].mesh,console.log("action.js: _actions_set_color: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_color: meshIndex = ",c),c>=0){let e=i.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_color: get meshData ",c,e),e&&e.primitives){let t=e.primitives[o];Number.isInteger(t.material)&&(s=t.material,console.log("action.js: _actions_set_color: materialIndex=",s))}}}s>=0&&i.object3D.traverse((function(e){if(e.isMesh&&e.el==i.object3D.el){let t=e.material.name.split("_");t[t.length-1]==s&&e.meshIdx==c&&(e.material=e.material.clone(),e.material.color=new THREE.Color(a.value),console.log("action.js: _actions_set_color: child.material =",e.material))}}))},Logic.prototype.actions_set_visibility=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"BOOL");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"BOOL"!=a.type)return;let n=document.getElementById(l.value);null!=n&&(n.setAttribute("visible",a.value),n.object3D.traverse((function(e){"Group"==e.type&&e.el.getAttribute("visible")&&e.el.object3D.behav&&e.el.setAttribute("class","clickable")})))},Logic.prototype.actions_set_opacity=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let r=this.getBlockByValueName(e,"PERCENT");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=10*parseFloat(l[2])+parseFloat(l[3]),o=10*parseFloat(l[0])+parseFloat(l[1]),i=document.getElementById(t);if(null==i)return;let c=-1,s=-1;if(i.object3D.children.length>0&&i.object3D.children[0].ModelJson&&i.object3D.children[0].ModelJson.meshes&&i.object3D.children[0].ModelJson.materials&&i.object3D.children[0].ModelJson.nodes){let e=i.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,n==t){c=e[l].mesh,console.log("action.js: _actions_set_opacity: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_opacity: meshIndex = ",c),c>=0){let e=i.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_opacity: get meshData ",c,e),e&&e.primitives){let t=e.primitives[o];Number.isInteger(t.material)&&(s=t.material,console.log("action.js: _actions_set_opacity: materialIndex=",s))}}}s>=0&&i.object3D.traverse((function(e){if(e.isMesh){let t=e.material.name.split("_");t[t.length-1]==s&&e.meshIdx==c&&(e.material=e.material.clone(),e.material.transparent=!0,e.material.opacity=a.value/100,e.material.blending=THREE.NormalBlending,console.log("action.js: _actions_set_opacity: child.material =",e.material))}}))},Logic.prototype.actions_set_animation=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let r,a=document.getElementById(t);if(null!=a)if("None"==l)a.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<a.object3D.children[0].animationSlices.length;e++)a.object3D.children[0].animationSlices[e].name==l&&(r=a.object3D.children[0].animationSlices[e]);r&&(a.setAttribute("animation-mixer","clip: "+r.animationName),a.object3D.children[0].animationSlices[0].loop=r.uid,a.object3D.children[0].animationSlices[0].uid=r.uid,a.object3D.children[0].animationSlices[0].changed=!0,a.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_set_animation_by_id=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let r=this.getContentByFieldName(e,"TIMES");if(null==r)return;let a=document.getElementById(t);var n;if(null!=a)if("None"==l)a.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<a.object3D.children[0].animationSlices.length;e++)a.object3D.children[0].animationSlices[e].uid==l&&(n=a.object3D.children[0].animationSlices[e]);a.setAttribute("animation-mixer","clip: "+n.animationName),a.object3D.children[0].animationSlices[0].uid=n.uid,a.object3D.children[0].animationSlices[0].changed=!0,"LOOP"==r&&(a.object3D.children[0].animationSlices[0].loop=n.uid,a.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_play_sound_until_finished=function(e,t){let l=this.getBlockByValueName(e,"SOUND");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=document.getElementById(r.value);if(null==a)return;let n=this;if(1==n.checkObjectWorldVisible(a)){a.setAttribute("sound","loop:false"),a.components.sound.playSound();let l=function(r){a.components.sound.stopSound(),a.removeEventListener("sound-ended",l),a.setAttribute("sound","loop:true"),"next"==e.children[e.children.length-1].tagName?n.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return a.addEventListener("sound-ended",l),!0}},Logic.prototype.actions_play_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);if(null!=r&&1==this.checkObjectWorldVisible(r)){let e=r.components.sound.pool.children.find((e=>e.el==r));e&&e.isPlaying||r.components.sound.playSound()}},Logic.prototype.actions_stop_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);null!=r&&1==this.checkObjectWorldVisible(r)&&r.components.sound.stopSound()},Logic.prototype.actions_play_video_until_finished=function(e,t){let l=this.getBlockByValueName(e,"VIDEO");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=document.getElementById(r.value);if(null==a)return;let n=this;if(1==n.checkObjectWorldVisible(a)){let l=a.getAttribute("src");if(null!=l){l=l.split("#").pop();let r=document.getElementById(l);if(r instanceof HTMLElement){r.loop=!1,r.muted=!1,r.play();let l=function(a){r.currentTime=0,r.pause(),r.removeEventListener("ended",l),r.loop=!0,"next"==e.children[e.children.length-1].tagName?n.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return r.addEventListener("ended",l),!0}}}},Logic.prototype.actions_play_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);if(null!=r&&1==this.checkObjectWorldVisible(r)){let e=r.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.loop=!0,t.muted=!1,t.play())}}},Logic.prototype.actions_pause_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);if(null!=r&&1==this.checkObjectWorldVisible(r)){let e=r.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&t.pause()}}},Logic.prototype.actions_stop_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=document.getElementById(l.value);if(null!=r&&1==this.checkObjectWorldVisible(r)){let e=r.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.currentTime=t.duration,t.loop=!1)}}},Logic.prototype.actions_set_light_color=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"COLOUR");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type&&"COLOUR"!=a.type)return;let n=document.getElementById(l.value);null!=n&&(n.object3D.children[0].color=new THREE.Color(a.value))},Logic.prototype.actions_set_light_intensity=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let r=this.getBlockByValueName(e,"PERCENT");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=document.getElementById(l.value);null!=n&&(n.object3D.children[0].intensity=a.value/100)},Logic.prototype.actions_set_text=function(e,t){let l=this,r=this.getBlockByValueName(e,"TEXT_ITEM");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"TEXT");if(null==n)return;let o=this.parseBlock(n).data;if(null==o)return;let i=document.getElementById(a.value);if(null==i)return;let c=l.toString(o);if(i.children[0].getAttribute("value")!=c){console.log(" _actions_set_text:  ",i.children[0].object3D.children.length,i.children[0].components.text.textMesh.children.length),i.children[0].components.text.textMesh.children.length=0,i.children[0].object3D.children.length=1,i.children[0].setAttribute("value",c);let r=c.split("\n"),a=0;const n=/[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u,o=e=>n.test(e);for(let e=0;e<r.length;e++){let t=0;for(let l=0;l<r[e].length;l++)o(r[e][l])?t+=1.6:r[e][l]==r[e][l].toUpperCase()&&r[e][l]!=r[e][l].toLowerCase()||r[e][l]==r[e][l].toLowerCase()&&r[e][l]!=r[e][l].toUpperCase()?t+=1:isNaN(1*r[e][l])?t+=1.25:t+=1;t>a&&(a=t)}i.children[0].setAttribute("wrap-count",a+1);let s=function(r){i.children[0].removeEventListener("geometry-set",s),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return i.children[0].addEventListener("geometry-set",s),!0}},Logic.prototype.actions_set_text_color=function(e,t){let l=this,r=this.getBlockByValueName(e,"TEXT_ITEM");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"COLOUR");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"TEXT"!=o.type&&"COLOUR"!=o.type)return;let i=document.getElementById(a.value);if(null!=i&&i.children[0].getAttribute("color")!=o.value){i.children[0].components.text.textMesh.children.length=0,i.children[0].object3D.children.length=1,i.children[0].setAttribute("color",o.value);let r=function(a){i.children[0].removeEventListener("geometry-set",r),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return i.children[0].addEventListener("geometry-set",r),!0}},Logic.prototype.actions_set_text_bgcolor=function(e,t){let l=this,r=this.getBlockByValueName(e,"TEXT_ITEM");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"COLOUR");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"TEXT"!=o.type&&"COLOUR"!=o.type)return;let i=document.getElementById(a.value);if(null==i)return;let c=new THREE.Color(o.value),s=c.r+","+c.g+","+c.b+",1";if(i.children[0].getAttribute("backcolor")!=s){i.children[0].components.text.textMesh.children.length=0,i.children[0].object3D.children.length=1,i.children[0].setAttribute("backcolor",s);let r=function(a){i.children[0].removeEventListener("geometry-set",r),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return i.children[0].addEventListener("geometry-set",r),!0}},Logic.prototype.parse_controls_block=function(e,t){let l=e.getAttribute("type"),r=new Object;switch(l){case"controls_repeat_forever":r.tl=this.controls_repeat_forever(e,t);break;case"controls_repeat":r.tl=this.controls_repeat(e,t);break;case"controls_for":r.tl=this.controls_for(e,t);break;case"controls_whileUntil":r.tl=this.controls_whileUntil(e,t);break;case"controls_forEach":r.tl=this.controls_forEach(e,t);break;case"controls_flow_statements":r.tl=this.controls_flow_statements(e,t);break;case"controls_if":r.tl=this.controls_if(e,t);break;case"controls_ifelse":r.tl=this.controls_ifelse(e,t);break;case"controls_wait_time":r.tl=this.controls_wait_time(e,t);break;case"controls_run_parallel":r.tl=this.controls_run_parallel(e,t)}return"controls_repeat_forever"!=l&&("next"==e.children[e.children.length-1].tagName?r.tl||this.parseBlock(e.children[e.children.length-1].children[0],t):t&&(r.tl||t())),r},Logic.prototype.controls_repeat_forever=function(e,t){let l=this,r=this.getBlockByValueName(e,"DO");if(null==r)return;let a=gsap.timeline();return l.timelineDict[e.id]=a,a.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(r,(function(r=null){null==r||"CONTINUE"==r?a.restart():"BREAK"==r&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),a},Logic.prototype.controls_repeat=function(e,t){let l=this,r=this.getBlockByValueName(e,"DO");if(null==r)return;let a=this.getBlockByValueName(e,"TIMES");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let o=Math.max(0,n.value)-1,i=gsap.timeline();return l.timelineDict[e.id]=i,i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(r,(function(r=null){null==r||"CONTINUE"==r?o>0?(o-=1,i.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t():"BREAK"==r&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),i},Logic.prototype.controls_for=function(e,t){let l=this,r=this.getContentByFieldName(e,"VAR");if(null==r)return;let a=this.getBlockByValueName(e,"FROM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let o=this.getBlockByValueName(e,"TO");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"NUM"!=i.type)return;let c=this.getBlockByValueName(e,"BY");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=this.getBlockByValueName(e,"DO");if(null==u)return;let d,h=n.value;this.variableList.forEach((e=>{e.name==r&&(d=e)}));let p=new Object;p.value=h,p.type="NUM";let g=gsap.timeline();return l.timelineDict[e.id]=g,h<=i.value&&s.value>0||h>=i.value&&s.value<0?(d.data=p,g.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(u,(function(r=null){null==r||"CONTINUE"==r?(h+=s.value,h<=i.value&&s.value>0||h>=i.value&&s.value<0?(d.data.value=h,g.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==r&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),g},Logic.prototype.controls_whileUntil=function(e,t){let l=this,r=this.getContentByFieldName(e,"MODE");if(null==r)return;let a=this.getBlockByValueName(e,"DO");if(null==a)return;let n=this.getBlockByValueName(e,"BOOL");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"BOOL"!=o.type)return;let i=gsap.timeline();return l.timelineDict[e.id]=i,"WHILE"==r&&o.value||"UNTIL"==r&&!o.value?i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?(o=l.parseBlock(n).data,"WHILE"==r&&o.value||"UNTIL"==r&&!o.value?i.restart():"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),i},Logic.prototype.controls_forEach=function(e,t){let l=this,r=this.getContentByFieldName(e,"VAR");if(null==r)return;let a=this.getBlockByValueName(e,"LIST");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;if(n.value.length<1)return;let o=this.getBlockByValueName(e,"DO");if(null==o)return;let i,c=0;this.variableList.forEach((e=>{e.name==r&&(i=e)}));let s=new Object;s.value=n.value[c].value,s.type=n.value[c].type,i.data=s;let u=gsap.timeline();l.timelineDict[e.id]=u,u.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(o,(function(r=null){null==r||"CONTINUE"==r?(c+=1,c<n.value.length?(i.data.value=n.value[c].value,i.data.type=n.value[c].type,u.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==r&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})},Logic.prototype.controls_flow_statements=function(e,t){let l=this.getContentByFieldName(e,"FLOW");null!=l&&t&&t(l)},Logic.prototype.controls_if=function(e,t){let l=this,r=parseInt(e.children[0].getAttribute("elseif")),a=0,n=gsap.timeline();for(l.timelineDict[e.id]=n;;){let r=this.getBlockByValueName(e,"IF"+a);if(null==r)break;let o=this.parseBlock(r).data;if(null==o||"BOOL"!=o.type)break;let i=this.getBlockByValueName(e,"DO"+a);if(o.value)return i?(n.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(i,(function(r=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(r)}))}}),n):void 0;a+=1}let o=this.getBlockByValueName(e,"ELSE");if(o&&a==r+1)return n.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(o,(function(r=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(r)}))}}),n;"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()},Logic.prototype.controls_ifelse=function(e,t){let l=this,r=this.getBlockByValueName(e,"DO0"),a=this.getBlockByValueName(e,"ELSE");if(null==r&&null==a)return;let n=this.getBlockByValueName(e,"IF0");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"BOOL"!=o.type)return;let i=gsap.timeline();return l.timelineDict[e.id]=i,o.value?i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(r,(function(r=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(r)}))}}):i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(r=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(r)}))}}),i},Logic.prototype.controls_wait_time=function(e,t){let l=this,r=this.getContentByFieldName(e,"UNIT");if(null==r)return;let a=this.getBlockByValueName(e,"TIME");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;switch(r){case"SECONDS":n.value=n.value;break;case"MILLISECOND":n.value=n.value/1e3;break;case"MINUTES":n.value=60*n.value}let o=gsap.timeline();return l.timelineDict[e.id]=o,o.to(gsapEmpty,{delay:n.value,onStart:function(){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()}}),o},Logic.prototype.controls_run_parallel=function(e,t){let l=parseInt(e.children[0].getAttribute("do")),r=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"DO"+(t+1));l&&r.push(l)}if(!(r.length<1))for(let e=0;e<r.length;e++)this.parseBlock(r[e])},Logic.prototype.parse_operators_block=function(e){let t=e.getAttribute("type"),l=new Object;switch(t){case"operators_compare":l.data=this.operators_compare(e);break;case"operators_operation":l.data=this.operators_operation(e);break;case"operators_negate":l.data=this.operators_negate(e);break;case"operators_ternary":l.data=this.operators_ternary(e);break;case"operators_arithmetic":l.data=this.operators_arithmetic(e);break;case"operators_random_int":l.data=this.operators_random_int(e);break;case"operators_random_float_between":l.data=this.operators_random_float_between(e);break;case"operators_constrain":l.data=this.operators_constrain(e);break;case"operators_number_property":l.data=this.operators_number_property(e);break;case"operators_is_divisable":l.data=this.operators_is_divisable(e);break;case"operators_round":l.data=this.operators_round(e);break;case"operators_round_to_decimals":l.data=this.operators_round_to_decimals(e);break;case"operators_single":l.data=this.operators_single(e);break;case"operators_trig":l.data=this.operators_trig(e);break;case"operators_on_list":l.data=this.operators_on_list(e)}return l},Logic.prototype.operators_compare=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let r=this.parseBlock(l).data;if(null==r)return;let a=this.getBlockByValueName(e,"B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n)return;if(r.type!=n.type)return null;let o=new Object;switch(o.type="BOOL",t){case"EQ":o.value=r.value==n.value;break;case"NEQ":o.value=r.value!=n.value;break;case"LT":if("NUM"!=r.type)return null;o.value=r.value<n.value;break;case"LTE":if("NUM"!=r.type)return null;o.value=r.value<=n.value;break;case"GT":if("NUM"!=r.type)return null;o.value=r.value>n.value;break;case"GTE":if("NUM"!=r.type)return null;o.value=r.value>=n.value}return o},Logic.prototype.operators_operation=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"BOOL"!=r.type)return;let a=this.getBlockByValueName(e,"B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"BOOL"!=n.type)return;let o=new Object;switch(o.type="BOOL",t){case"AND":o.value=r.value&&n.value;break;case"OR":o.value=r.value||n.value}return o},Logic.prototype.operators_negate=function(e){let t=this.getBlockByValueName(e,"BOOL");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let r=new Object;return r.type="BOOL",r.value=!l.value,r},Logic.prototype.operators_ternary=function(e){let t=this.getBlockByValueName(e,"IF");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let r=this.getBlockByValueName(e,"THEN");if(null==r)return;let a=this.parseBlock(r).data,n=this.getBlockByValueName(e,"ELSE");if(null==n)return;let o=this.parseBlock(n).data;return l.value?a:o},Logic.prototype.operators_arithmetic=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"NUM"!=r.type)return;let a=this.getBlockByValueName(e,"B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let o=new Object;switch(o.type="NUM",t){case"ADD":o.value=r.value+n.value;break;case"MINUS":o.value=r.value-n.value;break;case"MULTIPLY":o.value=r.value*n.value;break;case"DIVIDE":o.value=r.value/n.value;break;case"POWER":o.value=Math.pow(r.value,n.value);break;case"MOD":o.value=r.value%n.value}return o},Logic.prototype.operators_random_int=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"TO");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=parseInt(a.value),o=parseInt(l.value),i=new Object;return i.type="NUM",i.value=parseInt(Math.random()*(n-o))+o,i},Logic.prototype.operators_random_float_between=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"TO");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=new Object;return n.type="NUM",n.value=Math.random()*(a.value-l.value)+l.value,n},Logic.prototype.operators_constrain=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"LOW");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=this.getBlockByValueName(e,"HIGH");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=new Object;return i.type="NUM",i.value=Math.min(Math.max(l.value,a.value),o.value),i},Logic.prototype.operators_number_property=function(e){let t=this.getContentByFieldName(e,"PROPERTY");if(null==t)return;let l=this.getBlockByValueName(e,"NUMBER_TO_CHECK");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"NUM"!=r.type)return;let a=new Object;switch(a.type="BOOL",CheckPrime=function(e){if(2==e||3==e)return!0;if(!(e>1)||e%1!=0||e%2==0||e%3==0)return!1;for(let t=6;t<=Math.sqrt(e)+1.5;t+=6)if(e%(t-1)==0||e%(t+1)==0)return!1;return!0},t){case"EVEN":a.value=r.value%2==0;break;case"ODD":a.value=r.value%2==1;break;case"PRIME":a.value=CheckPrime(r.value);break;case"WHOLE":a.value=r.value%1==0;break;case"POSITIVE":a.value=r.value>0;break;case"NEGATIVE":a.value=r.value<0}return a},Logic.prototype.operators_is_divisable=function(e){let t=this.getBlockByValueName(e,"DIVIDEND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"DIVISOR");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=new Object;return n.type="BOOL",n.value=l.value%a.value==0,n},Logic.prototype.operators_round=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"NUM"!=r.type)return;let a=new Object;switch(a.type="NUM",t){case"ROUND":a.value=Math.round(r.value);break;case"ROUNDUP":a.value=Math.ceil(r.value);break;case"ROUNDDOWN":a.value=Math.floor(r.value)}return a},Logic.prototype.operators_round_to_decimals=function(e){let t=this.getBlockByValueName(e,"A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"B");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=new Object;n.type="NUM";let o=parseInt(a.value);return value=l.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+o:o))),value=value.toString().split("e"),n.value=+(value[0]+"e"+(value[1]?+value[1]-o:-o)),n},Logic.prototype.operators_single=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"NUM"!=r.type)return;let a=new Object;switch(a.type="NUM",t){case"ROOT":a.value=Math.sqrt(r.value);break;case"ABS":a.value=Math.abs(r.value);break;case"NEG":a.value=-r.value;break;case"LN":a.value=Math.log(r.value);break;case"LOG10":a.value=Math.log10(r.value);break;case"EXP":a.value=Math.exp(r.value);break;case"POW10":a.value=Math.pow(10,r.value)}return a},Logic.prototype.operators_trig=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"NUM"!=r.type&&"DEGREE"!=r.type)return;"DEGREE"==r.type&&(r.value=Math.PI*r.value/180);let a=new Object;switch(a.type="NUM",t){case"SIN":a.value=Math.sin(r.value);break;case"COS":a.value=Math.cos(r.value);break;case"TAN":a.value=Math.tan(r.value);break;case"ASIN":a.value=Math.asin(r.value);break;case"ACOS":a.value=Math.acos(r.value);break;case"ATAN":a.value=Math.atan(r.value)}return a},Logic.prototype.operators_on_list=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"LIST");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"LIST"!=r.type)return;let a=[],n={};for(let e=0;e<r.value.length;e++){if("NUM"!=r.value[e].type)return;a.push(r.value[e].value),n[r.value[e].value]?n[r.value[e].value]+=1:n[r.value[e].value]=1}let o=new Object;switch(o.type="NUM",t){case"SUM":o.value=a.reduce(((e,t)=>e+t),0);break;case"MIN":o.value=Math.min(...a);break;case"MAX":o.value=Math.max(...a);break;case"AVERAGE":o.value=a.reduce(((e,t)=>e+t),0)/a.length;break;case"MEDIAN":a.sort((function(e,t){return e-t})),a.length%2==1?o.value=a[parseInt(a.length/2)]:o.value=(a[parseInt(a.length/2)-1]+a[parseInt(a.length/2)])/2;break;case"MODE":let e=Math.max(...Object.values(n)),t=[];Object.keys(n).forEach((l=>{if(n[l]==e){let e=new Object;e.value=parseFloat(l),e.type="NUM",t.push(e)}})),o.value=t,o.type="LIST";break;case"STD_DEV":let l=a.reduce(((e,t)=>e+t),0)/a.length,r=0;a.forEach((e=>{let t=e-l;r+=t*t})),o.value=Math.sqrt(r/a.length);break;case"RANDOM":o.value=a[parseInt(Math.random()*a.length)]}return o},Logic.prototype.parse_items_block=function(e){let t,l,r=e.getAttribute("type");if(l="function"==typeof arController.getProjectVersion?arController.getProjectVersion(arController.currentProjectIndex):arController.editor_version,Array.isArray(l)&&l[0]<=3&&l[1]<=4)t=arController.ARSceneResult[arController.currentProjectIndex].data.scene_objs_v2.objs;else if("object"==typeof l&&4==Object.keys(l).length){let e=Number(l.v0),r=Number(l.v1);Number(l.v2),(e>3||3==e&&r>=5)&&(t=arController.scenesData.scenes[arController.currentSceneIndex].objs)}let a=new Object;switch(r){case"items_get_gameobject":case"items_get_model":case"items_get_text":case"items_get_light":case"items_get_sound":case"items_get_video":a.data=this.items_get_gameobject(e);break;case"items_get_name":a.data=this.items_get_name(e,t);break;case"items_get_by_name":a.data=this.items_get_by_name(e,t);break;case"items_is_video_playing":a.data=this.items_is_video_playing(e)}return"items_get_name"!=r&&(this.checkObjectBehav(a)||(a.data=null)),a},Logic.prototype.items_get_gameobject=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type="TEXT",t},Logic.prototype.items_get_name=function(e,t){let l=new Object,r=this.getBlockByValueName(e,"GAME_OBJECT"),a=this.parseBlock(r).data.value;return l.type="TEXT",t.forEach((e=>{e.obj_id==a&&(l.value=e.res_name)})),l},Logic.prototype.items_get_by_name=function(e,t){let l=new Object,r=this.getBlockByValueName(e,"NAME"),a=this.parseBlock(r).data.value;return l.type="TEXT",t.forEach((e=>{e.res_name==a&&(l.value=e.obj_id)})),l},Logic.prototype.items_is_video_playing=function(e){let t=new Object,l=this.getBlockByValueName(e,"VIDEO"),r=this.parseBlock(l).data.value,a=document.getElementById(r);a=document.getElementById(r);let n=document.querySelector("video");if(a)return t.type="BOOL",t.value=!n.paused,t},Logic.prototype.parse_data_block=function(e,t){let l=e.getAttribute("type"),r=new Object;switch(l){case"data_boolean":r.data=this.data_boolean(e);break;case"data_number":r.data=this.data_number(e);break;case"data_angle":r.data=this.data_angle(e);break;case"data_constant":r.data=this.data_constant(e);break;case"data_colour_random":r.data=this.data_colour_random(e);break;case"data_colour_of":r.data=this.data_colour_of(e);break;case"data_colour_picker":r.data=this.data_colour_picker(e);break;case"data_colour_rgb":r.data=this.data_colour_rgb(e);break;case"data_colour_blend":r.data=this.data_colour_blend(e);break;case"data_text":r.data=this.data_text(e);break;case"data_text_join":r.data=this.data_text_join(e);break;case"data_vector3":r.data=this.data_vector3(e);break;case"data_get_axis_from_vector3":r.data=this.data_get_axis_from_vector3(e);break;case"data_length":r.data=this.data_length(e);break;case"data_lists_create_empty":r.data=this.data_lists_create_empty(e);break;case"data_lists_create_list":this.data_lists_create_list(e);break;case"data_lists_create_with":r.data=this.data_lists_create_with(e);break;case"data_lists_add":this.data_lists_add(e);break;case"data_lists_insert_by_index":this.data_lists_insert_by_index(e);break;case"data_lists_delete_by_index":this.data_lists_delete_by_index(e);break;case"data_lists_replace_by_index":this.data_lists_replace_by_index(e);break;case"data_lists_get_by_index":r.data=this.data_lists_get_by_index(e);break;case"data_lists_pop_by_index":r.data=this.data_lists_pop_by_index(e);break;case"data_lists_index":r.data=this.data_lists_index(e);break;case"data_lists_contains":r.data=this.data_lists_contains(e)}return e.children>0&&("next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()),r},Logic.prototype.data_boolean=function(e){let t=new Object;return"TRUE"==e.children[0].textContent?t.value=!0:"FALSE"==e.children[0].textContent&&(t.value=!1),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_number=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_angle=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_constant=function(e){let t=this.getContentByFieldName(e,"CONSTANT");if(null==t)return;let l=new Object;switch(l.type="NUM",t){case"PI":l.value=Math.PI;break;case"E":l.value=Math.E;break;case"GOLDEN_RATIO":l.value=(1+Math.sqrt(5))/2;break;case"SQRT2":l.value=Math.sqrt(2);break;case"SQRT1_2":l.value=Math.sqrt(.5);break;case"INFINITY":l.value=1/0}return l},Logic.prototype.data_colour_random=function(e){let t=new THREE.Color(Math.random(),Math.random(),Math.random()),l=new Object;return l.value="#"+t.getHexString().toUpperCase(),l.type="COLOUR",l},Logic.prototype.data_colour_of=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let r=document.getElementById(t);if(null==r)return;let a=10*parseFloat(l[0])+parseFloat(l[1]),n=10*parseFloat(l[2])+parseFloat(l[3]),o=-1,i=-1;if(r.object3D.children.length>0&&r.object3D.children[0].ModelJson&&r.object3D.children[0].ModelJson.meshes&&r.object3D.children[0].ModelJson.materials&&r.object3D.children[0].ModelJson.nodes){let e=r.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,a==t){o=e[l].mesh,console.log("data.js: _data_colour_of: get nodeMeshIndex ",e[l]);break}if(console.log("data.js: _data_colour_of: meshIndex = ",o),o>=0){let e=r.object3D.children[0].ModelJson.meshes[o];if(console.log("data.js: _data_colour_of: get meshData ",o,e),e&&e.primitives){let t=e.primitives[n];Number.isInteger(t.material)&&(i=t.material,console.log("data.js: _data_colour_of: materialIndex=",i))}}}let c=new Object;if(c.type="COLOUR",i>=0){let e;r.object3D.traverse((function(t){if(t.isMesh){let l=t.material.name.split("_");l[l.length-1]==i&&(e=t.material,console.log("action.js: _data_colour_of: child.material =",t.material))}})),c.value="#"+e.color.getHexString().toUpperCase(),console.log("action.js: _data_colour_of: get material success color =",c.value)}else c.value="#C8C8C8",console.log("action.js: _data_colour_of: get material fail color =",c.value);return c},Logic.prototype.data_colour_picker=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_rgb=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_blend=function(e){let t=this.getBlockByValueName(e,"COLOUR1");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"COLOUR"!=l.type)return;let r=this.getBlockByValueName(e,"COLOUR2");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"TEXT"!=a.type&&"COLOUR"!=a.type)return;let n=this.getBlockByValueName(e,"RATIO");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=Math.min(100,Math.max(0,o.value))/100;console.log(i);let c=new THREE.Color(l.value),s=new THREE.Color(a.value);console.log(c),console.log(s);let u=c.lerp(s,i);console.log(u);let d=new Object;return d.value="#"+u.getHexString().toUpperCase(),d.type="COLOUR",d},Logic.prototype.data_text=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_text_join=function(e){let t=parseInt(e.children[0].getAttribute("items")),l=new Object;l.value="",l.type="TEXT";for(let r=0;r<t;r++){let t=this.getBlockByValueName(e,"ADD"+r);if(t){let e=this.parseBlock(t).data;l.value+=this.toString(e)}}return l},Logic.prototype.data_vector3=function(e){let t=new Object;if("X"!=e.children[0].getAttribute("name"))return null;let l=this.parseBlock(e.children[0].children[0]).data;if(null==l||"NUM"!=l.type)return null;if("Y"!=e.children[1].getAttribute("name"))return null;let r=this.parseBlock(e.children[1].children[0]).data;if(null==r||"NUM"!=r.type)return null;if("Z"!=e.children[2].getAttribute("name"))return null;let a=this.parseBlock(e.children[2].children[0]).data;return null==a||"NUM"!=a.type?null:(t.value=new THREE.Vector3(l.value,r.value,a.value),t.type="VEC3",t)},Logic.prototype.data_get_axis_from_vector3=function(e){let t=this.getContentByFieldName(e,"AXIS");if(null==t)return;let l=this.getBlockByValueName(e,"POSITION");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"VEC3"!=r.type)return;let a=new Object;switch(a.type="NUM",t){case"X":a.value=r.value.x;break;case"Y":a.value=r.value.y;break;case"Z":a.value=r.value.z}return a},Logic.prototype.data_length=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"LIST"!=l.type)return;let r=new Object;return r.value=l.value.length,r.type="NUM",r},Logic.prototype.data_lists_create_empty=function(e){let t=new Object;return t.value=[],t.type="LIST",t},Logic.prototype.data_lists_create_list=function(e){let t,l=this.getContentByFieldName(e,"VAR");if(null==l)return;this.variableList.forEach((e=>{e.name==l&&(t=e)}));let r=new Object;r.value=[],r.type="LIST",t.data=r},Logic.prototype.data_lists_create_with=function(e){let t=new Object;t.value=[],t.type="LIST";let l=parseInt(e.children[0].getAttribute("items")),r=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"ADD"+t);l&&r.push(l)}for(let e=0;e<r.length;e++){let l=this.parseBlock(r[e]).data;if(l){let e=new Object;e.value=l.value,e.type=l.type,t.value.push(e)}}return t},Logic.prototype.data_lists_add=function(e){let t=this.getBlockByValueName(e,"ITEM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"LIST"!=a.type)return;let n=new Object;n.value=l.value,n.type=l.type,a.value.push(n)},Logic.prototype.data_lists_insert_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let r=this.getBlockByValueName(e,"INDEX");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=this.getBlockByValueName(e,"VALUE");if(null==n)return;let o=this.parseBlock(n).data;if(null!=o&&"LIST"==o.type&&a.value>=0&&a.value<=o.value.length){let e=new Object;e.value=l.value,e.type=l.type,o.value.splice(a.value,0,e)}},Logic.prototype.data_lists_delete_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let a=this.parseBlock(r).data;null!=a&&"LIST"==a.type&&l.value>=0&&l.value<a.value.length&&a.value.splice(l.value,1)},Logic.prototype.data_lists_replace_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let r=this.getBlockByValueName(e,"INDEX");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"NUM"!=a.type)return;let n=this.getBlockByValueName(e,"VALUE");if(null==n)return;let o=this.parseBlock(n).data;if(null!=o&&"LIST"==o.type&&a.value>=0&&a.value<o.value.length){let e=new Object;e.value=l.value,e.type=l.type,o.value.splice(a.value,1,e)}},Logic.prototype.data_lists_get_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"LIST"!=a.type)return;let n=new Object;return l.value>=0&&l.value<a.value.length&&(n=a.value[l.value]),n},Logic.prototype.data_lists_pop_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"LIST"!=a.type)return;let n=new Object;return l.value>=0&&l.value<a.value.length&&(n=a.value[l.value],a.value.splice(l.value,1)),n},Logic.prototype.data_lists_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"LIST"!=a.type)return;let n=[];a.value.forEach((e=>{n.push(e.value)}));let o=new Object;return o.type="NUM",o.value=n.indexOf(l.value),o},Logic.prototype.data_lists_contains=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let a=this.parseBlock(r).data;if(null==a||"LIST"!=a.type)return;let n=[];a.value.forEach((e=>{n.push(e.value)}));let o=new Object;o.type="BOOL";let i=n.indexOf(l.value);return o.value=-1!=i,o},Logic.prototype.parse_variables_block=function(e,t){let l=e.getAttribute("type"),r=new Object;switch(l){case"variables_set":r.data=this.variables_set(e,t);break;case"variables_get":r.data=this.variables_get(e)}return r},Logic.prototype.variables_set=function(e,t){let l=new Object,r=this.getContentByFieldName(e,"VAR");if(null==r)return;let a=this.getBlockByValueName(e,"VALUE");return null!=a?(this.variableList.forEach((e=>{e.name==r&&(e.data=this.parseBlock(a).data,l=e.data)})),"next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),l):void 0},Logic.prototype.variables_get=function(e){let t=new Object;return this.variableList.forEach((l=>{l.name==e.children[0].textContent&&(t=l.data)})),t},Logic.prototype.parse_events_block=function(e,t){let l=e.getAttribute("type"),r=new Object;switch(l){case"events_on_click":r.data=this.events_on_click(e);break;case"events_on_collide":r.data=this.events_on_collide(e)}return t&&t(),r},Logic.prototype.events_on_click=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"DO");if(null==a)return;let n=document.getElementById(r.value);if(null!=n&&n.object3D.el){if(n.object3D.el.onclickBlock){let e=!1;if(n.object3D.el.onclickBlock.forEach((t=>{t!=a||(e=!0)})),1==e)return;n.object3D.el.onclickBlock.push(a),n.object3D.el.onclickBlockState.push(!0)}else n.object3D.el.onclickBlock=[],n.object3D.el.onclickBlockState=[],n.object3D.el.onclickBlock.push(a),n.object3D.el.onclickBlockState.push(!0);t.onclickObjectDict[e.id]=[n.object3D.el.onclickBlock,n.object3D.el.onclickBlockState]}},Logic.prototype.events_on_collide=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==l)return;let r=this.parseBlock(l).data;if(null==r||"TEXT"!=r.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let o=t.getBlockByValueName(e,"DO0");if(null==o)return;let i=document.getElementById(r.value),c=document.getElementById(n.value);if(null==i||null==c)return;let s=(new THREE.Box3).setFromObjectWithoutChildren(i.object3D),u=(new THREE.Box3).setFromObjectWithoutChildren(c.object3D),d=s.intersectsBox(u),h=!0,p=window.setInterval((function(){if(s=(new THREE.Box3).setFromObjectWithoutChildren(i.object3D),u=(new THREE.Box3).setFromObjectWithoutChildren(c.object3D),h&&0==d&&1==s.intersectsBox(u)){d=!0,h=!1;let e=t.checkObjectWorldVisible(i),l=t.checkObjectWorldVisible(c);1==e&&1==l?t.parseBlock(o,(function(){h=!0,console.log("collide canDo",d,h)})):(h=!0,console.log("collide: AB Not visible canDo",d,e,l))}else 1==d&&0==s.intersectsBox(u)&&(d=!1)}),1);t.intervalList.push(p)},Logic.prototype.parse_debug_block=function(e,t){let l=e.getAttribute("type"),r=new Object;switch(l){case"debug_print":this.debug_print(e);break;case"debug_comment":this.debug_comment()}return"next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),r},Logic.prototype.toString=function(e){let t=this,l="";return"LIST"==e.type?e.value.forEach((e=>{l+=t.toString(e)})):"VEC3"==e.type?(value=e.value.x.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.y.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.z.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):"NUM"==e.type?(value=e.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):l+=e.value,l},Logic.prototype.debug_print=function(e){let t=this.parseBlock(e.children[0].children[0]).data;null!=t&&console.log(this.toString(t),t)},Logic.prototype.debug_comment=function(){};