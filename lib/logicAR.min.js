class Logic{constructor(){this.xmlDoc=null,this.variableList=[],this.timelineDict={},this.intervalList=[],this.onclickObjectDict={},this.logicSystemState=-1}loadXMLtoDoc(e){let t=this;return new Promise((function(l){let a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(e){if(4===a.readyState)if(200===a.status){let e=(new DOMParser).parseFromString(a.responseText,"text/xml");t.xmlDoc=e,console.log("logicSystem.js: _loadXMLtoDoc: xmlDoc = ",t.xmlDoc),l(t)}else console.error(a.statusText)},a.onerror=function(e){console.error(a.statusText)},a.send(null)}))}parseXML(){let e=this;if(e.logicSystemState=1,console.log("logicSystem.js: _parseXML",this),this.xmlDoc&&"xml"==this.xmlDoc.children[0].tagName){let t=this.xmlDoc.children[0];if("variables"==t.children[0].tagName){let e=t.children[0];e.children.length>0&&this.registLogicVariables(e.children)}let l=[];if(t.children.length>1)for(let e=1;e<t.children.length;e++)l[e]=this.parseBlock(t.children[e]);e.logicSystemState=2,console.log("logicSystem.js: _parseXML: _blockRetList=",l)}}stopLogic=function(){let e=this,t=Object.values(e.timelineDict);t.forEach((e=>{e.pause()})),t.forEach((e=>{e.kill()})),e.timelineDict={},Object.values(e.onclickObjectDict).forEach((e=>{e.forEach((e=>{e.length=0}))})),e.onclickObjectDict={},e.intervalList.forEach((e=>{clearInterval(e)})),e.intervalList.length=0,e.variableList.length=0,e.logicSystemState=0,console.log("logicSystem.js: _stopLogic: done")};registLogicVariables=function(e){for(let t=0;t<e.length;t++){let l=new Object;l.name=e[t].textContent,l.data=null,this.variableList.push(l)}console.log(this.variableList)};getContentByFieldName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].textContent;return null};getBlockByValueName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].children[0];return null};parseBlock=function(e,t=null){let l;switch(e.getAttribute("type").split("_")[0]){case"transform":l=this.parse_transform_block(e,t);break;case"actions":l=this.parse_actions_block(e,t);break;case"controls":l=this.parse_controls_block(e,t);break;case"operators":l=this.parse_operators_block(e);break;case"data":l=this.parse_data_block(e,t);break;case"items":l=this.parse_items_block(e);break;case"events":l=this.parse_events_block(e,t);break;case"variables":l=this.parse_variables_block(e,t);break;case"debug":l=this.parse_debug_block(e,t)}return l};clear=function(){this.xmlDoc=null,this.variableList.length=0};checkObjectWorldVisible=function(e){let t=!0;if(0==e.object3D.visible)console.log("logicSystem.js: _checkObjectWorldVisible: target visible false",e.object3D),t=!1;else{let l=!0;e.object3D.traverseAncestors((function(a){"Scene"!=a.type?(console.log("logicSystem.js: _checkObjectWorldVisible: traverseAncestors: not Scene parent=",a),0==a.visible&&(l=!1)):1==l&&1==e.object3D.visible?(console.log("logicSystem.js: _checkObjectWorldVisible: traverseAncestors: all parent visible true=",e.object3D),t=!0):(console.log("logicSystem.js: _checkObjectWorldVisible: traverseAncestors: not all parent visible true=",e.object3D),t=!1)}))}return console.log("logicSystem.js: _checkObjectWorldVisible: worldVisible=",t),t}}function roundFloat(e,t=2){let l=10**t;return Math.round(e*l)/l}Logic.prototype.parse_transform_block=function(e,t){let l=this,a=e.getAttribute("type"),r=new Object;switch(a){case"transform_move_in_second":r.tl=l.transform_move_in_second(e);break;case"transform_move_target_in_second":r.tl=l.transform_move_target_in_second(e);break;case"transform_rotate_in_second":r.tl=l.transform_rotate_in_second(e);break;case"transform_rotate_with_radius_in_second":r.tl=l.transform_rotate_with_radius_in_second(e);break;case"transform_rotate_with_radius_in_second_forever":r.tl=l.transform_rotate_with_radius_in_second_forever(e);break;case"transform_rotate_with_axis_in_second":r.tl=l.transform_rotate_with_axis_in_second(e);break;case"transform_rotate_from_origin_with_axis_in_second":r.tl=l.transform_rotate_from_origin_with_axis_in_second(e);break;case"transform_scale_by_in_second":r.tl=l.transform_scale_by_in_second(e);break;case"transform_set_position":r.tl=l.transform_set_position(e);break;case"transform_get_position":r.data=l.transform_get_position(e);break;case"transform_get_distance":r.data=l.transform_get_distance(e);break;case"transform_set_rotation":r.tl=l.transform_set_rotation(e);break;case"transform_to_look_at_gameobject":r.tl=l.transform_to_look_at_gameobject(e);break;case"transform_to_look_at":r.tl=l.transform_to_look_at(e);break;case"transform_get_rotation":r.data=l.transform_get_rotation(e);break;case"transform_get_rotation_in_space":r.data=l.transform_get_rotation_in_space(e);break;case"transform_get_scale":r.data=l.transform_get_scale(e);break;case"transform_get_scale_in_space":r.data=l.transform_get_scale_in_space(e);break;case"transform_get_scale_axis_in_space":r.data=l.transform_get_scale_axis_in_space(e);break;case"transform_set_scale":r.tl=l.transform_set_scale(e);break;case"transform_set_scale_by_axis":r.tl=l.transform_set_scale_by_axis(e)}return"next"==e.children[e.children.length-1].tagName?r.tl?r.tl.eventCallback("onComplete",(function(){l.parseBlock(e.children[e.children.length-1].children[0],t)})):l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(r.tl?r.tl.eventCallback("onComplete",(function(){t()})):t()),r},Logic.prototype.transform_move_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=this.getBlockByValueName(e,"METER");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"NUM"!=n.type)return;let o=this.getBlockByValueName(e,"SECOND");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"NUM"!=i.type)return;let c=document.getElementById(a.value);if(null==c)return;let s=c.object3D.position.clone(),u=new THREE.Vector3;switch(t){case"FORWARD":u.set(0,0,1);break;case"BACKWARD":u.set(0,0,-1);break;case"RIGHT":u.set(-1,0,0);break;case"LEFT":u.set(1,0,0);break;case"UP":u.set(0,1,0);break;case"DOWN":u.set(0,-1,0)}u=u.applyEuler(c.object3D.rotation),u.multiplyScalar(n.value);let d=96;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(d=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),c.object3D.obj_parent_id){let e=u.y;u.y=-e,u.multiplyScalar(-2540/d)}else{let e=u.z;u.z=-e,u.multiplyScalar(-5080/d)}s.add(u);let h=gsap.timeline();return this.timelineDict[e.id]=h,h.to(c.object3D.position,{duration:i.value,delay:0,ease:"none",x:s.x,y:s.y,z:s.z}),h},Logic.prototype.transform_move_target_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"VEC3"!=r.type)return;let n=this.getBlockByValueName(e,"SECOND");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=document.getElementById(l.value);if(null==i)return;let c=96,s=512,u=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(c=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],s=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],u=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),i.object3D.obj_parent_id){let e=r.value.z;r.value.z=-e,r.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(2540/c))}else{let e=r.value.y,t=r.value.z;r.value.y=t,r.value.z=e,r.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(5080/c)).add(new THREE.Vector3(25.4*s/c/2,25.4*u/c/2,0))}let d=gsap.timeline();return this.timelineDict[e.id]=d,d.to(i.object3D.position,{duration:o.value,delay:0,ease:"none",x:r.value.x,y:r.value.y,z:r.value.z}),d},Logic.prototype.transform_rotate_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=this.getBlockByValueName(e,"DEGREE");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"DEGREE"!=n.type)return;let o=this.getBlockByValueName(e,"SECOND");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"NUM"!=i.type)return;let c=document.getElementById(a.value);if(null==c)return;let s=c.object3D.rotation.clone();switch(t){case"CLOCKWISE":s.y-=Math.PI*n.value/180;break;case"COUNTERCLOCKWISE":s.y+=Math.PI*n.value/180}let u=gsap.timeline();return this.timelineDict[e.id]=u,u.to(c.object3D.rotation,{duration:i.value,delay:0,ease:"none",y:s.y}),u},Logic.prototype.rotateAboutPoint=function(e,t,l,a,r){(r=void 0!==r&&r)&&e.parent.localToWorld(e.position),e.position.sub(t),e.position.applyAxisAngle(l,a),e.position.add(t),r&&e.parent.worldToLocal(e.position),e.rotateOnWorldAxis(l,a)},Logic.prototype.transform_rotate_with_radius_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getBlockByValueName(e,"GAME_OBJECT");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=this.getBlockByValueName(e,"DEGREE");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"DEGREE"!=o.type)return;let i=this.getBlockByValueName(e,"RADIUS");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"NUM"!=c.type)return;c.value<0&&(c.value=0);let s=this.getBlockByValueName(e,"SECOND");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"NUM"!=u.type)return;let d=document.getElementById(r.value);if(null==d)return;let h=96;arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(h=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),d.object3D.obj_parent_id?c.value*=2540/h:c.value*=5080/h;let p=new THREE.Vector3(0,0,-1).applyEuler(d.object3D.rotation),_=d.object3D.up.clone().applyEuler(d.object3D.rotation),g=d.object3D.position.clone().add(p.multiplyScalar(c.value));switch(l){case"CLOCKWISE":o.value=-o.value;break;case"COUNTERCLOCKWISE":o.value=o.value}let m=gsap.timeline();t.timelineDict[e.id]=m;let y=0;return d.object3D.roundTheta=0,m.to(d.object3D,{duration:u.value,delay:0,ease:"none",roundTheta:o.value,onUpdate:function(){t.rotateAboutPoint(d.object3D,g,_,(d.object3D.roundTheta-y)/180*Math.PI),y=d.object3D.roundTheta}}),m},Logic.prototype.transform_rotate_with_radius_in_second_forever=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getBlockByValueName(e,"GAME_OBJECT");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=this.getBlockByValueName(e,"RADIUS");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;o.value<0&&(o.value=0);let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"NUM"!=c.type)return;let s=document.getElementById(r.value);if(null==s)return;let u=96;arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(u=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),s.object3D.obj_parent_id?o.value*=2540/u:o.value*=5080/u;let d,h=new THREE.Vector3(0,0,-1).applyEuler(s.object3D.rotation),p=s.object3D.up.clone().applyEuler(s.object3D.rotation),_=s.object3D.position.clone().add(h.multiplyScalar(o.value));switch(l){case"CLOCKWISE":d=-360;break;case"COUNTERCLOCKWISE":d=360}let g=gsap.timeline();t.timelineDict[e.id]=g;let m=0;return s.object3D.loopTheta=0,g.to(s.object3D,{repeat:-1,duration:c.value,delay:0,ease:"none",loopTheta:d,onUpdate:function(){t.rotateAboutPoint(s.object3D,_,p,(s.object3D.loopTheta-m)/180*Math.PI),m=s.object3D.loopTheta}}),g},Logic.prototype.transform_rotate_with_axis_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=this.getBlockByValueName(e,"ROTATION");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"VEC3"!=n.type)return;let o=this.getBlockByValueName(e,"DEGREE");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"DEGREE"!=i.type)return;let c=this.getBlockByValueName(e,"SECOND");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=document.getElementById(a.value);if(null==u)return;switch(u.object3D.obj_parent_id,n.value.z=-n.value.z,n.value.normalize(),t){case"CLOCKWISE":i.value=-i.value;break;case"COUNTERCLOCKWISE":i.value=i.value}let d=gsap.timeline();this.timelineDict[e.id]=d;let h=0;return u.object3D.axisTheta=0,d.to(u.object3D,{duration:s.value,delay:0,ease:"none",axisTheta:i.value,onUpdate:function(){u.object3D.rotateOnAxis(n.value,(u.object3D.axisTheta-h)/180*Math.PI),h=u.object3D.axisTheta}}),d},Logic.prototype.transform_rotate_from_origin_with_axis_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getContentByFieldName(e,"ORIGIN_SPACE");if(null==a)return;let r=this.getContentByFieldName(e,"AXIS_SPACE");if(null==r)return;let n=this.getBlockByValueName(e,"GAME_OBJECT");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"TEXT"!=o.type)return;let i=this.getBlockByValueName(e,"ORIGIN");if(null==i)return;let c=this.parseBlock(i).data;if(null==c||"VEC3"!=c.type)return;let s=this.getBlockByValueName(e,"AXIS");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"VEC3"!=u.type)return;let d=this.getBlockByValueName(e,"DEGREE");if(null==d)return;let h=this.parseBlock(d).data;if(null==h||"DEGREE"!=h.type)return;let p=this.getBlockByValueName(e,"SECOND");if(null==p)return;let _=this.parseBlock(p).data;if(null==_||"NUM"!=_.type)return;let g=document.getElementById(o.value);if(null==g)return;switch(l){case"CLOCKWISE":h.value=-h.value;break;case"COUNTERCLOCKWISE":h.value=h.value}let m=96,y=512,f=512;switch(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(m=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],y=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],f=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),a){case"SPACE_LOCAL":g.object3D.obj_parent_id?c.value.multiply(new THREE.Vector3(1,1,-1)).multiplyScalar(2540/m):c.value.multiply(new THREE.Vector3(1,1,-1)).multiplyScalar(5080/m),c.value=c.value.applyMatrix4(g.object3D.matrix);break;case"SPACE_GLOBAL":let e;if(g.object3D.traverseAncestors((function(t){t.targetRoot&&(e=t)})),e){let t=e.matrix.clone(),l=g.object3D.matrix.clone(),a=c.value.y,r=c.value.z;c.value.y=r,c.value.z=a,c.value.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*y/m/2,25.4*f/m/2,0)).applyMatrix4(t),c.value=g.object3D.worldToLocal(c.value).applyMatrix4(l)}}switch(r){case"SPACE_LOCAL":u.value.multiply(new THREE.Vector3(1,1,-1)),u.value.normalize(),u.value=u.value.applyEuler(g.object3D.rotation);break;case"SPACE_GLOBAL":let e;if(g.object3D.traverseAncestors((function(t){t.targetRoot&&(e=t)})),e){let t=e.matrix.clone(),l=g.object3D.matrix.clone(),a=u.value.clone(),r=a.y,n=a.z;a.y=n,a.z=r,a=g.object3D.worldToLocal(a.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*y/m/2,25.4*f/m/2,0)).applyMatrix4(t)).applyMatrix4(l);let o=new THREE.Vector3(0,0,0);o=g.object3D.worldToLocal(o.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*y/m/2,25.4*f/m/2,0)).applyMatrix4(t)).applyMatrix4(l);let i=(new THREE.Vector3).subVectors(a,o).normalize();u.value=i}}let B=gsap.timeline();t.timelineDict[e.id]=B;let b=0;return g.object3D.Theta=0,B.to(g.object3D,{duration:_.value,delay:0,ease:"none",Theta:h.value,onUpdate:function(){t.rotateAboutPoint(g.object3D,c.value,u.value,(g.object3D.Theta-b)/180*Math.PI),b=g.object3D.Theta}}),B},Logic.prototype.transform_scale_by_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"SCALE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=this.getBlockByValueName(e,"SECOND");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=document.getElementById(l.value);if(null==i)return;let c=i.object3D.scale.clone();c.multiplyScalar(r.value);let s=gsap.timeline();return this.timelineDict[e.id]=s,s.to(i.object3D.scale,{duration:o.value,delay:0,ease:"none",x:c.x,y:c.y,z:c.z}),s},Logic.prototype.transform_set_position=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"VEC3"!=r.type)return;let n=document.getElementById(l.value);if(null==n)return;let o=96,i=512,c=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(o=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],i=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],c=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),n.object3D.obj_parent_id){let e=r.value.z;r.value.z=-e,r.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(2540/o))}else{let e=r.value.y,t=r.value.z;r.value.y=t,r.value.z=e,r.value.multiply(new THREE.Vector3(1,1,1).multiplyScalar(5080/o)).add(new THREE.Vector3(25.4*i/o/2,25.4*c/o/2,0))}let s=gsap.timeline();return s.to(n.object3D.position,{duration:.01,delay:0,ease:"none",x:r.value.x,y:r.value.y,z:r.value.z}),s},Logic.prototype.transform_get_position=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=document.getElementById(a.value);if(null==r)return;let n=new Object;n.type="VEC3";let o=96,i=512,c=512;switch(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(o=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],i=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],c=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),t){case"SPACE_GLOBAL":n.value=r.object3D.getWorldPosition().clone();let e,t=r.object3D.getWorldPosition().clone();if(r.object3D.traverseAncestors((function(t){t.targetRoot&&(e=t)})),e){let l=e.matrix.clone(),a=(new THREE.Matrix4).getInverse(l),r=t.clone().applyMatrix4(a);r.add(new THREE.Vector3(25.4*-i/o/2,25.4*-c/o/2,0)).multiplyScalar(o/5080);let s=r.y,u=r.z;r.y=u,r.z=s,n.value=r.clone()}break;case"SPACE_LOCAL":let l=r.object3D.position.clone();if(r.object3D.obj_parent_id){l.multiplyScalar(o/2540);let e=l.z;l.z=-e}else{l.add(new THREE.Vector3(25.4*-i/o/2,25.4*-c/o/2,0)).multiplyScalar(o/5080);let e=l.y,t=l.z;l.y=t,l.z=e}n.value=l.clone()}return n.value.x=Math.round(1e4*n.value.x)/1e4,n.value.y=Math.round(1e4*n.value.y)/1e4,n.value.z=Math.round(1e4*n.value.z)/1e4,n},Logic.prototype.transform_get_distance=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=document.getElementById(l.value);if(null==n)return;let o=new THREE.Vector3;n.object3D.getWorldPosition(o);let i=document.getElementById(r.value);if(null==i)return;let c=new THREE.Vector3;i.object3D.getWorldPosition(c);let s=new Object;s.type="NUM",s.value=o.distanceTo(c);let u=96;return arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(u=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),s.value=Math.round(s.value/(5080/u)*1e4)/1e4,s},Logic.prototype.transform_set_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"ROTATION");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"VEC3"!=r.type)return;let n=document.getElementById(l.value);if(null==n)return;if(n.object3D.obj_parent_id)r.value.multiply(new THREE.Vector3(-1,-1,1));else{let e=r.value.x,t=r.value.y,l=r.value.z;r.value.x=90-e,r.value.y=-t,r.value.z=l}let o=gsap.timeline();return o.to(n.object3D.rotation,{duration:.01,delay:0,ease:"none",x:r.value.x/180*Math.PI,y:r.value.y/180*Math.PI,z:r.value.z/180*Math.PI}),o},Logic.prototype.transform_to_look_at_gameobject=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=document.getElementById(l.value);if(null==n)return;let o=document.getElementById(r.value);if(null==o)return;let i=new THREE.Vector3;o.object3D.getWorldPosition(i);let c=gsap.timeline();return c.to(n.object3D,{duration:.01,delay:0,ease:"none",onStart:function(){n.object3D.lookAt(i),n.object3D.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI)}}),c},Logic.prototype.transform_to_look_at=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"VEC3"!=r.type)return;let n=document.getElementById(l.value);if(null==n)return;let o,i=96,c=512,s=512;if(arController.gcssTargets&&Array.isArray(arController.gcssTargets.dpi)&&Number(arController.currentProjectIndex)>-1&&Number(arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID)>-1&&arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]&&(i=arController.gcssTargets.dpi[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],c=arController.gcssTargets.width[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID],s=arController.gcssTargets.height[arController.aframeNFTMarkers[arController.currentProjectIndex].GCSSID]),n.object3D.traverseAncestors((function(e){e.targetRoot&&(o=e)})),o){let e=o.matrix.clone(),t=r.value.clone(),l=t.y,a=t.z;t.y=a,t.z=l,t.multiplyScalar(5080/96).add(new THREE.Vector3(25.4*c/i/2,25.4*s/i/2,0)).applyMatrix4(e),r.value=t}let u=gsap.timeline();return u.to(gsapEmpty,{duration:.01,delay:0,ease:"none",onStart:function(){n.object3D.lookAt(r.value),n.object3D.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI)}}),u},Logic.prototype.transform_get_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;let r=new Object;return r.type="VEC3",r.value=a.object3D.rotation.clone(),r.value.x=r.value.x/Math.PI*180,r.value.y=-r.value.y/Math.PI*180,r.value.z=-r.value.z/Math.PI*180,r},Logic.prototype.transform_get_rotation_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=document.getElementById(a.value);if(null==r)return;let n=new Object;switch(n.type="VEC3",t){case"SPACE_GLOBAL":let e=new THREE.Quaternion;r.object3D.getWorldQuaternion(e);let t,l=new THREE.Euler;l.setFromQuaternion(e,"YXZ"),n.value=l;let a,o=r.object3D.matrix.clone();if(r.object3D.traverseAncestors((function(e){e.targetRoot?(t=e,a=o.clone()):o=e.matrix.clone().multiply(o)})),t){let e=a.clone(),t=new THREE.Quaternion,l=new THREE.Vector3,r=new THREE.Vector3;e.clone().decompose(l,t,r);let o=new THREE.Euler;o.setFromQuaternion(t);let i=o.x,c=o.y;n.value=new THREE.Euler,n.value.x=i-90*Math.PI/180,n.value.y=c,n.value.z=o.z}break;case"SPACE_LOCAL":r.object3D.obj_parent_id?n.value=r.object3D.rotation.clone():(n.value=r.object3D.rotation.clone(),n.value.x-=90*Math.PI/180)}return n.value.x=Math.round(n.value.x/Math.PI*180*1e4)/1e4,n.value.y=Math.round(-n.value.y/Math.PI*180*1e4)/1e4,n.value.z=Math.round(-n.value.z/Math.PI*180*1e4)/1e4,n},Logic.prototype.transform_get_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;let r=new Object;return r.type="NUM",r.value=a.object3D.scale.clone().x,a.object3D.obj_parent_id?r.value=Math.round(1e4*a.object3D.scale.clone().x)/1e4:r.value=Math.round(a.object3D.scale.clone().x/2*1e4)/1e4,r},Logic.prototype.transform_get_scale_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=document.getElementById(a.value);if(null==r)return;let n=new Object,o=new THREE.Vector3;switch(n.type="NUM",t){case"SPACE_GLOBAL":r.object3D.getWorldScale(o),n.value=Math.round(o.x/2*1e4)/1e4;break;case"SPACE_LOCAL":r.object3D.obj_parent_id?n.value=Math.round(r.object3D.scale.clone().x/1*1e4)/1e4:n.value=Math.round(r.object3D.scale.clone().x/2*1e4)/1e4}return n},Logic.prototype.transform_get_scale_axis_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=document.getElementById(a.value);if(null==r)return;let n=new Object;switch(n.value=new THREE.Vector3,n.type="VEC3",t){case"SPACE_GLOBAL":let e=r.object3D.getWorldScale(n.value);e.x=Math.round(1e4*e.x)/1e4,e.y=Math.round(1e4*e.y)/1e4,e.z=Math.round(1e4*e.z)/1e4,n.value=e.clone();break;case"SPACE_LOCAL":let t=r.object3D.scale.clone();t.x=Math.round(1e4*t.x)/1e4,t.y=Math.round(1e4*t.y)/1e4,t.z=Math.round(1e4*t.z)/1e4,r.object3D.obj_parent_id||t.multiplyScalar(.5),n.value=t.clone()}return n},Logic.prototype.transform_set_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"SCALE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=document.getElementById(l.value);if(null==n)return;r.value*=2;let o=gsap.timeline();return o.to(n.object3D.scale,{duration:.01,delay:0,ease:"none",x:r.value,y:r.value,z:r.value}),o},Logic.prototype.transform_set_scale_by_axis=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"AXIS");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"VEC3"!=r.type)return;r.value.multiplyScalar(2);let n=document.getElementById(l.value);if(null==n)return;let o=gsap.timeline();return o.to(n.object3D.scale,{duration:.01,delay:0,ease:"none",x:r.value.x,y:r.value.y,z:r.value.z}),o},Logic.prototype.parse_actions_block=function(e,t){let l=this,a=e.getAttribute("type"),r=new Object,n=null;switch(a){case"actions_set_color":l.actions_set_color(e);break;case"actions_set_visibility":l.actions_set_visibility(e);break;case"actions_set_opacity":l.actions_set_opacity(e);break;case"actions_set_animation":l.actions_set_animation(e);break;case"actions_set_animation_by_id":l.actions_set_animation_by_id(e);break;case"actions_play_sound_until_finished":n=l.actions_play_sound_until_finished(e,t);break;case"actions_play_sound":l.actions_play_sound(e);break;case"actions_stop_sound":l.actions_stop_sound(e);break;case"actions_play_video_until_finished":n=l.actions_play_video_until_finished(e,t);break;case"actions_play_video":l.actions_play_video(e);break;case"actions_pause_video":l.actions_pause_video(e);break;case"actions_stop_video":l.actions_stop_video(e);break;case"actions_set_light_color":l.actions_set_light_color(e);break;case"actions_set_light_intensity":l.actions_set_light_intensity(e);break;case"actions_set_text":n=l.actions_set_text(e,t);break;case"actions_set_text_color":n=l.actions_set_text_color(e,t);break;case"actions_set_text_bgcolor":n=l.actions_set_text_bgcolor(e,t)}return"next"==e.children[e.children.length-1].tagName?n||l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(n||t()),r},Logic.prototype.actions_set_color=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=this.getBlockByValueName(e,"COLOUR");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type&&"COLOUR"!=r.type)return;let n=10*parseFloat(l[0])+parseFloat(l[1]),o=10*parseFloat(l[2])+parseFloat(l[3]),i=document.getElementById(t);if(null==i)return;let c=-1,s=-1;if(i.object3D.children.length>0&&i.object3D.children[0].ModelJson&&i.object3D.children[0].ModelJson.meshes&&i.object3D.children[0].ModelJson.materials&&i.object3D.children[0].ModelJson.nodes){let e=i.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,n==t){c=e[l].mesh,console.log("action.js: _actions_set_color: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_color: meshIndex = ",c),c>=0){let e=i.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_color: get meshData ",c,e),e&&e.primitives){let t=e.primitives[o];Number.isInteger(t.material)&&(s=t.material,console.log("action.js: _actions_set_color: materialIndex=",s))}}}s>=0&&i.object3D.traverse((function(e){if(e.isMesh&&e.el==i.object3D.el){let t=e.material.name.split("_");t[t.length-1]==s&&(e.material.color=new THREE.Color(r.value),console.log("action.js: _actions_set_color: child.material =",e.material))}}))},Logic.prototype.actions_set_visibility=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"BOOL");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"BOOL"!=r.type)return;let n=document.getElementById(l.value);null!=n&&(n.setAttribute("visible",r.value),n.object3D.traverse((function(e){"Group"==e.type&&e.el.getAttribute("visible")&&e.el.object3D.behav&&e.el.setAttribute("class","clickable")})))},Logic.prototype.actions_set_opacity=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=this.getBlockByValueName(e,"PERCENT");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=10*parseFloat(l[0])+parseFloat(l[1]),o=10*parseFloat(l[2])+parseFloat(l[3]),i=document.getElementById(t);if(null==i)return;let c=-1,s=-1;if(i.object3D.children.length>0&&i.object3D.children[0].ModelJson&&i.object3D.children[0].ModelJson.meshes&&i.object3D.children[0].ModelJson.materials&&i.object3D.children[0].ModelJson.nodes){let e=i.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,n==t){c=e[l].mesh,console.log("action.js: _actions_set_opacity: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_opacity: meshIndex = ",c),c>=0){let e=i.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_opacity: get meshData ",c,e),e&&e.primitives){let t=e.primitives[o];Number.isInteger(t.material)&&(s=t.material,console.log("action.js: _actions_set_opacity: materialIndex=",s))}}}s>=0&&i.object3D.traverse((function(e){if(e.isMesh){let t=e.material.name.split("_");t[t.length-1]==s&&(e.material.transparent=!0,e.material.opacity=r.value/100,console.log("action.js: _actions_set_opacity: child.material =",e.material))}}))},Logic.prototype.actions_set_animation=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let a,r=document.getElementById(t);if(null!=r)if("None"==l)r.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<r.object3D.children[0].animationSlices.length;e++)r.object3D.children[0].animationSlices[e].name==l&&(a=r.object3D.children[0].animationSlices[e]);a&&(r.setAttribute("animation-mixer","clip: "+a.animationName),r.object3D.children[0].animationSlices[0].loop=a.uid,r.object3D.children[0].animationSlices[0].uid=a.uid,r.object3D.children[0].animationSlices[0].changed=!0,r.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_set_animation_by_id=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let a=this.getContentByFieldName(e,"TIMES");if(null==a)return;let r=document.getElementById(t);var n;if(null!=r)if("None"==l)r.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<r.object3D.children[0].animationSlices.length;e++)r.object3D.children[0].animationSlices[e].uid==l&&(n=r.object3D.children[0].animationSlices[e]);r.setAttribute("animation-mixer","clip: "+n.animationName),r.object3D.children[0].animationSlices[0].uid=n.uid,r.object3D.children[0].animationSlices[0].changed=!0,"LOOP"==a&&(r.object3D.children[0].animationSlices[0].loop=n.uid,r.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_play_sound_until_finished=function(e,t){let l=this.getBlockByValueName(e,"SOUND");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=document.getElementById(a.value);if(null==r)return;let n=this;if(1==n.checkObjectWorldVisible(r)){r.setAttribute("sound","loop:false"),r.components.sound.playSound();let l=function(a){r.components.sound.stopSound(),r.removeEventListener("sound-ended",l),r.setAttribute("sound","loop:true"),"next"==e.children[e.children.length-1].tagName?n.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return r.addEventListener("sound-ended",l),!0}},Logic.prototype.actions_play_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;1==this.checkObjectWorldVisible(a)&&a.components.sound.playSound()},Logic.prototype.actions_stop_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;1==this.checkObjectWorldVisible(a)&&a.components.sound.stopSound()},Logic.prototype.actions_play_video_until_finished=function(e,t){let l=this.getBlockByValueName(e,"VIDEO");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=document.getElementById(a.value);if(null==r)return;let n=this;if(1==n.checkObjectWorldVisible(r)){let l=r.getAttribute("src");if(null!=l){l=l.split("#").pop();let a=document.getElementById(l);if(a instanceof HTMLElement){a.loop=!1,a.muted=!1,a.play();let l=function(r){a.currentTime=0,a.pause(),a.removeEventListener("ended",l),a.loop=!0,"next"==e.children[e.children.length-1].tagName?n.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return a.addEventListener("ended",l),!0}}}},Logic.prototype.actions_play_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;console.log("action.js: _actions_play_video: target ",a);if(1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.loop=!0,t.muted=!1,t.play())}}},Logic.prototype.actions_pause_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;if(1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&t.pause()}}},Logic.prototype.actions_stop_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;if(1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.currentTime=t.duration,t.loop=!1)}}},Logic.prototype.actions_set_light_color=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"COLOUR");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type&&"COLOUR"!=r.type)return;let n=document.getElementById(l.value);null!=n&&(n.object3D.children[0].color=new THREE.Color(r.value))},Logic.prototype.actions_set_light_intensity=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"PERCENT");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=document.getElementById(l.value);null!=n&&(n.object3D.children[0].intensity=r.value/100)},Logic.prototype.actions_set_text=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=this.getBlockByValueName(e,"TEXT");if(null==n)return;let o=this.parseBlock(n).data;if(null==o)return;let i=document.getElementById(r.value);if(null==i)return;let c=l.toString(o);if(i.children[0].getAttribute("value")!=c){console.log(" _actions_set_text:  ",i.children[0].object3D.children.length,i.children[0].components.text.textMesh.children.length),i.children[0].components.text.textMesh.children.length=0,i.children[0].object3D.children.length=1,i.children[0].setAttribute("value",c);let a=c.split("\n"),r=0;const n=/[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u,o=e=>n.test(e);for(let e=0;e<a.length;e++){let t=0;for(let l=0;l<a[e].length;l++)o(a[e][l])?t+=1.6:a[e][l]==a[e][l].toUpperCase()&&a[e][l]!=a[e][l].toLowerCase()||a[e][l]==a[e][l].toLowerCase()&&a[e][l]!=a[e][l].toUpperCase()?t+=1:isNaN(1*a[e][l])?t+=1.25:t+=1;t>r&&(r=t)}i.children[0].setAttribute("wrap-count",r+1);let s=function(a){i.children[0].removeEventListener("geometry-set",s),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return i.children[0].addEventListener("geometry-set",s),!0}},Logic.prototype.actions_set_text_color=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=this.getBlockByValueName(e,"COLOUR");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"TEXT"!=o.type&&"COLOUR"!=o.type)return;let i=document.getElementById(r.value);if(null!=i&&i.children[0].getAttribute("color")!=o.value){i.children[0].components.text.textMesh.children.length=0,i.children[0].object3D.children.length=1,i.children[0].setAttribute("color",o.value);let a=function(r){i.children[0].removeEventListener("geometry-set",a),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return i.children[0].addEventListener("geometry-set",a),!0}},Logic.prototype.actions_set_text_bgcolor=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type)return;let n=this.getBlockByValueName(e,"COLOUR");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"TEXT"!=o.type&&"COLOUR"!=o.type)return;let i=document.getElementById(r.value);if(null==i)return;let c=new THREE.Color(o.value),s=c.r+","+c.g+","+c.b+",1";if(i.children[0].getAttribute("backcolor")!=s){i.children[0].components.text.textMesh.children.length=0,i.children[0].object3D.children.length=1,i.children[0].setAttribute("backcolor",s);let a=function(r){i.children[0].removeEventListener("geometry-set",a),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return i.children[0].addEventListener("geometry-set",a),!0}},Logic.prototype.parse_controls_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"controls_repeat_forever":a.tl=this.controls_repeat_forever(e,t);break;case"controls_repeat":a.tl=this.controls_repeat(e,t);break;case"controls_for":a.tl=this.controls_for(e,t);break;case"controls_whileUntil":a.tl=this.controls_whileUntil(e,t);break;case"controls_forEach":a.tl=this.controls_forEach(e,t);break;case"controls_flow_statements":a.tl=this.controls_flow_statements(e,t);break;case"controls_if":a.tl=this.controls_if(e,t);break;case"controls_ifelse":a.tl=this.controls_ifelse(e,t);break;case"controls_wait_time":a.tl=this.controls_wait_time(e,t);break;case"controls_run_parallel":a.tl=this.controls_run_parallel(e,t)}return"controls_repeat_forever"!=l&&("next"==e.children[e.children.length-1].tagName?a.tl||this.parseBlock(e.children[e.children.length-1].children[0],t):t&&(a.tl||t())),a},Logic.prototype.controls_repeat_forever=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO");if(null==a)return;let r=gsap.timeline();return l.timelineDict[e.id]=r,r.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?r.restart():"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),r},Logic.prototype.controls_repeat=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO");if(null==a)return;let r=this.getBlockByValueName(e,"TIMES");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"NUM"!=n.type)return;let o=Math.max(0,n.value)-1,i=gsap.timeline();return l.timelineDict[e.id]=i,i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?o>0?(o-=1,i.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t():"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),i},Logic.prototype.controls_for=function(e,t){let l=this,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let r=this.getBlockByValueName(e,"FROM");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"NUM"!=n.type)return;let o=this.getBlockByValueName(e,"TO");if(null==o)return;let i=this.parseBlock(o).data;if(null==i||"NUM"!=i.type)return;let c=this.getBlockByValueName(e,"BY");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=this.getBlockByValueName(e,"DO");if(null==u)return;let d,h=n.value;this.variableList.forEach((e=>{e.name==a&&(d=e)}));let p=new Object;p.value=h,p.type="NUM";let _=gsap.timeline();return l.timelineDict[e.id]=_,h<=i.value&&s.value>0||h>=i.value&&s.value<0?(d.data=p,_.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(u,(function(a=null){null==a||"CONTINUE"==a?(h+=s.value,h<=i.value&&s.value>0||h>=i.value&&s.value<0?(d.data.value=h,_.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),_},Logic.prototype.controls_whileUntil=function(e,t){let l=this,a=this.getContentByFieldName(e,"MODE");if(null==a)return;let r=this.getBlockByValueName(e,"DO");if(null==r)return;let n=this.getBlockByValueName(e,"BOOL");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"BOOL"!=o.type)return;let i=gsap.timeline();return l.timelineDict[e.id]=i,"WHILE"==a&&o.value||"UNTIL"==a&&!o.value?i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(r,(function(r=null){null==r||"CONTINUE"==r?(o=l.parseBlock(n).data,"WHILE"==a&&o.value||"UNTIL"==a&&!o.value?i.restart():"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==r&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),i},Logic.prototype.controls_forEach=function(e,t){let l=this,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let r=this.getBlockByValueName(e,"LIST");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"LIST"!=n.type)return;if(n.value.length<1)return;let o=this.getBlockByValueName(e,"DO");if(null==o)return;let i,c=0;this.variableList.forEach((e=>{e.name==a&&(i=e)}));let s=new Object;s.value=n.value[c].value,s.type=n.value[c].type,i.data=s;let u=gsap.timeline();l.timelineDict[e.id]=u,u.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(o,(function(a=null){null==a||"CONTINUE"==a?(c+=1,c<n.value.length?(i.data.value=n.value[c].value,i.data.type=n.value[c].type,u.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})},Logic.prototype.controls_flow_statements=function(e,t){let l=this.getContentByFieldName(e,"FLOW");null!=l&&t&&t(l)},Logic.prototype.controls_if=function(e,t){let l=this,a=parseInt(e.children[0].getAttribute("elseif")),r=0,n=gsap.timeline();for(l.timelineDict[e.id]=n;;){let a=this.getBlockByValueName(e,"IF"+r);if(null==a)break;let o=this.parseBlock(a).data;if(null==o||"BOOL"!=o.type)break;let i=this.getBlockByValueName(e,"DO"+r);if(o.value)return i?(n.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(i,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),n):void 0;r+=1}let o=this.getBlockByValueName(e,"ELSE");if(o&&r==a+1)return n.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(o,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),n;"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()},Logic.prototype.controls_ifelse=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO0"),r=this.getBlockByValueName(e,"ELSE");if(null==a&&null==r)return;let n=this.getBlockByValueName(e,"IF0");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"BOOL"!=o.type)return;let i=gsap.timeline();return l.timelineDict[e.id]=i,o.value?i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}):i.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(r,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),i},Logic.prototype.controls_wait_time=function(e,t){let l=this,a=this.getContentByFieldName(e,"UNIT");if(null==a)return;let r=this.getBlockByValueName(e,"TIME");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"NUM"!=n.type)return;switch(a){case"SECONDS":n.value=n.value;break;case"MILLISECOND":n.value=n.value/1e3;break;case"MINUTES":n.value=60*n.value}let o=gsap.timeline();return l.timelineDict[e.id]=o,o.to(gsapEmpty,{delay:n.value,onStart:function(){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()}}),o},Logic.prototype.controls_run_parallel=function(e,t){let l=parseInt(e.children[0].getAttribute("do")),a=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"DO"+(t+1));l&&a.push(l)}if(!(a.length<1))for(let e=0;e<a.length;e++)this.parseBlock(a[e])},Logic.prototype.parse_operators_block=function(e){let t=e.getAttribute("type"),l=new Object;switch(t){case"operators_compare":l.data=this.operators_compare(e);break;case"operators_operation":l.data=this.operators_operation(e);break;case"operators_negate":l.data=this.operators_negate(e);break;case"operators_ternary":l.data=this.operators_ternary(e);break;case"operators_arithmetic":l.data=this.operators_arithmetic(e);break;case"operators_random_int":l.data=this.operators_random_int(e);break;case"operators_random_float_between":l.data=this.operators_random_float_between(e);break;case"operators_constrain":l.data=this.operators_constrain(e);break;case"operators_number_property":l.data=this.operators_number_property(e);break;case"operators_is_divisable":l.data=this.operators_is_divisable(e);break;case"operators_round":l.data=this.operators_round(e);break;case"operators_round_to_decimals":l.data=this.operators_round_to_decimals(e);break;case"operators_single":l.data=this.operators_single(e);break;case"operators_trig":l.data=this.operators_trig(e);break;case"operators_on_list":l.data=this.operators_on_list(e)}return l},Logic.prototype.operators_compare=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a)return;let r=this.getBlockByValueName(e,"B");if(null==r)return;let n=this.parseBlock(r).data;if(null==n)return;if(a.type!=n.type)return null;let o=new Object;switch(o.type="BOOL",t){case"EQ":o.value=a.value==n.value;break;case"NEQ":o.value=a.value!=n.value;break;case"LT":if("NUM"!=a.type)return null;o.value=a.value<n.value;break;case"LTE":if("NUM"!=a.type)return null;o.value=a.value<=n.value;break;case"GT":if("NUM"!=a.type)return null;o.value=a.value>n.value;break;case"GTE":if("NUM"!=a.type)return null;o.value=a.value>=n.value}return o},Logic.prototype.operators_operation=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"BOOL"!=a.type)return;let r=this.getBlockByValueName(e,"B");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"BOOL"!=n.type)return;let o=new Object;switch(o.type="BOOL",t){case"AND":o.value=a.value&&n.value;break;case"OR":o.value=a.value||n.value}return o},Logic.prototype.operators_negate=function(e){let t=this.getBlockByValueName(e,"BOOL");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let a=new Object;return a.type="BOOL",a.value=!l.value,a},Logic.prototype.operators_ternary=function(e){let t=this.getBlockByValueName(e,"IF");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let a=this.getBlockByValueName(e,"THEN");if(null==a)return;let r=this.parseBlock(a).data,n=this.getBlockByValueName(e,"ELSE");if(null==n)return;let o=this.parseBlock(n).data;return l.value?r:o},Logic.prototype.operators_arithmetic=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let r=this.getBlockByValueName(e,"B");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"NUM"!=n.type)return;let o=new Object;switch(o.type="NUM",t){case"ADD":o.value=a.value+n.value;break;case"MINUS":o.value=a.value-n.value;break;case"MULTIPLY":o.value=a.value*n.value;break;case"DIVIDE":o.value=a.value/n.value;break;case"POWER":o.value=Math.pow(a.value,n.value);break;case"MOD":o.value=a.value%n.value}return o},Logic.prototype.operators_random_int=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"TO");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=parseInt(r.value),o=parseInt(l.value),i=new Object;return i.type="NUM",i.value=parseInt(Math.random()*(n-o))+o,i},Logic.prototype.operators_random_float_between=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"TO");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=new Object;return n.type="NUM",n.value=Math.random()*(r.value-l.value)+l.value,n},Logic.prototype.operators_constrain=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"LOW");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=this.getBlockByValueName(e,"HIGH");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=new Object;return i.type="NUM",i.value=Math.min(Math.max(l.value,r.value),o.value),i},Logic.prototype.operators_number_property=function(e){let t=this.getContentByFieldName(e,"PROPERTY");if(null==t)return;let l=this.getBlockByValueName(e,"NUMBER_TO_CHECK");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let r=new Object;switch(r.type="BOOL",CheckPrime=function(e){if(2==e||3==e)return!0;if(!(e>1)||e%1!=0||e%2==0||e%3==0)return!1;for(let t=6;t<=Math.sqrt(e)+1.5;t+=6)if(e%(t-1)==0||e%(t+1)==0)return!1;return!0},t){case"EVEN":r.value=a.value%2==0;break;case"ODD":r.value=a.value%2==1;break;case"PRIME":r.value=CheckPrime(a.value);break;case"WHOLE":r.value=a.value%1==0;break;case"POSITIVE":r.value=a.value>0;break;case"NEGATIVE":r.value=a.value<0}return r},Logic.prototype.operators_is_divisable=function(e){let t=this.getBlockByValueName(e,"DIVIDEND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"DIVISOR");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=new Object;return n.type="BOOL",n.value=l.value%r.value==0,n},Logic.prototype.operators_round=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let r=new Object;switch(r.type="NUM",t){case"ROUND":r.value=Math.round(a.value);break;case"ROUNDUP":r.value=Math.ceil(a.value);break;case"ROUNDDOWN":r.value=Math.floor(a.value)}return r},Logic.prototype.operators_round_to_decimals=function(e){let t=this.getBlockByValueName(e,"A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"B");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=new Object;n.type="NUM";let o=parseInt(r.value);return value=l.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+o:o))),value=value.toString().split("e"),n.value=+(value[0]+"e"+(value[1]?+value[1]-o:-o)),n},Logic.prototype.operators_single=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let r=new Object;switch(r.type="NUM",t){case"ROOT":r.value=Math.sqrt(a.value);break;case"ABS":r.value=Math.abs(a.value);break;case"NEG":r.value=-a.value;break;case"LN":r.value=Math.log(a.value);break;case"LOG10":r.value=Math.log10(a.value);break;case"EXP":r.value=Math.exp(a.value);break;case"POW10":r.value=Math.pow(10,a.value)}return r},Logic.prototype.operators_trig=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type&&"DEGREE"!=a.type)return;"DEGREE"==a.type&&(a.value=Math.PI*a.value/180);let r=new Object;switch(r.type="NUM",t){case"SIN":r.value=Math.sin(a.value);break;case"COS":r.value=Math.cos(a.value);break;case"TAN":r.value=Math.tan(a.value);break;case"ASIN":r.value=Math.asin(a.value);break;case"ACOS":r.value=Math.acos(a.value);break;case"ATAN":r.value=Math.atan(a.value)}return r},Logic.prototype.operators_on_list=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"LIST");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"LIST"!=a.type)return;let r=[],n={};for(let e=0;e<a.value.length;e++){if("NUM"!=a.value[e].type)return;r.push(a.value[e].value),n[a.value[e].value]?n[a.value[e].value]+=1:n[a.value[e].value]=1}let o=new Object;switch(o.type="NUM",t){case"SUM":o.value=r.reduce(((e,t)=>e+t),0);break;case"MIN":o.value=Math.min(...r);break;case"MAX":o.value=Math.max(...r);break;case"AVERAGE":o.value=r.reduce(((e,t)=>e+t),0)/r.length;break;case"MEDIAN":r.sort((function(e,t){return e-t})),r.length%2==1?o.value=r[parseInt(r.length/2)]:o.value=(r[parseInt(r.length/2)-1]+r[parseInt(r.length/2)])/2;break;case"MODE":let e=Math.max(...Object.values(n)),t=[];Object.keys(n).forEach((l=>{if(n[l]==e){let e=new Object;e.value=parseFloat(l),e.type="NUM",t.push(e)}})),o.value=t,o.type="LIST";break;case"STD_DEV":let l=r.reduce(((e,t)=>e+t),0)/r.length,a=0;r.forEach((e=>{let t=e-l;a+=t*t})),o.value=Math.sqrt(a/r.length);break;case"RANDOM":o.value=r[parseInt(Math.random()*r.length)]}return o},Logic.prototype.parse_items_block=function(e){let t=e.getAttribute("type"),l=arController.ARSceneResult[arController.currentProjectIndex].data.scene_objs_v2.objs,a=new Object;switch(t){case"items_get_gameobject":case"items_get_model":case"items_get_text":case"items_get_light":case"items_get_sound":case"items_get_video":a.data=this.items_get_gameobject(e);break;case"items_get_name":a.data=this.items_get_name(e,l);break;case"items_get_by_name":a.data=this.items_get_by_name(e,l);break;case"items_is_video_playing":a.data=this.items_is_video_playing(e)}return a},Logic.prototype.items_get_gameobject=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type="TEXT",t},Logic.prototype.items_get_name=function(e,t){let l=new Object,a=this.getBlockByValueName(e,"GAME_OBJECT"),r=this.parseBlock(a).data.value;return l.type="TEXT",t.forEach((e=>{e.obj_id==r&&(l.value=e.res_name)})),l},Logic.prototype.items_get_by_name=function(e,t){let l=new Object,a=this.getBlockByValueName(e,"NAME"),r=this.parseBlock(a).data.value;return l.type="TEXT",t.forEach((e=>{e.res_name==r&&(l.value=e.obj_id)})),l},Logic.prototype.items_is_video_playing=function(e){let t=new Object,l=this.getBlockByValueName(e,"VIDEO"),a=this.parseBlock(l).data.value,r=document.getElementById(a);r=document.getElementById(a);let n=document.querySelector("video");if(r)return t.type="BOOL",t.value=!n.paused,t},Logic.prototype.parse_data_block=function(e,t){let l=e.getAttribute("type"),a=new Object,r=this;switch(l){case"data_boolean":a.data=this.data_boolean(e);break;case"data_number":a.data=this.data_number(e);break;case"data_angle":a.data=this.data_angle(e);break;case"data_constant":a.data=this.data_constant(e);break;case"data_colour_random":a.data=this.data_colour_random(e);break;case"data_colour_of":a.data=this.data_colour_of(e);break;case"data_colour_picker":a.data=this.data_colour_picker(e);break;case"data_colour_rgb":a.data=this.data_colour_rgb(e);break;case"data_colour_blend":a.data=this.data_colour_blend(e);break;case"data_text":a.data=this.data_text(e);break;case"data_text_join":a.data=this.data_text_join(e);break;case"data_vector3":a.data=this.data_vector3(e);break;case"data_get_axis_from_vector3":a.data=this.data_get_axis_from_vector3(e);break;case"data_length":a.data=this.data_length(e);break;case"data_lists_create_empty":a.data=this.data_lists_create_empty(e);break;case"data_lists_create_list":this.data_lists_create_list(e);break;case"data_lists_create_with":a.data=this.data_lists_create_with(e);break;case"data_lists_add":this.data_lists_add(e);break;case"data_lists_insert_by_index":this.data_lists_insert_by_index(e);break;case"data_lists_delete_by_index":this.data_lists_delete_by_index(e);break;case"data_lists_replace_by_index":this.data_lists_replace_by_index(e);break;case"data_lists_get_by_index":a.data=this.data_lists_get_by_index(e);break;case"data_lists_pop_by_index":a.data=this.data_lists_pop_by_index(e);break;case"data_lists_index":a.data=this.data_lists_index(e);break;case"data_lists_contains":a.data=this.data_lists_contains(e)}return e.children>0&&("next"==e.children[e.children.length-1].tagName?r.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()),a},Logic.prototype.data_boolean=function(e){let t=new Object;return"TRUE"==e.children[0].textContent?t.value=!0:"FALSE"==e.children[0].textContent&&(t.value=!1),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_number=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_angle=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_constant=function(e){let t=this.getContentByFieldName(e,"CONSTANT");if(null==t)return;let l=new Object;switch(l.type="NUM",t){case"PI":l.value=Math.PI;break;case"E":l.value=Math.E;break;case"GOLDEN_RATIO":l.value=(1+Math.sqrt(5))/2;break;case"SQRT2":l.value=Math.sqrt(2);break;case"SQRT1_2":l.value=Math.sqrt(.5);break;case"INFINITY":l.value=1/0}return l},Logic.prototype.data_colour_random=function(e){let t=new THREE.Color(Math.random(),Math.random(),Math.random()),l=new Object;return l.value="#"+t.getHexString().toUpperCase(),l.type="COLOUR",l},Logic.prototype.data_colour_of=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=document.getElementById(t);if(null==a)return;let r=10*parseFloat(l[0])+parseFloat(l[1]),n=10*parseFloat(l[2])+parseFloat(l[3]),o=-1,i=-1;if(a.object3D.children.length>0&&a.object3D.children[0].ModelJson&&a.object3D.children[0].ModelJson.meshes&&a.object3D.children[0].ModelJson.materials&&a.object3D.children[0].ModelJson.nodes){let e=a.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,r==t){o=e[l].mesh,console.log("data.js: _data_colour_of: get nodeMeshIndex ",e[l]);break}if(console.log("data.js: _data_colour_of: meshIndex = ",o),o>=0){let e=a.object3D.children[0].ModelJson.meshes[o];if(console.log("data.js: _data_colour_of: get meshData ",o,e),e&&e.primitives){let t=e.primitives[n];Number.isInteger(t.material)&&(i=t.material,console.log("data.js: _data_colour_of: materialIndex=",i))}}}let c=new Object;if(c.type="COLOUR",i>=0){let e;a.object3D.traverse((function(t){if(t.isMesh){let l=t.material.name.split("_");l[l.length-1]==i&&(e=t.material,console.log("action.js: _data_colour_of: child.material =",t.material))}})),c.value="#"+e.color.getHexString().toUpperCase(),console.log("action.js: _data_colour_of: get material success color =",c.value)}else c.value="#C8C8C8",console.log("action.js: _data_colour_of: get material fail color =",c.value);return c},Logic.prototype.data_colour_picker=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_rgb=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_blend=function(e){let t=this.getBlockByValueName(e,"COLOUR1");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"COLOUR"!=l.type)return;let a=this.getBlockByValueName(e,"COLOUR2");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"TEXT"!=r.type&&"COLOUR"!=r.type)return;let n=this.getBlockByValueName(e,"RATIO");if(null==n)return;let o=this.parseBlock(n).data;if(null==o||"NUM"!=o.type)return;let i=Math.min(100,Math.max(0,o.value))/100;console.log(i);let c=new THREE.Color(l.value),s=new THREE.Color(r.value);console.log(c),console.log(s);let u=c.lerp(s,i);console.log(u);let d=new Object;return d.value="#"+u.getHexString().toUpperCase(),d.type="COLOUR",d},Logic.prototype.data_text=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_text_join=function(e){let t=parseInt(e.children[0].getAttribute("items")),l=new Object;l.value="",l.type="TEXT";for(let a=0;a<t;a++){let t=this.getBlockByValueName(e,"ADD"+a);if(t){let e=this.parseBlock(t).data;l.value+=this.toString(e)}}return l},Logic.prototype.data_vector3=function(e){let t=new Object;if("X"!=e.children[0].getAttribute("name"))return null;let l=this.parseBlock(e.children[0].children[0]).data;if(null==l||"NUM"!=l.type)return null;if("Y"!=e.children[1].getAttribute("name"))return null;let a=this.parseBlock(e.children[1].children[0]).data;if(null==a||"NUM"!=a.type)return null;if("Z"!=e.children[2].getAttribute("name"))return null;let r=this.parseBlock(e.children[2].children[0]).data;return null==r||"NUM"!=r.type?null:(t.value=new THREE.Vector3(l.value,a.value,r.value),t.type="VEC3",t)},Logic.prototype.data_get_axis_from_vector3=function(e){let t=this.getContentByFieldName(e,"AXIS");if(null==t)return;let l=this.getBlockByValueName(e,"POSITION");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"VEC3"!=a.type)return;let r=new Object;switch(r.type="NUM",t){case"X":r.value=a.value.x;break;case"Y":r.value=a.value.y;break;case"Z":r.value=a.value.z}return r},Logic.prototype.data_length=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"LIST"!=l.type)return;let a=new Object;return a.value=l.value.length,a.type="NUM",a},Logic.prototype.data_lists_create_empty=function(e){let t=new Object;return t.value=[],t.type="LIST",t},Logic.prototype.data_lists_create_list=function(e){let t,l=this.getContentByFieldName(e,"VAR");if(null==l)return;this.variableList.forEach((e=>{e.name==l&&(t=e)}));let a=new Object;a.value=[],a.type="LIST",t.data=a},Logic.prototype.data_lists_create_with=function(e){let t=new Object;t.value=[],t.type="LIST";let l=parseInt(e.children[0].getAttribute("items")),a=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"ADD"+t);l&&a.push(l)}for(let e=0;e<a.length;e++){let l=this.parseBlock(a[e]).data;if(l){let e=new Object;e.value=l.value,e.type=l.type,t.value.push(e)}}return t},Logic.prototype.data_lists_add=function(e){let t=this.getBlockByValueName(e,"ITEM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"LIST"!=r.type)return;let n=new Object;n.value=l.value,n.type=l.type,r.value.push(n)},Logic.prototype.data_lists_insert_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"INDEX");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=this.getBlockByValueName(e,"VALUE");if(null==n)return;let o=this.parseBlock(n).data;if(null!=o&&"LIST"==o.type&&r.value>=0&&r.value<=o.value.length){let e=new Object;e.value=l.value,e.type=l.type,o.value.splice(r.value,0,e)}},Logic.prototype.data_lists_delete_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let r=this.parseBlock(a).data;null!=r&&"LIST"==r.type&&l.value>=0&&l.value<r.value.length&&r.value.splice(l.value,1)},Logic.prototype.data_lists_replace_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"INDEX");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"NUM"!=r.type)return;let n=this.getBlockByValueName(e,"VALUE");if(null==n)return;let o=this.parseBlock(n).data;if(null!=o&&"LIST"==o.type&&r.value>=0&&r.value<o.value.length){let e=new Object;e.value=l.value,e.type=l.type,o.value.splice(r.value,1,e)}},Logic.prototype.data_lists_get_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"LIST"!=r.type)return;let n=new Object;return l.value>=0&&l.value<r.value.length&&(n=r.value[l.value]),n},Logic.prototype.data_lists_pop_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"LIST"!=r.type)return;let n=new Object;return l.value>=0&&l.value<r.value.length&&(n=r.value[l.value],r.value.splice(l.value,1)),n},Logic.prototype.data_lists_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"LIST"!=r.type)return;let n=[];r.value.forEach((e=>{n.push(e.value)}));let o=new Object;return o.type="NUM",o.value=n.indexOf(l.value),o},Logic.prototype.data_lists_contains=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let r=this.parseBlock(a).data;if(null==r||"LIST"!=r.type)return;let n=[];r.value.forEach((e=>{n.push(e.value)}));let o=new Object;o.type="BOOL";let i=n.indexOf(l.value);return o.value=-1!=i,o},Logic.prototype.parse_variables_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"variables_set":a.data=this.variables_set(e,t);break;case"variables_get":a.data=this.variables_get(e)}return a},Logic.prototype.variables_set=function(e,t){let l=new Object,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let r=this.getBlockByValueName(e,"VALUE");return null!=r?(this.variableList.forEach((e=>{e.name==a&&(e.data=this.parseBlock(r).data,l=e.data)})),"next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),l):void 0},Logic.prototype.variables_get=function(e){let t=new Object;return this.variableList.forEach((l=>{l.name==e.children[0].textContent&&(t=l.data)})),t},Logic.prototype.parse_events_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"events_on_click":a.data=this.events_on_click(e);break;case"events_on_collide":a.data=this.events_on_collide(e)}return t&&t(),a},Logic.prototype.events_on_click=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=this.getBlockByValueName(e,"DO");if(null==r)return;let n=document.getElementById(a.value);null!=n&&n.object3D.el&&(n.object3D.el.onclickBlock?(n.object3D.el.onclickBlock.push(r),n.object3D.el.onclickBlockState.push(!0)):(n.object3D.el.onclickBlock=[],n.object3D.el.onclickBlockState=[],n.object3D.el.onclickBlock.push(r),n.object3D.el.onclickBlockState.push(!0)),t.onclickObjectDict[e.id]=[n.object3D.el.onclickBlock,n.object3D.el.onclickBlockState])},Logic.prototype.events_on_collide=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let r=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==r)return;let n=this.parseBlock(r).data;if(null==n||"TEXT"!=n.type)return;let o=t.getBlockByValueName(e,"DO0");if(null==o)return;let i=document.getElementById(a.value),c=document.getElementById(n.value);if(null==i||null==c)return;let s=(new THREE.Box3).setFromObjectWithoutChildren(i.object3D),u=(new THREE.Box3).setFromObjectWithoutChildren(c.object3D),d=s.intersectsBox(u),h=!0,p=window.setInterval((function(){s=(new THREE.Box3).setFromObjectWithoutChildren(i.object3D),u=(new THREE.Box3).setFromObjectWithoutChildren(c.object3D),h&&0==d&&1==s.intersectsBox(u)?(d=!0,h=!1,t.parseBlock(o,(function(){h=!0}))):1==d&&0==s.intersectsBox(u)&&(d=!1)}),1);t.intervalList.push(p)},Logic.prototype.parse_debug_block=function(e,t){let l=e.getAttribute("type"),a=new Object,r=this;switch(l){case"debug_print":this.debug_print(e);break;case"debug_comment":this.debug_comment()}return"next"==e.children[e.children.length-1].tagName?r.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),a},Logic.prototype.toString=function(e){let t=this,l="";return"LIST"==e.type?e.value.forEach((e=>{l+=t.toString(e)})):"VEC3"==e.type?(value=e.value.x.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.y.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.z.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):"NUM"==e.type?(value=e.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):l+=e.value,l},Logic.prototype.debug_print=function(e){let t=this.parseBlock(e.children[0].children[0]).data;null!=t&&console.log(this.toString(t),t)},Logic.prototype.debug_comment=function(){};