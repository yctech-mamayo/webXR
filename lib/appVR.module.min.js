!function(){"use strict";if(!e)var e=(new Date).getTime();if(window.Browser=function(e){void 0===e&&(e=window.navigator.userAgent),e=e.toLowerCase();var t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(silk)/.exec(e)||/(android)/.exec(e)||/(win)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||/(playbook)/.exec(e)||/(bb)/.exec(e)||/(blackberry)/.exec(e)||[],n={},i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",versionNumber:t[4]||t[2]||"0",platform:r[0]||""};if(i.browser&&(n[i.browser]=!0,n.version=i.version,n.versionNumber=parseInt(i.versionNumber,10)),i.platform&&(n[i.platform]=!0),(n.android||n.bb||n.blackberry||n.ipad||n.iphone||n.ipod||n.kindle||n.playbook||n.silk||n["windows phone"])&&(n.mobile=!0),(n.cros||n.mac||n.linux||n.win)&&(n.desktop=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),n.rv||n.iemobile){var o="msie";i.browser=o,n[o]=!0}if(n.edge){delete n.edge;var a="msedge";i.browser=a,n.msedge=!0}if(n.safari&&n.blackberry){var s="blackberry";i.browser=s,n.blackberry=!0}if(n.safari&&n.playbook){var l="playbook";i.browser=l,n.playbook=!0}if(n.bb){var c="blackberry";i.browser=c,n[c]=!0}if(n.opr){var u="opera";i.browser=u,n.opera=!0}if(n.safari&&n.android){var d="android";i.browser=d,n.android=!0}if(n.safari&&n.kindle){var h="kindle";i.browser=h,n.kindle=!0}if(n.safari&&n.silk){var p="silk";i.browser=p,n.silk=!0}n.name=i.browser,n.platform=i.platform;var f=/micromessenger/.test(e),m=/line/.test(e),v=/fban/.test(e)||/fbav/.test(e);return f?n.app="weChat":m?n.app="Line":v&&(n.app="FB"),(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)&&(n.iOS=!0),n}(window.navigator.userAgent),!t)var t=(new Date).getTime();t&&e&&console.log("processing time(uaMatch):",t-e)}(),function(){"use strict";function e(e){let t=atob(e).split("").map((function(e){return e.charCodeAt(0)})),r=new Uint8Array(t),n=pako.inflate(r),i=String.fromCharCode.apply(null,new Uint16Array(n));return JSON.parse(i)}window.parseUserData=function(e,t){let r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="json",r.onload=function(e){for(var t in r.response.data?window.file=r.response.data:window.file=r.response,window.file.scene_objs_v2)for(var n in window.file.scene_objs_v2[t].transform){var i=window.file.scene_objs_v2[t].transform[n].split(",");if(3!=i.length)return-1;var o=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])];window.file.scene_objs_v2[t].transform[n]=o}return window.file},r.send(),r.response},window.getARProjsByUserID=function(t,r,n){if(!t)return-1;r||(r="makarvr");let i=new XMLHttpRequest,o={user_id:r,cid:"20"};if("3.0.0"==serverVersion&&(console.log("%cnetWorkAgent.js: getARProjsByUserID: you shoudnt see this, Fei abandon this function in server V3","color:red"),getResByUserID(t,r,"","",(function(){console.log("netWorkAgent.js: getARProjsByUserID: getResByUserID: callback");let e=t+"get_ar_projs",r={ver:"3.0.0",cid:5,data:o},a=JSON.stringify(r);i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){let t;console.log("networkAgent.js: getARProjsByUserID,  onload xhr.response = ",i.response),i.response.error?(n&&n(i.response.error),console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",i.response.error)):i.response.data?(t=i.response.data,window.userARData,window.userARData=t,n&&n(t)):n&&n("networkAgent.js:error: no xhr.response.data")},i.send(a)}))),"2.0.0"==serverVersion){let r=JSON.stringify(o),a=new FormData;a.append("cmd","get_ar_projs"),a.append("data",r),i.open("POST",t,!0),i.responseType="json",i.onload=function(t){let r;if(console.log("networkAgent.js:getARProjsByUserID:",i.response),i.response.diaoyurar){let t=e(i.response.diaoyurar);t.error?(n&&n(t.error),console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",t.error)):t.data?(r=t.data,window.userARData?(console.log("networkAgent.js: getARProjsByUserID: window.userARData already exist, replace it.."),window.userARData=r):window.userARData=r,n&&n(r)):n&&n("networkAgent.js:error: no jsonData.data")}else i.response.error?(n&&n(i.response.error),console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",i.response.error)):i.response.data?(r=i.response.data,window.userARData,window.userARData=r,n&&n(r)):n&&n("networkAgent.js:error: no xhr.response.data")},i.send(a)}},window.getUserPublishProjsByUserID=function(e,t,r,n,i){if(!e)return-1;t||(t="makarvr"),r||(r=""),n||(n="");let o=new XMLHttpRequest,a={user_id:t,web_ar:!0};"3.0.0"==serverVersion&&getResByUserID(e,t,r,n,(function(s){getUsrOnlineRes(e,t,r,n,"",(function(t){let r=e+"get_usr_publish_projs",n={ver:"3.0.0",cid:5,data:a},l=JSON.stringify(n);o.open("POST",r,!0),o.setRequestHeader("Content-Type","application/json"),o.responseType="json",o.onload=function(e){let r;o.response.error?(i&&i(o.response.error),console.log("%cnetworkAgent.js: _getUserPublishProjs: oops something wrong: ","color:red",o.response.error)):o.response.data?(r=o.response.data,window.userPublishProjs,window.userPublishProjs=r,i&&i(r,s,t)):i&&i("networkAgent.js:error: no xhr.response.data")},o.send(l)}))}))},window.getNewestPublishProjs=function(e,t,r){if(!e)return-1;t||(t="vr");let n=new XMLHttpRequest;if("3.0.0"==serverVersion){let r=e+"get_newest_publish_projs",i={ver:"3.0.0",cid:5,data:{proj_type:t}},o=JSON.stringify(i);n.open("POST",r,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="json",n.onload=function(e){console.log("networkAgent.js: getNewestPublishProjs,  onload xhr.response = ",n.response)},console.log("networkAgent.js: getNewestPublishProjs, jsonReq=",o),n.send(o)}},window.getResByUserID=function(e,r,n,i,o){r||(r="makarvr"),n||(n=""),i||(i="");let a=e+"get_res",s=new XMLHttpRequest,l={ver:"3.0.0",cid:5,data:{user_id:r,main_type:n,sub_type:i}},c=JSON.stringify(l);s.open("POST",a,!0),s.setRequestHeader("Content-Type","application/json"),s.responseType="json",s.onload=function(e){s.response.error?console.log("%cnetworkAgent: _getResByUserID,  onload error ","color:red",s.response):(console.log("%cnetworkAgent: _getResByUserID,  onload save ","color:blue",s.response.data.list),s.response.data.list.length>0?t(s.response.data.list,(function(e){o&&o(e)})):o&&(console.log("networkAgent: _getResByUserID,  onload  use res is empty "),o({})))},s.send(c)};var t=function(e,t){if(!e)return-1;let r={};for(let n=0;n<e.length;n++)r[e[n].res_id]=e[n],n==e.length-1&&(console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback",n,e.length),t&&t(r))};window.getUsrOnlineRes=function(e,t,n,i,o,a){t||(t="fefe"),n||(n=""),i||(i=""),o||(o="");let s=e+"get_usr_online_res",l=new XMLHttpRequest,c={ver:"3.0.0",cid:5,data:{user_id:t,main_type:n,sub_type:i,category:o}},u=JSON.stringify(c);l.open("POST",s,!0),l.setRequestHeader("Content-Type","application/json"),l.responseType="json",l.onload=function(e){console.log("networkAgentVR.js: _getUsrOnlineRes: res = ",l.response),l.response.error?console.log("networkAgent.js: _getUsrOnlineRes,  onload error ",l.response):(console.log("networkAgent.js: _getUsrOnlineRes,  onload save ",l.response),l.response.data.online_res_list.length>0?r(l.response.data.online_res_list,(function(e){a&&a(e)})):a&&(console.log("networkAgent: _getUsrOnlineRes,  onload  use res is empty "),a({})))},l.send(u)};var r=function(e,t){if(!e)return-1;let r={};for(let n=0;n<e.length;n++)r[e[n].res_id]=e[n],n==e.length-1&&(console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback",n,e.length),t&&t(r))};function n(e,t,r){let n=new XMLHttpRequest,i={ver:"3.1.1",cid:5,data:t},o=JSON.stringify(i);n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="json",n.addEventListener("load",(function(){r&&r(n.response)})),n.send(o)}window.getOneUserInfo=function(e,t,r,n){let i=new XMLHttpRequest,o=e+"get_one_usr_info",a={ver:"3.0.0",cid:5,data:{user_id:t,wanted_info_keys:r}},s=JSON.stringify(a);i.open("POST",o,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){""==i.response.error?n&&n(i.response):n&&n(i.response.error)},i.send(s)},window.getViewerConfig=function(e,t){if(!e)return-1;let r=e+"get_viewer_config",n=new XMLHttpRequest,i=JSON.stringify({ver:"3.1.1",cid:5,data:{}});n.open("POST",r,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="json",n.onload=function(e){console.log("networkAgent.js: _getViewerConfig: xhr.response",n.response),t&&t(n.response)},n.send(i)},window.getARProjsByProjID=function(e,t){if(null==e)return;if(!Array.isArray(e))return;if(e.length<1)return;let r=new XMLHttpRequest,n={proj_id_list:e},i=window.serverUrl+"get_ar_projs_by_proj_id",o={ver:"3.0.0",cid:5,data:n},a=JSON.stringify(o);r.open("POST",i,!0),r.setRequestHeader("Content-Type","application/json"),r.responseType="json",r.onload=function(e){""==r.response.error?t&&t(r.response):t&&t(r.response.error)},r.send(a)},window.getVRSceneByUserID=function(e,t,r){if(!e)return-1;t||(t="makarvr");let n=[];if(n.user_id=t,"3.0.0"==serverVersion){var i=function(t,i,o){if(console.log("networkAgent.js: getVRSceneByUserID: _getUserPublishProjsByUserID: userPublishProjs=",t),"string"!=typeof t){let a=[];for(let e in t.proj_list)if("vr"==t.proj_list[e].proj_type){if(parent.useEditorWebTag&&!t.proj_list[e].proj_platform.find((e=>"web"==e)))continue;a.push(t.proj_list[e].proj_id)}let s=new XMLHttpRequest,l=e+"get_vr_projs_by_proj_id",c={ver:"3.0.0",cid:5,data:{proj_id_list:a}},u=JSON.stringify(c);s.open("POST",l,!0),s.setRequestHeader("Content-Type","application/json"),s.responseType="json",s.onload=function(t){let a=s.response.data;window.publishVRProjs=a;let l=0;if(a.result&&a.result.length)for(let t=0;t<a.result.length;t++){let s=new XMLHttpRequest,c={user_id:a.result[t].user_id,proj_id:a.result[t].proj_id},u=e+"get_vr_proj_scene",d={ver:"3.0.0",cid:5,data:c},h=JSON.stringify(d);s.open("POST",u,!0),s.setRequestHeader("Content-Type","application/json"),s.responseType="json",s.onload=function(e){l++,n[t]=s.response.data,l==a.result.length&&(window.VRSceneResult=n,window.userProjResDict=i,window.userOnlineResDict=o,r&&r(n))},s.send(h)}},s.send(u)}};searchUserIDByUserID(e,t,(function(n){for(let e in n.result)t.toLowerCase()===n.result[e].user_id.toLowerCase()&&(console.log("networkAgentVR.js: _searchUserIDByUserID: match, replace from [",t,"] to [",n.result[e].user_id,"]"),t=n.result[e].user_id);getPayInfoByUserID(e,t,(function(n){!function(e,t){var r,n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState&&(200===n.status||0==n.status)){let e=n.responseText;r=e,t&&t(r)}},n.send(null)}("https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/web_white_list/webVR_UserID_WhiteList.txt",(function(o){let a=JSON.parse(o).customizedUserID.list,s=[];for(let e=0;e<a.length;e++)s.push(a[e].name);let l=s.indexOf(t.toLowerCase())>-1;n.data?(console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: userPayInfo =",n.data),window.allowedMakarIDUseWeb=n.data.web_ar||l,"proA"!=n.data.user_type&&"proB"!=n.data.user_type&&"proC"!=n.data.user_type&&"custom"!=n.data.user_type||(window.allowedMakarIDUseWeb=!0),getUserPublishProjsByUserID(e,t,"","",i)):(console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: error, userPayInfo=",n),r&&r("this ID <br> ["+t+"] <br> user data error, please contact MIFLY for more information. "))}))}))}))}},window.getPayInfoByUserID=function(e,t,r){if(!e)return-1;if(!t)return-1;let n=e+"get_pay_info",i=new XMLHttpRequest,o={ver:"3.0.0",cid:5,data:{user_id:t}},a=JSON.stringify(o);i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){r&&r(i.response)},i.send(a)},window.getELicenseInfo=function(e,t,r){if(!e)return-1;if(!t)return-1;let n=e+"get_e_lice_info",i=new XMLHttpRequest,o={ver:"3.1.1",cid:5,data:{license_key:t}},a=JSON.stringify(o);i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){r&&r(i.response)},i.send(a)},window.checkLicenseInProjs=function(e,t){let r=[],i=[],o=[],a=[];for(let e=0,t=userPublishProjs.proj_list.length;e<t;e++)switch(userPublishProjs.proj_list[e].proj_type){case"ar":r.push(userPublishProjs.proj_list[e].proj_id),a.push({proj_id:userPublishProjs.proj_list[e].proj_id});break;case"vr":i.push(userPublishProjs.proj_list[e].proj_id),a.push({proj_id:userPublishProjs.proj_list[e].proj_id});break;case"ar_slam":o.push(userPublishProjs.proj_list[e].proj_id),a.push({proj_id:userPublishProjs.proj_list[e].proj_id});break;default:console.error("networkAgentVR.js: _checkLicenseInProjs: project type ERROR",userPublishProjs.proj_list[e].proj_type)}let s=[];function l(r){for(let n=0,i=a.length;n<i;n++)for(let i=0,o=r.data.result.length;i<o;i++)a[n].proj_id==r.data.result[i].proj_id&&(""!=r.data.result[i].editor_license_key?getELicenseInfo(e,r.data.result[i].editor_license_key,(function(e){""!=e.error?s.push({proj_id:a[n].proj_id,isLicense:!1}):s.push({proj_id:a[n].proj_id,isLicense:!0}),s.length==a.length&&t&&t(s)})):s.push({proj_id:a[n].proj_id,isLicense:!1}));s.length==a.length&&t&&t(s)}r.length>0&&n(e+"get_ar_projs_by_proj_id",{proj_id_list:r},l),i.length>0&&n(e+"get_vr_projs_by_proj_id",{proj_id_list:i},l),o.length>0&&n(e+"get_arslam_projs_by_proj_id",{proj_id_list:o},l)},window.getRecordModule=function(e,t,r,i){if(!e)return-1;n(e+"get_record_module",{playing_user_id:t,proj_id:r},(function(e){console.log("networkAgentVR.js: _getRecordModule: ret",e),i&&i(e)}))},window.quizLog=function(e,t,r){n(e+"quiz_log",t,(function(e){console.log("networkAgentVR.js: _quizLog: ret",e),r&&r(e)}))},window.updateRecordModule=function(e,t,r){n(e+"update_record_module",t,(function(e){console.log("networkAgentVR.js: _updateRecordModule: ret",e),r&&r(e)}))},window.getVRDataByUserID=function(t,r,n){if(!t)return-1;r||(r="makarvr");let i=new XMLHttpRequest,o={user_id:r,cid:"20"},a=JSON.stringify(o),s=new FormData;s.append("cmd","get_vr_projs"),s.append("data",a),i.open("POST",t,!0),i.responseType="json",i.onload=function(t){let r;if(i.response.diaoyurar){let t=e(i.response.diaoyurar);t.error?(n&&n(t.error),console.log("networkAgent.js: getVRDataByUserID: oops something wrong:",t.error)):t.data?(r=t.data,window.userVRData?(console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it.."),window.userVRData=r):(console.log("networkAgent.js: getVRDataByUserID: save window.userARData "),window.userVRData=r),n&&n(r)):n&&n("networkAgent.js:getVRDataByUserID:error: no jsonData.data")}else i.response.error?(n&&n(i.response.error),console.log("networkAgent.js: getVRDataByUserID: oops something wrong:",i.response.error)):i.response.data?(r=i.response.data,r.proj_list?(window.userVRData?(console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it.."),window.userVRData=r):(console.log("networkAgent.js: getVRDataByUserID: save window.userARData =",r),window.userVRData=r),n&&n(r)):(console.log("%cnetworkAgent.js:getVRDataByUserID: onload, fail userVRData.proj_list is empty","color:red"),n&&n("the userVRData.proj_list is empty"))):n&&n("networkAgent.js:getVRDataByUserID:error: no xhr.response.data")},i.send(s)},window.uploadDataToServer=function(e,t,r){if(!e)return-1;let n=new XMLHttpRequest,i={user_id:userARData.user_id,target_id:userARData.proj_list[t].target_id};if("3.0.0"==serverVersion){let t=e+"add_scan_times",r={ver:"3.0.0",cid:5,data:i},o=JSON.stringify(r);n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="json",n.onload=function(e){},n.send(o)}if("2.0.0"==serverVersion){let t=JSON.stringify(i),r=new FormData;r.append("cmd","add_scan_times"),r.append("data",t),n.open("POST",e,!0),n.responseType="json",n.onload=function(e){console.log("networkAgent: uploadDataToServer, xhr = ",n.response.data)},n.send(r)}},window.searchUserIDByUserID=function(e,t,r){if(!e)return-1;if(!t)return-1;let n=e+"get_many_usr_info_keyword",i=new XMLHttpRequest,o={ver:"3.0.0",cid:5,data:{keyword:t,search_keys:["user_id"]}},a=JSON.stringify(o);i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){console.log("networkAgent.js: _searchUserIDByUserID: xhr.response",i.response.data),r&&r(i.response.data)},i.send(a)},window.testPOST=function(e,t){let r=new XMLHttpRequest,n={ver:"3.0.0",cid:5,data:{user_id:"fefe"},length:8},i=JSON.stringify(n);console.log(" jsonReq ",i);let o=new FormData;o.append("cmd","add_scan_times"),o.append("data",i),r.open("POST","http://60.250.125.146:8081/Makar/get_usr_publish_projs",!0),r.setRequestHeader("Content-Type","application/json"),r.responseType="json",r.onload=function(e){console.log("networkAgent: testPOST,  onload xhr = ",r,r.response)},r.send(i)}}();var key,Module=void 0!==Module?Module:{},moduleOverrides={};for(key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);Module.arguments=[],Module.thisProgram="./this.program",Module.quit=function(e,t){throw t},Module.preRun=[],Module.postRun=[];var nodeFS,nodePath,ENVIRONMENT_IS_WEB=!1,ENVIRONMENT_IS_WORKER=!1,ENVIRONMENT_IS_NODE=!1,ENVIRONMENT_IS_SHELL=!1;if(Module.ENVIRONMENT)if("WEB"===Module.ENVIRONMENT)ENVIRONMENT_IS_WEB=!0;else if("WORKER"===Module.ENVIRONMENT)ENVIRONMENT_IS_WORKER=!0;else if("NODE"===Module.ENVIRONMENT)ENVIRONMENT_IS_NODE=!0;else{if("SHELL"!==Module.ENVIRONMENT)throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");ENVIRONMENT_IS_SHELL=!0}else ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&"function"==typeof require&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;for(key in ENVIRONMENT_IS_NODE?(Module.read=function(e,t){var r;return(r=tryParseAsDataURI(e))||(nodeFS||(nodeFS=require("fs")),nodePath||(nodePath=require("path")),e=nodePath.normalize(e),r=nodeFS.readFileSync(e)),t?r:r.toString()},Module.readBinary=function(e){var t=Module.read(e,!0);return t.buffer||(t=new Uint8Array(t)),assert(t.buffer),t},process.argv.length>1&&(Module.thisProgram=process.argv[1].replace(/\\/g,"/")),Module.arguments=process.argv.slice(2),"undefined"!=typeof module&&(module.exports=Module),process.on("uncaughtException",(function(e){if(!(e instanceof ExitStatus))throw e})),process.on("unhandledRejection",(function(e,t){process.exit(1)})),Module.inspect=function(){return"[Emscripten Module object]"}):ENVIRONMENT_IS_SHELL?("undefined"!=typeof read&&(Module.read=function(e){var t=tryParseAsDataURI(e);return t?intArrayToString(t):read(e)}),Module.readBinary=function(e){var t;return(t=tryParseAsDataURI(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(assert("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?Module.arguments=scriptArgs:"undefined"!=typeof arguments&&(Module.arguments=arguments),"function"==typeof quit&&(Module.quit=function(e,t){quit(e)})):(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(Module.read=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(t){var r=tryParseAsDataURI(e);if(r)return intArrayToString(r);throw t}},ENVIRONMENT_IS_WORKER&&(Module.readBinary=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(t){var r=tryParseAsDataURI(e);if(r)return r;throw t}}),Module.readAsync=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)t(n.response);else{var i=tryParseAsDataURI(e);i?t(i.buffer):r()}},n.onerror=r,n.send(null)},"undefined"!=typeof arguments&&(Module.arguments=arguments),Module.setWindowTitle=function(e){document.title=e}),Module.print="undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null,Module.printErr="undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||Module.print,Module.print=Module.print,Module.printErr=Module.printErr,moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);moduleOverrides=void 0;var STACK_ALIGN=16;function staticAlloc(e){assert(!staticSealed);var t=STATICTOP;return STATICTOP=STATICTOP+e+15&-16,t}function dynamicAlloc(e){assert(DYNAMICTOP_PTR);var t=HEAP32[DYNAMICTOP_PTR>>2],r=t+e+15&-16;return HEAP32[DYNAMICTOP_PTR>>2]=r,r>=TOTAL_MEMORY&&!enlargeMemory()?(HEAP32[DYNAMICTOP_PTR>>2]=t,0):t}function alignMemory(e,t){return t||(t=STACK_ALIGN),Math.ceil(e/t)*t}function getNativeTypeSize(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return 4;if("i"===e[0]){var t=parseInt(e.substr(1));return assert(t%8==0),t/8}return 0}}function warnOnce(e){warnOnce.shown||(warnOnce.shown={}),warnOnce.shown[e]||(warnOnce.shown[e]=1,Module.printErr(e))}var jsCallStartIndex=1,functionPointers=new Array(0);function addFunction(e,t){for(var r=0;r<0;r++)if(!functionPointers[r])return functionPointers[r]=e,jsCallStartIndex+r;throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."}function removeFunction(e){functionPointers[e-jsCallStartIndex]=null}var funcWrappers={};function getFuncWrapper(e,t){if(e){assert(t),funcWrappers[t]||(funcWrappers[t]={});var r=funcWrappers[t];return r[e]||(1===t.length?r[e]=function(){return dynCall(t,e)}:2===t.length?r[e]=function(r){return dynCall(t,e,[r])}:r[e]=function(){return dynCall(t,e,Array.prototype.slice.call(arguments))}),r[e]}}function makeBigInt(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)}function dynCall(e,t,r){return r&&r.length?Module["dynCall_"+e].apply(null,[t].concat(r)):Module["dynCall_"+e].call(null,t)}var Runtime={dynCall:dynCall},GLOBAL_BASE=8,ABORT=0,EXITSTATUS=0;function assert(e,t){e||abort("Assertion failed: "+t)}var globalScope=this;function getCFunc(e){var t=Module["_"+e];return assert(t,"Cannot call unknown function "+e+", make sure it is exported"),t}var JSfuncs={stackSave:function(){stackSave()},stackRestore:function(){stackRestore()},arrayToC:function(e){var t=stackAlloc(e.length);return writeArrayToMemory(e,t),t},stringToC:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);stringToUTF8(e,t=stackAlloc(r),r)}return t}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};function ccall(e,t,r,n,i){var o=getCFunc(e),a=[],s=0;if(n)for(var l=0;l<n.length;l++){var c=toC[r[l]];c?(0===s&&(s=stackSave()),a[l]=c(n[l])):a[l]=n[l]}var u=o.apply(null,a);return"string"===t&&(u=Pointer_stringify(u)),0!==s&&stackRestore(s),u}function cwrap(e,t,r){r=r||[];var n=getCFunc(e),i=r.every((function(e){return"number"===e}));return"string"!==t&&i?n:function(){return ccall(e,t,r,arguments)}}function setValue(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":HEAP8[e>>0]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+Math_abs(tempDouble)>=1?tempDouble>0?(0|Math_min(+Math_floor(tempDouble/4294967296),4294967295))>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+r)}}function getValue(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return HEAP8[e>>0];case"i16":return HEAP16[e>>1];case"i32":case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for getValue: "+t)}return null}var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;function allocate(e,t,r,n){var i,o;"number"==typeof e?(i=!0,o=e):(i=!1,o=e.length);var a,s="string"==typeof t?t:null;if(a=r==ALLOC_NONE?n:["function"==typeof _malloc?_malloc:staticAlloc,stackAlloc,staticAlloc,dynamicAlloc][void 0===r?ALLOC_STATIC:r](Math.max(o,s?1:t.length)),i){var l;for(n=a,assert(0==(3&a)),l=a+(-4&o);n<l;n+=4)HEAP32[n>>2]=0;for(l=a+o;n<l;)HEAP8[n++>>0]=0;return a}if("i8"===s)return e.subarray||e.slice?HEAPU8.set(e,a):HEAPU8.set(new Uint8Array(e),a),a;for(var c,u,d,h=0;h<o;){var p=e[h];0!==(c=s||t[h])?("i64"==c&&(c="i32"),setValue(a+h,p,c),d!==c&&(u=getNativeTypeSize(c),d=c),h+=u):h++}return a}function getMemory(e){return staticSealed?runtimeInitialized?_malloc(e):dynamicAlloc(e):staticAlloc(e)}function Pointer_stringify(e,t){if(0===t||!e)return"";for(var r,n=0,i=0;n|=r=HEAPU8[e+i>>0],(0!=r||t)&&(i++,!t||i!=t););t||(t=i);var o="";if(n<128){for(var a;t>0;)a=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,1024))),o=o?o+a:a,e+=1024,t-=1024;return o}return UTF8ToString(e)}function AsciiToString(e){for(var t="";;){var r=HEAP8[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}}function stringToAscii(e,t){return writeAsciiToMemory(e,t,!1)}var UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function UTF8ArrayToString(e,t){for(var r=t;e[r];)++r;if(r-t>16&&e.subarray&&UTF8Decoder)return UTF8Decoder.decode(e.subarray(t,r));for(var n,i,o,a,s,l="";;){if(!(n=e[t++]))return l;if(128&n)if(i=63&e[t++],192!=(224&n))if(o=63&e[t++],224==(240&n)?n=(15&n)<<12|i<<6|o:(a=63&e[t++],240==(248&n)?n=(7&n)<<18|i<<12|o<<6|a:(s=63&e[t++],n=248==(252&n)?(3&n)<<24|i<<18|o<<12|a<<6|s:(1&n)<<30|i<<24|o<<18|a<<12|s<<6|63&e[t++])),n<65536)l+=String.fromCharCode(n);else{var c=n-65536;l+=String.fromCharCode(55296|c>>10,56320|1023&c)}else l+=String.fromCharCode((31&n)<<6|i);else l+=String.fromCharCode(n)}}function UTF8ToString(e){return UTF8ArrayToString(HEAPU8,e)}function stringToUTF8Array(e,t,r,n){if(!(n>0))return 0;for(var i=r,o=r+n-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=2097151){if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=67108863){if(r+4>=o)break;t[r++]=248|s>>24,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+5>=o)break;t[r++]=252|s>>30,t[r++]=128|s>>24&63,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function stringToUTF8(e,t,r){return stringToUTF8Array(e,HEAPU8,t,r)}function lengthBytesUTF8(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:n<=2097151?4:n<=67108863?5:6}return t}var UTF16Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function UTF16ToString(e){for(var t=e,r=t>>1;HEAP16[r];)++r;if((t=r<<1)-e>32&&UTF16Decoder)return UTF16Decoder.decode(HEAPU8.subarray(e,t));for(var n=0,i="";;){var o=HEAP16[e+2*n>>1];if(0==o)return i;++n,i+=String.fromCharCode(o)}}function stringToUTF16(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,o=0;o<i;++o){var a=e.charCodeAt(o);HEAP16[t>>1]=a,t+=2}return HEAP16[t>>1]=0,t-n}function lengthBytesUTF16(e){return 2*e.length}function UTF32ToString(e){for(var t=0,r="";;){var n=HEAP32[e+4*t>>2];if(0==n)return r;if(++t,n>=65536){var i=n-65536;r+=String.fromCharCode(55296|i>>10,56320|1023&i)}else r+=String.fromCharCode(n)}}function stringToUTF32(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),HEAP32[t>>2]=a,(t+=4)+4>i)break}return HEAP32[t>>2]=0,t-n}function lengthBytesUTF32(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function allocateUTF8(e){var t=lengthBytesUTF8(e)+1,r=_malloc(t);return r&&stringToUTF8Array(e,HEAP8,r,t),r}function allocateUTF8OnStack(e){var t=lengthBytesUTF8(e)+1,r=stackAlloc(t);return stringToUTF8Array(e,HEAP8,r,t),r}function demangle(e){return e}function demangleAll(e){return e.replace(/__Z[\w\d_]+/g,(function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"}))}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function stackTrace(){var e=jsStackTrace();return Module.extraStackTrace&&(e+="\n"+Module.extraStackTrace()),demangleAll(e)}var HEAP,buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE,STATICTOP,staticSealed,STACK_BASE,STACKTOP,STACK_MAX,DYNAMIC_BASE,DYNAMICTOP_PTR,PAGE_SIZE=16384,WASM_PAGE_SIZE=65536,ASMJS_PAGE_SIZE=16777216,MIN_TOTAL_MEMORY=16777216;function alignUp(e,t){return e%t>0&&(e+=t-e%t),e}function updateGlobalBuffer(e){Module.buffer=buffer=e}function updateGlobalBufferViews(){Module.HEAP8=HEAP8=new Int8Array(buffer),Module.HEAP16=HEAP16=new Int16Array(buffer),Module.HEAP32=HEAP32=new Int32Array(buffer),Module.HEAPU8=HEAPU8=new Uint8Array(buffer),Module.HEAPU16=HEAPU16=new Uint16Array(buffer),Module.HEAPU32=HEAPU32=new Uint32Array(buffer),Module.HEAPF32=HEAPF32=new Float32Array(buffer),Module.HEAPF64=HEAPF64=new Float64Array(buffer)}function abortOnCannotGrowMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+TOTAL_MEMORY+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or (4) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function enlargeMemory(){abortOnCannotGrowMemory()}STATIC_BASE=STATICTOP=STACK_BASE=STACKTOP=STACK_MAX=DYNAMIC_BASE=DYNAMICTOP_PTR=0,staticSealed=!1;var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216;function getTotalMemory(){return TOTAL_MEMORY}if(TOTAL_MEMORY<TOTAL_STACK&&Module.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+TOTAL_MEMORY+"! (TOTAL_STACK="+TOTAL_STACK+")"),Module.buffer?buffer=Module.buffer:(buffer=new ArrayBuffer(TOTAL_MEMORY),Module.buffer=buffer),updateGlobalBufferViews(),HEAP32[0]=1668509029,HEAP16[1]=25459,115!==HEAPU8[2]||99!==HEAPU8[3])throw"Runtime error: expected the system to be little-endian!";function callRuntimeCallbacks(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?Module.dynCall_v(r):Module.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__),runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPreMain(e){__ATMAIN__.unshift(e)}function addOnExit(e){__ATEXIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}function writeStringToMemory(e,t,r){var n,i;warnOnce("writeStringToMemory is deprecated and should not be called! Use stringToUTF8() instead!"),r&&(i=t+lengthBytesUTF8(e),n=HEAP8[i]),stringToUTF8(e,t,1/0),r&&(HEAP8[i]=n)}function writeArrayToMemory(e,t){HEAP8.set(e,t)}function writeAsciiToMemory(e,t,r){for(var n=0;n<e.length;++n)HEAP8[t++>>0]=e.charCodeAt(n);r||(HEAP8[t>>0]=0)}function unSign(e,t,r){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,r){if(e<=0)return e;var n=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=n&&(t<=32||e>n)&&(e=-2*n+e),e}var Math_abs=Math.abs,Math_cos=Math.cos,Math_sin=Math.sin,Math_tan=Math.tan,Math_acos=Math.acos,Math_asin=Math.asin,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_sqrt=Math.sqrt,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_imul=Math.imul,Math_fround=Math.fround,Math_round=Math.round,Math_min=Math.min,Math_max=Math.max,Math_clz32=Math.clz32,Math_trunc=Math.trunc,runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}Module.preloadedImages={},Module.preloadedAudios={};var memoryInitializer=null,dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(e){return String.prototype.startsWith?e.startsWith(dataURIPrefix):0===e.indexOf(dataURIPrefix)}var ASM_CONSTS=[function(e,t){if("undefined"!=typeof window){let e=arguments,t=new Uint8Array(Module.HEAPU8.buffer,e[0],e[1]),r=new TextDecoder("utf-8").decode(t);window.checkHost="yet";let n=new XMLHttpRequest;n.open("GET",r),n.responseType="json",n.onload=function(e){let t=n.response.customizedWebSites;if(void 0!==t){let e=t.list;if(void 0!==e)for(let t in e){if(e[t].name==location.hostname){window.checkHost="correct";break}t==e.length-1&&(window.checkHost="fail")}}},n.send()}}];function _emscripten_asm_const_iii(e,t,r){return ASM_CONSTS[e](t,r)}STATICTOP=(STATIC_BASE=GLOBAL_BASE)+3472,__ATINIT__.push({func:function(){__GLOBAL__sub_I_whiteList_cpp()}},{func:function(){__GLOBAL__sub_I_bind_cpp()}}),memoryInitializer="data:application/octet-stream;base64,jAEAAD8HAACMAQAAfgcAAIwBAAC8BwAAjAEAAAIIAACMAQAAPwgAAIwBAABeCAAAjAEAAH0IAACMAQAAnAgAAIwBAAC7CAAAjAEAANoIAACMAQAA+QgAAIwBAAA2CQAAjAEAAFUJAAD4AQAAaAkAAAAAAAABAAAAiAAAAAAAAACMAQAApwkAAPgBAADNCQAAAAAAAAEAAACIAAAAAAAAAPgBAAAMCgAAAAAAAAEAAACIAAAAAAAAALQBAAADCwAA0AAAAAAAAAC0AQAAsAoAAOAAAAAAAAAAjAEAANEKAAC0AQAA3goAAMAAAAAAAAAAtAEAACULAADQAAAAAAAAANwBAABNCwAA3AEAAE8LAADcAQAAUQsAANwBAABTCwAA3AEAAFULAADcAQAAVwsAANwBAABZCwAA3AEAAFsLAADcAQAAXQsAANwBAABfCwAA3AEAAGELAADcAQAAYwsAANwBAABlCwAAtAEAAGcLAADAAAAAAAAAAEABAAAAAAAAwAAAAAEAAAACAAAAAwAAAAQAAAABAAAAAQAAAAEAAAABAAAAAAAAAOgAAAABAAAABQAAAAMAAAAEAAAAAQAAAAIAAAACAAAAAgAAAAAAAAD4AAAAAQAAAAYAAAADAAAABAAAAAIAAAAAAAAAcAEAAAEAAAAHAAAAAwAAAAQAAAABAAAAAwAAAAMAAAADAAAAaHR0cHM6Ly9zMy1hcC1ub3J0aGVhc3QtMS5hbWF6b25hd3MuY29tL21ha2FyLndlYmFyLmRlZmF1bHRvYmplY3Qvd2ViX3doaXRlX2xpc3Qvd2ViU2l0ZUxpc3QudHh0AHsgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7IGxldCBhID0gYXJndW1lbnRzOyBsZXQgeSA9IG5ldyBVaW50OEFycmF5KCBNb2R1bGUuSEVBUFU4LmJ1ZmZlciwgYVswXSwgYVsxXSApOyBsZXQgbGlzdFVybCA9IG5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoeSk7IHdpbmRvdy5jaGVja0hvc3QgPSAieWV0IjsgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyB4aHIub3BlbiggJ0dFVCcsIGxpc3RVcmwgKTsgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJzsgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsgbGV0IGN1c3RvbWl6ZWRXZWJTaXRlcyA9IHhoci5yZXNwb25zZS5jdXN0b21pemVkV2ViU2l0ZXM7IGlmICggdHlwZW9mKGN1c3RvbWl6ZWRXZWJTaXRlcykgIT0gInVuZGVmaW5lZCIgKXsgbGV0IGxpc3QgPSBjdXN0b21pemVkV2ViU2l0ZXMubGlzdCA7IGlmICggdHlwZW9mKGxpc3QpICE9ICJ1bmRlZmluZWQiICl7IGZvciAobGV0IGkgaW4gbGlzdCApeyBpZiAoIGxpc3RbaV0ubmFtZSA9PSBsb2NhdGlvbi5ob3N0bmFtZSl7IHdpbmRvdy5jaGVja0hvc3QgPSAiY29ycmVjdCI7IGJyZWFrOyB9IGlmICggaSA9PSBsaXN0Lmxlbmd0aCAtIDEgKXsgd2luZG93LmNoZWNrSG9zdCA9ICJmYWlsIjsgfSB9IH0gfSB9OyB4aHIuc2VuZCgpOyB9IH0AY2hlY2tNaWZseQBpaQB2b2lkAGJvb2wAc3RkOjpzdHJpbmcAc3RkOjpiYXNpY19zdHJpbmc8dW5zaWduZWQgY2hhcj4Ac3RkOjp3c3RyaW5nAGVtc2NyaXB0ZW46OnZhbABlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8c2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIHNob3J0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MTZfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dWludDMyX3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGxvbmcgZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0llRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lkRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZmxvYXQ+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWZFRQBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1bnNpZ25lZCBsb25nPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0ltRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZz4ATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJbEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWpFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lpRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJdEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SXNFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0loRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJYUVFAGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGNoYXI+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWNFRQBOMTBlbXNjcmlwdGVuM3ZhbEUATlN0M19fMjEyYmFzaWNfc3RyaW5nSXdOU18xMWNoYXJfdHJhaXRzSXdFRU5TXzlhbGxvY2F0b3JJd0VFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJY05TXzExY2hhcl90cmFpdHNJY0VFTlNfOWFsbG9jYXRvckljRUVFRQBkb3VibGUAZmxvYXQAdW5zaWduZWQgbG9uZwBsb25nAHVuc2lnbmVkIGludABpbnQAdW5zaWduZWQgc2hvcnQAc2hvcnQAdW5zaWduZWQgY2hhcgBzaWduZWQgY2hhcgBjaGFyAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAE4xMF9fY3h4YWJpdjEyM19fZnVuZGFtZW50YWxfdHlwZV9pbmZvRQB2AGIAYwBoAGEAcwB0AGkAagBsAG0AZgBkAE4xMF9fY3h4YWJpdjEyMV9fdm1pX2NsYXNzX3R5cGVfaW5mb0U=";var tempDoublePtr=STATICTOP;function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}STATICTOP+=16;var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:function(e){if(!e||EXCEPTIONS.infos[e])return e;for(var t in EXCEPTIONS.infos)if(EXCEPTIONS.infos[t].adjusted===e)return t;return e},addRef:function(e){e&&EXCEPTIONS.infos[e].refcount++},decRef:function(e){if(e){var t=EXCEPTIONS.infos[e];assert(t.refcount>0),t.refcount--,0!==t.refcount||t.rethrown||(t.destructor&&Module.dynCall_vi(t.destructor,e),delete EXCEPTIONS.infos[e],___cxa_free_exception(e))}},clearRef:function(e){e&&(EXCEPTIONS.infos[e].refcount=0)}};function ___resumeException(e){throw EXCEPTIONS.last||(EXCEPTIONS.last=e),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var e=EXCEPTIONS.last;if(!e)return 0|(setTempRet0(0),0);var t=EXCEPTIONS.infos[e],r=t.type;if(!r)return 0|(setTempRet0(0),e);var n=Array.prototype.slice.call(arguments);Module.___cxa_is_pointer_type(r),___cxa_find_matching_catch.buffer||(___cxa_find_matching_catch.buffer=_malloc(4)),HEAP32[___cxa_find_matching_catch.buffer>>2]=e,e=___cxa_find_matching_catch.buffer;for(var i=0;i<n.length;i++)if(n[i]&&Module.___cxa_can_catch(n[i],r,e))return e=HEAP32[e>>2],t.adjusted=e,0|(setTempRet0(n[i]),e);return e=HEAP32[e>>2],0|(setTempRet0(r),e)}function ___gxx_personality_v0(){}function getShiftFromSize(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function embind_init_charCodes(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);embind_charCodes=e}var embind_charCodes=void 0;function readLatin1String(e){for(var t="",r=e;HEAPU8[r];)t+=embind_charCodes[HEAPU8[r++]];return t}var awaitingDependencies={},registeredTypes={},typeDependencies={},char_0=48,char_9=57;function makeLegalFunctionName(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=char_0&&t<=char_9?"_"+e:e}function createNamedFunction(e,t){return e=makeLegalFunctionName(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function extendError(e,t){var r=createNamedFunction(t,(function(e){this.name=t,this.message=e;var r=new Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))}));return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var BindingError=void 0;function throwBindingError(e){throw new BindingError(e)}var InternalError=void 0;function throwInternalError(e){throw new InternalError(e)}function whenDependentTypesAreResolved(e,t,r){function n(t){var n=r(t);n.length!==e.length&&throwInternalError("Mismatched type converter count");for(var i=0;i<e.length;++i)registerType(e[i],n[i])}e.forEach((function(e){typeDependencies[e]=t}));var i=new Array(t.length),o=[],a=0;t.forEach((function(e,t){registeredTypes.hasOwnProperty(e)?i[t]=registeredTypes[e]:(o.push(e),awaitingDependencies.hasOwnProperty(e)||(awaitingDependencies[e]=[]),awaitingDependencies[e].push((function(){i[t]=registeredTypes[e],++a===o.length&&n(i)})))})),0===o.length&&n(i)}function registerType(e,t,r){if(r=r||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||throwBindingError('type "'+n+'" must have a positive integer typeid pointer'),registeredTypes.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;throwBindingError("Cannot register type '"+n+"' twice")}if(registeredTypes[e]=t,delete typeDependencies[e],awaitingDependencies.hasOwnProperty(e)){var i=awaitingDependencies[e];delete awaitingDependencies[e],i.forEach((function(e){e()}))}}function __embind_register_bool(e,t,r,n,i){var o=getShiftFromSize(r);registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=HEAP8;else if(2===r)n=HEAP16;else{if(4!==r)throw new TypeError("Unknown boolean type size: "+t);n=HEAP32}return this.fromWireType(n[e>>o])},destructorFunction:null})}var emval_free_list=[],emval_handle_array=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function __emval_decref(e){e>4&&0==--emval_handle_array[e].refcount&&(emval_handle_array[e]=void 0,emval_free_list.push(e))}function count_emval_handles(){for(var e=0,t=5;t<emval_handle_array.length;++t)void 0!==emval_handle_array[t]&&++e;return e}function get_first_emval(){for(var e=5;e<emval_handle_array.length;++e)if(void 0!==emval_handle_array[e])return emval_handle_array[e];return null}function init_emval(){Module.count_emval_handles=count_emval_handles,Module.get_first_emval=get_first_emval}function __emval_register(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=emval_free_list.length?emval_free_list.pop():emval_handle_array.length;return emval_handle_array[t]={refcount:1,value:e},t}}function simpleReadValueFromPointer(e){return this.fromWireType(HEAPU32[e>>2])}function __embind_register_emval(e,t){registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){var t=emval_handle_array[e].value;return __emval_decref(e),t},toWireType:function(e,t){return __emval_register(t)},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:null})}function _embind_repr(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function floatReadValueFromPointer(e,t){switch(t){case 2:return function(e){return this.fromWireType(HEAPF32[e>>2])};case 3:return function(e){return this.fromWireType(HEAPF64[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function __embind_register_float(e,t,r){var n=getShiftFromSize(r);registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+_embind_repr(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:floatReadValueFromPointer(t,n),destructorFunction:null})}function new_(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=createNamedFunction(e.name||"unknownFunctionName",(function(){}));r.prototype=e.prototype;var n=new r,i=e.apply(n,t);return i instanceof Object?i:n}function runDestructors(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function craftInvokerFunction(e,t,r,n,i){var o=t.length;o<2&&throwBindingError("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==r,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}var c="void"!==t[0].name,u="",d="";for(l=0;l<o-2;++l)u+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var h="return function "+makeLegalFunctionName(e)+"("+u+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";s&&(h+="var destructors = [];\n");var p=s?"destructors":"null",f=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=[throwBindingError,n,i,runDestructors,t[0],t[1]];for(a&&(h+="var thisWired = classParam.toWireType("+p+", this);\n"),l=0;l<o-2;++l)h+="var arg"+l+"Wired = argType"+l+".toWireType("+p+", arg"+l+"); // "+t[l+2].name+"\n",f.push("argType"+l),m.push(t[l+2]);if(a&&(d="thisWired"+(d.length>0?", ":"")+d),h+=(c?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",s)h+="runDestructors(destructors);\n";else for(l=a?1:2;l<t.length;++l){var v=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(h+=v+"_dtor("+v+"); // "+t[l].name+"\n",f.push(v+"_dtor"),m.push(t[l].destructorFunction))}return c&&(h+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),h+="}\n",f.push(h),new_(Function,f).apply(null,m)}function ensureOverloadTable(e,t,r){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||throwBindingError("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function exposePublicSymbol(e,t,r){Module.hasOwnProperty(e)?((void 0===r||void 0!==Module[e].overloadTable&&void 0!==Module[e].overloadTable[r])&&throwBindingError("Cannot register public name '"+e+"' twice"),ensureOverloadTable(Module,e,e),Module.hasOwnProperty(r)&&throwBindingError("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),Module[e].overloadTable[r]=t):(Module[e]=t,void 0!==r&&(Module[e].numArguments=r))}function heap32VectorToArray(e,t){for(var r=[],n=0;n<e;n++)r.push(HEAP32[(t>>2)+n]);return r}function replacePublicSymbol(e,t,r){Module.hasOwnProperty(e)||throwInternalError("Replacing nonexistant public symbol"),void 0!==Module[e].overloadTable&&void 0!==r?Module[e].overloadTable[r]=t:(Module[e]=t,Module[e].argCount=r)}function embind__requireFunction(e,t){var r;if(e=readLatin1String(e),void 0!==Module["FUNCTION_TABLE_"+e])r=Module["FUNCTION_TABLE_"+e][t];else if("undefined"!=typeof FUNCTION_TABLE)r=FUNCTION_TABLE[t];else{var n=Module.asm["dynCall_"+e];void 0===n&&void 0===(n=Module.asm["dynCall_"+e.replace(/f/g,"d")])&&throwBindingError("No dynCall invoker for signature: "+e),r=function(r){for(var n=[],i=1;i<e.length;++i)n.push("a"+i);var o="return function dynCall_"+e+"_"+t+"("+n.join(", ")+") {\n";return o+="    return dynCall(rawFunction"+(n.length?", ":"")+n.join(", ")+");\n",o+="};\n",new Function("dynCall","rawFunction",o)(r,t)}(n)}return"function"!=typeof r&&throwBindingError("unknown function pointer with signature "+e+": "+t),r}var UnboundTypeError=void 0;function getTypeName(e){var t=___getTypeName(e),r=readLatin1String(t);return _free(t),r}function throwUnboundTypeError(e,t){var r=[],n={};throw t.forEach((function e(t){n[t]||registeredTypes[t]||(typeDependencies[t]?typeDependencies[t].forEach(e):(r.push(t),n[t]=!0))})),new UnboundTypeError(e+": "+r.map(getTypeName).join([", "]))}function __embind_register_function(e,t,r,n,i,o){var a=heap32VectorToArray(t,r);e=readLatin1String(e),i=embind__requireFunction(n,i),exposePublicSymbol(e,(function(){throwUnboundTypeError("Cannot call "+e+" due to unbound types",a)}),t-1),whenDependentTypesAreResolved([],a,(function(r){var n=[r[0],null].concat(r.slice(1));return replacePublicSymbol(e,craftInvokerFunction(e,n,null,i,o),t-1),[]}))}function integerReadValueFromPointer(e,t,r){switch(t){case 0:return r?function(e){return HEAP8[e]}:function(e){return HEAPU8[e]};case 1:return r?function(e){return HEAP16[e>>1]}:function(e){return HEAPU16[e>>1]};case 2:return r?function(e){return HEAP32[e>>2]}:function(e){return HEAPU32[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function __embind_register_integer(e,t,r,n,i){t=readLatin1String(t),-1===i&&(i=4294967295);var o=getShiftFromSize(r),a=function(e){return e};if(0===n){var s=32-8*r;a=function(e){return e<<s>>>s}}var l=-1!=t.indexOf("unsigned");registerType(e,{name:t,fromWireType:a,toWireType:function(e,r){if("number"!=typeof r&&"boolean"!=typeof r)throw new TypeError('Cannot convert "'+_embind_repr(r)+'" to '+this.name);if(r<n||r>i)throw new TypeError('Passing a number "'+_embind_repr(r)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+i+"]!");return l?r>>>0:0|r},argPackAdvance:8,readValueFromPointer:integerReadValueFromPointer(t,o,0!==n),destructorFunction:null})}function __embind_register_memory_view(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=HEAPU32,r=t[e>>=2],i=t[e+1];return new n(t.buffer,i,r)}registerType(e,{name:r=readLatin1String(r),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})}function __embind_register_std_string(e,t){registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){for(var t=HEAPU32[e>>2],r=new Array(t),n=0;n<t;++n)r[n]=String.fromCharCode(HEAPU8[e+4+n]);return _free(e),r.join("")},toWireType:function(e,t){function r(e,t){return e[t]}var n;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array?n=r:"string"==typeof t?n=function(e,t){return e.charCodeAt(t)}:throwBindingError("Cannot pass non-string to std::string");var i=t.length,o=_malloc(4+i);HEAPU32[o>>2]=i;for(var a=0;a<i;++a){var s=n(t,a);s>255&&(_free(o),throwBindingError("String has UTF-16 code units that do not fit in 8 bits")),HEAPU8[o+4+a]=s}return null!==e&&e.push(_free,o),o},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(e){_free(e)}})}function __embind_register_std_wstring(e,t,r){var n,i;r=readLatin1String(r),2===t?(n=function(){return HEAPU16},i=1):4===t&&(n=function(){return HEAPU32},i=2),registerType(e,{name:r,fromWireType:function(e){for(var t=n(),r=HEAPU32[e>>2],o=new Array(r),a=e+4>>i,s=0;s<r;++s)o[s]=String.fromCharCode(t[a+s]);return _free(e),o.join("")},toWireType:function(e,r){var o=n(),a=r.length,s=_malloc(4+a*t);HEAPU32[s>>2]=a;for(var l=s+4>>i,c=0;c<a;++c)o[l+c]=r.charCodeAt(c);return null!==e&&e.push(_free,s),s},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(e){_free(e)}})}function __embind_register_void(e,t){registerType(e,{isVoid:!0,name:t=readLatin1String(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})}var _emscripten_asm_const_int=!0;function _emscripten_memcpy_big(e,t,r){return HEAPU8.set(HEAPU8.subarray(t,t+r),e),e}function ___setErrNo(e){return Module.___errno_location&&(HEAP32[Module.___errno_location()>>2]=e),e}embind_init_charCodes(),BindingError=Module.BindingError=extendError(Error,"BindingError"),InternalError=Module.InternalError=extendError(Error,"InternalError"),init_emval(),UnboundTypeError=Module.UnboundTypeError=extendError(Error,"UnboundTypeError"),DYNAMICTOP_PTR=staticAlloc(4),STACK_BASE=STACKTOP=alignMemory(STATICTOP),DYNAMIC_BASE=alignMemory(STACK_MAX=STACK_BASE+TOTAL_STACK),HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE,staticSealed=!0;var ASSERTIONS=!1;function intArrayFromString(e,t,r){var n=r>0?r:lengthBytesUTF8(e)+1,i=new Array(n),o=stringToUTF8Array(e,i,0,i.length);return t&&(i.length=o),i}function intArrayToString(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>255&&(ASSERTIONS&&assert(!1,"Character code "+n+" ("+String.fromCharCode(n)+")  at offset "+r+" not in 0x00-0xFF."),n&=255),t.push(String.fromCharCode(n))}return t.join("")}var decodeBase64="function"==typeof atob?atob:function(e){var t,r,n,i,o,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(o=s.indexOf(e.charAt(c++)))>>2,n=(3&o)<<6|(a=s.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!==o&&(l+=String.fromCharCode(r)),64!==a&&(l+=String.fromCharCode(n))}while(c<e.length);return l};function intArrayFromBase64(e){if("boolean"==typeof ENVIRONMENT_IS_NODE&&ENVIRONMENT_IS_NODE){var t;try{t=Buffer.from(e,"base64")}catch(r){t=new Buffer(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var r=decodeBase64(e),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n}catch(e){throw new Error("Converting base64 string to bytes failed.")}}function tryParseAsDataURI(e){if(isDataURI(e))return intArrayFromBase64(e.slice(dataURIPrefix.length))}function invoke_i(e){try{return Module.dynCall_i(e)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_ii(e,t){try{return Module.dynCall_ii(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_iiii(e,t,r,n){try{return Module.dynCall_iiii(e,t,r,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_vi(e,t){try{Module.dynCall_vi(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiii(e,t,r,n,i){try{Module.dynCall_viiii(e,t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiiii(e,t,r,n,i,o){try{Module.dynCall_viiiii(e,t,r,n,i,o)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiiiii(e,t,r,n,i,o,a){try{Module.dynCall_viiiiii(e,t,r,n,i,o,a)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}Module.asmGlobalArg={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0},Module.asmLibraryArg={abort:abort,assert:assert,enlargeMemory:enlargeMemory,getTotalMemory:getTotalMemory,abortOnCannotGrowMemory:abortOnCannotGrowMemory,invoke_i:invoke_i,invoke_ii:invoke_ii,invoke_iiii:invoke_iiii,invoke_vi:invoke_vi,invoke_viiii:invoke_viiii,invoke_viiiii:invoke_viiiii,invoke_viiiiii:invoke_viiiiii,__ZSt18uncaught_exceptionv:__ZSt18uncaught_exceptionv,___cxa_find_matching_catch:___cxa_find_matching_catch,___gxx_personality_v0:___gxx_personality_v0,___resumeException:___resumeException,___setErrNo:___setErrNo,__embind_register_bool:__embind_register_bool,__embind_register_emval:__embind_register_emval,__embind_register_float:__embind_register_float,__embind_register_function:__embind_register_function,__embind_register_integer:__embind_register_integer,__embind_register_memory_view:__embind_register_memory_view,__embind_register_std_string:__embind_register_std_string,__embind_register_std_wstring:__embind_register_std_wstring,__embind_register_void:__embind_register_void,__emval_decref:__emval_decref,__emval_register:__emval_register,_embind_repr:_embind_repr,_emscripten_asm_const_iii:_emscripten_asm_const_iii,_emscripten_memcpy_big:_emscripten_memcpy_big,count_emval_handles:count_emval_handles,craftInvokerFunction:craftInvokerFunction,createNamedFunction:createNamedFunction,embind__requireFunction:embind__requireFunction,embind_init_charCodes:embind_init_charCodes,ensureOverloadTable:ensureOverloadTable,exposePublicSymbol:exposePublicSymbol,extendError:extendError,floatReadValueFromPointer:floatReadValueFromPointer,getShiftFromSize:getShiftFromSize,getTypeName:getTypeName,get_first_emval:get_first_emval,heap32VectorToArray:heap32VectorToArray,init_emval:init_emval,integerReadValueFromPointer:integerReadValueFromPointer,makeLegalFunctionName:makeLegalFunctionName,new_:new_,readLatin1String:readLatin1String,registerType:registerType,replacePublicSymbol:replacePublicSymbol,runDestructors:runDestructors,simpleReadValueFromPointer:simpleReadValueFromPointer,throwBindingError:throwBindingError,throwInternalError:throwInternalError,throwUnboundTypeError:throwUnboundTypeError,whenDependentTypesAreResolved:whenDependentTypesAreResolved,DYNAMICTOP_PTR:DYNAMICTOP_PTR,tempDoublePtr:tempDoublePtr,ABORT:ABORT,STACKTOP:STACKTOP,STACK_MAX:STACK_MAX};var initialStackTop,asm=function(e,t,r){"use asm";var n=new e.Int8Array(r);var i=new e.Int16Array(r);var o=new e.Int32Array(r);var a=new e.Uint8Array(r);var s=new e.Uint16Array(r);var l=new e.Uint32Array(r);var c=new e.Float32Array(r);var u=new e.Float64Array(r);var d=t.DYNAMICTOP_PTR|0;var h=t.tempDoublePtr|0;var p=t.ABORT|0;var f=t.STACKTOP|0;var m=t.STACK_MAX|0;var v=0;var g=0;var b=0;var y=0;var _=e.NaN,E=e.Infinity;var A=0,w=0,T=0,k=0,R=0.0;var S=0;var x=e.Math.floor;var j=e.Math.abs;var C=e.Math.sqrt;var M=e.Math.pow;var I=e.Math.cos;var D=e.Math.sin;var O=e.Math.tan;var P=e.Math.acos;var N=e.Math.asin;var V=e.Math.atan;var H=e.Math.atan2;var L=e.Math.exp;var F=e.Math.log;var B=e.Math.ceil;var U=e.Math.imul;var z=e.Math.min;var G=e.Math.max;var W=e.Math.clz32;var q=t.abort;var K=t.assert;var X=t.enlargeMemory;var Z=t.getTotalMemory;var Q=t.abortOnCannotGrowMemory;var J=t.invoke_i;var Y=t.invoke_ii;var $=t.invoke_iiii;var ee=t.invoke_vi;var te=t.invoke_viiii;var re=t.invoke_viiiii;var ne=t.invoke_viiiiii;var ie=t.__ZSt18uncaught_exceptionv;var oe=t.___cxa_find_matching_catch;var ae=t.___gxx_personality_v0;var se=t.___resumeException;var le=t.___setErrNo;var ce=t.__embind_register_bool;var ue=t.__embind_register_emval;var de=t.__embind_register_float;var he=t.__embind_register_function;var pe=t.__embind_register_integer;var fe=t.__embind_register_memory_view;var me=t.__embind_register_std_string;var ve=t.__embind_register_std_wstring;var ge=t.__embind_register_void;var be=t.__emval_decref;var ye=t.__emval_register;var _e=t._embind_repr;var Ee=t._emscripten_asm_const_iii;var Ae=t._emscripten_memcpy_big;var we=t.count_emval_handles;var Te=t.craftInvokerFunction;var ke=t.createNamedFunction;var Re=t.embind__requireFunction;var Se=t.embind_init_charCodes;var xe=t.ensureOverloadTable;var je=t.exposePublicSymbol;var Ce=t.extendError;var Me=t.floatReadValueFromPointer;var Ie=t.getShiftFromSize;var De=t.getTypeName;var Oe=t.get_first_emval;var Pe=t.heap32VectorToArray;var Ne=t.init_emval;var Ve=t.integerReadValueFromPointer;var He=t.makeLegalFunctionName;var Le=t.new_;var Fe=t.readLatin1String;var Be=t.registerType;var Ue=t.replacePublicSymbol;var ze=t.runDestructors;var Ge=t.simpleReadValueFromPointer;var We=t.throwBindingError;var qe=t.throwInternalError;var Ke=t.throwUnboundTypeError;var Xe=t.whenDependentTypesAreResolved;var Ze=0.0;function Qe(e){e=e|0;var t=0;t=f;f=f+e|0;f=f+15&-16;return t|0}function Je(){return f|0}function Ye(e){e=e|0;f=e}function $e(e,t){e=e|0;t=t|0;f=e;m=t}function et(e,t){e=e|0;t=t|0;if((v|0)==0){v=e;g=t}}function tt(e){e=e|0;S=e}function rt(){return S|0}function nt(){var e=0,t=0,r=0;r=f;e=Ee(0,536|0,96)|0;return 1}function it(){var e=0,t=0;t=f;nt()|0;return}function ot(){var e=0,t=0;t=f;at(0);return}function at(e){e=e|0;var t=0,r=0;r=f;st(1307,1);return}function st(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,o=0,a=0,s=0;s=f;f=f+16|0;r=s;n=ct(r)|0;i=ut(r)|0;o=pt()|0;he(e|0,n|0,i|0,o|0,1|0,t|0);f=s;return}function lt(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=f;f=f+16|0;t=a;r=Gn[e&1]()|0;o[t>>2]=r;n=dt(t)|0;f=a;return n|0}function ct(e){e=e|0;var t=0,r=0;r=f;return 1}function ut(e){e=e|0;var t=0,r=0,n=0;n=f;t=ht()|0;return t|0}function dt(e){e=e|0;var t=0,r=0,n=0;n=f;t=o[e>>2]|0;return t|0}function ht(){var e=0,t=0;t=f;return 384|0}function pt(){var e=0,t=0;t=f;return 1318|0}function ft(){var e=0,t=0;t=f;it();ot();return}function mt(){var e=0,t=0;t=f;vt();return}function vt(){var e=0,t=0;t=f;gt(0);return}function gt(e){e=e|0;var t=0,r=0,n=0,i=0,o=0,a=0,s=0,l=0;l=f;t=bt()|0;ge(t|0,1321|0);r=yt()|0;ce(r|0,1326|0,1,1,0);_t();Et();At();wt();Tt();kt();Rt();St();xt();jt();Ct();n=Mt()|0;me(n|0,1331|0);i=It()|0;me(i|0,1343|0);o=Dt()|0;ve(o|0,4,1376|0);a=Ot()|0;ue(a|0,1389|0);Pt();Nt(1405);Vt(1442);Ht(1481);Lt(1512);Ft(1552);Bt(1581);Ut();zt();Nt(1619);Vt(1651);Ht(1684);Lt(1717);Ft(1751);Bt(1784);Gt();Wt();qt();return}function bt(){var e=0,t=0,r=0;r=f;e=Gr()|0;return e|0}function yt(){var e=0,t=0,r=0;r=f;e=zr()|0;return e|0}function _t(){var e=0,t=0,r=0;r=f;e=Br()|0;pe(e|0,2731|0,1,-128,127);return}function Et(){var e=0,t=0,r=0;r=f;e=Lr()|0;pe(e|0,2719|0,1,-128,127);return}function At(){var e=0,t=0,r=0;r=f;e=Vr()|0;pe(e|0,2705|0,1,0,255);return}function wt(){var e=0,t=0,r=0;r=f;e=Pr()|0;pe(e|0,2699|0,2,-32768,32767);return}function Tt(){var e=0,t=0,r=0;r=f;e=Dr()|0;pe(e|0,2684|0,2,0,65535);return}function kt(){var e=0,t=0,r=0;r=f;e=Mr()|0;pe(e|0,2680|0,4,-2147483648,2147483647);return}function Rt(){var e=0,t=0,r=0;r=f;e=jr()|0;pe(e|0,2667|0,4,0,-1);return}function St(){var e=0,t=0,r=0;r=f;e=Sr()|0;pe(e|0,2662|0,4,-2147483648,2147483647);return}function xt(){var e=0,t=0,r=0;r=f;e=kr()|0;pe(e|0,2648|0,4,0,-1);return}function jt(){var e=0,t=0,r=0;r=f;e=wr()|0;de(e|0,2642|0,4);return}function Ct(){var e=0,t=0,r=0;r=f;e=Er()|0;de(e|0,2635|0,8);return}function Mt(){var e=0,t=0,r=0;r=f;e=_r()|0;return e|0}function It(){var e=0,t=0,r=0;r=f;e=yr()|0;return e|0}function Dt(){var e=0,t=0,r=0;r=f;e=br()|0;return e|0}function Ot(){var e=0,t=0,r=0;r=f;e=gr()|0;return e|0}function Pt(){var e=0,t=0,r=0;r=f;e=mr()|0;fe(e|0,0,2328|0);return}function Nt(e){e=e|0;var t=0,r=0,n=0;n=f;t=pr()|0;fe(t|0,0,e|0);return}function Vt(e){e=e|0;var t=0,r=0,n=0;n=f;t=dr()|0;fe(t|0,1,e|0);return}function Ht(e){e=e|0;var t=0,r=0,n=0;n=f;t=cr()|0;fe(t|0,2,e|0);return}function Lt(e){e=e|0;var t=0,r=0,n=0;n=f;t=sr()|0;fe(t|0,3,e|0);return}function Ft(e){e=e|0;var t=0,r=0,n=0;n=f;t=or()|0;fe(t|0,4,e|0);return}function Bt(e){e=e|0;var t=0,r=0,n=0;n=f;t=nr()|0;fe(t|0,5,e|0);return}function Ut(){var e=0,t=0,r=0;r=f;e=tr()|0;fe(e|0,4,2081|0);return}function zt(){var e=0,t=0,r=0;r=f;e=$t()|0;fe(e|0,5,2011|0);return}function Gt(){var e=0,t=0,r=0;r=f;e=Jt()|0;fe(e|0,6,1949|0);return}function Wt(){var e=0,t=0,r=0;r=f;e=Zt()|0;fe(e|0,7,1886|0);return}function qt(){var e=0,t=0,r=0;r=f;e=Kt()|0;fe(e|0,7,1818|0);return}function Kt(){var e=0,t=0,r=0;r=f;e=Xt()|0;return e|0}function Xt(){var e=0,t=0;t=f;return 8|0}function Zt(){var e=0,t=0,r=0;r=f;e=Qt()|0;return e|0}function Qt(){var e=0,t=0;t=f;return 16|0}function Jt(){var e=0,t=0,r=0;r=f;e=Yt()|0;return e|0}function Yt(){var e=0,t=0;t=f;return 24|0}function $t(){var e=0,t=0,r=0;r=f;e=er()|0;return e|0}function er(){var e=0,t=0;t=f;return 32|0}function tr(){var e=0,t=0,r=0;r=f;e=rr()|0;return e|0}function rr(){var e=0,t=0;t=f;return 40|0}function nr(){var e=0,t=0,r=0;r=f;e=ir()|0;return e|0}function ir(){var e=0,t=0;t=f;return 48|0}function or(){var e=0,t=0,r=0;r=f;e=ar()|0;return e|0}function ar(){var e=0,t=0;t=f;return 56|0}function sr(){var e=0,t=0,r=0;r=f;e=lr()|0;return e|0}function lr(){var e=0,t=0;t=f;return 64|0}function cr(){var e=0,t=0,r=0;r=f;e=ur()|0;return e|0}function ur(){var e=0,t=0;t=f;return 72|0}function dr(){var e=0,t=0,r=0;r=f;e=hr()|0;return e|0}function hr(){var e=0,t=0;t=f;return 80|0}function pr(){var e=0,t=0,r=0;r=f;e=fr()|0;return e|0}function fr(){var e=0,t=0;t=f;return 88|0}function mr(){var e=0,t=0,r=0;r=f;e=vr()|0;return e|0}function vr(){var e=0,t=0;t=f;return 96|0}function gr(){var e=0,t=0;t=f;return 104|0}function br(){var e=0,t=0;t=f;return 112|0}function yr(){var e=0,t=0;t=f;return 144|0}function _r(){var e=0,t=0;t=f;return 168|0}function Er(){var e=0,t=0,r=0;r=f;e=Ar()|0;return e|0}function Ar(){var e=0,t=0;t=f;return 360|0}function wr(){var e=0,t=0,r=0;r=f;e=Tr()|0;return e|0}function Tr(){var e=0,t=0;t=f;return 352|0}function kr(){var e=0,t=0,r=0;r=f;e=Rr()|0;return e|0}function Rr(){var e=0,t=0;t=f;return 344|0}function Sr(){var e=0,t=0,r=0;r=f;e=xr()|0;return e|0}function xr(){var e=0,t=0;t=f;return 336|0}function jr(){var e=0,t=0,r=0;r=f;e=Cr()|0;return e|0}function Cr(){var e=0,t=0;t=f;return 328|0}function Mr(){var e=0,t=0,r=0;r=f;e=Ir()|0;return e|0}function Ir(){var e=0,t=0;t=f;return 320|0}function Dr(){var e=0,t=0,r=0;r=f;e=Or()|0;return e|0}function Or(){var e=0,t=0;t=f;return 312|0}function Pr(){var e=0,t=0,r=0;r=f;e=Nr()|0;return e|0}function Nr(){var e=0,t=0;t=f;return 304|0}function Vr(){var e=0,t=0,r=0;r=f;e=Hr()|0;return e|0}function Hr(){var e=0,t=0;t=f;return 288|0}function Lr(){var e=0,t=0,r=0;r=f;e=Fr()|0;return e|0}function Fr(){var e=0,t=0;t=f;return 296|0}function Br(){var e=0,t=0,r=0;r=f;e=Ur()|0;return e|0}function Ur(){var e=0,t=0;t=f;return 280|0}function zr(){var e=0,t=0;t=f;return 272|0}function Gr(){var e=0,t=0;t=f;return 264|0}function Wr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=f;t=e+4|0;r=o[t>>2]|0;n=Qr(r)|0;return n|0}function qr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0;var w=0,T=0,k=0,R=0,S=0,x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0,B=0,U=0;var z=0,G=0,W=0,q=0,K=0,X=0,Z=0,Q=0,J=0,Y=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,oe=0,ae=0,se=0,le=0;var ce=0,ue=0,de=0,he=0,pe=0,fe=0,me=0,ve=0,ge=0,be=0,ye=0,_e=0,Ee=0,Ae=0,we=0,Te=0,ke=0,Re=0,Se=0,xe=0;var je=0,Ce=0,Me=0,Ie=0,De=0,Oe=0,Pe=0,Ne=0,Ve=0,He=0,Le=0,Fe=0,Be=0,Ue=0,ze=0,Ge=0,We=0,qe=0,Ke=0,Xe=0;var Ze=0,Qe=0,Je=0,Ye=0,$e=0,et=0,tt=0,rt=0,nt=0,it=0,ot=0,at=0,st=0,lt=0,ct=0,ut=0,dt=0,ht=0,pt=0,ft=0;var mt=0,vt=0,gt=0,bt=0,yt=0,_t=0,Et=0,At=0,wt=0,Tt=0,kt=0,Rt=0,St=0,xt=0,jt=0,Ct=0,Mt=0,It=0,Dt=0,Ot=0;var Pt=0,Nt=0,Vt=0,Ht=0,Lt=0,Ft=0,Bt=0,Ut=0,zt=0,Gt=0,Wt=0,qt=0,Kt=0,Xt=0,Zt=0,Qt=0,Jt=0,Yt=0,$t=0,er=0;var tr=0,rr=0,nr=0,ir=0,or=0,ar=0,sr=0,lr=0,cr=0,ur=0,dr=0,hr=0,pr=0,fr=0,mr=0,vr=0,gr=0,br=0,yr=0,_r=0;var Er=0,Ar=0,wr=0,Tr=0,kr=0,Rr=0,Sr=0,xr=0,jr=0,Cr=0,Mr=0,Ir=0,Dr=0,Or=0,Pr=0,Nr=0,Vr=0,Hr=0,Lr=0,Fr=0;var Br=0,Ur=0,zr=0,Gr=0,Wr=0,qr=0,Kr=0,Zr=0,Qr=0,Jr=0,Yr=0,$r=0,en=0,tn=0,rn=0,nn=0,on=0,an=0,sn=0,ln=0;var cn=0,un=0,dn=0,hn=0,pn=0,fn=0,mn=0,vn=0,gn=0,bn=0,yn=0,_n=0,En=0,An=0,wn=0,Tn=0,kn=0,Rn=0,Sn=0,xn=0;var Cn=0,Mn=0,In=0,Dn=0,On=0,Pn=0,Nn=0,Vn=0,Hn=0,Ln=0,Fn=0,Bn=0,Un=0,zn=0,Gn=0,Wn=0,qn=0,Kn=0,Xn=0,Zn=0;var Qn=0,Jn=0,Yn=0,$n=0,ei=0,ti=0,ri=0,ni=0,ii=0,oi=0,ai=0,si=0,li=0,ci=0,ui=0,di=0,hi=0,pi=0,fi=0,mi=0;var vi=0,gi=0,bi=0,yi=0,_i=0,Ei=0,Ai=0,wi=0,Ti=0,ki=0,Ri=0,Si=0,xi=0,ji=0,Ci=0,Mi=0,Ii=0,Di=0,Oi=0,Pi=0;var Ni=0,Vi=0,Hi=0,Li=0,Fi=0,Bi=0,Ui=0,zi=0,Gi=0,Wi=0,qi=0,Ki=0,Xi=0,Zi=0,Qi=0,Ji=0,Yi=0,$i=0,eo=0,to=0;var ro=0,no=0,io=0,oo=0,ao=0,so=0,lo=0,co=0,uo=0,ho=0,po=0,fo=0,mo=0,vo=0,go=0,bo=0,yo=0,_o=0,Eo=0,Ao=0;var wo=0,To=0,ko=0,Ro=0,So=0,xo=0,jo=0,Co=0,Mo=0,Io=0,Do=0,Oo=0,Po=0,No=0,Vo=0,Ho=0,Lo=0,Fo=0,Bo=0,Uo=0;var zo=0,Go=0,Wo=0,qo=0,Ko=0,Xo=0,Zo=0,Qo=0,Jo=0,Yo=0,$o=0,ea=0,ta=0,ra=0,na=0,ia=0,oa=0,aa=0,sa=0,la=0;var ca=0,ua=0,da=0,ha=0,pa=0,fa=0,ma=0,va=0,ga=0,ba=0,ya=0,_a=0,Ea=0,Aa=0,wa=0,Ta=0,ka=0,Ra=0,Sa=0,xa=0;var ja=0,Ca=0,Ma=0,Ia=0,Da=0,Oa=0,Pa=0,Na=0,Va=0,Ha=0,La=0,Fa=0,Ba=0,Ua=0,za=0,Ga=0,Wa=0,qa=0,Ka=0,Xa=0;var Za=0,Qa=0,Ja=0,Ya=0,$a=0,es=0,ts=0,rs=0,ns=0,is=0,os=0,as=0,ss=0,ls=0,cs=0,us=0,ds=0,hs=0,ps=0,fs=0;var ms=0,vs=0,gs=0,bs=0,ys=0,_s=0,Es=0,As=0,ws=0,Ts=0,ks=0,Rs=0,Ss=0,xs=0,js=0,Cs=0,Ms=0,Is=0,Ds=0,Os=0;var Ps=0,Ns=0,Vs=0,Hs=0,Ls=0,Fs=0,Bs=0,Us=0,zs=0,Gs=0,Ws=0,qs=0,Ks=0,Xs=0,Zs=0,Qs=0,Js=0,Ys=0,$s=0,el=0;var tl=0,rl=0,nl=0,il=0,ol=0,al=0,sl=0,ll=0,cl=0,ul=0,dl=0,hl=0,pl=0,fl=0,ml=0,vl=0,gl=0,bl=0,yl=0,_l=0;var El=0,Al=0,wl=0,Tl=0,kl=0,Rl=0,Sl=0,xl=0,jl=0,Cl=0,Ml=0,Il=0,Dl=0,Ol=0,Pl=0,Nl=0,Vl=0,Hl=0,Ll=0,Fl=0;var Bl=0,Ul=0,zl=0,Gl=0,Wl=0,ql=0,Kl=0,Xl=0,Zl=0,Ql=0,Jl=0,Yl=0,$l=0,ec=0,tc=0,rc=0,nc=0,ic=0,oc=0,ac=0;var sc=0,lc=0,cc=0,uc=0,dc=0,hc=0,pc=0,fc=0,mc=0,vc=0,gc=0,bc=0,yc=0,_c=0,Ec=0,Ac=0,wc=0,Tc=0,kc=0,Rc=0;var Sc=0,xc=0,jc=0,Cc=0,Mc=0,Ic=0,Dc=0,Oc=0,Pc=0,Nc=0,Vc=0,Hc=0,Lc=0,Fc=0,Bc=0,Uc=0,zc=0,Gc=0,Wc=0,qc=0;var Kc=0,Xc=0,Zc=0,Qc=0,Jc=0,Yc=0,$c=0,eu=0,tu=0,ru=0,nu=0,iu=0,ou=0,au=0,su=0,lu=0,cu=0,uu=0,du=0,hu=0;var pu=0,fu=0,mu=0,vu=0,gu=0,bu=0,yu=0,_u=0,Eu=0,Au=0,wu=0,Tu=0,ku=0,Ru=0,Su=0,xu=0,ju=0,Cu=0,Mu=0,Iu=0;var Du=0,Ou=0,Pu=0,Nu=0,Vu=0,Hu=0,Lu=0,Fu=0,Bu=0,Uu=0,zu=0,Gu=0,Wu=0,qu=0,Ku=0,Xu=0,Zu=0,Qu=0,Ju=0,Yu=0;var $u=0,ed=0,td=0,rd=0,nd=0,id=0,od=0,ad=0,sd=0,ld=0,cd=0,ud=0,dd=0,hd=0,pd=0,fd=0,md=0,vd=0,gd=0,bd=0;var yd=0,_d=0,Ed=0,Ad=0,wd=0,Td=0,kd=0,Rd=0,Sd=0,xd=0,jd=0,Cd=0,Md=0,Id=0,Dd=0,Od=0,Pd=0,Nd=0,Vd=0,Hd=0;var Ld=0,Fd=0,Bd=0,Ud=0,zd=0,Gd=0,Wd=0,qd=0,Kd=0,Xd=0,Zd=0,Qd=0,Jd=0,Yd=0,$d=0,eh=0,th=0,rh=0,nh=0,ih=0;var oh=0,ah=0,sh=0,lh=0,ch=0,uh=0,dh=0,hh=0,ph=0,fh=0,mh=0,vh=0,gh=0,bh=0,yh=0,_h=0,Eh=0,Ah=0,wh=0,Th=0;var kh=0,Rh=0,Sh=0,xh=0,jh=0,Ch=0,Mh=0,Ih=0,Dh=0,Oh=0,Ph=0,Nh=0,Vh=0,Hh=0,Lh=0,Fh=0,Bh=0,Uh=0,zh=0,Gh=0;var Wh=0,qh=0,Kh=0,Xh=0,Zh=0,Qh=0,Jh=0,Yh=0,$h=0,ep=0,tp=0,rp=0,np=0,ip=0,op=0,ap=0,sp=0,lp=0,cp=0,up=0;var dp=0,hp=0,pp=0,fp=0,mp=0,vp=0,gp=0,bp=0,yp=0,_p=0,Ep=0,Ap=0,wp=0,Tp=0,kp=0,Rp=0,Sp=0,xp=0,jp=0,Cp=0;var Mp=0,Ip=0,Dp=0,Op=0,Pp=0,Np=0,Vp=0,Hp=0,Lp=0,Fp=0,Bp=0,Up=0,zp=0,Gp=0,Wp=0,qp=0,Kp=0,Xp=0,Zp=0,Qp=0;var Jp=0,Yp=0,$p=0,ef=0,tf=0,rf=0,nf=0,of=0,af=0,sf=0,lf=0,cf=0,uf=0,df=0,hf=0,pf=0,ff=0,mf=0,vf=0,gf=0;var bf=0,yf=0,_f=0,Ef=0,Af=0,wf=0,Tf=0,kf=0,Rf=0,Sf=0,xf=0,jf=0,Cf=0,Mf=0,If=0,Df=0,Of=0,Pf=0,Nf=0,Vf=0;var Hf=0,Lf=0,Ff=0,Bf=0,Uf=0,zf=0,Gf=0,Wf=0,qf=0,Kf=0,Xf=0,Zf=0,Qf=0,Jf=0,Yf=0,$f=0,em=0,tm=0,rm=0,nm=0;var im=0,om=0,am=0,sm=0,lm=0,cm=0,um=0,dm=0,hm=0,pm=0,fm=0,mm=0,vm=0,gm=0,bm=0,ym=0,_m=0,Em=0,Am=0,wm=0;var Tm=0,km=0,Rm=0,Sm=0,xm=0,jm=0,Cm=0,Mm=0,Im=0,Dm=0,Om=0,Pm=0,Nm=0,Vm=0,Hm=0,Lm=0,Fm=0,Bm=0,Um=0,zm=0;var Gm=0,Wm=0,qm=0,Km=0,Xm=0,Zm=0,Qm=0,Jm=0,Ym=0,$m=0,ev=0,tv=0,rv=0,nv=0,iv=0,ov=0,av=0,sv=0,lv=0,cv=0;var uv=0,dv=0,hv=0,pv=0,fv=0,mv=0,vv=0,gv=0,bv=0,yv=0,_v=0,Ev=0,Av=0,wv=0,Tv=0,kv=0,Rv=0,Sv=0,xv=0,jv=0;var Cv=0,Mv=0,Iv=0,Dv=0,Ov=0,Pv=0,Nv=0,Vv=0,Hv=0,Lv=0,Fv=0,Bv=0,Uv=0,zv=0,Gv=0,Wv=0,qv=0,Kv=0,Xv=0,Zv=0;var Qv=0,Jv=0,Yv=0,$v=0,eg=0,tg=0,rg=0,ng=0,ig=0,og=0,ag=0,sg=0,lg=0,cg=0,ug=0,dg=0,hg=0,pg=0,fg=0,mg=0;var vg=0,gg=0,bg=0,yg=0,_g=0,Eg=0,Ag=0,wg=0,Tg=0,kg=0,Rg=0,Sg=0,xg=0,jg=0,Cg=0,Mg=0,Ig=0,Dg=0,Og=0,Pg=0;var Ng=0,Vg=0,Hg=0,Lg=0,Fg=0,Bg=0,Ug=0,zg=0,Gg=0,Wg=0,qg=0,Kg=0,Xg=0,Zg=0,Qg=0,Jg=0,Yg=0,$g=0,eb=0,tb=0;var rb=0,nb=0,ib=0,ob=0,ab=0,sb=0,lb=0,cb=0,ub=0,db=0,hb=0,pb=0,fb=0,mb=0,vb=0,gb=0,bb=0,yb=0,_b=0,Eb=0;var Ab=0,wb=0,Tb=0,kb=0,Rb=0,Sb=0,xb=0,jb=0,Cb=0,Mb=0,Ib=0,Db=0,Ob=0,Pb=0,Nb=0,Vb=0,Hb=0,Lb=0,Fb=0,Bb=0;var Ub=0,zb=0,Gb=0,Wb=0,qb=0,Kb=0,Xb=0,Zb=0,Qb=0,Jb=0,Yb=0,$b=0,ey=0,ty=0,ry=0;ry=f;f=f+16|0;De=ry;Nr=e>>>0<245;do{if(Nr){Ui=e>>>0<11;qa=e+11|0;Zl=qa&-8;Yu=Ui?16:Zl;tp=Yu>>>3;om=o[740]|0;lg=om>>>tp;Oe=lg&3;We=(Oe|0)==0;if(!We){rt=lg&1;pt=rt^1;Tt=pt+tp|0;Pt=Tt<<1;qt=3000+(Pt<<2)|0;nr=qt+8|0;fr=o[nr>>2]|0;kr=fr+8|0;Vr=o[kr>>2]|0;Zr=(Vr|0)==(qt|0);if(Zr){sn=1<<Tt;bn=sn^-1;Cn=om&bn;o[740]=Cn}else{Bn=Vr+12|0;o[Bn>>2]=qt;o[nr>>2]=Vr}Yn=Tt<<3;ci=Yn|3;_i=fr+4|0;o[_i>>2]=ci;Mi=fr+Yn|0;zi=Mi+4|0;eo=o[zi>>2]|0;ho=eo|1;o[zi>>2]=ho;s=kr;f=ry;return s|0}wo=o[2968>>2]|0;Oo=Yu>>>0>wo>>>0;if(Oo){Wo=(lg|0)==0;if(!Wo){ra=lg<<tp;pa=2<<tp;Ta=0-pa|0;Pa=pa|Ta;Ka=ra&Pa;is=0-Ka|0;ms=Ka&is;Rs=ms+-1|0;Vs=Rs>>>12;Xs=Vs&16;ol=Rs>>>Xs;vl=ol>>>5;Sl=vl&8;Hl=Sl|Xs;Ql=ol>>>Sl;sc=Ql>>>2;bc=sc&4;jc=Hl|bc;Fc=Ql>>>bc;Jc=Fc>>>1;lu=Jc&2;yu=jc|lu;Cu=Fc>>>lu;Bu=Cu>>>1;$u=Bu&1;ud=yu|$u;Ed=Cu>>>$u;Id=ud+Ed|0;zd=Id<<1;eh=3000+(zd<<2)|0;dh=eh+8|0;Ah=o[dh>>2]|0;Dh=Ah+8|0;Gh=o[Dh>>2]|0;rp=(Gh|0)==(eh|0);if(rp){pp=1<<Id;Tp=pp^-1;Pp=om&Tp;o[740]=Pp;cg=Pp}else{qp=Gh+12|0;o[qp>>2]=eh;o[dh>>2]=Gh;cg=om}nf=Id<<3;mf=nf-Yu|0;Rf=Yu|3;Vf=Ah+4|0;o[Vf>>2]=Rf;Xf=Ah+Yu|0;am=mf|1;gm=Xf+4|0;o[gm>>2]=am;xm=Ah+nf|0;o[xm>>2]=mf;Lm=(wo|0)==0;if(!Lm){Qm=o[2980>>2]|0;sv=wo>>>3;bv=sv<<1;jv=3000+(bv<<2)|0;Fv=1<<sv;Jv=cg&Fv;_g=(Jv|0)==0;if(_g){Mg=cg|Fv;o[740]=Mg;ve=jv+8|0;b=jv;Re=ve}else{Ug=jv+8|0;$g=o[Ug>>2]|0;b=$g;Re=Ug}o[Re>>2]=Qm;ub=b+12|0;o[ub>>2]=Qm;Eb=Qm+8|0;o[Eb>>2]=b;Ib=Qm+12|0;o[Ib>>2]=jv}o[2968>>2]=mf;o[2980>>2]=Xf;s=Dh;f=ry;return s|0}Pb=o[2964>>2]|0;Nb=(Pb|0)==0;if(Nb){g=Yu}else{Pe=0-Pb|0;Ne=Pb&Pe;Ve=Ne+-1|0;He=Ve>>>12;Le=He&16;Fe=Ve>>>Le;Be=Fe>>>5;Ue=Be&8;ze=Ue|Le;Ge=Fe>>>Ue;qe=Ge>>>2;Ke=qe&4;Xe=ze|Ke;Ze=Ge>>>Ke;Qe=Ze>>>1;Je=Qe&2;Ye=Xe|Je;$e=Ze>>>Je;et=$e>>>1;tt=et&1;nt=Ye|tt;it=$e>>>tt;ot=nt+it|0;at=3264+(ot<<2)|0;st=o[at>>2]|0;lt=st+4|0;ct=o[lt>>2]|0;ut=ct&-8;dt=ut-Yu|0;ht=st+16|0;ft=o[ht>>2]|0;mt=(ft|0)==(0|0);je=mt&1;vt=(st+16|0)+(je<<2)|0;gt=o[vt>>2]|0;bt=(gt|0)==(0|0);if(bt){h=st;m=dt}else{p=st;v=dt;_t=gt;while(1){yt=_t+4|0;Et=o[yt>>2]|0;At=Et&-8;wt=At-Yu|0;kt=wt>>>0<v>>>0;r=kt?wt:v;t=kt?_t:p;Rt=_t+16|0;St=o[Rt>>2]|0;xt=(St|0)==(0|0);Se=xt&1;jt=(_t+16|0)+(Se<<2)|0;Ct=o[jt>>2]|0;Mt=(Ct|0)==(0|0);if(Mt){h=t;m=r;break}else{p=t;v=r;_t=Ct}}}It=h+Yu|0;Dt=It>>>0>h>>>0;if(Dt){Ot=h+24|0;Nt=o[Ot>>2]|0;Vt=h+12|0;Ht=o[Vt>>2]|0;Lt=(Ht|0)==(h|0);do{if(Lt){Gt=h+20|0;Wt=o[Gt>>2]|0;Kt=(Wt|0)==(0|0);if(Kt){Xt=h+16|0;Zt=o[Xt>>2]|0;Qt=(Zt|0)==(0|0);if(Qt){ee=0;break}else{F=Zt;B=Xt}}else{F=Wt;B=Gt}while(1){Jt=F+20|0;Yt=o[Jt>>2]|0;$t=(Yt|0)==(0|0);if(!$t){F=Yt;B=Jt;continue}er=F+16|0;tr=o[er>>2]|0;rr=(tr|0)==(0|0);if(rr){break}else{F=tr;B=er}}o[B>>2]=0;ee=F}else{Ft=h+8|0;Bt=o[Ft>>2]|0;Ut=Bt+12|0;o[Ut>>2]=Ht;zt=Ht+8|0;o[zt>>2]=Bt;ee=Ht}}while(0);ir=(Nt|0)==(0|0);do{if(!ir){or=h+28|0;ar=o[or>>2]|0;sr=3264+(ar<<2)|0;lr=o[sr>>2]|0;cr=(h|0)==(lr|0);if(cr){o[sr>>2]=ee;Vb=(ee|0)==(0|0);if(Vb){ur=1<<ar;dr=ur^-1;hr=Pb&dr;o[2964>>2]=hr;break}}else{pr=Nt+16|0;mr=o[pr>>2]|0;vr=(mr|0)!=(h|0);Ce=vr&1;gr=(Nt+16|0)+(Ce<<2)|0;o[gr>>2]=ee;br=(ee|0)==(0|0);if(br){break}}yr=ee+24|0;o[yr>>2]=Nt;_r=h+16|0;Er=o[_r>>2]|0;Ar=(Er|0)==(0|0);if(!Ar){wr=ee+16|0;o[wr>>2]=Er;Tr=Er+24|0;o[Tr>>2]=ee}Rr=h+20|0;Sr=o[Rr>>2]|0;xr=(Sr|0)==(0|0);if(!xr){jr=ee+20|0;o[jr>>2]=Sr;Cr=Sr+24|0;o[Cr>>2]=ee}}}while(0);Mr=m>>>0<16;if(Mr){Ir=m+Yu|0;Dr=Ir|3;Or=h+4|0;o[Or>>2]=Dr;Pr=h+Ir|0;Hr=Pr+4|0;Lr=o[Hr>>2]|0;Fr=Lr|1;o[Hr>>2]=Fr}else{Br=Yu|3;Ur=h+4|0;o[Ur>>2]=Br;zr=m|1;Gr=It+4|0;o[Gr>>2]=zr;Wr=It+m|0;o[Wr>>2]=m;qr=(wo|0)==0;if(!qr){Kr=o[2980>>2]|0;Qr=wo>>>3;Jr=Qr<<1;Yr=3000+(Jr<<2)|0;$r=1<<Qr;en=om&$r;tn=(en|0)==0;if(tn){rn=om|$r;o[740]=rn;ge=Yr+8|0;l=Yr;ke=ge}else{nn=Yr+8|0;on=o[nn>>2]|0;l=on;ke=nn}o[ke>>2]=Kr;an=l+12|0;o[an>>2]=Kr;ln=Kr+8|0;o[ln>>2]=l;cn=Kr+12|0;o[cn>>2]=Yr}o[2968>>2]=m;o[2980>>2]=It}un=h+8|0;s=un;f=ry;return s|0}else{g=Yu}}}else{g=Yu}}else{dn=e>>>0>4294967231;if(dn){g=-1}else{hn=e+11|0;pn=hn&-8;fn=o[2964>>2]|0;mn=(fn|0)==0;if(mn){g=pn}else{vn=0-pn|0;gn=hn>>>8;yn=(gn|0)==0;if(yn){O=0}else{_n=pn>>>0>16777215;if(_n){O=31}else{En=gn+1048320|0;An=En>>>16;wn=An&8;Tn=gn<<wn;kn=Tn+520192|0;Rn=kn>>>16;Sn=Rn&4;xn=Sn|wn;Mn=Tn<<Sn;In=Mn+245760|0;Dn=In>>>16;On=Dn&2;Pn=xn|On;Nn=14-Pn|0;Vn=Mn<<On;Hn=Vn>>>15;Ln=Nn+Hn|0;Fn=Ln<<1;Un=Ln+7|0;zn=pn>>>Un;Gn=zn&1;Wn=Gn|Fn;O=Wn}}qn=3264+(O<<2)|0;Kn=o[qn>>2]|0;Xn=(Kn|0)==(0|0);e:do{if(Xn){$=0;re=0;ne=vn;ty=57}else{Zn=(O|0)==31;Qn=O>>>1;Jn=25-Qn|0;$n=Zn?0:Jn;ei=pn<<$n;j=0;I=vn;D=Kn;N=ei;H=0;while(1){ti=D+4|0;ri=o[ti>>2]|0;ni=ri&-8;ii=ni-pn|0;oi=ii>>>0<I>>>0;if(oi){ai=(ii|0)==0;if(ai){ce=0;he=D;pe=D;ty=61;break e}else{W=D;q=ii}}else{W=j;q=I}si=D+20|0;li=o[si>>2]|0;ui=N>>>31;di=(D+16|0)+(ui<<2)|0;hi=o[di>>2]|0;pi=(li|0)==(0|0);fi=(li|0)==(hi|0);Wb=pi|fi;K=Wb?H:li;mi=(hi|0)==(0|0);Bb=mi^1;vi=Bb&1;P=N<<vi;if(mi){$=K;re=W;ne=q;ty=57;break}else{j=W;I=q;D=hi;N=P;H=K}}}}while(0);if((ty|0)==57){gi=($|0)==(0|0);bi=(re|0)==(0|0);zb=gi&bi;if(zb){yi=2<<O;Ei=0-yi|0;Ai=yi|Ei;wi=fn&Ai;Ti=(wi|0)==0;if(Ti){g=pn;break}ki=0-wi|0;Ri=wi&ki;Si=Ri+-1|0;xi=Si>>>12;ji=xi&16;Ci=Si>>>ji;Ii=Ci>>>5;Di=Ii&8;Oi=Di|ji;Pi=Ci>>>Di;Ni=Pi>>>2;Vi=Ni&4;Hi=Oi|Vi;Li=Pi>>>Vi;Fi=Li>>>1;Bi=Fi&2;Gi=Hi|Bi;Wi=Li>>>Bi;qi=Wi>>>1;Ki=qi&1;Xi=Gi|Ki;Zi=Wi>>>Ki;Qi=Xi+Zi|0;Ji=3264+(Qi<<2)|0;Yi=o[Ji>>2]|0;ae=0;de=Yi}else{ae=re;de=$}$i=(de|0)==(0|0);if($i){oe=ae;le=ne}else{ce=ne;he=de;pe=ae;ty=61}}if((ty|0)==61){while(1){ty=0;to=he+4|0;ro=o[to>>2]|0;no=ro&-8;io=no-pn|0;oo=io>>>0<ce>>>0;i=oo?io:ce;ue=oo?he:pe;ao=he+16|0;so=o[ao>>2]|0;lo=(so|0)==(0|0);Me=lo&1;co=(he+16|0)+(Me<<2)|0;uo=o[co>>2]|0;po=(uo|0)==(0|0);if(po){oe=ue;le=i;break}else{ce=i;he=uo;pe=ue;ty=61}}}fo=(oe|0)==(0|0);if(fo){g=pn}else{mo=o[2968>>2]|0;vo=mo-pn|0;go=le>>>0<vo>>>0;if(go){bo=oe+pn|0;yo=bo>>>0>oe>>>0;if(!yo){s=0;f=ry;return s|0}_o=oe+24|0;Eo=o[_o>>2]|0;Ao=oe+12|0;To=o[Ao>>2]|0;ko=(To|0)==(oe|0);do{if(ko){Co=oe+20|0;Mo=o[Co>>2]|0;Io=(Mo|0)==(0|0);if(Io){Do=oe+16|0;Po=o[Do>>2]|0;No=(Po|0)==(0|0);if(No){ie=0;break}else{X=Po;Z=Do}}else{X=Mo;Z=Co}while(1){Vo=X+20|0;Ho=o[Vo>>2]|0;Lo=(Ho|0)==(0|0);if(!Lo){X=Ho;Z=Vo;continue}Fo=X+16|0;Bo=o[Fo>>2]|0;Uo=(Bo|0)==(0|0);if(Uo){break}else{X=Bo;Z=Fo}}o[Z>>2]=0;ie=X}else{Ro=oe+8|0;So=o[Ro>>2]|0;xo=So+12|0;o[xo>>2]=To;jo=To+8|0;o[jo>>2]=So;ie=To}}while(0);zo=(Eo|0)==(0|0);do{if(zo){xs=fn}else{Go=oe+28|0;qo=o[Go>>2]|0;Ko=3264+(qo<<2)|0;Xo=o[Ko>>2]|0;Zo=(oe|0)==(Xo|0);if(Zo){o[Ko>>2]=ie;Lb=(ie|0)==(0|0);if(Lb){Qo=1<<qo;Jo=Qo^-1;Yo=fn&Jo;o[2964>>2]=Yo;xs=Yo;break}}else{$o=Eo+16|0;ea=o[$o>>2]|0;ta=(ea|0)!=(oe|0);Ie=ta&1;na=(Eo+16|0)+(Ie<<2)|0;o[na>>2]=ie;ia=(ie|0)==(0|0);if(ia){xs=fn;break}}oa=ie+24|0;o[oa>>2]=Eo;aa=oe+16|0;sa=o[aa>>2]|0;la=(sa|0)==(0|0);if(!la){ca=ie+16|0;o[ca>>2]=sa;ua=sa+24|0;o[ua>>2]=ie}da=oe+20|0;ha=o[da>>2]|0;fa=(ha|0)==(0|0);if(fa){xs=fn}else{ma=ie+20|0;o[ma>>2]=ha;va=ha+24|0;o[va>>2]=ie;xs=fn}}}while(0);ga=le>>>0<16;do{if(ga){ba=le+pn|0;ya=ba|3;_a=oe+4|0;o[_a>>2]=ya;Ea=oe+ba|0;Aa=Ea+4|0;wa=o[Aa>>2]|0;ka=wa|1;o[Aa>>2]=ka}else{Ra=pn|3;Sa=oe+4|0;o[Sa>>2]=Ra;xa=le|1;ja=bo+4|0;o[ja>>2]=xa;Ca=bo+le|0;o[Ca>>2]=le;Ma=le>>>3;Ia=le>>>0<256;if(Ia){Da=Ma<<1;Oa=3000+(Da<<2)|0;Na=o[740]|0;Va=1<<Ma;Ha=Na&Va;La=(Ha|0)==0;if(La){Fa=Na|Va;o[740]=Fa;Ee=Oa+8|0;L=Oa;Te=Ee}else{Ba=Oa+8|0;Ua=o[Ba>>2]|0;L=Ua;Te=Ba}o[Te>>2]=bo;za=L+12|0;o[za>>2]=bo;Ga=bo+8|0;o[Ga>>2]=L;Wa=bo+12|0;o[Wa>>2]=Oa;break}Xa=le>>>8;Za=(Xa|0)==0;if(Za){V=0}else{Qa=le>>>0>16777215;if(Qa){V=31}else{Ja=Xa+1048320|0;Ya=Ja>>>16;$a=Ya&8;es=Xa<<$a;ts=es+520192|0;rs=ts>>>16;ns=rs&4;os=ns|$a;as=es<<ns;ss=as+245760|0;ls=ss>>>16;cs=ls&2;us=os|cs;ds=14-us|0;hs=as<<cs;ps=hs>>>15;fs=ds+ps|0;vs=fs<<1;gs=fs+7|0;bs=le>>>gs;ys=bs&1;_s=ys|vs;V=_s}}Es=3264+(V<<2)|0;As=bo+28|0;o[As>>2]=V;ws=bo+16|0;Ts=ws+4|0;o[Ts>>2]=0;o[ws>>2]=0;ks=1<<V;Ss=xs&ks;js=(Ss|0)==0;if(js){Cs=xs|ks;o[2964>>2]=Cs;o[Es>>2]=bo;Ms=bo+24|0;o[Ms>>2]=Es;Is=bo+12|0;o[Is>>2]=bo;Ds=bo+8|0;o[Ds>>2]=bo;break}Os=o[Es>>2]|0;Ps=(V|0)==31;Ns=V>>>1;Hs=25-Ns|0;Ls=Ps?0:Hs;Fs=le<<Ls;C=Fs;M=Os;while(1){Bs=M+4|0;Us=o[Bs>>2]|0;zs=Us&-8;Gs=(zs|0)==(le|0);if(Gs){ty=97;break}Ws=C>>>31;qs=(M+16|0)+(Ws<<2)|0;Ks=C<<1;Zs=o[qs>>2]|0;Qs=(Zs|0)==(0|0);if(Qs){ty=96;break}else{C=Ks;M=Zs}}if((ty|0)==96){o[qs>>2]=bo;Js=bo+24|0;o[Js>>2]=M;Ys=bo+12|0;o[Ys>>2]=bo;$s=bo+8|0;o[$s>>2]=bo;break}else if((ty|0)==97){el=M+8|0;tl=o[el>>2]|0;rl=tl+12|0;o[rl>>2]=bo;o[el>>2]=bo;nl=bo+8|0;o[nl>>2]=tl;il=bo+12|0;o[il>>2]=M;al=bo+24|0;o[al>>2]=0;break}}}while(0);sl=oe+8|0;s=sl;f=ry;return s|0}else{g=pn}}}}}}while(0);ll=o[2968>>2]|0;cl=ll>>>0<g>>>0;if(!cl){ul=ll-g|0;dl=o[2980>>2]|0;hl=ul>>>0>15;if(hl){pl=dl+g|0;o[2980>>2]=pl;o[2968>>2]=ul;fl=ul|1;ml=pl+4|0;o[ml>>2]=fl;gl=dl+ll|0;o[gl>>2]=ul;bl=g|3;yl=dl+4|0;o[yl>>2]=bl}else{o[2968>>2]=0;o[2980>>2]=0;_l=ll|3;El=dl+4|0;o[El>>2]=_l;Al=dl+ll|0;wl=Al+4|0;Tl=o[wl>>2]|0;kl=Tl|1;o[wl>>2]=kl}Rl=dl+8|0;s=Rl;f=ry;return s|0}xl=o[2972>>2]|0;jl=xl>>>0>g>>>0;if(jl){Cl=xl-g|0;o[2972>>2]=Cl;Ml=o[2984>>2]|0;Il=Ml+g|0;o[2984>>2]=Il;Dl=Cl|1;Ol=Il+4|0;o[Ol>>2]=Dl;Pl=g|3;Nl=Ml+4|0;o[Nl>>2]=Pl;Vl=Ml+8|0;s=Vl;f=ry;return s|0}Ll=o[858]|0;Fl=(Ll|0)==0;if(Fl){o[3440>>2]=4096;o[3436>>2]=4096;o[3444>>2]=-1;o[3448>>2]=-1;o[3452>>2]=0;o[3404>>2]=0;Bl=De;Ul=Bl&-16;zl=Ul^1431655768;o[858]=zl;Kl=4096}else{_e=o[3440>>2]|0;Kl=_e}Gl=g+48|0;Wl=g+47|0;ql=Kl+Wl|0;Xl=0-Kl|0;Jl=ql&Xl;Yl=Jl>>>0>g>>>0;if(!Yl){s=0;f=ry;return s|0}$l=o[3400>>2]|0;ec=($l|0)==0;if(!ec){tc=o[3392>>2]|0;rc=tc+Jl|0;nc=rc>>>0<=tc>>>0;ic=rc>>>0>$l>>>0;Gb=nc|ic;if(Gb){s=0;f=ry;return s|0}}oc=o[3404>>2]|0;ac=oc&4;lc=(ac|0)==0;e:do{if(lc){cc=o[2984>>2]|0;uc=(cc|0)==(0|0);t:do{if(uc){ty=118}else{d=3408;while(1){dc=o[d>>2]|0;hc=dc>>>0>cc>>>0;if(!hc){pc=d+4|0;fc=o[pc>>2]|0;mc=dc+fc|0;vc=mc>>>0>cc>>>0;if(vc){break}}gc=d+8|0;yc=o[gc>>2]|0;_c=(yc|0)==(0|0);if(_c){ty=118;break t}else{d=yc}}Wc=ql-xl|0;qc=Wc&Xl;Kc=qc>>>0<2147483647;if(Kc){Xc=jn(qc|0)|0;Zc=o[d>>2]|0;Qc=o[pc>>2]|0;Yc=Zc+Qc|0;$c=(Xc|0)==(Yc|0);if($c){eu=(Xc|0)==(-1|0);if(eu){Q=qc}else{fe=qc;me=Xc;ty=135;break e}}else{J=Xc;Y=qc;ty=126}}else{Q=0}}}while(0);do{if((ty|0)==118){Ec=jn(0)|0;Ac=(Ec|0)==(-1|0);if(Ac){Q=0}else{wc=Ec;Tc=o[3436>>2]|0;kc=Tc+-1|0;Rc=kc&wc;Sc=(Rc|0)==0;xc=kc+wc|0;Cc=0-Tc|0;Mc=xc&Cc;Ic=Mc-wc|0;Dc=Sc?0:Ic;a=Dc+Jl|0;Oc=o[3392>>2]|0;Pc=a+Oc|0;Nc=a>>>0>g>>>0;Vc=a>>>0<2147483647;Ub=Nc&Vc;if(Ub){Hc=o[3400>>2]|0;Lc=(Hc|0)==0;if(!Lc){Bc=Pc>>>0<=Oc>>>0;Uc=Pc>>>0>Hc>>>0;Qb=Bc|Uc;if(Qb){Q=0;break}}zc=jn(a|0)|0;Gc=(zc|0)==(Ec|0);if(Gc){fe=a;me=Ec;ty=135;break e}else{J=zc;Y=a;ty=126}}else{Q=0}}}}while(0);do{if((ty|0)==126){tu=0-Y|0;ru=(J|0)!=(-1|0);nu=Y>>>0<2147483647;ey=nu&ru;iu=Gl>>>0>Y>>>0;qb=iu&ey;if(!qb){mu=(J|0)==(-1|0);if(mu){Q=0;break}else{fe=Y;me=J;ty=135;break e}}ou=o[3440>>2]|0;au=Wl-Y|0;su=au+ou|0;cu=0-ou|0;uu=su&cu;du=uu>>>0<2147483647;if(!du){fe=Y;me=J;ty=135;break e}hu=jn(uu|0)|0;pu=(hu|0)==(-1|0);if(pu){jn(tu|0)|0;Q=0;break}else{fu=uu+Y|0;fe=fu;me=J;ty=135;break e}}}while(0);vu=o[3404>>2]|0;gu=vu|4;o[3404>>2]=gu;se=Q;ty=133}else{se=0;ty=133}}while(0);if((ty|0)==133){bu=Jl>>>0<2147483647;if(bu){_u=jn(Jl|0)|0;Eu=jn(0)|0;Au=(_u|0)!=(-1|0);wu=(Eu|0)!=(-1|0);Yb=Au&wu;Tu=_u>>>0<Eu>>>0;Kb=Tu&Yb;ku=Eu;Ru=_u;Su=ku-Ru|0;xu=g+40|0;ju=Su>>>0>xu>>>0;n=ju?Su:se;Xb=Kb^1;Mu=(_u|0)==(-1|0);Fb=ju^1;Iu=Mu|Fb;Jb=Iu|Xb;if(!Jb){fe=n;me=_u;ty=135}}}if((ty|0)==135){Du=o[3392>>2]|0;Ou=Du+fe|0;o[3392>>2]=Ou;Pu=o[3396>>2]|0;Nu=Ou>>>0>Pu>>>0;if(Nu){o[3396>>2]=Ou}Vu=o[2984>>2]|0;Hu=(Vu|0)==(0|0);do{if(Hu){Lu=o[2976>>2]|0;Fu=(Lu|0)==(0|0);Uu=me>>>0<Lu>>>0;Zb=Fu|Uu;if(Zb){o[2976>>2]=me}o[3408>>2]=me;o[3412>>2]=fe;o[3420>>2]=0;zu=o[858]|0;o[2996>>2]=zu;o[2992>>2]=-1;o[3012>>2]=3e3;o[3008>>2]=3e3;o[3020>>2]=3008;o[3016>>2]=3008;o[3028>>2]=3016;o[3024>>2]=3016;o[3036>>2]=3024;o[3032>>2]=3024;o[3044>>2]=3032;o[3040>>2]=3032;o[3052>>2]=3040;o[3048>>2]=3040;o[3060>>2]=3048;o[3056>>2]=3048;o[3068>>2]=3056;o[3064>>2]=3056;o[3076>>2]=3064;o[3072>>2]=3064;o[3084>>2]=3072;o[3080>>2]=3072;o[3092>>2]=3080;o[3088>>2]=3080;o[3100>>2]=3088;o[3096>>2]=3088;o[3108>>2]=3096;o[3104>>2]=3096;o[3116>>2]=3104;o[3112>>2]=3104;o[3124>>2]=3112;o[3120>>2]=3112;o[3132>>2]=3120;o[3128>>2]=3120;o[3140>>2]=3128;o[3136>>2]=3128;o[3148>>2]=3136;o[3144>>2]=3136;o[3156>>2]=3144;o[3152>>2]=3144;o[3164>>2]=3152;o[3160>>2]=3152;o[3172>>2]=3160;o[3168>>2]=3160;o[3180>>2]=3168;o[3176>>2]=3168;o[3188>>2]=3176;o[3184>>2]=3176;o[3196>>2]=3184;o[3192>>2]=3184;o[3204>>2]=3192;o[3200>>2]=3192;o[3212>>2]=3200;o[3208>>2]=3200;o[3220>>2]=3208;o[3216>>2]=3208;o[3228>>2]=3216;o[3224>>2]=3216;o[3236>>2]=3224;o[3232>>2]=3224;o[3244>>2]=3232;o[3240>>2]=3232;o[3252>>2]=3240;o[3248>>2]=3240;o[3260>>2]=3248;o[3256>>2]=3248;Gu=fe+-40|0;Wu=me+8|0;qu=Wu;Ku=qu&7;Xu=(Ku|0)==0;Zu=0-qu|0;Qu=Zu&7;Ju=Xu?0:Qu;ed=me+Ju|0;td=Gu-Ju|0;o[2984>>2]=ed;o[2972>>2]=td;rd=td|1;nd=ed+4|0;o[nd>>2]=rd;id=me+Gu|0;od=id+4|0;o[od>>2]=40;ad=o[3448>>2]|0;o[2988>>2]=ad}else{w=3408;while(1){sd=o[w>>2]|0;ld=w+4|0;cd=o[ld>>2]|0;dd=sd+cd|0;hd=(me|0)==(dd|0);if(hd){ty=143;break}pd=w+8|0;fd=o[pd>>2]|0;md=(fd|0)==(0|0);if(md){break}else{w=fd}}if((ty|0)==143){vd=w+12|0;gd=o[vd>>2]|0;bd=gd&8;yd=(bd|0)==0;if(yd){_d=sd>>>0<=Vu>>>0;Ad=me>>>0>Vu>>>0;$b=Ad&_d;if($b){wd=cd+fe|0;o[ld>>2]=wd;Td=o[2972>>2]|0;kd=Td+fe|0;Rd=Vu+8|0;Sd=Rd;xd=Sd&7;jd=(xd|0)==0;Cd=0-Sd|0;Md=Cd&7;Dd=jd?0:Md;Od=Vu+Dd|0;Pd=kd-Dd|0;o[2984>>2]=Od;o[2972>>2]=Pd;Nd=Pd|1;Vd=Od+4|0;o[Vd>>2]=Nd;Hd=Vu+kd|0;Ld=Hd+4|0;o[Ld>>2]=40;Fd=o[3448>>2]|0;o[2988>>2]=Fd;break}}}Bd=o[2976>>2]|0;Ud=me>>>0<Bd>>>0;if(Ud){o[2976>>2]=me}Gd=me+fe|0;U=3408;while(1){Wd=o[U>>2]|0;qd=(Wd|0)==(Gd|0);if(qd){ty=151;break}Kd=U+8|0;Xd=o[Kd>>2]|0;Zd=(Xd|0)==(0|0);if(Zd){u=3408;break}else{U=Xd}}if((ty|0)==151){Qd=U+12|0;Jd=o[Qd>>2]|0;Yd=Jd&8;$d=(Yd|0)==0;if($d){o[U>>2]=me;th=U+4|0;rh=o[th>>2]|0;nh=rh+fe|0;o[th>>2]=nh;ih=me+8|0;oh=ih;ah=oh&7;sh=(ah|0)==0;lh=0-oh|0;ch=lh&7;uh=sh?0:ch;hh=me+uh|0;ph=Gd+8|0;fh=ph;mh=fh&7;vh=(mh|0)==0;gh=0-fh|0;bh=gh&7;yh=vh?0:bh;_h=Gd+yh|0;Eh=_h;wh=hh;Th=Eh-wh|0;kh=hh+g|0;Rh=Th-g|0;Sh=g|3;xh=hh+4|0;o[xh>>2]=Sh;jh=(Vu|0)==(_h|0);do{if(jh){Ch=o[2972>>2]|0;Mh=Ch+Rh|0;o[2972>>2]=Mh;o[2984>>2]=kh;Ih=Mh|1;Oh=kh+4|0;o[Oh>>2]=Ih}else{Ph=o[2980>>2]|0;Nh=(Ph|0)==(_h|0);if(Nh){Vh=o[2968>>2]|0;Hh=Vh+Rh|0;o[2968>>2]=Hh;o[2980>>2]=kh;Lh=Hh|1;Fh=kh+4|0;o[Fh>>2]=Lh;Bh=kh+Hh|0;o[Bh>>2]=Hh;break}Uh=_h+4|0;zh=o[Uh>>2]|0;Wh=zh&3;qh=(Wh|0)==1;if(qh){Kh=zh&-8;Xh=zh>>>3;Zh=zh>>>0<256;e:do{if(Zh){Qh=_h+8|0;Jh=o[Qh>>2]|0;Yh=_h+12|0;$h=o[Yh>>2]|0;ep=($h|0)==(Jh|0);if(ep){np=1<<Xh;ip=np^-1;op=o[740]|0;ap=op&ip;o[740]=ap;break}else{sp=Jh+12|0;o[sp>>2]=$h;lp=$h+8|0;o[lp>>2]=Jh;break}}else{cp=_h+24|0;up=o[cp>>2]|0;dp=_h+12|0;hp=o[dp>>2]|0;fp=(hp|0)==(_h|0);do{if(fp){yp=_h+16|0;_p=yp+4|0;Ep=o[_p>>2]|0;Ap=(Ep|0)==(0|0);if(Ap){wp=o[yp>>2]|0;kp=(wp|0)==(0|0);if(kp){te=0;break}else{z=wp;G=yp}}else{z=Ep;G=_p}while(1){Rp=z+20|0;Sp=o[Rp>>2]|0;xp=(Sp|0)==(0|0);if(!xp){z=Sp;G=Rp;continue}jp=z+16|0;Cp=o[jp>>2]|0;Mp=(Cp|0)==(0|0);if(Mp){break}else{z=Cp;G=jp}}o[G>>2]=0;te=z}else{mp=_h+8|0;vp=o[mp>>2]|0;gp=vp+12|0;o[gp>>2]=hp;bp=hp+8|0;o[bp>>2]=vp;te=hp}}while(0);Ip=(up|0)==(0|0);if(Ip){break}Dp=_h+28|0;Op=o[Dp>>2]|0;Np=3264+(Op<<2)|0;Vp=o[Np>>2]|0;Hp=(Vp|0)==(_h|0);do{if(Hp){o[Np>>2]=te;Hb=(te|0)==(0|0);if(!Hb){break}Lp=1<<Op;Fp=Lp^-1;Bp=o[2964>>2]|0;Up=Bp&Fp;o[2964>>2]=Up;break e}else{zp=up+16|0;Gp=o[zp>>2]|0;Wp=(Gp|0)!=(_h|0);xe=Wp&1;Kp=(up+16|0)+(xe<<2)|0;o[Kp>>2]=te;Xp=(te|0)==(0|0);if(Xp){break e}}}while(0);Zp=te+24|0;o[Zp>>2]=up;Qp=_h+16|0;Jp=o[Qp>>2]|0;Yp=(Jp|0)==(0|0);if(!Yp){$p=te+16|0;o[$p>>2]=Jp;ef=Jp+24|0;o[ef>>2]=te}tf=Qp+4|0;rf=o[tf>>2]|0;of=(rf|0)==(0|0);if(of){break}af=te+20|0;o[af>>2]=rf;sf=rf+24|0;o[sf>>2]=te}}while(0);lf=_h+Kh|0;cf=Kh+Rh|0;c=lf;T=cf}else{c=_h;T=Rh}uf=c+4|0;df=o[uf>>2]|0;hf=df&-2;o[uf>>2]=hf;pf=T|1;ff=kh+4|0;o[ff>>2]=pf;vf=kh+T|0;o[vf>>2]=T;gf=T>>>3;bf=T>>>0<256;if(bf){yf=gf<<1;_f=3000+(yf<<2)|0;Ef=o[740]|0;Af=1<<gf;wf=Ef&Af;Tf=(wf|0)==0;if(Tf){kf=Ef|Af;o[740]=kf;ye=_f+8|0;S=_f;we=ye}else{Sf=_f+8|0;xf=o[Sf>>2]|0;S=xf;we=Sf}o[we>>2]=kh;jf=S+12|0;o[jf>>2]=kh;Cf=kh+8|0;o[Cf>>2]=S;Mf=kh+12|0;o[Mf>>2]=_f;break}If=T>>>8;Df=(If|0)==0;do{if(Df){x=0}else{Of=T>>>0>16777215;if(Of){x=31;break}Pf=If+1048320|0;Nf=Pf>>>16;Hf=Nf&8;Lf=If<<Hf;Ff=Lf+520192|0;Bf=Ff>>>16;Uf=Bf&4;zf=Uf|Hf;Gf=Lf<<Uf;Wf=Gf+245760|0;qf=Wf>>>16;Kf=qf&2;Zf=zf|Kf;Qf=14-Zf|0;Jf=Gf<<Kf;Yf=Jf>>>15;$f=Qf+Yf|0;em=$f<<1;tm=$f+7|0;rm=T>>>tm;nm=rm&1;im=nm|em;x=im}}while(0);sm=3264+(x<<2)|0;lm=kh+28|0;o[lm>>2]=x;cm=kh+16|0;um=cm+4|0;o[um>>2]=0;o[cm>>2]=0;dm=o[2964>>2]|0;hm=1<<x;pm=dm&hm;fm=(pm|0)==0;if(fm){mm=dm|hm;o[2964>>2]=mm;o[sm>>2]=kh;vm=kh+24|0;o[vm>>2]=sm;bm=kh+12|0;o[bm>>2]=kh;ym=kh+8|0;o[ym>>2]=kh;break}_m=o[sm>>2]|0;Em=(x|0)==31;Am=x>>>1;wm=25-Am|0;Tm=Em?0:wm;km=T<<Tm;k=km;R=_m;while(1){Rm=R+4|0;Sm=o[Rm>>2]|0;jm=Sm&-8;Cm=(jm|0)==(T|0);if(Cm){ty=192;break}Mm=k>>>31;Im=(R+16|0)+(Mm<<2)|0;Dm=k<<1;Om=o[Im>>2]|0;Pm=(Om|0)==(0|0);if(Pm){ty=191;break}else{k=Dm;R=Om}}if((ty|0)==191){o[Im>>2]=kh;Nm=kh+24|0;o[Nm>>2]=R;Vm=kh+12|0;o[Vm>>2]=kh;Hm=kh+8|0;o[Hm>>2]=kh;break}else if((ty|0)==192){Fm=R+8|0;Bm=o[Fm>>2]|0;Um=Bm+12|0;o[Um>>2]=kh;o[Fm>>2]=kh;zm=kh+8|0;o[zm>>2]=Bm;Gm=kh+12|0;o[Gm>>2]=R;Wm=kh+24|0;o[Wm>>2]=0;break}}}while(0);Ab=hh+8|0;s=Ab;f=ry;return s|0}else{u=3408}}while(1){qm=o[u>>2]|0;Km=qm>>>0>Vu>>>0;if(!Km){Xm=u+4|0;Zm=o[Xm>>2]|0;Jm=qm+Zm|0;Ym=Jm>>>0>Vu>>>0;if(Ym){break}}$m=u+8|0;ev=o[$m>>2]|0;u=ev}tv=Jm+-47|0;rv=tv+8|0;nv=rv;iv=nv&7;ov=(iv|0)==0;av=0-nv|0;lv=av&7;cv=ov?0:lv;uv=tv+cv|0;dv=Vu+16|0;hv=uv>>>0<dv>>>0;pv=hv?Vu:uv;fv=pv+8|0;mv=pv+24|0;vv=fe+-40|0;gv=me+8|0;yv=gv;_v=yv&7;Ev=(_v|0)==0;Av=0-yv|0;wv=Av&7;Tv=Ev?0:wv;kv=me+Tv|0;Rv=vv-Tv|0;o[2984>>2]=kv;o[2972>>2]=Rv;Sv=Rv|1;xv=kv+4|0;o[xv>>2]=Sv;Cv=me+vv|0;Mv=Cv+4|0;o[Mv>>2]=40;Iv=o[3448>>2]|0;o[2988>>2]=Iv;Dv=pv+4|0;o[Dv>>2]=27;o[fv>>2]=o[3408>>2]|0;o[fv+4>>2]=o[3408+4>>2]|0;o[fv+8>>2]=o[3408+8>>2]|0;o[fv+12>>2]=o[3408+12>>2]|0;o[3408>>2]=me;o[3412>>2]=fe;o[3420>>2]=0;o[3416>>2]=fv;Pv=mv;while(1){Ov=Pv+4|0;o[Ov>>2]=7;Nv=Pv+8|0;Vv=Nv>>>0<Jm>>>0;if(Vv){Pv=Ov}else{break}}Hv=(pv|0)==(Vu|0);if(!Hv){Lv=pv;Bv=Vu;Uv=Lv-Bv|0;zv=o[Dv>>2]|0;Gv=zv&-2;o[Dv>>2]=Gv;Wv=Uv|1;qv=Vu+4|0;o[qv>>2]=Wv;o[pv>>2]=Uv;Kv=Uv>>>3;Xv=Uv>>>0<256;if(Xv){Zv=Kv<<1;Qv=3000+(Zv<<2)|0;Yv=o[740]|0;$v=1<<Kv;eg=Yv&$v;tg=(eg|0)==0;if(tg){rg=Yv|$v;o[740]=rg;be=Qv+8|0;E=Qv;Ae=be}else{ng=Qv+8|0;ig=o[ng>>2]|0;E=ig;Ae=ng}o[Ae>>2]=Vu;og=E+12|0;o[og>>2]=Vu;ag=Vu+8|0;o[ag>>2]=E;sg=Vu+12|0;o[sg>>2]=Qv;break}ug=Uv>>>8;dg=(ug|0)==0;if(dg){A=0}else{hg=Uv>>>0>16777215;if(hg){A=31}else{pg=ug+1048320|0;fg=pg>>>16;mg=fg&8;vg=ug<<mg;gg=vg+520192|0;bg=gg>>>16;yg=bg&4;Eg=yg|mg;Ag=vg<<yg;wg=Ag+245760|0;Tg=wg>>>16;kg=Tg&2;Rg=Eg|kg;Sg=14-Rg|0;xg=Ag<<kg;jg=xg>>>15;Cg=Sg+jg|0;Ig=Cg<<1;Dg=Cg+7|0;Og=Uv>>>Dg;Pg=Og&1;Ng=Pg|Ig;A=Ng}}Vg=3264+(A<<2)|0;Hg=Vu+28|0;o[Hg>>2]=A;Lg=Vu+20|0;o[Lg>>2]=0;o[dv>>2]=0;Fg=o[2964>>2]|0;Bg=1<<A;zg=Fg&Bg;Gg=(zg|0)==0;if(Gg){Wg=Fg|Bg;o[2964>>2]=Wg;o[Vg>>2]=Vu;qg=Vu+24|0;o[qg>>2]=Vg;Kg=Vu+12|0;o[Kg>>2]=Vu;Xg=Vu+8|0;o[Xg>>2]=Vu;break}Zg=o[Vg>>2]|0;Qg=(A|0)==31;Jg=A>>>1;Yg=25-Jg|0;eb=Qg?0:Yg;tb=Uv<<eb;y=tb;_=Zg;while(1){rb=_+4|0;nb=o[rb>>2]|0;ib=nb&-8;ob=(ib|0)==(Uv|0);if(ob){ty=213;break}ab=y>>>31;sb=(_+16|0)+(ab<<2)|0;lb=y<<1;cb=o[sb>>2]|0;db=(cb|0)==(0|0);if(db){ty=212;break}else{y=lb;_=cb}}if((ty|0)==212){o[sb>>2]=Vu;hb=Vu+24|0;o[hb>>2]=_;pb=Vu+12|0;o[pb>>2]=Vu;fb=Vu+8|0;o[fb>>2]=Vu;break}else if((ty|0)==213){mb=_+8|0;vb=o[mb>>2]|0;gb=vb+12|0;o[gb>>2]=Vu;o[mb>>2]=Vu;bb=Vu+8|0;o[bb>>2]=vb;yb=Vu+12|0;o[yb>>2]=_;_b=Vu+24|0;o[_b>>2]=0;break}}}}while(0);wb=o[2972>>2]|0;Tb=wb>>>0>g>>>0;if(Tb){kb=wb-g|0;o[2972>>2]=kb;Rb=o[2984>>2]|0;Sb=Rb+g|0;o[2984>>2]=Sb;xb=kb|1;jb=Sb+4|0;o[jb>>2]=xb;Cb=g|3;Mb=Rb+4|0;o[Mb>>2]=Cb;Db=Rb+8|0;s=Db;f=ry;return s|0}}Ob=Xr()|0;o[Ob>>2]=12;s=0;f=ry;return s|0}function Kr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0;var w=0,T=0,k=0,R=0,S=0,x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0,B=0,U=0;var z=0,G=0,W=0,q=0,K=0,X=0,Z=0,Q=0,J=0,Y=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,oe=0,ae=0,se=0,le=0;var ce=0,ue=0,de=0,he=0,pe=0,fe=0,me=0,ve=0,ge=0,be=0,ye=0,_e=0,Ee=0,Ae=0,we=0,Te=0,ke=0,Re=0,Se=0,xe=0;var je=0,Ce=0,Me=0,Ie=0,De=0,Oe=0,Pe=0,Ne=0,Ve=0,He=0,Le=0,Fe=0,Be=0,Ue=0,ze=0,Ge=0,We=0,qe=0,Ke=0,Xe=0;var Ze=0,Qe=0,Je=0,Ye=0,$e=0,et=0,tt=0,rt=0,nt=0,it=0,ot=0,at=0,st=0,lt=0,ct=0,ut=0,dt=0,ht=0,pt=0,ft=0;var mt=0,vt=0,gt=0,bt=0,yt=0,_t=0,Et=0,At=0,wt=0,Tt=0,kt=0,Rt=0,St=0,xt=0,jt=0,Ct=0,Mt=0,It=0,Dt=0,Ot=0;var Pt=0,Nt=0,Vt=0,Ht=0,Lt=0,Ft=0,Bt=0,Ut=0,zt=0,Gt=0,Wt=0,qt=0,Kt=0,Xt=0,Zt=0,Qt=0,Jt=0,Yt=0,$t=0,er=0;var tr=0,rr=0,nr=0,ir=0,or=0,ar=0,sr=0,lr=0,cr=0,ur=0,dr=0,hr=0,pr=0,fr=0,mr=0,vr=0,gr=0,br=0,yr=0,_r=0;var Er=0,Ar=0,wr=0,Tr=0,kr=0,Rr=0,Sr=0,xr=0,jr=0,Cr=0,Mr=0,Ir=0,Dr=0,Or=0,Pr=0,Nr=0,Vr=0,Hr=0,Lr=0,Fr=0;var Br=0,Ur=0,zr=0,Gr=0,Wr=0,qr=0,Kr=0,Xr=0,Zr=0,Qr=0,Jr=0,Yr=0,$r=0,en=0,tn=0,rn=0,nn=0,on=0,an=0,sn=0;var ln=0,cn=0,un=0,dn=0,hn=0,pn=0,fn=0,mn=0,vn=0,gn=0,bn=0,yn=0,_n=0,En=0,An=0,wn=0,Tn=0,kn=0,Rn=0,Sn=0;var xn=0,jn=0,Cn=0,Mn=0,In=0,Dn=0,On=0,Pn=0,Nn=0,Vn=0,Hn=0,Ln=0,Fn=0,Bn=0,Un=0,zn=0,Gn=0,Wn=0,qn=0,Kn=0;var Xn=0,Zn=0,Qn=0,Jn=0,Yn=0,$n=0,ei=0,ti=0,ri=0,ni=0,ii=0,oi=0,ai=0,si=0,li=0,ci=0,ui=0,di=0,hi=0,pi=0;var fi=0,mi=0,vi=0;vi=f;A=(e|0)==(0|0);if(A){return}kt=e+-8|0;zr=o[2976>>2]|0;en=e+-4|0;hn=o[en>>2]|0;wn=hn&-8;On=kt+wn|0;Wn=hn&1;ri=(Wn|0)==0;do{if(ri){w=o[kt>>2]|0;O=hn&3;W=(O|0)==0;if(W){return}re=0-w|0;pe=kt+re|0;Te=w+wn|0;Pe=pe>>>0<zr>>>0;if(Pe){return}qe=o[2980>>2]|0;nt=(qe|0)==(pe|0);if(nt){Gn=On+4|0;qn=o[Gn>>2]|0;Kn=qn&3;Xn=(Kn|0)==3;if(!Xn){l=pe;c=Te;$n=pe;break}o[2968>>2]=Te;Zn=qn&-2;o[Gn>>2]=Zn;Qn=Te|1;Jn=pe+4|0;o[Jn>>2]=Qn;Yn=pe+Te|0;o[Yn>>2]=Te;return}ft=w>>>3;Rt=w>>>0<256;if(Rt){Vt=pe+8|0;Xt=o[Vt>>2]|0;or=pe+12|0;vr=o[or>>2]|0;Sr=(vr|0)==(Xt|0);if(Sr){Hr=1<<ft;Fr=Hr^-1;Br=o[740]|0;Ur=Br&Fr;o[740]=Ur;l=pe;c=Te;$n=pe;break}else{Gr=Xt+12|0;o[Gr>>2]=vr;Wr=vr+8|0;o[Wr>>2]=Xt;l=pe;c=Te;$n=pe;break}}qr=pe+24|0;Kr=o[qr>>2]|0;Xr=pe+12|0;Zr=o[Xr>>2]|0;Qr=(Zr|0)==(pe|0);do{if(Qr){rn=pe+16|0;nn=rn+4|0;on=o[nn>>2]|0;an=(on|0)==(0|0);if(an){sn=o[rn>>2]|0;ln=(sn|0)==(0|0);if(ln){v=0;break}else{u=sn;d=rn}}else{u=on;d=nn}while(1){cn=u+20|0;un=o[cn>>2]|0;dn=(un|0)==(0|0);if(!dn){u=un;d=cn;continue}pn=u+16|0;fn=o[pn>>2]|0;mn=(fn|0)==(0|0);if(mn){break}else{u=fn;d=pn}}o[d>>2]=0;v=u}else{Jr=pe+8|0;Yr=o[Jr>>2]|0;$r=Yr+12|0;o[$r>>2]=Zr;tn=Zr+8|0;o[tn>>2]=Yr;v=Zr}}while(0);vn=(Kr|0)==(0|0);if(vn){l=pe;c=Te;$n=pe}else{gn=pe+28|0;bn=o[gn>>2]|0;yn=3264+(bn<<2)|0;_n=o[yn>>2]|0;En=(_n|0)==(pe|0);if(En){o[yn>>2]=v;pi=(v|0)==(0|0);if(pi){An=1<<bn;Tn=An^-1;kn=o[2964>>2]|0;Rn=kn&Tn;o[2964>>2]=Rn;l=pe;c=Te;$n=pe;break}}else{Sn=Kr+16|0;xn=o[Sn>>2]|0;jn=(xn|0)!=(pe|0);_=jn&1;Cn=(Kr+16|0)+(_<<2)|0;o[Cn>>2]=v;Mn=(v|0)==(0|0);if(Mn){l=pe;c=Te;$n=pe;break}}In=v+24|0;o[In>>2]=Kr;Dn=pe+16|0;Pn=o[Dn>>2]|0;Nn=(Pn|0)==(0|0);if(!Nn){Vn=v+16|0;o[Vn>>2]=Pn;Hn=Pn+24|0;o[Hn>>2]=v}Ln=Dn+4|0;Fn=o[Ln>>2]|0;Bn=(Fn|0)==(0|0);if(Bn){l=pe;c=Te;$n=pe}else{Un=v+20|0;o[Un>>2]=Fn;zn=Fn+24|0;o[zn>>2]=v;l=pe;c=Te;$n=pe}}}else{l=kt;c=wn;$n=kt}}while(0);ei=$n>>>0<On>>>0;if(!ei){return}ti=On+4|0;ni=o[ti>>2]|0;ii=ni&1;oi=(ii|0)==0;if(oi){return}ai=ni&2;si=(ai|0)==0;if(si){li=o[2984>>2]|0;ci=(li|0)==(On|0);if(ci){ui=o[2972>>2]|0;di=ui+c|0;o[2972>>2]=di;o[2984>>2]=l;hi=di|1;T=l+4|0;o[T>>2]=hi;k=o[2980>>2]|0;R=(l|0)==(k|0);if(!R){return}o[2980>>2]=0;o[2968>>2]=0;return}S=o[2980>>2]|0;x=(S|0)==(On|0);if(x){j=o[2968>>2]|0;C=j+c|0;o[2968>>2]=C;o[2980>>2]=$n;M=C|1;I=l+4|0;o[I>>2]=M;D=$n+C|0;o[D>>2]=C;return}P=ni&-8;N=P+c|0;V=ni>>>3;H=ni>>>0<256;do{if(H){L=On+8|0;F=o[L>>2]|0;B=On+12|0;U=o[B>>2]|0;z=(U|0)==(F|0);if(z){G=1<<V;q=G^-1;K=o[740]|0;X=K&q;o[740]=X;break}else{Z=F+12|0;o[Z>>2]=U;Q=U+8|0;o[Q>>2]=F;break}}else{J=On+24|0;Y=o[J>>2]|0;$=On+12|0;ee=o[$>>2]|0;te=(ee|0)==(On|0);do{if(te){se=On+16|0;le=se+4|0;ce=o[le>>2]|0;ue=(ce|0)==(0|0);if(ue){de=o[se>>2]|0;he=(de|0)==(0|0);if(he){g=0;break}else{h=de;p=se}}else{h=ce;p=le}while(1){fe=h+20|0;me=o[fe>>2]|0;ve=(me|0)==(0|0);if(!ve){h=me;p=fe;continue}ge=h+16|0;be=o[ge>>2]|0;ye=(be|0)==(0|0);if(ye){break}else{h=be;p=ge}}o[p>>2]=0;g=h}else{ne=On+8|0;ie=o[ne>>2]|0;oe=ie+12|0;o[oe>>2]=ee;ae=ee+8|0;o[ae>>2]=ie;g=ee}}while(0);_e=(Y|0)==(0|0);if(!_e){Ee=On+28|0;Ae=o[Ee>>2]|0;we=3264+(Ae<<2)|0;ke=o[we>>2]|0;Re=(ke|0)==(On|0);if(Re){o[we>>2]=g;fi=(g|0)==(0|0);if(fi){Se=1<<Ae;xe=Se^-1;je=o[2964>>2]|0;Ce=je&xe;o[2964>>2]=Ce;break}}else{Me=Y+16|0;Ie=o[Me>>2]|0;De=(Ie|0)!=(On|0);E=De&1;Oe=(Y+16|0)+(E<<2)|0;o[Oe>>2]=g;Ne=(g|0)==(0|0);if(Ne){break}}Ve=g+24|0;o[Ve>>2]=Y;He=On+16|0;Le=o[He>>2]|0;Fe=(Le|0)==(0|0);if(!Fe){Be=g+16|0;o[Be>>2]=Le;Ue=Le+24|0;o[Ue>>2]=g}ze=He+4|0;Ge=o[ze>>2]|0;We=(Ge|0)==(0|0);if(!We){Ke=g+20|0;o[Ke>>2]=Ge;Xe=Ge+24|0;o[Xe>>2]=g}}}}while(0);Ze=N|1;Qe=l+4|0;o[Qe>>2]=Ze;Je=$n+N|0;o[Je>>2]=N;Ye=o[2980>>2]|0;$e=(l|0)==(Ye|0);if($e){o[2968>>2]=N;return}else{m=N}}else{et=ni&-2;o[ti>>2]=et;tt=c|1;rt=l+4|0;o[rt>>2]=tt;it=$n+c|0;o[it>>2]=c;m=c}ot=m>>>3;at=m>>>0<256;if(at){st=ot<<1;lt=3000+(st<<2)|0;ct=o[740]|0;ut=1<<ot;dt=ct&ut;ht=(dt|0)==0;if(ht){pt=ct|ut;o[740]=pt;b=lt+8|0;s=lt;y=b}else{mt=lt+8|0;vt=o[mt>>2]|0;s=vt;y=mt}o[y>>2]=l;gt=s+12|0;o[gt>>2]=l;bt=l+8|0;o[bt>>2]=s;yt=l+12|0;o[yt>>2]=lt;return}_t=m>>>8;Et=(_t|0)==0;if(Et){a=0}else{At=m>>>0>16777215;if(At){a=31}else{wt=_t+1048320|0;Tt=wt>>>16;St=Tt&8;xt=_t<<St;jt=xt+520192|0;Ct=jt>>>16;Mt=Ct&4;It=Mt|St;Dt=xt<<Mt;Ot=Dt+245760|0;Pt=Ot>>>16;Nt=Pt&2;Ht=It|Nt;Lt=14-Ht|0;Ft=Dt<<Nt;Bt=Ft>>>15;Ut=Lt+Bt|0;zt=Ut<<1;Gt=Ut+7|0;Wt=m>>>Gt;qt=Wt&1;Kt=qt|zt;a=Kt}}Zt=3264+(a<<2)|0;Qt=l+28|0;o[Qt>>2]=a;Jt=l+16|0;Yt=l+20|0;o[Yt>>2]=0;o[Jt>>2]=0;$t=o[2964>>2]|0;er=1<<a;tr=$t&er;rr=(tr|0)==0;do{if(rr){nr=$t|er;o[2964>>2]=nr;o[Zt>>2]=l;ir=l+24|0;o[ir>>2]=Zt;ar=l+12|0;o[ar>>2]=l;sr=l+8|0;o[sr>>2]=l}else{lr=o[Zt>>2]|0;cr=(a|0)==31;ur=a>>>1;dr=25-ur|0;hr=cr?0:dr;pr=m<<hr;n=pr;i=lr;while(1){fr=i+4|0;mr=o[fr>>2]|0;gr=mr&-8;br=(gr|0)==(m|0);if(br){mi=73;break}yr=n>>>31;_r=(i+16|0)+(yr<<2)|0;Er=n<<1;Ar=o[_r>>2]|0;wr=(Ar|0)==(0|0);if(wr){mi=72;break}else{n=Er;i=Ar}}if((mi|0)==72){o[_r>>2]=l;Tr=l+24|0;o[Tr>>2]=i;kr=l+12|0;o[kr>>2]=l;Rr=l+8|0;o[Rr>>2]=l;break}else if((mi|0)==73){xr=i+8|0;jr=o[xr>>2]|0;Cr=jr+12|0;o[Cr>>2]=l;o[xr>>2]=l;Mr=l+8|0;o[Mr>>2]=jr;Ir=l+12|0;o[Ir>>2]=i;Dr=l+24|0;o[Dr>>2]=0;break}}}while(0);Or=o[2992>>2]|0;Pr=Or+-1|0;o[2992>>2]=Pr;Nr=(Pr|0)==0;if(Nr){r=3416}else{return}while(1){t=o[r>>2]|0;Vr=(t|0)==(0|0);Lr=t+8|0;if(Vr){break}else{r=Lr}}o[2992>>2]=-1;return}function Xr(){var e=0,t=0;t=f;return 3456|0}function Zr(e){e=e|0;var t=0,r=0,i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0;var T=0,k=0,R=0,S=0,x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0;P=f;u=e;A=u&3;S=(A|0)==0;e:do{if(S){r=e;O=4}else{i=e;R=u;while(1){x=n[i>>0]|0;j=x<<24>>24==0;if(j){c=R;break e}C=i+1|0;M=C;I=M&3;D=(I|0)==0;if(D){r=C;O=4;break}else{i=C;R=M}}}}while(0);if((O|0)==4){t=r;while(1){d=o[t>>2]|0;h=d+-16843009|0;p=d&-2139062144;m=p^-2139062144;v=m&h;g=(v|0)==0;b=t+4|0;if(g){t=b}else{break}}y=d&255;_=y<<24>>24==0;if(_){a=t}else{s=t;while(1){E=s+1|0;l=n[E>>0]|0;w=l<<24>>24==0;if(w){a=E;break}else{s=E}}}T=a;c=T}k=c-u|0;return k|0}function Qr(e){e=e|0;var t=0,r=0,n=0,i=0,o=0,a=0,s=0;s=f;r=Zr(e)|0;n=r+1|0;i=qr(n)|0;o=(i|0)==(0|0);if(o){t=0}else{Sn(i|0,e|0,n|0)|0;t=i}return t|0}function Jr(e){e=e|0;var t=0,r=0;r=f;return}function Yr(e){e=e|0;var t=0,r=0;r=f;Jr(e);mn(e);return}function $r(e){e=e|0;var t=0,r=0;r=f;return}function en(e){e=e|0;var t=0,r=0;r=f;return}function tn(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0;var k=0,R=0,S=0,x=0;S=f;f=f+64|0;b=S;y=an(e,t,0)|0;if(y){i=1}else{_=(t|0)==(0|0);if(_){i=0}else{E=un(t,208,192,0)|0;A=(E|0)==(0|0);if(A){i=0}else{w=b+4|0;k=w;x=k+52|0;do{o[k>>2]=0|0;k=k+4|0}while((k|0)<(x|0));o[b>>2]=E;T=b+8|0;o[T>>2]=e;a=b+12|0;o[a>>2]=-1;s=b+48|0;o[s>>2]=1;l=o[E>>2]|0;c=l+28|0;u=o[c>>2]|0;d=o[r>>2]|0;Xn[u&3](E,b,d,1);h=b+24|0;p=o[h>>2]|0;m=(p|0)==1;if(m){v=b+16|0;g=o[v>>2]|0;o[r>>2]=g;n=1}else{n=0}i=n}}}f=S;return i|0}function rn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0;d=f;s=t+8|0;l=o[s>>2]|0;c=an(e,l,a)|0;if(c){cn(0,t,r,n,i)}return}function nn(e,t,r,i,a){e=e|0;t=t|0;r=r|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,S=0;var x=0,j=0,C=0,M=0,I=0,D=0,O=0;O=f;x=t+8|0;j=o[x>>2]|0;C=an(e,j,a)|0;do{if(C){ln(0,t,r,i)}else{M=o[t>>2]|0;I=an(e,M,a)|0;if(I){s=t+16|0;l=o[s>>2]|0;c=(l|0)==(r|0);if(!c){u=t+20|0;d=o[u>>2]|0;h=(d|0)==(r|0);if(!h){v=t+32|0;o[v>>2]=i;o[u>>2]=r;g=t+40|0;b=o[g>>2]|0;y=b+1|0;o[g>>2]=y;_=t+36|0;E=o[_>>2]|0;A=(E|0)==1;if(A){w=t+24|0;T=o[w>>2]|0;k=(T|0)==2;if(k){R=t+54|0;n[R>>0]=1}}S=t+44|0;o[S>>2]=4;break}}p=(i|0)==1;if(p){m=t+32|0;o[m>>2]=1}}}}while(0);return}function on(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,s=0,l=0,c=0;c=f;i=t+8|0;a=o[i>>2]|0;s=an(e,a,0)|0;if(s){sn(0,t,r,n)}return}function an(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,o=0;o=f;n=(e|0)==(t|0);return n|0}function sn(e,t,r,i){e=e|0;t=t|0;r=r|0;i=i|0;var a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0;A=f;m=t+16|0;v=o[m>>2]|0;g=(v|0)==(0|0);do{if(g){o[m>>2]=r;b=t+24|0;o[b>>2]=i;y=t+36|0;o[y>>2]=1}else{_=(v|0)==(r|0);if(!_){c=t+36|0;u=o[c>>2]|0;d=u+1|0;o[c>>2]=d;h=t+24|0;o[h>>2]=2;p=t+54|0;n[p>>0]=1;break}a=t+24|0;s=o[a>>2]|0;l=(s|0)==2;if(l){o[a>>2]=i}}}while(0);return}function ln(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0;h=f;i=t+4|0;a=o[i>>2]|0;s=(a|0)==(r|0);if(s){l=t+28|0;c=o[l>>2]|0;u=(c|0)==1;if(!u){o[l>>2]=n}}return}function cn(e,t,r,i,a){e=e|0;t=t|0;r=r|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,S=0;var x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0;F=f;I=t+53|0;n[I>>0]=1;D=t+4|0;O=o[D>>2]|0;P=(O|0)==(i|0);do{if(P){N=t+52|0;n[N>>0]=1;s=t+16|0;l=o[s>>2]|0;c=(l|0)==(0|0);if(c){o[s>>2]=r;u=t+24|0;o[u>>2]=a;d=t+36|0;o[d>>2]=1;h=t+48|0;p=o[h>>2]|0;m=(p|0)==1;v=(a|0)==1;V=m&v;if(!V){break}g=t+54|0;n[g>>0]=1;break}b=(l|0)==(r|0);if(!b){x=t+36|0;j=o[x>>2]|0;C=j+1|0;o[x>>2]=C;M=t+54|0;n[M>>0]=1;break}y=t+24|0;_=o[y>>2]|0;E=(_|0)==2;if(E){o[y>>2]=a;k=a}else{k=_}A=t+48|0;w=o[A>>2]|0;T=(w|0)==1;R=(k|0)==1;H=T&R;if(H){S=t+54|0;n[S>>0]=1}}}while(0);return}function un(e,t,r,a){e=e|0;t=t|0;r=r|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,S=0;var x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0,B=0,U=0,z=0,G=0,W=0,q=0,K=0;var X=0,Z=0,Q=0,J=0,Y=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,oe=0,ae=0,se=0,le=0;se=f;f=f+64|0;B=se;Q=o[e>>2]|0;J=Q+-8|0;Y=o[J>>2]|0;$=e+Y|0;ee=Q+-4|0;u=o[ee>>2]|0;o[B>>2]=r;d=B+4|0;o[d>>2]=e;h=B+8|0;o[h>>2]=t;p=B+12|0;o[p>>2]=a;m=B+16|0;v=B+20|0;g=B+24|0;b=B+28|0;y=B+32|0;_=B+40|0;oe=m;le=oe+36|0;do{o[oe>>2]=0|0;oe=oe+4|0}while((oe|0)<(le|0));i[m+36>>1]=0|0;n[m+38>>0]=0|0;E=an(u,r,0)|0;e:do{if(E){A=B+48|0;o[A>>2]=1;w=o[u>>2]|0;T=w+20|0;k=o[T>>2]|0;Qn[k&3](u,B,$,$,1,0);R=o[g>>2]|0;S=(R|0)==1;s=S?$:0;l=s}else{x=B+36|0;j=o[u>>2]|0;C=j+24|0;M=o[C>>2]|0;Zn[M&3](u,B,$,1,0);I=o[x>>2]|0;switch(I|0){case 0:{D=o[_>>2]|0;O=(D|0)==1;P=o[b>>2]|0;N=(P|0)==1;te=O&N;V=o[y>>2]|0;H=(V|0)==1;re=te&H;L=o[v>>2]|0;c=re?L:0;l=c;break e;break}case 1:{break}default:{l=0;break e}}F=o[g>>2]|0;U=(F|0)==1;if(!U){z=o[_>>2]|0;G=(z|0)==0;W=o[b>>2]|0;q=(W|0)==1;ne=G&q;K=o[y>>2]|0;X=(K|0)==1;ie=ne&X;if(!ie){l=0;break}}Z=o[m>>2]|0;l=Z}}while(0);f=se;return l|0}function dn(e){e=e|0;var t=0,r=0;r=f;Jr(e);mn(e);return}function hn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0;g=f;d=t+8|0;h=o[d>>2]|0;p=an(e,h,a)|0;if(p){cn(0,t,r,n,i)}else{m=e+8|0;s=o[m>>2]|0;l=o[s>>2]|0;c=l+20|0;u=o[c>>2]|0;Qn[u&3](s,t,r,n,i,a)}return}function pn(e,t,r,i,a){e=e|0;t=t|0;r=r|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,S=0;var x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0,B=0,U=0,z=0,G=0,W=0,q=0,K=0;var X=0,Z=0,Q=0,J=0,Y=0,$=0,ee=0;ee=f;X=t+8|0;Z=o[X>>2]|0;Q=an(e,Z,a)|0;do{if(Q){ln(0,t,r,i)}else{J=o[t>>2]|0;Y=an(e,J,a)|0;if(!Y){z=e+8|0;G=o[z>>2]|0;W=o[G>>2]|0;q=W+24|0;K=o[q>>2]|0;Zn[K&3](G,t,r,i,a);break}c=t+16|0;u=o[c>>2]|0;d=(u|0)==(r|0);if(!d){h=t+20|0;p=o[h>>2]|0;m=(p|0)==(r|0);if(!m){b=t+32|0;o[b>>2]=i;y=t+44|0;_=o[y>>2]|0;E=(_|0)==4;if(E){break}A=t+52|0;n[A>>0]=0;w=t+53|0;n[w>>0]=0;T=e+8|0;k=o[T>>2]|0;R=o[k>>2]|0;S=R+20|0;x=o[S>>2]|0;Qn[x&3](k,t,r,r,1,a);j=n[w>>0]|0;C=j<<24>>24==0;if(C){s=4;$=11}else{M=n[A>>0]|0;I=M<<24>>24==0;if(I){s=3;$=11}else{l=3}}if(($|0)==11){o[h>>2]=r;D=t+40|0;O=o[D>>2]|0;P=O+1|0;o[D>>2]=P;N=t+36|0;V=o[N>>2]|0;H=(V|0)==1;if(H){L=t+24|0;F=o[L>>2]|0;B=(F|0)==2;if(B){U=t+54|0;n[U>>0]=1;l=s}else{l=s}}else{l=s}}o[y>>2]=l;break}}v=(i|0)==1;if(v){g=t+32|0;o[g>>2]=1}}}while(0);return}function fn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0;m=f;s=t+8|0;l=o[s>>2]|0;c=an(e,l,0)|0;if(c){sn(0,t,r,n)}else{u=e+8|0;d=o[u>>2]|0;h=o[d>>2]|0;i=h+28|0;a=o[i>>2]|0;Xn[a&3](d,t,r,n)}return}function mn(e){e=e|0;var t=0,r=0;r=f;Kr(e);return}function vn(e){e=e|0;var t=0,r=0;r=f;return}function gn(e){e=e|0;var t=0,r=0;r=f;Jr(e);mn(e);return}function bn(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,o=0;o=f;n=an(e,t,0)|0;return n|0}function yn(e){e=e|0;var t=0,r=0;r=f;Jr(e);mn(e);return}function _n(e,t,r,i,a,s){e=e|0;t=t|0;r=r|0;i=i|0;a=a|0;s=s|0;var l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,S=0,x=0;var j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0,B=0,U=0,z=0;z=f;H=t+8|0;L=o[H>>2]|0;F=an(e,L,s)|0;if(F){cn(0,t,r,i,a)}else{B=t+52|0;c=n[B>>0]|0;u=t+53|0;d=n[u>>0]|0;h=e+16|0;p=e+12|0;m=o[p>>2]|0;v=(e+16|0)+(m<<3)|0;n[B>>0]=0;n[u>>0]=0;Tn(h,t,r,i,a,s);g=(m|0)>1;e:do{if(g){b=e+24|0;y=t+24|0;_=e+8|0;E=t+54|0;l=b;while(1){A=n[E>>0]|0;w=A<<24>>24==0;if(!w){break e}T=n[B>>0]|0;k=T<<24>>24==0;if(k){M=n[u>>0]|0;I=M<<24>>24==0;if(!I){D=o[_>>2]|0;O=D&1;P=(O|0)==0;if(P){break e}}}else{R=o[y>>2]|0;S=(R|0)==1;if(S){break e}x=o[_>>2]|0;j=x&2;C=(j|0)==0;if(C){break e}}n[B>>0]=0;n[u>>0]=0;Tn(l,t,r,i,a,s);N=l+8|0;V=N>>>0<v>>>0;if(V){l=N}else{break}}}}while(0);n[B>>0]=c;n[u>>0]=d}return}function En(e,t,r,i,a){e=e|0;t=t|0;r=r|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,S=0;var x=0,j=0,C=0,M=0,I=0,D=0,O=0,P=0,N=0,V=0,H=0,L=0,F=0,B=0,U=0,z=0,G=0,W=0,q=0,K=0;var X=0,Z=0,Q=0,J=0,Y=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,oe=0,ae=0,se=0,le=0,ce=0,ue=0,de=0,he=0,pe=0;var fe=0,me=0,ve=0,ge=0,be=0,ye=0,_e=0,Ee=0,Ae=0,we=0,Te=0,ke=0,Re=0,Se=0,xe=0,je=0,Ce=0,Me=0,Ie=0,De=0;var Oe=0,Pe=0,Ne=0,Ve=0,He=0,Le=0,Fe=0,Be=0,Ue=0,ze=0,Ge=0,We=0,qe=0,Ke=0,Xe=0,Ze=0,Qe=0,Je=0,Ye=0;Ye=f;ne=t+8|0;fe=o[ne>>2]|0;ke=an(e,fe,a)|0;e:do{if(ke){ln(0,t,r,i)}else{Ne=o[t>>2]|0;Ke=an(e,Ne,a)|0;if(!Ke){ue=e+16|0;de=e+12|0;he=o[de>>2]|0;pe=(e+16|0)+(he<<3)|0;kn(ue,t,r,i,a);me=e+24|0;ve=(he|0)>1;if(!ve){break}ge=e+8|0;be=o[ge>>2]|0;ye=be&2;_e=(ye|0)==0;if(_e){Ee=t+36|0;Ae=o[Ee>>2]|0;we=(Ae|0)==1;if(!we){Ce=be&1;Me=(Ce|0)==0;if(Me){Oe=t+54|0;m=me;while(1){Ge=n[Oe>>0]|0;We=Ge<<24>>24==0;if(!We){break e}qe=o[Ee>>2]|0;Xe=(qe|0)==1;if(Xe){break e}kn(m,t,r,i,a);Ze=m+8|0;Qe=Ze>>>0<pe>>>0;if(Qe){m=Ze}else{break e}}}Ie=t+24|0;De=t+54|0;d=me;while(1){Pe=n[De>>0]|0;Ve=Pe<<24>>24==0;if(!Ve){break e}He=o[Ee>>2]|0;Le=(He|0)==1;if(Le){Fe=o[Ie>>2]|0;Be=(Fe|0)==1;if(Be){break e}}kn(d,t,r,i,a);Ue=d+8|0;ze=Ue>>>0<pe>>>0;if(ze){d=Ue}else{break e}}}}Te=t+54|0;s=me;while(1){Re=n[Te>>0]|0;Se=Re<<24>>24==0;if(!Se){break e}kn(s,t,r,i,a);xe=s+8|0;je=xe>>>0<pe>>>0;if(je){s=xe}else{break e}}}g=t+16|0;b=o[g>>2]|0;y=(b|0)==(r|0);if(!y){_=t+20|0;E=o[_>>2]|0;A=(E|0)==(r|0);if(!A){k=t+32|0;o[k>>2]=i;R=t+44|0;S=o[R>>2]|0;x=(S|0)==4;if(x){break}j=e+16|0;C=e+12|0;M=o[C>>2]|0;I=(e+16|0)+(M<<3)|0;D=t+52|0;O=t+53|0;P=t+54|0;N=e+8|0;V=t+24|0;l=0;c=j;u=0;t:while(1){H=c>>>0<I>>>0;if(!H){v=l;Je=18;break}n[D>>0]=0;n[O>>0]=0;Tn(c,t,r,r,1,a);L=n[P>>0]|0;F=L<<24>>24==0;if(!F){v=l;Je=18;break}B=n[O>>0]|0;U=B<<24>>24==0;do{if(U){h=l;p=u}else{z=n[D>>0]|0;G=z<<24>>24==0;if(G){Q=o[N>>2]|0;J=Q&1;Y=(J|0)==0;if(Y){v=1;Je=18;break t}else{h=1;p=u;break}}W=o[V>>2]|0;q=(W|0)==1;if(q){Je=23;break t}K=o[N>>2]|0;X=K&2;Z=(X|0)==0;if(Z){Je=23;break t}else{h=1;p=1}}}while(0);$=c+8|0;l=h;c=$;u=p}do{if((Je|0)==18){if(!u){o[_>>2]=r;ee=t+40|0;te=o[ee>>2]|0;re=te+1|0;o[ee>>2]=re;ie=t+36|0;oe=o[ie>>2]|0;ae=(oe|0)==1;if(ae){se=o[V>>2]|0;le=(se|0)==2;if(le){n[P>>0]=1;if(v){Je=23;break}else{ce=4;break}}}}if(v){Je=23}else{ce=4}}}while(0);if((Je|0)==23){ce=3}o[R>>2]=ce;break}}w=(i|0)==1;if(w){T=t+32|0;o[T>>2]=1}}}while(0);return}function An(e,t,r,i){e=e|0;t=t|0;r=r|0;i=i|0;var a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0;w=f;v=t+8|0;g=o[v>>2]|0;b=an(e,g,0)|0;e:do{if(b){sn(0,t,r,i)}else{y=e+16|0;_=e+12|0;E=o[_>>2]|0;s=(e+16|0)+(E<<3)|0;wn(y,t,r,i);l=(E|0)>1;if(l){c=e+24|0;u=t+54|0;a=c;while(1){wn(a,t,r,i);d=n[u>>0]|0;h=d<<24>>24==0;if(!h){break e}p=a+8|0;m=p>>>0<s>>>0;if(m){a=p}else{break}}}}}while(0);return}function wn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0;T=f;g=e+4|0;b=o[g>>2]|0;y=b>>8;_=b&1;E=(_|0)==0;if(E){i=y}else{A=o[r>>2]|0;a=A+y|0;s=o[a>>2]|0;i=s}l=o[e>>2]|0;c=o[l>>2]|0;u=c+28|0;d=o[u>>2]|0;h=r+i|0;p=b&2;m=(p|0)!=0;v=m?n:2;Xn[d&3](l,t,h,v);return}function Tn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0;R=f;E=e+4|0;A=o[E>>2]|0;w=A>>8;T=A&1;l=(T|0)==0;if(l){s=w}else{c=o[n>>2]|0;u=c+w|0;d=o[u>>2]|0;s=d}h=o[e>>2]|0;p=o[h>>2]|0;m=p+20|0;v=o[m>>2]|0;g=n+s|0;b=A&2;y=(b|0)!=0;_=y?i:2;Qn[v&3](h,t,r,g,_,a);return}function kn(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,m=0,v=0,g=0,b=0,y=0,_=0,E=0,A=0,w=0,T=0,k=0;k=f;y=e+4|0;_=o[y>>2]|0;E=_>>8;A=_&1;w=(A|0)==0;if(w){a=E}else{s=o[r>>2]|0;l=s+E|0;c=o[l>>2]|0;a=c}u=o[e>>2]|0;d=o[u>>2]|0;h=d+24|0;p=o[h>>2]|0;m=r+a|0;v=_&2;g=(v|0)!=0;b=g?n:2;Zn[p&3](u,t,m,b,i);return}function Rn(){}function Sn(e,t,r){e=e|0;t=t|0;r=r|0;var i=0;var a=0;var s=0;var l=0;if((r|0)>=8192){return Ae(e|0,t|0,r|0)|0}i=e|0;l=e+r|0;if((e&3)==(t&3)){while(e&3){if((r|0)==0)return i|0;n[e>>0]=n[t>>0]|0;e=e+1|0;t=t+1|0;r=r-1|0}a=l&-4|0;s=a-64|0;while((e|0)<=(s|0)){o[e>>2]=o[t>>2]|0;o[e+4>>2]=o[t+4>>2]|0;o[e+8>>2]=o[t+8>>2]|0;o[e+12>>2]=o[t+12>>2]|0;o[e+16>>2]=o[t+16>>2]|0;o[e+20>>2]=o[t+20>>2]|0;o[e+24>>2]=o[t+24>>2]|0;o[e+28>>2]=o[t+28>>2]|0;o[e+32>>2]=o[t+32>>2]|0;o[e+36>>2]=o[t+36>>2]|0;o[e+40>>2]=o[t+40>>2]|0;o[e+44>>2]=o[t+44>>2]|0;o[e+48>>2]=o[t+48>>2]|0;o[e+52>>2]=o[t+52>>2]|0;o[e+56>>2]=o[t+56>>2]|0;o[e+60>>2]=o[t+60>>2]|0;e=e+64|0;t=t+64|0}while((e|0)<(a|0)){o[e>>2]=o[t>>2]|0;e=e+4|0;t=t+4|0}}else{a=l-4|0;while((e|0)<(a|0)){n[e>>0]=n[t>>0]|0;n[e+1>>0]=n[t+1>>0]|0;n[e+2>>0]=n[t+2>>0]|0;n[e+3>>0]=n[t+3>>0]|0;e=e+4|0;t=t+4|0}}while((e|0)<(l|0)){n[e>>0]=n[t>>0]|0;e=e+1|0;t=t+1|0}return i|0}function xn(e,t,r){e=e|0;t=t|0;r=r|0;var i=0,a=0,s=0,l=0;i=e+r|0;t=t&0xff;if((r|0)>=67){while((e&3)!=0){n[e>>0]=t;e=e+1|0}a=i&-4|0;s=a-64|0;l=t|t<<8|t<<16|t<<24;while((e|0)<=(s|0)){o[e>>2]=l;o[e+4>>2]=l;o[e+8>>2]=l;o[e+12>>2]=l;o[e+16>>2]=l;o[e+20>>2]=l;o[e+24>>2]=l;o[e+28>>2]=l;o[e+32>>2]=l;o[e+36>>2]=l;o[e+40>>2]=l;o[e+44>>2]=l;o[e+48>>2]=l;o[e+52>>2]=l;o[e+56>>2]=l;o[e+60>>2]=l;e=e+64|0}while((e|0)<(a|0)){o[e>>2]=l;e=e+4|0}}while((e|0)<(i|0)){n[e>>0]=t;e=e+1|0}return i-r|0}function jn(e){e=e|0;var t=0;var r=0;var n=0;var i=0;e=e+15&-16|0;t=o[d>>2]|0;n=t+e|0;if((e|0)>0&(n|0)<(t|0)|(n|0)<0){Q()|0;le(12);return-1}o[d>>2]=n;i=Z()|0;if((n|0)>(i|0)){if((X()|0)==0){o[d>>2]=t;le(12);return-1}}return t|0}function Cn(e){e=e|0;return Gn[e&1]()|0}function Mn(e,t){e=e|0;t=t|0;return Wn[e&1](t|0)|0}function In(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return qn[e&3](t|0,r|0,n|0)|0}function Dn(e,t){e=e|0;t=t|0;Kn[e&7](t|0)}function On(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;Xn[e&3](t|0,r|0,n|0,i|0)}function Pn(e,t,r,n,i,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;o=o|0;Zn[e&3](t|0,r|0,n|0,i|0,o|0)}function Nn(e,t,r,n,i,o,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;o=o|0;a=a|0;Qn[e&3](t|0,r|0,n|0,i|0,o|0,a|0)}function Vn(){q(0);return 0}function Hn(e){e=e|0;q(1);return 0}function Ln(e,t,r){e=e|0;t=t|0;r=r|0;q(2);return 0}function Fn(e){e=e|0;q(3)}function Bn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;q(4)}function Un(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;q(5)}function zn(e,t,r,n,i,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;o=o|0;q(6)}var Gn=[Vn,nt];var Wn=[Hn,lt];var qn=[Ln,tn,bn,Ln];var Kn=[Fn,Jr,Yr,$r,en,dn,gn,yn];var Xn=[Bn,on,fn,An];var Zn=[Un,nn,pn,En];var Qn=[zn,rn,hn,_n];return{__GLOBAL__sub_I_bind_cpp:mt,__GLOBAL__sub_I_whiteList_cpp:ft,___errno_location:Xr,___getTypeName:Wr,_free:Kr,_malloc:qr,_memcpy:Sn,_memset:xn,_sbrk:jn,dynCall_i:Cn,dynCall_ii:Mn,dynCall_iiii:In,dynCall_vi:Dn,dynCall_viiii:On,dynCall_viiiii:Pn,dynCall_viiiiii:Nn,establishStackSpace:$e,getTempRet0:rt,runPostSets:Rn,setTempRet0:tt,setThrew:et,stackAlloc:Qe,stackRestore:Ye,stackSave:Je}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer),__GLOBAL__sub_I_bind_cpp=Module.__GLOBAL__sub_I_bind_cpp=asm.__GLOBAL__sub_I_bind_cpp,__GLOBAL__sub_I_whiteList_cpp=Module.__GLOBAL__sub_I_whiteList_cpp=asm.__GLOBAL__sub_I_whiteList_cpp,___errno_location=Module.___errno_location=asm.___errno_location,___getTypeName=Module.___getTypeName=asm.___getTypeName,_free=Module._free=asm._free,_malloc=Module._malloc=asm._malloc,_memcpy=Module._memcpy=asm._memcpy,_memset=Module._memset=asm._memset,_sbrk=Module._sbrk=asm._sbrk,establishStackSpace=Module.establishStackSpace=asm.establishStackSpace,getTempRet0=Module.getTempRet0=asm.getTempRet0,runPostSets=Module.runPostSets=asm.runPostSets,setTempRet0=Module.setTempRet0=asm.setTempRet0,setThrew=Module.setThrew=asm.setThrew,stackAlloc=Module.stackAlloc=asm.stackAlloc,stackRestore=Module.stackRestore=asm.stackRestore,stackSave=Module.stackSave=asm.stackSave,dynCall_i=Module.dynCall_i=asm.dynCall_i,dynCall_ii=Module.dynCall_ii=asm.dynCall_ii,dynCall_iiii=Module.dynCall_iiii=asm.dynCall_iiii,dynCall_vi=Module.dynCall_vi=asm.dynCall_vi,dynCall_viiii=Module.dynCall_viiii=asm.dynCall_viiii,dynCall_viiiii=Module.dynCall_viiiii=asm.dynCall_viiiii,dynCall_viiiiii=Module.dynCall_viiiiii=asm.dynCall_viiiiii;if(Module.asm=asm,memoryInitializer)if(isDataURI(memoryInitializer)||("function"==typeof Module.locateFile?memoryInitializer=Module.locateFile(memoryInitializer):Module.memoryInitializerPrefixURL&&(memoryInitializer=Module.memoryInitializerPrefixURL+memoryInitializer)),ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL){var data=Module.readBinary(memoryInitializer);HEAPU8.set(data,GLOBAL_BASE)}else{addRunDependency("memory initializer");var applyMemoryInitializer=function(e){e.byteLength&&(e=new Uint8Array(e)),HEAPU8.set(e,GLOBAL_BASE),Module.memoryInitializerRequest&&delete Module.memoryInitializerRequest.response,removeRunDependency("memory initializer")};function doBrowserLoad(){Module.readAsync(memoryInitializer,applyMemoryInitializer,(function(){throw"could not load memory initializer "+memoryInitializer}))}var memoryInitializerBytes=tryParseAsDataURI(memoryInitializer);if(memoryInitializerBytes)applyMemoryInitializer(memoryInitializerBytes.buffer);else if(Module.memoryInitializerRequest){function useRequest(){var e=Module.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var r=tryParseAsDataURI(Module.memoryInitializerRequestURL);if(!r)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+memoryInitializer),void doBrowserLoad();t=r.buffer}applyMemoryInitializer(t)}Module.memoryInitializerRequest.response?setTimeout(useRequest,0):Module.memoryInitializerRequest.addEventListener("load",useRequest)}else doBrowserLoad()}function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var calledMain=!1;function run(e){function t(){Module.calledRun||(Module.calledRun=!0,ABORT||(ensureInitRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),postRun()))}e=e||Module.arguments,runDependencies>0||(preRun(),runDependencies>0||Module.calledRun||(Module.setStatus?(Module.setStatus("Running..."),setTimeout((function(){setTimeout((function(){Module.setStatus("")}),1),t()}),1)):t()))}function exit(e,t){t&&Module.noExitRuntime&&0===e||(Module.noExitRuntime||(ABORT=!0,EXITSTATUS=e,STACKTOP=initialStackTop,exitRuntime(),Module.onExit&&Module.onExit(e)),ENVIRONMENT_IS_NODE&&process.exit(e),Module.quit(e,new ExitStatus(e)))}dependenciesFulfilled=function e(){Module.calledRun||run(),Module.calledRun||(dependenciesFulfilled=e)},Module.run=run,Module.exit=exit;var abortDecorators=[];function abort(e){throw Module.onAbort&&Module.onAbort(e),void 0!==e?(Module.print(e),Module.printErr(e),e=JSON.stringify(e)):e="",ABORT=!0,EXITSTATUS=1,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(Module.abort=abort,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();Module.noExitRuntime=!0,run(),function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=r(1);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";var o=AFRAME.utils.srcLoader.parseUrl,a=AFRAME.utils.debug;a.enable("shader:gif:warn");var s=a("shader:gif:warn"),l=(a("shader:gif:debug"),{});function c(e,t){return{status:"error",src:t,message:e,timestamp:Date.now()}}AFRAME.registerShader("gif",{schema:{color:{type:"color"},fog:{default:!0},src:{default:null},autoplay:{default:!0}},init:function(e){return this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var r=this.__getMaterialData(e);Object.keys(r).forEach((function(e){t[e]=r[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,r=e.autoplay;"boolean"==typeof r?this.__autoplay=r:void 0===r&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var r=o(e);if(r)this.__getImageSrc(r,t);else{var i=void 0,a=this.__validateAndGetQuerySelector(e);if(a&&"object"===(void 0===a?"undefined":n(a))){if(a.error)i=a.error;else{var s=a.tagName.toLowerCase();if("video"===s)e=a.src,i="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(a.src,t);i="For <"+s+"> element, please use `aframe-html-shader`"}}var u,d;i&&(u=l[e],d=c(i,e),u&&u.callbacks?u.callbacks.forEach((function(e){return e(d)})):t(d),l[e]=d)}}},__getImageSrc:function(e,t){var r=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(t){r.__getUnit8Array(e,(function(t){t?(0,i.parseGIF)(t,(function(t,r,i){var o={status:"success",src:e,times:t,cnt:r,frames:i,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(o)})),l[e]=o)}),(function(e){return a(e)})):a("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(e){return a("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=e}function a(t){var r=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(r)})),l[e]=r)}},__getUnit8Array:function(e,t){if("function"==typeof t){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.addEventListener("load",(function(e){for(var r=new Uint8Array(e.target.response),n=r.subarray(0,4),i="",o=0;o<n.length;o++)i+=n[o].toString(16);"47494638"===i?t(r):t()})),r.addEventListener("error",(function(e){t()})),r.send()}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,r=e.times,n=e.cnt,i=e.frames;this.__textureSrc=t,this.__delayTimes=r,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=i,this.__frameCnt=r.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(i[0].width),this.__height=THREE.Math.floorPowerOfTwo(i[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}}),AFRAME.registerShader("gif_RGB",{schema:{color:{type:"color",is:"uniform",default:0},fog:{default:!0},texture:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_threshold:{type:"number",is:"uniform",default:.8},_slope:{type:"number",is:"uniform",default:.2},src:{default:null},autoplay:{default:!0}},init:function(e){this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset();var t={vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform vec3 color;","uniform float opacity;","varying vec2 vUV;","uniform float _threshold;","uniform float _slope;","void main(){"," vec3 tColor = texture2D( texture, vUV ).rgb;"," float a = texture2D( texture, vUV ).a;"," float d1, d2, d3, d4, d;"," d1 = abs(length(abs(color.rgb - tColor.rgb)));"," float c1 = abs(length( tColor.g - tColor.r) - length(color.g - color.r));"," float c2 = abs(length( tColor.r - tColor.b) - length(color.r - color.b));"," float c3 = abs(length( tColor.b - tColor.g) - length(color.b - color.g));"," d4 = c1 + c2 + c3;"," d = (d1*2.0 + d4) / 2.0 ;"," float edge0 = _threshold * (1.0 - _slope);"," float alpha = smoothstep(edge0, _threshold, d);"," if (alpha < opacity){","   gl_FragColor = vec4(tColor, alpha*a);"," }"," else{","   gl_FragColor = vec4(tColor, opacity*a);"," }","}"].join("\n")};return this.material=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(e.color)},texture:{value:this.__texture},opacity:{value:e.opacity},_threshold:{value:e._threshold},_slope:{value:e._slope}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var r=this.__getMaterialData(e);Object.keys(r).forEach((function(e){t[e]=r[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,r=e.autoplay;"boolean"==typeof r?this.__autoplay=r:void 0===r&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var r=o(e);if(r)this.__getImageSrc(r,t);else{var i=void 0,a=this.__validateAndGetQuerySelector(e);if(a&&"object"===(void 0===a?"undefined":n(a))){if(a.error)i=a.error;else{var s=a.tagName.toLowerCase();if("video"===s)e=a.src,i="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(a.src,t);i="For <"+s+"> element, please use `aframe-html-shader`"}}var u,d;i&&(u=l[e],d=c(i,e),u&&u.callbacks?u.callbacks.forEach((function(e){return e(d)})):t(d),l[e]=d)}}},__getImageSrc:function(e,t){var r=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(t){r.__getUnit8Array(e,(function(t){t?(0,i.parseGIF)(t,(function(t,r,i){var o={status:"success",src:e,times:t,cnt:r,frames:i,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(o)})),l[e]=o)}),(function(e){return a(e)})):a("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(e){return a("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=e}function a(t){var r=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(r)})),l[e]=r)}},__getUnit8Array:function(e,t){if("function"==typeof t){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.addEventListener("load",(function(e){for(var r=new Uint8Array(e.target.response),n=r.subarray(0,4),i="",o=0;o<n.length;o++)i+=n[o].toString(16);"47494638"===i?t(r):t()})),r.addEventListener("error",(function(e){t()})),r.send()}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,r=e.times,n=e.cnt,i=e.frames;this.__textureSrc=t,this.__delayTimes=r,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=i,this.__frameCnt=r.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(i[0].width),this.__height=THREE.Math.floorPowerOfTwo(i[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}}),AFRAME.registerShader("gif_HSV",{schema:{color:{type:"color"},fog:{default:!0},texture:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_keyingColorH:{type:"number",is:"uniform",default:.33},_keyingColorS:{type:"number",is:"uniform",default:1},_keyingColorV:{type:"number",is:"uniform",default:.75},_deltaH:{type:"number",is:"uniform",default:.2},_deltaS:{type:"number",is:"uniform",default:.1},_deltaV:{type:"number",is:"uniform",default:.1},src:{default:null},autoplay:{default:!0}},init:function(e){this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset();var t={vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform float opacity;","varying vec2 vUV;","uniform float _keyingColorH;","uniform float _keyingColorS;","uniform float _keyingColorV;","uniform float _deltaH;","uniform float _deltaS;","uniform float _deltaV;","vec3 rgb2hsv(vec3 c){"," vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);"," vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));"," vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));"," float d = q.x - min(q.w, q.y);"," float e = 1.0e-10;"," return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","void main(){"," vec3 tColor = texture2D( texture, vUV ).rgb;"," float a = texture2D( texture, vUV ).a;"," vec3 HSV = rgb2hsv(tColor);"," float h = abs(HSV.x - _keyingColorH);"," float s = abs(HSV.y - _keyingColorS);"," float v = abs(HSV.z - _keyingColorV);"," float alpha = opacity;"," if (h <= _deltaH * 0.5 && s <= _deltaS && v <= _deltaV){","   alpha = smoothstep((_deltaH * 0.5) * 0.8, _deltaH* 0.6 ,h);"," }","gl_FragColor = vec4(tColor, alpha*a);","}"].join("\n")};return this.material=new THREE.ShaderMaterial({uniforms:{texture:{value:this.__texture},opacity:{value:e.opacity},_keyingColorH:{value:e._keyingColorH},_keyingColorS:{value:e._keyingColorS},_keyingColorV:{value:e._keyingColorV},_deltaH:{value:e._deltaH},_deltaS:{value:e._deltaS},_deltaV:{value:e._deltaV}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var r=this.__getMaterialData(e);Object.keys(r).forEach((function(e){t[e]=r[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,r=e.autoplay;"boolean"==typeof r?this.__autoplay=r:void 0===r&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var r=o(e);if(r)this.__getImageSrc(r,t);else{var i=void 0,a=this.__validateAndGetQuerySelector(e);if(a&&"object"===(void 0===a?"undefined":n(a))){if(a.error)i=a.error;else{var s=a.tagName.toLowerCase();if("video"===s)e=a.src,i="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(a.src,t);i="For <"+s+"> element, please use `aframe-html-shader`"}}var u,d;i&&(u=l[e],d=c(i,e),u&&u.callbacks?u.callbacks.forEach((function(e){return e(d)})):t(d),l[e]=d)}}},__getImageSrc:function(e,t){var r=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(t){r.__getUnit8Array(e,(function(t){t?(0,i.parseGIF)(t,(function(t,r,i){var o={status:"success",src:e,times:t,cnt:r,frames:i,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(o)})),l[e]=o)}),(function(e){return a(e)})):a("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(e){return a("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=e}function a(t){var r=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(r)})),l[e]=r)}},__getUnit8Array:function(e,t){if("function"==typeof t){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.addEventListener("load",(function(e){for(var r=new Uint8Array(e.target.response),n=r.subarray(0,4),i="",o=0;o<n.length;o++)i+=n[o].toString(16);"47494638"===i?t(r):t()})),r.addEventListener("error",(function(e){t()})),r.send()}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,r=e.times,n=e.cnt,i=e.frames;this.__textureSrc=t,this.__delayTimes=r,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=i,this.__frameCnt=r.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(i[0].width),this.__height=THREE.Math.floorPowerOfTwo(i[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}})},function(e,t){"use strict";t.parseGIF=function(e,t,r){var n=0,i=[],o=0,a=null,s=null,l=[],c=0;if(71!==e[0]||73!==e[1]||70!==e[2]||56!==e[3]||57!==e[4]&&55!==e[4]||97!==e[5])r&&r("parseGIF: no GIF89a");else{n+=13+ +!!(128&e[10])*Math.pow(2,1+(7&e[10]))*3;for(var u=e.subarray(0,n);e[n]&&59!==e[n];){var d=n,h=e[n];if(33===h){var p=e[++n];if(-1===[1,254,249,255].indexOf(p)){r&&r("parseGIF: unknown label");break}for(249===p&&i.push(10*(e[n+3]+(e[n+4]<<8))),255===p&&(c=e[n+15]+(e[n+16]<<8));e[++n];)n+=e[n];249===p&&(a=e.subarray(d,n+1))}else{if(44!==h){r&&r("parseGIF: unknown blockId");break}for(n+=9,n+=1+ +!!(128&e[n])*(3*Math.pow(2,1+(7&e[n])));e[++n];)n+=e[n];s=e.subarray(d,n+1);var f={disposalMethod:a[3],blob:URL.createObjectURL(new Blob([u,a,s]))};l.push(f)}n++}}if(l.length){var m=document.createElement("canvas"),v=function e(r){var n=new Image;n.onload=function(r,n){o++,l[n]=this,o===l.length?(m=null,t&&t(i,c,l)):e(++n)}.bind(n),n.src=m.toDataURL("image/gif")};l.forEach((function(e,t){var r=new Image;r.onload=function(e,t){0===t&&(m.width=r.width,m.height=r.height),o++,l[t]=this,o===l.length&&(o=0,v(1))}.bind(r,null,t),r.src=e.blob,r.disposalMethod=e.disposalMethod}))}}}]),function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};t[a][0].call(u.exports,(function(e){var r=t[a][1][e];return i(r||e)}),u,u.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";e("./")},{"./":2}],2:[function(e,t,r){"use strict";e("./src/controls"),e("./src/loaders"),e("./src/misc"),e("./src/pathfinding"),e("./src/primitives")},{"./src/controls":14,"./src/loaders":23,"./src/misc":28,"./src/pathfinding":34,"./src/primitives":42}],3:[function(e,t,r){"use strict";t.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,o=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(e,o))}),r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,o=n.length;i<o;i++){var a=n[i];a.nodeName===t&&r.push(a)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function a(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,n,i){var o=r(e,t)[0];if(void 0!==o)for(var a=r(o,n),s=0;s<a.length;s++)i(a[s])}function d(e,t){for(var r in e){e[r].build=t(e[r])}}function h(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=a(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=o}}return t}function f(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),o=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)r=i.split("."),i=r.shift(),t.member=r.shift();else if(o){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=o,t.memberSyntax=s,t.sampler=a(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var o in r)if(r.hasOwnProperty(o)){var a=r[o],s=n[a.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;E(g(a,i[l],i[c]),t)}return t}function v(e){return h(qe.animations[e],m)}function g(e,t,r){var n,i,o,a,s,l,c=qe.nodes[e.id],u=Pe(c.id),d=c.transforms[e.sid],h=c.matrix.clone().transpose(),p={};switch(d){case"matrix":for(o=0,a=t.array.length;o<a;o++)if(n=t.array[o],i=o*r.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=r.array[i],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(s=0,l=r.stride;s<l;s++)p[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',d)}var v=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort(o);for(var i=0;i<16;i++)A(r,i,t.elements[i]);return r;function o(e,t){return e.time-t.time}}(p,h);return{name:u.uuid,keyframes:v}}var b=new THREE.Vector3,y=new THREE.Vector3,_=new THREE.Quaternion;function E(e,t){for(var r=e.keyframes,n=e.name,i=[],o=[],a=[],s=[],l=0,c=r.length;l<c;l++){var u=r[l],d=u.time,h=u.value;Te.fromArray(h).transpose(),Te.decompose(b,_,y),i.push(d),o.push(b.x,b.y,b.z),a.push(_.x,_.y,_.z,_.w),s.push(y.x,y.y,y.z)}return o.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",i,o)),a.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",i,a)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",i,s)),t}function A(e,t,r){var n,i,o,a=!0;for(i=0,o=e.length;i<o;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:a=!1;if(!0===a)for(i=0,o=e.length;i<o;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,o=e.length;i<o;i++){var a=e[i];if(null===a.value[t]){if(r=w(e,i,t),n=T(e,i,t),null===r){a.value[t]=n.value[t];continue}if(null===n){a.value[t]=r.value[t];continue}k(a,r,n,t)}}}(e,t)}function w(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function T(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function k(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function R(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,o=0,a=i.length;o<a;o++)for(var s=v(i[o]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function S(e){return h(qe.clips[e],R)}function x(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(o.textContent);break;case"source":var a=o.getAttribute("id");t.sources[a]=ie(o);break;case"joints":t.joints=j(o);break;case"vertex_weights":t.vertexWeights=C(o)}}return t}function j(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),s=a(i.getAttribute("source"));t.inputs[o]=s}}return t}function C(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=a(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=o(i.textContent);break;case"v":t.v=o(i.textContent)}}return t}function M(e){var t={id:e.id},r=qe.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i=4,o={joints:[],indices:{array:[],stride:i},weights:{array:[],stride:i}},a=e.sources,s=e.vertexWeights,l=s.vcount,c=s.v,u=s.inputs.JOINT.offset,d=s.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],p=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=a[s.inputs.WEIGHT.id].array,m=0;for(t=0,n=l.length;t<n;t++){var v=l[t],g=[];for(r=0;r<v;r++){var b=c[m+u],y=f[c[m+d]];g.push({index:b,weight:y}),m+=2}for(g.sort(w),r=0;r<i;r++){var _=g[r];void 0!==_?(o.indices.array.push(_.index),o.weights.array.push(_.weight)):(o.indices.array.push(0),o.weights.array.push(0))}}e.bindShapeMatrix?o.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():o.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=h.array.length;t<n;t++){var E=h.array[t],A=(new THREE.Matrix4).fromArray(p.array,t*p.stride).transpose();o.joints.push({name:E,boneInverse:A})}return o;function w(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function I(e){return void 0!==e.build?e.build:e.init_from}function D(e){var t=qe.images[e];return void 0!==t?h(t,I):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function O(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":P(i,t);break;case"technique":t.technique=H(i);break;case"extra":t.extra=G(i)}}return t}function P(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[r]=N(o);break;case"sampler2D":t.samplers[r]=V(o)}}}function N(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function V(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function H(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=L(i)}}return t}function L(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=F(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:F(i)}}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=i(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:B(o)}}}return t}function B(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":U(i,t)}}return t}function U(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":z(i,t)}}}function z(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function G(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=W(i)}}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function q(e){return e}function K(e){var t,r,n=(t=e.url,h(qe.effects[t],q)),i=n.profile.technique,o=n.profile.extra;switch(i.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function a(e){var t=n.profile.samplers[e.id],r=null;void 0!==t?r=D(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=D(e.id));if(null!==r){var i=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=Fe;break;default:t=Ue}return t}(r);if(void 0!==i){var o=i.load(r),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===s(a.technique)){var l=a.technique;o.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.offset.set(l.offsetU||0,l.offsetV||0),o.repeat.set(l.repeatU||1,l.repeatV||1)}else o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name;var l=i.parameters;for(var c in l){var u=l[c];switch(c){case"diffuse":u.color&&r.color.fromArray(u.color),u.texture&&(r.map=a(u.texture));break;case"specular":u.color&&r.specular&&r.specular.fromArray(u.color),u.texture&&(r.specularMap=a(u.texture));break;case"bump":u.texture&&(r.normalMap=a(u.texture));break;case"ambient":u.texture&&(r.lightMap=a(u.texture));break;case"shininess":u.float&&r.shininess&&(r.shininess=u.float);break;case"emission":u.color&&r.emissive&&r.emissive.fromArray(u.color),u.texture&&(r.emissiveMap=a(u.texture))}}var d=l.transparent,p=l.transparency;if(void 0===p&&d&&(p={float:1}),void 0===d&&p&&(d={opaque:"A_ONE",data:{color:[1,1,1,1]}}),d&&p)if(d.data.texture)r.transparent=!0;else{var f=d.data.color;switch(d.opaque){case"A_ONE":r.opacity=f[3]*p.float;break;case"RGB_ZERO":r.opacity=1-f[0]*p.float;break;case"A_ZERO":r.opacity=1-f[3]*p.float;break;case"RGB_ONE":r.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',d.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(r.side=THREE.DoubleSide),r}function X(e){return h(qe.materials[e],K)}function Z(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return Q(r)}}return{}}function Q(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=J(n)}}return t}function J(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function Y(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function $(e){var t=qe.cameras[e];return void 0!==t?h(t,Y):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=te(i)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var a=i(o.textContent);t.color=(new THREE.Color).fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=qe.lights[e];return void 0!==t?h(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=i(a.textContent);break;case"Name_array":t.array=n(a.textContent);break;case"technique_common":var s=r(a,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function oe(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=a(n.getAttribute("source")))}return t}function ae(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=a(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),d=u>0?l+u:l;t.inputs[d]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(i.textContent);break;case"p":t.p=o(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var o=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var a in o){var s=o[a];se(s),t[a]=ce(s,r,n)}return t}function ce(e,t,r){for(var n={},i={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=4,d=[],h=4,p=new THREE.BufferGeometry,f=[],m=0,v=0;v<e.length;v++){var g=e[v],b=g.inputs,y=0;switch(g.type){case"lines":case"linestrips":y=2*g.count;break;case"triangles":y=3*g.count;break;case"polylist":for(var _=0;_<g.count;_++){var E=g.vcount[_];switch(E){case 3:y+=3;break;case 4:y+=6;break;default:y+=3*(E-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var A in p.addGroup(m,y,v),m+=y,g.material&&f.push(g.material),b){var w=b[A];switch(A){case"VERTEX":for(var T in r){var k=r[T];switch(T){case"POSITION":var R=i.array.length;if(ue(g,t[k],w.offset,i.array),i.stride=t[k].stride,t.skinWeights&&t.skinIndices&&(ue(g,t.skinIndices,w.offset,c),ue(g,t.skinWeights,w.offset,d)),!1===g.hasUV&&!0===e.uvsNeedsFix){y=(i.array.length-R)/i.stride;for(var S=0;S<y;S++)a.array.push(0,0)}break;case"NORMAL":ue(g,t[k],w.offset,o.array),o.stride=t[k].stride;break;case"COLOR":ue(g,t[k],w.offset,l.array),l.stride=t[k].stride;break;case"TEXCOORD":ue(g,t[k],w.offset,a.array),a.stride=t[k].stride;break;case"TEXCOORD1":ue(g,t[k],w.offset,s.array),a.stride=t[k].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',T)}}break;case"NORMAL":ue(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":ue(g,t[w.id],w.offset,l.array),l.stride=t[w.id].stride;break;case"TEXCOORD":ue(g,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"TEXCOORD1":ue(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return i.array.length>0&&p.addAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),o.array.length>0&&p.addAttribute("normal",new THREE.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&p.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&p.addAttribute("uv",new THREE.Float32BufferAttribute(a.array,a.stride)),s.array.length>0&&p.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&p.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,u)),d.length>0&&p.addAttribute("skinWeight",new THREE.Float32BufferAttribute(d,h)),n.data=p,n.type=e[0].type,n.materialKeys=f,n}function ue(e,t,r,n){var i=e.p,o=e.stride,a=e.vcount;function s(e){for(var t=i[e+r]*c,o=t+c;t<o;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var u=0,d=0,h=a.length;d<h;d++){var p=a[d];if(4===p){var f=u+1*o,m=u+2*o,v=u+3*o;s(u+0*o),s(f),s(v),s(f),s(m),s(v)}else if(3===p){f=u+1*o,m=u+2*o;s(u+0*o),s(f),s(m)}else if(p>4)for(var g=1,b=p-2;g<=b;g++){f=u+o*g,m=u+o*(g+1);s(u+0*o),s(f),s(m)}u+=o*p}else for(d=0,h=i.length;d<h;d+=o)s(d)}function de(e){return h(qe.geometries[e],le)}function he(e){return void 0!==e.build?e.build:e}function pe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=fe(n);break;case"link":t.links.push(ve(n))}}}function fe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=i(n.textContent);t.axis.fromArray(o);break;case"limits":var a=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(a.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(n))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(n))}}return t}function be(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.Math.degToRad(r[3])}return t}function ye(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":_e(n,t)}}}function _e(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function Ee(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function Ae(e){return void 0!==e.build?e.build:e}function we(e){for(var t=[],r=He.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"matrix":var a=i(o.textContent),s=(new THREE.Matrix4).fromArray(a).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:s});break;case"translate":case"scale":a=i(o.textContent);var l=(new THREE.Vector3).fromArray(a);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":a=i(o.textContent),l=(new THREE.Vector3).fromArray(a);var c=THREE.Math.degToRad(a[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:c})}}return t}var Te=new THREE.Matrix4,ke=new THREE.Vector3;function Re(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Re(n);break;case"instance_camera":t.instanceCameras.push(a(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Se(n));break;case"instance_light":t.instanceLights.push(a(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Se(n));break;case"instance_node":t.instanceNodes.push(a(n.getAttribute("url")));break;case"matrix":var o=i(n.textContent);t.matrix.multiply(Te.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=i(n.textContent);ke.fromArray(o),t.matrix.multiply(Te.makeTranslation(ke.x,ke.y,ke.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=i(n.textContent);var s=THREE.Math.degToRad(o[3]);t.matrix.multiply(Te.makeRotationAxis(ke.fromArray(o),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=i(n.textContent);t.matrix.scale(ke.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Oe(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):qe.nodes[t.id]=t,t}function Se(e){for(var t={id:a(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var s=i[o],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=a(c)}break;case"skeleton":t.skeletons.push(a(n.textContent))}}return t}function xe(e,t){var r,n,i,o=[],a=[];for(r=0;r<e.length;r++){var s=e[r];if(Oe(s))je(Pe(s),t,o);else if(i=s,void 0!==qe.visualScenes[i])for(var l=qe.visualScenes[s].children,c=0;c<l.length;c++){var u=l[c];if("JOINT"===u.type)je(Pe(u.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(c=0;c<o.length;c++)if((n=o[c]).bone.name===t[r].name){a[r]=n,n.processed=!0;break}for(r=0;r<o.length;r++)!1===(n=o[r]).processed&&(a.push(n),n.processed=!0);var d=[],h=[];for(r=0;r<a.length;r++)n=a[r],d.push(n.bone),h.push(n.boneInverse);return new THREE.Skeleton(d,h)}function je(e,t,r){e.traverse((function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var o=t[i];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}}))}function Ce(e){for(var t,r=[],n=e.matrix,i=e.nodes,o=e.type,a=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,d=0,p=i.length;d<p;d++)r.push(Pe(i[d]));for(d=0,p=a.length;d<p;d++){var f=$(a[d]);null!==f&&r.push(f.clone())}for(d=0,p=s.length;d<p;d++)for(var m=s[d],v=(t=m.id,h(qe.controllers[t],M)),g=De(de(v.id),m.materials),b=xe(m.skeletons,v.skin.joints),y=0,_=g.length;y<_;y++){var E;(E=g[y]).isSkinnedMesh&&(E.bind(b,v.skin.bindMatrix),E.normalizeSkinWeights()),r.push(E)}for(d=0,p=l.length;d<p;d++){var A=ne(l[d]);null!==A&&r.push(A.clone())}for(d=0,p=c.length;d<p;d++)for(y=0,_=(g=De(de((m=c[d]).id),m.materials)).length;y<_;y++)r.push(g[y]);for(d=0,p=u.length;d<p;d++)r.push(Pe(u[d]).clone());if(0===i.length&&1===r.length)E=r[0];else{E="JOINT"===o?new THREE.Bone:new THREE.Group;for(d=0;d<r.length;d++)E.add(r[d])}return""===E.name&&(E.name="JOINT"===o?e.sid:e.name),E.matrix.copy(n),E.matrix.decompose(E.position,E.quaternion,E.scale),E}var Me=new THREE.MeshBasicMaterial({color:16711935});function Ie(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var o=t[e[n]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Me)):r.push(X(o))}return r}function De(e,t){var r=[];for(var n in e){var i=e[n],o=Ie(i.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new THREE.LineBasicMaterial):o.push(new THREE.MeshPhongMaterial));var a=void 0!==i.data.attributes.skinIndex;if(a)for(var s=0,l=o.length;s<l;s++)o[s].skinning=!0;var c,u=1===o.length?o[0]:o;switch(n){case"lines":c=new THREE.LineSegments(i.data,u);break;case"linestrips":c=new THREE.Line(i.data,u);break;case"triangles":case"polylist":c=a?new THREE.SkinnedMesh(i.data,u):new THREE.Mesh(i.data,u)}r.push(c)}return r}function Oe(e){return void 0!==qe.nodes[e]}function Pe(e){return h(qe.nodes[e],Ce)}function Ne(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(Pe(i.id))}return t}function Ve(e){return h(qe.visualScenes[e],Ne)}if(0===e.length)return{scene:new THREE.Scene};var He=r((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],Le=He.getAttribute("version");console.log("THREE.ColladaLoader: File version",Le);var Fe,Be=function(e){return{unit:l(r(e,"unit")[0]),upAxis:c(r(e,"up_axis")[0])}}(r(He,"asset")[0]),Ue=new THREE.TextureLoader(this.manager);Ue.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Fe=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var ze=[],Ge={},We=0,qe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(He,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"source":i=o.getAttribute("id"),t.sources[i]=ie(o);break;case"sampler":i=o.getAttribute("id"),t.samplers[i]=p(o);break;case"channel":i=o.getAttribute("target"),t.channels[i]=f(o);break;default:console.log(o)}}qe.animations[e.getAttribute("id")]=t})),u(He,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(a(i.getAttribute("url")))}}qe.clips[e.getAttribute("id")]=t})),u(He,"library_controllers","controller",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=a(i.getAttribute("source")),t.skin=x(i);break;case"morph":t.id=a(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}qe.controllers[e.getAttribute("id")]=t})),u(He,"library_images","image",(function(e){var t={init_from:r(e,"init_from")[0].textContent};qe.images[e.getAttribute("id")]=t})),u(He,"library_effects","effect",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=O(i)}}qe.effects[e.getAttribute("id")]=t})),u(He,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=a(i.getAttribute("url"))}}qe.materials[e.getAttribute("id")]=t})),u(He,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Z(i)}}qe.cameras[e.getAttribute("id")]=t})),u(He,"library_lights","light",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=ee(i)}}qe.lights[e.getAttribute("id")]=t})),u(He,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[a]=ie(o);break;case"vertices":t.vertices=oe(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ae(o));break;default:console.log(o)}}}qe.geometries[e.getAttribute("id")]=t}})),u(He,"library_nodes","node",Re),u(He,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+We++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Re(n[i]));qe.visualScenes[e.getAttribute("id")]=t})),u(He,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":pe(n,t)}}qe.kinematicsModels[e.getAttribute("id")]=t})),u(He,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},ye(n,t.rigidBodies[n.getAttribute("name")])}}qe.physicsModels[e.getAttribute("id")]=t})),u(He,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ee(n))}}qe.kinematicsScenes[a(e.getAttribute("url"))]=t})),d(qe.animations,m),d(qe.clips,R),d(qe.controllers,M),d(qe.images,I),d(qe.effects,q),d(qe.materials,K),d(qe.cameras,Y),d(qe.lights,re),d(qe.geometries,le),d(qe.visualScenes,Ne),function(){var e=qe.clips;if(!0===s(e)){if(!1===s(qe.animations)){var t=[];for(var r in qe.animations)for(var n=v(r),i=0,o=n.length;i<o;i++)t.push(n[i]);ze.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)ze.push(S(r))}(),function(){var e=Object.keys(qe.kinematicsModels)[0],t=Object.keys(qe.kinematicsScenes)[0],r=Object.keys(qe.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,i=(n=e,h(qe.kinematicsModels[n],he)),o=function(e){return h(qe.kinematicsScenes[e],Ae)}(t),a=Ve(r),s=o.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var d=s[c],p=He.querySelector('[sid="'+d.target+'"]');if(p){var f=p.parentElement;v(d.jointIndex,f)}}var m=new THREE.Matrix4;Ge={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,o=n.axis,a=r.transforms;Te.identity();for(var s=0;s<a.length;s++){var c=a[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":Te.multiply(m.makeRotationAxis(o,THREE.Math.degToRad(t)));break;case"prismatic":Te.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":Te.multiply(c.obj);break;case"translate":Te.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":Te.scale(c.obj);break;case"rotate":Te.multiply(m.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(Te),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var r=t.getAttribute("name"),n=i.joints[e];a.traverse((function(i){i.name===r&&(l[e]={object:i,transforms:we(t),joint:n,position:n.zeroPosition})}))}}();var Ke=function(e){return Ve(a(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(He,"scene")[0]);return"Z_UP"===Be.upAxis&&Ke.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(Be.unit),{animations:ze,kinematics:Ge,library:qe,scene:Ke}}}},{}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"function"==typeof Symbol&&n(Symbol.iterator);t.exports=THREE.FBXLoader=function(){var e,t,r;function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function i(e){this.textureLoader=e}function o(){}function a(){}function s(){}function l(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function u(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function h(e){return e/46186158e3}n.prototype={constructor:n,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,o=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,a=new THREE.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,(function(r){try{t(i.parse(r,o))}catch(t){setTimeout((function(){n&&n(t),i.manager.itemError(e)}),0)}}),r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,r){if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===_(e,0,t.length)}(t))e=(new l).parse(t);else{var n=_(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var i=0;i<t.length;++i){if(n(1)===t[i])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new s).parse(n)}return new i(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin)).parse(e)}},i.prototype={constructor:i,parse:function(){t=this.parseConnections();var n=this.parseImages(),i=this.parseTextures(n),a=this.parseMaterials(i),s=this.parseDeformers(),l=(new o).parse(s);return this.parseScene(s,l,a),e&&e.FBXHeaderExtension&&e.FBXHeaderExtension.SceneInfo&&e.FBXHeaderExtension.SceneInfo["LastSaved|ApplicationName"]&&(r["LastSaved|ApplicationName"]||(r["LastSaved|ApplicationName"]=e.FBXHeaderExtension.SceneInfo["LastSaved|ApplicationName"])),e&&e.GlobalSettings&&e.GlobalSettings.OriginalUnitScaleFactor&&e.GlobalSettings.OriginalUnitScaleFactor.value&&(r.OriginalUnitScaleFactor||(r.OriginalUnitScaleFactor=e.GlobalSettings.OriginalUnitScaleFactor.value)),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};t.get(r).parents.push(o),t.has(n)||t.set(n,{parents:[],children:[]});var a={ID:r,relationship:i};t.get(n).children.push(a)}));return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var o=n[i];if(t[c=parseInt(i)]=o.RelativeFilename||o.Filename,"Content"in o){var a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,s="string"==typeof o.Content&&""!==o.Content;if(a||s){var l=this.parseImage(n[i]);r[o.RelativeFilename||o.Filename]=l}}}}for(var c in t){var u=t[c];void 0!==r[u]?t[c]=r[u]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");if(null===THREE.Loader.Handlers.get(".tga")){var o=new THREE.TGALoader;o.setPath(this.textureLoader.path),THREE.Loader.Handlers.add(/\.tga$/i,o)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var a=new Uint8Array(r);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var o=this.parseTexture(n[i],t);r.set(parseInt(i),o)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,i=e.WrapModeV,o=void 0!==n?n.value:0,a=void 0!==i?i.value:0;if(r.wrapS=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;r.repeat.x=s[0],r.repeat.y=s[1]}return r},loadTexture:function(e,r){var n,i,o=this.textureLoader.path,a=t.get(e.id).children;void 0!==a&&a.length>0&&void 0!==r[a[0].ID]&&(0!==(n=r[a[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=THREE.Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),i=new THREE.Texture):i=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(o),i},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var o=this.parseMaterial(n[i],t);null!==o&&r.set(parseInt(i),o)}}return r},parseMaterial:function(e,r){var n=e.id,i=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(n))return null;var a,s=this.parseParameters(e,r,n);switch(o.toLowerCase()){case"phong":a=new THREE.MeshPhongMaterial;break;case"lambert":a=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new THREE.MeshPhongMaterial({color:3342591})}return a.setValues(s),a.name=i,a},parseParameters:function(e,r,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var o=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=o.getTexture(r,e.ID);break;case"DiffuseColor":i.map=o.getTexture(r,e.ID);break;case"DisplacementColor":i.displacementMap=o.getTexture(r,e.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(r,e.ID);break;case"NormalMap":i.normalMap=o.getTexture(r,e.ID);break;case"ReflectionColor":i.envMap=o.getTexture(r,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=o.getTexture(r,e.ID);break;case"TransparentColor":i.alphaMap=o.getTexture(r,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),i},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var o in i){var a=i[o],s=t.get(parseInt(o));if("Skin"===a.attrType){var l=this.parseSkeleton(s,i);l.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,r[o]=l}else if("BlendShape"===a.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(s,i),c.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[o]=c}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var o=e.children[i],a=r[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;t.get(parseInt(o.ID)).children.forEach((function(e){void 0===e.relationship&&(s.geoID=e.ID)})),n.push(s)}return n},parseScene:function(n,i,o){r=new THREE.Group;var s=this.parseModels(n.skeletons,i,o),l=e.Objects.Model,c=this;s.forEach((function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var r=s.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&r.add(e)})),this.bindSkeleton(n.skeletons,i,s),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix(t)}}));var u=(new a).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=u,r=r.children[0]),r.animations=u},parseModels:function(r,n,i){var o=new Map,a=e.Objects.Model;for(var s in a){var l=parseInt(s),c=a[s],u=t.get(l),d=this.buildSkeleton(u,r,l,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(u);break;case"Light":d=this.createLight(u);break;case"Mesh":d=this.createMesh(u,n,i);break;case"NurbsCurve":d=this.createCurve(u,n);break;case"LimbNode":case"Root":d=new THREE.Bone;break;case"Null":default:d=new THREE.Group}d.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),d.ID=l}this.getTransformData(d,c),o.set(l,d)}return o},buildSkeleton:function(e,t,r,n){var i=null;return e.parents.forEach((function(e){for(var o in t){var a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=THREE.PropertyBinding.sanitizeNodeName(n),i.ID=r,a.bones[o]=i,null!==s&&i.add(s)}}))}})),i},createCamera:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var c=s/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var d=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new THREE.PerspectiveCamera(u,c,o,a),null!==d&&r.setFocalLength(d);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new THREE.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new THREE.Color).fromArray(n.Color.value));var a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new THREE.PointLight(o,a,s,1);break;case 1:r=new THREE.DirectionalLight(o,a);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new THREE.SpotLight(o,a,s,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(o,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,i=null,o=null,a=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&a.push(r.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new THREE.MeshPhongMaterial({color:13421772}),a.push(o)),"color"in i.attributes&&a.forEach((function(e){e.vertexColors=THREE.VertexColors})),i.FBX_Deformer?(a.forEach((function(e){e.skinning=!0})),n=new THREE.SkinnedMesh(i,o)):n=new THREE.Mesh(i,o),n},createCurve:function(e,t){var r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?b(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var o=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(o),r.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(o))}}}))},bindSkeleton:function(e,r,n){var i=this.parsePoseNodes();for(var o in e){var a=e[o];t.get(parseInt(a.ID)).parents.forEach((function(e){if(r.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(a.bones),i[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,r=t[0],n=t[1],i=t[2];if(0!==r||0!==n||0!==i)new THREE.Color(r,n,i)}},setupMorphMaterials:function(){var e=this;r.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,n){e.setupMorphMaterial(t,r,n)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var i=e.uuid,o=t.uuid,a=!1;if(r.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===o&&e.uuid!==i&&(a=!0)})):e.material.uuid===o&&e.uuid!==i&&(a=!0))})),!0===a){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var o in i){var a=t.get(parseInt(o)),s=this.parseGeometry(a,i[o],r);n.set(parseInt(o),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,o=n.morphTargets,a=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==a.length){var s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null),l=t.children.reduce((function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e}),null),c=a[0],u={};"RotationOrder"in c&&(u.eulerOrder=b(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);var d=g(u);return this.genGeometry(r,s,l,d)}},genGeometry:function(e,t,r,n){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new THREE.Float32BufferAttribute(a.vertex,3);if(n.applyToBufferAttribute(s),i.addAttribute("position",s),a.colors.length>0&&i.addAttribute("color",new THREE.Float32BufferAttribute(a.colors,3)),t&&(i.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(a.weightsIndices,4)),i.addAttribute("skinWeight",new THREE.Float32BufferAttribute(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){var l=new THREE.Float32BufferAttribute(a.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(l),i.addAttribute("normal",l)}if(a.uvs.forEach((function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),i.addAttribute(r,new THREE.Float32BufferAttribute(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var c=a.materialIndex[0],u=0;if(a.materialIndex.forEach((function(e,t){e!==c&&(i.addGroup(u,t-u,c),c=e,u=t)})),i.groups.length>0){var d=i.groups[i.groups.length-1],h=d.start+d.count;h!==a.materialIndex.length&&i.addGroup(h,a.materialIndex.length-h,c)}0===i.groups.length&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,o=[],a=[],s=[],l=[],c=[],u=[],d=this;return e.vertexIndices.forEach((function(h,p){var m=!1;h<0&&(h^=-1,m=!0);var v=[],g=[];if(o.push(3*h,3*h+1,3*h+2),e.color){var b=f(p,r,h,e.color);s.push(b[0],b[1],b[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var y=[0,0,0,0],_=[0,0,0,0];g.forEach((function(e,t){var r=e,n=v[t];_.forEach((function(e,t,i){if(r>e){i[t]=r,r=e;var o=y[t];y[t]=n,n=o}}))})),v=y,g=_}for(;g.length<4;)g.push(0),v.push(0);for(var E=0;E<4;++E)c.push(g[E]),u.push(v[E])}if(e.normal){b=f(p,r,h,e.normal);a.push(b[0],b[1],b[2])}if(e.material&&"AllSame"!==e.material.mappingType)var A=f(p,r,h,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=f(p,r,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(d.genFace(t,e,o,A,a,s,l,c,u,n),r++,n=0,o=[],a=[],s=[],l=[],c=[],u=[])})),t},genFace:function(e,t,r,n,i,o,a,s,l,c){for(var u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(a[r][0]),e.uvs[r].push(a[r][1]),e.uvs[r].push(a[r][2*(u-1)]),e.uvs[r].push(a[r][2*(u-1)+1]),e.uvs[r].push(a[r][2*u]),e.uvs[r].push(a[r][2*u+1])}))},addMorphTargets:function(t,r,n,i){if(null!==n){t.morphAttributes.position=[];var o=this;n.rawTargets.forEach((function(n){var a=e.Objects.Geometry[n.geoID];void 0!==a&&o.genMorphGeometry(t,r,a,i,n.name)}))}},genMorphGeometry:function(e,t,r,n,i){var o=new THREE.BufferGeometry;r.attrName&&(o.name=r.attrName);for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],l=void 0!==r.Vertices?r.Vertices.a:[],c=void 0!==r.Indexes?r.Indexes.a:[],u=0;u<c.length;u++){var d=3*c[u];s[d]+=l[3*u],s[d+1]+=l[3*u+1],s[d+2]+=l[3*u+2]}var h={vertexIndices:a,vertexPositions:s},p=this.genBuffers(h),f=new THREE.Float32BufferAttribute(p.vertex,3);f.name=i||r.attrName,n.applyToBufferAttribute(f),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r,n,i=t-1,o=e.KnotVector.a,a=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)a.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){r=i,n=o.length-1-r;for(l=0;l<i;++l)a.push(a[l])}var u=new THREE.NURBSCurve(i,o,a,r,n).getPoints(7*a.length),d=new Float32Array(3*u.length);u.forEach((function(e,t){e.toArray(d,3*t)}));var h=new THREE.BufferGeometry;return h.addAttribute("position",new THREE.BufferAttribute(d,3)),h}},a.prototype={constructor:a,parse:function(){var e=[],t=this.parseClips();if(void 0!==t){for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e}},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var o={id:i.id,attr:i.attrName,curves:{}};r.set(o.id,o)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var o={id:n[i].id,times:n[i].KeyTime.a.map(h),values:n[i].KeyValueFloat.a},a=t.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship;l.match(/X/)?r.get(s).curves.x=o:l.match(/Y/)?r.get(s).curves.y=o:l.match(/Z/)?r.get(s).curves.z=o:l.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=o)}}},parseAnimationLayers:function(n){var i=e.Objects.AnimationLayer,o=new Map;for(var a in i){var s=[],l=t.get(parseInt(a));if(void 0!==l)l.children.forEach((function(i,o){if(n.has(i.ID)){var a=n.get(i.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===s[o]){t.get(i.ID).parents.forEach((function(e){void 0!==e.relationship&&(p=e.ID)}));var l=e.Objects.Model[p.toString()],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(e){(e.ID=l.id)&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))})),c.transform||(c.transform=new THREE.Matrix4),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),s[o]=c}s[o][a.attr]=a}else if(void 0!==a.curves.morph){if(void 0===s[o]){var u;t.get(i.ID).parents.forEach((function(e){void 0!==e.relationship&&(u=e.ID)}));var d=t.get(u).parents[0].ID,h=t.get(d).parents[0].ID,p=t.get(h).parents[0].ID;l=e.Objects.Model[p],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),morphName:e.Objects.Deformer[u].attrName};s[o]=c}s[o][a.attr]=a}}})),o.set(parseInt(a),s)}return o},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var o in n){var a=t.get(parseInt(o)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(a[0].ID);i[o]={name:n[o].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(r,n,i),r=r.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var i=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(i,t,r);return new THREE.VectorKeyframeTrack(e+"."+n,i,o)},generateRotationTrack:function(e,t,r,n,i,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,r);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push(o),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(THREE.Math.degToRad)).push(o),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).inverse());for(var l=new THREE.Quaternion,c=new THREE.Euler,u=[],d=0;d<s.length;d+=3)c.set(s[d],s[d+1],s[d+2],o),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),l.toArray(u,d/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",a,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})).filter((function(e,t,r){return r.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],o=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){var r=t.x.values[o];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==a){var l=t.y.values[a];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var c=t.z.values[s];i.push(c),n[2]=c}else i.push(n[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var o=i/180,a=n/o,s=r+a,l=e.times[t-1],c=(e.times[t]-l)/o,u=l+c,d=[],h=[];u<e.times[t];)d.push(u),u+=c,h.push(s),s+=a;e.times=E(e.times,t,d),e.values=E(e.values,t,h)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new u,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){var i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!i&&!o){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},o=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in a?("PoseNode"===r?a.PoseNode.push(i):void 0!==a[r].id&&(a[r]={},a[r][a[r].id]=a[r]),""!==o.id&&(a[r][o.id]=i)):"number"==typeof o.id?(a[r]={},a[r][o.id]=i):"Properties70"!==r&&(a[r]="PoseNode"===r?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){var a=i.split(",").slice(1),s=parseInt(a[0]),l=parseInt(a[1]),c=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,l],c=c.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):"a"!==n?o[n]=i:o.a=i,this.setCurrentProp(o,n),"a"===n&&","!==i.slice(-1)&&(o.a=y(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=y(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],o=n[1],a=n[2],s=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=y(l)}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},l.prototype={constructor:l,parse:function(e){var t=new c(e);t.skip(23);for(var r=t.getUint32(),n=new u;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(o);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",d=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var h=this.parseNode(e,t);null!==h&&this.parseSubNode(a,r,h)}return r.propertyList=s,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==d&&(r.attrType=d),""!==a&&(r.name=a),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var o,a=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[a]={type:s,type2:l,flag:c,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"==typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new c(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},u.prototype={constructor:u,add:function(e,t){this[e]=t}};var p=[];function f(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var o=i*n.dataSize,a=o+n.dataSize;return function(e,t,r,n){for(var i=r,o=0;i<n;i++,o++)e[o]=t[i];return e}(p,n.buffer,o,a)}var m=new THREE.Euler,v=new THREE.Vector3;function g(e){var t,r=new THREE.Matrix4,n=new THREE.Matrix4,i=new THREE.Matrix4,o=new THREE.Matrix4,a=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=new THREE.Matrix4,u=new THREE.Matrix4,d=new THREE.Matrix4,h=new THREE.Matrix4,p=new THREE.Matrix4,f=new THREE.Matrix4,g=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(v.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(m.fromArray(t)));e.rotation&&((t=e.rotation.map(THREE.Math.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(m.fromArray(t)));e.postRotation&&((t=e.postRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(m.fromArray(t)));e.scale&&s.scale(v.fromArray(e.scale)),e.scalingOffset&&c.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&l.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&d.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var b=n.multiply(i).multiply(o),y=new THREE.Matrix4;h.extractRotation(y);var _=new THREE.Matrix4,E=new THREE.Matrix4,A=new THREE.Matrix4,w=new THREE.Matrix4;if(w.copyPosition(h),A=w.getInverse(w).multiply(h),E=y.getInverse(y).multiply(A),_=s,0===g)f=y.multiply(b).multiply(E).multiply(_);else if(1===g)f=y.multiply(E).multiply(b).multiply(_);else{var T=(new THREE.Matrix4).copy(s),k=E.multiply(T.getInverse(T));f=y.multiply(b).multiply(k).multiply(_)}a=r.multiply(u).multiply(d).multiply(n).multiply(i).multiply(o).multiply(d.getInverse(d)).multiply(c).multiply(l).multiply(s).multiply(l.getInverse(l));var R=(new THREE.Matrix4).copyPosition(a),S=h.multiply(R);return p.copyPosition(S),a=p.multiply(f)}function b(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function y(e){return e.split(",").map((function(e){return parseFloat(e)}))}function _(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function E(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return n}()},{}],5:[function(e,t,r){"use strict";t.exports=Object.assign((function(){}),{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},{}],6:[function(e,t,r){"use strict";t.exports=function(e,t,r){this.type=e,this.index=t,this.pressed=r.pressed,this.value=r.value}},{}],7:[function(e,t,r){"use strict";t.exports={size:5,cellSize:10,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5},autogenerated:!0,cells:[{q:-1,r:0,s:1,h:1,walkable:!0,userData:{}},{q:0,r:-1,s:1,h:1,walkable:!0,userData:{}},{q:0,r:0,s:0,h:1,walkable:!0,userData:{}},{q:1,r:-1,s:0,h:1,walkable:!0,userData:{}},{q:-1,r:1,s:0,h:0,walkable:!0,userData:{}},{q:0,r:1,s:-1,h:0,walkable:!0,userData:{}},{q:1,r:0,s:-1,h:0,walkable:!0,userData:{}}]}},{}],8:[function(e,t,r){"use strict";function n(e){var t=document.getElementById(e),r=t.parentNode;try{r&&r.removeChild(t)}catch(e){}}function i(e,t,r){return new r((function(r,i){var o=t.timeout||5e3,a="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),s=function(e,t){var r=document.createElement("script");return r.type="text/javascript",r.async=!0,r.id=t,r.src=e,r}(e,a),l=setTimeout((function(){i(new Error("Script request to "+e+" timed out")),n(a)}),o),c=function(e){clearTimeout(e)};s.addEventListener("load",(function(e){r({ok:!0}),c(l),n(a)})),s.addEventListener("error",(function(t){i(new Error("Script request to "+e+" failed "+t)),c(l),n(a)})),function(e){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(s)}))}t.exports=function(e){return e=e||{},function(t,r){return i(t,r=r||{},e.Promise||Promise)}}},{}],9:[function(e,t,r){"use strict";var n,i,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a="function"==typeof Symbol&&"symbol"===o(Symbol.iterator)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":o(e)},s=t.exports={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};s.Board=function(e,t){if(!e)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new s.AStarFinder(t),s.Loader.init(),this.setGrid(e)},s.Board.prototype={setEntityOnTile:function(e,t){var r=this.grid.cellToPixel(t.cell);e.position.copy(r),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e},addTile:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)},removeTile:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])},getTileAtCell:function(e){var t=this.grid.cellToHash(e);return e.tile||(void 0!==this.grid.cells[t]?this.grid.cells[t].tile:null)},snapToGrid:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))},snapTileToGrid:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e},getRandomTile:function(){var e=s.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]},findPath:function(e,t,r){return this.finder.findPath(e.cell,t.cell,r,this.grid)},setGrid:function(e){this.group.remove(this.tileGroup),this.grid&&e!==this.grid&&(this.removeAllTiles(),this.tiles.forEach((function(e){this.grid.remove(e.cell),e.dispose()})),this.grid.dispose()),this.grid=e,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(e){var t=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)},generateTilemap:function(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new THREE.Object3D;for(var r=0;r<t.length;r++)this.tileGroup.add(t[r].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},s.Board.prototype.constructor=s.Board,s.Cell=function(e,t,r,n){this.q=e||0,this.r=t||0,this.s=r||0,this.h=n||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=s.LinkedList.generateID()},s.Cell.prototype={set:function(e,t,r){return this.q=e,this.r=t,this.s=r,this},copy:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this},add:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this},equals:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},s.Cell.prototype.constructor=s.Cell,s.HexGrid=function(e){e=e||{},this.type=s.HEX,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t,r=[];for(t=0;6>t;t++)r.push(this._createVertex(t));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(r[0].x,r[0].y),t=1;6>t;t++)this.cellShape.lineTo(r[t].x,r[t].y);this.cellShape.lineTo(r[0].x,r[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=r,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*s.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new s.Cell(1,-1,0),new s.Cell(1,0,-1),new s.Cell(0,1,-1),new s.Cell(-1,1,0),new s.Cell(-1,0,1),new s.Cell(0,-1,1)],this._diagonals=[new s.Cell(2,-1,-1),new s.Cell(1,1,-2),new s.Cell(-1,2,-1),new s.Cell(-2,1,1),new s.Cell(-1,-1,2),new s.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new s.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},s.HexGrid.TWO_THIRDS=2/3,s.HexGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3},pixelToCell:function(e){var t=e.x*(s.HexGrid.TWO_THIRDS/this.cellSize),r=(-e.x/3+s.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,r,-t-r),this._cubeRound(this._cel)},getCellAt:function(e){var t=e.x*(s.HexGrid.TWO_THIRDS/this.cellSize),r=(-e.x/3+s.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,r,-t-r),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,r){var n,i,o=this._directions.length;for(this._list.length=0,n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);if(t)for(n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);return this._list},getRandomCell:function(){var e,t=0,r=s.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===r)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,r){var n=Math.abs(e.h);1>n&&(n=1);var i=this._geoCache[n];i||(this.extrudeSettings.amount=n,i=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=i);var o=new s.Tile({size:this.cellSize,scale:t,cell:e,geometry:i,material:r});return e.tile=o,o},generateTiles:function(e){e=e||{};var t,r,n,i=[],o={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in o=s.Tools.merge(o,e),this.cellSize=o.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*s.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=o.extrudeSettings,this.cells)n=this.cells[t],(r=this.generateTile(n,o.tileScale,o.material)).position.copy(this.cellToPixel(n)),r.position.y=0,i.push(r);return i},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,s.PI/2),t},generate:function(e){var t,r,n,i;for(e=e||{},this.size=void 0===e.size?this.size:e.size,t=-this.size;t<this.size+1;t++)for(r=-this.size;r<this.size+1;r++)n=-t-r,Math.abs(t)<=this.size&&Math.abs(r)<=this.size&&Math.abs(n)<=this.size&&(i=new s.Cell(t,r,n),this.add(i))},generateOverlay:function(e,t,r){var n,i,o,a=this.cellShape.createPointsGeometry();for(n=-e;e+1>n;n++)for(i=-e;e+1>i;i++)if(o=-n-i,Math.abs(n)<=e&&Math.abs(i)<=e&&Math.abs(o)<=e){this._cel.set(n,i,o);var l=new THREE.Line(a,r);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*s.DEG_TO_RAD,t.add(l)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,r){var n=this;s.Tools.getJSON({url:e,callback:function(e){n.fromJSON(e),t.call(r||null,e)},cache:!1,scope:n})},fromJSON:function(e){var t,r,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*s.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(r=new s.Cell).copy(n[t]),this.add(r)},toJSON:function(){var e,t,r={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return r.cells=n,r},_createVertex:function(e){var t=s.TAU/6*e;return new THREE.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)},_cubeRound:function(e){var t=Math.round(e.q),r=Math.round(e.r),n=Math.round(e.s),i=Math.abs(t-e.q),o=Math.abs(r-e.r),a=Math.abs(n-e.s);return i>o&&i>a?t=-r-n:o>a?r=-t-n:n=-t-r,this._cel.set(t,r,n)}},s.HexGrid.prototype.constructor=s.HexGrid,s.SqrGrid=function(e){e=e||{},this.type=s.SQR,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t=[];t.push(new THREE.Vector3),t.push(new THREE.Vector3(-this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new THREE.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=t,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new s.Cell(1,0,0),new s.Cell(0,-1,0),new s.Cell(-1,0,0),new s.Cell(0,1,0)],this._diagonals=[new s.Cell(-1,-1,0),new s.Cell(-1,1,0),new s.Cell(1,1,0),new s.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new s.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},s.SqrGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3},pixelToCell:function(e){var t=Math.round(e.x/this._fullCellSize),r=Math.round(e.z/this._fullCellSize);return this._cel.set(t,r,0)},getCellAt:function(e){var t=Math.round(e.x/this._fullCellSize),r=Math.round(e.z/this._fullCellSize);return this._cel.set(t,r),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,r){var n,i,o=this._directions.length;for(this._list.length=0,n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);if(t)for(n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);return this._list},getRandomCell:function(){var e,t=0,r=s.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===r)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,r){var n=Math.abs(e.h);1>n&&(n=1);var i=this._geoCache[n];i||(this.extrudeSettings.amount=n,i=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=i);var o=new s.Tile({size:this.cellSize,scale:t,cell:e,geometry:i,material:r});return e.tile=o,o},generateTiles:function(e){e=e||{};var t,r,n,i=[],o={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in o=s.Tools.merge(o,e),this.cellSize=o.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=o.extrudeSettings,this.cells)n=this.cells[t],(r=this.generateTile(n,o.tileScale,o.material)).position.copy(this.cellToPixel(n)),r.position.y=0,i.push(r);return i},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,s.PI/2),t},generate:function(e){e=e||{},this.size=void 0===e.size?this.size:e.size;var t,r,n,i=Math.ceil(this.size/2);for(t=-i;i>t;t++)for(r=-i;i>r;r++)n=new s.Cell(t,r+1),this.add(n)},generateOverlay:function(e,t,r){var n,i,o=Math.ceil(e/2);for(n=-o;o>n;n++)for(i=-o;o>i;i++){this._cel.set(n,i);var a=new THREE.Line(this.cellGeo,r);a.position.copy(this.cellToPixel(this._cel)),a.rotation.x=90*s.DEG_TO_RAD,t.add(a)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,r){s.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(r||null,e)},cache:!1,scope:this})},fromJSON:function(e){var t,r,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(r=new s.Cell).copy(n[t]),this.add(r)},toJSON:function(){var e,t,r={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return r.cells=n,r}},s.SqrGrid.prototype.constructor=s.SqrGrid,s.Tile=function(e){e=e||{};var t={cell:null,geometry:null,material:null};if(!(t=s.Tools.merge(t,e)).cell||!t.geometry)throw new Error("Missing vg.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=s.Tools.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:s.Tools.randomizeRGB("30, 30, 30",13)})),this.objectType=s.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*s.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},s.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},s.Tile.prototype.constructor=s.Tile,n=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},(i=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}).generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},(i.prototype={getNode:function(e){return this.objToNodeMap[e.uniqueID]},addNode:function(e){var t=new n;if(!e.uniqueID)try{e.uniqueID=i.generateID()}catch(e){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return t.obj=e,t.free=!1,this.objToNodeMap[e.uniqueID]=t,t},swapObjects:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t},add:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(e){return!!this.objToNodeMap[e.uniqueID]},moveUp:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prev){var r=t.prev,n=r.prev;t==this.last&&(this.last=r);var i=t.next;n&&(n.next=t),t.next=r,t.prev=r.prev,r.next=i,r.prev=t,this.first==r&&(this.first=t)}},moveDown:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var r=t.next;this.moveUp(r.obj),this.last==r&&(this.last=t)}},sort:function(e){var t,r,n=this.sortArray,i=this.first;for(n.length=0;i;)n.push(i.obj),i=i.next;for(this.clear(),n.sort(e),r=n.length,t=0;r>t;t++)this.add(n[t])},remove:function(e){var t=this.getNode(e);return!(!t||t.free||(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,0))},shift:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},pop:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},concat:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next},clear:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0},dispose:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null},dump:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}).constructor=i,s.LinkedList=i,function(){var e=function(e,t,r,n,i){this._listener=t,this.isOnce=r,this.context=n,this.signal=e,this._priority=i||0};(e.prototype={active:!0,params:null,execute:function(e){var t,r;return this.active&&this._listener&&(r=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,r),this.isOnce&&this.detach()),t},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}}).constructor=e;var t=function e(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){e.prototype.dispatch.apply(t,arguments)}};(t.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(e,t){if("function"!=typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(t,r,n,i){var o,a=this._indexOfListener(t,n);if(-1!==a){if((o=this._bindings[a]).isOnce!==r)throw new Error("You cannot add"+(r?"":"Once")+"() then add"+(r?"Once":"")+"() the same listener without removing the relationship first.")}else o=new e(this,t,r,n,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return this.validateListener(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){this.validateListener(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(e){void 0===e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var e,t=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=t),r){e=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(e[r]&&this._shouldPropagate&&!1!==e[r].execute(t))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}).constructor=t,s.Signal=t}(),s.AStarFinder=function(e){e=e||{};var t={allowDiagonal:!1,heuristicFilter:null};t=s.Tools.merge(t,e),this.allowDiagonal=t.allowDiagonal,this.heuristicFilter=t.heuristicFilter,this.list=new s.LinkedList},s.AStarFinder.prototype={findPath:function(e,t,r,n){var i,o,a,l,c,u;for(r=r||this.heuristicFilter,n.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(i=this.list.shift())._visited=!0,i===t)return s.PathUtil.backtrace(t);for(c=0,u=(a=n.getNeighbors(i,this.allowDiagonal,r)).length;u>c;c++)if((l=a[c]).walkable&&(o=i._calcCost+n.distance(i,l),!l._visited||o<l._calcCost)){if(l._visited=!0,l._parent=i,l._calcCost=o,l._priority=o+n.distance(t,l),l===t)return s.PathUtil.backtrace(t);this.list.add(l)}}return null},compare:function(e,t){return e._priority-t._priority}},s.AStarFinder.prototype.constructor=s.AStarFinder,s.PathUtil={backtrace:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()},biBacktrace:function(e,t){var r=this.backtrace(e),n=this.backtrace(t);return r.concat(n.reverse())},pathLength:function(e){var t,r,n,i,o,a=0;for(t=1;t<e.length;++t)r=e[t-1],n=e[t],i=r[0]-n[0],o=r[1]-n[1],a+=Math.sqrt(i*i+o*o);return a},interpolate:function(e,t,r,n){var i,o,a,s,l,c,u=Math.abs,d=[];for(i=r>e?1:-1,o=n>t?1:-1,l=(a=u(r-e))-(s=u(n-t));e!==r||t!==n;)d.push([e,t]),(c=2*l)>-s&&(l-=s,e+=i),a>c&&(l+=a,t+=o);return d},expandPath:function(e){var t,r,n,i,o,a,s=[],l=e.length;if(2>l)return s;for(o=0;l-1>o;++o)for(t=e[o],r=e[o+1],i=(n=this.interpolate(t[0],t[1],r[0],r[1])).length,a=0;i-1>a;++a)s.push(n[a]);return s.push(e[l-1]),s},smoothenPath:function(e,t){var r,n,i,o,a,s,l,c,u,d,h,p,f=t.length,m=t[0][0],v=t[0][1],g=t[f-1][0],b=t[f-1][1];for(a=[[r=m,n=v]],l=2;f>l;++l){for(i=(u=t[l])[0],o=u[1],d=this.interpolate(r,n,i,o),p=!1,c=1;c<d.length;++c)if(h=d[c],!e.isWalkableAt(h[0],h[1])){p=!0;break}p&&(s=t[l-1],a.push(s),r=s[0],n=s[1])}return a.push([g,b]),a},compressPath:function(e){if(e.length<3)return e;var t,r,n,i,o,a,s=[],l=e[0][0],c=e[0][1],u=e[1][0],d=e[1][1],h=u-l,p=d-c;for(h/=o=Math.sqrt(h*h+p*p),p/=o,s.push([l,c]),a=2;a<e.length;a++)t=u,r=d,n=h,i=p,h=(u=e[a][0])-t,p=(d=e[a][1])-r,p/=o=Math.sqrt(h*h+p*p),((h/=o)!==n||p!==i)&&s.push([t,r]);return s.push([u,d]),s}},s.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new THREE.LoadingManager((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,r,n){var i=new THREE.Texture(null,t);return this.imageLoader.load(e,(function(e){i.image=e,i.needsUpdate=!0,r&&r(i)}),null,(function(e){n&&n(e)})),i.sourceFile=e,i}},s.MouseCaster=function(e,t,r){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new s.Signal,this.group=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,(r=r||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),r.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),r.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),r.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),r.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},s.MouseCaster.OVER="over",s.MouseCaster.OUT="out",s.MouseCaster.DOWN="down",s.MouseCaster.UP="up",s.MouseCaster.CLICK="click",s.MouseCaster.WHEEL="wheel",s.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,r=this._raycaster.intersectObject(this.group,!0);r.length>0?(t=(e=r[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch(s.MouseCaster.OUT,this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch(s.MouseCaster.OVER,this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch(s.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=r}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(e){return(e=e||window.event).preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,void this.signal.dispatch(s.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(e){return e.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch(s.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(s.MouseCaster.CLICK,this.pickedObject),this.down=1!==e.which&&this.down,void(this.rightDown=3!==e.which&&this.rightDown))},_onDocumentMouseMove:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1},_onMouseWheel:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch(s.MouseCaster.WHEEL,this.wheel)}}},s.MouseCaster.prototype.constructor=s.MouseCaster,s.Scene=function(e,t){var r={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},n={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(r=s.Tools.merge(r,e),"boolean"!=typeof t&&(n=s.Tools.merge(n,t)),this.renderer=new THREE.WebGLRenderer({alpha:r.alpha,antialias:r.antialias}),this.renderer.setClearColor(r.clearColor,0),this.renderer.sortObjects=r.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=r.orthoZoom,this.container=new THREE.Scene,this.container.fog=r.fog,this.container.add(new THREE.AmbientLight(14540253)),r.lightPosition||r.light.position.set(-1,1,-1).normalize(),this.container.add(r.light),"OrthographicCamera"===r.cameraType){var i=window.innerWidth/this.orthoZoom,o=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(i/-2,i/2,o/2,o/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=n.minDistance,this.controls.maxDistance=n.maxDistance,this.controls.zoomSpeed=n.zoomSpeed,this.controls.noZoom=n.noZoom),r.cameraPosition&&this.camera.position.copy(r.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(r.element)},s.Scene.prototype={attachTo:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)},add:function(e){this.container.add(e)},remove:function(e){this.container.remove(e)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()}},focusOn:function(e){this.camera.lookAt(e.position)}},s.Scene.prototype.constructor=s.Scene,s.SelectionManager=function(e){this.mouse=e,this.onSelect=new s.Signal,this.onDeselect=new s.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},s.SelectionManager.prototype={select:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))},clearSelection:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(e,t){switch(e){case s.MouseCaster.DOWN:t||this.clearSelection();break;case s.MouseCaster.CLICK:this.select(t)}}},s.SelectionManager.prototype.constructor=s.SelectionManager,s.Tools={clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,r){return(e-t)/(r-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!=(void 0===e?"undefined":a(e))||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(e,t){var r=this,n=Array.isArray(t),i=n&&[]||{};return n?(e=e||[],i=i.concat(e),t.forEach((function(t,n){void 0===i[n]?i[n]=t:r.isPlainObject(t)?i[n]=r.merge(e[n],t):-1===e.indexOf(t)&&i.push(t)})),i):(e&&r.isPlainObject(e)&&Object.keys(e).forEach((function(t){i[t]=e[t]})),Object.keys(t).forEach((function(n){t[n]&&r.isPlainObject(t[n])&&e[n]?i[n]=r.merge(e[n],t[n]):i[n]=t[n]})),i)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,r,n){if(n=n||31,!((t=t||0)>=(r=r||e.length)-1||0>n)){for(var i=t,o=r,a=1<<n;o>i;)if(e[i]&a){--o;var s=e[i];e[i]=e[o],e[o]=s}else++i;this.radixSort(e,t,o,n-1),this.radixSort(e,o,r,n-1)}},randomizeRGB:function(e,t){var r,n,i=e.split(","),o="rgb(";for(t=this.randomInt(t),r=0;3>r;r++)0>(n=parseInt(i[r])+t)?n=0:n>255&&(n=255),o+=n+",";return(o=o.substring(0,o.length-1))+")"},getJSON:function(e){var t=new XMLHttpRequest,r=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(e){return}e.callback.call(e.scope||null,t)}},t.open("GET",r,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}}},{}],10:[function(e,t,r){"use strict";!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var r=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,i=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function a(e,t){return-1!==String(e).indexOf(t)}var s=a(navigator.platform,"Win")?"win":a(navigator.platform,"Mac")?"mac":a(navigator.platform,"CrOS")?"cros":a(navigator.platform,"Linux")?"linux":a(navigator.userAgent,"iPad")||a(navigator.platform,"iPod")||a(navigator.platform,"iPhone")?"ios":"",l=a(navigator.userAgent,"Chrome/")?"chrome":a(navigator.vendor,"Apple")?"safari":a(navigator.userAgent,"MSIE")?"ie":a(navigator.userAgent,"Gecko/")?"moz":a(navigator.userAgent,"Opera/")?"opera":"",c=l+"-"+s;function u(e,t,r){c!==t&&l!==t&&s!==t||Object.keys(r).forEach((function(t){e[t]=r[t]}))}var d={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:i},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:i},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:i},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:i},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};u(d,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),u(d,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),u(d,"moz-win",{173:{code:"Minus",keyCap:"-"}}),u(d,"chrome-mac",{93:{code:"OSRight",location:i}}),u(d,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),u(d,"ios",{10:{code:"Enter",location:r}}),u(d,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:i},229:{code:"KeyQ",keyCap:"Q"}});var h={};"cros"===s&&(h["U+00A0"]={code:"ShiftLeft",location:n},h["U+00A1"]={code:"ShiftRight",location:i},h["U+00A2"]={code:"ControlLeft",location:n},h["U+00A3"]={code:"ControlRight",location:i},h["U+00A4"]={code:"AltLeft",location:n},h["U+00A5"]={code:"AltRight",location:i}),"chrome-mac"===c&&(h["U+0010"]={code:"ContextMenu"}),"safari-mac"===c&&(h["U+0010"]={code:"ContextMenu"}),"ios"===s&&(h["U+0010"]={code:"Function"},h["U+001C"]={code:"ArrowLeft"},h["U+001D"]={code:"ArrowRight"},h["U+001E"]={code:"ArrowUp"},h["U+001F"]={code:"ArrowDown"},h["U+0001"]={code:"Home"},h["U+0004"]={code:"End"},h["U+000B"]={code:"PageUp"},h["U+000C"]={code:"PageDown"});var p=[];p[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},p[i]={16:{code:"ShiftRight",location:i},17:{code:"ControlRight",location:i},18:{code:"AltRight",location:i}},p[o]={13:{code:"NumpadEnter",location:o}},u(p[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),u(p[n],"moz-mac",{224:{code:"OSLeft",location:n}}),u(p[i],"moz-mac",{224:{code:"OSRight",location:i}}),u(p[i],"moz-win",{91:{code:"OSRight",location:i}}),u(p[i],"mac",{93:{code:"OSRight",location:i}}),u(p[o],"chrome-mac",{12:{code:"NumLock",location:o}}),u(p[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};u(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},v=function(e,t){var r={};return Object.keys(e).forEach((function(n){var i=e[n];t in i&&(r[i[t]]=i)})),r}(d,"code");try{var g=t&&"location"in new KeyboardEvent("")}catch(e){}function b(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,r=function(){if(g||"keyLocation"in e){var r=g?e.location:e.keyLocation;if(r&&t in p[r])return p[r][t]}return"keyIdentifier"in e&&e.keyIdentifier in h?h[e.keyIdentifier]:t in d?d[t]:null}();if(!r)return null;var n,i=(n=f[r.code])?e.shiftKey&&"shiftKey"in n?n.shiftKey:n.key:r.code;return{code:r.code,key:i,location:r.location,keyCap:r.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,r){t in e||Object.defineProperty(e,t,r)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=b(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return m.hasOwnProperty(e)?m[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=b(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=b(this);return e&&"location"in e?e.location:r}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!v.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var r=v[e];return r.keyCap||r.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=b(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:r,e.locale=""}}}(window)},{}],11:[function(e,t,r){var n=function(){};n.computeCentroids=function(e){var t,r,n;for(t=0,r=e.faces.length;t<r;t++)(n=e.faces[t]).centroid=new THREE.Vector3(0,0,0),n.centroid.add(e.vertices[n.a]),n.centroid.add(e.vertices[n.b]),n.centroid.add(e.vertices[n.c]),n.centroid.divideScalar(3)},n.roundNumber=function(e,t){return Number(e.toFixed(t))},n.sample=function(e){return e[Math.floor(Math.random()*e.length)]},n.mergeVertexIds=function(e,t){var r=[];if(e.forEach((function(e){t.indexOf(e)>=0&&r.push(e)})),r.length<2)return[];r.includes(e[0])&&r.includes(e[e.length-1])&&e.push(e.shift()),r.includes(t[0])&&r.includes(t[t.length-1])&&t.push(t.shift()),r=[],e.forEach((function(e){t.includes(e)&&r.push(e)}));for(var n=r[1],i=r[0],o=e.slice();o[0]!==n;)o.push(o.shift());for(var a=0,s=t.slice();s[0]!==i;)if(s.push(s.shift()),a++>10)throw new Error("Unexpected state");return s.shift(),s.pop(),o.concat(s)},n.setPolygonCentroid=function(e,t){var r=new THREE.Vector3,n=t.vertices;e.vertexIds.forEach((function(e){r.add(n[e])})),r.divideScalar(e.vertexIds.length),e.centroid.copy(r)},n.cleanPolygon=function(e,t){for(var r=[],n=t.vertices,i=0;i<e.vertexIds.length;i++){var o,a,s,l=n[e.vertexIds[i]];0===i?(o=e.vertexIds[1],a=e.vertexIds[e.vertexIds.length-1]):i===e.vertexIds.length-1?(o=e.vertexIds[0],a=e.vertexIds[e.vertexIds.length-2]):(o=e.vertexIds[i+1],a=e.vertexIds[i-1]),s=n[a];var c=n[o].clone().sub(l),u=s.clone().sub(l),d=c.angleTo(u);if(d>Math.PI-.01&&d<Math.PI+.01){var h=[];e.neighbours.forEach((function(t){t.vertexIds.includes(e.vertexIds[i])||h.push(t)})),e.neighbours=h}else r.push(e.vertexIds[i])}e.vertexIds=r,this.setPolygonCentroid(e,t)},n.isConvex=function(e,t){var r=t.vertices;if(e.vertexIds.length<3)return!1;for(var n=!0,i=[],o=0;o<e.vertexIds.length;o++){var a,s,l=r[e.vertexIds[o]];0===o?(a=r[e.vertexIds[1]],s=r[e.vertexIds[e.vertexIds.length-1]]):o===e.vertexIds.length-1?(a=r[e.vertexIds[0]],s=r[e.vertexIds[e.vertexIds.length-2]]):(a=r[e.vertexIds[o+1]],s=r[e.vertexIds[o-1]]);var c=a.clone().sub(l),u=s.clone().sub(l),d=c.angleTo(u);if(d===Math.PI||0===d)return!1;var h=c.cross(u).y;i.push(h)}return i.forEach((function(e){0===e&&(n=!1)})),i.forEach(i[0]>0?function(e){e<0&&(n=!1)}:function(e){e>0&&(n=!1)}),n},n.distanceToSquared=function(e,t){var r=e.x-t.x,n=e.y-t.y,i=e.z-t.z;return r*r+n*n+i*i},n.isPointInPoly=function(e,t){for(var r=!1,n=-1,i=e.length,o=i-1;++n<i;o=n)(e[n].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[n].z)&&t.x<(e[o].x-e[n].x)*(t.z-e[n].z)/(e[o].z-e[n].z)+e[n].x&&(r=!r);return r},n.isVectorInPolygon=function(e,t,r){var n=1e5,i=-1e5,o=[];return t.vertexIds.forEach((function(e){n=Math.min(r[e].y,n),i=Math.max(r[e].y,i),o.push(r[e])})),!!(e.y<i+.5&&e.y>n-.5&&this.isPointInPoly(o,e))},n.triarea2=function(e,t,r){return(r.x-e.x)*(t.z-e.z)-(t.x-e.x)*(r.z-e.z)},n.vequal=function(e,t){return this.distanceToSquared(e,t)<1e-5};var i=function(e){this.content=[],this.scoreFunction=e};i.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},i.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},i.prototype.remove=function(e){var t=this.content.indexOf(e),r=this.content.pop();t!==this.content.length-1&&(this.content[t]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},i.prototype.size=function(){return this.content.length},i.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},i.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var r=(e+1>>1)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},i.prototype.bubbleUp=function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=e+1<<1,o=i-1,a=null,s=void 0;if(o<t&&(s=this.scoreFunction(this.content[o]))<n&&(a=o),i<t&&this.scoreFunction(this.content[i])<(null===a?n:s)&&(a=i),null===a)break;this.content[e]=this.content[a],this.content[a]=r,e=a}};var o=function(){};o.init=function(e){for(var t=0;t<e.length;t++){var r=e[t];r.f=0,r.g=0,r.h=0,r.cost=1,r.visited=!1,r.closed=!1,r.parent=null}},o.cleanUp=function(e){for(var t=0;t<e.length;t++){var r=e[t];delete r.f,delete r.g,delete r.h,delete r.cost,delete r.visited,delete r.closed,delete r.parent}},o.heap=function(){return new i((function(e){return e.f}))},o.search=function(e,t,r){this.init(e);var n=this.heap();for(n.push(t);n.size()>0;){var i=n.pop();if(i===r){for(var o=i,a=[];o.parent;)a.push(o),o=o.parent;return this.cleanUp(a),a.reverse()}i.closed=!0;for(var s=this.neighbours(e,i),l=0,c=s.length;l<c;l++){var u=s[l];if(!u.closed){var d=i.g+u.cost,h=u.visited;if(!h||d<u.g){if(u.visited=!0,u.parent=i,!u.centroid||!r.centroid)throw new Error("Unexpected state");u.h=u.h||this.heuristic(u.centroid,r.centroid),u.g=d,u.f=u.g+u.h,h?n.rescoreElement(u):n.push(u)}}}}return[]},o.heuristic=function(e,t){return n.distanceToSquared(e,t)},o.neighbours=function(e,t){for(var r=[],n=0;n<t.neighbours.length;n++)r.push(e[t.neighbours[n]]);return r};var a=1,s=function(){};s.buildZone=function(e){var t=this,r=this._buildNavigationMesh(e),i={};r.vertices.forEach((function(e){e.x=n.roundNumber(e.x,2),e.y=n.roundNumber(e.y,2),e.z=n.roundNumber(e.z,2)})),i.vertices=r.vertices;var o=this._buildPolygonGroups(r);i.groups=[];var a=function(e,t){for(var r=0;r<e.length;r++)if(t===e[r])return r};return o.forEach((function(e){var r=[];e.forEach((function(i){var o=i.neighbours.map((function(t){return a(e,t)})),s=i.neighbours.map((function(e){return t._getSharedVerticesInOrder(i,e)}));i.centroid.x=n.roundNumber(i.centroid.x,2),i.centroid.y=n.roundNumber(i.centroid.y,2),i.centroid.z=n.roundNumber(i.centroid.z,2),r.push({id:a(e,i),neighbours:o,vertexIds:i.vertexIds,centroid:i.centroid,portals:s})})),i.groups.push(r)})),i},s._buildNavigationMesh=function(e){return n.computeCentroids(e),e.mergeVertices(),this._buildPolygonsFromGeometry(e)},s._buildPolygonGroups=function(e){var t=[],r=0,n=function(e){e.neighbours.forEach((function(t){void 0===t.group&&(t.group=e.group,n(t))}))};return e.polygons.forEach((function(e){void 0===e.group&&(e.group=r++,n(e)),t[e.group]||(t[e.group]=[]),t[e.group].push(e)})),t},s._buildPolygonNeighbours=function(e,t,r){var n=new Set,i=r.get(e.vertexIds[0]),o=r.get(e.vertexIds[1]),a=r.get(e.vertexIds[2]);i.forEach((function(e){(o.has(e)||a.has(e))&&n.add(t.polygons[e])})),o.forEach((function(e){a.has(e)&&n.add(t.polygons[e])})),e.neighbours=Array.from(n)},s._buildPolygonsFromGeometry=function(e){for(var t=this,r=[],n=e.vertices,i=e.faceVertexUvs,o=new Map,s=0;s<n.length;s++)o.set(s,new Set);e.faces.forEach((function(e){r.push({id:a++,vertexIds:[e.a,e.b,e.c],centroid:e.centroid,normal:e.normal,neighbours:[]}),o.get(e.a).add(r.length-1),o.get(e.b).add(r.length-1),o.get(e.c).add(r.length-1)}));var l={polygons:r,vertices:n,faceVertexUvs:i};return r.forEach((function(e){t._buildPolygonNeighbours(e,l,o)})),l},s._getSharedVerticesInOrder=function(e,t){var r=e.vertexIds,n=t.vertexIds,i=new Set;if(r.forEach((function(e){n.includes(e)&&i.add(e)})),i.size<2)return[];i.has(r[0])&&i.has(r[r.length-1])&&r.push(r.shift()),i.has(n[0])&&i.has(n[n.length-1])&&n.push(n.shift());var o=[];return r.forEach((function(e){n.includes(e)&&o.push(e)})),o};var l=function(){this.portals=[]};l.prototype.push=function(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})},l.prototype.stringPull=function(){var e,t,r,i=this.portals,o=[],a=0,s=0,l=0;t=i[0].left,r=i[0].right,o.push(e=i[0].left);for(var c=1;c<i.length;c++){var u=i[c].left,d=i[c].right;if(n.triarea2(e,r,d)<=0){if(!(n.vequal(e,r)||n.triarea2(e,t,d)>0)){o.push(t),t=e=t,r=e,s=a=s,l=a,c=a;continue}r=d,l=c}if(n.triarea2(e,t,u)>=0){if(!(n.vequal(e,t)||n.triarea2(e,r,u)<0)){o.push(r),t=e=r,r=e,s=a=l,l=a,c=a;continue}t=u,s=c}}return 0!==o.length&&n.vequal(o[o.length-1],i[i.length-1].left)||o.push(i[i.length-1].left),this.path=o,o};var c,u,d,h,p,f,m=function(){this.zones={}};m.createZone=function(e){return s.buildZone(e)},m.prototype.setZoneData=function(e,t){this.zones[e]=t},m.prototype.getGroup=function(e,t){if(!this.zones[e])return null;var r=null,i=Math.pow(50,2);return this.zones[e].groups.forEach((function(e,o){e.forEach((function(e){var a=n.distanceToSquared(e.centroid,t);a<i&&(r=o,i=a)}))})),r},m.prototype.getRandomNode=function(e,t,r,i){if(!this.zones[e])return new THREE.Vector3;r=r||null,i=i||0;var o=[];return this.zones[e].groups[t].forEach((function(e){r&&i?n.distanceToSquared(r,e.centroid)<i*i&&o.push(e.centroid):o.push(e.centroid)})),n.sample(o)||new THREE.Vector3},m.prototype.getClosestNode=function(e,t,r,i){void 0===i&&(i=!1);var o=this.zones[t].vertices,a=null,s=1/0;return this.zones[t].groups[r].forEach((function(t){var r=n.distanceToSquared(t.centroid,e);r<s&&(!i||n.isVectorInPolygon(e,t,o))&&(a=t,s=r)})),a},m.prototype.findPath=function(e,t,r,n){var i=this.zones[r].groups[n],a=this.zones[r].vertices,s=this.getClosestNode(e,r,n),c=this.getClosestNode(t,r,n,!0);if(!s||!c)return null;var u=o.search(i,s,c),d=function(e,t){for(var r=0;r<e.neighbours.length;r++)if(e.neighbours[r]===t.id)return e.portals[r]},h=new l;h.push(e);for(var p=0;p<u.length;p++){var f=u[p+1];if(f){var m=d(u[p],f);h.push(a[m[0]],a[m[1]])}}h.push(t),h.stringPull();var v=h.path.map((function(e){return new THREE.Vector3(e.x,e.y,e.z)}));return v.shift(),v},m.prototype.clampStep=(d=new THREE.Vector3,h=new THREE.Plane,p=new THREE.Triangle,f=new THREE.Vector3,function(e,t,r,n,i,o){var a=this.zones[n].vertices,s=this.zones[n].groups[i],l=[r],m={};m[r.id]=0,c=void 0,f.set(0,0,0),u=1/0,h.setFromCoplanarPoints(a[r.vertexIds[0]],a[r.vertexIds[1]],a[r.vertexIds[2]]),h.projectPoint(t,d),t.copy(d);for(var v=l.pop();v;v=l.pop()){p.set(a[v.vertexIds[0]],a[v.vertexIds[1]],a[v.vertexIds[2]]),p.closestPointToPoint(t,d),d.distanceToSquared(t)<u&&(c=v,f.copy(d),u=d.distanceToSquared(t));var g=m[v];if(!(g>2))for(var b=0;b<v.neighbours.length;b++){var y=s[v.neighbours[b]];y.id in m||(l.push(y),m[y.id]=g+1)}}return o.copy(f),c}),r.Pathfinding=m},{}],12:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){var t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(this.active){var e=this.data,t=this.offset,r=this.position,n=this.targetPosition,i=this.checkpoint;return this.sync(),r.distanceTo(n)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:i}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)}},sync:function(){var e=this.offset,t=this.position,r=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(r),r.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(r).sub(t)}})},{}],13:[function(e,t,r){"use strict";var n=e("../../lib/GamepadButton"),i=e("../../lib/GamepadButtonEvent"),o=.2;t.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:n,schema:{controller:{default:0,oneOf:[0,1,2,3]},enabled:{default:!0},debug:{default:!1},camera:{default:"[camera]",type:"selector"},rotationSensitivity:{default:2}},init:function(){var e=this.el.sceneEl;this.prevTime=window.performance.now(),this.buttons={};var t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=THREE.Math.degToRad(t.x),this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=THREE.Math.degToRad(t.y),this.yaw.add(this.pitch),e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this.getDpad(),t=this.getJoystick(0),r=e.x||t.x,n=e.y||t.y;return Math.abs(r)>o||Math.abs(n)>o},getVelocityDelta:function(){var e=this.getDpad(),t=this.getJoystick(0),r=e.x||t.x,n=e.y||t.y,i=new THREE.Vector3;return Math.abs(r)>o&&(i.x+=r),Math.abs(n)>o&&(i.z+=n),i},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this.getJoystick(1);return Math.abs(e.x)>o||Math.abs(e.y)>o},updateRotation:function(e){if(this.isRotationActive()){var t=this.data,r=this.yaw,n=this.pitch,i=t.camera.components["look-controls"],a=i&&i.pitchObject&&i.yawObject;a&&(n.rotation.copy(i.pitchObject.rotation),r.rotation.copy(i.yawObject.rotation));var s=this.getJoystick(1);Math.abs(s.x)<=o&&(s.x=0),Math.abs(s.y)<=o&&(s.y=0),s.multiplyScalar(t.rotationSensitivity*e/1e3),r.rotation.y-=s.x,n.rotation.x-=s.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),t.camera.object3D.rotation.set(n.rotation.x,r.rotation.y,0),a&&(i.pitchObject.rotation.copy(n.rotation),i.yawObject.rotation.copy(r.rotation))}},updateButtonState:function(){var e=this.getGamepad();if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new i("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new i("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new i(e.type,e.index,e))},getGamepad:function(){var e=navigator.getGamepads&&navigator.getGamepads()[this.data.controller],t=this.el.sceneEl.components["proxy-controls"];return t&&t.isConnected()&&t.getGamepad(this.data.controller)||e},getButton:function(e){return this.getGamepad().buttons[e]},getAxis:function(e){return this.getGamepad().axes[e]},getJoystick:function(e){var t=this.getGamepad();switch(e){case 0:return new THREE.Vector2(t.axes[0],t.axes[1]);case 1:return new THREE.Vector2(t.axes[2],t.axes[3]);default:throw new Error('Unexpected joystick index "%d".',e)}},getDpad:function(){var e=this.getGamepad();return e.buttons[n.DPAD_RIGHT]?new THREE.Vector2((e.buttons[n.DPAD_RIGHT].pressed?1:0)+(e.buttons[n.DPAD_LEFT].pressed?-1:0),(e.buttons[n.DPAD_UP].pressed?-1:0)+(e.buttons[n.DPAD_DOWN].pressed?1:0)):new THREE.Vector2},isConnected:function(){var e=this.getGamepad();return!(!e||!e.connected)},getID:function(){return this.getGamepad().id}})},{"../../lib/GamepadButton":5,"../../lib/GamepadButtonEvent":6}],14:[function(e,t,r){"use strict";e("./checkpoint-controls"),e("./gamepad-controls"),e("./keyboard-controls"),e("./touch-controls"),e("./movement-controls"),e("./trackpad-controls")},{"./checkpoint-controls":12,"./gamepad-controls":13,"./keyboard-controls":15,"./movement-controls":16,"./touch-controls":17,"./trackpad-controls":18}],15:[function(e,t,r){"use strict";e("../../lib/keyboard.polyfill");var n=window.KeyboardEvent;t.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this)},this.attachEventListeners()},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){var e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},attachEventListeners:function(){window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(var e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new n(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){var e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},{"../../lib/keyboard.polyfill":10}],16:[function(e,t,r){"use strict";var n,i,o,a,s,l="-controls";t.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){var e=this.el;this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){var t=this.el,r=this.data,n=t.sceneEl.systems.nav;t.sceneEl.hasLoaded&&this.injectControls(),n&&r.constrainToNavMesh!==e.constrainToNavMesh&&(r.constrainToNavMesh?n.addAgent(this):n.removeAgent(this))},injectControls:function(){for(var e,t=this.data,r=0;r<t.controls.length;r++)e=t.controls[r]+l,this.el.components[e]||this.el.setAttribute(e,"")},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:(o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,function(e,t){if(t){var r=this.el,n=this.data;if(n.enabled){this.updateVelocityCtrl();var i=this.velocityCtrl,l=this.velocity;if(i)if(t/1e3>.2?l.set(0,0,0):this.updateVelocity(t),n.constrainToNavMesh&&!1!==i.isNavMeshConstrained){if(l.lengthSq()<1e-5)return;o.copy(r.object3D.position),a.copy(l).multiplyScalar(t/1e3).add(o);var c=r.sceneEl.systems.nav;this.navGroup=null===this.navGroup?c.getGroup(o):this.navGroup,this.navNode=this.navNode||c.getNode(o,this.navGroup),this.navNode=c.clampStep(o,a,this.navGroup,this.navNode,s),r.object3D.position.copy(s)}else r.hasAttribute("velocity")?r.setAttribute("velocity",l):(r.object3D.position.x+=l.x*t/1e3,r.object3D.position.y+=l.y*t/1e3,r.object3D.position.z+=l.z*t/1e3)}}}),updateVelocityCtrl:function(){var e=this.data;if(e.enabled){for(var t=0,r=e.controls.length;t<r;t++){var n=this.el.components[e.controls[t]+l];if(n&&n.isVelocityActive())return void(this.velocityCtrl=n)}this.velocityCtrl=null}},updateVelocity:(n=new THREE.Vector2,i=new THREE.Quaternion,function(e){var t=void 0,r=this.el,o=this.velocityCtrl,a=this.velocity,s=this.data;if(o){if(!o.getVelocityDelta){if(o.getVelocity)return void a.copy(o.getVelocity());if(o.getPositionDelta)return void a.copy(o.getPositionDelta(e).multiplyScalar(1e3/e));throw new Error("Incompatible movement controls: ",o)}t=o.getVelocityDelta(e)}if(r.hasAttribute("velocity")&&!s.constrainToNavMesh&&a.copy(this.el.getAttribute("velocity")),t&&s.enabled){var l=s.camera;i.copy(l.object3D.quaternion),i.premultiply(r.object3D.quaternion),t.applyQuaternion(i);var c=t.length();s.fly?(a.copy(t),a.multiplyScalar(16.66667*this.data.speed)):(n.set(t.x,t.z),n.setLength(c*this.data.speed*16.66667),a.x=n.x,a.z=n.y)}})})},{}],17:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd)):e.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()}})},{}],18:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){var e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){var t=this.data,r=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=r[0],this.startingAxisData[1]=r[1]),this.startingAxisData.length>0){var n=0,i=0;t.enableNegX&&r[0]<this.startingAxisData[0]&&(n=-1),t.enablePosX&&r[0]>this.startingAxisData[0]&&(n=1),t.enablePosZ&&r[1]>this.startingAxisData[1]&&(i=-1),t.enableNegZ&&r[1]<this.startingAxisData[1]&&(i=1);var o=Math.abs(this.startingAxisData[1]-r[1]);Math.abs(this.startingAxisData[0]-r[0])>o?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=i,this.isMoving=!0)}},handleTouchAxis:function(e){var t=this.data,r=e.detail.axis,n=0,i=0;t.enableNegX&&r[0]<0&&(n=-1),t.enablePosX&&r[0]>0&&(n=1),t.enablePosZ&&r[1]>0&&(i=-1),t.enableNegZ&&r[1]<0&&(i=1),Math.abs(r[0])>Math.abs(r[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=i)}})},{}],19:[function(e,t,r){"use strict";var n={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function i(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}t.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(n)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){var e=this;this.model=null,this.mixer=null,this.activeActions=[];var t=this.el.getObject3D("mesh");t?this.load(t):this.el.addEventListener("model-loaded",(function(t){e.load(t.detail.model)}))},load:function(e){if(this.el==e.el){var t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",(function(e){t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})})),this.mixer.addEventListener("finished",(function(e){t.emit("animation-finished",{action:e.action,direction:e.direction})})),this.data.clip&&this.update({})}},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(e){var t=this.data,r=AFRAME.utils.diff(t,e);if("clip"in r)return this.stopAction(),void(t.clip&&this.playAction());this.activeActions.forEach((function(e){"duration"in r&&t.duration&&e.setDuration(t.duration),"clampWhenFinished"in r&&(e.clampWhenFinished=t.clampWhenFinished),("loop"in r||"repetitions"in r)&&e.setLoop(n[t.loop],t.repetitions),"timeScale"in r&&e.setEffectiveTimeScale(t.timeScale)}))}},stopAction:function(){for(var e=this.data,t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(this.mixer){var e=this.model,t=this.data,r=e.animations||(e.geometry||{}).animations||[];if(r.length)for(var o,a,s=(o=t.clip,new RegExp("^"+o.split(/\*+/).map(i).join(".*")+"$")),l=0;a=r[l];l++)if(a.name.match(s)){var c=this.mixer.clipAction(a,e);c.enabled=!0,c.clampWhenFinished=t.clampWhenFinished,t.duration&&c.setDuration(t.duration),1!==t.timeScale&&c.setEffectiveTimeScale(t.timeScale),c.setLoop(n[t.loop],t.repetitions).fadeIn(t.crossFadeDuration).play(),this.activeActions.push(c)}}},tick:function(e,t){if(this.mixer&&!isNaN(t)&&-1!=this.model.animationSlices[0].uid){if(this.mixer.update(t/1e3),!this.mixer._actions[0])return;if(this.model.animationSlices&&this.model.animationSlices[0].uid){for(let e=1;e<this.model.animationSlices.length;e++)if(this.model.animationSlices[0].uid==this.model.animationSlices[e].uid)var r=e;if(this.model.animationSlices[r]&&(this.model.animationSlices[0].changed&&(this.mixer._actions[0].time=this.model.animationSlices[r].startTime,this.model.animationSlices[0].changed=!1,this.model.animationSlices[0].count=0),this.model.animationSlices[0].reset||1!=this.model.animationSlices[0].count||(this.mixer._actions[0].time=this.model.animationSlices[r].endTime),this.mixer._actions[0].time<this.model.animationSlices[r].startTime&&(this.mixer._actions[0].time=this.model.animationSlices[r].startTime),this.mixer._actions[0].time>this.model.animationSlices[r].endTime)){if(this.model.animationSlices[0].uid==this.model.animationSlices[0].loop)this.mixer._actions[0].time=this.model.animationSlices[r].startTime;else if(this.model.animationSlices[0].reset){this.model.animationSlices[0].uid=this.model.animationSlices[0].idle,this.model.animationSlices[0].loop=this.model.animationSlices[0].idle;for(let e=1;e<this.model.animationSlices.length;e++)this.model.animationSlices[0].uid==this.model.animationSlices[e].uid&&(r=e,this.model.el.setAttribute("animation-mixer","clip: "+this.model.animationSlices[e].animationName));this.mixer._actions[0].time=this.model.animationSlices[r].startTime}this.model.animationSlices[0].count=1}}}}})},{}],20:[function(e,t,r){"use strict";THREE.ColladaLoader=e("../../lib/ColladaLoader"),t.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,r=this.data,n=this.el.sceneEl.systems.renderer;r&&(this.remove(),this.loader.load(r,(function(r){e.model=r.scene,e.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}})),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/ColladaLoader":3}],21:[function(e,t,r){"use strict";THREE.FBXLoader=e("../../lib/FBXLoader"),t.exports=AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this.data;if(e.src){this.remove();var t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))}},load:function(e){let t=new THREE.Vector3(1,1,1);!function(e,t){if(e["LastSaved|ApplicationName"])switch(e["LastSaved|ApplicationName"].value){case"3ds Max":e.OriginalUnitScaleFactor?t.multiplyScalar(e.OriginalUnitScaleFactor):t.multiplyScalar(100);break;case"Maya":e.OriginalUnitScaleFactor&&t.multiplyScalar(e.OriginalUnitScaleFactor)}}(e,t),e.scale.copy(t.multiplyScalar(.01)),this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/FBXLoader":4}],22:[function(e,t,r){"use strict";var n,i=e("../../lib/fetch-script")(),o=(n=void 0,function(){return n=n||i("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")});t.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){var e=this;this.model=null,this.loader=null,this.loaderPromise=o().then((function(){e.loader=new THREE.GLTFLoader,e.loader.setCrossOrigin("Anonymous")}))},update:function(){var e=this,t=this,r=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then((function(){e.loader.load(n,(function(e){t.model=e.scene,t.model.animations=e.animations,r.setObject3D("mesh",t.model),r.emit("model-loaded",{format:"gltf",model:t.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/fetch-script":8}],23:[function(e,t,r){"use strict";e("./animation-mixer"),e("./collada-model-legacy"),e("./fbx-model"),e("./gltf-model-legacy"),e("./object-model")},{"./animation-mixer":19,"./collada-model-legacy":20,"./fbx-model":21,"./gltf-model-legacy":22,"./object-model":24}],24:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this,t=void 0,r=this.data;r.src&&(this.remove(),t=new THREE.ObjectLoader,r.crossorigin&&t.setCrossOrigin(r.crossorigin),t.load(r.src,(function(t){t.traverse((function(e){e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)})),e.load(t)})))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{}],25:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){var e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},{}],26:[function(e,t,r){"use strict";function n(e,t,r,n){e&&(t=t||[],e.traverse((function(e){var i;e.isMesh&&((i=e.material)?Array.isArray(i)?i:i.materials?i.materials:[i]:[]).forEach((function(e){e&&!("envMap"in e)||t.length&&-1===t.indexOf(e.name)||(e.envMap=r,e.reflectivity=n,e.needsUpdate=!0)}))})))}t.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},format:{default:"RGBFormat",oneOf:["RGBFormat","RGBAFormat"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){var e=this,t=this.data;this.texture=(new THREE.CubeTextureLoader).load([t.path+"posx."+t.extension,t.path+"negx."+t.extension,t.path+"posy."+t.extension,t.path+"negy."+t.extension,t.path+"posz."+t.extension,t.path+"negz."+t.extension]),this.texture.format=THREE[t.format],this.object3dsetHandler=function(){var t=e.el.getObject3D("mesh"),r=e.data;n(t,r.materials,e.texture,r.reflectivity)},this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){var t=this.data,r=this.el.getObject3D("mesh"),i=[],o=[];if(t.materials.length&&(e.materials?(i=t.materials.filter((function(t){return!e.materials.includes(t)})),o=e.materials.filter((function(e){return!t.materials.includes(e)}))):i=t.materials),i.length&&n(r,i,this.texture,t.reflectivity),o.length&&n(r,o,null,1),e.materials&&t.reflectivity!==e.reflectivity){var a=t.materials.filter((function(t){return e.materials.includes(t)}));a.length&&n(r,a,this.texture,t.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);var e=this.el.getObject3D("mesh"),t=this.data;n(e,t.materials,null,1),t.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},{}],27:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){var e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){var e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){var e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){var t=e.detail.el;t&&!t.is(this.GRABBED_STATE)&&this.grabbing&&!this.hitEl&&(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},{}],28:[function(e,t,r){"use strict";e("./checkpoint"),e("./cube-env-map"),e("./grab"),e("./jump-ability"),e("./kinematic-body"),e("./mesh-smooth"),e("./normal-material"),e("./sphere-collider")},{"./checkpoint":25,"./cube-env-map":26,"./grab":27,"./jump-ability":29,"./kinematic-body":30,"./mesh-smooth":31,"./normal-material":32,"./sphere-collider":33}],29:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("jump-ability",{dependencies:["velocity"],schema:{on:{default:"keydown:Space gamepadbuttondown:0"},playerHeight:{default:1.764},maxJumps:{default:1},distance:{default:5},debug:{default:!1}},init:function(){this.velocity=0,this.numJumps=0;var e=this.beginJump.bind(this),t=this.data.on.split(" ");this.bindings={};for(var r=0;r<t.length;r++)this.bindings[t[r]]=e,this.el.addEventListener(t[r],e);this.bindings.collide=this.onCollide.bind(this),this.el.addEventListener("collide",this.bindings.collide)},remove:function(){for(var e in this.bindings)this.bindings.hasOwnProperty(e)&&(this.el.removeEventListener(e,this.bindings[e]),delete this.bindings[e]);this.el.removeEventListener("collide",this.bindings.collide),delete this.bindings.collide},beginJump:function(){if(this.numJumps<this.data.maxJumps){var e=this.data,t=Math.sqrt(-2*e.distance*-24.8),r=this.el.getAttribute("velocity");this.el.setAttribute("velocity",{x:r.x,y:t,z:r.z}),this.numJumps++,this.el.emit("jumpstart")}},onCollide:function(){this.numJumps>0&&this.el.emit("jumpend"),this.numJumps=0}})},{}],30:[function(e,t,r){"use strict";var n,i,o,a,s=1e-6;t.exports=AFRAME.registerComponent("kinematic-body",{dependencies:["velocity"],schema:{mass:{default:5},radius:{default:1.3},linearDamping:{default:.05},enableSlopes:{default:!0},enableJumps:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this);var e=this.el,t=this.data,r=(new CANNON.Vec3).copy(e.object3D.getWorldPosition(new THREE.Vector3));this.body=new CANNON.Body({material:this.system.getMaterial("staticMaterial"),position:r,mass:t.mass,linearDamping:t.linearDamping,fixedRotation:!0}),this.body.addShape(new CANNON.Sphere(t.radius),new CANNON.Vec3(0,t.radius,0)),this.body.el=this.el,this.el.body=this.body,this.system.addBody(this.body),e.hasAttribute("wasd-controls")&&console.warn("[kinematic-body] Not compatible with wasd-controls, use movement-controls.")},remove:function(){this.system.removeBody(this.body),this.system.removeComponent(this),delete this.el.body},beforeStep:function(e,t){if(t){var r=this.el,n=this.data,i=this.body;n.enableJumps||i.velocity.set(0,0,0),i.position.copy(r.getAttribute("position"))}},step:(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,function(e,t){if(t){var r=this.body,l=this.data,c=void 0,u=-1/0,d=void 0,h=this.system.getContacts();t=Math.min(t,1e3*this.system.data.maxInterval),a.set(0,0,0),n.copy(this.el.getAttribute("velocity")),r.velocity.copy(n);for(var p,f=0;p=h[f];f++)if(p.enabled){if(r.id===p.bi.id)p.ni.negate(o);else{if(r.id!==p.bj.id)continue;o.copy(p.ni)}r.velocity.dot(o)<-s&&o.y<=.5?n.projectOnPlane(o):o.y>.5&&(c=r.id===p.bi.id?Math.abs(p.rj.y+p.bj.position.y):Math.abs(p.ri.y+p.bi.position.y))>u&&(u=c,a.copy(o),d=r.id===p.bi.id?p.bj:p.bi)}i.copy(n).normalize(),d&&(!l.enableJumps||i.y<.5)?(l.enableSlopes?a.y<1-s&&a.copy(this.raycastToGround(d,a)):a.set(0,1,0),n.projectOnPlane(a)):this.system.driver.world&&n.add(this.system.driver.world.gravity.scale(4*t/1e3)),r.velocity.copy(n),this.el.setAttribute("velocity",r.velocity),this.el.setAttribute("position",r.position)}}),raycastToGround:function(e,t){var r,n=void 0,i=this.body.position,o=this.body.position.clone();return(n=new CANNON.Ray(i,o))._updateDirection(),n.intersectBody(e),n.hasHit?(r=n.result.hitNormalWorld,Math.abs(r.y)>Math.abs(t.y)?r:t):t}})},{}],31:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("mesh-smooth",{init:function(){this.el.addEventListener("model-loaded",(function(e){e.detail.model.traverse((function(e){e.isMesh&&e.geometry.computeVertexNormals()}))}))}})},{}],32:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial)},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){var e=this;this.el.object3D.traverse((function(t){t.isMesh&&(t.material=e.material)}))}})},{}],33:[function(e,t,r){"use strict";var n,i,o,a,s,l;t.exports=AFRAME.registerComponent("sphere-collider",{schema:{objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},remove:function(){this.pause()},play:function(){var e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){var e=this.data,t=void 0;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Box3,l=new Map,function(){var e,t,r=this.el,c=this.data,u=r.getObject3D("mesh"),d=[];u&&(l.clear(),r.object3D.getWorldPosition(n),r.object3D.getWorldScale(o),e=c.radius*(t=o,Math.max.apply(null,t.toArray())),this.els.forEach((function(t){var r,o,c,u;t.isEntity&&(o=t.getObject3D("mesh"))&&(s.setFromObject(o).getSize(a),u=Math.max(a.x,a.y,a.z)/2,r=Math.sqrt(2*u*u),s.getCenter(i),r&&(c=n.distanceTo(i))<r+e&&(d.push(t),l.set(t,c)))})),d.sort((function(e,t){return l.get(e)>l.get(t)?1:-1})).forEach(this.handleHit),0===d.length&&r.emit("hit",{el:null}),this.collisions.filter((function(e){return!l.has(e)})).forEach(this.handleHitEnd),this.collisions=d)}),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.el.emit("hit",{el:e})},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.el.emit("hitend",{el:e})}})},{}],34:[function(e,t,r){"use strict";e("./nav-mesh"),e("./nav-agent"),e("./system")},{"./nav-agent":35,"./nav-mesh":36,"./system":37}],35:[function(e,t,r){"use strict";var n,i,o;t.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,function(e,t){var r=this.el,a=this.data,s=this.raycaster,l=a.speed*t/1e3;if(a.active){if(!this.path.length){var c=this.el.object3D.position;this.group=this.group||this.system.getGroup(c),this.path=this.system.getPath(c,n.copy(a.destination),this.group)||[],r.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",a.destination),this.el.setAttribute("nav-agent",{active:!1}),void r.emit("navigation-end");var u=r.object3D.position,d=this.path[0];i.subVectors(d,u);var h=void 0;if(i.length()<l){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void r.emit("navigation-end");o.copy(u),h=this.path[0]}else o.copy(i.setLength(l)).add(u),h=d;h.y=u.y,r.object3D.lookAt(h),s.ray.origin.copy(o),s.ray.origin.y+=1.5,s.ray.direction.y=-1;var p=s.intersectObject(this.system.getNavMesh());p.length?(i.subVectors(p[0].point,u),u.add(i.setLength(l))):u.copy(o)}})})},{}],36:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("nav-mesh",{init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this.el.getObject3D("mesh"),t=this.el.sceneEl.object3D;if(e){var r=void 0;if(e.traverse((function(e){e.isMesh&&(r=e)})),r){var n=r.geometry.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(r.geometry):r.geometry.clone();t.updateMatrixWorld(),n.applyMatrix(r.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}}})},{}],37:[function(e,t,r){"use strict";var n=e("three-pathfinding").Pathfinding,i=new n,o="level";t.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),i.setZoneData(o,n.createZone(e)),Array.from(this.agents).forEach((function(e){return e.updateNavLocation()}))},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,r){return this.navMesh?i.findPath(e,t,o,r):null},getGroup:function(e){return this.navMesh?i.getGroup(o,e):null},getNode:function(e,t){return this.navMesh?i.getClosestNode(e,o,t,!0):null},clampStep:function(e,t,r,n,a){return this.navMesh?n?i.clampStep(e,t,n,o,r,a):(a.copy(t),this.getNode(t,r)):(a.copy(t),null)}})},{"three-pathfinding":11}],38:[function(e,t,r){"use strict";t.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},{}],39:[function(e,t,r){"use strict";var n=e("../../lib/hex-grid.min.js"),i=e("../../lib/default-hex-grid");t.exports.Primitive=AFRAME.registerPrimitive("a-hexgrid",{defaultComponents:{hexgrid:{}},mappings:{src:"hexgrid.src"}}),t.exports.Component=AFRAME.registerComponent("hexgrid",{dependencies:["material"],schema:{src:{type:"asset"}},init:function(){var e=this,t=this.data;t.src?fetch(t.src).then((function(e){return e.json()})).then((function(t){return e.addMesh(t)})):this.addMesh(i)},addMesh:function(e){var t=new n.HexGrid;t.fromJSON(e);var r=new n.Board(t);r.generateTilemap(),this.el.setObject3D("mesh",r.group),this.addMaterial()},addMaterial:function(){var e=(this.el.components.material||{}).material;e&&this.el.object3D.traverse((function(t){t.isMesh&&(t.material=e)}))},remove:function(){this.el.removeObject3D("mesh")}})},{"../../lib/default-hex-grid":7,"../../lib/hex-grid.min.js":9}],40:[function(e,t,r){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),t.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){var e=this.el,t=this.data,r=e.components.material,n=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);n.mergeVertices(),this.waves=[];for(var i,o=0,a=n.vertices.length;o<a;o++)i=n.vertices[o],this.waves.push({z:i.z,ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});r||((r={}).material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,shading:THREE.FlatShading})),this.mesh=new THREE.Mesh(n,r.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(t){for(var r,n,i=this.mesh.geometry.vertices,o=0;r=i[o];o++)n=this.waves[o],r.z=n.z+Math.sin(n.ang)*n.amp,n.ang+=n.speed*t;this.mesh.geometry.verticesNeedUpdate=!0}}})},{}],41:[function(e,t,r){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),t.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){var e=this.el,t=this.data,r=e.components.material;if(t.path.length){var n=new THREE.CatmullRomCurve3(t.path.map((function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))}))),i=new THREE.TubeGeometry(n,t.segments,t.radius,t.radialSegments,t.closed);r||((r={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(i,r.material),this.el.setObject3D("mesh",this.mesh)}else console.error("[a-tube] `path` property expected but not found.")},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},{}],42:[function(e,t,r){"use strict";e("./a-grid"),e("./a-hexgrid"),e("./a-ocean"),e("./a-tube")},{"./a-grid":38,"./a-hexgrid":39,"./a-ocean":40,"./a-tube":41}]},{},[1]),function(){function e(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,i=0;i<e;i++)t+=r.charAt(Math.floor(Math.random()*n));return t}var t,r=window.leavedSendLog=function(t){if(!window.publishVRProjs)return;if(!publishVRProjs.result)return;if(!publishVRProjs.result[0].user_id)return;let r;localStorage.getItem("device_id")&&localStorage.getItem("device_id")>=24?r=localStorage.getItem("device_id"):(r=(new Date).getTime()+"_"+e(10),localStorage.setItem("device_id",r));let n=(new Date).getTime(),i={brand:Browser.name+Browser.version,os:navigator.userAgent,device_id:r,client:"viewer",user_id:publishVRProjs.result[0].user_id,proj_id:"",proj_type:"vr",duration_time:0,explore_time:0,play_time:0,location_long:0,location_lan:0};i.proj_id=publishVRProjs.result[vrController.projectIdx].proj_id,i.duration_time=(n-vrController.userStartTime)/1e3,i.play_time=(n-vrController.userStartTime)/1e3,console.log("VRFunc.js: project["+vrController.projectIdx+"] playing time = ",i.duration_time,i.play_time,i.explore_time);let o=[i];localStorage.setItem("savedProjLogs",JSON.stringify(o))};window.onbeforeunload=r,t="undefined"!=typeof window?window:self;let n=0;var i=function(){n++,n>3?console.log("VRFunc.js: integrateTick, integrateCount=",n,", too many times"):t.AFRAME&&t.THREE?(console.log("VRFunc.js: integrateTick, scope=",t,n),function(){AFRAME.registerComponent("initvrscene",{init:function(){this.el}}),AFRAME.registerComponent("cursor-listener",{init:function(){}});var e=function(){this.GLRenderer=null,this.scene2D=null,this.camera2D=null,this.light=null,this.vrScene=null,this.publishVRProjs=null,this.VRSceneResult=null,this.makarVRscenes={},this.makarObjects=[],this.currentSceneMakarObjects=[],this.loadSceneCount=0,this.module=null,this.cursorEntity=null,this.projectIdx=null,this.intervalList=[],this.FUNCTION_ENABLED=!1,this.clock=new THREE.Clock,this.delta=this.time=0,this.triggerEnable=!1,this.touchMouseState=-1,this.groupDict={0:{activeObj:null,objs:[]},1:{activeObj:null,objs:[]},2:{activeObj:null,objs:[]},3:{activeObj:null,objs:[]},4:{activeObj:null,objs:[]},5:{activeObj:null,objs:[]},6:{activeObj:null,objs:[]},7:{activeObj:null,objs:[]}},this.lookAtObjectList=[],this.lookAtTimelineDict={}};function t(e,t){let r=new XMLHttpRequest;r.open("HEAD",e,!0),r.onload=function(e){console.log(" VRFunc.js: _UrlExists: httpRequest status= ",r.status),t("200"==r.status)},r.onerror=function(e){console.log("onerror e=",e),t("200"==r.status)},r.onabort=function(e){console.log("onabort e=",e),t("200"==r.status)},r.send()}function r(e){return"object"==typeof e&&"function"==typeof e.then}e.prototype.UrlExistsFetch=async function(e){let t=await fetch(e,{method:"HEAD"});return console.log("_VRController: _UrlExists2: ret ",t),!!t.status&&"200"==t.status},e.prototype.setupFunction=function(){if(this.FUNCTION_ENABLED)return;this.FUNCTION_ENABLED=!0;var e=this;this.loadAssets=function(t){let r=document.createElement("a-assets");r.setAttribute("id","makarAssets"),r.setAttribute("timeout","1000"),r.setAttribute("crossorigin","anonymous"),e.vrScene.appendChild(r)},this.loadScene=function(r,n){if(null==e.VRSceneResult[r].scenes[n])console.log("VRFunc.js: VRController: _loadScene: error, [valid sceneIndex]=",e.VRSceneResult[r].scenes.length,n);else{this.sceneIndex=n;let o=document.getElementsByTagName("video");if(o.length>0)for(let e=0;e<o.length;e++)o[e].pause(),o[e].removeAttribute("src"),o[e].load();let a=document.getElementsByTagName("audio");if(a.length>0)for(let e=0;e<a.length;e++)a[e].pause(),a[e].removeAttribute("src"),a[e].load();if(e.makarObjects){for(let t=0;t<e.makarObjects.length;t++){let r=e.makarObjects[t];r.object3D&&r.object3D.traverse((e=>{e.isMesh&&(e.material&&(e.material.map&&e.material.map.dispose&&e.material.map.dispose(),e.material.dispose()),e.geometry&&e.geometry.dispose())})),r.remove()}e.makarObjects.length=0}Array.isArray(e.currentSceneMakarObjects)&&(e.currentSceneMakarObjects.length=0),e.cubeTex&&(e.cubeTex.texture&&e.cubeTex.texture.dispose(),e.cubeTex.dispose()),e.needsRenderTarget=!1;var i=[];if("string"!=typeof e.VRSceneResult[r].editor_ver)return console.log("VRFunc.js: _loadSceneObjects: the editor_ver is not string, error and return "),-1;let s;i=e.VRSceneResult[r].editor_ver.split("."),e.editor_version=i;let l=e.editorVerionControllSky(i,r,n);s="spherical_video"==l.scene_skybox_main_type?"https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg":"spherical_image"==l.scene_skybox_main_type?"DefaultResource/Spherical_Image/SphericalImage.png"==l.scene_skybox_url?"https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png":l.scene_skybox_url:"https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png",t(s,(function(t){let i;0==t&&(s="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg"),i=THREE.WebGLRenderTargetCube?new THREE.WebGLRenderTargetCube(1024,1024):new THREE.WebGLCubeRenderTarget(1024);let o=e.vrScene.renderer;THREE.GammaEncoding&&(o.outputEncoding=THREE.GammaEncoding,o.gammaFactor=1),e.checkVRSceneResultBehav(),e.clearBehavs();let a=(new THREE.TextureLoader).load(s,(function(){let t=i.fromEquirectangularTexture(o,a);e.cubeTex=t,e.loadSceneCount++,e.loadAssets();let s=e.loadSceneObjects(r,n),c=e.loadSky(r,n,l);if(c.then((function(e){console.log("VRFunc.js: _loadScene: pSky then ret = ",e)})),publishVRProjs.result[r].xml_urls&&publishVRProjs.result[r].xml_urls[n]){let t=e.parseLogicXML(r,n);s.push(t)}Promise.all(s.concat(c)).then((function(t){console.log("VRFunc.js: _loadScene: pAll then ret = ",t),e.onlySkyScene.add(document.getElementById("sky").object3D.clone(!0)),loadPage.style.display="none",homePage.style.display="none",homeTickOn&&(homeTickOn=!1),null!=typeof loadingTickOn&&(loadingTickOn=!1),e.triggerEnable=!0,publishVRProjs.result[r].xml_urls&&publishVRProjs.result[r].xml_urls[n]&&null!=e.logic.xmlDoc&&e.logic.parseXML(),e.setupSceneBehav(),setTimeout((function(){e.calcSceneArea()}),1),parent&&parent.projMenuGroup&&parent.controlGroup&&parent.pictureBackground&&parent.projectUIController&&"function"==typeof parent.projectUIController.showUI&&"function"==typeof parent.projectUIController.hideUI&&-1==parent.projectUIController.status&&parent.projectUIController.showUI()}))}))}))}},this.editorVerionControllSky=function(t,r,n){let i={scene_skybox_url:"",scene_skybox_main_type:""};if(console.log("VRFunc.js: _editorVerionControllSky: ",t,VRSceneResult[r].scenes[n]),3==t.length){let o=t[0],a=t[1],s=t[2];switch(o){case"3":a<3?(i.scene_skybox_url=VRSceneResult[r].scenes[n].scene_skybox_url,i.scene_skybox_main_type=VRSceneResult[r].scenes[n].scene_skybox_main_type,i.scene_snapshot_url=VRSceneResult[r].scenes[n].scene_snapshot_url,console.log("VRFunc.js: _editorVerionControllSky: below 3.3.2 ",VRSceneResult[r].scenes[n])):a>=3&&s>=2?(i.scene_skybox_url=VRSceneResult[r].scenes[n].environment.scene_skybox_url,i.scene_skybox_main_type=VRSceneResult[r].scenes[n].environment.scene_skybox_main_type,i.scene_snapshot_url=VRSceneResult[r].scenes[n].environment.scene_snapshot_url,console.log("VRFunc.js: _editorVerionControllSky: after 3.3.2 ",VRSceneResult[r].scenes[n])):a>=4?(i.scene_skybox_url=VRSceneResult[r].scenes[n].environment.scene_skybox_url,i.scene_skybox_main_type=VRSceneResult[r].scenes[n].environment.scene_skybox_main_type,i.scene_snapshot_url=VRSceneResult[r].scenes[n].environment.scene_snapshot_url,console.log("VRFunc.js: _editorVerionControllSky: after 3.4.0 ",VRSceneResult[r].scenes[n])):console.log("VRFunc.js: _editorVerionControllSky: large version error ",VRSceneResult[r].scenes[n]);break;case"2":case"1":console.log("VRFunc.js: _editorVerionControllSky: largeVersion below 3",e.VRSceneResult[r]),i.scene_skybox_url=VRSceneResult[r].scenes[n].scene_skybox_url,i.scene_skybox_main_type=VRSceneResult[r].scenes[n].scene_skybox_main_type,i.scene_snapshot_url=VRSceneResult[r].scenes[n].scene_snapshot_url;break;default:console.log("VRFunc.js: _editorVerionControllSky: missing large version ",e.VRSceneResult[r])}}else if(""==e.VRSceneResult[r].editor_ver){if(!Array.isArray(e.VRSceneResult[r].scenes[n].scene_skybox_url))return console.log("VRFunc.js: _editorVerionControllSky the scene_skybox_url is not exist, error",e.VRSceneResult[r]),-1;console.log("VRFunc.js: _editorVerionControllSky: the editor version empty",e.VRSceneResult[r]),i.scene_skybox_url=VRSceneResult[r].scenes[n].scene_skybox_url,i.scene_skybox_main_type=VRSceneResult[r].scenes[n].scene_skybox_main_type,i.scene_snapshot_url=VRSceneResult[r].scenes[n].scene_snapshot_url}return i},this.editorVersionControllObjs=function(t,r,n){let i;if(3==t.length){let a=t[0],s=t[1],l=t[2];switch(a){case"3":if(0==s&&l<=6){if(!Array.isArray(e.VRSceneResult[r].scenes[n].scene_objs))return console.log("VRFunc.js: _editorVerionControll the scenes[sceneIndex] is not Array, error",e.VRSceneResult[r]),-1;console.log("VRFunc.js: _editorVerionControll: the editor version before 3.0.6",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].scene_objs}else if(1==s||0==s&&l>=7)console.log("VRFunc.js: _editorVerionControll: the editor version after 3.0.7",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].objs;else if(2==s||s>=3){if(console.log("VRFunc.js: _editorVerionControll: the editor version is 3.2.n or 3.3.n",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].objs,e.VRSceneResult[r].scenes[n].camera_rotation&&e.VRSceneResult[r].scenes[n].fov){let t=(new THREE.Vector3).fromArray(e.VRSceneResult[r].scenes[n].camera_rotation.split(",").map((function(e){return Number(e)})));t.multiply(new THREE.Vector3(-1,-1,0)).add(new THREE.Vector3(0,180,0));let i=document.getElementById("aCamera"),a=document.getElementById("oCamera");function o(){console.log("VRFunc.js: _editorVerionControll: aCamera set fov = ",VRSceneResult[r].scenes[n].fov);let s=document.getElementById("vrscene");s.camera.fov=VRSceneResult[r].scenes[n].fov,i.setAttribute("camera",{fov:VRSceneResult[r].scenes[n].fov}),a.setAttribute("camera",{fov:VRSceneResult[r].scenes[n].fov}),parent.selectedProject?"XR"==parent.selectedProject.viewMode?e.setViewMode("VR"):"model"==parent.selectedProject.viewMode?e.setViewMode("model"):e.setViewMode("VR"):e.setViewMode("VR"),s.camera.updateProjectionMatrix(),console.log("VRFunc.js: _editorVerionControll: aCamera loaded rotation=",t),i.components["look-controls"].yawObject.rotation.y=t.y/180*Math.PI,i.components["look-controls"].pitchObject.rotation.x=t.x/180*Math.PI,console.log("VRFunc.js: _loadSceneObjects aCamera: yawr=",i.components["look-controls"].yawObject.rotation,", pitchr=",i.components["look-controls"].pitchObject.rotation),i.removeEventListener("look-controls-loaded",o)}i&&(i.components["look-controls"].yawObject&&i.components["look-controls"].pitchObject?(console.log("VRFunc.js: _editorVerionControll: aCamera look-controls already set"),o()):(console.log("VRFunc.js: _editorVerionControll: aCamera look-controls not set yet"),i.addEventListener("look-controls-loaded",o)))}}else console.error("VRFunc.js: _editorVerionControll: the editor version after 3.2 , error ",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].objs;break;case"2":case"1":console.log("VRFunc.js: _editorVerionControll: largeVersion below 3",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].scene_objs;break;default:console.log("VRFunc.js: _editorVerionControll: missing large version ",e.VRSceneResult[r])}}else if(""==e.VRSceneResult[r].editor_ver){if(!Array.isArray(e.VRSceneResult[r].scenes[n].scene_objs))return console.log("VRFunc.js: _loadSceneObjects the scene_objs_v2 is not Array, error",e.VRSceneResult[r]),-1;console.log("VRFunc.js: _loadSceneObjects: the editor version empty",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].scene_objs}return i},this.loadSky=function(r,n,i){return new Promise((function(o){t(i.scene_skybox_url,(function(t){let a;if(console.log(" ******  retStatus = ",t,i.scene_skybox_url),0==t){if(document.getElementById("sky")?(a=document.getElementById("sky"),"a-sky"==a.localName||"a-videosphere"==a.localName&&(a.remove(),a=document.createElement("a-sky"),a.setAttribute("id","sky"),e.vrScene.appendChild(a))):(a=document.createElement("a-sky"),a.setAttribute("id","sky"),e.vrScene.appendChild(a)),"DefaultResource/Spherical_Image/SphericalImage.png"==i.scene_skybox_url);else{let e=document.createElement("div");e.style.position="absolute",e.style.top="30%",e.style.left="0%",e.style.width="100%",e.style.height="40%",e.style.color="black",e.style.backgroundColor="rgba(128,128,128,0.5)",e.style.pointerEvents="none",e.style.fontSize="24px",e.style.zIndex=3,document.body.appendChild(e);let t=document.createElement("div");t.className="centerText",t.style.whiteSpace="pre-wrap",t.textContent="/",e.appendChild(t),setTimeout((function(){e.remove()}),8e3)}let t=!1;if(a.getAttribute("material")&&a.getAttribute("material").src==i.scene_skybox_url&&(t=!0),1==t)console.log("VRFunc.js: _loadSky: spherical_image same as previous(404)"),o(a);else{a.setAttribute("material",{src:"https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png"}),a.setAttribute("radius",2e3);var s=function(){console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page "),a.removeEventListener("materialtextureloaded",s)};a.addEventListener("materialtextureloaded",s),o(a)}}else{switch(i.scene_skybox_main_type){case"spherical_image":case"image":document.getElementById("sky")?(a=document.getElementById("sky"),"a-sky"==a.localName||"a-videosphere"==a.localName&&(a.remove(),a=document.createElement("a-sky"),a.setAttribute("id","sky"),e.vrScene.appendChild(a))):(a=document.createElement("a-sky"),a.setAttribute("id","sky"),e.vrScene.appendChild(a)),"DefaultResource/Spherical_Image/SphericalImage.png"==i.scene_skybox_url&&(i.scene_skybox_url="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png");let t=!1;a.getAttribute("material")&&a.getAttribute("material").src==i.scene_skybox_url&&(t=!0),0==t?(a.setAttribute("material",{src:i.scene_skybox_url}),s=function(){console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page "),a.removeEventListener("materialtextureloaded",s),o(a)},a.addEventListener("materialtextureloaded",s)):(console.log("VRFunc.js: _loadSky: spherical_image same as previous  "),o(a)),a.setAttribute("radius",2e3);break;case"spherical_video":let l=document.getElementById("makarAssets");document.getElementById("sky")?(a=document.getElementById("sky"),"a-sky"==a.localName?(a.remove(),a=document.createElement("a-videosphere"),a.setAttribute("id","sky"),e.vrScene.appendChild(a)):a.localName):(a=document.createElement("a-videosphere"),a.setAttribute("id","sky"),e.vrScene.appendChild(a));let c=document.createElement("video");c.src=i.scene_skybox_url,c.playsInline=!0,c.autoplay=!0,c.muted=!0,c.setAttribute("loop","true"),c.setAttribute("type","video/mp4"),window.Browser&&(null!=window.Browser.name&&"safari"!=window.Browser.name||(c.muted=!0)),c.onloadedmetadata=function(){console.log("VRFunc.js: _loadSky: spherical_video onloadedmetadata"),c.play()},c.setAttribute("crossorigin","anonymous"),c.setAttribute("id",e.VRSceneResult[r].scenes[n].scene_id+"_"+e.loadSceneCount),c.setAttribute("autoplay","true"),l.appendChild(c),a.setAttribute("src","#"+e.VRSceneResult[r].scenes[n].scene_id+"_"+e.loadSceneCount),a.setAttribute("radius",2e3),s=function(){console.log("VRFunc.js: _loadSky: spherical_video materialtextureloaded, remove loading page "),a.removeEventListener("materialtextureloaded",s),o(a)},a.addEventListener("materialtextureloaded",s)}console.log("VRFunc.js: _loadSky: aSky=",a)}}))}))},this.loadSceneObjects=function(t,r){if(!userProjResDict)return console.log("%cVRFunc.js: _loadSceneObjects: error userProjResDict not exist, return -1","color:red"),[];let n=[];var i=[];if("string"!=typeof e.VRSceneResult[t].editor_ver)return console.log("VRFunc.js: _loadSceneObjects: the editor_ver is not string, error and return "),[];if(i=e.VRSceneResult[t].editor_ver.split("."),n=e.editorVersionControllObjs(i,t,r),!Array.isArray(n))return[];let s=[];for(let r=0;r<n.length;r++){let c=(new THREE.Vector3).fromArray(n[r].transform[0].split(",").map((function(e){return Number(e)}))),u=(new THREE.Vector3).fromArray(n[r].transform[1].split(",").map((function(e){return Number(e)}))),d=(new THREE.Vector3).fromArray(n[r].transform[2].split(",").map((function(e){return Number(e)})));switch(n[r].main_type){case"camera":if(e.VRSceneResult[t].editor_ver&&"string"==typeof e.VRSceneResult[t].editor_ver&&3==(i=e.VRSceneResult[t].editor_ver.split(".")).length&&3==i[0]&&2==i[1]){console.log("VRFunc.js: _loadSceneObjects: camera: editor vesion is 3.2.n , dont set");break}let h=document.getElementById("camera_cursor");var l=function(){h.hasLoaded?(u.multiply(new THREE.Vector3(-1,-1,0)).add(new THREE.Vector3(0,180,0)),h.setAttribute("position",c),aCamera.components["look-controls"].yawObject&&aCamera.components["look-controls"].pitchObject&&(aCamera.components["look-controls"].yawObject.rotation.y=u.y/180*Math.PI,aCamera.components["look-controls"].pitchObject.rotation.x=u.x/180*Math.PI,aCamera.object3D.position.set(0,0,0),console.log("VRFunc.js: _loadSceneObjects aCamera: yawr=",aCamera.components["look-controls"].yawObject.rotation,", pitchr=",aCamera.components["look-controls"].pitchObject.rotation)),console.log("VRFunc.js: _loadSceneObjects: camera: ",r,n[r],c,u,h,e.vrScene)):(setTimeout(l,100),console.log("VRFunc.js: _loadSceneObjects: camera: not loaded, wait"))};setTimeout(l,10);break;case"image":let p=n[r];if(console.log("VRFunc.js: _loadSceneObjects: image: ",r,n[r]),userProjResDict[p.res_id])if(p.res_url==userProjResDict[p.res_id].res_url){let t=e.loadTexture(p,c,u,d);s.push(t)}else console.log("%cVRFunc.js: _loadSceneObjects: image res_url is different from userProjResDict!","color:red",r,p,userProjResDict[p.res_id]);else{switch(p.res_id){case"MakAR_Call":p.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Call.png";break;case"MakAR_Room":p.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Room.png";break;case"MakAR_Mail":p.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Mail.png";break;case"Line_icon":p.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Line_icon.png";break;case"FB_icon":p.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/FB_icon.png";break;default:console.log("%c VRFunc.js: _loadSceneObjects: image res_id not exist!","color:red",p)}let t=e.loadTexture(p,c,u,d);s.push(t)}break;case"text":console.log("VRFunc.js: _loadText: text: ",r,n[r]);let f=e.loadText(n[r],c,u,d);s.push(f);break;case"audio":if(("mp3"==n[r].sub_type||"wav"==n[r].sub_type||"ogg"==n[r].sub_type)&&n[r].res_url){let t=e.loadAudio(n[r],c,u,d);s.push(t)}break;case"video":if("mp4"==n[r].sub_type&&n[r].res_url){let t=e.loadVideo(n[r],c,u,d);s.push(t)}break;case"model":if(console.log("VRFunc.js: _loadSceneObjects: model",r,n[r]),userProjResDict[n[r].res_id])n[r].res_url=userProjResDict[n[r].res_id].res_url;else if(userOnlineResDict[n[r].res_id])n[r].res_url=userOnlineResDict[n[r].res_id].res_url;else switch(n[r].res_id){case"Cube":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Cube.glb";break;case"Capsule":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Capsule.glb";break;case"Sphere":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Sphere.glb";break;case"ch_Bojue":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Bojue.glb";break;case"ch_Fei":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Fei.glb";break;case"ch_Lina":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Lina.glb";break;case"ch_Poyuan":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Poyuan.glb";break;case"ch_Roger":n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Roger.glb";break;default:if(n[r].res_gltf_resource)break;n[r].material=[],n[r].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb"}let m=e.loadGLTFModel(n[r],c,u,d,e.cubeTex);s.push(m);break;case"light":console.log("VRFunc.js: _loadSceneObjects: light",r,n[r]),e.loadLight(n[r],c,u,d);break;case"empty":switch(n[r].sub_type){case"quiz":let t=document.getElementById("startQuiz");t.style.display="block";let i=document.getElementById("QuizStartButton"),s=function(){e.loadQuiz(n[r],c,u,d),t.style.display="none",i.removeEventListener("click",s)},l=function(){t.style.display="none",i.removeEventListener("click",l)},h=window.serverUrl,p=localStorage.getItem("login_shared_id"),f=publishVRProjs.result[e.projectIdx].proj_id;1==n[r].module[0].force_login?p?0==n[r].module[0].allow_retry?(console.log("VRFunc.js: _getRecordModule: get remote: ",p,f),getRecordModule(h,p,f,(function(e){console.log("VRFunc.js: _getRecordModule: ret= ",e),e.data.record_module_list?(QuizStartContent.textContent=a.userAlreadyPlayed[o],i.addEventListener("click",l)):(QuizStartContent.textContent=a.clickToPlay[o],i.addEventListener("click",s))}))):(QuizStartContent.textContent=a.clickToPlay[o],i.addEventListener("click",s)):(QuizStartContent.textContent=a.userNotLoginInfo[o],i.addEventListener("click",l)):(QuizStartContent.textContent=a.clickToPlay[o],i.addEventListener("click",s)),console.log("VRFunc.js: _loadSceneObjects: empty, quiz ",r,n[r]);break;default:console.log("VRFunc.js: _loadSceneObjects: empty object default, ",r,n[r])}break;default:console.log("VRFunc.js: _loadSceneObjects: default",r,n[r])}}return s},this.checkDefaultImage=function(e){switch(e.res_id){case"MakAR_Call":e.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Call.png";break;case"MakAR_Room":e.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Room.png";break;case"MakAR_Mail":e.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Mail.png";break;case"Line_icon":e.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Line_icon.png";break;case"FB_icon":e.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/FB_icon.png";break;default:console.log("image: default, obj=",e)}},this.loadTexture=function(r,n,i,o){return e.checkDefaultImage(r),new Promise((function(a){t(r.res_url,(function(t){if(1==t){var s=(new THREE.TextureLoader).load(r.res_url);let t,l=r.res_url.split(".").length,c=r.res_url.split(".")[l-1].toLowerCase();if(r.sub_type=r.sub_type.toLowerCase(),"png"==r.sub_type||"jpg"==r.sub_type||"jpeg"==r.sub_type||"bmp"==r.sub_type)c=r.sub_type,t=document.createElement("a-plane"),t.setAttribute("src",r.res_url);else if("gif"==r.sub_type)c=r.sub_type,t=document.createElement("a-entity");else{if("button"!=r.sub_type)return console.log("VRFunc.js: _loadTexture: sub_type empty, create empty plane "),t=document.createElement("a-plane"),void a(t);"png"!=c&&"jpg"!=c&&"jpeg"!=c&&(c="png"),t=document.createElement("a-plane"),t.setAttribute("src",r.res_url)}t.setAttribute("id",r.obj_id),t.setAttribute("crossorigin","anonymous");let u=!1;if(r.behav)for(let e=0;e<r.behav.length;e++)"TransparentVideo"!=r.behav[e].simple_behav&&"TransparentImage"!=r.behav[e].simple_behav||(u=!0,chromaKey=r.behav[e].chromakey,slope=r.behav[e].slope,threshold=r.behav[e].threshold,transparentBehav=r.behav[e]);if(u){let e=chromaKey.split(","),n=new THREE.Color(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])),i=transparentBehav.HSV.split(","),o=parseFloat(i[0]),a=parseFloat(i[1]),s=parseFloat(i[2]);"jpg"==c||"jpeg"==c||"png"==c?"RGB"==transparentBehav.mode?t.setAttribute("material","shader: chromaKey; color: #"+n.getHexString()+";transparent: true; side:double; depthWrite:false; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";"):"HSV"==transparentBehav.mode&&t.setAttribute("material","shader: HSVMatting; transparent: true; side:double; depthWrite:false; _keyingColorH:"+o+"; _keyingColorS:"+a+"; _keyingColorV:"+s+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";"):"gif"==c&&("RGB"==transparentBehav.mode?(t.setAttribute("geometry","primitive: plane"),t.setAttribute("material","shader:gif_RGB;  src: url("+r.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; color: #"+n.getHexString()+"; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";")):"HSV"==transparentBehav.mode&&(t.setAttribute("geometry","primitive: plane"),t.setAttribute("material","shader:gif_HSV;  src: url("+r.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; _keyingColorH:"+o+"; _keyingColorS:"+a+"; _keyingColorV:"+s+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";")))}else"jpg"==c||"jpeg"==c||"png"==c?(t.setAttribute("material","shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:false"),t.setAttribute("geometry","primitive: plane")):"gif"==c&&(t.setAttribute("geometry","primitive: plane"),t.setAttribute("material","side:double; shader:gif;  src: url("+r.res_url+"); opacity: 1; transparent: true; depthWrite:false"));r.behav?1==r.behav.length&&u?t.setAttribute("class","unclickable"):t.setAttribute("class","clickable"):t.setAttribute("class","unclickable"),e.setTransform(t,n,i,o),e.makarObjects.push(t);let d=e.vrScene.renderer.capabilities.getMaxAnisotropy();if(t.addEventListener("materialtextureloaded",(function(e){e.detail.texture.anisotropy=d,e.detail.texture.needsUpdate=!0})),t.addEventListener("loaded",(function(n){if(n.target==n.currentTarget){let n=setInterval((function(){s.image&&(t.object3D.children[0].scale.set(.01*s.image.width,.01*s.image.height,1),t.setAttribute("heightForQuiz",.01*s.image.height),window.clearInterval(n))}),1),i=new THREE.Vector3;i.set(0,Math.PI,0),t.object3D.children[0].rotation.setFromVector3(i),t.object3D.children[0].renderOrder=1,t.object3D.makarObject=!0,r.behav&&(t.object3D.behav=r.behav,e.setObjectBehavAll(r)),r.behav_reference&&(t.object3D.behav_reference=r.behav_reference),"button"==r.main_type&&(t.object3D.main_type=r.main_type,t.object3D.sub_type=r.sub_type,t.setAttribute("class","clickable"),console.log("VRFunc.js: _loadTexture: button ",t)),a(t)}else console.log("VRFunc.js: _loadTexture: loaded target different")})),0==r.active&&(t.setAttribute("visible",!1),t.setAttribute("class","unclickable")),r.behav_reference)for(let e=0;e<r.behav_reference.length;e++)if("ShowImage"==r.behav_reference[e].behav_name){t.setAttribute("visible",!1),t.setAttribute("class","unclickable");break}if(r.obj_parent_id){let e=setInterval((function(){let n=document.getElementById(r.obj_parent_id);n&&n.object3D.children.length>0&&(n.appendChild(t),window.clearInterval(e))}),1)}else e.vrScene.appendChild(t)}else console.log("VRFunc.js: _loadTexture , obj url not exist ",r),r.main_type="model",r.sub_type="glb",r.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb",e.loadGLTFModel(r,n,i,o,e.cubeTex),a(1)}))}))},this.loadText=function(t,r,n,i){return new Promise((function(o){let a=document.createElement("a-entity");e.setTransform(a,r,n,i),a.setAttribute("id",t.obj_id),e.makarObjects.push(a),t.behav||"button"==t.main_type?a.setAttribute("class","clickable"):a.setAttribute("class","unclickable");let s=document.createElement("a-text");s.setAttribute("geometry","primitive:plane; width: auto; height: auto; skipCache: true;"),s.setAttribute("material","opacity: 0.0 ; depthWrite:false; color:#000000; side:double;"),textList=t.content.split("\n");let l=0;const c=/[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u,u=e=>c.test(e);for(let e=0;e<textList.length;e++){textLength=0;for(let t=0;t<textList[e].length;t++)u(textList[e][t])?textLength+=1.6:textList[e][t]==textList[e][t].toUpperCase()&&textList[e][t]!=textList[e][t].toLowerCase()||textList[e][t]==textList[e][t].toLowerCase()&&textList[e][t]!=textList[e][t].toUpperCase()?textLength+=1:isNaN(1*textList[e][t])?textLength+=1.25:textLength+=1;textLength>l&&(l=textLength)}s.setAttribute("value",t.content),s.setAttribute("anchor","center"),s.setAttribute("align","left"),s.setAttribute("backcolor",t.back_color),s.setAttribute("textcolor",t.color),s.setAttribute("side","double");var d="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/resource/fonts/";fonts=[d+"1-msdf.json",d+"2-msdf.json",d+"3-msdf.json",d+"4-msdf.json",d+"5-msdf.json",d+"6-msdf.json",d+"7-msdf.json",d+"8-msdf.json",d+"9-msdf.json",d+"10-msdf.json",d+"11-msdf.json",d+"12-msdf.json"],s.setAttribute("font",fonts),s.setAttribute("negate","false"),s.setAttribute("crossorigin","anonymous");let h=t.color.split(","),p=new THREE.Color(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]));s.setAttribute("color","#"+p.getHexString());let f=0;if(s.addEventListener("geometry-set",(function e(t){console.log("VRFunc.js: _loadText: textEntity geometry-set: evt=",t),0==f?f=1:1==f&&o(s),s.removeEventListener("geometry-set",e)})),s.addEventListener("loaded",(function(r){if(r.target==r.currentTarget){console.log("VRFunc.js: _loadText loaded textEntity=",s.object3D,s.object3D.parent.scale.x);let r=new THREE.Vector3;r.set(0,Math.PI,0),s.object3D.rotation.setFromVector3(r),a.object3D.makarObject=!0,t.behav&&(a.object3D.behav=t.behav,e.setObjectBehavAll(t)),t.behav_reference&&(a.object3D.behav_reference=t.behav_reference),"button"==t.main_type&&(a.object3D.main_type=t.main_type),0==f?f=1:1==f&&o(s)}})),a.appendChild(s),0==t.active&&(a.setAttribute("visible",!1),a.setAttribute("class","unclickable")),t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("ShowText"==t.behav_reference[e].behav_name){a.setAttribute("visible",!1),a.setAttribute("class","unclickable");break}if(console.log(" VRFunc.js: _loadText: anchor= ",a.object3D,", obj=",t),t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(a),window.clearInterval(e))}),100)}else e.vrScene.appendChild(a)}))},this.checkGLTFMaterialIndex=function(e,t){if(!e||!e.object3D||!e.object3D.children[0])return void console.log("VRFunc.js: _checkGLTFMaterialIndex: target error",e);if(!t)return void console.log("VRFunc.js: _checkGLTFMaterialIndex: material error",t);let r=t.rendererIndex,n=t.materialIndex,i=-1,o=-1,a=e.object3D.children[0].ModelJson.nodes,s=-1;for(let e=0;e<a.length;e++)if("number"==typeof a[e].mesh&&s++,r==s){i=a[e].mesh;break}if(i>=0){let t=e.object3D.children[0].ModelJson.meshes[i];if(t&&t.primitives){let e=t.primitives[n];e&&e.material>=0&&(o=e.material,console.log("VRFunc.js: _checkGLTFMaterialIndex: materialIndex=",o))}}return o},this.loadGLTFModel=function(r,n,i,o,a){return new Promise((function(a){t(r.res_url,(function(t){if(1==t){if(""==r.res_url||"glb"!=r.sub_type&&"gltf"!=r.sub_type&&"gltf_sketchFab"!=r.sub_type&&"gltf_sketchfab"!=r.sub_type&&"gltf_poly"!=r.sub_type)return console.log("VRFunc.js: _loadGFLTFModel: obj not support ",r),void a(-1);let t=document.getElementById("makarAssets"),c=document.createElement("a-asset-item");c.setAttribute("id",r.obj_id+"_"+r.res_id),c.setAttribute("src",r.res_url),c.setAttribute("response-type","arraybuffer"),c.setAttribute("crossorigin","anonymous"),t.appendChild(c);var s,l=null;if(r.animation)if(l=[],Array.isArray(e.editor_version)&&3==e.editor_version.length){let t=Number(e.editor_version[0]),n=Number(e.editor_version[1]),i=Number(e.editor_version[2]);if(t>3||3==t&&n>3||3==t&&3==n&&i>8){for(let e=0;e<r.animation.length;e++)(r.animation[e].is_default||r.animation[e].is_active)&&(l.push({idle:r.animation[e].uid,loop:r.animation[e].uid,uid:r.animation[e].uid,changed:!1,reset:!0,count:0}),s=r.animation[e].animation_name);for(let e=0;e<r.animation.length;e++)l.push({name:r.animation[e].name,animationName:r.animation[e].animation_name,startTime:r.animation[e].start_time,endTime:r.animation[e].end_time,uid:r.animation[e].uid})}else{for(let e=0;e<r.animation.length;e++)(r.animation[e].defaultAnimation||r.animation[e].isActive)&&(l.push({idle:r.animation[e].uid,loop:r.animation[e].uid,uid:r.animation[e].uid,changed:!1,reset:!0,count:0}),s=r.animation[e].animationName);for(let e=0;e<r.animation.length;e++)l.push({name:r.animation[e].name,animationName:r.animation[e].animationName,startTime:r.animation[e].startTime,endTime:r.animation[e].endTime,uid:r.animation[e].uid})}}else{for(let e=0;e<r.animation.length;e++)(r.animation[e].is_default||r.animation[e].is_active)&&(l.push({idle:r.animation[e].uid,loop:r.animation[e].uid,uid:r.animation[e].uid,changed:!1,reset:!0,count:0}),s=r.animation[e].animation_name);for(let e=0;e<r.animation.length;e++)l.push({name:r.animation[e].name,animationName:r.animation[e].animation_name,startTime:r.animation[e].start_time,endTime:r.animation[e].end_time,uid:r.animation[e].uid})}let u=document.createElement("a-entity");if(!r.res_url)return;if(u.setAttribute("gltf-model","#"+r.obj_id+"_"+r.res_id),r.animation&&u.setAttribute("animation-mixer","clip: "+s),r.behav?u.setAttribute("class","clickable"):u.setAttribute("class","unclickable"),u.setAttribute("id",r.obj_id),u.setAttribute("crossorigin","anonymous"),u.setAttribute("shadow",""),r.model_shift){let e=(new THREE.Vector3).fromArray(r.model_shift.split(",").map((function(e){return Number(e)})));e.multiply(o),n.add(e)}if(e.setTransform(u,n,i,o),e.makarObjects.push(u),u.addEventListener("model-loaded",(function(t){if(t.target==t.currentTarget){let i=e.vrScene.renderer.capabilities.getMaxAnisotropy();if(t.detail.model.traverse((e=>{!0===e.isMesh&&null!==e.material.map&&(e.material.map.anisotropy=i,e.material.map.needsUpdate=!0)})),u.object3D){u.object3D.makarObject=!0,r.behav&&(u.object3D.behav=r.behav,e.setObjectBehavAll(r)),r.behav_reference&&(u.object3D.behav_reference=r.behav_reference);let i=u.getObject3D("mesh"),o=-1;if(r.material)for(let t=0;t<r.material.length;t++){i.ModelJson&&(o=e.checkGLTFMaterialIndex(u,r.material[t]));let a=r.material[t].color.split(","),s=new THREE.Color(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]));switch(i.traverse((e=>{e.type&&"string"==typeof e.type&&e.type.toLowerCase().includes("light")&&(e.visible=!1)})),r.material[t].shader){case"Unlit/Color":i.traverse((e=>{if(e.isMesh){let t=e.material.name.split("_");t[t.length-1]==o&&(e.material=new THREE.MeshBasicMaterial({color:s,name:e.material.name,skinning:e.material.skinning}))}}));break;case"Standard":var n=u.sceneEl.renderer;i.traverse((i=>{if(i.material){let l=i.material.name.split("_");l[l.length-1]==o&&(i.material=new THREE.MeshStandardMaterial({name:i.material.name,skinning:i.material.skinning,map:i.material.map,emissive:i.material.emissive,emissiveMap:i.material.emissiveMap,normalMap:i.material.normalMap}),i.material.color=s,i.material.metalness=r.material[t].metallic,i.material.roughness=1-r.material[t].smoothness,i.material.envMap=e.cubeTex.texture,i.material.envMapIntensity=1,i.material.needsUpdate=!0,i.material.reflectivity=0,i.material.side=THREE.DoubleSide,i.material.transparent=!0,i.material.map&&(THREE.GammaEncoding&&(i.material.map.encoding=THREE.GammaEncoding),i.material.map.needsUpdate=!0),0==r.material[t].mode?(i.material.opacity=1,n.setClearAlpha(1),i.material.blending=THREE.CustomBlending,i.material.blendEquation=THREE.AddEquation,i.material.blendSrc=THREE.OneFactor,i.material.blendDst=THREE.ZeroFactor,i.material.blendSrcAlpha=THREE.ZeroFactor,i.material.blendDstAlpha=THREE.OneFactor):1==r.material[t].mode?(i.material.opacity=1,i.material.alphaTest=r.material[t].cut_off,n.setClearAlpha(1),i.material.blending=THREE.CustomBlending,i.material.blendEquation=THREE.AddEquation,i.material.blendSrc=THREE.OneFactor,i.material.blendDst=THREE.ZeroFactor,i.material.blendSrcAlpha=THREE.ZeroFactor,i.material.blendDstAlpha=THREE.OneFactor,i.customDepthMaterial=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking,skinning:!0,map:i.material.map,alphaTest:r.material[t].cut_off})):2==r.material[t].mode?(i.material.opacity=parseFloat(a[3]),i.material.depthWrite=!1,i.renderOrder=1,i.customDepthMaterial=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking,skinning:!0,map:i.material.map,alphaTest:r.material[t].cut_off})):3==r.material[t].mode&&(i.material.opacity=Math.max(parseFloat(a[3]),r.material[t].metallic),i.material.depthWrite=!1,i.material.blending=THREE.CustomBlending,i.material.blendEquation=THREE.AddEquation,i.material.blendSrc=THREE.OneFactor,i.material.blendDst=THREE.OneMinusSrcAlphaFactor,i.material.blendSrcAlpha=THREE.OneFactor,i.material.blendDstAlpha=THREE.OneMinusSrcAlphaFactor,i.renderOrder=1,i.customDepthMaterial=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking,skinning:!0,map:i.material.map,alphaTest:r.material[t].cut_off})))}}));break;case"Unlit/Transparent":i.traverse((e=>{if(e.material){let t=e.material.name.split("_");t[t.length-1]==o&&(e.material.opacity=1,e.material.depthWrite=!1,e.renderOrder=1)}}));break;case"Unlit/Transparent Cutout":i.traverse((e=>{if(e.material){let t=e.material.name.split("_");t[t.length-1]==o&&(e.material.opacity=1,e.material.alphaTest=.5)}}));break;case"Unlit/Texture":i.traverse((e=>{if(e.material){let t=e.material.name.split("_");t[t.length-1]==o&&(e.material=new THREE.MeshBasicMaterial({color:new THREE.Color(1,1,1),name:e.material.name,skinning:e.material.skinning,map:e.material.map}),e.material.map&&(e.material.map.encoding=THREE.GammaEncoding,e.material.map.needsUpdate=!0),e.material.needsUpdate=!0)}}));break;case"Unlit/ScreenCutoutShader":i.traverse((t=>{if(t.material){let r=t.material.name.split("_");r[r.length-1]==o&&(e.needsRenderTarget=!0,t.material.onBeforeCompile=function(t){t.uniforms.tEquirect={value:e.skyRenderTarget.texture},t.vertexShader="varying vec4 vProjection;\n"+t.vertexShader,t.vertexShader=t.vertexShader.replace("#include <worldpos_vertex>",["#include <worldpos_vertex>","\tvProjection = projectionMatrix * mvPosition;"].join("\n")),t.fragmentShader="uniform sampler2D tEquirect;\nvarying vec4 vProjection;\n"+t.fragmentShader,t.fragmentShader=t.fragmentShader.replace("#include <dithering_fragment>",["#include <dithering_fragment>","\tvec2 sampleUV;","\tsampleUV.x = vProjection.x/vProjection.w*0.5 + 0.5;","\tsampleUV.y = vProjection.y/vProjection.w*0.5 + 0.5;","\tgl_FragColor = texture2D(tEquirect, sampleUV);"].join("\n"))})}}));break;case"Blocks/Basic":break;case"Blocks/BlocksGem":i.traverse((e=>{if(e.material){let t=e.material.name.split("_");t[t.length-1]==o&&(e.material.depthWrite=!1,e.renderOrder=1)}}));break;case"Blocks/BlocksGlass":i.traverse((e=>{if(e.material){let t=e.material.name.split("_");t[t.length-1]==o&&(e.material.depthWrite=!1,e.renderOrder=1)}}));break;default:console.log(`The shader of no. ${t} material is not supported currently.`)}}Array.isArray(t.detail.model.animations)&&t.detail.model.animations.length>0&&!u.getAttribute("animation-mixer")&&(console.log("VRFunc.js: loadGFLTFModel: the model with animation but no animation-mixer, probabily older version of editor ",t.detail.model),u.setAttribute("animation-mixer","clip: "+t.detail.model.animations[0].name),(l=[]).push({changed:!1,idle:"mifly168",uid:"mifly168"}),l.push({animationName:t.detail.model.animations[0].name,name:t.detail.model.animations[0].name,endTime:t.detail.model.animations[0].duration,startTime:0,uid:"mifly168"})),t.detail.model.animationSlices=l,a(u)}}})),0==r.active&&(u.setAttribute("visible",!1),u.setAttribute("class","unclickable")),r.behav_reference)for(let e=0;e<r.behav_reference.length;e++)if("ShowModel"==r.behav_reference[e].behav_name){u.setAttribute("visible",!1),u.setAttribute("class","unclickable");break}if(r.obj_parent_id){let e=setInterval((function(){let t=document.getElementById(r.obj_parent_id);t&&t.object3D.children.length>0&&(t.appendChild(u),window.clearInterval(e))}),1)}else e.vrScene.appendChild(u)}else console.log("VRFunc.js: _loadGLTFModel , obj url not exist ",r),r.main_type="model",r.sub_type="glb",r.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb",e.loadGLTFModel(r,n,i,o,e.cubeTex),a(1)}))}))},this.loadFBXModel=function(t,r,n,i){let o=document.createElement("a-entity");if(t.res_url_fbx){if(o.setAttribute("fbx-model","src:"+t.res_url_fbx),o.setAttribute("animation-mixer",""),t.behav?o.setAttribute("class","clickable"):o.setAttribute("class","unclickable"),o.setAttribute("id",t.obj_id),e.setTransform(o,r,n,i),e.makarObjects.push(o),t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){o.setAttribute("visible",!1),o.setAttribute("class","unclickable");break}if(t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(o),window.clearInterval(e))}),1)}else e.vrScene.appendChild(o);o.addEventListener("model-loaded",(function(e){e.target==e.currentTarget&&(o.object3D.makarObject=!0,t.behav&&(o.object3D.behav=t.behav))}))}},this.loadAudio=function(r,n,i,o){return console.log("VRFunc.js: _loadAudio , obj=",r),new Promise((function(a){t(r.res_url,(function(t){if(1==t){let t=document.getElementById("makarAssets"),n=document.createElement("audio");n.setAttribute("id",r.obj_id+"_"+r.res_id),n.setAttribute("src",r.res_url),n.setAttribute("crossorigin","anonymous"),n.setAttribute("loop",!0),n.setAttribute("preload","auto"),t.appendChild(n),n.onloadedmetadata=function(){let t=document.createElement("a-sound");t.setAttribute("sound","src: #"+r.obj_id+"_"+r.res_id+"; autoplay: true; loop: true; volume: 1; positional: false"),t.setAttribute("id",r.obj_id),t.setAttribute("sound","autoplay: false"),e.makarObjects.push(t),0==r.active&&(t.setAttribute("sound","loop: false"),t.setAttribute("visible",!1),t.setAttribute("class","unclickable"));let n=!1;if(r.behav_reference){for(let e=0;e<r.behav_reference.length;e++)if("PlayMusic"==r.behav_reference[e].behav_name){n=!0,t.setAttribute("sound","loop: false"),t.setAttribute("visible",!1),t.setAttribute("class","unclickable");break}}else t.setAttribute("visible",!0);if(r.obj_parent_id){let e=setInterval((function(){let i=document.getElementById(r.obj_parent_id);i&&i.object3D.children.length>0&&(i.appendChild(t),window.clearInterval(e),i.addEventListener("child-attached",(function(e){if(console.log("VRFunc.js: VRController: _loadAudio,: parent child-attached, el=",e),r.blockly)t.blockly=r.blockly,t.setAttribute("sound","autoplay: false");else{let e=!0;t.object3D.traverseAncestors((function(r){if("Scene"!=r.type)console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: not Scene parent=",r),0==r.visible&&(e=!1);else if(1==e&&1==t.object3D.visible&&0==n)if(console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: all parent visible true=",t.object3D),1==window.Browser.mobile&&"safari"==window.Browser.name&&1!=window.allowAudioClicked||1!=window.allowAudioClicked&&location==r.location){t.setAttribute("sound","autoplay: false");let e=document.getElementById("clickToPlayAudio");e.style.display="block",e.addEventListener("click",(function r(){t.components.sound.playSound(),e.style.display="none",e.removeEventListener("click",r),window.allowAudioClicked=!0}))}else t.setAttribute("sound","autoplay: true");else console.log("2 VRFunc.js: VRController: _loadAudio,: traverseAncestors: not all parent visible true=",t.object3D.children[0]),t.setAttribute("sound","autoplay: false")}))}})))}),1)}else{if(console.log("VRFunc.js: _loadAudio: no parent set autoplay true",t.object3D,location),r.blockly)t.blockly=r.blockly,t.setAttribute("sound","autoplay: false");else if(1==window.Browser.mobile&&"safari"==window.Browser.name&&1!=window.allowAudioClicked||1!=window.allowAudioClicked&&location==parent.location){t.setAttribute("sound","autoplay: false");let e=document.getElementById("clickToPlayAudio");e.style.display="block",e.addEventListener("click",(function r(){t.components.sound.playSound(),e.style.display="none",e.removeEventListener("click",r),window.allowAudioClicked=!0}))}else t.setAttribute("sound","autoplay: true");e.vrScene.appendChild(t)}t.addEventListener("loaded",(function(n){n.target==n.currentTarget&&(console.log("3 VRFunc.js: VRController: _loadAudio,: loaded, soundEntity.object3D.children[0]=",t.object3D.children[0]),t.object3D.makarObject=!0,r.behav&&(t.object3D.behav=r.behav,e.setObjectBehavAll(r)),r.behav_reference&&(t.object3D.behav_reference=r.behav_reference),a(t))}))}}else console.log("VRFunc.js: _loadAudio , obj url not exist ",r),r.main_type="model",r.sub_type="glb",r.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb",e.loadGLTFModel(r,n,i,o,e.cubeTex),a(1)}))}))},this.loadVideo=function(r,n,i,o){return new Promise((function(a){t(r.res_url,(function(t){if(1==t){let t=document.getElementById("makarAssets");var s;(s=document.createElement("video")).src=r.res_url,s.playsInline=!0,s.autoplay=!1,s.loop=!0,s.setAttribute("crossorigin","anonymous"),s.setAttribute("id",r.obj_id+"_"+r.res_id+"_"+e.loadSceneCount),t.appendChild(s),window.Browser&&(null==window.Browser.name||"safari"==window.Browser.name||1!=window.allowAudioClicked&&location==parent.location)&&(s.muted=!0),s.onloadedmetadata=function(){var t,l;s.videoWidth>=s.videoHeight?(t=1,l=1*s.videoHeight/s.videoWidth):(t=1*s.videoWidth/s.videoHeight,l=1);let c=document.createElement("a-video"),u=!1;if(r.behav)for(let e=0;e<r.behav.length;e++)"TransparentVideo"==r.behav[e].simple_behav&&(u=!0,chromaKey=r.behav[e].chromakey,slope=r.behav[e].slope,threshold=r.behav[e].threshold,transparentBehav=r.behav[e]);if(u){let e=chromaKey.split(",");var d=new THREE.Color(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));if("RGB"!=transparentBehav.mode&&transparentBehav.mode){if("HSV"==transparentBehav.mode){let e=transparentBehav.HSV.split(","),t=parseFloat(e[0]),r=parseFloat(e[1]),n=parseFloat(e[2]);c.setAttribute("material","shader: HSVMatting; transparent: true; _keyingColorH:"+t+"; _keyingColorS:"+r+"; _keyingColorV:"+n+"; _deltaH:"+transparentBehav.hue+"; _deltaS:"+transparentBehav.saturation+"; _deltaV:"+transparentBehav.brightness+";")}}else c.setAttribute("material","shader: chromaKey; color: #"+d.getHexString()+";transparent: true; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";")}else c.setAttribute("material","side:double; opacity: 1.0; transparent: true; ");r.behav?1==r.behav.length&&u?c.setAttribute("class","unclickable"):c.setAttribute("class","clickable"):c.setAttribute("class","unclickable"),c.setAttribute("id",r.obj_id),c.setAttribute("src","#"+r.obj_id+"_"+r.res_id+"_"+e.loadSceneCount),c.mp4Video=s;let h=e.vrScene.renderer.capabilities.getMaxAnisotropy();c.addEventListener("materialtextureloaded",(function(e){console.log("VRFunc.js: _loadVideo: _materialtextureloaded: videoPlane = ",c.object3D,e),e.detail.texture.anisotropy=h,e.detail.texture.needsUpdate=!0})),e.setTransform(c,n,i,o),c.addEventListener("loaded",(function(n){if(n.target==n.currentTarget){c.object3D.children[0].scale.set(t,l,1);let n=new THREE.Vector3;n.set(0,Math.PI,0),c.object3D.children[0].rotation.setFromVector3(n),c.object3D.makarObject=!0,r.behav&&(c.object3D.behav=r.behav,e.setObjectBehavAll(r)),r.behav_reference&&(c.object3D.behav_reference=r.behav_reference),a(c)}})),e.makarObjects.push(c),0==r.active&&(c.setAttribute("visible",!1),c.setAttribute("class","unclickable"));let p=!1;if(r.behav_reference)for(let e=0;e<r.behav_reference.length;e++)if("ShowVideo"==r.behav_reference[e].behav_name){p=!0,c.setAttribute("visible",!1),c.setAttribute("class","unclickable");break}if(r.obj_parent_id){s.autoplay=!1;let t=setInterval((function(){let n=document.getElementById(r.obj_parent_id);n&&n.object3D.children.length>0&&(n.appendChild(c),window.clearInterval(t),n.addEventListener("child-attached",(function(t){if(console.log("VRFunc.js: VRController: _loadVideo,: parent child-attached, el=",t),r.blockly)c.blockly=r.blockly,s.pause(),s.currentTime=0;else{let t=!0;c.object3D.traverseAncestors((function(r){"Scene"!=r.type?0==r.visible&&(t=!1):1==t&&1==c.object3D.visible&&0==p?(console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: all parent visible true=",c.object3D,p),s.autoplay=!0,s.play(),window.Browser&&(null==window.Browser.name||"safari"==window.Browser.name||1!=window.allowAudioClicked&&location==r.location)&&e.dealVideoMuted(s)):(console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not all parent visible true=",t,c.object3D.visible,p),s.muted=!1,s.autoplay=!1,s.pause(),s.currentTime=0)}))}})))}),1)}else r.blockly?(c.blockly=r.blockly,s.pause(),s.currentTime=0):(s.autoplay=!0,s.play(),window.Browser&&(null==window.Browser.name||"safari"==window.Browser.name||1!=window.allowAudioClicked&&location==parent.location)&&e.dealVideoMuted(s)),e.vrScene.appendChild(c)}}else console.log("VRFunc.js: _loadVideo , obj url not exist ",r),r.main_type="model",r.sub_type="glb",r.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb",e.loadGLTFModel(r,n,i,o,e.cubeTex),audioResolve(1)}))}))},this.loadLight=function(t,r,n,i){return new Promise((function(o){let a=document.createElement("a-entity");a.setAttribute("id",t.obj_id),attr="type:"+t.light.light_type;let s=t.light.color.split(","),l=new THREE.Color(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]));if(attr+="; color:#"+l.getHexString(),attr+=";intensity:"+t.light.intensity,"point"!=t.light.light_type&&"spot"!=t.light.light_type||(attr+=";distance:"+t.light.range,attr+=";decay: 4"),"spot"==t.light.light_type&&(attr+=";angle:"+(parseFloat(t.light.spotAngle)/2).toString(),attr+=";penumbra: 0.2"),"None"!=t.light.shadow&&(a.setAttribute("castShadow",!0),attr+=";castShadow: true ;shadowCameraVisible: false; shadowBias:-0.0005; shadowCameraTop:10; shadowCameraBottom:-10; shadowCameraRight:10; shadowCameraLeft:-10; shadowMapHeight:1024; shadowMapWidth:1024; shadowCameraFar: 500; shadowCameraNear: 0.5"),a.setAttribute("light",attr),"directional"==t.light.light_type){let e=new THREE.Vector3(0,0,-100),r=new THREE.Euler,n=t.quaternionRotation.split(","),i=new THREE.Quaternion(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]),parseFloat(n[0]));r.setFromQuaternion(i),r.y=-r.y,r.z=-r.z,e.applyEuler(r),a.setAttribute("position",e),a.setAttribute("castShadow",!1),a.setAttribute("light","castShadow: false; ")}else n.add(new THREE.Vector3(180,0,0)),e.setTransform(a,r,n,i);if(0==t.active&&a.setAttribute("visible",!1),console.log("VRFunc.js: _loadLight: Light=",a),e.makarObjects.push(a),t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(a),window.clearInterval(e))}),1)}else e.vrScene.appendChild(a);o(a)}))},this.loadQuiz=function(t,n,i,o){let a=document.createElement("a-entity");a.setAttribute("id",t.obj_id),e.makarObjects.push(a),console.log("VRFunc.js: _loadQuiz: Quiz=",a.object3D),a.addEventListener("loaded",(function(){let e=new THREE.Object3D;a.object3D.add(e)}));let s=[];for(let e=0;e<t.module[0].question_list.length;e++)t.module[0].question_list[e].allowRandom&&s.push(e);let l=0;for(let e=0;e<t.module[0].display_order_list.length;e++){let r=t.module[0].display_order_list[e].index;if(-1==r){let n=(c=s.length,Math.floor(Math.random()*Math.floor(c))),i=s[n];t.module[0].display_order_list[e].index=i,r=i,s.splice(n,1)}t.module[0].question_list[r].active_score&&(l+=1)}var c;let u=t.module[0].display_order_list[0].index,d=t.module[0].question_list[u],h=-1;if("Total"==t.module[0].timer_type){h=t.module[0].total_time,document.getElementById("timerDiv").style.display="block";let e=Math.floor(h/3600),r=Math.floor((h-3600*e)/60),n=h-3600*e-60*r;timerContent.textContent=e.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")}else if("Custom"==t.module[0].timer_type){h=d.time_limit,document.getElementById("timerDiv").style.display="block";let e=Math.floor(h/3600),t=Math.floor((h-3600*e)/60),r=h-3600*e-60*t;timerContent.textContent=e.toString().padStart(2,"0")+":"+t.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")}let p=document.getElementById("tipButtonDiv");d.show_tips?(p.style.display="block",p.addEventListener("click",(function(){let e=document.getElementById("tipDiv"),t=document.getElementById("tipConfirmButton"),r=document.getElementById("tipContent");e.style.display="block",r.textContent=d.tips_content,t.addEventListener("click",(function(){e.style.display="none"}))}))):p.style.display="none",e.module={json:t.module[0],quizEntity:a,currentIndex:0,score:0,choices:[],correctAnswer:0,totalActiveScoreQuestion:l,record:new Array(t.module[0].question_list.length),timer:{currentTimer:null,counter:h},record_time:0,qClock:Date.now()};let f=document.getElementById("scoreDiv");if(f.addEventListener("click",(function(){f.style.display="none",vrController.nextQuestion()})),console.log("VRFunc.js: _loadQuiz: _first_question=",d),d.questions_json&&Array.isArray(d.questions_json))for(let t=0;t<d.questions_json.length;t++){let r=(new THREE.Vector3).fromArray(d.questions_json[t].transform[0].split(",").map((function(e){return Number(e)}))),n=(new THREE.Vector3).fromArray(d.questions_json[t].transform[1].split(",").map((function(e){return Number(e)}))),i=(new THREE.Vector3).fromArray(d.questions_json[t].transform[2].split(",").map((function(e){return Number(e)})));switch(d.questions_json[t].main_type){case"text":e.loadText(d.questions_json[t],r,n,i);break;case"image":e.loadTexture(d.questions_json[t],r,n,i);break;case"video":e.loadVideo(d.questions_json[t],r,n,i);break;case"model":e.loadGLTFModel(d.questions_json[t],r,n,i,e.cubeTex);break;case"audio":e.loadAudio(d.questions_json[t],r,n,i)}}if(d.options_json)for(let t=0;t<d.options_json.length;t++){let n,i,o=(new THREE.Vector3).fromArray(d.options_json[t].transform[0].split(",").map((function(e){return Number(e)}))),a=(new THREE.Vector3).fromArray(d.options_json[t].transform[1].split(",").map((function(e){return Number(e)}))),s=(new THREE.Vector3).fromArray(d.options_json[t].transform[2].split(",").map((function(e){return Number(e)}))),l=d.options_json[t].sub_type;switch(console.log("VRFunc.js: _loadQuiz: _loadOption: ",t,l,d.options_json[t]),l){case"txt":i=e.loadText(d.options_json[t],o,a,s);break;case"gif":i=e.loadTexture(d.options_json[t],o,a,s);break;case"jpg":case"jpeg":case"png":i=e.loadTexture(d.options_json[t],o,a,s);break;case"button":d.options_json[t].res_url="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png",i=e.loadTexture(d.options_json[t],o,a,s)}if("button"!=l&&("MutiOption_Text"==d.option_type||"MutiOption_Image"==d.option_type)){if(0==r(i))continue;i.then((function(t){if(n=t,"MutiOption_Text"==d.option_type){console.log(" *** loaded: ",n.object3D);let e=new THREE.Vector3(0,0,0),t=(new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1)),r=document.createElement("a-plane");r.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),r.setAttribute("id","circle_base"),r.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false"),n.appendChild(r);let i=document.createElement("a-plane");i.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png"),i.setAttribute("id","circle_out"),i.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false"),n.appendChild(i);let o=document.createElement("a-plane");o.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),o.setAttribute("id","circle_in"),o.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false"),o.setAttribute("visible",!1),n.appendChild(o);let a=2*Math.abs(n.getObject3D("mesh").geometry.attributes.position.array[0]);e.x=e.x+.5*a+.3/n.object3D.parent.el.getAttribute("scale").x,e.z=e.z-.01,r.setAttribute("position",e.clone().multiply(new THREE.Vector3(-1,1,1))),i.setAttribute("position",e.clone().multiply(new THREE.Vector3(-1,1,1))),o.setAttribute("position",e.clone().multiply(new THREE.Vector3(-1,1,1))),t.multiply(new THREE.Vector3(.4,.4,.4)),t.divide(n.object3D.parent.el.getAttribute("scale")),r.setAttribute("scale",t),i.setAttribute("scale",t),o.setAttribute("scale",t.clone().multiply(new THREE.Vector3(.7,.7,.7)));let s=function(e){e.target==e.currentTarget&&e.target.object3D&&e.target.object3D.children[0]&&(e.target.object3D.children[0].renderOrder=1)};r.addEventListener("loaded",s),i.addEventListener("loaded",s),o.addEventListener("loaded",s)}else{let t=new THREE.Vector3(0,0,0),r=new THREE.Vector3(0,0,0),i=new THREE.Vector3(1,1,1),o=setInterval((function(){if(n.getAttribute("heightForQuiz")){let a=n.getAttribute("heightForQuiz");i.multiply(new THREE.Vector3(.4,.4,.4)),i.divide(n.getAttribute("scale")),t.y=t.y-a/2-.3/n.getAttribute("scale").y;let s=document.createElement("a-plane");s.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),s.setAttribute("id","circle_base"),s.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false"),e.setTransform(s,t,r,i),n.appendChild(s);let l=document.createElement("a-plane");l.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png"),l.setAttribute("id","circle_out"),l.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false"),e.setTransform(l,t,r,i),n.appendChild(l);let c=document.createElement("a-plane");c.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),c.setAttribute("id","circle_in"),c.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false"),c.setAttribute("visible",!1),i.multiply(new THREE.Vector3(.7,.7,.7)),e.setTransform(c,t,r,i),n.appendChild(c);let u=function(e){e.target==e.currentTarget&&e.target.object3D&&e.target.object3D.children[0]&&(e.target.object3D.children[0].renderOrder=1)};s.addEventListener("loaded",u),l.addEventListener("loaded",u),c.addEventListener("loaded",u),window.clearInterval(o)}}),1)}}))}}if(e.module.timer.counter>=0){e.module.qClock=Date.now();let r=setInterval((function(){e.module.timer.currentTimer=r,e.module.timer.counter-=1;let n=Math.floor(e.module.timer.counter/3600),i=Math.floor((e.module.timer.counter-3600*n)/60),o=e.module.timer.counter-3600*n-60*i;if(timerContent.textContent=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0"),0==e.module.timer.counter)if(window.clearInterval(e.module.timer.currentTimer),"Custom"==t.module[0].timer_type)if(d.show_score){let t=document.getElementById("scoreDiv"),r=document.getElementById("score");t.style.display="block",r.textContent=e.module.score}else vrController.nextQuestion();else{let t=[],r=e.module.quizEntity;for(let e of r.children)t.push(e);t.forEach((function(t){for(let r=0;r<e.makarObjects.length;r++)if(e.makarObjects[r].id==t.id){let t=e.makarObjects[r];if(t.getAttribute("src")){let e=t.getAttribute("src").split("#")[1];document.getElementById(e)&&document.getElementById(e).remove()}t.remove(),e.makarObjects.splice(r,1)}}));let n=document.getElementById("tipButtonDiv"),i=document.getElementById("tipDiv");n.style.display="none",i.style.display="none";let o=document.getElementById("startQuiz"),a=document.getElementById("QuizStartButton"),s=document.getElementById("QuizStartContent");o.style.display="block",s.textContent="";let l={question:u,get_score:0,answer_time:e.module.json.question_list[u].time_limit,answer_options:[],answer_cloze:"",answer_is_enable:!1,answer_is:!1};e.module.record[u]=l,e.module.record_time+=e.module.json.question_list[u].time_limit,e.module.qClock=Date.now(),a.addEventListener("click",(function(){o.style.display="none",vrController.nextQuestion()}))}}),1e3)}e.setTransform(a,n,i,o),e.vrScene.appendChild(a)},this.setTransform=function(e,t,r,n){let i=t.clone();i.multiply(new THREE.Vector3(-1,1,1)),e.setAttribute("position",i);let o=r.clone();o.multiply(new THREE.Vector3(1,-1,-1)),e.setAttribute("rotation",o),e.setAttribute("scale",n)},this.checkAnimation=function(e,t){e.mixer&&e.mixer.update(t),e.animationSlices&&e.animationSlices[0].index&&e.animationSlices[e.animationSlices[0].index]&&(e.mixer._actions[0].time>e.animationSlices[e.animationSlices[0].index].timeEnd||e.mixer._actions[0].time<e.animationSlices[e.animationSlices[0].index].timeStart)&&(e.mixer._actions[0].time=e.animationSlices[e.animationSlices[0].index].timeStart)},this.showObjectEvent=function(t,r){if(t)if(t.getAttribute("visible")){if(t.setAttribute("visible",!1),t.setAttribute("class","unclickable"),"a-video"==t.localName){let e=t.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&t.pause()}}window.Browser&&(null!=window.Browser.name&&"safari"!=window.Browser.name||e.UnMutedAndPlayAllVisibleVideo()),t.object3D.traverse((function(e){if("Group"==e.type){if(e.el.setAttribute("class","unclickable"),"a-video"==e.el.localName)if(e.el.blockly)console.log("VRFunc.js: _showObjectEvent: set false, video blockly: do nothing ",e);else{let t=e.el.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.pause()}}if(e.makarObject&&e.el.getAttribute("sound"))if(e.el.blockly)console.log("VRFunc.js: _showObjectEvent: set false, audio blockly: do nothing ",e);else{e.behav_reference&&e.el.setAttribute("visible",!1);for(let t in e.children)"Audio"==e.children[t].children[0].type&&1==e.children[t].children[0].isPlaying&&e.el.components.sound.stopSound()}}})),r&&t.object3D.traverse((function(e){"Group"==e.type&&(e.el.setAttribute("visible",!1),e.el.setAttribute("class","unclickable"))}))}else{window.Browser&&(null!=window.Browser.name&&"safari"!=window.Browser.name||e.UnMutedAndPlayAllVisibleVideo(t)),t.setAttribute("visible",!0);let r=t.getAttribute("src");if(null!=r){r=r.split("#").pop();let e=document.getElementById(r);e instanceof HTMLElement&&e.play()}t.object3D.behav&&t.setAttribute("class","clickable"),t.object3D.traverse((function(e){if("Group"==e.type&&e.el.getAttribute("visible")){if(e.el.object3D.behav&&e.el.setAttribute("class","clickable"),"a-video"==e.el.localName)if(e.el.blockly)console.log("VRFunc.js: _showObjectEvent: set true, video blockly: do nothing  ",e);else{let t=e.el.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.play()}}e.makarObject&&e.el.getAttribute("sound")&&(e.el.blockly?console.log("VRFunc.js: _showObjectEvent: set true, audio blockly: do nothing ",e):e.el.components.sound.playSound())}}))}else console.log("VRFunc.js: _showObjectEvent: target not exist",t)},this.hideGroupObjectEvent=function(e){e?e.getAttribute("visible")&&(e.setAttribute("visible",!1),e.setAttribute("class","unclickable"),e.object3D.traverse((function(e){if("Group"==e.type){if(e.el.setAttribute("class","unclickable"),"a-video"==e.el.localName){let t=e.el.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.pause()}}if(e.makarObject&&e.el.getAttribute("sound")){e.behav_reference&&e.el.setAttribute("visible",!1);for(let t in e.children)"Audio"==e.children[t].children[0].type&&1==e.children[t].children[0].isPlaying&&e.el.components.sound.stopSound()}}}))):console.log("VRFunc.js: _hideGroupObjectEvent: target not exist ",e)},this.clearBehavs=function(){let e=this;for(let t in e.groupDict)Array.isArray(e.groupDict[t].objs)&&(e.groupDict[t].objs.length=0);e.lookAtObjectList.length=0,e.lookAtObjectList=[];for(let t in e.lookAtTimelineDict)"function"==typeof e.lookAtTimelineDict[t].pause&&"function"==typeof e.lookAtTimelineDict[t].kill&&(e.lookAtTimelineDict[t].pause(),e.lookAtTimelineDict[t].kill());e.lookAtTimelineDict={}},this.checkVRSceneResultBehav=function(){let e=this;if(!Number.isFinite(Number(e.projectIdx)))return void console.error(" _checkVRSceneResultBehav: projectIdx error ",e.projectIdx);if(!Array.isArray(VRSceneResult)||!VRSceneResult[e.projectIdx]||!Number.isInteger(Number(e.sceneIndex)))return void console.error(" _checkVRSceneResultBehav: _VRSceneResult error ",e.projectIdx,e.sceneIndex,VRSceneResult);if(!e.VRSceneResult[e.projectIdx].editor_ver||"string"!=typeof e.VRSceneResult[e.projectIdx].editor_ver)return void console.error(" _checkVRSceneResultBehav: editor_ver error ",e.VRSceneResult[e.projectIdx]);let t=e.VRSceneResult[e.projectIdx].editor_ver.split("."),r=e.editorVersionControllObjs(t,e.projectIdx,e.sceneIndex);if(console.log("_checkVRSceneResultBehav: _scene_objs ",r),!Array.isArray(r))return;let n={},i={};for(let e=0,t=r.length;e<t;e++){let t=r[e];t.behav&&(n[t.obj_id]=t.behav),t.behav_reference&&delete t.behav_reference,t.obj_id&&(i[t.obj_id]=t)}for(let e in n){let t=n[e];for(let e=0,r=t.length;e<r;e++){let r=t[e];if(r.simple_behav,r.obj_id){let e=i[r.obj_id];e&&Array.isArray(e.behav_reference)?e.behav_reference.push({behav_name:r.simple_behav,target_id:r.obj_id}):e?e.behav_reference=[{behav_name:r.simple_behav,target_id:r.obj_id}]:console.error("_checkVRSceneResultBehav: cant get _behavObj ",r)}}}},this.calcSceneArea=function(){let e=this,t={},r=0,n=0,i=0,o=0;for(let a=0,s=e.makarObjects.length;a<s;a++){let s=e.makarObjects[a].object3D;if(s&&s.el&&s.el.id){let e=[];s.traverse((function(t){if(t.isMesh&&t.geometry){let a=new THREE.Box3;t.geometry.computeBoundingBox(),a.copy(t.geometry.boundingBox).applyMatrix4(t.matrixWorld),a.max.z==a.min.z&&(a.max.z+=.01),a.max.x>r&&(r=a.max.x),a.min.x<n&&(n=a.min.x),a.max.z>i&&(i=a.max.z),a.min.z<o&&(o=a.min.z);let s=new THREE.Box3Helper(a,5678547);e.push(s)}})),t[s.el.id]=e}}e.objList=t;let a=new THREE.Vector2(r,i),s=new THREE.Vector2(n,o);if(e.areaMax=a,e.areaMin=s,publishVRProjs&&Array.isArray(publishVRProjs.result)&&Number.isFinite(e.projectIdx))if("string"==typeof publishVRProjs.result[e.projectIdx].proj_descr&&1==publishVRProjs.result[e.projectIdx].proj_descr.includes("_walking")){console.log(" _calcSceneArea: walking project ",e.projectIdx,publishVRProjs.result[e.projectIdx]);let t=document.getElementById("__ground");if(t){let e=2*(r-n),a=2*(i-o),s=new THREE.Vector2((r+n)/2,(i+o)/2);t.setAttribute("geometry","width:"+e+"; height:"+a+";"),t.setAttribute("position",{x:s.x,y:.1,z:s.y}),console.log(" _calcSceneArea: gwdc ",e,a,s)}}else console.log(" _calcSceneArea: not walking project ",e.projectIdx,publishVRProjs.result[e.projectIdx]);else console.log(" _calcSceneArea: _publishVRProjs error ",e.projectIdx,publishVRProjs)},this.setupSceneBehav=function(){let e=this;for(let t=0,r=e.makarObjects.length;t<r;t++){let r=e.makarObjects[t].object3D;r?(r.behav,r.behav_reference):console.error(" _setupSceneBehav: 3d obj error",t,e.makarObjects[t])}for(let t=0,r=e.lookAtObjectList.length;t<r;t++){let r=e.lookAtObjectList[t],n=r.lookObjId,i=document.getElementById(n),o=r.lookBehav,a=o.obj_id,s=(o.reverse,document.getElementById(a));i&&i.object3D&&s&&s.object3D?e.addLookAtTimeLine(i,s,r):console.log("_setupSceneBehav: _lookAt error, obj not exist",i,s)}},this.addLookAtTimeLine=function(e,t,r){console.log(" _addLookAtTimeLine: ",r);let n=new THREE.Vector3;t.object3D.getWorldPosition(n);let i=gsap.timeline();this.lookAtTimelineDict[r.lookObjId]=i,i.to(e.object3D,{duration:1100,delay:0,ease:"none",repeat:-1,onUpdate:function(){t.object3D.getWorldPosition(n),e.object3D.lookAt(n),r.lookBehav&&0==r.lookBehav.reverse&&e.object3D.rotateOnAxis(new THREE.Vector3(0,1,0),Math.PI)}})},this.setObjectBehavAll=function(e){let t=this;for(let r=0,n=e.behav.length;r<n;r++)if(""!=e.behav[r].group&&t.groupDict[e.behav[r].group]&&t.groupDict[e.behav[r].group].objs.push({behav:e.behav[r]}),"LookAt"==e.behav[r].simple_behav&&e.behav[r].obj_id){let n={lookBehav:e.behav[r],lookObjId:e.obj_id};t.lookAtObjectList.push(n)}},this.dealAllGroupHide=function(e){let t=this;if(!t.groupDict)return void console.log("_dealAllGroup: missing groupDict");let r=["ShowImage2D","ShowImage","ShowText2D","ShowText","ShowModel","PlayMusic","ShowVideo"];for(let n=0;n<e.behav.length;n++){let i=e.behav[n];if(""!=i.group&&t.groupDict[i.group]){let e=i.group;t.groupDict[e].objs.forEach(((e,n)=>{let o=e.behav.obj_id,a=t.getObjectTypeByObj_id(o);if("2d"==a.obj_type){let e=a.obj;if(i.obj_id!=o&&e.behav_reference)for(let t=0;t<e.behav_reference.length;t++)if(r.filter((r=>r==e.behav_reference[t].behav_name)).length>0){e.visible=!1;break}}else if("3d"==a.obj_type){let e=a.obj;if(e.object3D.behav_reference&&Array.isArray(e.object3D.behav_reference)&&i.obj_id!=o)for(let n=0;n<e.object3D.behav_reference.length;n++)if(r.filter((t=>t==e.object3D.behav_reference[n].behav_name)).length>0){t.hideGroupObjectEvent(e);break}}}))}}},this.speechTextObj=function(e){if(console.log(" _speechTextObj: _textObj: ",e),"object"==typeof speechSynthesis&&"function"==typeof SpeechSynthesisUtterance){1==speechSynthesis.speaking&&(speechSynthesis.pause(),speechSynthesis.cancel());let t=e.speed,r=e.language,n=e.content,i=new SpeechSynthesisUtterance(n);i.rate=t**3*.1837+t**2*-.9948+2.3352*t-.5196,i.pitch=1;let o="en",a="en-US";switch(r){case 0:o="en",a="en-US";break;case 1:o="zh-TW",a="zh-TW";break;case 2:o="zh-CN",a="zh-CN";break;case 3:o="ja",a="ja-JP";break;case 4:o="ko",a="ko-KR";break;default:o="en",a="en-US"}let s=setInterval((function(){let e=!1,t=speechSynthesis.getVoices();t.length>0&&(clearInterval(s),window.Browser&&"safari"!=window.Browser.name&&t.forEach((t=>{t.lang==a&&(e=!0,i.voice=t)})),0==e&&(i.lang=o),speechSynthesis.speak(i))}),1)}},this.pushButton=function(t){let r=[],n=!1,i=0,o=e.module.json.display_order_list[e.module.currentIndex].index,a=e.module.json.question_list[o],s=e.module.json.score_type,l=document.getElementById("makarDragon"),c=document.getElementById("imgRight"),u=document.getElementById("imgWrong");if("Option_Text"==a.option_type||"Option_Image"==a.option_type){null==a.answer_list&&(a.answer_list=[]);let d,h=a.answer_list[0],p=a.options_json[h-1];d="a-text"==t.localName?t.parentNode.id:t.id;for(let e=0,t=a.options_json.length;e<t;e++)a.options_json[e].obj_id==d&&r.push(e);if(p.obj_id==d){if(a.active_score)if("Custom"==s)e.module.score+=a.score,i=a.score;else if("Total"==s){let t=e.module.json.total_score;e.module.correctAnswer+=1,e.module.score=Math.round(t*e.module.correctAnswer/e.module.totalActiveScoreQuestion),i=Math.round(t/e.module.totalActiveScoreQuestion)}n=!0,l.style.display="block",c.style.display="block",u.style.display="none",console.log("VRFunc.js: _nextQuestion: Congratulations! Correct Answer!")}else n=!1,l.style.display="block",c.style.display="none",u.style.display="block",console.log("VRFunc.js: _nextQuestion: ~ Incorrect Answer!");window.clearInterval(e.module.timer.currentTimer),vrController.cursorEntity.removeAttribute("cursor"),e.module.timer.counter,setTimeout((function(){l.style.display="none";let t={question:o,get_score:i,answer_time:Math.round((Date.now()-e.module.qClock)/1e3),answer_options:r,answer_cloze:"",answer_is_enable:!0,answer_is:n};if(e.module.record[o]=t,e.module.record_time+=Math.round((Date.now()-e.module.qClock)/1e3),e.module.qClock=Date.now(),a.show_score){let t=document.getElementById("scoreDiv"),r=document.getElementById("score");t.style.display="block",r.textContent=e.module.score}else vrController.nextQuestion()}),1600),console.log("VRFunc.js: _nextQuestion: score: ",e.module.score,a)}else if(t.object3D.traverse((function(r){if("Group"==r.type&&r.el&&"circle_in"==r.el.getAttribute("id")){let n=r.el;n.setAttribute("visible",!n.getAttribute("visible")),"a-text"==t.localName?targetId=t.parentNode.id:targetId=t.id,e.module.choices.includes(targetId)?(choices_idx=e.module.choices.indexOf(targetId),e.module.choices.splice(choices_idx,1)):e.module.choices.push(targetId),console.log("VRFunc.js: _nextQuestion: choices = ",e.module.choices)}else if("Group"==r.type&&r.el&&"circle_out"==r.el.getAttribute("id")){let e=r.el;"#7B7B7B"==e.getAttribute("material").color?e.setAttribute("material","color:#00d1c1;"):"#00d1c1"==e.getAttribute("material").color&&e.setAttribute("material","color:#7B7B7B;")}})),"button"==t.object3D.sub_type){let t=0;null==a.answer_list&&(a.answer_list=[]);for(let r of a.answer_list)if(correctAnswer=a.options_json[r],correctAnswer)for(let r of e.module.choices)r==correctAnswer.obj_id&&(t+=1);for(let t=0,n=a.options_json.length;t<n;t++)for(let n=0,i=e.module.choices.length;n<i;n++)a.options_json[t].obj_id==e.module.choices[n]&&r.push(t-1);if(t==a.answer_list.length&&a.answer_list.length==e.module.choices.length){if(a.active_score)if("Custom"==s)e.module.score+=a.score,i=a.score;else if("Total"==s){let t=e.module.json.total_score;e.module.correctAnswer+=1,e.module.score=Math.round(t*e.module.correctAnswer/e.module.totalActiveScoreQuestion),i=Math.round(t/e.module.totalActiveScoreQuestion)}n=!0,l.style.display="block",c.style.display="block",u.style.display="none",console.log("VRFunc.js: _nextQuestion: Congratulations! Correct Answer!")}else n=!1,l.style.display="block",c.style.display="none",u.style.display="block",console.log("VRFunc.js: _nextQuestion: ~ Incorrect Answer!");window.clearInterval(e.module.timer.currentTimer);let d=e.module.timer.counter;setTimeout((function(){vrController.cursorEntity.setAttribute("geometry","primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;"),l.style.display="none",console.log("VRFunc.js: _pushButton: ",e.module.json.question_list[o].time_limit,d,Math.round((Date.now()-e.module.qClock)/1e3));let t={question:o,get_score:i,answer_time:Math.round((Date.now()-e.module.qClock)/1e3),answer_options:r,answer_cloze:"",answer_is_enable:!0,answer_is:n};if(e.module.record[o]=t,e.module.record_time+=Math.round((Date.now()-e.module.qClock)/1e3),e.module.qClock=Date.now(),a.show_score){let t=document.getElementById("scoreDiv"),r=document.getElementById("score");t.style.display="block",r.textContent=e.module.score}else vrController.nextQuestion()}),1600),console.log("VRFunc.js: score: ",e.module.score,a)}},this.nextQuestion=function(){e.module.choices=[];let t=[],n=e.module.quizEntity;for(let e of n.children)t.push(e);if(t.forEach((function(t){for(let r=0;r<e.makarObjects.length;r++)if(e.makarObjects[r].id==t.id){let t=e.makarObjects[r];if(t.getAttribute("src")){let e=t.getAttribute("src").split("#")[1];document.getElementById(e)&&document.getElementById(e).remove()}t.remove(),e.makarObjects.splice(r,1)}})),e.module.currentIndex+=1,e.module.currentIndex<e.module.json.display_order_list.length){let t=e.module.json.display_order_list[e.module.currentIndex].index,n=e.module.json.question_list[t];"Custom"==e.module.json.timer_type&&(e.module.timer.counter=n.time_limit);let i=document.getElementById("tipButtonDiv");if(n.show_tips?(i.style.display="block",i.addEventListener("click",(function(){let e=document.getElementById("tipDiv"),t=document.getElementById("tipConfirmButton"),r=document.getElementById("tipContent");e.style.display="block",r.textContent=n.tips_content,t.addEventListener("click",(function(){e.style.display="none"}))}))):i.style.display="none",n.questions_json&&Array.isArray(n.questions_json))for(let t=0;t<n.questions_json.length;t++){let r=(new THREE.Vector3).fromArray(n.questions_json[t].transform[0].split(",").map((function(e){return Number(e)}))),i=(new THREE.Vector3).fromArray(n.questions_json[t].transform[1].split(",").map((function(e){return Number(e)}))),o=(new THREE.Vector3).fromArray(n.questions_json[t].transform[2].split(",").map((function(e){return Number(e)})));switch(n.questions_json[t].main_type){case"text":e.loadText(n.questions_json[t],r,i,o);break;case"image":e.loadTexture(n.questions_json[t],r,i,o);break;case"video":e.loadVideo(n.questions_json[t],r,i,o);break;case"model":e.loadGLTFModel(n.questions_json[t],r,i,o,e.cubeTex)}}if(n.options_json&&Array.isArray(n.options_json))for(let t=0;t<n.options_json.length;t++){let i,o,a=(new THREE.Vector3).fromArray(n.options_json[t].transform[0].split(",").map((function(e){return Number(e)}))),s=(new THREE.Vector3).fromArray(n.options_json[t].transform[1].split(",").map((function(e){return Number(e)}))),l=(new THREE.Vector3).fromArray(n.options_json[t].transform[2].split(",").map((function(e){return Number(e)}))),c=n.options_json[t].sub_type;switch(c){case"txt":o=e.loadText(n.options_json[t],a,s,l);break;case"gif":o=e.loadTexture(n.options_json[t],a,s,l);break;case"jpg":case"jpeg":case"png":o=e.loadTexture(n.options_json[t],a,s,l);break;case"button":n.options_json[t].res_url="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png",o=e.loadTexture(n.options_json[t],a,s,l)}if("button"!=c&&("MutiOption_Text"==n.option_type||"MutiOption_Image"==n.option_type)){if(0==r(o))continue;o.then((function(t){if(i=t,"MutiOption_Text"==n.option_type){let e=new THREE.Vector3(0,0,0),t=(new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1)),r=document.createElement("a-plane");r.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),r.setAttribute("id","circle_base"),r.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false"),i.appendChild(r);let n=document.createElement("a-plane");n.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png"),n.setAttribute("id","circle_out"),n.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false"),i.appendChild(n);let o=document.createElement("a-plane");o.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),o.setAttribute("id","circle_in"),o.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false"),o.setAttribute("visible",!1),i.appendChild(o);let a=function(e){e.target==e.currentTarget&&e.target.object3D&&e.target.object3D.children[0]&&(e.target.object3D.children[0].renderOrder=1)};r.addEventListener("loaded",a),n.addEventListener("loaded",a),o.addEventListener("loaded",a);let s=2*Math.abs(i.getObject3D("mesh").geometry.attributes.position.array[0]);e.x=e.x+.5*s+.3/i.object3D.parent.el.getAttribute("scale").x,e.z=e.z-.01,r.setAttribute("position",e.clone().multiply(new THREE.Vector3(-1,1,1))),n.setAttribute("position",e.clone().multiply(new THREE.Vector3(-1,1,1))),o.setAttribute("position",e.clone().multiply(new THREE.Vector3(-1,1,1))),t.multiply(new THREE.Vector3(.4,.4,.4)),t.divide(i.object3D.parent.el.getAttribute("scale")),r.setAttribute("scale",t),n.setAttribute("scale",t),o.setAttribute("scale",t.clone().multiply(new THREE.Vector3(.7,.7,.7)))}else{let t=new THREE.Vector3(0,0,0),r=new THREE.Vector3(0,0,0),n=new THREE.Vector3(1,1,1),o=setInterval((function(){if(i.getAttribute("heightForQuiz")){let a=i.getAttribute("heightForQuiz");n.multiply(new THREE.Vector3(.4,.4,.4)),n.divide(i.getAttribute("scale")),t.y=t.y-a/2-.3/i.getAttribute("scale").y;let s=document.createElement("a-plane");s.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),s.setAttribute("id","circle_base"),s.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false"),e.setTransform(s,t,r,n),i.appendChild(s);let l=document.createElement("a-plane");l.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png"),l.setAttribute("id","circle_out"),l.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false"),e.setTransform(l,t,r,n),i.appendChild(l);let c=document.createElement("a-plane");c.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png"),c.setAttribute("id","circle_in"),c.setAttribute("material","shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false"),c.setAttribute("visible",!1),n.multiply(new THREE.Vector3(.7,.7,.7)),e.setTransform(c,t,r,n),i.appendChild(c);let u=function(e){e.target==e.currentTarget&&e.target.object3D&&e.target.object3D.children[0]&&(e.target.object3D.children[0].renderOrder=1)};s.addEventListener("loaded",u),l.addEventListener("loaded",u),c.addEventListener("loaded",u),window.clearInterval(o)}}),1)}}))}}if("Custom"==e.module.json.timer_type&&e.module.timer.counter>=0){let t=Math.floor(e.module.timer.counter/3600),r=Math.floor((e.module.timer.counter-3600*t)/60),n=e.module.timer.counter-3600*t-60*r;timerContent.textContent=t.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")}setTimeout((function(){if(e.module.timer.counter>=0){e.module.qClock=Date.now();let r=setInterval((function(){e.module.timer.currentTimer=r,e.module.timer.counter-=1;let i=Math.floor(e.module.timer.counter/3600),o=Math.floor((e.module.timer.counter-3600*i)/60),a=e.module.timer.counter-3600*i-60*o;if(timerContent.textContent=i.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0"),0==e.module.timer.counter)if(window.clearInterval(e.module.timer.currentTimer),"Custom"==e.module.json.timer_type)if(n.show_score){let t=document.getElementById("scoreDiv"),r=document.getElementById("score");t.style.display="block",r.textContent=e.module.score}else vrController.nextQuestion();else{let r=[],n=e.module.quizEntity;for(let e of n.children)r.push(e);r.forEach((function(t){for(let r=0;r<e.makarObjects.length;r++)if(e.makarObjects[r].id==t.id){let t=e.makarObjects[r];if(t.getAttribute("src")){let e=t.getAttribute("src").split("#")[1];document.getElementById(e)&&document.getElementById(e).remove()}t.remove(),e.makarObjects.splice(r,1)}}));let i=document.getElementById("tipButtonDiv"),o=document.getElementById("tipDiv");i.style.display="none",o.style.display="none";let a=document.getElementById("startQuiz"),s=document.getElementById("QuizStartButton"),l=document.getElementById("QuizStartContent");a.style.display="block",l.textContent="";let c={question:t,get_score:0,answer_time:e.module.json.question_list[t].time_limit,answer_options:[],answer_cloze:"",answer_is_enable:!1,answer_is:!1};e.module.record[t]=c,e.module.record_time+=e.module.json.question_list[t].time_limit,e.module.qClock=Date.now(),s.addEventListener("click",(function(){a.style.display="none",vrController.nextQuestion()}))}}),1e3)}}),3e3)}else{window.clearInterval(e.module.timer.currentTimer),document.getElementById("timerDiv").style.display="none";let t=document.getElementById("tipButtonDiv"),r=document.getElementById("tipDiv");t.style.display="none",r.style.display="none";let n=document.getElementById("quizEndDiv");n.style.display="block",n.addEventListener("click",(function(){n.style.display="none"})),console.log("VRFunc.js: quiz end , self.module.record = ",e.module.record);let i="",o="";localStorage.getItem("login_shared_id")&&(i=localStorage.getItem("login_shared_id")),localStorage.getItem("device_id")&&(o=localStorage.getItem("device_id"));let a={user_id:publishVRProjs.result[e.projectIdx].user_id,playing_user:i,proj_id:publishVRProjs.result[e.projectIdx].proj_id,proj_type:"vr",device_id:o,brand:"",os:navigator.userAgent,location_long:0,location_lan:0,module:[e.module.json],record_time:e.module.record_time,record_score:e.module.score,record:e.module.record};quizLog(window.serverUrl,a);for(let t=0,r=userPublishProjs.proj_list.length;t<r;t++)if(userPublishProjs.proj_list[t].proj_id==publishVRProjs.result[e.projectIdx].proj_id){let e={head_pic:userPublishProjs.proj_list[t].head_pic,loc:userPublishProjs.proj_list[t].loc,module_type:userPublishProjs.proj_list[t].module_type,name:userPublishProjs.proj_list[t].name,playing_user_id:i,proj_cover_urls:userPublishProjs.proj_list[t].proj_cover_urls,proj_id:userPublishProjs.proj_list[t].proj_id,proj_name:userPublishProjs.proj_list[t].proj_name,proj_type:"vr",shared_id:userPublishProjs.proj_list[t].shared_id,snapshot_url:userPublishProjs.proj_list[t].snapshot_url,user_id:userPublishProjs.proj_list[t].user_id};updateRecordModule(window.serverUrl,e),console.log("VRFunc.js: quiz end, ",t,userPublishProjs.proj_list[t],e)}console.log("VRFunc.js: quiz end , quizVRLogData = ",a)}},this.parseLogicXML=function(e,t){let r;if(vrController.logic&&"function"==typeof vrController.logic.stopLogic&&vrController.logic.stopLogic(),publishVRProjs.result[e].xml_urls&&publishVRProjs.result[e].xml_urls[t]){let n=publishVRProjs.result[e].xml_urls[t];console.log("VRFunc.js: _parseLogicXML: xmlURL = ",n);let i=new Logic;r=i.loadXMLtoDoc(n),vrController.logic=i}return r},this.dealVideoMuted=function(t){let r=document.getElementById("clickToPlayAudio");r.style.display="block",r.onclick=function(){e.UnMutedAndPlayAllVisibleVideo(),r.style.display="none",r.onclick=null,window.allowAudioClicked=!0}},this.UnMutedAndPlayAllVisibleVideo=function(e){let t;e&&"a-video"==e.localName&&(t=e);let r=document.getElementsByTagName("a-video");if(console.log("VRFunc.js: _UnMutedAndPlayAllVideo: aVideos.length=",r.length),t)for(let e=0;e<r.length;e++){let n=r[e],i=r[e].mp4Video;if(n==t)t.mp4Video.muted=!1,t.mp4Video.autoplay=!0,t.mp4Video.play();else{let r=!0;n.object3D.traverseAncestors((function(o){"Scene"!=o.type?0==o.visible&&(r=!1):(console.log("VRFunc.js: _UnMutedAndPlayAllVideo: videoPlane =",e,r,n.object3D.visible,n),1==r&&1==n.object3D.visible&&(i.muted=!0,i.autoplay=!0,i.play()),t.mp4Video.muted=!1,t.mp4Video.autoplay=!0,t.mp4Video.play())}))}}else{let e=!1;for(let t=0;t<r.length;t++){let n=r[t],i=r[t].mp4Video,o=!0;n.object3D.traverseAncestors((function(r){"Scene"!=r.type?0==r.visible&&(o=!1):(console.log("VRFunc.js: _UnMutedAndPlayAllVideo: videoPlane =",t,o,n.object3D.visible,n),1!=o||1!=n.object3D.visible||n.blockly||(0==e?(console.log("VRFunc.js: _UnMutedAndPlayAllVideo: all parent visible true , _setVideoUnMuted false ",n.object3D),i.muted=!1,i.autoplay=!0,i.play(),e=!0):(console.log("VRFunc.js: _UnMutedAndPlayAllVideo: all parent visible true, _setVideoUnMuted true",n.object3D),i.muted=!0,i.autoplay=!0,i.play())))}))}}},this.setViewMode=function(e=""){let t=this;return new Promise((function(r){let n=document.getElementById("aCamera"),i=document.getElementById("oCamera"),o=n.getObject3D("camera"),a=i.getObject3D("camera");if(n&&i&&o&&a)if("VR"==e){if(i.setAttribute("camera","active",!1),n.setAttribute("camera","active",!0),t.vrScene.camera=o,t.viewMode="VR",Number.isFinite(t.walkingStatus)&&-1!=t.walkingStatus){let e=document.getElementById("__ground");e&&e.setAttribute("visible",!0)}r("VR")}else if("model"==e)i.setAttribute("camera","active",!0),n.setAttribute("camera","active",!1),t.vrScene.camera=a,t.viewMode="model",t.setWalkingObjVisible(!1),r("model");else if(0==i.getAttribute("camera").active)i.setAttribute("camera","active",!0),n.setAttribute("camera","active",!1),t.vrScene.camera=a,t.viewMode="model",t.setWalkingObjVisible(!1),r("model");else if(0==n.getAttribute("camera").active){if(i.setAttribute("camera","active",!1),n.setAttribute("camera","active",!0),t.vrScene.camera=o,t.viewMode="VR",Number.isFinite(t.walkingStatus)&&-1!=t.walkingStatus){let e=document.getElementById("__ground");e&&e.setAttribute("visible",!0)}r("VR")}else r(-1);else r(-1)}))},this.getMakarObject=function(t){return 1!=t.makarObject?t.parent?e.getMakarObject(t.parent):0:t},this.getObjectTypeByObj_id=function(e){let t=null,r=null,n=null,i=null,o={obj_type:"",obj_index:null,obj:null};return e&&(this.makarObjects.forEach(((n,i)=>{n.id==e&&(t=n,r=i)})),null!=t&&null!=r&&(null!=t&&null!=r?(console.log("_getObjectTypeByObj_id: 3d: ",r,t),o.obj_type="3d",o.obj_index=r,o.obj=t):console.log("_getObjectTypeByObj_id: fucking logic trouble.",i,n))),o},this.cameraMoveToPoint=function(t){let r=document.getElementById("pointerSphere"),n=document.getElementById("currentPosSphere");if(r&&n)return new Promise((function(i,o){let a=t.position,s=Math.round(1e3*a.x)/1e3,l=Math.round(1e3*a.y)/1e3,c=Math.round(1e3*a.z)/1e3;r.setAttribute("visible",!1),n.setAttribute("visible",!0),n.object3D.position.set(s,l,c);let u=e.vrScene.camera.el.object3D.position.x,d=e.vrScene.camera.el.object3D.position.y,h=e.vrScene.camera.el.object3D.position.z,p=new THREE.Vector3(s-u,l-d,c-h),f=new THREE.Vector3(s-u,0,c-h).normalize(),m=.2*Math.round(p.length());m=m>1?1:m;let v=new THREE.Raycaster(e.vrScene.camera.el.object3D.position,f);if(1==t.dealBoundary){let t=v.intersectObjects(boundaries,!0);if(t.length>0&&(console.log("_cameraMoveToPoint: initial position hit boundary, distance ",t[0].distance),t[0].distance<1))return console.log("_cameraMoveToPoint: initial position hit boundary, dont run  "),n.object3D.position.copy(e.vrScene.camera.el.object3D.position),void i(1)}let g=gsap.timeline();g.to(gsapEmpty,{duration:m,delay:0,onStart:function(){},onUpdate:function(){let r=new THREE.Vector3(u+p.x*this.ratio,d,h+p.z*this.ratio);if(1==t.dealBoundary){let t=v.intersectObjects(boundaries,!0);if(t.length>0&&t[0].distance<r.distanceTo(e.vrScene.camera.el.object3D.position))return n.object3D.position.copy(r),g.pause(),g.kill(),g=null,void i(1)}e.vrScene.camera.el.object3D.position.set(r.x,r.y,r.z)},onComplete:function(){i(m)}})}))},this.setWalkingStatus=function(e){let t=this;if(Number.isFinite(t.walkingStatus)){console.log(" _setWalkingStatus: set from [",t.walkingStatus,"]"," to [",e,"]");let r=document.getElementById("__ground"),n=document.getElementById("pointerSphere"),i=document.getElementById("currentPosSphere");0!=t.walkingStatus&&-1!=t.walkingStatus||(t.walkingStatus=e),-1==t.walkingStatus&&n&&i&&r&&t.setWalkingObjVisible(!1),0==t.walkingStatus&&r&&r.setAttribute("visible",!0)}else console.log(" _setWalkingStatus: status not exist ",t.walkingStatus)},this.setWalkingObjVisible=function(e){let t=document.getElementById("__ground"),r=document.getElementById("pointerSphere"),n=document.getElementById("currentPosSphere");t&&r&&n&&(1==e?(t.setAttribute("visible",!0),r.setAttribute("visible",!0),n.setAttribute("visible",!0)):(t.setAttribute("visible",!1),r.setAttribute("visible",!1),n.setAttribute("visible",!1)))},e.vrScene.canvas.addEventListener("touchstart",c,!1),e.vrScene.canvas.addEventListener("mousedown",c,!1),e.vrScene.canvas.addEventListener("touchmove",u,!1),e.vrScene.canvas.addEventListener("mousemove",u,!1),e.vrScene.canvas.addEventListener("touchend",d,!1),e.vrScene.canvas.addEventListener("mouseup",d,!1);let n=new THREE.Vector2;var i=new THREE.Vector2,s=new THREE.Raycaster;function l(t){let r=e.GLRenderer.domElement.getBoundingClientRect();switch(t.type){case"mouseup":case"mousemove":case"mousedown":i.x=(t.clientX-r.left)/e.GLRenderer.domElement.clientWidth*2-1,i.y=-(t.clientY-r.top)/e.GLRenderer.domElement.clientHeight*2+1;break;case"touchend":case"touchstart":case"touchmove":i.x=(t.changedTouches[0].clientX-r.left)/e.GLRenderer.domElement.clientWidth*2-1,i.y=-(t.changedTouches[0].clientY-r.top)/e.GLRenderer.domElement.clientHeight*2+1;break;default:return void console.log("default endEvent: event.type=",t.type," not mouseup/touchend, return ")}return i.clone()}function c(t){n=l(t),e.touchMouseState=0}function u(t){let r=l(t);0==e.touchMouseState?r.sub(n).length()>.01&&(e.touchMouseState=1):e.touchMouseState=1;let i=document.getElementById("__ground"),o=document.getElementById("pointerSphere");if(o&&i)if(0==e.touchMouseState||1==e.touchMouseState){if(!e.triggerEnable)return;if("VR"==e.viewMode&&Number.isInteger(e.walkingStatus)&&e.walkingStatus>=0){if(Array.isArray(e.currentSceneMakarObjects)&&e.currentSceneMakarObjects.length>0);else{for(let t=0;t<e.makarObjects.length;t++){let r=e.makarObjects[t];if(r.object3D&&"clickable"==r.className){let t=!0;r.object3D.traverseAncestors((function(e){"Scene"!=e.type&&0==e.visible&&(t=!1)})),t&&e.currentSceneMakarObjects.push(r.object3D)}}e.currentSceneMakarObjects.push(i.object3D)}let t=e.currentSceneMakarObjects,n=!1;s.setFromCamera(r,e.vrScene.camera);let a=s.intersectObjects(t,!0);a.length>0&&(1==n||a[0].object&&a[0].object.el&&a[0].object.el!=i?o.setAttribute("visible",!1):(o.setAttribute("visible",!0),o.object3D.position.copy(a[0].point)))}}else o.setAttribute("visible",!1)}function d(t){if(!e.triggerEnable)return;if(1==e.touchMouseState){if("touchend"==t.type){let e=document.getElementById("pointerSphere");e&&e.setAttribute("visible",!1)}return}e.touchMouseState=2,t.preventDefault();let r=e.GLRenderer.domElement.getBoundingClientRect();switch(t.type){case"mouseup":i.x=(t.clientX-r.left)/e.GLRenderer.domElement.clientWidth*2-1,i.y=-(t.clientY-r.top)/e.GLRenderer.domElement.clientHeight*2+1;break;case"touchend":i.x=(t.changedTouches[0].clientX-r.left)/e.GLRenderer.domElement.clientWidth*2-1,i.y=-(t.changedTouches[0].clientY-r.top)/e.GLRenderer.domElement.clientHeight*2+1;break;default:return void console.log("default endEvent: event.type=",t.type," not mouseup/touchend, return ")}let n={},o=[];for(let t=0;t<e.makarObjects.length;t++){let r=e.makarObjects[t];if(r.object3D&&"clickable"==r.className){let e=!0;r.object3D.traverseAncestors((function(t){"Scene"!=t.type&&0==t.visible&&(e=!1)})),e&&o.push(r.object3D)}}s.setFromCamera(i,e.vrScene.camera);let a=s.intersectObjects(o,!0),l=!1,c=!1;if(0!=a.length){console.log("VRFunc.js: _setupFunction: 1 endEvent, intersects=",a);let t=e.getMakarObject(a[0].object),r=t.el;if(r&&r.onclickBlock){l=!0;for(let e=0;e<r.onclickBlock.length;e++)r.onclickBlockState[e]&&(r.onclickBlockState[e]=!1,vrController.logic&&(vrController.logic.parseBlock(r.onclickBlock[e],(function(){r.onclickBlockState[e]=!0})),n["3d_logic"]=r.onclickBlock[e]))}if(t.traverse((function(e){e.isMesh})),t.behav){e.dealAllGroupHide(t);let r=!1;for(let e=0;e<t.behav.length;e++)"CloseAndResetChildren"==t.behav[e].simple_behav&&(r=!0);for(let i=0;i<t.behav.length;i++)"CloseAndResetChildren"!=t.behav[i].simple_behav&&e.triggerEvent(t.behav[i],r,t),"FingerGesture"!=t.behav[i].simple_behav&&"LookAt"!=t.behav[i].simple_behav&&(c=!0,n["3d_behav"]=t.behav)}"button"==t.main_type&&(console.log("VRFunc.js: button click ",t),vrController.pushButton(t.el),c=!0,n["3d_quizButton"]=t)}if(console.log(" event logic check: ",l,c),0==l&&0==c&&Number.isInteger(e.walkingStatus)&&"VR"==e.viewMode)if(0==e.walkingStatus){let t=document.getElementById("__ground"),r=s.intersectObjects([t.object3D],!0);if(r.length>0){let t=r[0].object;console.log(" selectedObject ",t),t.el?"__ground"==t.el.getAttribute("id")?(console.log(" _endEvent: object is ground "),e.walkingStatus=1,e.cameraMoveToPoint({position:r[0].point,dealBoundary:!1}).then((function(){e.walkingStatus=0})),n.ground_move=t):console.log(" _endEvent: object is not ground "):console.log(" _endEvent: object without el ")}}else-1==e.walkingStatus?console.log(" _endEvent: _walkingStatus =-1"):1==e.walkingStatus&&console.log(" _endEvent: _walkingStatus = 1");0==Object.keys(n).length?(console.log(" _entEvent: not touch anything "),parent&&parent.projMenuGroup&&parent.controlGroup&&parent.pictureBackground&&parent.projectUIController&&"function"==typeof parent.projectUIController.showUI&&"function"==typeof parent.projectUIController.hideUI&&(1==parent.projectUIController.status?parent.projectUIController.g_tl_show._time>3?parent.projectUIController.showUI():parent.projectUIController.hideUI():(parent.projectUIController.status,parent.projectUIController.showUI()))):console.log(" _entEvent:  touch somethong ",n)}},e.prototype.triggerEvent=function(e,t,r,n,i){if(!this.FUNCTION_ENABLED)return;var o=this;let a;switch(e.simple_behav){case"PhoneCall":console.log("VRFunc.js: triggerEvent: PhoneCall: event=",e);let r=window.document.getElementById("phoneCall");r.href="tel:"+e.phone,r.click();break;case"SendEmail":console.log("VRFunc.js: triggerEvent: SendEmail: event=",e);let n=window.document.getElementById("sendEmail");n.href="mailto:"+e.mail_to,n.click();break;case"OpenWebPage":console.log("VRFunc.js: triggerEvent: OpenWebPage: event=",e,e.url);let i=window.document.getElementById("openWebBrowser");i.href=e.url,i.click(),console.log("VRFunc.js: triggerEvent: OpenWebPage: webTag=",i);break;case"SceneChange":console.log("VRFunc.js: triggerEvent: SceneChange: event=",e),sceneID=e.scene_id;let l=o.projectIdx;for(let e=0;e<VRSceneResult[l].scenes.length;e++)VRSceneResult[l].scenes[e].scene_id==sceneID&&(o.triggerEnable=!1,loadPage.style.display="block",null!=typeof loadingTickOn&&(loadingTickOn=!0),o.loadScene(l,e));break;case"ShowImage":console.log("VRFunc.js: triggerEvent: ShowImage: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),o.showObjectEvent(a,t);break;case"ShowText":console.log("VRFunc.js: triggerEvent: ShowText: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),o.showObjectEvent(a,t);break;case"ShowModel":console.log("VRFunc.js: triggerEvent: ShowModel: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),o.showObjectEvent(a,t);break;case"PlayMusic":if(obj_id=e.obj_id,a=document.getElementById(obj_id),!a){console.log("VRFunc.js: _PlayMusic: target not exist",a);break}console.log("VRFunc.js: triggerEvent: PlayMusic: event=",e),a.getAttribute("visible")?(a.setAttribute("visible",!1),a.setAttribute("class","unclickable"),a.components.sound.stopSound()):(a.setAttribute("visible",!0),a.object3D.behav&&a.setAttribute("class","clickable"),a.components.sound.playSound());break;case"ShowVideo":console.log("VRFunc.js: triggerEvent: ShowVideo: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),o.showObjectEvent(a,t);break;case"PlayAnimation":if(console.log("VRFunc.js: triggerEvent: _PlayAnimation: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),!a){console.log("VRFunc.js: _PlayAnimation: target not exist",a);break}var s;for(let t=1;t<a.object3D.children[0].animationSlices.length;t++)a.object3D.children[0].animationSlices[t].uid==e.uid&&(s=a.object3D.children[0].animationSlices[t].animationName);a.setAttribute("animation-mixer","clip: "+s),e.loop?(a.object3D.children[0].animationSlices[0].loop=e.uid,a.object3D.children[0].animationSlices[0].uid=e.uid,a.object3D.children[0].animationSlices[0].changed=!0,a.object3D.children[0].animationSlices[0].reset=!0):(a.object3D.children[0].animationSlices[0].uid=e.uid,a.object3D.children[0].animationSlices[0].changed=!0,a.object3D.children[0].animationSlices[0].reset=e.reset);break;case"ReadText":if(console.log("VRFunc.js: _ReadText: ",e),e.obj_id){let t=e.obj_id,r=o.projectIdx;VRSceneResult&&VRSceneResult[r]&&VRSceneResult[r].scenes[o.sceneIndex]&&Array.isArray(VRSceneResult[r].scenes[o.sceneIndex].objs)&&VRSceneResult[r].scenes[o.sceneIndex].objs.forEach((e=>{e.obj_id==t&&o.speechTextObj(e)}))}break;default:console.log("VRFunc.js: triggerEvent: default: event=",e)}},e.prototype.getSnapShot=function(){let e=this;return new Promise((function(t){if(e.FUNCTION_ENABLED)return e&&e.GLRenderer&&e.vrScene&&e.GLRenderer.domElement&&e.vrScene.object3D&&e.GLRenderer.domElement.clientWidth&&e.GLRenderer.domElement.clientHeight&&e.GLRenderer.domElement.width&&e.GLRenderer.domElement.height?(e.GLRenderer.clearDepth(),e.GLRenderer.render(e.vrScene.object3D,e.vrScene.camera),void t(e.GLRenderer.domElement.toDataURL("image/png",1))):(console.log(" _VRController: _getSnapShot: something error ",e),void t(-1));t(-1)}))};var n=function(){if("undefined"!=typeof checkHost){if("yet"==checkHost)setTimeout(n,50);else if("correct"==checkHost)console.log("VRFunc.js: _checkHost_tick correct");else if("fail"==checkHost){for(;document.body.firstChild;)document.body.removeChild(document.body.firstChild);var e=document.createElement("div");e.innerHTML="<br>The host of webVR seems unauthorized,<br> please contact MIFLY ",e.style.fontSize="18px",e.style.margin="5px",e.style.fontWeight="700",document.body.append(e)}}else console.log("VRFunc.js: checkHost = undefined, something ERROR.")};n(),Module.checkMifly(),window.showVRProjList=function(){console.log("VRFunc.js: version: 2022-07-28 1650 ");let e,t=window.serverUrl;window.top,window.self,e=parent.selectedProject.user_id,console.log("VRFunc.js: _showVRProjList: : makarID=",e),getVRSceneByUserID(t,e,(function(t){if(console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID: VRSceneResult=",VRSceneResult,publishVRProjs,userPublishProjs),"string"==typeof t)str=t,document.getElementById("freeUserWarnDiv")&&(document.getElementById("freeUserWarnDiv").style.display="block",document.getElementById("pUserInfo").innerHTML=str,leaveIframe.onclick=function(){event.preventDefault(),parent.aUI});else{document.getElementById("freeUserWarnDiv")&&(document.getElementById("freeUserWarnDiv").style.display="none");for(let t=0;t<publishVRProjs.result.length;t++)if(publishVRProjs.result[t].proj_id==parent.selectedProject.proj_id)if(console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID: i=",t,publishVRProjs.result[t],VRSceneResult[t]),0==window.allowedMakarIDUseWeb){for(let n=0;n<userPublishProjs.proj_list.length;n++)if(publishVRProjs.result[t].proj_name.toLowerCase()==userPublishProjs.proj_list[n].proj_name.toLowerCase()){1==userPublishProjs.proj_list[n].web_ar?(console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID( allow by license ): i=",t),activeVRScenes(t)):(r="this ID <br> ["+e+"] <br> is free user, not allow to use webVR",document.getElementById("freeUserWarnDiv")&&(document.getElementById("freeUserWarnDiv").style.display="block",document.getElementById("pUserInfo").innerHTML=r,leaveIframe.onclick=function(){event.preventDefault(),parent.aUI}));break}}else console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID( allow by user ): i=",t),activeVRScenes(t)}var r}))},window.activeVRScenes=function(t,r=0){let i=document.getElementsByTagName("video");if(i.length>0)for(let e=0;e<i.length;e++)i[e].pause(),i[e].removeAttribute("src"),i[e].load();document.getElementById("vrDiv")&&document.getElementById("vrDiv").remove();let o,a=document.createElement("a-scene");a.setAttribute("id","vrscene"),a.setAttribute("crossorigin","anonymous"),a.setAttribute("embedded",""),a.setAttribute("vr-mode-ui","enabled: false"),a.setAttribute("debug","true"),o=document.createElement("div"),o.style.position="relative",o.setAttribute("id","vrDiv"),o.setAttribute("crossorigin","anonymous"),o.style.width=document.documentElement.clientWidth+"px",o.style.height=Math.round(document.documentElement.clientHeight-0)+"px",o.style.top="0px",window.onresize=function(){o.style.width=document.documentElement.clientWidth+"px",o.style.height=Math.round(document.documentElement.clientHeight-0)+"px"},document.body.appendChild(o),o.appendChild(a),a.hasLoaded?l():a.addEventListener("loaded",l),a.addEventListener("enter-vr",(function(){})),a.addEventListener("renderstart",(function(){}));let s=new e;if(s.VRSceneResult=VRSceneResult,s.publishVRProjs=publishVRProjs,window.vrController=s,s.projectIdx=t,"object"==typeof speechSynthesis&&"function"==typeof SpeechSynthesisUtterance){let e=speechSynthesis.getVoices();s.voices=e}function l(){a.children[2].attributes,a.setAttribute("shadow","type: pcfsoft");let e=new THREE.Vector2;a.renderer.getSize(e),a.renderer.sortObjects=!0,console.log(" **************** vrScene ",a.object3D),s.vrScene=a,s.GLRenderer=a.renderer,s.setupFunction(),setTimeout((function(){i.setAttribute("geometry","primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;"),i.setAttribute("cursor","fuse: true; fuseTimeout: 5"),i.setAttribute("animation__mouseenter","property: geometry.thetaLength; delay: 5; startEvents: mouseenter; dur: 5; from: 0.5; to: 360"),i.setAttribute("animation__mouseleave","property: geometry.thetaLength; startEvents: mouseleave; dur: 100; from: 360; to: 0.5"),s.cursorEntity=i}),1);let i=document.createElement("a-entity");i.setAttribute("id","cursor_main"),i.setAttribute("raycaster","objects: .clickable"),i.setAttribute("geometry","primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;"),i.setAttribute("position","0 0 -0.1"),i.setAttribute("material","color: red; shader: flat; ");let l=document.createElement("a-entity");l.setAttribute("id","cursor_default"),l.setAttribute("geometry","primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 360; thetaStart: 0;"),l.setAttribute("position","0 0 -0.1001"),l.setAttribute("material","color: #2ADD2A; shader: flat; ");let u=document.createElement("a-entity");u.setAttribute("crossorigin","anonymous"),u.setAttribute("camera",{active:!0,fov:80}),u.setAttribute("look-controls",""),u.setAttribute("wasd-controls",""),u.setAttribute("id","aCamera"),u.setAttribute("position",{x:0,y:0,z:0}),u.setAttribute("fov",60),u.setAttribute("near",.3),u.setAttribute("far",2e4),console.log("VRFunc.js: aCamera=",u);let d=document.createElement("a-entity");d.setAttribute("id","oCamera"),d.setAttribute("crossorigin","anonymous"),d.setAttribute("camera",{active:!0,fov:80}),d.setAttribute("orbit-controls","minPolarAngle: 0; \n\t\t\t\tmaxPolarAngle: 180; \n\t\t\t\tminDistance: 0.1; \n\t\t\t\tmaxDistance: 1000; \n\t\t\t\tinitialPosition: -5 5 13;");let h=document.createElement("a-entity");h.setAttribute("id","camera_cursor"),h.setAttribute("position",{x:0,y:1.7,z:0}),h.setAttribute("rotation","0 0 0"),h.setAttribute("crossorigin","anonymous"),h.appendChild(u),h.appendChild(d),a.appendChild(h);let p=document.createElement("a-light");if(p.setAttribute("id","ambientLight"),p.setAttribute("type","ambient"),p.setAttribute("color","#808080"),p.setAttribute("ground-color","#fff"),p.setAttribute("intensity",1),a.appendChild(p),1==publishVRProjs.result[t].proj_descr.includes("_walking")){let e=s;e.walkingStatus=-1;let t=document.createElement("a-entity");t.setAttribute("id","pointerSphere"),t.setAttribute("geometry","primitive: ring; radiusInner: 0.35; radiusOuter: 0.5"),t.setAttribute("material","shader: flat; color: white; side: double; opacity: 0.3; "),t.setAttribute("position",{x:0,y:0,z:0}),t.setAttribute("rotation",{x:90,y:0,z:0}),t.setAttribute("visible",!1),e.vrScene.appendChild(t);let r=document.createElement("a-entity");r.setAttribute("id","currentPosSphere"),r.setAttribute("geometry","primitive: ring; radiusInner: 0.35; radiusOuter: 0.5"),r.setAttribute("material","shader: flat; color: #0AC4B6; side: double; opacity: 0.3; "),r.setAttribute("position",{x:0,y:0,z:0}),r.setAttribute("rotation",{x:90,y:0,z:0}),r.setAttribute("visible",!1),e.vrScene.appendChild(r);let n=document.createElement("a-entity");n.setAttribute("id","__ground"),n.setAttribute("geometry","primitive: plane; height: 1000; width: 1000; "),n.setAttribute("material","shader: flat; color: blue; side: back; opacity: 0.05; visible: true "),n.setAttribute("visible",!1),n.setAttribute("position",{x:0,y:.1,z:0}),n.setAttribute("rotation",{x:90,y:0,z:0}),n.addEventListener("loaded",(function(){n.object3D.renderOrder=9999})),e.vrScene.appendChild(n)}let f=function(e){o=document.getElementById("vrDiv"),console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera active = ",a.camera.aspect,o.clientWidth,o.clientHeight),a.camera.aspect=o.clientWidth/o.clientHeight,a.camera.fov=60,a.camera.updateProjectionMatrix(),s.triggerEnable=!1,s.loadScene(t,r),s.userStartTime=(new Date).getTime(),n(),Module.checkMifly(),a.removeEventListener("camera-set-active",f)};a.addEventListener("camera-set-active",f);let m=new THREE.WebGLRenderTarget(1024,1024);s.skyRenderTarget=m,s.needsRenderTarget=!1,s.onlySkyScene=new THREE.Scene,c()}var c=function(){s.GLRenderer.clearDepth(),s.needsRenderTarget&&(s.GLRenderer.setRenderTarget(s.skyRenderTarget),s.GLRenderer.render(s.onlySkyScene,s.vrScene.camera),s.GLRenderer.setRenderTarget(null)),s.GLRenderer.render(s.vrScene.object3D,s.vrScene.camera),requestAnimationFrame(c)}}}(),window.addEventListener("keyup",(function(e){13===e.keyCode&&e.preventDefault()}))):setTimeout((function(){i(n)}),500)};"undefined"!=typeof window&&i(n),console.log("VRFunc done, window innerWH",window.innerWidth,window.innerHeight);let o=window.languageType="tw";if(parent){let e=parent.location.pathname.indexOf("/",0),t=parent.location.pathname.indexOf("/",e+1),r=parent.location.pathname.substring(1,t);"tw"!=r&&"en"!=r||(o=window.languageType=r)}let a=window.worldContent={userAlreadyPlayed:{tw:"",en:"This user already played"},userNotLoginInfo:{tw:"MAKAR",en:"Please login at first"},clickToPlay:{tw:"",en:"Click to play"},backToHome:{tw:"",en:"back"},GPSDistanceMsg:{tw:"GPS \r\n ",en:"Please to the right place"},GPSErrorMsg:{tw:"GPS ",en:"GPS error"},GPSnotSupportMsg:{tw:" GPS ",en:"GPS not support"},comfirm:{tw:"",en:"Comfire"}}}();