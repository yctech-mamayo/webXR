class Logic{constructor(){this.xmlDoc=null,this.variableList=[],this.intersectObj=[],this.timelineDict={},this.intervalList=[],this.onclickObjectDict={},this.logicSystemState=-1}loadXMLtoDoc(e){let t=this;return new Promise((function(l){let a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(e){if(4===a.readyState)if(200===a.status){let e=(new DOMParser).parseFromString(a.responseText,"text/xml");t.xmlDoc=e,console.log("logicSystem.js: _loadXMLtoDoc: xmlDoc = ",t.xmlDoc),l(t)}else console.error(a.statusText),l("")},a.onerror=function(e){console.error(a.statusText),l("")},a.send(null)}))}parseXML(){let e=this;if(e.logicSystemState=1,"xml"==this.xmlDoc.children[0].tagName){let t=this.xmlDoc.children[0];if("variables"==t.children[0].tagName){let e=t.children[0];e.children.length>0&&this.registLogicVariables(e.children)}if(t.children.length>1)for(let e=1;e<t.children.length;e++)this.parseBlock(t.children[e]);e.logicSystemState=2}}stopLogic=function(){let e=this,t=Object.values(e.timelineDict);t.forEach((e=>{e.pause()})),t.forEach((e=>{e.kill()})),e.timelineDict={},Object.values(e.onclickObjectDict).forEach((e=>{e.forEach((e=>{e.length=0}))})),e.onclickObjectDict={},e.intervalList.forEach((e=>{clearInterval(e)})),e.intervalList.length=0,e.variableList.length=0,e.logicSystemState=0,console.log("logicSystem.js: _stopLogic: done")};registLogicVariables=function(e){for(let t=0;t<e.length;t++){let l=new Object;l.name=e[t].textContent,l.data=null,this.variableList.push(l)}console.log(this.variableList)};getContentByFieldName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].textContent;return null};getBlockByValueName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].children[0];return null};parseBlock=function(e,t=null){let l;switch(e.getAttribute("type").split("_")[0]){case"transform":l=this.parse_transform_block(e,t);break;case"actions":l=this.parse_actions_block(e,t);break;case"controls":l=this.parse_controls_block(e,t);break;case"operators":l=this.parse_operators_block(e);break;case"data":l=this.parse_data_block(e,t);break;case"items":l=this.parse_items_block(e);break;case"events":l=this.parse_events_block(e,t);break;case"variables":l=this.parse_variables_block(e,t);break;case"debug":l=this.parse_debug_block(e,t)}return l};clear=function(){this.xmlDoc=null,this.variableList.length=0};checkObjectWorldVisible=function(e){let t=!0;if(0==e.object3D.visible)console.log("logicSystem.js: _checkObjectWorldVisible: target visible false",e.object3D),t=!1;else{let l=!0;e.object3D.traverseAncestors((function(a){"Scene"!=a.type?(console.log("logicSystem.js: _checkObjectWorldVisible: traverseAncestors: not Scene parent=",a),0==a.visible&&(l=!1)):1==l&&1==e.object3D.visible?(console.log("logicSystem.js: _checkObjectWorldVisible: traverseAncestors: all parent visible true=",e.object3D),t=!0):(console.log("logicSystem.js: _checkObjectWorldVisible: traverseAncestors: not all parent visible true=",e.object3D),t=!1)}))}return console.log("logicSystem.js: _checkObjectWorldVisible: worldVisible=",t),t}}Logic.prototype.parse_transform_block=function(e,t){let l=this,a=e.getAttribute("type"),n=new Object;switch(a){case"transform_move_in_second":n.tl=l.transform_move_in_second(e);break;case"transform_move_target_in_second":n.tl=l.transform_move_target_in_second(e);break;case"transform_rotate_in_second":n.tl=l.transform_rotate_in_second(e);break;case"transform_rotate_with_radius_in_second":n.tl=l.transform_rotate_with_radius_in_second(e);break;case"transform_rotate_with_radius_in_second_forever":n.tl=l.transform_rotate_with_radius_in_second_forever(e);break;case"transform_rotate_with_axis_in_second":n.tl=l.transform_rotate_with_axis_in_second(e);break;case"transform_rotate_from_origin_with_axis_in_second":n.tl=l.transform_rotate_from_origin_with_axis_in_second(e);break;case"transform_scale_by_in_second":n.tl=l.transform_scale_by_in_second(e);break;case"transform_set_position":n.tl=l.transform_set_position(e);break;case"transform_get_position":n.data=l.transform_get_position(e);break;case"transform_get_distance":n.data=l.transform_get_distance(e);break;case"transform_set_rotation":n.tl=l.transform_set_rotation(e);break;case"transform_to_look_at_gameobject":n.tl=l.transform_to_look_at_gameobject(e);break;case"transform_to_look_at":n.tl=l.transform_to_look_at(e);break;case"transform_get_rotation":n.data=l.transform_get_rotation(e);break;case"transform_get_rotation_in_space":n.data=l.transform_get_rotation_in_space(e);break;case"transform_get_scale":n.data=l.transform_get_scale(e);break;case"transform_get_scale_in_space":n.data=l.transform_get_scale_in_space(e);break;case"transform_get_scale_axis_in_space":n.data=l.transform_get_scale_axis_in_space(e);break;case"transform_set_scale":n.tl=l.transform_set_scale(e);break;case"transform_set_scale_by_axis":n.tl=l.transform_set_scale_by_axis(e)}return"next"==e.children[e.children.length-1].tagName?n.tl?n.tl.eventCallback("onComplete",(function(){l.parseBlock(e.children[e.children.length-1].children[0],t)})):l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(n.tl?n.tl.eventCallback("onComplete",(function(){t()})):t()),n},Logic.prototype.transform_move_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"METER");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"NUM"!=o.type)return;let c=document.getElementById(a.value);if(null==c)return;let s=c.object3D.position.clone(),u=new THREE.Vector3;switch(t){case"FORWARD":u.set(0,0,1);break;case"BACKWARD":u.set(0,0,-1);break;case"RIGHT":u.set(-1,0,0);break;case"LEFT":u.set(1,0,0);break;case"UP":u.set(0,1,0);break;case"DOWN":u.set(0,-1,0)}u=u.applyEuler(c.object3D.rotation),u.multiplyScalar(r.value),s.add(u);let h=gsap.timeline();return this.timelineDict[e.id]=h,h.to(c.object3D.position,{duration:o.value,delay:0,ease:"none",x:s.x,y:s.y,z:s.z}),h},Logic.prototype.transform_move_target_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=this.getBlockByValueName(e,"SECOND");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=document.getElementById(l.value);if(null==o)return;n.value.multiply(new THREE.Vector3(-1,1,1));let c=gsap.timeline();return this.timelineDict[e.id]=c,c.to(o.object3D.position,{duration:i.value,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),c},Logic.prototype.transform_rotate_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"DEGREE");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"DEGREE"!=r.type)return;let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"NUM"!=o.type)return;let c=document.getElementById(a.value);if(null==c)return;let s=c.object3D.rotation.clone();switch(t){case"CLOCKWISE":s.y-=Math.PI*r.value/180;break;case"COUNTERCLOCKWISE":s.y+=Math.PI*r.value/180}let u=gsap.timeline();return this.timelineDict[e.id]=u,u.to(c.object3D.rotation,{duration:o.value,delay:0,ease:"none",y:s.y}),u},Logic.prototype.rotateAboutPoint=function(e,t,l,a,n){(n=void 0!==n&&n)&&e.parent.localToWorld(e.position),e.position.sub(t),e.position.applyAxisAngle(l,a),e.position.add(t),n&&e.parent.worldToLocal(e.position),e.rotateOnWorldAxis(l,a)},Logic.prototype.transform_rotate_with_radius_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getBlockByValueName(e,"GAME_OBJECT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"DEGREE");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"DEGREE"!=i.type)return;let o=this.getBlockByValueName(e,"RADIUS");if(null==o)return;let c=this.parseBlock(o).data;if(null==c||"NUM"!=c.type)return;c.value<0&&(c.value=0);let s=this.getBlockByValueName(e,"SECOND");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"NUM"!=u.type)return;let h=document.getElementById(n.value);if(null==h)return;let d=new THREE.Vector3(0,0,1).applyEuler(h.object3D.rotation),p=h.object3D.up.clone().applyEuler(h.object3D.rotation),_=h.object3D.position.clone().add(d.multiplyScalar(c.value));switch(l){case"CLOCKWISE":i.value=-i.value;break;case"COUNTERCLOCKWISE":i.value=i.value}let f=gsap.timeline();t.timelineDict[e.id]=f;let g=0;return h.object3D.roundTheta=0,f.to(h.object3D,{duration:u.value,delay:0,ease:"none",roundTheta:i.value,onUpdate:function(){t.rotateAboutPoint(h.object3D,_,p,(h.object3D.roundTheta-g)/180*Math.PI),g=h.object3D.roundTheta}}),f},Logic.prototype.transform_rotate_with_radius_in_second_forever=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getBlockByValueName(e,"GAME_OBJECT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"RADIUS");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;i.value<0&&(i.value=0);let o=this.getBlockByValueName(e,"SECOND");if(null==o)return;let c=this.parseBlock(o).data;if(null==c||"NUM"!=c.type)return;let s=document.getElementById(n.value);if(null==s)return;let u,h=new THREE.Vector3(0,0,1).applyEuler(s.object3D.rotation),d=s.object3D.up.clone().applyEuler(s.object3D.rotation),p=s.object3D.position.clone().add(h.multiplyScalar(i.value));switch(l){case"CLOCKWISE":u=-360;break;case"COUNTERCLOCKWISE":u=360}let _=gsap.timeline();t.timelineDict[e.id]=_;let f=0;return s.object3D.loopTheta=0,_.to(s.object3D,{repeat:-1,duration:c.value,delay:0,ease:"none",loopTheta:u,onUpdate:function(){t.rotateAboutPoint(s.object3D,p,d,(s.object3D.loopTheta-f)/180*Math.PI),f=s.object3D.loopTheta}}),_},Logic.prototype.transform_rotate_with_axis_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"ROTATION");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"VEC3"!=r.type)return;let i=this.getBlockByValueName(e,"DEGREE");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"DEGREE"!=o.type)return;let c=this.getBlockByValueName(e,"SECOND");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=document.getElementById(a.value);if(null==u)return;switch(r.value.x=-r.value.x,r.value.normalize(),t){case"CLOCKWISE":o.value=-o.value;break;case"COUNTERCLOCKWISE":o.value=o.value}let h=gsap.timeline();this.timelineDict[e.id]=h;let d=0;return u.object3D.axisTheta=0,h.to(u.object3D,{duration:s.value,delay:0,ease:"none",axisTheta:o.value,onUpdate:function(){u.object3D.rotateOnAxis(r.value,(u.object3D.axisTheta-d)/180*Math.PI),d=u.object3D.axisTheta}}),h},Logic.prototype.transform_rotate_from_origin_with_axis_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getContentByFieldName(e,"ORIGIN_SPACE");if(null==a)return;let n=this.getContentByFieldName(e,"AXIS_SPACE");if(null==n)return;let r=this.getBlockByValueName(e,"GAME_OBJECT");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"TEXT"!=i.type)return;let o=this.getBlockByValueName(e,"ORIGIN");if(null==o)return;let c=this.parseBlock(o).data;if(null==c||"VEC3"!=c.type)return;c.value.multiply(new THREE.Vector3(-1,1,1));let s=this.getBlockByValueName(e,"AXIS");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"VEC3"!=u.type)return;u.value.multiply(new THREE.Vector3(-1,1,1)),u.value.normalize();let h=this.getBlockByValueName(e,"DEGREE");if(null==h)return;let d=this.parseBlock(h).data;if(null==d||"DEGREE"!=d.type)return;let p=this.getBlockByValueName(e,"SECOND");if(null==p)return;let _=this.parseBlock(p).data;if(null==_||"NUM"!=_.type)return;let f=document.getElementById(i.value);if(null==f)return;switch(l){case"CLOCKWISE":d.value=-d.value;break;case"COUNTERCLOCKWISE":d.value=d.value}switch(a){case"SPACE_LOCAL":c.value=c.value.applyMatrix4(f.object3D.matrix);break;case"SPACE_GLOBAL":c.value=f.object3D.worldToLocal(c.value).applyMatrix4(f.object3D.matrix)}switch(n){case"SPACE_LOCAL":u.value=u.value.applyEuler(f.object3D.rotation);break;case"SPACE_GLOBAL":if("a-entity"==f.parentEl.localName){console.log("has parent");let e=new THREE.Quaternion;f.parentEl.object3D.getWorldQuaternion(e);let t=new THREE.Euler;t.setFromQuaternion(e,"YXZ"),console.log("world eular",t),t.x=-t.x,t.y=-t.y,t.z=-t.z,u.value=u.value.applyEuler(t),console.log(u.value)}}let g=gsap.timeline();t.timelineDict[e.id]=g;let y=0;return f.object3D.Theta=0,g.to(f.object3D,{duration:_.value,delay:0,ease:"none",Theta:d.value,onUpdate:function(){t.rotateAboutPoint(f.object3D,c.value,u.value,(f.object3D.Theta-y)/180*Math.PI),y=f.object3D.Theta}}),g},Logic.prototype.transform_scale_by_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"SCALE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"SECOND");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=document.getElementById(l.value);if(null==o)return;let c=o.object3D.scale.clone();c.multiplyScalar(n.value);let s=gsap.timeline();return this.timelineDict[e.id]=s,s.to(o.object3D.scale,{duration:i.value,delay:0,ease:"none",x:c.x,y:c.y,z:c.z}),s},Logic.prototype.transform_set_position=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;n.value.multiply(new THREE.Vector3(-1,1,1));let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.position,{duration:.01,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),i},Logic.prototype.transform_get_position=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object;switch(r.type="VEC3",t){case"SPACE_GLOBAL":r.value=n.object3D.getWorldPosition().clone();break;case"SPACE_LOCAL":r.value=n.object3D.position.clone()}return r.value.x=-r.value.x,r},Logic.prototype.transform_get_distance=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=new THREE.Vector3;r.object3D.getWorldPosition(i);let o=document.getElementById(n.value);if(null==o)return;let c=new THREE.Vector3;o.object3D.getWorldPosition(c);let s=new Object;return s.type="NUM",s.value=i.distanceTo(c),s},Logic.prototype.transform_set_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"ROTATION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;n.value.multiply(new THREE.Vector3(1,-1,-1));let r=document.getElementById(l.value);if(null==r)return;let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.rotation,{duration:.01,delay:0,ease:"none",x:n.value.x/180*Math.PI,y:n.value.y/180*Math.PI,z:n.value.z/180*Math.PI}),i},Logic.prototype.transform_to_look_at_gameobject=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=document.getElementById(n.value);if(null==i)return;let o=new THREE.Vector3;i.object3D.getWorldPosition(o);let c=gsap.timeline();return this.timelineDict[e.id]=c,c.to(r.object3D,{duration:.01,delay:0,ease:"none",onStart:function(){r.object3D.lookAt(o)}}),c},Logic.prototype.transform_to_look_at=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;n.value.multiply(new THREE.Vector3(-1,1,1));let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(gsapEmpty,{duration:.01,delay:0,ease:"none",onStart:function(){r.object3D.lookAt(n.value)}}),i},Logic.prototype.transform_get_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;let n=new Object;return n.type="VEC3",n.value=a.object3D.rotation.clone(),n.value.x=n.value.x/Math.PI*180,n.value.y=-n.value.y/Math.PI*180,n.value.z=-n.value.z/Math.PI*180,n},Logic.prototype.transform_get_rotation_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object;switch(r.type="VEC3",t){case"SPACE_GLOBAL":let e=new THREE.Quaternion;n.object3D.getWorldQuaternion(e);let t=new THREE.Euler;t.setFromQuaternion(e,"YXZ"),r.value=t;break;case"SPACE_LOCAL":r.value=n.object3D.rotation.clone()}return r.value.x=r.value.x/Math.PI*180,r.value.y=-r.value.y/Math.PI*180,r.value.z=-r.value.z/Math.PI*180,r},Logic.prototype.transform_get_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;let n=new Object;return n.type="NUM",n.value=a.object3D.scale.clone().x,n},Logic.prototype.transform_get_scale_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object,i=new THREE.Vector3;switch(r.type="NUM",t){case"SPACE_GLOBAL":n.object3D.getWorldScale(i),r.value=i.x;break;case"SPACE_LOCAL":r.value=n.object3D.scale.clone().x}return r},Logic.prototype.transform_get_scale_axis_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object;switch(r.value=new THREE.Vector3,r.type="VEC3",t){case"SPACE_GLOBAL":r.value=n.object3D.getWorldScale(r.value);break;case"SPACE_LOCAL":r.value=n.object3D.scale.clone()}return r},Logic.prototype.transform_set_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"SCALE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.scale,{duration:.01,delay:0,ease:"none",x:n.value,y:n.value,z:n.value}),i},Logic.prototype.transform_set_scale_by_axis=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"AXIS");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.scale,{duration:.01,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),i},Logic.prototype.parse_actions_block=function(e,t){let l=this,a=e.getAttribute("type"),n=new Object,r=null;switch(a){case"actions_set_color":l.actions_set_color(e);break;case"actions_set_visibility":l.actions_set_visibility(e);break;case"actions_set_opacity":l.actions_set_opacity(e);break;case"actions_set_animation":l.actions_set_animation(e);break;case"actions_set_animation_by_id":l.actions_set_animation_by_id(e);break;case"actions_play_sound_until_finished":r=l.actions_play_sound_until_finished(e,t);break;case"actions_play_sound":l.actions_play_sound(e);break;case"actions_stop_sound":l.actions_stop_sound(e);break;case"actions_play_video_until_finished":r=l.actions_play_video_until_finished(e,t);break;case"actions_play_video":l.actions_play_video(e);break;case"actions_pause_video":l.actions_pause_video(e);break;case"actions_stop_video":l.actions_stop_video(e);break;case"actions_set_light_color":l.actions_set_light_color(e);break;case"actions_set_light_intensity":l.actions_set_light_intensity(e);break;case"actions_set_text":r=l.actions_set_text(e,t);break;case"actions_set_text_color":r=l.actions_set_text_color(e,t);break;case"actions_set_text_bgcolor":r=l.actions_set_text_bgcolor(e,t)}return"next"==e.children[e.children.length-1].tagName?r||l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(r||t()),n},Logic.prototype.actions_set_color=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=this.getBlockByValueName(e,"COLOUR");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type&&"COLOUR"!=n.type)return;let r=10*parseFloat(l[0])+parseFloat(l[1]),i=10*parseFloat(l[2])+parseFloat(l[3]),o=document.getElementById(t);if(null==o)return;console.log(" --- ",o.object3D,l);let c=-1,s=-1;if(o.object3D.children.length>0&&o.object3D.children[0].ModelJson&&o.object3D.children[0].ModelJson.meshes&&o.object3D.children[0].ModelJson.materials&&o.object3D.children[0].ModelJson.nodes){let e=o.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,r==t){c=e[l].mesh,console.log("action.js: _actions_set_color: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_color: meshIndex = ",c),c>=0){let e=o.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_color: get meshData ",c,e),e&&e.primitives){let t=e.primitives[i];t.material>=0&&(s=t.material,console.log("action.js: _actions_set_color: materialIndex=",s))}}}s>=0&&o.object3D.traverse((function(e){if(e.isMesh&&e.el==o.object3D.el){let t=e.material.name.split("_");t[t.length-1]==s&&(e.material.color=new THREE.Color(n.value))}}))},Logic.prototype.actions_set_visibility=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"BOOL");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"BOOL"!=n.type)return;let r=document.getElementById(l.value);null!=r&&(r.setAttribute("visible",n.value),r.object3D.traverse((function(e){"Group"==e.type&&e.el.getAttribute("visible")&&e.el.object3D.behav&&e.el.setAttribute("class","clickable")})))},Logic.prototype.actions_set_opacity=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=this.getBlockByValueName(e,"PERCENT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=10*parseFloat(l[0])+parseFloat(l[1]),i=10*parseFloat(l[2])+parseFloat(l[3]),o=document.getElementById(t);if(null==o)return;console.log(" --- ",o.object3D,l);let c=-1,s=-1;if(o.object3D.children.length>0&&o.object3D.children[0].ModelJson&&o.object3D.children[0].ModelJson.meshes&&o.object3D.children[0].ModelJson.materials&&o.object3D.children[0].ModelJson.nodes){let e=o.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,r==t){c=e[l].mesh,console.log("action.js: _actions_set_opacity: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_opacity: meshIndex = ",c),c>=0){let e=o.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_opacity: get meshData ",c,e),e&&e.primitives){let t=e.primitives[i];t.material>=0&&(s=t.material,console.log("action.js: _actions_set_opacity: materialIndex=",s))}}}s>=0&&o.object3D.traverse((function(e){if(e.isMesh){let t=e.material.name.split("_");t[t.length-1]==s&&(e.material.transparent=!0,e.material.opacity=n.value/100,console.log("action.js: _actions_set_opacity: child.material =",e.material))}}))},Logic.prototype.actions_set_animation=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let a,n=document.getElementById(t);if(null!=n)if("None"==l)n.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<n.object3D.children[0].animationSlices.length;e++)n.object3D.children[0].animationSlices[e].name==l&&(a=n.object3D.children[0].animationSlices[e]);a&&(n.setAttribute("animation-mixer","clip: "+a.animationName),n.object3D.children[0].animationSlices[0].loop=a.uid,n.object3D.children[0].animationSlices[0].uid=a.uid,n.object3D.children[0].animationSlices[0].changed=!0,n.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_set_animation_by_id=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let a=this.getContentByFieldName(e,"TIMES");if(null==a)return;let n=document.getElementById(t);var r;if(null!=n)if("None"==l)n.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<n.object3D.children[0].animationSlices.length;e++)n.object3D.children[0].animationSlices[e].uid==l&&(r=n.object3D.children[0].animationSlices[e]);n.setAttribute("animation-mixer","clip: "+r.animationName),n.object3D.children[0].animationSlices[0].uid=r.uid,n.object3D.children[0].animationSlices[0].changed=!0,"LOOP"==a&&(n.object3D.children[0].animationSlices[0].loop=r.uid,n.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_play_sound_until_finished=function(e,t){let l=this.getBlockByValueName(e,"SOUND");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=this;if(1==r.checkObjectWorldVisible(n)){n.setAttribute("sound","loop:false"),n.components.sound.playSound();let l=function(a){n.components.sound.stopSound(),n.removeEventListener("sound-ended",l),n.setAttribute("sound","loop:true"),"next"==e.children[e.children.length-1].tagName?r.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return n.addEventListener("sound-ended",l),!0}},Logic.prototype.actions_play_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;1==this.checkObjectWorldVisible(a)&&a.components.sound.playSound()},Logic.prototype.actions_stop_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;1==this.checkObjectWorldVisible(a)&&a.components.sound.stopSound()},Logic.prototype.actions_play_video_until_finished=function(e,t){let l=this.getBlockByValueName(e,"VIDEO");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=this;if(1==r.checkObjectWorldVisible(n)){let l=n.getAttribute("src");if(null!=l){l=l.split("#").pop();let a=document.getElementById(l);if(a instanceof HTMLElement){a.loop=!1,a.muted=!1,a.play();let l=function(n){a.currentTime=0,a.pause(),a.removeEventListener("ended",l),a.loop=!0,"next"==e.children[e.children.length-1].tagName?r.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return a.addEventListener("ended",l),!0}}}},Logic.prototype.actions_play_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;console.log("action.js: _actions_play_video: target ",a);if(1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.loop=!0,t.muted=!1,t.play())}}},Logic.prototype.actions_pause_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;if(1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&t.pause()}}},Logic.prototype.actions_stop_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;if(1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.currentTime=t.duration,t.loop=!1)}}},Logic.prototype.actions_set_light_color=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"COLOUR");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type&&"COLOUR"!=n.type)return;let r=document.getElementById(l.value);null!=r&&(r.object3D.children[0].color=new THREE.Color(n.value))},Logic.prototype.actions_set_light_intensity=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"PERCENT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=document.getElementById(l.value);null!=r&&(r.object3D.children[0].intesity=n.value/100)},Logic.prototype.actions_set_text=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"TEXT");if(null==r)return;let i=this.parseBlock(r).data;if(null==i)return;let o=document.getElementById(n.value);if(null==o)return;let c=l.toString(i);if(o.children[0].getAttribute("value")!=c){o.children[0].components.text.textMesh.children.length=0,o.children[0].object3D.children.length=1,o.children[0].setAttribute("value",c);let a=c.split("\n"),n=0;const r=/[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u,i=e=>r.test(e);for(let e=0;e<a.length;e++){let t=0;for(let l=0;l<a[e].length;l++)i(a[e][l])?t+=1.6:a[e][l]==a[e][l].toUpperCase()&&a[e][l]!=a[e][l].toLowerCase()||a[e][l]==a[e][l].toLowerCase()&&a[e][l]!=a[e][l].toUpperCase()?t+=1:isNaN(1*a[e][l])?t+=1.25:t+=1;t>n&&(n=t)}o.children[0].setAttribute("wrap-count",n+1);let s=function(a){o.children[0].removeEventListener("geometry-set",s),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return o.children[0].addEventListener("geometry-set",s),!0}},Logic.prototype.actions_set_text_color=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"COLOUR");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"TEXT"!=i.type&&"COLOUR"!=i.type)return;let o=document.getElementById(n.value);if(null!=o&&o.children[0].getAttribute("color")!=i.value){o.children[0].components.text.textMesh.children.length=0,o.children[0].object3D.children.length=1,o.children[0].setAttribute("color",i.value);let a=function(n){o.children[0].removeEventListener("geometry-set",a),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return o.children[0].addEventListener("geometry-set",a),!0}},Logic.prototype.actions_set_text_bgcolor=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"COLOUR");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"TEXT"!=i.type&&"COLOUR"!=i.type)return;let o=document.getElementById(n.value);if(null==o)return;let c=new THREE.Color(i.value),s=c.r+","+c.g+","+c.b+",1";if(o.children[0].getAttribute("backcolor")!=s){o.children[0].components.text.textMesh.children.length=0,o.children[0].object3D.children.length=1,o.children[0].setAttribute("backcolor",s);let a=function(n){o.children[0].removeEventListener("geometry-set",a),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return o.children[0].addEventListener("geometry-set",a),!0}},Logic.prototype.parse_controls_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"controls_repeat_forever":a.tl=this.controls_repeat_forever(e,t);break;case"controls_repeat":a.tl=this.controls_repeat(e,t);break;case"controls_for":a.tl=this.controls_for(e,t);break;case"controls_whileUntil":a.tl=this.controls_whileUntil(e,t);break;case"controls_forEach":a.tl=this.controls_forEach(e,t);break;case"controls_flow_statements":a.tl=this.controls_flow_statements(e,t);break;case"controls_if":a.tl=this.controls_if(e,t);break;case"controls_ifelse":a.tl=this.controls_ifelse(e,t);break;case"controls_wait_time":a.tl=this.controls_wait_time(e,t);break;case"controls_run_parallel":a.tl=this.controls_run_parallel(e,t)}return"controls_repeat_forever"!=l&&("next"==e.children[e.children.length-1].tagName?a.tl||this.parseBlock(e.children[e.children.length-1].children[0],t):t&&(a.tl||t())),a},Logic.prototype.controls_repeat_forever=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO");if(null==a)return;let n=gsap.timeline();return l.timelineDict[e.id]=n,n.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?n.restart():"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),n},Logic.prototype.controls_repeat=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO");if(null==a)return;let n=this.getBlockByValueName(e,"TIMES");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=Math.max(0,r.value)-1,o=gsap.timeline();return l.timelineDict[e.id]=o,o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?i>0?(i-=1,o.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t():"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),o},Logic.prototype.controls_for=function(e,t){let l=this,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let n=this.getBlockByValueName(e,"FROM");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=this.getBlockByValueName(e,"TO");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"NUM"!=o.type)return;let c=this.getBlockByValueName(e,"BY");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=this.getBlockByValueName(e,"DO");if(null==u)return;let h,d=r.value;this.variableList.forEach((e=>{e.name==a&&(h=e)}));let p=new Object;p.value=d,p.type="NUM";let _=gsap.timeline();return l.timelineDict[e.id]=_,d<=o.value&&s.value>0||d>=o.value&&s.value<0?(h.data=p,_.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(u,(function(a=null){null==a||"CONTINUE"==a?(d+=s.value,d<=o.value&&s.value>0||d>=o.value&&s.value<0?(h.data.value=d,_.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),_},Logic.prototype.controls_whileUntil=function(e,t){let l=this,a=this.getContentByFieldName(e,"MODE");if(null==a)return;let n=this.getBlockByValueName(e,"DO");if(null==n)return;let r=this.getBlockByValueName(e,"BOOL");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"BOOL"!=i.type)return;let o=gsap.timeline();return l.timelineDict[e.id]=o,"WHILE"==a&&i.value||"UNTIL"==a&&!i.value?o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(n,(function(n=null){null==n||"CONTINUE"==n?(i=l.parseBlock(r).data,"WHILE"==a&&i.value||"UNTIL"==a&&!i.value?o.restart():"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==n&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),o},Logic.prototype.controls_forEach=function(e,t){let l=this,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let n=this.getBlockByValueName(e,"LIST");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"LIST"!=r.type)return;if(r.value.length<1)return;let i=this.getBlockByValueName(e,"DO");if(null==i)return;let o,c=0;this.variableList.forEach((e=>{e.name==a&&(o=e)}));let s=new Object;s.value=r.value[c].value,s.type=r.value[c].type,o.data=s;let u=gsap.timeline();l.timelineDict[e.id]=u,u.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(i,(function(a=null){null==a||"CONTINUE"==a?(c+=1,c<r.value.length?(o.data.value=r.value[c].value,o.data.type=r.value[c].type,u.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})},Logic.prototype.controls_flow_statements=function(e,t){let l=this.getContentByFieldName(e,"FLOW");null!=l&&t&&t(l)},Logic.prototype.controls_if=function(e,t){let l=this,a=parseInt(e.children[0].getAttribute("elseif")),n=0,r=gsap.timeline();for(l.timelineDict[e.id]=r;;){let a=this.getBlockByValueName(e,"IF"+n);if(null==a)break;let i=this.parseBlock(a).data;if(null==i||"BOOL"!=i.type)break;let o=this.getBlockByValueName(e,"DO"+n);if(i.value)return o?(r.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(o,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),r):void 0;n+=1}let i=this.getBlockByValueName(e,"ELSE");if(i&&n==a+1)return r.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(i,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),r;"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()},Logic.prototype.controls_ifelse=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO0"),n=this.getBlockByValueName(e,"ELSE");if(null==a&&null==n)return;let r=this.getBlockByValueName(e,"IF0");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"BOOL"!=i.type)return;let o=gsap.timeline();return l.timelineDict[e.id]=o,i.value?o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}):o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(n,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),o},Logic.prototype.controls_wait_time=function(e,t){let l=this,a=this.getContentByFieldName(e,"UNIT");if(null==a)return;let n=this.getBlockByValueName(e,"TIME");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;switch(a){case"SECONDS":r.value=r.value;break;case"MILLISECOND":r.value=r.value/1e3;break;case"MINUTES":r.value=60*r.value}let i=gsap.timeline();return l.timelineDict[e.id]=i,i.to(gsapEmpty,{delay:r.value,onStart:function(){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()}}),i},Logic.prototype.controls_run_parallel=function(e,t){let l=parseInt(e.children[0].getAttribute("do")),a=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"DO"+(t+1));l&&a.push(l)}if(!(a.length<1))for(let e=0;e<a.length;e++)this.parseBlock(a[e])},Logic.prototype.parse_operators_block=function(e){let t=e.getAttribute("type"),l=new Object;switch(t){case"operators_compare":l.data=this.operators_compare(e);break;case"operators_operation":l.data=this.operators_operation(e);break;case"operators_negate":l.data=this.operators_negate(e);break;case"operators_ternary":l.data=this.operators_ternary(e);break;case"operators_arithmetic":l.data=this.operators_arithmetic(e);break;case"operators_random_int":l.data=this.operators_random_int(e);break;case"operators_random_float_between":l.data=this.operators_random_float_between(e);break;case"operators_constrain":l.data=this.operators_constrain(e);break;case"operators_number_property":l.data=this.operators_number_property(e);break;case"operators_is_divisable":l.data=this.operators_is_divisable(e);break;case"operators_round":l.data=this.operators_round(e);break;case"operators_round_to_decimals":l.data=this.operators_round_to_decimals(e);break;case"operators_single":l.data=this.operators_single(e);break;case"operators_trig":l.data=this.operators_trig(e);break;case"operators_on_list":l.data=this.operators_on_list(e)}return l},Logic.prototype.operators_compare=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a)return;let n=this.getBlockByValueName(e,"B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r)return;if(a.type!=r.type)return null;let i=new Object;switch(i.type="BOOL",t){case"EQ":i.value=a.value==r.value;break;case"NEQ":i.value=a.value!=r.value;break;case"LT":if("NUM"!=a.type)return null;i.value=a.value<r.value;break;case"LTE":if("NUM"!=a.type)return null;i.value=a.value<=r.value;break;case"GT":if("NUM"!=a.type)return null;i.value=a.value>r.value;break;case"GTE":if("NUM"!=a.type)return null;i.value=a.value>=r.value}return i},Logic.prototype.operators_operation=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"BOOL"!=a.type)return;let n=this.getBlockByValueName(e,"B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"BOOL"!=r.type)return;let i=new Object;switch(i.type="BOOL",t){case"AND":i.value=a.value&&r.value;break;case"OR":i.value=a.value||r.value}return i},Logic.prototype.operators_negate=function(e){let t=this.getBlockByValueName(e,"BOOL");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let a=new Object;return a.type="BOOL",a.value=!l.value,a},Logic.prototype.operators_ternary=function(e){let t=this.getBlockByValueName(e,"IF");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let a=this.getBlockByValueName(e,"THEN");if(null==a)return;let n=this.parseBlock(a).data,r=this.getBlockByValueName(e,"ELSE");if(null==r)return;let i=this.parseBlock(r).data;return l.value?n:i},Logic.prototype.operators_arithmetic=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=this.getBlockByValueName(e,"B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=new Object;switch(i.type="NUM",t){case"ADD":i.value=a.value+r.value;break;case"MINUS":i.value=a.value-r.value;break;case"MULTIPLY":i.value=a.value*r.value;break;case"DIVIDE":i.value=a.value/r.value;break;case"POWER":i.value=Math.pow(a.value,r.value);break;case"MOD":i.value=a.value%r.value}return i},Logic.prototype.operators_random_int=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"TO");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=parseInt(n.value),i=parseInt(l.value),o=new Object;return o.type="NUM",o.value=parseInt(Math.random()*(r-i))+i,o},Logic.prototype.operators_random_float_between=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"TO");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=new Object;return r.type="NUM",r.value=Math.random()*(n.value-l.value)+l.value,r},Logic.prototype.operators_constrain=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"LOW");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"HIGH");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=new Object;return o.type="NUM",o.value=Math.min(Math.max(l.value,n.value),i.value),o},Logic.prototype.operators_number_property=function(e){let t=this.getContentByFieldName(e,"PROPERTY");if(null==t)return;let l=this.getBlockByValueName(e,"NUMBER_TO_CHECK");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=new Object;switch(n.type="BOOL",CheckPrime=function(e){if(2==e||3==e)return!0;if(!(e>1)||e%1!=0||e%2==0||e%3==0)return!1;for(let t=6;t<=Math.sqrt(e)+1.5;t+=6)if(e%(t-1)==0||e%(t+1)==0)return!1;return!0},t){case"EVEN":n.value=a.value%2==0;break;case"ODD":n.value=a.value%2==1;break;case"PRIME":n.value=CheckPrime(a.value);break;case"WHOLE":n.value=a.value%1==0;break;case"POSITIVE":n.value=a.value>0;break;case"NEGATIVE":n.value=a.value<0}return n},Logic.prototype.operators_is_divisable=function(e){let t=this.getBlockByValueName(e,"DIVIDEND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"DIVISOR");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=new Object;return r.type="BOOL",r.value=l.value%n.value==0,r},Logic.prototype.operators_round=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=new Object;switch(n.type="NUM",t){case"ROUND":n.value=Math.round(a.value);break;case"ROUNDUP":n.value=Math.ceil(a.value);break;case"ROUNDDOWN":n.value=Math.floor(a.value)}return n},Logic.prototype.operators_round_to_decimals=function(e){let t=this.getBlockByValueName(e,"A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=new Object;r.type="NUM";let i=parseInt(n.value);return value=l.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+i:i))),value=value.toString().split("e"),r.value=+(value[0]+"e"+(value[1]?+value[1]-i:-i)),r},Logic.prototype.operators_single=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=new Object;switch(n.type="NUM",t){case"ROOT":n.value=Math.sqrt(a.value);break;case"ABS":n.value=Math.abs(a.value);break;case"NEG":n.value=-a.value;break;case"LN":n.value=Math.log(a.value);break;case"LOG10":n.value=Math.log10(a.value);break;case"EXP":n.value=Math.exp(a.value);break;case"POW10":n.value=Math.pow(10,a.value)}return n},Logic.prototype.operators_trig=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type&&"DEGREE"!=a.type)return;"DEGREE"==a.type&&(a.value=Math.PI*a.value/180);let n=new Object;switch(n.type="NUM",t){case"SIN":n.value=Math.sin(a.value);break;case"COS":n.value=Math.cos(a.value);break;case"TAN":n.value=Math.tan(a.value);break;case"ASIN":n.value=Math.asin(a.value);break;case"ACOS":n.value=Math.acos(a.value);break;case"ATAN":n.value=Math.atan(a.value)}return n},Logic.prototype.operators_on_list=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"LIST");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"LIST"!=a.type)return;let n=[],r={};for(let e=0;e<a.value.length;e++){if("NUM"!=a.value[e].type)return;n.push(a.value[e].value),r[a.value[e].value]?r[a.value[e].value]+=1:r[a.value[e].value]=1}let i=new Object;switch(i.type="NUM",t){case"SUM":i.value=n.reduce(((e,t)=>e+t),0);break;case"MIN":i.value=Math.min(...n);break;case"MAX":i.value=Math.max(...n);break;case"AVERAGE":i.value=n.reduce(((e,t)=>e+t),0)/n.length;break;case"MEDIAN":n.sort((function(e,t){return e-t})),n.length%2==1?i.value=n[parseInt(n.length/2)]:i.value=(n[parseInt(n.length/2)-1]+n[parseInt(n.length/2)])/2;break;case"MODE":let e=Math.max(...Object.values(r)),t=[];Object.keys(r).forEach((l=>{if(r[l]==e){let e=new Object;e.value=parseFloat(l),e.type="NUM",t.push(e)}})),i.value=t,i.type="LIST";break;case"STD_DEV":let l=n.reduce(((e,t)=>e+t),0)/n.length,a=0;n.forEach((e=>{let t=e-l;a+=t*t})),i.value=Math.sqrt(a/n.length);break;case"RANDOM":i.value=n[parseInt(Math.random()*n.length)]}return i},Logic.prototype.parse_items_block=function(e){let t=e.getAttribute("type"),l=vrController.VRSceneResult[vrController.projectIdx].scenes[0].objs,a=new Object;switch(t){case"items_get_gameobject":case"items_get_model":case"items_get_text":case"items_get_light":case"items_get_sound":case"items_get_video":a.data=this.items_get_gameobject(e);break;case"items_get_name":a.data=this.items_get_name(e,l);break;case"items_get_by_name":a.data=this.items_get_by_name(e,l);break;case"items_is_video_playing":a.data=this.items_is_video_playing(e)}return a},Logic.prototype.items_get_gameobject=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type="TEXT",t},Logic.prototype.items_get_name=function(e,t){let l=new Object,a=this.getBlockByValueName(e,"GAME_OBJECT"),n=this.parseBlock(a).data.value;return l.type="TEXT",t.forEach((e=>{e.obj_id==n&&(l.value=e.res_name)})),l},Logic.prototype.items_get_by_name=function(e,t){let l=new Object,a=this.getBlockByValueName(e,"NAME"),n=this.parseBlock(a).data.value;return l.type="TEXT",t.forEach((e=>{e.res_name==n&&(l.value=e.obj_id)})),l},Logic.prototype.items_is_video_playing=function(e){let t=new Object,l=this.getBlockByValueName(e,"VIDEO"),a=this.parseBlock(l).data.value,n=document.getElementById(a);n=document.getElementById(a);let r=document.querySelector("video");if(n)return t.type="BOOL",t.value=!r.paused,t},Logic.prototype.parse_data_block=function(e,t){let l=e.getAttribute("type"),a=new Object,n=this;switch(l){case"data_boolean":a.data=this.data_boolean(e);break;case"data_number":a.data=this.data_number(e);break;case"data_angle":a.data=this.data_angle(e);break;case"data_constant":a.data=this.data_constant(e);break;case"data_colour_random":a.data=this.data_colour_random(e);break;case"data_colour_of":a.data=this.data_colour_of(e);break;case"data_colour_picker":a.data=this.data_colour_picker(e);break;case"data_colour_rgb":a.data=this.data_colour_rgb(e);break;case"data_colour_blend":a.data=this.data_colour_blend(e);break;case"data_text":a.data=this.data_text(e);break;case"data_text_join":a.data=this.data_text_join(e);break;case"data_vector3":a.data=this.data_vector3(e);break;case"data_get_axis_from_vector3":a.data=this.data_get_axis_from_vector3(e);break;case"data_length":a.data=this.data_length(e);break;case"data_lists_create_empty":a.data=this.data_lists_create_empty(e);break;case"data_lists_create_list":this.data_lists_create_list(e);break;case"data_lists_create_with":a.data=this.data_lists_create_with(e);break;case"data_lists_add":this.data_lists_add(e);break;case"data_lists_insert_by_index":this.data_lists_insert_by_index(e);break;case"data_lists_delete_by_index":this.data_lists_delete_by_index(e);break;case"data_lists_replace_by_index":this.data_lists_replace_by_index(e);break;case"data_lists_get_by_index":a.data=this.data_lists_get_by_index(e);break;case"data_lists_pop_by_index":a.data=this.data_lists_pop_by_index(e);break;case"data_lists_index":a.data=this.data_lists_index(e);break;case"data_lists_contains":a.data=this.data_lists_contains(e)}return e.children>0&&("next"==e.children[e.children.length-1].tagName?n.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()),a},Logic.prototype.data_boolean=function(e){let t=new Object;return"TRUE"==e.children[0].textContent?t.value=!0:"FALSE"==e.children[0].textContent&&(t.value=!1),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_number=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_angle=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_constant=function(e){let t=this.getContentByFieldName(e,"CONSTANT");if(null==t)return;let l=new Object;switch(l.type="NUM",t){case"PI":l.value=Math.PI;break;case"E":l.value=Math.E;break;case"GOLDEN_RATIO":l.value=(1+Math.sqrt(5))/2;break;case"SQRT2":l.value=Math.sqrt(2);break;case"SQRT1_2":l.value=Math.sqrt(.5);break;case"INFINITY":l.value=1/0}return l},Logic.prototype.data_colour_random=function(e){let t=new THREE.Color(Math.random(),Math.random(),Math.random()),l=new Object;return l.value="#"+t.getHexString().toUpperCase(),l.type="COLOUR",l},Logic.prototype.data_colour_of=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=document.getElementById(t);if(null==a)return;let n=10*parseFloat(l[0])+parseFloat(l[1]),r=10*parseFloat(l[2])+parseFloat(l[3]),i=-1,o=-1;if(a.object3D.children.length>0&&a.object3D.children[0].ModelJson&&a.object3D.children[0].ModelJson.meshes&&a.object3D.children[0].ModelJson.materials&&a.object3D.children[0].ModelJson.nodes){let e=a.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,n==t){i=e[l].mesh,console.log("data.js: _data_colour_of: get nodeMeshIndex ",e[l]);break}if(console.log("data.js: _data_colour_of: meshIndex = ",i),i>=0){let e=a.object3D.children[0].ModelJson.meshes[i];if(console.log("data.js: _data_colour_of: get meshData ",i,e),e&&e.primitives){let t=e.primitives[r];t.material&&(o=t.material,console.log("data.js: _data_colour_of: materialIndex=",o))}}}let c=new Object;if(c.type="COLOUR",o>=0){let e;a.object3D.traverse((function(t){if(t.isMesh){let l=t.material.name.split("_");l[l.length-1]==o&&(e=t.material,console.log("action.js: _data_colour_of: child.material =",t.material))}})),c.value="#"+e.color.getHexString().toUpperCase(),console.log("action.js: _data_colour_of: get material success color =",c.value)}else c.value="#C8C8C8",console.log("action.js: _data_colour_of: get material fail color =",c.value);return c},Logic.prototype.data_colour_picker=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_rgb=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_blend=function(e){let t=this.getBlockByValueName(e,"COLOUR1");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"COLOUR"!=l.type)return;let a=this.getBlockByValueName(e,"COLOUR2");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type&&"COLOUR"!=n.type)return;let r=this.getBlockByValueName(e,"RATIO");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=Math.min(100,Math.max(0,i.value))/100;console.log(o);let c=new THREE.Color(l.value),s=new THREE.Color(n.value);console.log(c),console.log(s);let u=c.lerp(s,o);console.log(u);let h=new Object;return h.value="#"+u.getHexString().toUpperCase(),h.type="COLOUR",h},Logic.prototype.data_text=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_text_join=function(e){let t=parseInt(e.children[0].getAttribute("items")),l=new Object;l.value="",l.type="TEXT";for(let a=0;a<t;a++){let t=this.getBlockByValueName(e,"ADD"+a);if(t){let e=this.parseBlock(t).data;l.value+=this.toString(e)}}return l},Logic.prototype.data_vector3=function(e){let t=new Object;if("X"!=e.children[0].getAttribute("name"))return null;let l=this.parseBlock(e.children[0].children[0]).data;if(null==l||"NUM"!=l.type)return null;if("Y"!=e.children[1].getAttribute("name"))return null;let a=this.parseBlock(e.children[1].children[0]).data;if(null==a||"NUM"!=a.type)return null;if("Z"!=e.children[2].getAttribute("name"))return null;let n=this.parseBlock(e.children[2].children[0]).data;return null==n||"NUM"!=n.type?null:(t.value=new THREE.Vector3(l.value,a.value,n.value),t.type="VEC3",t)},Logic.prototype.data_get_axis_from_vector3=function(e){let t=this.getContentByFieldName(e,"AXIS");if(null==t)return;let l=this.getBlockByValueName(e,"POSITION");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"VEC3"!=a.type)return;let n=new Object;switch(n.type="NUM",t){case"X":n.value=a.value.x;break;case"Y":n.value=a.value.y;break;case"Z":n.value=a.value.z}return n},Logic.prototype.data_length=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"LIST"!=l.type)return;let a=new Object;return a.value=l.value.length,a.type="NUM",a},Logic.prototype.data_lists_create_empty=function(e){let t=new Object;return t.value=[],t.type="LIST",t},Logic.prototype.data_lists_create_list=function(e){let t,l=this.getContentByFieldName(e,"VAR");if(null==l)return;this.variableList.forEach((e=>{e.name==l&&(t=e)}));let a=new Object;a.value=[],a.type="LIST",t.data=a},Logic.prototype.data_lists_create_with=function(e){let t=new Object;t.value=[],t.type="LIST";let l=parseInt(e.children[0].getAttribute("items")),a=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"ADD"+t);l&&a.push(l)}for(let e=0;e<a.length;e++){let l=this.parseBlock(a[e]).data;if(l){let e=new Object;e.value=l.value,e.type=l.type,t.value.push(e)}}return t},Logic.prototype.data_lists_add=function(e){let t=this.getBlockByValueName(e,"ITEM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=new Object;r.value=l.value,r.type=l.type,n.value.push(r)},Logic.prototype.data_lists_insert_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"INDEX");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let i=this.parseBlock(r).data;if(null!=i&&"LIST"==i.type&&n.value>=0&&n.value<=i.value.length){let e=new Object;e.value=l.value,e.type=l.type,i.value.splice(n.value,0,e)}},Logic.prototype.data_lists_delete_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;null!=n&&"LIST"==n.type&&l.value>=0&&l.value<n.value.length&&n.value.splice(l.value,1)},Logic.prototype.data_lists_replace_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"INDEX");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let i=this.parseBlock(r).data;if(null!=i&&"LIST"==i.type&&n.value>=0&&n.value<i.value.length){let e=new Object;e.value=l.value,e.type=l.type,i.value.splice(n.value,1,e)}},Logic.prototype.data_lists_get_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=new Object;return l.value>=0&&l.value<n.value.length&&(r=n.value[l.value]),r},Logic.prototype.data_lists_pop_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=new Object;return l.value>=0&&l.value<n.value.length&&(r=n.value[l.value],n.value.splice(l.value,1)),r},Logic.prototype.data_lists_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=[];n.value.forEach((e=>{r.push(e.value)}));let i=new Object;return i.type="NUM",i.value=r.indexOf(l.value),i},Logic.prototype.data_lists_contains=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=[];n.value.forEach((e=>{r.push(e.value)}));let i=new Object;i.type="BOOL";let o=r.indexOf(l.value);return i.value=-1!=o,i},Logic.prototype.parse_variables_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"variables_set":a.data=this.variables_set(e,t);break;case"variables_get":a.data=this.variables_get(e)}return a},Logic.prototype.variables_set=function(e,t){let l=new Object,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let n=this.getBlockByValueName(e,"VALUE");return null!=n?(this.variableList.forEach((e=>{e.name==a&&(e.data=this.parseBlock(n).data,l=e.data)})),"next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),l):void 0},Logic.prototype.variables_get=function(e){let t=new Object;return this.variableList.forEach((l=>{l.name==e.children[0].textContent&&(t=l.data)})),t},Logic.prototype.parse_events_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"events_on_click":a.data=this.events_on_click(e);break;case"events_on_collide":a.data=this.events_on_collide(e)}return t&&t(),a},Logic.prototype.events_on_click=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"DO");if(null==n)return;let r=document.getElementById(a.value);null!=r&&r.object3D.el&&(r.object3D.el.onclickBlock?(r.object3D.el.onclickBlock.push(n),r.object3D.el.onclickBlockState.push(!0)):(r.object3D.el.onclickBlock=[],r.object3D.el.onclickBlockState=[],r.object3D.el.onclickBlock.push(n),r.object3D.el.onclickBlockState.push(!0)),t.onclickObjectDict[e.id]=[r.object3D.el.onclickBlock,r.object3D.el.onclickBlockState])},Logic.prototype.events_on_collide=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"TEXT"!=r.type)return;let i=t.getBlockByValueName(e,"DO0");if(null==i)return;let o=document.getElementById(a.value),c=document.getElementById(r.value);if(null==o||null==c)return;let s=(new THREE.Box3).setFromObject(o.object3D),u=(new THREE.Box3).setFromObject(c.object3D),h=s.intersectsBox(u),d=!0,p=window.setInterval((function(){s=(new THREE.Box3).setFromObject(o.object3D),u=(new THREE.Box3).setFromObject(c.object3D),d&&0==h&&1==s.intersectsBox(u)?(h=!0,d=!1,t.parseBlock(i,(function(){d=!0}))):1==h&&0==s.intersectsBox(u)&&(h=!1)}),1);t.intervalList.push(p)},Logic.prototype.parse_debug_block=function(e,t){let l=e.getAttribute("type"),a=new Object,n=this;switch(l){case"debug_print":this.debug_print(e);break;case"debug_comment":this.debug_comment()}return"next"==e.children[e.children.length-1].tagName?n.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),a},Logic.prototype.toString=function(e){let t=this,l="";return"LIST"==e.type?e.value.forEach((e=>{l+=t.toString(e)})):"VEC3"==e.type?(value=e.value.x.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.y.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.z.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):"NUM"==e.type?(value=e.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):l+=e.value,l},Logic.prototype.debug_print=function(e){let t=this.parseBlock(e.children[0].children[0]).data;null!=t&&console.log(this.toString(t))},Logic.prototype.debug_comment=function(){};