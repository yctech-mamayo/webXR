(()=>{let e=new function(){this.setProjectModal=function(e){switch(projectPicture.innerHTML="",projectNameInfo.innerHTML=e.proj_name,projectUserName.innerHTML=e.name,projectLastUpdateDate.textContent=e.last_update_date.substring(0,10),Array.isArray(e.loc)&&(e.loc.length>1&&e.module_type.find((function(e){return"gps"==e}))?(console.log("vrUI.js: showProjectInfo: project with gps ",e,"\n",e.loc[0]+", "+e.loc[1]),projectGPSDiv.style.display="block",projectGPSDivEndLine.style.display="block",projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent="wait for GPS",projectGPSInfo.textContent=e.loc[0]+", "+e.loc[1],navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){console.log("vrUI.js: showProjectInfo: geoPosition = ",t.coords.latitude,t.coords.longitude);let o=function(e,t,o,n,s="M"){if(e==o&&t==n)return 0;{let r=Math.PI*e/180,l=Math.PI*o/180,a=r-l,i=Math.PI*t/180-Math.PI*n/180,c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(r)*Math.cos(l)*Math.pow(Math.sin(i/2),2)));return"M"==s&&(c*=6378137),console.log("vrUI.js: calculateGeosToDistanceHaversine dist=",c),c}}(t.coords.latitude,t.coords.longitude,e.loc[0],e.loc[1]);projectGPSInfo.textContent=e.loc[0]+", "+e.loc[1]+", dist="+Math.floor(o),getViewerConfig(serverUrl,(function(e){o<e.data.gps_range_distance?(projectStartButton.style.pointerEvents="auto",startBGImage.style.display="inline",startTitle.textContent=parent.htmlContent.modalButtonStart[parent.languageType]):(projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent=parent.htmlContent.modalButtonDisable[parent.languageType])}))}),(function(e){console.warn("vrUI.js: showProjectInfo: e=",e.code,e.message),projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent="GPS error"}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(console.log("vrUI.js: showProjectInfo: Geolocation is not supported by this browser."),console.warn("vrUI.js: showProjectInfo: not allow GPS "),projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent="GPS not support")):(projectGPSDiv.style.display="none",projectGPSDivEndLine.style.display="none",projectStartButton.style.pointerEvents="auto",startBGImage.style.display="inline",startTitle.textContent=parent.htmlContent.modalButtonStart[parent.languageType])),e.proj_type){case"ar":projectTypeInfo.innerHTML="AR 圖像辨識",projectUsageInfo.innerHTML="掃描辨識圖即可觀賞AR",scanList.style.display="block",getARProjsByProjID([e.proj_id],(function(e){let t=e.data.result[0].targets_img_urls;if(Array.isArray(t)){scanList.style.display="block",scanListEndLine.style.display="block";for(let e=0;e<t.length;e++){let o=document.createElement("img");o.src=t[e],projectPicture.appendChild(o)}}else scanList.style.display="none",scanListEndLine.style.display="none"})),projectStartButton.onclick=function(){console.log("UI.js: vr to ar, click"),leavedSendLog(),parent.aUI.startCoreIframe(e,!0)};break;case"vr":projectTypeInfo.innerHTML="VR 虛擬實境",projectUsageInfo.innerHTML="開啟專案即可觀賞VR",projectPicture.style.display="none",scanList.style.display="none",scanListEndLine.style.display="none",projectStartButton.onclick=function(){console.log("UI.js: vr to vr, click"),document.getElementById("snapshot_"+parent.selectedProject.proj_id).className="circular--square",leavedSendLog(),parent.aUI.startCoreIframe(e,!1);for(let t=0;t<publishVRProjs.result.length;t++)if(publishVRProjs.result[t].proj_id==e.proj_id){console.log("UI.js: _setProjectModal: activeVRScenes: i=",t),document.getElementById("snapshot_"+e.proj_id).className="circular--square-marker",projectModal.style.display="none",activeVRScenes(t);break}};break;case"ar_slam":projectTypeInfo.innerHTML="AR 空間辨識",projectUsageInfo.innerHTML="開啟專案即可觀賞XR",projectPicture.style.display="none",scanList.style.display="none",scanListEndLine.style.display="none",projectStartButton.onclick=function(){console.log("UI.js: vr to xr, click"),leavedSendLog(),parent.aUI.startCoreIframe(e,!0)}}var t=projectStartButton.offsetTop-projectDescriptionDiv.offsetTop-projectDescriptionTitle.offsetHeight-10;projectDescription.style.height=t+"px",projectDescription.textContent=e.proj_descr},this.cleanProjectModal=function(){},this.setProjectTable=function(){let t=document.getElementById("projsTable"),o=t.rows.proj_snapshot,n=t.rows.proj_name,s=o.children.length,r=n.children.length;for(let e=0;e<s;e++)o.deleteCell(0);for(let e=0;e<r;e++)n.deleteCell(0);if(userPublishProjs){let t=0;for(let s=0;s<userPublishProjs.proj_list.length;s++){if(parent.useEditorWebTag&&!userPublishProjs.proj_list[s].proj_platform.find((e=>"web"==e)))continue;window.allowedMakarIDUseWeb;let r=n.insertCell(t);r.style.paddingLeft=0==t?"16px":"8px";let l=document.createElement("div");l.innerText=userPublishProjs.proj_list[s].proj_name,l.className="projNameOneRow",r.appendChild(l);let a=o.insertCell(t);a.className="snapShotCell",a.style.paddingLeft=0==t?"16px":"8px",1==window.allowedMakarIDUseWeb||1==userPublishProjs.proj_list[s].web_ar||(a.style.opacity=.5,a.style.pointerEvents="none",l.style.opacity=.5,l.style.pointerEvents="none");let i=document.createElement("img");i.src=userPublishProjs.proj_list[s].snapshot_url,i.width=50,i.height=50,i.className="circular--square",i.setAttribute("id","snapshot_"+userPublishProjs.proj_list[s].proj_id),userPublishProjs.proj_list[s].proj_id==parent.selectedProject.proj_id&&(i.className="circular--square-marker"),i.onclick=function(){1==window.allowedMakarIDUseWeb||1==userPublishProjs.proj_list[s].web_ar?(console.log("UI.js: _img click, switch project( allow ) ",window.allowedMakarIDUseWeb,userPublishProjs.proj_list[s].web_ar),projectModal.style.display="block",e.setProjectModal(userPublishProjs.proj_list[s])):console.log("UI.js: _img click, switch project( denied ) ",window.allowedMakarIDUseWeb,userPublishProjs.proj_list[s].web_ar)},a.appendChild(i),t++}let s=n.insertCell(0);s.style.paddingLeft="25px",s.style.paddingRight="15px",s.style.borderRight="1px solid white";let r=document.createElement("div");r.innerText="作者頁面",r.className="projNameOneRow",s.appendChild(r);let l=o.insertCell(0);l.style.paddingLeft="25px",l.style.paddingRight="15px",l.style.borderRight="1px solid white";let a=document.createElement("img");getOneUserInfo(window.serverUrl,userPublishProjs.proj_list[0].user_id,["head_pic"],(function(e){""!=e.data.head_pic?a.src=e.data.head_pic:a.src="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/icon/me2.png"})),a.style.borderRadius="50%",a.width=50,a.height=50,l.appendChild(a)}}}})();