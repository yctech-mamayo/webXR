/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./js/VRMain/version3_4/AddObjectToVrController.js":
/*!*********************************************************!*\
  !*** ./js/VRMain/version3_4/AddObjectToVrController.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
//// 主因: 3D物件載入都在 VRController 底下，要呼叫load系列都要透過 VRController
//// 同時 Quiz 物件要獨立出來，但 Quiz 會需要把物件加入場景 (要呼叫load系列)

//// 目的: 將額外的3D物件加到場景裡，因此它會和 vrController 互動

////           ________________________         ____________ 
////     介面: |AddObjectToVrController| -使用→ |VRController|
////           ¯¯¯¯¯¯¯↑¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯         ¯¯¯¯¯¯¯¯¯¯¯¯¯
////                  | 實作該介面　　　　　　
////                _____
////                |Quiz|　　　　　　　　                             (因此Quiz可以將3D物件加入場景)
////                ¯¯¯¯¯¯

//// 原本是想寫 interface 但發現 js 似乎還沒有，因此寫成 class  (上圖的實作其實是用extends繼承)

//// 有實作/繼承這個Class的 就表示它能跟vrController互動
class AddObjectToVrController {
        
    //// 此時 只要 Quiz 繼承這個 class 並實作它的方法，就能把物件加入場景
    //// howardhsu has not comfirm that this is good or not, yet. 
    
    //// 考慮了如果場中存在複數個 vrController 的情況(指定是與哪個vrController互動)
    // vrController = null
    // constructor(vrController){
    //     this.vrController = vrController
    // }
    //// 但，如果寫了 constructor 就變質了  (它會連 Abstract Class 都不是，也不是 interface。 Orz


    //// ----------------
    //// 以下是 "把物件加入到場景 或 vrController 常用到的函式們" 
    ////     實作或繼承了此抽象類別的class需要去覆寫它們 以便與vrController互動

    getProjectIdx(){
        // return window.vrController.projectIdx
    }

    addTextToScene(){
        //// 把文字物件加入場景
    }

    addTextureToScene(){
        //// 把圖片物件加入場景
    }

    addGLTFModelToScene(){
        //// 把模型物件加入場景
    }

    addAudioToScene(){
        //// 把聲音物件加入場景
    }

    addVideoToScene(){
        //// 把影片物件加入場景
    }

    pushObjectToMakarObjects(){
        //// 把3D物件加入到 makarObjects 陣列
    }

    setTransform(){
        //// 把物件放到對應的場景位置
    }

    appendToVrScene(){
        //// 把物件加入到場景裡
    }
    //// ----------------

    initTest(){
        console.log("AddObjectToVrController.initTest: ", window.vrController)
    }

    // static testStaticMethod(){
    //     console.log('static method test')
    // }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AddObjectToVrController);

/***/ }),

/***/ "./js/VRMain/version3_4/Quiz.js":
/*!**************************************!*\
  !*** ./js/VRMain/version3_4/Quiz.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _AddObjectToVrController_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./AddObjectToVrController.js */ "./js/VRMain/version3_4/AddObjectToVrController.js");


function isPromise(p) {
    if (typeof p === 'object' && typeof p.then === 'function') {
      return true;
    }
    return false;
}

function getRandomInt(max) {
    return Math.floor(Math.random() * Math.floor(max));
}

class Quiz extends _AddObjectToVrController_js__WEBPACK_IMPORTED_MODULE_0__["default"] {
    
    //[start-2023mmdd-howardhsu-add]//
    ////  - to do	    
    //// 	- quiz能去操控 html 的quiz介面	
    //// 	- 讓quiz顯示的2D正確錯誤介面可以共用

	//// 	- 要考慮能讓兩個quiz同時在場景中
	//// 		- 例如如果場景設定多個quiz都是載入時開始問答，點擊開始遊玩就都開始
    //[end-2023mmdd-howardhsu-add]//

    module = {'placeholder': 'quiz test.'}
    
    constructor(obj){
        super();
        this.module = obj.module
    }
    
    //// ----------------
    //// override "把物件加入到場景 或 vrController 常用到的函式們"   以便與vrController互動

    getProjectIdx(){
        return window.vrController.projectIdx
    }

    addTextToScene( questions_json, position, rotation, scale ){
        //// 把文字物件加入場景
        return window.vrController.loadText( questions_json, position, rotation, scale )
    }
    
    addTextureToScene( questions_json, position, rotation, scale ){
        //// 把圖片物件加入場景
        return window.vrController.loadTexture( questions_json, position, rotation, scale )                        
    }

    addGLTFModelToScene( questions_json, position, rotation, scale ){
        //// 把模型物件加入場景
        return window.vrController.loadGLTFModel( questions_json, position, rotation, scale, vrController.cubeTex )  
    }

    addAudioToScene( questions_json, position, rotation, scale ){
        //// 把聲音物件加入場景
        return window.vrController.loadAudio( questions_json, position, rotation, scale )
    }

    addVideoToScene( questions_json, position, rotation, scale ){
        //// 把影片物件加入場景
        return window.vrController.loadVideo( questions_json, position, rotation, scale )
    }

    pushToMakarObjects( makarObject ){
        //// 把3D物件加入到 makarObjects 陣列
        window.vrController.makarObjects.push( makarObject );
    }

    setTransform(base, circlePos, circleRot, circleScale){
        //// 把物件放到對應的場景位置
        window.vrController.setTransform(base, circlePos, circleRot, circleScale);
    }

    appendToVrScene(obj){
        window.vrController.vrScene.appendChild(obj);
    }

    //// ---------------- 其他會用到 vrController 的細項們
    clearObject(item){
        //// 把物件從 vrController.makarObject 清除、從頁面上移除
        for (let i = 0; i < window.vrController.makarObjects.length; i++ ){
            if (window.vrController.makarObjects[i].id == item.id){
                let makarObject = window.vrController.makarObjects[i];
                if(makarObject.getAttribute("src")){
                    let id = makarObject.getAttribute("src").split('#')[1];
                    if (document.getElementById(id)){
                        document.getElementById(id).remove();
                    }
                }
                makarObject.remove();
                window.vrController.makarObjects.splice(i,1);
            }
        }
    }

    adjustCursorEntity(setOrRemove, attr, value=""){
        // 調整 window.vrController.cursorEntity
        setOrRemove = setOrRemove.toLowerCase()
        switch (setOrRemove) {
            case "set":
                window.vrController.cursorEntity.setAttribute(attr, value);                
                break;

            case "remove":                
                window.vrController.cursorEntity.removeAttribute(attr);
                break;
        
            default:
                console.log("Quiz.js adjustCursorEntity: error")
                break;
        }
    }
    //// ----------------
    

    //// 載入 Quiz
    load( obj, position, rotation, scale) {

        //// for dev
        window.quiz = this

        let self = this

        //// 載入之前先檢查是否網頁端有用戶登入，並檢查是否玩過此專案
        // console.log("VRFunc.js: _loadQuiz: obj=", obj);
        let quizEntity = document.createElement("a-entity");
        quizEntity.setAttribute("id", obj.obj_id);

        this.pushToMakarObjects(quizEntity)
        
        console.log("Quiz.js: _load: quizEntity=", quizEntity.object3D);
    
        quizEntity.addEventListener( 'loaded' , function(){
            // console.log(' -------- quizEntity loaded ');
            ///// 增加一個「空物件」，代表此 entity 已經自身載入完成
            let QObject3D = new THREE.Object3D();
            quizEntity.object3D.add( QObject3D );
        });
        
        let randomQuestionList = [];
        for (let i=0; i<obj.module[0].question_list.length; i++){
            if (obj.module[0].question_list[i].allowRandom){
                randomQuestionList.push(i);
            }
        }
    
        //// 當user沒有在quiz設定題目順序時的error
        if(!obj.module[0].display_order_list){
            console.log("Quiz.js _load: ERROR - user has not set display_order_list. obj.module[0]=", obj.module[0])
            return
        }

        let totalActiveScoreQuestion = 0
        for (let i=0;i<obj.module[0].display_order_list.length;i++){
            let tempIdx =  obj.module[0].display_order_list[i].index;
            if (tempIdx == -1){
                let randInt = getRandomInt(randomQuestionList.length);
                let randomIdx = randomQuestionList[randInt];
                obj.module[0].display_order_list[i].index = randomIdx
                tempIdx = randomIdx;
                randomQuestionList.splice(randInt,1);
            }
            if (obj.module[0].question_list[tempIdx].active_score){
                totalActiveScoreQuestion += 1;
            }
        }
    
        let idx = obj.module[0].display_order_list[0].index;
        let first_question = obj.module[0].question_list[idx];
    
        let timerContent = document.getElementById('timerContent');
    
        let firstTimer = -1;
        if (obj.module[0].timer_type == "Total"){
            firstTimer = obj.module[0].total_time;
            let timer = document.getElementById("timerDiv");
            timer.style.display = "block";
    
            let hour = Math.floor(firstTimer/3600);
            let min = Math.floor((firstTimer-hour*3600)/60);
            let sec = firstTimer-hour*3600-min*60;
            timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
        }
        else if(obj.module[0].timer_type == "Custom"){
            firstTimer = first_question.time_limit;
            let timer = document.getElementById("timerDiv");
            timer.style.display = "block";
    
            let hour = Math.floor(firstTimer/3600);
            let min = Math.floor((firstTimer-hour*3600)/60);
            let sec = firstTimer-hour*3600-min*60;
            timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
        }
    
        let tipButtonDiv = document.getElementById("tipButtonDiv");
        if(first_question.show_tips){
            tipButtonDiv.style.display = "block";
            tipButtonDiv.addEventListener("click",function(){
                let tipDiv = document.getElementById("tipDiv");
                let tipConfirmButton = document.getElementById("tipConfirmButton");
                let tipContent = document.getElementById("tipContent");
                tipDiv.style.display = "block";
                tipContent.textContent = first_question.tips_content;
                tipConfirmButton.addEventListener("click",function(){
                    tipDiv.style.display = "none";
                });
            });
        }
        else{
            tipButtonDiv.style.display = "none";
        }
    
        this.module = {
            "json":obj.module[0], 
            "quizEntity":quizEntity, 
            "currentIndex":0, 
            "score":0, 
            "choices":[], 
            "correctAnswer":0, 
            "totalActiveScoreQuestion":totalActiveScoreQuestion, 
            "record":new Array(obj.module[0].question_list.length), 
            "timer":{"currentTimer":null,"counter":firstTimer } , 
            "record_time":0 , 
            "qClock": Date.now() 
        }
    
        let scoreDiv = document.getElementById("scoreDiv")
        scoreDiv.addEventListener("click",function(){
            scoreDiv.style.display = "none";
            self.nextQuestion();
        });
    
        console.log("Quiz.js: _load: _first_question=", first_question );
    
        if ( first_question.questions_json && Array.isArray( first_question.questions_json ) ){
            for(let i=0; i<first_question.questions_json.length; i++){
                let position = new THREE.Vector3().fromArray(first_question.questions_json[i].transform[0].split(",").map(function(x){return Number(x)}) );
                let rotation = new THREE.Vector3().fromArray(first_question.questions_json[i].transform[1].split(",").map(function(x){return Number(x)}) );
                let scale    = new THREE.Vector3().fromArray(first_question.questions_json[i].transform[2].split(",").map(function(x){return Number(x)}) );
                let type = first_question.questions_json[i].main_type;
                switch(type){
                    case "text":                        
                        //[start-20230919-howardhsu-modify]//
                        this.addTextToScene( first_question.questions_json[i], position, rotation, scale )
                        break;
                    case "image":
                        this.addTextureToScene( first_question.questions_json[i], position, rotation, scale )
                        break;
                    case "video":
                        this.addVideoToScene( first_question.questions_json[i], position, rotation, scale );
                        break;
                    case "model":   
                        this.addGLTFModelToScene( first_question.questions_json[i], position, rotation, scale )            
                        break;
                    case "audio":
                        this.addAudioToScene( first_question.questions_json[i], position, rotation, scale );
                        //[end-20230919-howardhsu-modify]//
                        break;
                }
            }
        }
        
        if ( first_question.options_json ){
    
            for(let i=0; i<first_question.options_json.length; i++){
                let position = new THREE.Vector3().fromArray(first_question.options_json[i].transform[0].split(",").map(function(x){return Number(x)}) );
                let rotation = new THREE.Vector3().fromArray(first_question.options_json[i].transform[1].split(",").map(function(x){return Number(x)}) );
                let scale    = new THREE.Vector3().fromArray(first_question.options_json[i].transform[2].split(",").map(function(x){return Number(x)}) );
                let type = first_question.options_json[i].sub_type;
                console.log("Quiz.js: _load: _loadOption: ", i , type , first_question.options_json[i] )
                let Entity;
                let pOption;
                switch(type){
                    case "txt":
                        // first_question.options_json[i].main_type = "text";
                        
                        //[start-20230919-howardhsu-modify]//
                        pOption = this.addTextToScene( first_question.options_json[i], position, rotation, scale)
    
                        break;
                    case "gif":
                    case "jpg":
                    case "jpeg":
                    case "png":
                        pOption = this.addTextureToScene( first_question.options_json[i], position, rotation, scale)
                        break;
                    case "button":
                        first_question.options_json[i].res_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png";
                        
                        pOption = this.addTextureToScene( first_question.options_json[i], position, rotation, scale)
                        //[end-20230919-howardhsu-modify]//
                        break;
                }
                
                if (type != "button" && (first_question.option_type == "MutiOption_Text"|| first_question.option_type == "MutiOption_Image")){
    
                    if ( isPromise( pOption ) == false ){
                        continue;
                    }
    
                    pOption.then( function( ret ){
                        Entity = ret;
    
                        if(first_question.option_type == "MutiOption_Text"){
    
                            console.log(" *** loaded: " , Entity.object3D );
    
                            let circlePos = new THREE.Vector3(0,0,0);
                            let circleRot = new THREE.Vector3(0,0,0);
                            let circleScale = new THREE.Vector3(1,1,1);
    
                            let base = document.createElement("a-plane");
                            base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                            base.setAttribute("id","circle_base");
                            base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false" );
                            // self.setTransform(base, circlePos, circleRot, circleScale);
                            Entity.appendChild(base);
    
                            let circle = document.createElement("a-plane");
                            circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
                            circle.setAttribute("id","circle_out");
                            circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
                            // self.setTransform(circle, circlePos, circleRot, circleScale);
                            Entity.appendChild(circle);
                            
                            let circle2 = document.createElement("a-plane");
                            circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                            circle2.setAttribute("id","circle_in");
                            circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
                            circle2.setAttribute( "visible", false);
                            // circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
                            // self.setTransform(circle2, circlePos, circleRot, circleScale);
                            Entity.appendChild(circle2);
    
                            /////////////
                            // console.log(" *** geometry-set: " , Entity.object3D , Entity.getObject3D("mesh").geometry.attributes.position.array[0] );
                            // console.log('VRFunc.js: _loadQuiz: scale ', Entity.object3D.parent.scale , Entity.object3D  );
    
                            let width = Math.abs(Entity.getObject3D("mesh").geometry.attributes.position.array[0])*2;
                            circlePos.x = circlePos.x + width*0.5 + 0.3/Entity.object3D.parent.el.getAttribute("scale").x;
                            circlePos.z = circlePos.z - 0.01;
                            base.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                            circle.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                            circle2.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
    
                            //[start-20230706-howardhsu-modify]//
                            circleScale.multiply( new THREE.Vector3( 0.2, 0.2, 0.2 ) );
                            //[start-20230706-howardhsu-modify]//
    
                            circleScale.divide(Entity.object3D.parent.el.getAttribute("scale"))
    
                            base.setAttribute("scale" , circleScale );
                            circle.setAttribute("scale" , circleScale );
                            circle2.setAttribute("scale" , circleScale.clone().multiply( new THREE.Vector3( 0.7,0.7,0.7 ) ) );
    
    
                            let f_setRenderOrder = function( evt ){
                                if (evt.target == evt.currentTarget){
                                    // console.log('1 ************ evt= ', evt.target.object3D.children[0] );
                                    if ( evt.target.object3D ){
                                        if ( evt.target.object3D.children[0] ){
                                            evt.target.object3D.children[0].renderOrder = 1;
                                        }
                                    }
                                }
                            }
                            base.addEventListener("loaded", f_setRenderOrder );
                            circle.addEventListener("loaded", f_setRenderOrder );
                            circle2.addEventListener("loaded", f_setRenderOrder );
    
                            /////////////
    
                            // Entity.addEventListener("geometry-set", function(evt){
                            // 	console.log(" *** geometry-set: " , Entity.object3D , Entity.getObject3D("mesh").geometry.attributes.position.array[0] );
                            // 	let width = Math.abs(Entity.getObject3D("mesh").geometry.attributes.position.array[0])*2;
                            // 	circlePos.x = circlePos.x + width*0.5 + 0.3/Entity.object3D.parent.el.getAttribute("scale").x;
                            // 	circlePos.z = circlePos.z - 0.01;
                            // 	base.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                            // 	circle.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                            // 	circle2.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                            // });
    
                            // Entity.addEventListener("loaded", function(evt){
                            // 	Entity.object3D.parent.el.addEventListener("loaded", function(evt){
                            // 		let circleScale = new THREE.Vector3(1,1,1);
                            // 		console.log('VRFunc.js: _loadQuiz: scale ', Entity.object3D.parent.el.getAttribute("scale") , Entity.object3D );
    
                            // 		circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                            // 		circleScale.divide(Entity.object3D.parent.el.getAttribute("scale"))
    
                            // 		base.setAttribute("scale" , circleScale );
                            // 		circle.setAttribute("scale" , circleScale );
                            // 		circle2.setAttribute("scale" , circleScale.clone().multiply( new THREE.Vector3( 0.7,0.7,0.7 ) ) );
                            // 	});
                            // });
    
                        }
                        else{
    
                            ///////
    
                            let circlePos = new THREE.Vector3(0,0,0);
                            let circleRot = new THREE.Vector3(0,0,0);
                            let circleScale = new THREE.Vector3(1,1,1);
    
                            let timeoutID = setInterval( function () {

                                //[start-20230923-howardhsu-add]//    
                                //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                                if (self.module.currentIndex >= self.module.json.display_order_list.length){
                                    window.clearInterval(self.module.timer.currentTimer)
                                }                             
                                //[end-20230923-howardhsu-add]//

                                if (Entity.getAttribute("heightForQuiz")){ 
                                    let height = Entity.getAttribute("heightForQuiz");
    
                                    circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                                    circleScale.divide(Entity.getAttribute("scale"))
                                    circlePos.y = circlePos.y - height/2 - (0.3/Entity.getAttribute("scale").y);
    
                                    let base = document.createElement("a-plane");
                                    base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                    base.setAttribute("id","circle_base");
                                    base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false" );
                                    self.setTransform(base, circlePos, circleRot, circleScale);
                                    Entity.appendChild(base);
        
                                    let circle = document.createElement("a-plane");
                                    circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
                                    circle.setAttribute("id","circle_out");
                                    circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
                                    self.setTransform(circle, circlePos, circleRot, circleScale);
                                    Entity.appendChild(circle);
                                    
                                    let circle2 = document.createElement("a-plane");
                                    circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                    circle2.setAttribute("id","circle_in");
                                    circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
                                    circle2.setAttribute( "visible", false);
                                    circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
                                    self.setTransform(circle2, circlePos, circleRot, circleScale);
                                    Entity.appendChild(circle2);
    
    
                                    let f_setRenderOrder = function( evt ){
                                        if (evt.target == evt.currentTarget){
                                            // console.log('2 ************ evt= ', evt.target.object3D.children[0] );
                                            if ( evt.target.object3D ){
                                                if ( evt.target.object3D.children[0] ){
                                                    evt.target.object3D.children[0].renderOrder = 1;
                                                }
                                            }
                                        }
                                    }
                                    base.addEventListener("loaded", f_setRenderOrder );
                                    circle.addEventListener("loaded", f_setRenderOrder );
                                    circle2.addEventListener("loaded", f_setRenderOrder );
    
                                    
    
                                    window.clearInterval(timeoutID);
                                }
                            }, 1);
    
                            ///////
    
    
                            // Entity.addEventListener("loaded", function(evt){
                            // 	let circlePos = new THREE.Vector3(0,0,0);
                            // 	let circleRot = new THREE.Vector3(0,0,0);
                            // 	let circleScale = new THREE.Vector3(1,1,1);
    
                            // 	let timeoutID = setInterval( function () {
                            // 		if (Entity.getAttribute("heightForQuiz")){ 
                            // 			let height = Entity.getAttribute("heightForQuiz");
    
                            // 			circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                            // 			circleScale.divide(Entity.getAttribute("scale"))
                            // 			circlePos.y = circlePos.y - height/2 - (0.3/Entity.getAttribute("scale").y);
    
                            // 			let base = document.createElement("a-plane");
                            // 			base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                            // 			base.setAttribute("id","circle_base");
                            // 			base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false" );
                            // 			self.setTransform(base, circlePos, circleRot, circleScale);
                            // 			Entity.appendChild(base);
            
                            // 			let circle = document.createElement("a-plane");
                            // 			circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
                            // 			circle.setAttribute("id","circle_out"); 
                            // 			circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
                            // 			self.setTransform(circle, circlePos, circleRot, circleScale);
                            // 			Entity.appendChild(circle);
                                        
                            // 			let circle2 = document.createElement("a-plane");
                            // 			circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                            // 			circle2.setAttribute("id","circle_in");
                            // 			circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
                            // 			circle2.setAttribute( "visible", false);
                            // 			circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
                            // 			self.setTransform(circle2, circlePos, circleRot, circleScale);
                            // 			Entity.appendChild(circle2);
        
                            // 			window.clearInterval(timeoutID);
                            // 		}
                            // 	}, 1);
                                
                            // });
    
                            
                        }
    
                    });
    
                    
    
                }
            }
        }
    
        //// 20210107-每一秒執行一次，將counter減一，並顯示剩餘秒數，到0會跳時間到 ////
        if (this.module.timer.counter >= 0){
            this.module.qClock = Date.now();
            let timeoutID = setInterval(function() {                
                self.module.timer.currentTimer = timeoutID;
                self.module.timer.counter -= 1;
                
                //[start-20230923-howardhsu-add]//    
                //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                if (self.module.currentIndex >= self.module.json.display_order_list.length){
                    window.clearInterval(self.module.timer.currentTimer)
                }                             
                //[end-20230923-howardhsu-add]//

                let hour = Math.floor(self.module.timer.counter/3600);
                let min = Math.floor((self.module.timer.counter-hour*3600)/60);
                let sec = self.module.timer.counter-hour*3600-min*60;
                timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
                // console.log(self.module.timer.counter);
                if (self.module.timer.counter == 0){
    
                    window.clearInterval(self.module.timer.currentTimer);
                    if (obj.module[0].timer_type == "Custom"){
                        if (first_question.show_score){
                            let scoreDiv = document.getElementById("scoreDiv");
                            let score = document.getElementById("score");
                            scoreDiv.style.display = "block";
                            score.textContent = self.module.score;
                            
                        }
                        else{
                            self.nextQuestion();
                        }
                    }
                    else{
                        let temp = []
                        let quizEntity = self.module.quizEntity;
                        for (let item of quizEntity.children) {
                            temp.push(item);
                        }
                        temp.forEach( (item) => {self.clearObject(item)} );
    
                        let tipButtonDiv = document.getElementById("tipButtonDiv");
                        let tipDiv = document.getElementById("tipDiv");
                        tipButtonDiv.style.display = "none";
                        tipDiv.style.display = "none";
    
                        let startQuiz = document.getElementById("startQuiz");
                        let QuizStartButton = document.getElementById("QuizStartButton");
                        let QuizStartContent = document.getElementById("QuizStartContent");
                        startQuiz.style.display = "block";
                        QuizStartContent.textContent = "時間到"
                        
                        let quizIndex = {
                            question: idx ,
                            get_score:  0,
                            answer_time: self.module.json.question_list[idx].time_limit ,
                            answer_options: [],
                            answer_cloze: "",
                            answer_is_enable: false,
                            answer_is: false,
                        }
                        self.module.record[idx] = quizIndex;
                        self.module.record_time += self.module.json.question_list[idx].time_limit;
                        self.module.qClock = Date.now();
    
                        // let timeup = document.getElementById("timeup");
                        // timeup.style.display = "block";
                        // let timeupConfirmButton = document.getElementById("timeupConfirmButton");
                        QuizStartButton.addEventListener("click",function(){
                            startQuiz.style.display = "none";
                            // self.nextQuestion();
                            //[start-20230712-howardhsu-add]//
                            //// 存檔: 沒有下一題，預定紀錄答題狀態上雲端 (就是this.nextQusetion底下else的全部)
                            self.saveQuizStatus();
                            //[end-20230712-howardhsu-add]//
                        });
    
                    }
                }
            },1000);
        }
        //// ---------------------------------------------------------------- ////	
        
        self.setTransform(quizEntity, position, rotation, scale);
        self.appendToVrScene(quizEntity)
    }


    
    //20200723-thonsha-add-start
	pushButton(target){
        
        let self = this

        let goNext = false;
        let answer_options = []; //// 答題 index
        let answer_is = false; //// 答對與否
        let get_score = 0;
        let idx = this.module.json.display_order_list[this.module.currentIndex].index;
        let currectQuestion = this.module.json.question_list[idx];
        let scoreType = this.module.json.score_type;

        let makarDragon = document.getElementById("makarDragon");
        let imgRight = document.getElementById("imgRight");
        let imgWrong = document.getElementById("imgWrong");
        if (currectQuestion.option_type == "Option_Text" || currectQuestion.option_type == "Option_Image"){
            if (currectQuestion.answer_list == null){
                currectQuestion.answer_list = []
            }
            let correctAnswerIdx = currectQuestion.answer_list[0];
            let correctAnswer = currectQuestion.options_json[correctAnswerIdx-1];
            
            let targetId;
            if (target.localName=='a-text'){
                targetId = target.parentNode.id;
            }
            else{
                targetId = target.id;
            }

            //// 查找紀錄『選了哪個選項』
            for (let i = 0, len=currectQuestion.options_json.length; i < len; i++ ){
                if ( currectQuestion.options_json[i].obj_id == targetId ){
                    // console.log(" ***********   " , i , currectQuestion.options_json );
                    answer_options.push(i);
                }
            }

            if (correctAnswer && correctAnswer.obj_id == targetId){
                if (currectQuestion.active_score){
                    if (scoreType == 'Custom'){
                        self.module.score += currectQuestion.score;
                        get_score = currectQuestion.score;
                    }
                    else if(scoreType == 'Total'){
                        let scoreTotal = self.module.json.total_score;
                        self.module.correctAnswer += 1;
                        self.module.score =  Math.round(scoreTotal * self.module.correctAnswer/self.module.totalActiveScoreQuestion);
                        get_score = Math.round( scoreTotal/self.module.totalActiveScoreQuestion );
                    }
                }
                answer_is = true;
                makarDragon.style.display = "block";
                imgRight.style.display = "block";
                imgWrong.style.display = "none";
                console.log("Quiz.js: _pushButton: Congratulations! Correct Answer!");
            }
            else{
                answer_is = false;
                makarDragon.style.display = "block";
                imgRight.style.display = "none";
                imgWrong.style.display = "block";
                console.log("Quiz.js: _pushButton: 叭叭~ Incorrect Answer!");
            }
            
            window.clearInterval(self.module.timer.currentTimer);
            
            self.adjustCursorEntity('remove', 'cursor')

            let counter = self.module.timer.counter;
            setTimeout(function(){
               
                makarDragon.style.display = "none";
                // 完成前一題，預定紀錄於本地的 database，但是viewer 端並沒有如此操作，之後再說
                let quizIndex = {
                    question: idx ,
                    get_score:  get_score,
                    answer_time: Math.round( (Date.now() - self.module.qClock)/1000 ),
                    answer_options: answer_options,
                    answer_cloze: "",
                    answer_is_enable: true,
                    answer_is: answer_is,
                }
                self.module.record[idx] = quizIndex;
                self.module.record_time += Math.round( (Date.now() - self.module.qClock)/1000 );
                self.module.qClock = Date.now();

                if (currectQuestion.show_score){
                    let scoreDiv = document.getElementById("scoreDiv");
                    let score = document.getElementById("score");
                    scoreDiv.style.display = "block";
                    score.textContent = self.module.score;
                    
                }
                else{
                    self.nextQuestion();
                }

            },1600);
            console.log("Quiz.js: _pushButton: score: ", self.module.score , currectQuestion );
            // goNext = true;
        }
        else{

            //// 由於「多選圖片」跟「多選文字」的層級不同，改為完整尋找
            target.object3D.traverse( function( child ){ 
                if ( child.type=='Group' && child.el && child.el.getAttribute('id') == 'circle_in' ){ 
                    let item = child.el;
                    item.setAttribute("visible", !item.getAttribute("visible"));
                    let targetId;
                    if (target.localName=='a-text'){
                        targetId = target.parentNode.id;
                    } else{
                        targetId = target.id;
                    }
                    if (self.module["choices"].includes(targetId)){
                        let choices_idx = self.module["choices"].indexOf(targetId);
                        self.module["choices"].splice(choices_idx,1);
                    }
                    else{
                        self.module["choices"].push(targetId);
                    }
                    console.log("Quiz.js: _pushButton: choices = ", self.module["choices"]);

                } 
                else if ( child.type=='Group' && child.el && child.el.getAttribute('id') == 'circle_out' ){
                    let item = child.el;
                    if (item.getAttribute( "material",).color == "#7B7B7B"){
                        item.setAttribute( "material", "color:#00d1c1;" ); 
                    }
                    else if (item.getAttribute( "material",).color == "#00d1c1"){
                        item.setAttribute( "material", "color:#7B7B7B;" ); 
                    }
                }

            });

            // for (let item of target.children) {
            // 	if (item.getAttribute("id") == "circle_in"){
            // 		item.setAttribute("visible", !item.getAttribute("visible"));
            // 		//20200901-text-geometry-test
            // 		// if (target.object3D.parent.parent.el){
            // 		//20200901-text-geometry-test
            // 		if (target.localName=='a-text'){
            // 			targetId = target.parentNode.id;
            // 		}
            // 		else{
            // 			targetId = target.id;
            // 		}

            // 		if (self.module["choices"].includes(targetId)){
            // 			choices_idx = self.module["choices"].indexOf(targetId);
            // 			self.module["choices"].splice(choices_idx,1);
            // 		}
            // 		else{
            // 			self.module["choices"].push(targetId);
            // 		}
            // 		console.log("VRFunc.js: _nextQuestion: choices = ", self.module["choices"]);
            // 	}
            // 	else if(item.getAttribute("id") == "circle_out"){
            // 		if (item.getAttribute( "material",).color == "#7B7B7B"){
            // 			item.setAttribute( "material", "color:#00d1c1;" ); 
            // 		}
            // 		else if (item.getAttribute( "material",).color == "#00d1c1"){
            // 			item.setAttribute( "material", "color:#7B7B7B;" ); 
            // 		}
            // 	}
            // }


            if (target.object3D.sub_type == "button"){
                let correctCount = 0;
                if (currectQuestion.answer_list == null){
                    currectQuestion.answer_list = []
                }
                for (let correct_idx of currectQuestion.answer_list){
                    let correctAnswer = currectQuestion.options_json[correct_idx];
                    if (correctAnswer){
                        for (let choicesId of self.module["choices"]){
                            if(choicesId == correctAnswer.obj_id){
                                correctCount += 1;
                            }
                        }
                    }
                }


                for (let i = 0, len = currectQuestion.options_json.length; i < len; i++ ){
                    for (let j = 0, len2 = self.module["choices"].length; j < len2; j++ ){
                        if (currectQuestion.options_json[i].obj_id == self.module["choices"][j] ){
                            answer_options.push( i-1 );
                        }
                    }
                }

                if (correctCount == currectQuestion.answer_list.length && currectQuestion.answer_list.length == self.module["choices"].length){
                    if (currectQuestion.active_score){
                        if (scoreType == 'Custom'){
                            self.module.score += currectQuestion.score;
                            get_score = currectQuestion.score;
                        }
                        else if(scoreType == 'Total'){
                            let scoreTotal = self.module.json.total_score;
                            self.module.correctAnswer += 1;
                            self.module.score =  Math.round(scoreTotal * self.module.correctAnswer/self.module.totalActiveScoreQuestion);
                            get_score = Math.round( scoreTotal/self.module.totalActiveScoreQuestion );
                        }
                    }
                    answer_is = true;
                    makarDragon.style.display = "block";
                    imgRight.style.display = "block";
                    imgWrong.style.display = "none";
                    console.log("Quiz.js: _pushButton: Congratulations! Correct Answer!");
                }
                else{
                    answer_is = false;
                    makarDragon.style.display = "block";
                    imgRight.style.display = "none";
                    imgWrong.style.display = "block";
                    console.log("Quiz.js: _pushButton: 叭叭~ Incorrect Answer!");
                }
                window.clearInterval(self.module.timer.currentTimer);                
                
                let counter = self.module.timer.counter;
                setTimeout(function(){
                    self.adjustCursorEntity('set', 'geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;")
                    // vrController.cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;" );

                    makarDragon.style.display = "none";
                    // 完成前一題，預定紀錄於本地的 database，但是viewer 端並沒有如此操作，之後再說
                    // console.log("Quiz.js: score , currectQuestion = ", idx, self.module , self.module["choices"] , answer_options , get_score );
                    console.log("Quiz.js: _pushButton: " , self.module.json.question_list[idx].time_limit, counter, Math.round( (Date.now() - self.module.qClock)/1000 ) );
                    let quizIndex = {
                        question: idx ,
                        get_score:  get_score,
                        answer_time:  Math.round( (Date.now() - self.module.qClock)/1000 ) ,
                        answer_options: answer_options,
                        answer_cloze: "",
                        answer_is_enable: true,
                        answer_is: answer_is,
                    }
                    self.module.record[idx] = quizIndex;
                    self.module.record_time += Math.round( (Date.now() - self.module.qClock)/1000 );
                    self.module.qClock = Date.now();

                    if (currectQuestion.show_score){
                        let scoreDiv = document.getElementById("scoreDiv");
                        let score = document.getElementById("score");
                        scoreDiv.style.display = "block";
                        score.textContent = self.module.score;
                        
                    }
                    else{
                        self.nextQuestion();
                    }
                    
                },1600);
                console.log("Quiz.js: _pushButton: score: ", self.module.score , currectQuestion );
                // goNext = true;
            }
        }
        
    }
    //20200723-thonsha-add-end


    nextQuestion(){

        this.module["choices"] = []
        let temp = []

        //[start-20230921-howardhsu-add]//
        // console.log("clear previous question's timer", self.module.timer)
        window.clearInterval(this.module.timer.currentTimer)
        //[end-20230921-howardhsu-add]//
        
        // let quizEntity;
        //20200901-text-geometry-test
        // if (target.object3D.parent.parent.el){
        //20200901-text-geometry-test
        // if (target.localName == "a-text"){
        // 	quizEntity = target.object3D.parent.parent.el;
        // }
        // else{
        // 	quizEntity = target.object3D.parent.el;
        // }
        let self = this

        let quizEntity = this.module.quizEntity;
        for (let item of quizEntity.children) {
            temp.push(item);
        }
        temp.forEach( (item) => {self.clearObject(item)} );

        this.module.currentIndex += 1;
        if (this.module.currentIndex < this.module.json.display_order_list.length){
            let idx = this.module.json.display_order_list[this.module.currentIndex].index
            let next_question = this.module.json.question_list[idx];

            if(this.module.json.timer_type == "Custom"){
                this.module.timer.counter = next_question.time_limit;
            }

            let tipButtonDiv = document.getElementById("tipButtonDiv");
            if(next_question.show_tips){
                tipButtonDiv.style.display = "block";
                tipButtonDiv.addEventListener("click",function(){
                    let tipDiv = document.getElementById("tipDiv");
                    let tipConfirmButton = document.getElementById("tipConfirmButton");
                    let tipContent = document.getElementById("tipContent");
                    tipDiv.style.display = "block";
                    tipContent.textContent = next_question.tips_content;
                    tipConfirmButton.addEventListener("click",function(){
                        tipDiv.style.display = "none";
                    });
                });
            }
            else{
                tipButtonDiv.style.display = "none";
            }

            if ( next_question.questions_json && Array.isArray( next_question.questions_json ) ){
                for(let i=0; i<next_question.questions_json.length; i++){
                    let position = new THREE.Vector3().fromArray(next_question.questions_json[i].transform[0].split(",").map(function(x){return Number(x)}) );
                    let rotation = new THREE.Vector3().fromArray(next_question.questions_json[i].transform[1].split(",").map(function(x){return Number(x)}) );
                    let scale    = new THREE.Vector3().fromArray(next_question.questions_json[i].transform[2].split(",").map(function(x){return Number(x)}) );
                    let type = next_question.questions_json[i].main_type;
                    switch(type){
                        case "text":
                            this.addTextToScene(next_question.questions_json[i], position, rotation, scale);
                            break;
                        case "image":
                            this.addTextureToScene(next_question.questions_json[i], position, rotation, scale);
                            break;
                        case "video":
                            this.addVideoToScene(next_question.questions_json[i], position, rotation, scale);
                            break;
                        case "model":
                            this.addGLTFModelToScene(next_question.questions_json[i], position, rotation, scale );
                            break;
                    }
                }
            }
            

            if ( next_question.options_json && Array.isArray( next_question.options_json ) ){

                for(let i=0; i<next_question.options_json.length; i++){
                    let position = new THREE.Vector3().fromArray(next_question.options_json[i].transform[0].split(",").map(function(x){return Number(x)}) );
                    let rotation = new THREE.Vector3().fromArray(next_question.options_json[i].transform[1].split(",").map(function(x){return Number(x)}) );
                    let scale    = new THREE.Vector3().fromArray(next_question.options_json[i].transform[2].split(",").map(function(x){return Number(x)}) );
                    let sub_type = next_question.options_json[i].sub_type;
                    let Entity;

                    let pOption;

                    switch(sub_type){
                        case "txt":
                            pOption = this.addTextToScene(next_question.options_json[i], position, rotation, scale);
                            break;
                        case "gif":
                        case "jpg":
                        case "jpeg":
                        case "png":
                            pOption = this.addTextureToScene(next_question.options_json[i], position, rotation, scale);
                            break;
                        case "button":
                            next_question.options_json[i].res_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png";
                            pOption = this.addTextureToScene(next_question.options_json[i], position, rotation, scale);
                            break;
                    }
                    if (sub_type != "button" && (next_question.option_type == "MutiOption_Text"|| next_question.option_type == "MutiOption_Image")){

                        if ( isPromise( pOption ) == false ){
                            continue;
                        }

                        pOption.then( function( ret ){

                            Entity = ret;

                            if(next_question.option_type == "MutiOption_Text"){

                                let circlePos = new THREE.Vector3(0,0,0);
                                let circleRot = new THREE.Vector3(0,0,0);
                                let circleScale = new THREE.Vector3(1,1,1);

                                let base = document.createElement("a-plane");
                                base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                base.setAttribute("id","circle_base");
                                base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false" );
                                // self.setTransform(base, circlePos, circleRot, circleScale);
                                Entity.appendChild(base);

                                let circle = document.createElement("a-plane");
                                circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
                                circle.setAttribute("id","circle_out");
                                circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
                                // self.setTransform(circle, circlePos, circleRot, circleScale);
                                Entity.appendChild(circle);
                                
                                let circle2 = document.createElement("a-plane");
                                circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                circle2.setAttribute("id","circle_in");
                                circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
                                circle2.setAttribute( "visible", false);
                                // circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
                                // self.setTransform(circle2, circlePos, circleRot, circleScale);
                                Entity.appendChild(circle2);

                                let f_setRenderOrder = function( evt ){
                                    if (evt.target == evt.currentTarget){
                                        if ( evt.target.object3D ){
                                            if ( evt.target.object3D.children[0] ){
                                                evt.target.object3D.children[0].renderOrder = 1;
                                            }
                                        }
                                    }
                                }
                                base.addEventListener("loaded", f_setRenderOrder );
                                circle.addEventListener("loaded", f_setRenderOrder );
                                circle2.addEventListener("loaded", f_setRenderOrder );

                                /////////

                                // console.log(" *** geometry-set: " , Entity.object3D , Entity.getObject3D("mesh").geometry.attributes.position.array[0] );
                                // console.log('Quiz.js: _load: scale ', Entity.object3D.parent.scale , Entity.object3D  );

                                let width = Math.abs(Entity.getObject3D("mesh").geometry.attributes.position.array[0])*2;
                                circlePos.x = circlePos.x + width*0.5 + 0.3/Entity.object3D.parent.el.getAttribute("scale").x;
                                circlePos.z = circlePos.z - 0.01;
                                base.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                                circle.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                                circle2.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );

                                circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                                circleScale.divide(Entity.object3D.parent.el.getAttribute("scale"))

                                base.setAttribute("scale" , circleScale );
                                circle.setAttribute("scale" , circleScale );
                                circle2.setAttribute("scale" , circleScale.clone().multiply( new THREE.Vector3( 0.7,0.7,0.7 ) ) );

                                /////////

                                // Entity.addEventListener("geometry-set", function(evt){
                                // 	console.log(" *** geometry-set: " , Entity.object3D , Entity.getObject3D("mesh").geometry.attributes.position.array[0] );
                                // 	let width = Math.abs(Entity.getObject3D("mesh").geometry.attributes.position.array[0])*2;
                                // 	circlePos.x = circlePos.x + width*0.5 + 0.3/Entity.object3D.parent.el.getAttribute("scale").x;
                                // 	circlePos.z = circlePos.z - 0.01;
                                // 	base.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                                // 	circle.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                                // 	circle2.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
                                // });
    
                                // Entity.addEventListener("loaded", function(evt){
                                // 	Entity.object3D.parent.el.addEventListener("loaded", function(evt){
                                // 		circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                                // 		circleScale.divide(Entity.object3D.parent.el.getAttribute("scale"))
    
                                // 		base.setAttribute("scale" , circleScale );
                                // 		circle.setAttribute("scale" , circleScale );
                                // 		circle2.setAttribute("scale" , circleScale.clone().multiply( new THREE.Vector3( 0.7,0.7,0.7 ) ) );
                                // 	});
                                // });
                                

                                
                            }
                            else{


                                ////////

                                let circlePos = new THREE.Vector3(0,0,0);
                                let circleRot = new THREE.Vector3(0,0,0);
                                let circleScale = new THREE.Vector3(1,1,1);

                                let timeoutID = setInterval( function () {

                                    //[start-20230923-howardhsu-add]//    
                                    //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                                    if (self.module.currentIndex >= self.module.json.display_order_list.length){
                                        window.clearInterval(self.module.timer.currentTimer)
                                    }                             
                                    //[end-20230923-howardhsu-add]//

                                    if (Entity.getAttribute("heightForQuiz")){ 
                                        let height = Entity.getAttribute("heightForQuiz");
                                        // console.log("20200831",height)
                                        // circlePos.x = circlePos.x + (width/2 + 0.1);
                                        // circlePos.y = circlePos.y - height/2 - 0.2;
                                        circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                                        circleScale.divide(Entity.getAttribute("scale"))
                                        circlePos.y = circlePos.y - height/2 - 0.3/Entity.getAttribute("scale").y;

                                        let base = document.createElement("a-plane");
                                        base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                        base.setAttribute("id","circle_base");
                                        base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false" );
                                        self.setTransform(base, circlePos, circleRot, circleScale);
                                        Entity.appendChild(base);
            
                                        let circle = document.createElement("a-plane");
                                        circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
                                        circle.setAttribute("id","circle_out");
                                        circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
                                        self.setTransform(circle, circlePos, circleRot, circleScale);
                                        Entity.appendChild(circle);
                                        
                                        let circle2 = document.createElement("a-plane");
                                        circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                        circle2.setAttribute("id","circle_in");
                                        circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
                                        circle2.setAttribute( "visible", false);
                                        circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
                                        self.setTransform(circle2, circlePos, circleRot, circleScale);
                                        Entity.appendChild(circle2);

                                        let f_setRenderOrder = function( evt ){
                                            if (evt.target == evt.currentTarget){
                                                if ( evt.target.object3D ){
                                                    if ( evt.target.object3D.children[0] ){
                                                        evt.target.object3D.children[0].renderOrder = 1;
                                                    }
                                                }
                                            }
                                        }
                                        base.addEventListener("loaded", f_setRenderOrder );
                                        circle.addEventListener("loaded", f_setRenderOrder );
                                        circle2.addEventListener("loaded", f_setRenderOrder );
        
                                        window.clearInterval(timeoutID);
                                    }
                                }, 1);

                                ////////

                                // Entity.addEventListener("loaded", function(evt){
                                // 	let circlePos = new THREE.Vector3(0,0,0);
                                // 	let circleRot = new THREE.Vector3(0,0,0);
                                // 	let circleScale = new THREE.Vector3(1,1,1);

                                // 	let timeoutID = setInterval( function () {
                                // 		if (Entity.getAttribute("heightForQuiz")){ 
                                // 			let height = Entity.getAttribute("heightForQuiz");
                                // 			// console.log("20200831",height)
                                // 			// circlePos.x = circlePos.x + (width/2 + 0.1);
                                // 			// circlePos.y = circlePos.y - height/2 - 0.2;
                                // 			circleScale.multiply( new THREE.Vector3( 0.4, 0.4, 0.4 ) );
                                // 			circleScale.divide(Entity.getAttribute("scale"))
                                // 			circlePos.y = circlePos.y - height/2 - 0.3/Entity.getAttribute("scale").y;

                                // 			let base = document.createElement("a-plane");
                                // 			base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                // 			base.setAttribute("id","circle_base");
                                // 			base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#3C3C3C; depthWrite:false" );
                                // 			self.setTransform(base, circlePos, circleRot, circleScale);
                                // 			Entity.appendChild(base);
                
                                // 			let circle = document.createElement("a-plane");
                                // 			circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
                                // 			circle.setAttribute("id","circle_out");
                                // 			circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
                                // 			self.setTransform(circle, circlePos, circleRot, circleScale);
                                // 			Entity.appendChild(circle);
                                            
                                // 			let circle2 = document.createElement("a-plane");
                                // 			circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
                                // 			circle2.setAttribute("id","circle_in");
                                // 			circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
                                // 			circle2.setAttribute( "visible", false);
                                // 			circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
                                // 			self.setTransform(circle2, circlePos, circleRot, circleScale);
                                // 			Entity.appendChild(circle2);
            
                                // 			window.clearInterval(timeoutID);
                                // 		}
                                // 	}, 1);
                                    
                                // });

                            }

                        });
                    }
                }

            }
            

            let timerContent = document.getElementById('timerContent');

            if(self.module.json.timer_type == "Custom"){
                if (self.module.timer.counter >= 0){
                    let hour = Math.floor(self.module.timer.counter/3600);
                    let min = Math.floor((self.module.timer.counter-hour*3600)/60);
                    let sec = self.module.timer.counter-hour*3600-min*60;
                    timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
                }
            }

            setTimeout(function(){                
                //// 20210107-每一秒執行一次，將counter減一，並顯示剩餘秒數，到0會跳時間到 ////
    
                if (self.module.timer.counter >= 0){
                    self.module.qClock = Date.now();
                    
                    window.clearInterval(self.module.timer.currentTimer)
                    
                    let timeoutID = setInterval(function() {
                        
                        self.module.timer.currentTimer = timeoutID;
                        self.module.timer.counter -= 1;

                        //[start-20230923-howardhsu-add]//
                        //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                        if (self.module.currentIndex >= self.module.json.display_order_list.length){
                            window.clearInterval(self.module.timer.currentTimer)
                        }
                        //[end-20230923-howardhsu-add]//

                        let hour = Math.floor(self.module.timer.counter/3600);
                        let min = Math.floor((self.module.timer.counter-hour*3600)/60);
                        let sec = self.module.timer.counter-hour*3600-min*60;
                        timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
                        // console.log("Quiz.js: _nextQuestion: this.module.timer.counter=", self.module.timer.counter);
                        if (self.module.timer.counter <= 0){
                            window.clearInterval(self.module.timer.currentTimer);
                            if (self.module.json.timer_type == "Custom"){
                                if (next_question.show_score){
                                    let scoreDiv = document.getElementById("scoreDiv");
                                    let score = document.getElementById("score");
                                    scoreDiv.style.display = "block";
                                    score.textContent = self.module.score;
                                    
                                }
                                else{
                                    self.nextQuestion();
                                }
                            }
                            else{
                                let temp = []
                                let quizEntity = self.module.quizEntity;
                                for (let item of quizEntity.children) {
                                    temp.push(item);
                                }
                                temp.forEach( (item) => {self.clearObject(item)} );
                                
                                let tipButtonDiv = document.getElementById("tipButtonDiv");
                                let tipDiv = document.getElementById("tipDiv");
                                tipButtonDiv.style.display = "none";
                                tipDiv.style.display = "none";
                                
                                let startQuiz = document.getElementById("startQuiz");
                                let QuizStartButton = document.getElementById("QuizStartButton");
                                let QuizStartContent = document.getElementById("QuizStartContent");
                                QuizStartContent.textContent = "時間到"

                                //[start-2023mmdd-howardhsu-modify]//
                                if(self.module.timer.counter == 0){
                                    startQuiz.style.display = "block";
                                }
                                //[end-2023mmdd-howardhsu-modify]//

                                let quizIndex = {
                                    question: idx ,
                                    get_score:  0,
                                    answer_time: self.module.json.question_list[idx].time_limit ,
                                    answer_options: [],
                                    answer_cloze: "",
                                    answer_is_enable: false,
                                    answer_is: false,
                                }
                                self.module.record[idx] = quizIndex;
                                self.module.record_time += self.module.json.question_list[idx].time_limit;
                                self.module.qClock = Date.now();

                                QuizStartButton.addEventListener("click",function(){
                                    startQuiz.style.display = "none";
                                    // self.nextQuestion();													
                                    //[start-20230712-howardhsu-add]//
                                    //// 存檔: 沒有下一題，預定紀錄答題狀態上雲端 (就是底下else的全部)
                                    self.saveQuizStatus();
                                    //[end-20230712-howardhsu-add]//
                                });
                            }
                        }
                    },1000);
                }
                
                //// -------------------------------------------------------------- ////
                // cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.04; radiusInner: 0.02; thetaLength: 360; thetaStart: 0;" );
            }, 3000);
        }else{
            //// 沒有下一題，把『觸控』開回來
            // vrController.cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );

            //// 沒有下一題，預定紀錄答題狀態上雲端            
            window.clearInterval(self.module.timer.currentTimer);
            let timer = document.getElementById("timerDiv");
            timer.style.display = "none";
            let tipButtonDiv = document.getElementById("tipButtonDiv");
            let tipDiv = document.getElementById("tipDiv");
            tipButtonDiv.style.display = "none";
            tipDiv.style.display = "none";

            let quizEndDiv = document.getElementById("quizEndDiv");
            quizEndDiv.style.display = "block";
            quizEndDiv.addEventListener("click", function(){
                quizEndDiv.style.display = "none";
            });

            let projectIdx = self.getProjectIdx()
            // console.log("Quiz.js: this.module: ", self.module , projectIdx,  publishVRProjs.result[projectIdx] );
            console.log("Quiz.js: quiz end , this.module.record = " , self.module.record  );
            let playing_user = "", device_id = "";
            if (localStorage.getItem("login_shared_id") ){
                playing_user = localStorage.getItem("login_shared_id");
            }
            if (localStorage.getItem("device_id")){
                device_id = localStorage.getItem("device_id");
            }
            //quiz_log
            let quizVRLogData  = {
                user_id: publishVRProjs.result[projectIdx].user_id ,
                playing_user: playing_user , //// 在還沒有登入流程時候 一定要設為空字串
                proj_id: publishVRProjs.result[projectIdx].proj_id ,
                proj_type: "vr" ,
                device_id: device_id ,
                brand:"",
                os: navigator.userAgent , 
                location_long:0.0,
                location_lan:0.0,
                module:[ self.module.json ],
                record_time: self.module.record_time,
                record_score: self.module.score ,
                record:self.module.record,

            }

            //// 目前存放分為 『log資訊』給『數據分析』 跟 『專案遊玩資訊』給『viewer 查詢』 
            quizLog( window.serverUrl , quizVRLogData);
            
            for (let i = 0, len = userPublishProjs.proj_list.length; i < len; i++){
                if (userPublishProjs.proj_list[i].proj_id == publishVRProjs.result[projectIdx].proj_id ){
                    // quizVRRecord = userPublishProjs.proj_list[i];
                    // quizVRRecord.playing_user_id = playing_user;
                    let quizVRRecord = {
                        head_pic: userPublishProjs.proj_list[i].head_pic,
                        loc: userPublishProjs.proj_list[i].loc,
                        module_type: userPublishProjs.proj_list[i].module_type,
                        name: userPublishProjs.proj_list[i].name,
                        playing_user_id: playing_user,
                        proj_cover_urls: userPublishProjs.proj_list[i].proj_cover_urls,
                        proj_id: userPublishProjs.proj_list[i].proj_id,
                        proj_name: userPublishProjs.proj_list[i].proj_name,
                        proj_type: "vr",
                        shared_id: userPublishProjs.proj_list[i].shared_id,
                        snapshot_url: userPublishProjs.proj_list[i].snapshot_url,
                        user_id: userPublishProjs.proj_list[i].user_id,
                    }
                    updateRecordModule(window.serverUrl , quizVRRecord );
                    console.log("Quiz.js: quiz end, " , i , userPublishProjs.proj_list[i] , quizVRRecord );
                }
            }
            
            console.log("Quiz.js: quiz end , quizVRLogData = " , quizVRLogData );
            
        }
    }



    //[start-20230712-howardhsu-add]//
    saveQuizStatus(){				
        //// 沒有下一題，把『觸控』開回來
        // vrController.cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );

        //// 沒有下一題，預定紀錄答題狀態上雲端        
        console.log("find timer 1400", this.module.timer)

        window.clearInterval(this.module.timer.currentTimer);
        let timer = document.getElementById("timerDiv");
        timer.style.display = "none";
        let tipButtonDiv = document.getElementById("tipButtonDiv");
        let tipDiv = document.getElementById("tipDiv");
        tipButtonDiv.style.display = "none";
        tipDiv.style.display = "none";

        let quizEndDiv = document.getElementById("quizEndDiv");
        quizEndDiv.style.display = "block";
        quizEndDiv.addEventListener("click", function(){
            quizEndDiv.style.display = "none";
        });

        const projectIdx = this.getProjectIdx()
        // console.log("VRFunc.js: this.module: ", this.module , projectIdx,  publishVRProjs.result[projectIdx] );
        console.log("VRFunc.js: quiz end , this.module.record = " , this.module.record  );
        let playing_user = "", device_id = "";
        if (localStorage.getItem("login_shared_id") ){
            playing_user = localStorage.getItem("login_shared_id");
        }
        if (localStorage.getItem("device_id")){
            device_id = localStorage.getItem("device_id");
        }
        //quiz_log
        let quizVRLogData  = {
            user_id: publishVRProjs.result[projectIdx].user_id ,
            playing_user: playing_user , //// 在還沒有登入流程時候 一定要設為空字串
            proj_id: publishVRProjs.result[projectIdx].proj_id ,
            proj_type: "vr" ,
            device_id: device_id ,
            brand:"",
            os: navigator.userAgent , 
            location_long:0.0,
            location_lan:0.0,
            module:[ this.module.json ],
            record_time: this.module.record_time,
            record_score: this.module.score ,
            record:this.module.record,

        }

        //// 目前存放分為 『log資訊』給『數據分析』 跟 『專案遊玩資訊』給『viewer 查詢』 
        quizLog( window.serverUrl , quizVRLogData);
        
        for (let i = 0, len = userPublishProjs.proj_list.length; i < len; i++){
            if (userPublishProjs.proj_list[i].proj_id == publishVRProjs.result[projectIdx].proj_id ){
                // quizVRRecord = userPublishProjs.proj_list[i];
                // quizVRRecord.playing_user_id = playing_user;
                let quizVRRecord = {
                    head_pic: userPublishProjs.proj_list[i].head_pic,
                    loc: userPublishProjs.proj_list[i].loc,
                    module_type: userPublishProjs.proj_list[i].module_type,
                    name: userPublishProjs.proj_list[i].name,
                    playing_user_id: playing_user,
                    proj_cover_urls: userPublishProjs.proj_list[i].proj_cover_urls,
                    proj_id: userPublishProjs.proj_list[i].proj_id,
                    proj_name: userPublishProjs.proj_list[i].proj_name,
                    proj_type: "vr",
                    shared_id: userPublishProjs.proj_list[i].shared_id,
                    snapshot_url: userPublishProjs.proj_list[i].snapshot_url,
                    user_id: userPublishProjs.proj_list[i].user_id,
                }
                updateRecordModule(window.serverUrl , quizVRRecord );
                console.log("VRFunc.js: quiz end, " , i , userPublishProjs.proj_list[i] , quizVRRecord );
            }
        }

        console.log("VRFunc.js: quiz end , quizVRLogData = " , quizVRLogData );	
    }
    //[end-20230712-howardhsu-add]//    

}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Quiz);


/***/ }),

/***/ "./js/VRMain/version3_4/VRFunc.js":
/*!****************************************!*\
  !*** ./js/VRMain/version3_4/VRFunc.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Quiz_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Quiz.js */ "./js/VRMain/version3_4/Quiz.js");


////// developVR 20191021 
(function() {
	
	var integrate = function(){
		console.log("window.Module", window.Module)

		AFRAME.registerComponent('initvrscene', {
			init: function () {
				var sceneEl = this.el;
			}
		});
	
		AFRAME.registerComponent('cursor-listener', {
			init: function () {
				//20191023-start-thonsha-mod

				// this.el.addEventListener( 'touchend', endEvent, false );
				// this.el.addEventListener( 'mouseup', endEvent, false );
				// this.el.addEventListener( 'click', clickEvent, false );
				// this.el.addEventListener( 'fusing', fusingEvent, false );

				function fusingEvent(event){
					event.preventDefault();
					// console.log('I was fusing, this.object3D = ', this.object3D , event );
					if (event.target == event.currentTarget){
						// console.log('I was fusing, this.object3D = ', this.object3D , event );.
						if (this.object3D.behav){
							delay = this.object3D.behav[0].display*1000+5;
							// console.log("======= delay :"+delay+" =====");
							let cursor = document.getElementById("cursor_main");
							cursor.setAttribute('cursor', "fuseTimeout:"+ delay);
							cursor.setAttribute('animation__mouseenter', "dur: "+delay );
						}

						if (this.object3D.main_type == "button"){
							delay = 3*1000+5;
							// console.log("======= delay :"+delay+" =====");
							let cursor = document.getElementById("cursor_main");
							cursor.setAttribute('cursor', "fuseTimeout:"+ delay);
							cursor.setAttribute('animation__mouseenter', "dur: "+delay );
						}

					}
					

				}	

				function clickEvent( event ) {
					event.preventDefault();
					console.log('I was clicked, this.object3D = ', this.object3D , event );
					if (event.target == event.currentTarget){
						// console.log('I was clicked, this.object3D = ', this.object3D , event );
						
						if ( this.object3D.behav ){

							if (!vrController.triggerEnable){
								console.log("VRFunc.js: _clickEvent: please wait three second for _triggerEanble");
								return;
							}

							//// deal the group	
							//// 找出此次觸發事件中含有 group 的部份
							for (let i = 0; i < this.object3D.tWorldVisiblebehav.length; i++ ){
								if (this.object3D.behav[i].group){
									//// 找出所有場上物件中，掛有觸發事件的物件
									for ( let j = 0; j < vrController.makarObjects.length; j++ ){
										let makarObject = vrController.makarObjects[j];
										if (makarObject.object3D){
											if (makarObject.object3D.makarObject && makarObject.object3D.behav ){

												for (let k = 0; k < makarObject.object3D.behav.length; k++ ){
													//// 找出除了自己以外掛有相同 group 的物件
													if (makarObject.object3D.behav[k].group == this.object3D.behav[i].group &&  makarObject.object3D != this.object3D ){
														// console.log(" ************* " , i , j , k , makarObject.object3D.behav[k] , this.object3D.behav[i].group );
														let groupObj = document.getElementById(makarObject.object3D.behav[k].obj_id);
														vrController.hideGroupObjectEvent(groupObj);
													}
												}

											}
										}
									}
								}
							}




							let reset = false;
							for(let i=0;i<this.object3D.behav.length;i++){
								if (this.object3D.behav[i].simple_behav == "CloseAndResetChildren"){
									reset = true;
								}
							}

							for(let i=0;i<this.object3D.behav.length;i++){
								if (this.object3D.behav[i].simple_behav != "CloseAndResetChildren"){
									
									//[start-20230919-howardhsu-modify]//
									if(touchObject.behav[i].simple_behav == "ShowQuiz"){
											
										//// 顯示 quiz 之前，先判斷 "瀏覽器本次載入場景後" 是否已經遊玩
										if(touchObject.behav[i].played == false){
											touchObject.behav[i].played = true	
											vrController.triggerEvent( touchObject.behav[i], reset, touchObject )
										} else {
											console.log('VRFunc.js: _setupFunction: endEvent:  Quiz had been played.', touchObject.behav[i].played)
										}

									} else {
										vrController.triggerEvent( touchObject.behav[i], reset, self.GLRenderer, null, touchObject );
									}
									
								}
							}
							
						}
						// if (this.object3D.main_type == "button"){
						// 	console.log("VRFunc.js: button click " , this.object3D );
						// 	vrController.pushButton(this);
						// }
						//[end-20230920-howardhsu-modify]//	
					}
				}
				
				//20191023-end-thonsha-mod

			}
		});
	
		var VRController = function(){
			//// scene 2D part
			this.GLRenderer = null;
			this.scene2D = null;
			this.camera2D = null;
			this.light = null;
	
			//// MAKAR part
			this.vrScene = null;
			this.publishVRProjs = null;
			this.VRSceneResult = null;
			this.makarVRscenes = {};

			this.makarObjects = [];

			///// 此陣列只會在「每次載入場景完成之後作修改」，目前為了讓「點擊移動功能」可以在 滑鼠移動時候作判斷使用
			this.currentSceneMakarObjects = [];

//20200528-thonsha-add-start
			this.loadSceneCount = 0
			this.module = null;
			this.cursorEntity = null;
//20200528-thonsha-add-end
//20200807-thonsha-add-start
			this.projectIdx = null;
//20200807-thonsha-add-end

//20220105-thonsha-add-start
			this.intervalList = [];
//20220105-thonsha-add-end

			//// for update
			this.FUNCTION_ENABLED = false;
			this.clock = new THREE.Clock();
			this.delta = this.time = 0;

			//// 沒有特別的用意，主要是為了讓每次 create <video> 的 id 不相同
			this.triggerEnable = false;

			//// 紀錄『滑鼠』『觸碰』狀態
			this.touchMouseState = -1;


			//// 紀錄「觸發事件」中帶有「群組」的事件
			this.groupDict = {
				0: {activeObj:null,objs:[]},
				1: {activeObj:null,objs:[]},
				2: {activeObj:null,objs:[]},
				3: {activeObj:null,objs:[]},
				4: {activeObj:null,objs:[]},
				5: {activeObj:null,objs:[]},
				6: {activeObj:null,objs:[]},
				7: {activeObj:null,objs:[]},
			};

			//// 紀錄「注視事件」
			this.lookAtObjectList = [];
			this.lookAtTimelineDict = {};


		}

		function UrlExists(url , callback ){
			let httpRequest = new XMLHttpRequest();
			httpRequest.open('HEAD', url, true);
			httpRequest.onload = function(e){
				console.log(" VRFunc.js: _UrlExists: httpRequest status= " , httpRequest.status  );
				callback( httpRequest.status == "200" );
			}
			
			httpRequest.onerror = function(e){
				console.log( 'onerror e=', e );
				callback( httpRequest.status == "200" );

			}
			httpRequest.onabort = function(e){
				console.log( 'onabort e=', e );
				callback( httpRequest.status == "200" );
			}
			httpRequest.send();
		}

		function isPromise(p) {
			if (typeof p === 'object' && typeof p.then === 'function') {
			  return true;
			}
			return false;
		}
		
		VRController.prototype.UrlExistsFetch = async function( url ){

			let ret = await fetch(url, {method: 'HEAD'})

			console.log('_VRController: _UrlExists2: ret ', ret );
			if ( ret.status ){
				return ret.status == '200';
			}else{
				return false ;
			}


		};
	
		VRController.prototype.setupFunction = function(){
			if (this.FUNCTION_ENABLED) {
				return;
			}
			// console.log("VRFunc.js: VRController: setupFunction");
			this.FUNCTION_ENABLED = true;
			var self = this;
	
			this.loadAssets = function(index){
				let assets = document.createElement("a-assets");
				assets.setAttribute('id', "makarAssets" );
				assets.setAttribute('timeout', "1000" );
				assets.setAttribute('crossorigin', 'anonymous');
				self.vrScene.appendChild(assets);
				// self.makarObjects.push( assets );
			};
			//////
			////// load the nth scene in specific prroject
			////// At first, will called for load the first scene. 
			this.loadScene = function(projIndex, sceneIndex) {
				// console.log("VRFunc.js: VRController: _loadScene: [projectIndex, sceneIndex]=", projIndex, sceneIndex);
				//// 載入場景的時候，先顯示處『載入頁面』直到圖片或是影片 onload 再隱藏『載入頁面』，**** 目前不使用此功能 **** 

				if (self.VRSceneResult[projIndex].scenes[sceneIndex] == undefined ){
					console.log("VRFunc.js: VRController: _loadScene: error, [valid sceneIndex]=", self.VRSceneResult[projIndex].scenes.length, sceneIndex);
				}else{

					//// 紀錄 場景 編號
					this.sceneIndex = sceneIndex;

					//// 換場景時無條件先清除所有影片
					let videos = document.getElementsByTagName('video');
					if ( videos.length > 0 ){
						for (let i = 0; i < videos.length; i++ ){
							videos[i].pause();
							videos[i].removeAttribute("src"); // empty source 	
							videos[i].load();
						}
					}

					//// 換場景時無條件先清除所有聲音
					let audios = document.getElementsByTagName('audio');
					if ( audios.length > 0 ){
						for (let i = 0; i < audios.length; i++ ){
							audios[i].pause();
							audios[i].removeAttribute("src"); // empty source 	
							audios[i].load();
						}
					}

					if (self.makarObjects){ //// clean the additional object( without default object like, camera, cursor,  )
						for (let i = 0; i < self.makarObjects.length; i++ ){
							let makarObject = self.makarObjects[i];
							// makarObject.parentNode.removeChild( makarObject ); // this will remove the children, childNodes and object3D's children

							if ( makarObject.object3D ){
								makarObject.object3D.traverse( c =>{
									if ( c.isMesh ){
										
										if ( c.material ){
											if ( c.material.map ){
												if ( c.material.map.dispose ){
													c.material.map.dispose();													
												}
											}
											c.material.dispose();
										}

										if ( c.geometry ){
											c.geometry.dispose();
										}

									}
								});
							}

							makarObject.remove();

						}
						self.makarObjects.length = 0; // clean the array.
					}

					//// 清除「當前場景有的物件」
					if ( Array.isArray( self.currentSceneMakarObjects ) ){
						self.currentSceneMakarObjects.length = 0;
					}

					//// 假如曾經載入過環景圖片，清除
					if ( self.cubeTex ){
						if ( self.cubeTex.texture ){
							self.cubeTex.texture.dispose();
						}
						self.cubeTex.dispose();
					}

					self.needsRenderTarget = false;

					//// 判定「版本」
					var editor_version = [];
					if (typeof(self.VRSceneResult[projIndex].editor_ver) != "string" ){
						console.log("VRFunc.js: _loadSceneObjects: the editor_ver is not string, error and return ");
						return -1;
					}else{
						editor_version = self.VRSceneResult[projIndex].editor_ver.split(".");
					}

					//// 紀錄「當前使用的版本」
					self.editor_version = editor_version;

					//// 依照版本來確認「 sky 」
					let scene_skybox_url;
					let sceneSky_info = self.editorVerionControllSky( editor_version , projIndex, sceneIndex );
					if ( sceneSky_info.scene_skybox_main_type == 'spherical_video' ){
						scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg";
					}else if ( sceneSky_info.scene_skybox_main_type == 'spherical_image' ){
						if ( sceneSky_info.scene_skybox_url == "DefaultResource/Spherical_Image/SphericalImage.png"  ){
							scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
						} else {
							scene_skybox_url = sceneSky_info.scene_skybox_url;
						}
					}else {
						scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
					}

					//// 檢查 「 sky 」是否存在，否的話使用「預設灰圖」作為 環景環境圖。往下載入「場景物件」
					UrlExists( scene_skybox_url, function( retStatus ){
						if (retStatus == false){
							scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg";
						}
	
						let targetCube;
						if ( THREE.WebGLRenderTargetCube ){
							targetCube = new THREE.WebGLRenderTargetCube(1024, 1024);
						}else{
							targetCube = new THREE.WebGLCubeRenderTarget( 1024 );
						}

						// let mPmremGenerator = new THREE.PMREMGenerator( self.vrScene.renderer );
						// mPmremGenerator.compileEquirectangularShader();
						


						let renderer = self.vrScene.renderer;
						// renderer.toneMapping = THREE.ACESFilmicToneMapping;
						if ( THREE.GammaEncoding ){
							renderer.outputEncoding = THREE.GammaEncoding;
							// renderer.outputEncoding = THREE.sRGBEncoding;
							renderer.gammaFactor = 1;
						}

						
						// renderer.outputEncoding = THREE.sRGBEncoding;
	
						//// 從「 場景資料 」來查看是否有「 behav / behav_rederence 」設置錯誤，有的話把 behav_rederence 修改
						self.checkVRSceneResultBehav();

						//// 每次載入場景，先清除「事件相關」的資料。包含「事件群組」「注視事件」
						self.clearBehavs();


						let envTexture = new THREE.TextureLoader().load(
							scene_skybox_url,
							function() 
							{
								let cubeTex = targetCube.fromEquirectangularTexture(renderer, envTexture);
								self.cubeTex = cubeTex;

								self.loadSceneCount++;
								self.loadAssets(); //// for video elements
								let pAll = self.loadSceneObjects(projIndex, sceneIndex);
								let pSky = self.loadSky(projIndex, sceneIndex, sceneSky_info);

								pSky.then( function( ret ){
									console.log('VRFunc.js: _loadScene: pSky then ret = ', ret );
									
								});

								//// 假如此專案的當前場景有「邏輯功能」，加入「處理列表」
								if (publishVRProjs.result[projIndex].xml_urls && publishVRProjs.result[projIndex].xml_urls[ sceneIndex ] ){
									//// 下載對應的「邏輯腳本」
									let pXML = self.parseLogicXML(projIndex , sceneIndex );
									pAll.push( pXML );

								}

								Promise.all( pAll.concat( pSky ) ).then( function( ret ){

									console.log('VRFunc.js: _loadScene: pAll then ret = ', ret );

									//20221206-thonsha-add-start
									self.onlySkyScene.add(document.getElementById("sky").object3D.clone(true))
									//20221206-thonsha-add-end

									// self.vrScene.renderer.shadowMap.needsUpdate = true;

									loadPage.style.display = "none";
									homePage.style.display = "none";
									
									//// 同時關閉「起始載入畫面動畫」 和 「切換場景載入中動畫」
									if ( homeTickOn ){
										homeTickOn = false;
									}

									if ( typeof( self.loadingTickOn )  != undefined ){
										self.loadingTickOn = false;
									}

									self.triggerEnable = true;

									//// 假如此專案當前場景有「邏輯」，解析並且執行功能
									if (publishVRProjs.result[projIndex].xml_urls && publishVRProjs.result[projIndex].xml_urls[ sceneIndex ] &&
										self.logic.xmlDoc != null 
									){
										self.logic.parseXML();
									}
								
									//// 載入場景完成後，解析一下場景的「事件 / behav」跟「事件參照 behav_reference 」是否有錯誤。
									self.setupSceneBehav();

									//// 載入場景完成，解析物件所佔範圍
									setTimeout( function(){
										self.calcSceneArea();
									}, 1 )

									
									//// 載入場景完成後，判斷當前 UI 是否顯示，顯示的話執行隱藏
									if ( parent && parent.projMenuGroup && parent.controlGroup && parent.pictureBackground && parent.projectUIController && 
										typeof(parent.projectUIController.showUI) == 'function' && typeof( parent.projectUIController.hideUI ) == 'function' 
									){
										if ( parent.projectUIController.status == -1 ){
											parent.projectUIController.showUI();
										}
									}

								});


							}
						);
					});
					
				}
			}




			//// 依照不同編輯器版本，控制「天空物件」
			this.editorVerionControllSky = function (editor_version , projIndex , sceneIndex ){
				let sceneSky_info = {
					scene_skybox_url:'',
					scene_skybox_main_type: '',
				};

				console.log("VRFunc.js: _editorVerionControllSky: " ,editor_version, VRSceneResult[projIndex].scenes[sceneIndex]  );

				//// 一定要含有大中小三個版號
				if (editor_version.length == 3) {
					//// 大中小版號
					let v0 = editor_version[0], v1 = editor_version[1], v2 = editor_version[2];
					switch(v0){
						case "3":
							///// 只要是 3.3.2 以下 的版本
							if ( ( v1 < 3  ) ){

								sceneSky_info.scene_skybox_url = VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_url;
								sceneSky_info.scene_skybox_main_type = VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_main_type;
								sceneSky_info.scene_snapshot_url = VRSceneResult[projIndex].scenes[sceneIndex].scene_snapshot_url;

								console.log("VRFunc.js: _editorVerionControllSky: below 3.3.2 " , VRSceneResult[projIndex].scenes[sceneIndex] );

							} else if ( v1 >= 3 && v2 >= 2 ){
								sceneSky_info.scene_skybox_url = VRSceneResult[projIndex].scenes[sceneIndex].environment.scene_skybox_url;
								sceneSky_info.scene_skybox_main_type = VRSceneResult[projIndex].scenes[sceneIndex].environment.scene_skybox_main_type;
								sceneSky_info.scene_snapshot_url = VRSceneResult[projIndex].scenes[sceneIndex].environment.scene_snapshot_url;
								console.log("VRFunc.js: _editorVerionControllSky: after 3.3.2 " , VRSceneResult[projIndex].scenes[sceneIndex] );
							}else if ( v1 >= 4 ){
								sceneSky_info.scene_skybox_url = VRSceneResult[projIndex].scenes[sceneIndex].environment.scene_skybox_url;
								sceneSky_info.scene_skybox_main_type = VRSceneResult[projIndex].scenes[sceneIndex].environment.scene_skybox_main_type;
								sceneSky_info.scene_snapshot_url = VRSceneResult[projIndex].scenes[sceneIndex].environment.scene_snapshot_url;
								console.log("VRFunc.js: _editorVerionControllSky: after 3.4.0 " , VRSceneResult[projIndex].scenes[sceneIndex] );
							}else{
								console.log("VRFunc.js: _editorVerionControllSky: large version error " , VRSceneResult[projIndex].scenes[sceneIndex] );
							}
							break;
						case "2":
						case "1":
							console.log("VRFunc.js: _editorVerionControllSky: largeVersion below 3" , self.VRSceneResult[projIndex] );
							sceneSky_info.scene_skybox_url = VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_url;
							sceneSky_info.scene_skybox_main_type = VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_main_type;
							sceneSky_info.scene_snapshot_url = VRSceneResult[projIndex].scenes[sceneIndex].scene_snapshot_url;
							break;

						default:
							console.log("VRFunc.js: _editorVerionControllSky: missing large version " , self.VRSceneResult[projIndex] );
					}

				} else {
					if ( self.VRSceneResult[projIndex].editor_ver == "" ){
						////// the empty editor_ver , do version below 3.0.6 
						if ( !Array.isArray(self.VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_url ) ){
							console.log("VRFunc.js: _editorVerionControllSky the scene_skybox_url is not exist, error", self.VRSceneResult[projIndex] );
							return -1;
						}
						console.log("VRFunc.js: _editorVerionControllSky: the editor version empty", self.VRSceneResult[projIndex] );
						sceneSky_info.scene_skybox_url = VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_url;
						sceneSky_info.scene_skybox_main_type = VRSceneResult[projIndex].scenes[sceneIndex].scene_skybox_main_type;
						sceneSky_info.scene_snapshot_url = VRSceneResult[projIndex].scenes[sceneIndex].scene_snapshot_url;
					}
				}

				return sceneSky_info;
			}
			







			this.editorVersionControllObjs = function (editor_version , projIndex , sceneIndex ){
				let scene_objs;

				//// 一定要含有大中小三個版號
				if (editor_version.length == 3) {
					
					//// 大中小版號
					let v0 = editor_version[0], v1 = editor_version[1], v2 = editor_version[2];

					switch(v0){
						case "3":
							if ( v1 == 0 && v2 <= 6 ){
								if ( !Array.isArray(self.VRSceneResult[projIndex].scenes[sceneIndex].scene_objs ) ){
									console.log("VRFunc.js: _editorVerionControll the scenes[sceneIndex] is not Array, error", self.VRSceneResult[projIndex] );
									return -1;
								}
								console.log("VRFunc.js: _editorVerionControll: the editor version before 3.0.6", self.VRSceneResult[projIndex] );
								scene_objs = self.VRSceneResult[projIndex].scenes[sceneIndex].scene_objs;
							} else if ( v1 == 1 || ( v1 ==0 && v2 >= 7 ) ) {
								console.log("VRFunc.js: _editorVerionControll: the editor version after 3.0.7", self.VRSceneResult[projIndex] );
								scene_objs = self.VRSceneResult[projIndex].scenes[sceneIndex].objs;
							} else if ( v1 == 2 || v1 >= 3  ){
								console.log("VRFunc.js: _editorVerionControll: the editor version is 3.2.n or 3.3.n", self.VRSceneResult[projIndex] );
								scene_objs = self.VRSceneResult[projIndex].scenes[sceneIndex].objs;
								//// 此版本需要由 scenes 下調整相機參數 
								if (self.VRSceneResult[projIndex].scenes[sceneIndex].camera_rotation && self.VRSceneResult[projIndex].scenes[sceneIndex].fov){

									let rotation = new THREE.Vector3().fromArray(self.VRSceneResult[projIndex].scenes[sceneIndex].camera_rotation.split(",").map(function(x){return Number(x)}) );
									rotation.multiply( new THREE.Vector3(-1,-1,0) ).add( new THREE.Vector3(0, 180, 0) );
									
									let aCamera = document.getElementById( "aCamera" );
									let oCamera = document.getElementById( "oCamera" );
									
									// camera_cursor.setAttribute("rotation", rotation ); ////// it is work
									function lookContorlsLoaded(){
										
										console.log("VRFunc.js: _editorVerionControll: aCamera set fov = ", VRSceneResult[projIndex].scenes[sceneIndex].fov );
										let vrScene = document.getElementById("vrscene");
										vrScene.camera.fov = VRSceneResult[projIndex].scenes[sceneIndex].fov;

										//// 依照「外部選擇」來調整起始「觀看模式」


										aCamera.setAttribute('camera', { fov: VRSceneResult[projIndex].scenes[sceneIndex].fov } );
										oCamera.setAttribute('camera', { fov: VRSceneResult[projIndex].scenes[sceneIndex].fov } );
										
										if ( parent.selectedProject ){
											if ( parent.selectedProject.viewMode == 'XR' ){
												self.setViewMode( 'VR' );
											}else if (parent.selectedProject.viewMode == 'model'){
												
												self.setViewMode( 'model' );
											}else{
												self.setViewMode( 'VR' );
											}
										}else{
											self.setViewMode( 'VR' );
										}

										vrScene.camera.updateProjectionMatrix();

										console.log("VRFunc.js: _editorVerionControll: aCamera loaded rotation=", rotation );
										
										// aCamera.components["look-controls"].yawObject.rotation.set(0,0,0);
										// aCamera.components["look-controls"].pitchObject.rotation.set(0,0,0);

										aCamera.components["look-controls"].yawObject.rotation.y = rotation.y/180*Math.PI;
										aCamera.components["look-controls"].pitchObject.rotation.x = rotation.x/180*Math.PI;
										// aCamera.object3D.position.set(0,1.7,0);
										
										console.log("VRFunc.js: _loadSceneObjects aCamera: yawr=", aCamera.components["look-controls"].yawObject.rotation ,
																					   ", pitchr=" , aCamera.components["look-controls"].pitchObject.rotation  );
										
										aCamera.removeEventListener("look-controls-loaded", lookContorlsLoaded); // 假如重新載入場景，不能再執行一次
									}

									//// reset the aCamera 
									if ( aCamera ){
										if (aCamera.components["look-controls"].yawObject && aCamera.components["look-controls"].pitchObject){

											console.log("VRFunc.js: _editorVerionControll: aCamera look-controls already set" );
											lookContorlsLoaded({});
										}else{
											console.log("VRFunc.js: _editorVerionControll: aCamera look-controls not set yet" );
											aCamera.addEventListener("look-controls-loaded" , lookContorlsLoaded );
										}
									}
									
								}


							}else {
								console.error("VRFunc.js: _editorVerionControll: the editor version after 3.2 , error ", self.VRSceneResult[projIndex] );
								//// use version 3.0.6
								scene_objs = self.VRSceneResult[projIndex].scenes[sceneIndex].objs;
							}

							break;
						case "2":
						case "1":
							console.log("VRFunc.js: _editorVerionControll: largeVersion below 3" , self.VRSceneResult[projIndex] );
							scene_objs = self.VRSceneResult[projIndex].scenes[sceneIndex].scene_objs;
							break;

						default:
							console.log("VRFunc.js: _editorVerionControll: missing large version " , self.VRSceneResult[projIndex] );
					}


 				}else{

					if ( self.VRSceneResult[projIndex].editor_ver == "" ){
						////// the empty editor_ver , do version below 3.0.6 
						if ( !Array.isArray(self.VRSceneResult[projIndex].scenes[sceneIndex].scene_objs ) ){
							console.log("VRFunc.js: _loadSceneObjects the scene_objs_v2 is not Array, error", self.VRSceneResult[projIndex] );
							return -1;
						}
						console.log("VRFunc.js: _loadSceneObjects: the editor version empty", self.VRSceneResult[projIndex] );
						scene_objs = self.VRSceneResult[projIndex].scenes[sceneIndex].scene_objs;
					}


				}
				  
				
				return scene_objs;
			}

	////// load the sky, 360 image/video
			this.loadSky = function( projIndex, sceneIndex, sceneSky_info ){
				// console.log("VRFunc.js: _loadSky: main type=", VRSceneResult[projIndex].scenes[0].scene_skybox_main_type, VRSceneResult[projIndex].scenes[0].scene_skybox_url);
				// scene_skybox_main_type: "spherical_video"


				// let editor_version = [];
				// if (typeof(self.VRSceneResult[projIndex].editor_ver) != "string" ){
				// 	console.log("VRFunc.js: _loadSky: the editor_ver is not string, error and return ");
				// 	return -1;
				// }else{
				// 	editor_version = self.VRSceneResult[projIndex].editor_ver.split(".");
				// }

				// let sceneSky_info = self.editorVerionControllSky( editor_version , projIndex, sceneIndex );

				let pSky = new Promise( function( skyResolve ){

					UrlExists( sceneSky_info.scene_skybox_url , function( retStatus ){
					
						let aSky;
						console.log(' ******  retStatus = ', retStatus, sceneSky_info.scene_skybox_url );
						if (retStatus == false){
							//// 因為有些舊的專案 sky url 會404，這邊改為先檢查 url status，假如不存在，則強迫設定為預設圖片（或是直接不載入）
	
							if (document.getElementById("sky")){
								aSky = document.getElementById("sky");
								if (aSky.localName == "a-sky"){
									//// 之前的 sky 是圖片，什麼都不用作
								}else if (aSky.localName == "a-videosphere"){
									//// 之前的 sky 是影片
									aSky.remove();
									aSky = document.createElement('a-sky');
									aSky.setAttribute('id', "sky" );
									self.vrScene.appendChild(aSky);
								}
							}else{
								aSky = document.createElement('a-sky');
								aSky.setAttribute('id', "sky" );
								self.vrScene.appendChild(aSky);
							}
							
							if( sceneSky_info.scene_skybox_url == "DefaultResource/Spherical_Image/SphericalImage.png"){
								
							} else{
	
								//// 跳出錯誤提示
								let errorText = document.createElement('div');
								errorText.style.position = 'absolute';
								errorText.style.top = '30%';
								errorText.style.left = '0%';
								errorText.style.width = '100%';
								errorText.style.height = '40%';
								errorText.style.color = 'black';
								errorText.style.backgroundColor = 'rgba(128,128,128,0.5)';
								errorText.style.pointerEvents = 'none';
								errorText.style.fontSize = '24px';
								errorText.style.zIndex = 3;
	
								document.body.appendChild( errorText )
	
								let text = document.createElement('div');
								text.className = 'centerText';
								text.style.whiteSpace = 'pre-wrap';
								text.textContent = '此專案的環景影片/圖片無法於瀏覽器支援，改為預設場景'
								errorText.appendChild( text );
	
								setTimeout(function(){
									errorText.remove();
								}, 8000);
	
							}

							//// 判斷是否「場景相同來源」，是的話直接隱藏「載入頁面」。否的話執行載入新圖片
							let skySameSrc = false;
							if (aSky.getAttribute('material') ){
								if (aSky.getAttribute('material').src == sceneSky_info.scene_skybox_url ){
									// console.log(' VRFunc.js: _loadSky same src '  );
									skySameSrc = true;
								}
							}

							if ( skySameSrc == true ){
								console.log("VRFunc.js: _loadSky: spherical_image same as previous(404)");

								
								skyResolve(aSky);
							} else {

								aSky.setAttribute("material", {src: "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png" });
	
								aSky.setAttribute("radius", 2000 ); // if not set this, will be infinite
								
								var handleLoadingPage = function(){
									console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page ");
									
									//// 將自己移除事件，避免重複觸發事件
									aSky.removeEventListener("materialtextureloaded" , handleLoadingPage );
								};
								aSky.addEventListener("materialtextureloaded" , handleLoadingPage );
								skyResolve(aSky);
							}

							
						} else {
							switch ( sceneSky_info.scene_skybox_main_type ){
								case "spherical_image":
								case "image":
	
									if (document.getElementById("sky")){
										aSky = document.getElementById("sky");
										if (aSky.localName == "a-sky"){
											//// 之前的 sky 是圖片，什麼都不用作
										}else if (aSky.localName == "a-videosphere"){
											//// 之前的 sky 是影片
											aSky.remove();
											aSky = document.createElement('a-sky');
											aSky.setAttribute('id', "sky" );
											self.vrScene.appendChild(aSky);
										}
									}else{
										aSky = document.createElement('a-sky');
										aSky.setAttribute('id', "sky" );
										self.vrScene.appendChild(aSky);
									}
									
		
									if( sceneSky_info.scene_skybox_url == "DefaultResource/Spherical_Image/SphericalImage.png"){
										sceneSky_info.scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
									}
		
									//// 判斷是否「場景相同來源」，是的話直接隱藏「載入頁面」。否的話執行載入新圖片
									let skySameSrc = false;
									if (aSky.getAttribute('material') ){
										if (aSky.getAttribute('material').src == sceneSky_info.scene_skybox_url ){
											// console.log(' VRFunc.js: _loadSky same src '  );
											skySameSrc = true;
										}
									}
		
									if (skySameSrc == false){
										aSky.setAttribute("material", {"src": sceneSky_info.scene_skybox_url }); 
				
										var handleLoadingPage = function(){
											console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page ");
											
											
											//// 將自己移除事件，避免重複觸發事件
											aSky.removeEventListener("materialtextureloaded" , handleLoadingPage );
											skyResolve(aSky);
										};
										aSky.addEventListener("materialtextureloaded" , handleLoadingPage );
				
									}else{
										console.log("VRFunc.js: _loadSky: spherical_image same as previous  ");
		
										
										skyResolve(aSky);
									}
		
									aSky.setAttribute("radius", 2000 ); // if not set this, will be infinite
		
									break;
				
								case "spherical_video":
									////// a-assets
									let assets = document.getElementById("makarAssets");
									
									////// mp4 video 
									// var aSky = document.createElement('a-videosphere');
									if (document.getElementById("sky")){
										aSky = document.getElementById("sky");
										if (aSky.localName == "a-sky"){
											//// 之前的 sky 是圖片，刪掉再創新的
											aSky.remove();
											aSky = document.createElement('a-videosphere');
											aSky.setAttribute('id', "sky" );
											self.vrScene.appendChild(aSky);
										}else if (aSky.localName == "a-videosphere"){
											//// 之前的 sky 是影片，不用額外動作
											
										}
									}else{
										aSky = document.createElement('a-videosphere');
										aSky.setAttribute('id', "sky" );
										self.vrScene.appendChild(aSky);
									}
		
									// aSky.setAttribute("src", self.VRSceneResult[projIndex].scenes[0].scene_skybox_url ); //  this is work, but hard to control the tag
		
									let skyVideo = document.createElement("video");
									skyVideo.src = sceneSky_info.scene_skybox_url;  
									skyVideo.playsInline = true;
									skyVideo.autoplay = true;
									//// 預設「靜音」								
									skyVideo.muted = true;
		
									skyVideo.setAttribute("loop", "true");
									skyVideo.setAttribute('type', 'video/mp4');
									if (window.Browser){
										if ( window.Browser.name == undefined || window.Browser.name == "safari"){
										// if ( Browser.mobile == true || Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
											skyVideo.muted = true;
										}
									}
									skyVideo.onloadedmetadata = function() {
										console.log("VRFunc.js: _loadSky: spherical_video onloadedmetadata");
										skyVideo.play();
									}
		
									skyVideo.setAttribute('crossorigin', 'anonymous');
									skyVideo.setAttribute('id', self.VRSceneResult[projIndex].scenes[sceneIndex].scene_id + "_" + self.loadSceneCount );
		
									// skyVideo.play(); // play pause
									skyVideo.setAttribute("autoplay", "true" ); 
									// skyVideo.setAttribute("loop", "true" ); 
				
									assets.appendChild(skyVideo); ////// add video into a-assets
									// aSky.setAttribute("src", "#skyVideo" );  
									aSky.setAttribute("src", "#"+self.VRSceneResult[projIndex].scenes[sceneIndex].scene_id + "_" + self.loadSceneCount ); // 
		
				
									aSky.setAttribute("radius", 2000 ); // if not set this, will be infinite
									
		
									var handleLoadingPage = function(){
										console.log("VRFunc.js: _loadSky: spherical_video materialtextureloaded, remove loading page ");
										
										//// 將自己移除事件，避免重複觸發事件
										aSky.removeEventListener("materialtextureloaded" , handleLoadingPage );
	
										skyResolve(aSky);
									};
									aSky.addEventListener("materialtextureloaded" , handleLoadingPage );
		
									break;
		
							}
							console.log("VRFunc.js: _loadSky: aSky=", aSky );

						}
						
					});

				});
				

				return pSky;

			};
			//////
			////// load all object in the scene
			//////
			this.loadSceneObjects = function( projIndex, sceneIndex ){
				if (!userProjResDict){
					console.log("%cVRFunc.js: _loadSceneObjects: error userProjResDict not exist, return -1", "color:red");
					return [];
				}

				let scene_objs = [];
				var editor_version = [];
				if (typeof(self.VRSceneResult[projIndex].editor_ver) != "string" ){
					console.log("VRFunc.js: _loadSceneObjects: the editor_ver is not string, error and return ");
					return [];
				}else{
					editor_version = self.VRSceneResult[projIndex].editor_ver.split(".");
				}

				//// 版本控制，3.2.0 版本以上會有 相機設定參數在 scenes 層級，也在此函式內設定
				scene_objs = self.editorVersionControllObjs(editor_version, projIndex , sceneIndex);
				if (!Array.isArray(scene_objs)) return [];

				//// 所有物件都要作 「 完成判斷 」各自設立 promise
				let pObjs = [];

				for (let i = 0; i < scene_objs.length ; i++  ){
					// console.log("VRFunc.js: _loadSceneObjects: obj=", self.VRSceneResult[projIndex].scenes[sceneIndex].scene_objs[i] );  //// 這句似乎print不出東西 scene_objs 會 undefined
					
					let position = new THREE.Vector3().fromArray(scene_objs[i].transform[0].split(",").map(function(x){return Number(x)}) );
					let rotation = new THREE.Vector3().fromArray(scene_objs[i].transform[1].split(",").map(function(x){return Number(x)}) );
					let scale    = new THREE.Vector3().fromArray(scene_objs[i].transform[2].split(",").map(function(x){return Number(x)}) );
					
					switch( scene_objs[i].main_type ){
						case "camera":
							
							//// 假如編輯器版本大於 3.2.0 不參考 camera 物件
							if (self.VRSceneResult[projIndex].editor_ver ){
								if ( typeof(self.VRSceneResult[projIndex].editor_ver) == "string" ){
									var editor_version = self.VRSceneResult[projIndex].editor_ver.split(".");
									if (editor_version.length == 3){
										if (editor_version[0] == 3 && editor_version[1] == 2 ){
											console.log("VRFunc.js: _loadSceneObjects: camera: editor vesion is 3.2.n , dont set" );
											break;
										}
									}
								}
							}

							let camera_cursor = document.getElementById( "camera_cursor" );
							
							var setupCamera = function(){
								if (!camera_cursor.hasLoaded){
									setTimeout(setupCamera, 100);
									console.log("VRFunc.js: _loadSceneObjects: camera: not loaded, wait" );							
								}else{
									// camera_cursor.setAttribute("randomN", Math.random() ); ////// it is work
									// camera_cursor.setAttribute("rotation", { x: 0 , y: 180, z: 0 } ); ////// it is work
									// rotation = new THREE.Vector3( 0 , 180 , 0 ); ////// set for test
									rotation.multiply( new THREE.Vector3(-1,-1,0) ).add( new THREE.Vector3(0, 180, 0) ); //// because the makar editor coordinate
									
									// camera_cursor.setAttribute("rotation", rotation ); ////// it is work, 不再將旋轉資訊放置於此，改為更新 aCamera 上
									camera_cursor.setAttribute("position", position ); ////// it is work

									//// reset the aCamera 
									if (aCamera.components["look-controls"].yawObject && aCamera.components["look-controls"].pitchObject){

										//// 編輯器上相機旋轉資訊更新於此，可解決子母旋轉問題
										aCamera.components["look-controls"].yawObject.rotation.y = rotation.y/180*Math.PI;
										aCamera.components["look-controls"].pitchObject.rotation.x = rotation.x/180*Math.PI;

										aCamera.object3D.position.set(0,0,0);
										console.log("VRFunc.js: _loadSceneObjects aCamera: yawr=", aCamera.components["look-controls"].yawObject.rotation ,
																					", pitchr=" , aCamera.components["look-controls"].pitchObject.rotation  );
									}

									// camera_cursor.object3D.rotation.set( 0, 180 * Math.PI/180 , 0 , "YXZ" ); ///// actually, looks control will control this object3D, but I cant modify it directly..  
									console.log("VRFunc.js: _loadSceneObjects: camera: ", i, scene_objs[i], position, rotation, camera_cursor, self.vrScene );							
								}								
							} 

							setTimeout(setupCamera, 10);

							// this.setTransform( camera_cursor,
							// 	position, rotation, scale
							// );
							
							break;
						case "image":

							let obj = scene_objs[i];
							console.log("VRFunc.js: _loadSceneObjects: image: ", i, scene_objs[i] );
							if (userProjResDict[ obj.res_id ] ){
								// console.log("VRFunc.js: _loadSceneObjects: image res_url", i, obj.res_url, userProjResDict[obj.res_id].res_url  );
								if ( obj.res_url == userProjResDict[obj.res_id].res_url ){
									// console.log("%cVRFunc.js: _loadSceneObjects: image res_url is same as userProjResDict", "color:blue"   );
									// console.log("%cVRFunc.js: _loadSceneObjects: image res_url is same as userProjResDict", "color:blue" , obj  );

									let pTexture = self.loadTexture(obj, position, rotation, scale );
									pObjs.push( pTexture );

								}else{
									console.log("%cVRFunc.js: _loadSceneObjects: image res_url is different from userProjResDict!", "color:red" , i , obj, userProjResDict[obj.res_id] );	
								}
							}else{
								// console.log("%cVRFunc.js: _loadSceneObjects: image res_id not exist!", "color:red" , i );	

								switch(obj.res_id){
									case "MakAR_Call":
										obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Call.png";
										break;
									case "MakAR_Room": 
										obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Room.png";
										break;
									case "MakAR_Mail": 
										obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Mail.png";
										break;
									case "Line_icon":
										obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Line_icon.png";
										break;
									case "FB_icon":
										obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/FB_icon.png";
										break;
									default:
										// console.log("image: default, obj=", window.sceneResult[i].data.scene_objs_v2[j]);
										console.log("%c VRFunc.js: _loadSceneObjects: image res_id not exist!", "color:red" , obj );	
										// obj.res_url = 'https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/icon/qm256.png';
								}

								let pTexture = self.loadTexture(obj, position, rotation, scale );
								pObjs.push( pTexture );
								
							}

							break;
							
						//20191204-start-thonsha-add
						case "text":
							console.log("VRFunc.js: _loadText: text: ", i, scene_objs[i] );
							let pText = self.loadText( scene_objs[i] , position, rotation, scale);
							pObjs.push( pText );
							break;

						//20191204-end-thonsha-add
						
						//20191105-start-thonsha-add
						case "audio":

							if ((scene_objs[i].sub_type == "mp3" || scene_objs[i].sub_type == "wav" || scene_objs[i].sub_type == "ogg" ) && scene_objs[i].res_url){
								let pAudio = self.loadAudio(scene_objs[i] , position, rotation, scale );
								pObjs.push( pAudio );
							}

							break;

						//20191105-end-thonsha-add

						case "video":

							// console.log("VRFunc.js: _loadSceneObjects: video, scene_objs=", scene_objs[i] );
							if ( scene_objs[i].sub_type == "mp4" && scene_objs[i].res_url  ){
								let pVideo = self.loadVideo( scene_objs[i] , position, rotation, scale );
								pObjs.push( pVideo );
							}

							break;

						case "model":
							
							////// check by user resource 
							console.log("VRFunc.js: _loadSceneObjects: model", i, scene_objs[i]  );
							if ( userProjResDict[ scene_objs[i].res_id ]  ){
								// console.log("VRFunc.js: _loadSceneObjects: model from user resource");
								scene_objs[i].res_url = userProjResDict[scene_objs[i].res_id].res_url ;
							} else if ( userOnlineResDict[ scene_objs[i].res_id ] ) { 
								// console.log("VRFunc.js: _loadSceneObjects: model from online resource" , userOnlineResDict[scene_objs[i].res_id].res_url );
								scene_objs[i].res_url = userOnlineResDict[scene_objs[i].res_id].res_url ;
							} else {
								// console.log(" __________VRFunc.js: _loadSceneObjects: model not exist");

								switch(scene_objs[i].res_id){
									case "Cube":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Cube.glb";
										break;
									case "Capsule":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Capsule.glb";
										break;
									case "Sphere":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Sphere.glb";
										break;
									case "ch_Bojue":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Bojue.glb";
										break;
									case "ch_Fei":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Fei.glb";
										break;
									case "ch_Lina":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Lina.glb";
										break;
									case "ch_Poyuan":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Poyuan.glb";
										break;
									case "ch_Roger":
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Roger.glb";
										break;
									default:
										
										if (scene_objs[i].res_gltf_resource){												
											break;
										}

										scene_objs[i].material = [];
										scene_objs[i].res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";
										break;
								}


							}
							let pModel = self.loadGLTFModel(scene_objs[i], position, rotation, scale , self.cubeTex );
								
							pObjs.push( pModel );

							break;
							
						case "light":
								console.log("VRFunc.js: _loadSceneObjects: light", i, scene_objs[i]  );
								self.loadLight(scene_objs[i], position, rotation, scale);
								break;
							
						case "empty":
							//// 之後空物件會有其他用途，目前大多
							
							switch (scene_objs[i].sub_type){
								case "quiz":
									
									//[start-20230920-howardhsu-modify]//							
									//// 如果 Quiz 有設定啟動物件
									if(scene_objs[i].module[0].trigger){	

										//// 在 Quiz 的啟動物件 的 behav，增加"ShowQuiz"屬性，用來記錄和啟動對應的 Quiz 物件																	
										let timeoutID = setInterval( function () {
																		
											let quizTrigger = document.getElementById(scene_objs[i].module[0].trigger);
											if (quizTrigger){
												window.clearInterval(timeoutID);	
												
												if (quizTrigger.object3D.behav) {  
													quizTrigger.object3D.behav.push({ obj_id: scene_objs[i].obj_id, played: false, simple_behav: 'ShowQuiz' })
												} else {
													quizTrigger.object3D.behav = [{ obj_id: scene_objs[i].obj_id, played: false, simple_behav: 'ShowQuiz' }]
												}														
								
												//// 上面的沒加到 應該是quiz啟動物件還沒loaded (因為在loaded時behav會被覆蓋) 可是加監聽器卻又沒效果
												// quizTrigger.addEventListener("loaded", () => {
												// 	console.log("loadSceneObjs - empty: quizTrigger scene_objs[i]= loaded之前", quizTrigger.object3D)

												// 	if (quizTrigger.object3D.behav) {  
												// 		quizTrigger.object3D.behav.push({ obj_id: scene_objs[i].obj_id, played: false, simple_behav: 'ShowQuiz' })
												// 	} else {
												// 		quizTrigger.object3D.behav = [{ obj_id: scene_objs[i].obj_id, played: false, simple_behav: 'ShowQuiz' }]
												// 	}	
													
												// 	console.log("loadSceneObjs - empty: quizTrigger scene_objs[i]= loaded之後", quizTrigger.object3D.behav)
												// })
												
												quizTrigger.object3D.triggerQuiz = { obj_id: scene_objs[i].obj_id, played: false }

												//// 如果可以一個物件啟動多個 quiz
												// if (quizTrigger.object3D.triggerQuiz) {  
												// 	quizTrigger.object3D.triggerQuiz.push({obj_id: scene_objs[i].obj_id, played: false})
												// } else {
													// quizTrigger.object3D.triggerQuiz = [{ obj_id: scene_objs[i].obj_id, played: false}]
												// }											
											}
										}, 1);
									}
									//[end-20230920-howardhsu-modify]//

									// break;
									let startQuiz = document.getElementById("startQuiz");		
									
									//[start-20230706-howardhsu-modify]//	
									if(scene_objs[i].module[0].trigger){									
										startQuiz.style.display = "none"
									} else {
										startQuiz.style.display = "block"
									}
									//[end-20230706-howardhsu-modify]//

									let QuizStartButton = document.getElementById("QuizStartButton");
									let startQuizFunc = function(){
												
										//[start-20230920-howardhsu-modify]//
										// self.loadQuiz(scene_objs[i], position, rotation, scale );
										
										let quiz = new _Quiz_js__WEBPACK_IMPORTED_MODULE_0__["default"](scene_objs[i])										
										quiz.load( scene_objs[i], position, rotation, scale );										
										//[end-20230920-howardhsu-modify]//
										
										startQuiz.style.display = "none";
										QuizStartButton.removeEventListener("click",startQuizFunc);
									}
									//// 離開quiz
									let quitQuizFunc = function(){
										startQuiz.style.display = "none";
										QuizStartButton.removeEventListener("click",quitQuizFunc);
									}
									// QuizStartButton.addEventListener("click",startQuizFunc);

									let url = window.serverUrl;
									let login_id = localStorage.getItem("login_shared_id"), proj_id = publishVRProjs.result[self.projectIdx].proj_id;

									//// 假如專案要求『強制登入作答』，檢查是否登入
									if (scene_objs[i].module[0].force_login == true ){
										if (login_id ){
											//// 再檢查是否『允許重複作答』
											if (scene_objs[i].module[0].allow_retry == false ){
												console.log("VRFunc.js: _getRecordModule: get remote: ", login_id, proj_id );
												getRecordModule( url, login_id, proj_id, function(ret){
													console.log("VRFunc.js: _getRecordModule: ret= " , ret );
													if (ret.data.record_module_list ){
														QuizStartContent.textContent = worldContent.userAlreadyPlayed[languageType];
														QuizStartButton.addEventListener("click",quitQuizFunc);
													}else{
														//// 可以重複作答，不用檢查紀錄，直接開始遊玩
														QuizStartContent.textContent = worldContent.clickToPlay[languageType];
														QuizStartButton.addEventListener("click",startQuizFunc);
													}
												});
											}else{
												//// 可以重複作答，不用檢查紀錄，直接開始遊玩
												QuizStartContent.textContent = worldContent.clickToPlay[languageType];
												QuizStartButton.addEventListener("click",startQuizFunc);
											}
										}else{
											//// 沒有登入，不給遊玩，跳出提示
											QuizStartContent.textContent = worldContent.userNotLoginInfo[languageType];
											QuizStartButton.addEventListener("click",quitQuizFunc);
										}
									}else{
										//// 不需要『檢查登入』，直接開始遊玩
										QuizStartContent.textContent = worldContent.clickToPlay[languageType];
										QuizStartButton.addEventListener("click",startQuizFunc);

										//[start-20230712-howardhsu-add]//
										//// 可能這裡也要檢查是否『允許重複作答』?
										//// fei 給的 hint: indexedDB 或 mDB
										//[end-20230712-howardhsu-add]//
									}
									
									console.log("VRFunc.js: _loadSceneObjects: empty, quiz ", i, scene_objs[i] );

									break;
								default:
									console.log("VRFunc.js: _loadSceneObjects: empty object default, ", i, scene_objs[i] );
							}

							break
						default:
							console.log("VRFunc.js: _loadSceneObjects: default", i, scene_objs[i] );
							
					}

				}


				return pObjs;
				// console.log("VRFunc.js: _loadSceneObjects: done, self.makarObjects ", self.makarObjects.length );
			}
	

			//// chkeck is image default image
			//// 
			this.checkDefaultImage = function( obj ){

				switch(obj.res_id){
					case "MakAR_Call":
						obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Call.png";
						break;
					case "MakAR_Room": 
						obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Room.png";
						break;
					case "MakAR_Mail": 
						obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Mail.png";
						break;
					case "Line_icon":
						obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Line_icon.png";
						break;
					case "FB_icon":
						obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/FB_icon.png";
						break;
					default:
						console.log("image: default, obj=",  obj );
				}

			}

			//
			// the html will use this function to load image
			// It is sad that I cant use default a-plane tag to get the image width/height 
			//
			this.loadTexture = function( obj, position, rotation, scale ){
				// console.log("VRFunc.js: VRController: _loadTexture, obj=", obj, position, rotation, scale );
				
				//// 檢查是否為「預設物件」
				self.checkDefaultImage( obj );

				let pTexture = new Promise( function( textureResolve ){

					UrlExists( obj.res_url , function( retStatus ){
						if ( retStatus == true ){

							var texture = new THREE.TextureLoader().load( obj.res_url );
							
							let url_spit_length = obj.res_url.split(".").length
							let imgType = obj.res_url.split(".")[url_spit_length-1].toLowerCase();

							let plane;
							

							obj.sub_type = obj.sub_type.toLowerCase();
							if ( obj.sub_type == 'png' || obj.sub_type == 'jpg' || obj.sub_type == 'jpeg' || obj.sub_type == 'bmp' ){
								imgType = obj.sub_type;
								plane = document.createElement("a-plane");
								plane.setAttribute( "src", obj.res_url ); //// origin
							}else if ( obj.sub_type == 'gif' ) {
								imgType = obj.sub_type;
								plane = document.createElement("a-entity")
							}else if ( obj.sub_type == 'button' ){
								
								///// 因為預設 附型態 是「按鈕」，我又擔心會有物件副檔名不存在，那就設定為 png
								if ( imgType != 'png' && imgType != 'jpg' && imgType != 'jpeg' ){
									imgType = 'png';
								}

								plane = document.createElement("a-plane");
								plane.setAttribute( "src", obj.res_url ); //// origin
							}else {
								console.log('VRFunc.js: _loadTexture: sub_type empty, create empty plane ');
								plane = document.createElement("a-plane");
								textureResolve( plane );
								return;
							}
							//20191101-end-thonsha-mod

							plane.setAttribute( "id", obj.obj_id );//// fei add 
							plane.setAttribute('crossorigin', 'anonymous');
							

							let transparentImage = false
							let chromaKey, slope, threshold, transparentBehav
							if (obj.behav){
								for(let i=0;i<obj.behav.length;i++){
									if (obj.behav[i].simple_behav == "TransparentVideo" || obj.behav[i].simple_behav == "TransparentImage"){
										transparentImage = true;
										chromaKey = obj.behav[i].chromakey;
										slope = obj.behav[i].slope;
										threshold = obj.behav[i].threshold;
										transparentBehav = obj.behav[i];
										// console.log(obj.behav[i]);
									}
								}
							}

							if (transparentImage){
								let rgba = chromaKey.split(",");
								let color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));

								//20191127-start-thonsha-mod
								let HSV = transparentBehav.HSV.split(",");
								let keyH = parseFloat(HSV[0]);
								let keyS = parseFloat(HSV[1]);
								let keyV = parseFloat(HSV[2]);

								if (imgType == "jpg" || imgType == "jpeg" || imgType == "png"){
									if (transparentBehav.mode == 'RGB'){
										// console.log("===============RGB==============")
										plane.setAttribute( "material", "shader: chromaKey; color: #"+color.getHexString()+";transparent: true; side:double; depthWrite:false; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";" ); //// thonsha add shader
									}
									else if (transparentBehav.mode == 'HSV'){
										// console.log("VRFunc.js: image HSV---------------" , keyH , keyS , keyV , transparentBehav.hue , transparentBehav.saturation , transparentBehav.brightness  );
										plane.setAttribute( "material", "shader: HSVMatting; transparent: true; side:double; depthWrite:false; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";" ); //// thonsha add shader
									}
								}
								else if (imgType == "gif"){
									
									if (transparentBehav.mode == 'RGB'){
										plane.setAttribute("geometry", "primitive: plane");
										plane.setAttribute("material", "shader:gif_RGB;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; color: #"+color.getHexString()+"; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";");
									}
									else if (transparentBehav.mode == 'HSV'){
										plane.setAttribute("geometry", "primitive: plane");
										plane.setAttribute("material", "shader:gif_HSV;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";");
									}

								}
								//20191127-end-thonsha-mod
							}
							else{
								if (imgType == "jpg" || imgType == "jpeg" || imgType == "png"){
									// plane.setAttribute( "material", "side:double; opacity: 1.0; transparent: true; " ); //// it is work
									plane.setAttribute( "material", "shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:false" ); //// 圖片不受場上光源影響
									// plane.setAttribute( "material", "shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:true" ); //// 圖片不受場上光源影響
									// plane.setAttribute( "material", "shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:false; depthTest:false;"); //// 圖片不受場上光源影響

									plane.setAttribute("geometry", "primitive: plane");
									
								}
								else if (imgType == "gif"){
									plane.setAttribute("geometry", "primitive: plane");
									plane.setAttribute("material", "side:double; shader:gif;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; depthWrite:false");
								}
								
							}


							if (obj.behav){
								if (obj.behav.length==1 && transparentImage){
									plane.setAttribute('class', "unclickable" ); //// fei add
								}
								else{
									plane.setAttribute('class', "clickable" );
								}
							}
							else{
								plane.setAttribute('class', "unclickable" ); //// fei add
							}

							self.setTransform(plane, position, rotation, scale);
							self.makarObjects.push( plane );

							//// 假如『原始圖片像素』高於『進場景材質大小』，就需要『縮小』，原始『各向異性』設為 1，以下流程改設為最高
							let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
							plane.addEventListener("materialtextureloaded", function(evt){
								// console.log("VRFunc.js: _loadTexture: _materialtextureloaded: plane = " , plane.object3D , evt );
								evt.detail.texture.anisotropy = maxAnisotropy;
								evt.detail.texture.needsUpdate = true;
							});

							plane.addEventListener("loaded", function(evt){
								
								// console.log(evt);
								if (evt.target == evt.currentTarget){
									// console.log("VRFunc.js: _loadTexture: loaded target same" );

									// setTimeout(function(){
									// 	plane.setAttribute("cursor-listener", true ); //// fei add
									// }, 500 );

									let timeoutID = setInterval( function () {
										// let tempTexture = plane.object3D.children[0].material.map;
										if (texture.image){ 											
											plane.object3D.children[0].scale.set(texture.image.width*0.01, texture.image.height*0.01 , 1);
											plane.setAttribute("heightForQuiz", texture.image.height*0.01 ); //// fei add
											window.clearInterval(timeoutID);
										}
									}, 1);
									
									let r = new THREE.Vector3();
									r.set(0,Math.PI, 0); 
									plane.object3D.children[0].rotation.setFromVector3(r);

									//// 由於圖片設定為無光標準，且深度寫入為否，故設定繪製排序往前，讓同距離的繪製可以顯示
									plane.object3D.children[0].renderOrder = 1;

									plane.object3D["makarObject"] = true; 
									if ( obj.behav ){

										//[start-20230920-howardhsu-modify]//
										//// 因目前quiz啟動物件的 behav 是在loadSceneObjs手動加上去的，所以這裡檢查一下
										if(plane.object3D["behav"] && plane.object3D["behav"].length != 0){
											obj.behav.forEach((b) => { plane.object3D["behav"].push(b) })												
										} else {
											plane.object3D["behav"] = obj.behav ;
										}
										//[end-20230920-howardhsu-modify]//		
										
										//// 載入時候建制「群組物件資料」「注視事件」
										self.setObjectBehavAll( obj );
									}
									if(obj.behav_reference){
										plane.object3D["behav_reference"] = obj.behav_reference ;
									}
									if (obj.main_type=="button"){
										plane.object3D["main_type"] = obj.main_type ;
										plane.object3D["sub_type"] = obj.sub_type ;
										plane.setAttribute('class', "clickable" );
										console.log("VRFunc.js: _loadTexture: button " , plane );

										//[start-20230920-howardhsu-add]//
										//// Quiz的按鈕 (例如 選項底下的ok) 改為使用 behav 來觸發
										if( Array.isArray(plane.object3D.behav) ){
											plane.object3D.behav.push( { simple_behav: "PushButton" } )
										} else {
											plane.object3D.behav = [ {simple_behav: "PushButton"} ]
										}
										//[end-20230920-howardhsu-add]//		
									}

									textureResolve( plane );

								}else{
									console.log("VRFunc.js: _loadTexture: loaded target different" );
								}
							});
							//20191031-end-thonsha-mod

							//// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
							if ( obj.active == false ){
								plane.setAttribute("visible", false);
								plane.setAttribute('class', "unclickable" );
							}

							//20191227-start-thonsha-add
							// console.log("VRFunc.js: _loadTexture: image behav_reference: ",obj.behav_reference);
							if(obj.behav_reference){
								for(let i=0; i<obj.behav_reference.length;i++){
									if (obj.behav_reference[i].behav_name == 'ShowImage'){
										plane.setAttribute("visible", false);
										plane.setAttribute('class', "unclickable" );
										break;
									}
								}
								
							}
							//20191227-end-thonsha-add

							//20191029-start-thonhsa-add
							if(obj.obj_parent_id){
								// plane.setAttribute("visible", false);
								// plane.setAttribute('class', "unclickable" );
								let timeoutID = setInterval( function () {
									let parent = document.getElementById(obj.obj_parent_id);
									if (parent){ 
										if(parent.object3D.children.length > 0){
											parent.appendChild(plane);
											window.clearInterval(timeoutID);
										}
									}
								}, 1);
							}
							else{
								self.vrScene.appendChild(plane);
							}
							//20191029-end-thonhsa-add

							// if (obj.main_type=="button"){
							// 	return plane;
							// }

						}else{
							

							console.log("VRFunc.js: _loadTexture , obj url not exist ", obj );
							
							obj.main_type = 'model';
							obj.sub_type = 'glb';
							obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";

							self.loadGLTFModel( obj , position, rotation, scale , self.cubeTex );
							textureResolve( 1 );

						}
					});



				});

				return pTexture;
				
			}
			
			//20191204-start-thonsha-add
			
			this.loadText = function( obj, position, rotation, scale ){
				// console.log("VRFunc.js: _laodText: obj = ", obj	);
				
				let pText = new Promise( function( textResolve ){

					let anchor = document.createElement('a-entity');
						
					// anchor.setAttribute("geometry","primitive: sphere; radius: 0.05" );
					// anchor.setAttribute("material","roughness: 0.48; color:	#FF0000");
					self.setTransform(anchor, position, rotation, scale);
					anchor.setAttribute( "id", obj.obj_id );//// fei add 
					self.makarObjects.push( anchor );

					if (obj.behav){
						anchor.setAttribute('class', "clickable" ); //// fei add
					}else if (obj.main_type == "button"){
						anchor.setAttribute('class', "clickable" );
					}
					else{
						anchor.setAttribute('class', "unclickable" ); //// fei add
					}
					
					// let textEntity = document.createElement('a-entity');
					// // textEntity.setAttribute("geometry","primitive: plane; width: auto; height: auto; width: auto");
					// // textEntity.setAttribute("material","color: #FFFFFF");
					// // textEntity.setAttribute("text","value: "+obj.content+"; color:red; shader: msdf; font:https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/notosans/NotoSans-Regular.json");
					// // textEntity.setAttribute("text","value: hello; color:red; shader: msdf; font:https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/creepster/Creepster-Regular.json");
					// textEntity.setAttribute("text","value: "+obj.content+"; color:blue; font:font/edukai-4.0-msdf.json");
					// =======================================================================
					let textEntity = document.createElement('a-text');
					//// 還是要加預設的 mesh，為了觸碰事件 
					textEntity.setAttribute("geometry","primitive:plane; width: auto; height: auto; skipCache: true;");
					textEntity.setAttribute("material","opacity: 0.0 ; depthWrite:false; color:#000000; side:double;");

					let textList = obj.content.split('\n');
					let longestSplit = 0;
					const REGEX_CHINESE = /[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u;
					const isChinese = (str) => REGEX_CHINESE.test(str);
					for (let i = 0; i < textList.length;i++) {
						let textLength = 0;
						for (let j = 0; j <  textList[i].length; j++) {
							if(isChinese(textList[i][j])){  // chinese
								textLength += 1.6;
							}
							else if(textList[i][j] == textList[i][j].toUpperCase() && textList[i][j] != textList[i][j].toLowerCase()){ // upper-case
								textLength += 1;
							}
							else if(textList[i][j] == textList[i][j].toLowerCase() && textList[i][j] != textList[i][j].toUpperCase()){ // lower-case
								// textLength += 0.85;
								textLength += 1.0;
							}
							else if(!isNaN(textList[i][j] * 1)){ //numeric
								textLength += 1;
							}
							else{ // other symbols
								textLength += 1.25;
							}
							
						}
						// console.log( textList[i], textLength);
						if (textLength > longestSplit) longestSplit =textLength;
					}
					textEntity.setAttribute("value",obj.content);
					// textEntity.setAttribute("width",longestSplit*0.08)	// 4 for 0.46  per 0.115  20201027：這個數值目前沒有用處
					// textEntity.setAttribute("wrap-count",longestSplit); // 1 for 1    20201027：這個數值目前沒有用處
					textEntity.setAttribute("anchor","center");
					textEntity.setAttribute("align","left");

					textEntity.setAttribute("backcolor", obj.back_color ); //// 這邊注意一重點，自己設定的 attribute 不能使用 『大寫英文』，否則aframe data內會找不到，參照 text物件
					textEntity.setAttribute("textcolor", obj.color ); //// 暫時沒有用，假如未來文字支援『透明度』功能時候會需要
					textEntity.setAttribute("side","double");

					var fontUrl = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/resource/fonts/";
					let fonts = [  fontUrl + "1-msdf.json", fontUrl + "2-msdf.json" , fontUrl + "3-msdf.json", fontUrl + "4-msdf.json", fontUrl + "5-msdf.json", 
							fontUrl + "6-msdf.json", fontUrl + "7-msdf.json" , fontUrl + "8-msdf.json", fontUrl + "9-msdf.json", fontUrl + "10-msdf.json", 
							fontUrl + "11-msdf.json", fontUrl + "12-msdf.json" ];
					// fonts = [ fontUrl + "1-msdf.json" ];
					textEntity.setAttribute("font", fonts );

					textEntity.setAttribute("negate","false");
					textEntity.setAttribute('crossorigin', 'anonymous');

					let rgb = obj.color.split(",");
					let color = new THREE.Color(parseFloat(rgb[0]),parseFloat(rgb[1]),parseFloat(rgb[2])); 
					textEntity.setAttribute("color", "#"+color.getHexString());

					// textEntity.setAttribute( "id", obj.obj_id );//// fei add 
					// if (obj.behav){
					// 	textEntity.setAttribute('class', "clickable" ); //// fei add
					// }
					// else if (obj.main_type == "button"){
					// 	textEntity.setAttribute('class', "clickable" ); //// fei add
					// }
					// else{
					// 	textEntity.setAttribute('class', "unclickable" ); //// fei add
					// }
					
					// self.setTransform(textEntity, position, rotation, scale);
					// self.makarObjects.push( textEntity );

					//// 因為無法確認「形狀確認」「物件載入完成」那個先行完成，所以增加判定
					let loadedCheck = 0;

					function checkGeometrySet(evt){
						console.log("VRFunc.js: _loadText: textEntity geometry-set: evt=" , evt  );
						if ( loadedCheck == 0 ){
							loadedCheck = 1;
						}else if ( loadedCheck == 1 ){
							textResolve( textEntity );
						}
						textEntity.removeEventListener("geometry-set", checkGeometrySet );
					}
					textEntity.addEventListener("geometry-set", checkGeometrySet );

					// textEntity.addEventListener("geometry-set", function(evt){
					// 	console.log(" textEntity geometry-set: evt=" , evt , textEntity.object3D  );
					// 	textResolve( textEntity );
					// });

					textEntity.addEventListener("loaded", function(evt){
						if (evt.target == evt.currentTarget){

							console.log("VRFunc.js: _loadText loaded textEntity=" , textEntity.object3D, textEntity.object3D.parent.scale.x );

							// setTimeout(function(){
							// 	textEntity.setAttribute("cursor-listener", true ); //// fei add
							// }, 500 );

							let r = new THREE.Vector3();
							r.set(0,Math.PI, 0); 
							textEntity.object3D.rotation.setFromVector3(r);
							// textEntity.object3D.children[0].rotation.setFromVector3(r);
							// textEntity.object3D.children[0].position.x = -textEntity.object3D.children[0].position.x;

							// textEntity.object3D["makarObject"] = true; 
							anchor.object3D["makarObject"] = true; 
							if ( obj.behav ){
								// textEntity.object3D["behav"] = obj.behav ;
										
								//[start-20230920-howardhsu-modify]//
								//// 因目前quiz啟動物件的 behav 是在loadSceneObjs手動加上去的，所以這裡檢查一下
								if(anchor.object3D["behav"] && anchor.object3D["behav"].length != 0){
									obj.behav.forEach((b) => { anchor.object3D["behav"].push(b) })												
								} else {
									anchor.object3D["behav"] = obj.behav ;
								}
								//[end-20230920-howardhsu-modify]//										

								//// 載入時候建制「群組物件資料」「注視事件」
								self.setObjectBehavAll( obj );
							}
							if(obj.behav_reference){
								// textEntity.object3D["behav_reference"] = obj.behav_reference ;
								anchor.object3D["behav_reference"] = obj.behav_reference ;
							}
							if (obj.main_type=="button"){
								// textEntity.object3D["main_type"] = obj.main_type;
								anchor.object3D["main_type"] = obj.main_type;
								
								//[start-20230920-howardhsu-add]
								//// (Quiz的選項文字) 點擊事件改用 behav 來觸發，因此給它加上 behav 
								if( Array.isArray(anchor.object3D.behav) ){
									anchor.object3D.behav.push( { simple_behav: "PushButton" } )
								} else {
									anchor.object3D.behav = [ {simple_behav: "PushButton"} ]
								}
								//[end-20230920-howardhsu-add] 
							}

							if ( loadedCheck == 0 ){
								loadedCheck = 1;
							}else if ( loadedCheck == 1 ){
								textResolve( textEntity );
							}
							
						}
					});


					///
					anchor.appendChild(textEntity);
					///

					//// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
					if ( obj.active == false ){
						anchor.setAttribute("visible", false);
						anchor.setAttribute('class', "unclickable" );
					}

					//20191227-start-thonsha-add
					if(obj.behav_reference){
						for(let i=0; i<obj.behav_reference.length;i++){
							if (obj.behav_reference[i].behav_name == 'ShowText'){
								// textEntity.setAttribute("visible", false);
								// textEntity.setAttribute('class', "unclickable" );
								anchor.setAttribute("visible", false);
								anchor.setAttribute('class', "unclickable" );
								break;
							}
						}
						
					}
					//20191227-end-thonsha-add
					console.log(" VRFunc.js: _loadText: anchor= ", anchor.object3D , ", obj=", obj );
					if(obj.obj_parent_id){
						// textEntity.setAttribute("visible", false);
						// textEntity.setAttribute('class', "unclickable" );
						let timeoutID = setInterval( function () {
							let parent = document.getElementById(obj.obj_parent_id);
							// console.log("0 VRFunc.js: _loadText: parent= ", parent.object3D  );

							if (parent){ 
								if(parent.object3D.children.length > 0){
									parent.appendChild(anchor);
									window.clearInterval(timeoutID);
								} 
							}
						}, 100);
					}
					else{
						self.vrScene.appendChild(anchor);
						// self.vrScene.appendChild(textEntity);
					}
					
					// if (obj.main_type=="button"){
					// 	return textEntity;
					// }


				});

				return pText;

			}

			//20191204-end-thonsha-add


			this.checkGLTFMaterialIndex = function( target, material ){

				if ( !target || !target.object3D || !target.object3D.children[0] ){
					console.log('VRFunc.js: _checkGLTFMaterialIndex: target error', target );
					return;
				}

				if ( !material ){
					console.log('VRFunc.js: _checkGLTFMaterialIndex: material error', material );
					return;
				}

				//// 當前紀錄要調整材質的方式 很奇特：
			    //// 第一個數值是： nodes 下面，撇除不帶有 mesh 的項目，的index，此 node 帶有的 「mesh」代表 meshes 下的 index
    			//// 第二個數值是： meshes 下的 mesh，底下的 primitives 下的 material index 
				let nodeMeshIndex = material.rendererIndex;
				let primitiveIndex = material.materialIndex;
	
				//// 確認模型物件下面的scene
				let meshIndex = -1;
				let materialIndex = -1;

				//// 查找「nodes」底下「帶有 mesh」的node
                let nodes = target.object3D.children[0].ModelJson.nodes;
                let nodeMeshCount = -1;
                for ( let i = 0; i < nodes.length; i++ ){
                    //// 假如此 node 帶有 mesh ，加一
                    if ( typeof( nodes[i].mesh ) == 'number' ){
                        nodeMeshCount++;
                    }
                    //// 確認是否為「對應 index 」
                    if ( nodeMeshIndex == nodeMeshCount ){
                        meshIndex = nodes[i].mesh;
                        // console.log('VRFunc.js: _checkGLTFMaterialIndex: get nodeMeshIndex ', nodes[i] );
                        break;
                    }

                }

                //// 確認模型物件下的 meshes 下 特定 index 是否存在
                // console.log('VRFunc.js: _checkGLTFMaterialIndex: meshIndex = ', meshIndex , material  );
                if ( meshIndex >= 0 ){

                    let meshData = target.object3D.children[0].ModelJson.meshes[ meshIndex ];
                    // console.log('VRFunc.js: _checkGLTFMaterialIndex: get meshData ', meshIndex , meshData  );
                    if ( meshData ){
                        //// 確認模型物件下的 primitives 是否存在
                        if ( meshData.primitives  ){
                            let primitiveData = meshData.primitives[ primitiveIndex ];
                            //// 確認模型物件下的 primitives 下 material 是否有值
                            if ( primitiveData && primitiveData.material >= 0 ){
                                //// 確認 materials 下是否有此 index
                                materialIndex = primitiveData.material;

                                console.log('VRFunc.js: _checkGLTFMaterialIndex: materialIndex=' , materialIndex );
                            }
                        }
                    }
				}
				
				// if ( materialIndex >= 0 ){

				// 	target.object3D.traverse(function(child){
				// 		if (child.isMesh){
				// 			//// 我們在 load GLTF 的時候把每一個 material name 最後面加上 _[index]，這邊找出最後一個來比較
				// 			let nameSlice = child.material.name.split("_");
				// 			let mIndex = nameSlice[ nameSlice.length - 1 ];
				// 			if ( mIndex == materialIndex){
				// 				console.log('VRFunc.js: _checkGLTFMaterialIndex: child.material =', child.material );
				// 			}
				// 		}
				// 	});
				// }

				return materialIndex;

			}

			//20191025-start-thonsha-add
			
			this.loadGLTFModel = function(obj, position, rotation, scale, cubeTex){

				let pModel = new Promise( function( modelResolve ){
							
					UrlExists( obj.res_url , function( retStatus ){
						if ( retStatus == true ){

							//// 作檔案存在與否判斷
							//// 沒有檔案位址，
							if ( obj.res_url == '' || 
							( obj.sub_type != 'glb' && obj.sub_type != 'gltf'  && obj.sub_type != 'gltf_sketchFab'  && obj.sub_type != 'gltf_sketchfab' &&
							  obj.sub_type != 'gltf_poly'
							) ){
								console.log("VRFunc.js: _loadGFLTFModel: obj not support ", obj );
								modelResolve( -1 );
								return;
							}


							let assets = document.getElementById("makarAssets");

							let assetsitem = document.createElement("a-asset-item")
							assetsitem.setAttribute("id", obj.obj_id+"_"+obj.res_id);
							assetsitem.setAttribute("src",obj.res_url);
							assetsitem.setAttribute("response-type", 'arraybuffer');
							// assetsitem.setAttribute("src", 'model/tga.glb' );
							
							// assetsitem.setAttribute("src", 'https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/Resource/56a0a86b2d694c48bc7179d05a9f2c8cc833455ddc4442d481a73214d39aab4c.glb' );

							assetsitem.setAttribute('crossorigin', 'anonymous');
							assets.appendChild(assetsitem);
							
							//20191128-start-thonsha-add
							var animationSlices= null;	
							var mainAnimation;	
							if(obj.animation){
								animationSlices= [];
								
								////
								//// 2022 1123 這邊從 3.4.0 之後要作版本控制
								//// 注意，在執行的程式碼端，將 key 結構改為 新版本
								////
								if ( Array.isArray ( self.editor_version )  && self.editor_version.length == 3 ){

									let largeV  = Number( self.editor_version[0] );
									let middleV = Number( self.editor_version[1] );
									let smallV  = Number( self.editor_version[2] );

									//// 只要版本大於 3.3.8 都使用新的 key， 都是小寫英文，換字使用底線 _ 
									if ( largeV > 3 || 
									( largeV == 3 && middleV > 3 ) ||
									( largeV == 3 && middleV == 3 && smallV > 8 )
									){
										for(let i=0; i<obj.animation.length; i++){
											if (obj.animation[i].is_default || obj.animation[i].is_active){
												animationSlices.push({
													idle:obj.animation[i].uid, 
													loop:obj.animation[i].uid, 
													uid:obj.animation[i].uid, 
													changed: false, 
													reset: true, 
													count: 0});
												mainAnimation = obj.animation[i].animation_name;
											}
										}
										for(let i=0; i<obj.animation.length; i++){
											animationSlices.push({
												name:obj.animation[i].name,
												animationName:obj.animation[i].animation_name,
												startTime:obj.animation[i].start_time,
												endTime:obj.animation[i].end_time,
												uid:obj.animation[i].uid
											});
										}

									}else{
										//// 假如版本小於 3.3.8 使用舊版本 key , 小寫英文開頭，換字改為大寫英文
										
										for(let i=0; i<obj.animation.length; i++){
											if (obj.animation[i].defaultAnimation || obj.animation[i].isActive){
												animationSlices.push({
													idle:obj.animation[i].uid, 
													loop:obj.animation[i].uid, 
													uid:obj.animation[i].uid, 
													changed: false, 
													reset: true, 
													count: 0});
												mainAnimation = obj.animation[i].animationName;
											}
										}
										for(let i=0; i<obj.animation.length; i++){
											animationSlices.push({
												name:obj.animation[i].name,
												animationName:obj.animation[i].animationName,
												startTime:obj.animation[i].startTime,
												endTime:obj.animation[i].endTime,
												uid:obj.animation[i].uid
											});
										}
									}


								}else{
									//// 假如本版檢查有誤，執行「最新版本」3.3.8的架構
									for(let i=0; i<obj.animation.length; i++){
										// if (obj.animation[i].is_active){
										// 	animationSlices.push({idle:obj.animation[i].uid, uid:obj.animation[i].uid, changed: false});
										// 	mainAnimation = obj.animation[i].animation_name;
										// }
										if (obj.animation[i].is_default || obj.animation[i].is_active){
											animationSlices.push({
												idle:obj.animation[i].uid, 
												loop:obj.animation[i].uid, 
												uid:obj.animation[i].uid, 
												changed: false, 
												reset: true, 
												count: 0});							
											mainAnimation = obj.animation[i].animation_name;
										}
									}
									for(let i=0; i<obj.animation.length; i++){
										animationSlices.push({name:obj.animation[i].name,
											animationName:obj.animation[i].animation_name,
											startTime:obj.animation[i].start_time,
											endTime:obj.animation[i].end_time,
											uid:obj.animation[i].uid
										});
									}

								}
								

							}
							//20191128-end-thonsha-add

							let modelEntity = document.createElement('a-entity');

							if(!obj.res_url){ return };
				
							modelEntity.setAttribute("gltf-model", "#"+obj.obj_id+"_"+obj.res_id);
							
							if(obj.animation){
								modelEntity.setAttribute("animation-mixer", "clip: "+mainAnimation);
							}

							if (obj.behav){
								modelEntity.setAttribute('class', "clickable" ); //// fei add
							}
							else{
								modelEntity.setAttribute('class', "unclickable" ); //// fei add
							}
							modelEntity.setAttribute( "id", obj.obj_id );//// fei add 

							modelEntity.setAttribute('crossorigin', 'anonymous');

			//20200608-thonsha-add-start
							modelEntity.setAttribute("shadow","");
			//20200608-thonsha-add-end
			//20200619-thonsha0add-start
							if (obj.model_shift){
								let model_shift = new THREE.Vector3().fromArray(obj.model_shift.split(",").map(function(x){return Number(x)}) );
								model_shift.multiply(scale);
								position.add(model_shift);
							}
			//20200619-thonsha0add-end

							self.setTransform(modelEntity, position, rotation, scale);
							self.makarObjects.push( modelEntity );

							//20191125-start-thonsha-add
							modelEntity.addEventListener("model-loaded", function(evt){ // model-loaded  / object3dset
								// console.log("VRFunc.js: VRController: _loadGLTFModel, object3dset: evt=", evt );
								if ( evt.target ==  evt.currentTarget ){

									//// 假如『原始圖片像素』高於『進場景材質大小』，就需要『縮小』，原始『各向異性』設為 1，以下流程改設為最高
									let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
									evt.detail.model.traverse( ( object ) => {
										if ( object.isMesh === true && object.material.map !== null ) {
										object.material.map.anisotropy = maxAnisotropy;
										object.material.map.needsUpdate = true;
										}
									});
									

									// setTimeout(function(){
									// 	modelEntity.setAttribute("cursor-listener", true ); //// fei add
									// }, 500 );
					

									if ( modelEntity.object3D ){
										modelEntity.object3D["makarObject"] = true;
										if ( obj.behav ){
															
											//[start-20230920-howardhsu-modify]//
											//// 因目前quiz啟動物件的 behav 是在loadSceneObjs手動加上去的，所以這裡檢查一下
											if(modelEntity.object3D["behav"] && modelEntity.object3D["behav"].length != 0){
												obj.behav.forEach((b) => { modelEntity.object3D["behav"].push(b) })												
											} else {
												modelEntity.object3D["behav"] = obj.behav ;
											}
											//[end-20230920-howardhsu-modify]//		
											
											//// 載入時候建制「群組物件資料」「注視事件」
											self.setObjectBehavAll( obj );
										}
										if(obj.behav_reference){
											modelEntity.object3D["behav_reference"] = obj.behav_reference ;
										}

										let objj = modelEntity.getObject3D('mesh');
										// console.log('VRFunc.js: gltf model objj=', objj );
										let materialIndex = -1;

							//20191203-start-thonsha-add
										if (obj.material){

											for(let i = 0; i < obj.material.length; i++){

												if ( objj.ModelJson ){
													materialIndex = self.checkGLTFMaterialIndex( modelEntity, obj.material[i]  );
												}

												let rgba = obj.material[i].color.split(",");
												let color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));

												objj.traverse(node => {
													//// 取消所有「模型自帶光」
													if (node.type){
														if (typeof(node.type) == 'string' ){
															if (node.type.toLowerCase().includes('light') ){
																node.visible = false;
															}
														}
													}
												});

												switch (obj.material[i].shader) {
													case "Unlit/Color":
														objj.traverse(node => {
															if (node.isMesh) {

																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name === obj.material[i].name) {
																	node.material = new THREE.MeshBasicMaterial({color: color, name: node.material.name, skinning: node.material.skinning});
																}
															}
														});
														break;
													case "Standard":

														var renderer = modelEntity.sceneEl.renderer;
														objj.traverse(node => {

															if (node.material) {

																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
			//20200803-thonsha-add-start
																	node.material = new THREE.MeshStandardMaterial({
																		// name: obj.material[i].name, 
																		name: node.material.name,
																		skinning: node.material.skinning , 
																		map: node.material.map, 
																		emissive:node.material.emissive,
																		emissiveMap:node.material.emissiveMap,
																		normalMap:node.material.normalMap
																	});					
			//20200803-thonsha-add-end
																	node.material.color = color;
																	node.material.metalness = obj.material[i].metallic;
																	node.material.roughness = 1 - obj.material[i].smoothness;
																	//// 先行取消「模型呈現環景」
																	node.material.envMap = self.cubeTex.texture;
																	node.material.envMapIntensity = 1;
																	node.material.needsUpdate = true;
																	node.material.reflectivity = 0;
																	node.material.side = THREE.DoubleSide;
																	node.material.transparent = true;

																	// node.material.polygonOffset = true;
																	
																	// console.log('VRFunc.js: _loadGLTFModel: obj.material',obj.material);
																	// console.log('VRFunc.js: _loadGLTFModel: standard node.material',node.material);
			//20200730-thonsha-add-start														
																	if (node.material.map){
																		if ( THREE.GammaEncoding ){
																			node.material.map.encoding = THREE.GammaEncoding;
																		}
																		
																		node.material.map.needsUpdate = true;
																	}
			//20200730-thonsha-add-end	
																	if(obj.material[i].mode == 0){
																		node.material.opacity = 1;
																		renderer.setClearAlpha(1);

																		node.material.blending = THREE.CustomBlending;
																		node.material.blendEquation = THREE.AddEquation;
																		node.material.blendSrc = THREE.OneFactor;
																		node.material.blendDst = THREE.ZeroFactor;
																		node.material.blendSrcAlpha = THREE.ZeroFactor;
																		node.material.blendDstAlpha = THREE.OneFactor;

																	}
																	else if(obj.material[i].mode == 1){
																		node.material.opacity = 1;
																		node.material.alphaTest = obj.material[i].cut_off;
																		renderer.setClearAlpha(1);

																		node.material.blending = THREE.CustomBlending;
																		node.material.blendEquation = THREE.AddEquation;
																		node.material.blendSrc = THREE.OneFactor;
																		node.material.blendDst = THREE.ZeroFactor;
																		node.material.blendSrcAlpha = THREE.ZeroFactor;
																		node.material.blendDstAlpha = THREE.OneFactor;

																		node.customDepthMaterial = new THREE.MeshDepthMaterial( {
																			depthPacking: THREE.RGBADepthPacking,
																			skinning: true,
																			map: node.material.map,
																			alphaTest: obj.material[i].cut_off
																		} );
																	}
																	else if(obj.material[i].mode == 2){
																		node.material.opacity = parseFloat(rgba[3]);
																		node.material.depthWrite = false;
																		
																		//// 假如是「淡出材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
																		node.renderOrder = 1;
																	
																		node.customDepthMaterial = new THREE.MeshDepthMaterial( {
																			depthPacking: THREE.RGBADepthPacking,
																			skinning: true,
																			map: node.material.map,
																			alphaTest: obj.material[i].cut_off
																		} );
																	}
																	else if(obj.material[i].mode == 3){
																		node.material.opacity = Math.max(parseFloat(rgba[3]), obj.material[i].metallic);
																		node.material.depthWrite = false;
																		node.material.blending = THREE.CustomBlending;
																		node.material.blendEquation = THREE.AddEquation;
																		node.material.blendSrc = THREE.OneFactor;
																		node.material.blendDst = THREE.OneMinusSrcAlphaFactor;
																		node.material.blendSrcAlpha = THREE.OneFactor;
																		node.material.blendDstAlpha = THREE.OneMinusSrcAlphaFactor;

																		//// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
																		node.renderOrder = 1;

																		node.customDepthMaterial = new THREE.MeshDepthMaterial( {
																			depthPacking: THREE.RGBADepthPacking,
																			skinning: true,
																			map: node.material.map,
																			alphaTest: obj.material[i].cut_off
																		} );
																	}
																}
															}
														});
														// renderer.toneMapping = THREE.ACESFilmicToneMapping;
														// renderer.outputEncoding = THREE.sRGBEncoding;
														
														
														break;
													case "Unlit/Transparent":
														objj.traverse(node => {
															if (node.material) {
																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
																	node.material.opacity = 1;
																	node.material.depthWrite = false;
																	//// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
																	node.renderOrder = 1;
																}
															}
														});
														break;
													case "Unlit/Transparent Cutout":
														objj.traverse(node => {
															if (node.material) {
																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
																	node.material.opacity = 1;
																	node.material.alphaTest = 0.5;
																}
															}
														});
														break;
													case "Unlit/Texture":
														objj.traverse(node => {
															if (node.material) {
																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
																	node.material = new THREE.MeshBasicMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
			//20200730-thonsha-add-start
																	if (node.material.map){
																		node.material.map.encoding = THREE.GammaEncoding;
																		node.material.map.needsUpdate = true;
																		// console.log(node.material.map)

																	}
			//20200730-thonsha-add-end
																	node.material.needsUpdate = true;
																}
															}
														});
														break;

			//20221206-thonsha-add-start
													case "Unlit/ScreenCutoutShader":
														objj.traverse(node => {
															if (node.material) {
																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
																	self.needsRenderTarget = true;
																	
																	node.material.onBeforeCompile = function ( shader ) {
																		shader.uniforms.tEquirect = { value: self.skyRenderTarget.texture };
																		shader.vertexShader = 'varying vec4 vProjection;\n' + shader.vertexShader;
																		shader.vertexShader = shader.vertexShader.replace(
																		'#include <worldpos_vertex>',
																		[
																			'#include <worldpos_vertex>',
																			'	vProjection = projectionMatrix * mvPosition;',
																		].join( '\n' )
																		);
																		shader.fragmentShader = 'uniform sampler2D tEquirect;\nvarying vec4 vProjection;\n' + shader.fragmentShader;
																		shader.fragmentShader = shader.fragmentShader.replace(
																		'#include <dithering_fragment>',
																		[
																			'#include <dithering_fragment>',
																			'	vec2 sampleUV;',
																			'	sampleUV.x = vProjection.x/vProjection.w*0.5 + 0.5;',
																			'	sampleUV.y = vProjection.y/vProjection.w*0.5 + 0.5;',
																			'	gl_FragColor = texture2D(tEquirect, sampleUV);',
																		].join( '\n' )
																		);
																	};
																	
																}
															}
														});
														break;
			//20221206-thonsha-add-end

			//20200828-thonsha-add-start
													case "Blocks/Basic":
														// console.log("20200828",objj);
														break;

													case "Blocks/BlocksGem":
														objj.traverse(node => {
															if (node.material) {
																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
																	node.material.depthWrite = false;
																	//// 假如是「頂點色材質」？，同時設定繪製排序往前，讓同距離的繪製可以顯示
																	node.renderOrder = 1;
																}
															}
														});
														break;
													case "Blocks/BlocksGlass":
														objj.traverse(node => {
															if (node.material) {
																let nameSlice = node.material.name.split("_");
																let mIndex = nameSlice[ nameSlice.length - 1 ];
																if( mIndex == materialIndex ){
																// if( mIndex == obj.material[i].materialIndex){
																// if (node.material.name == obj.material[i].name) {
																	node.material.depthWrite = false;
																	//// 假如是「頂點色材質」？，同時設定繪製排序往前，讓同距離的繪製可以顯示
																	node.renderOrder = 1;
																}
															}
														});
														break;
			//20200828-thonsha-add-end
													default:
														console.log(`The shader of no. ${i} material is not supported currently.`);
														break;
												}
											}

										}
							//20191203-start-thonsha-add		
										//// if there is animation exist in GLTF, but the editor not contain the animation slices, the mixer will not init.
										//// use the first animation( usually only one), to setup animationSlice.
										if (Array.isArray(evt.detail.model.animations)){
											if ( evt.detail.model.animations.length>0 && !modelEntity.getAttribute("animation-mixer") ){
												console.log("VRFunc.js: loadGFLTFModel: the model with animation but no animation-mixer, probabily older version of editor ", evt.detail.model );
												modelEntity.setAttribute("animation-mixer", "clip: "+ evt.detail.model.animations[0].name );
												animationSlices = [];
												animationSlices.push({ changed:false, idle:"mifly168", uid:"mifly168" });
												animationSlices.push({
													animationName: evt.detail.model.animations[0].name,
													name: evt.detail.model.animations[0].name,
													endTime: evt.detail.model.animations[0].duration ,
													startTime: 0,
													uid:"mifly168"
												});
											}
										}
										evt.detail.model.animationSlices = animationSlices;

										modelResolve( modelEntity );


									}
								}else{
									// console.log("VRFunc.js: VRController: _loadFBXModel, target!=currentTarget", obj.res_name, modelEntity.object3D.children );
								}
							});

							//20191125-end-thonsha-add

							//20191226-start-thonsha-mod

							//// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
							if ( obj.active == false ){
								modelEntity.setAttribute("visible", false);
								modelEntity.setAttribute('class', "unclickable" );
							}

							if(obj.behav_reference){
								for(let i=0; i<obj.behav_reference.length;i++){
									if (obj.behav_reference[i].behav_name == 'ShowModel'){
										modelEntity.setAttribute("visible", false);
										modelEntity.setAttribute('class', "unclickable" );
										break;
									}
								}
								
							}
							//20191029-start-thonhsa-add
							if(obj.obj_parent_id){
								// modelEntity.setAttribute("visible", false);
								// modelEntity.setAttribute('class', "unclickable" );
								let timeoutID = setInterval( function () {
									let parent = document.getElementById(obj.obj_parent_id);
									if (parent){ 
										if(parent.object3D.children.length > 0){
											parent.appendChild(modelEntity);
											window.clearInterval(timeoutID);
										} 
									}
								}, 1);
							}
							else{
								self.vrScene.appendChild(modelEntity);
							}


						}else{

							console.log("VRFunc.js: _loadGLTFModel , obj url not exist ", obj );
							
							obj.main_type = 'model';
							obj.sub_type = 'glb';
							obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";

							self.loadGLTFModel( obj , position, rotation, scale , self.cubeTex );
							modelResolve( 1 );


						}

					});


					

				});

				return pModel;

			}

			//20191025-end-thonsha-add

			this.loadFBXModel = function( obj, position, rotation, scale ){
				
				// console.log("VRFunc.js: VRController: loadFBXModel, obj=", obj, position, rotation, scale );
				// console.log("VRFunc.js: VRController: loadFBXModel, obj res_url_fbx=", obj.res_url_fbx  );

				let modelEntity = document.createElement('a-entity');
				
				if ( !obj.res_url_fbx ){ return };
				
				modelEntity.setAttribute('fbx-model', 'src:' + obj.res_url_fbx ); // res_url_fbx, load model first?

				//20191028-end-thonsha-add
				modelEntity.setAttribute("animation-mixer", "");
				//20191028-end-thonsha-add
				if (obj.behav){
					modelEntity.setAttribute('class', "clickable" ); //// fei add
				}
				else{
					modelEntity.setAttribute('class', "unclickable" ); //// fei add
				}
				modelEntity.setAttribute( "id", obj.obj_id );//// fei add 

				// setTimeout(function(){
				// 	modelEntity.setAttribute("cursor-listener", true ); //// fei add
				// }, 500 );

				self.setTransform(modelEntity, position, rotation, scale);
				self.makarObjects.push( modelEntity );

				//20191227-start-thonsha-mod
				if(obj.behav_reference){
					for(let i=0; i<obj.behav_reference.length;i++){
						if (obj.behav_reference[i].behav_name != 'PlayAnimation'){
							modelEntity.setAttribute("visible", false);
							modelEntity.setAttribute('class', "unclickable" );
							break;
						}
					}
					
				}
				//20191227-end-thonsha-mod
				//20191029-start-thonhsa-add
				if(obj.obj_parent_id){
					// modelEntity.setAttribute("visible", false);
					// modelEntity.setAttribute('class', "unclickable" );
					let timeoutID = setInterval( function () {
						let parent = document.getElementById(obj.obj_parent_id);
						if (parent){ 
							if(parent.object3D.children.length > 0){
								parent.appendChild(modelEntity);
								window.clearInterval(timeoutID);
							} 
						}
					}, 1);
				}
				else{	
					self.vrScene.appendChild(modelEntity);
				}
				//20191029-end-thonhsa-add
				modelEntity.addEventListener("model-loaded", function(evt){

					if (evt.target == evt.currentTarget){
						modelEntity.object3D["makarObject"] = true; 
						if ( obj.behav ){

							//[start-20230920-howardhsu-modify]//
							//// 因目前quiz啟動物件的 behav 是在loadSceneObjs手動加上去的，所以這裡檢查一下
							if(modelEntity.object3D["behav"] && modelEntity.object3D["behav"].length != 0){
								obj.behav.forEach((b) => { modelEntity.object3D["behav"].push(b) })												
							} else {
								modelEntity.object3D["behav"] = obj.behav ;
							}
							//[end-20230920-howardhsu-modify]//
						}
					}
				});

				// console.log("VRFunc.js: VRController: loadFBXModel, modelEntity=", modelEntity );
				// console.log("VRFunc.js: VRController: loadFBXModel, obj=", obj );

			}

			//20191105-start-thonsha-add
			this.loadAudio = function(obj , position, rotation, scale){
				console.log("VRFunc.js: _loadAudio , obj=", obj );

				let pAudio = new Promise( function( audioResolve ){

					UrlExists( obj.res_url , function( retStatus ){
						//// 先檢查「聲音物件網址是否存在」，否的話，載入「問號模型物件」
						if ( retStatus == true ){

							let assets = document.getElementById("makarAssets");

							let assetsitem = document.createElement("audio");
							assetsitem.setAttribute("id", obj.obj_id+"_"+obj.res_id);
							assetsitem.setAttribute("src",obj.res_url);
							assetsitem.setAttribute('crossorigin', 'anonymous');
							assetsitem.setAttribute("loop", true);
							assetsitem.setAttribute("preload", "auto");
							assets.appendChild(assetsitem);

							assetsitem.onloadedmetadata = function() {
								let soundEntity = document.createElement('a-sound');
								soundEntity.setAttribute("sound", "src: "+"#"+obj.obj_id+"_"+obj.res_id+"; autoplay: true; loop: true; volume: 1; positional: false");
								soundEntity.setAttribute( "id", obj.obj_id );
								soundEntity.setAttribute("sound", "autoplay: false"); 


								self.makarObjects.push( soundEntity );

								//// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
								if ( obj.active == false ){
									soundEntity.setAttribute("sound", "loop: false");
									soundEntity.setAttribute("visible", false);
									soundEntity.setAttribute('class', "unclickable" );
								}

								let audioBehavRef = false;
								if(obj.behav_reference){
									for(let i=0; i<obj.behav_reference.length;i++){
										if (obj.behav_reference[i].behav_name == 'PlayMusic'){
											audioBehavRef = true;
											soundEntity.setAttribute("sound", "loop: false");
											soundEntity.setAttribute("visible", false);
											soundEntity.setAttribute('class', "unclickable" );
											break;
										}
									}
									
								}else{
									soundEntity.setAttribute("visible", true);
								}
								//20191227-end-thonsha-mod

								if(obj.obj_parent_id){
									
									let timeoutID = setInterval( function () {
										let parent = document.getElementById(obj.obj_parent_id);
										if (parent){ 
											if(parent.object3D.children.length > 0){
												parent.appendChild(soundEntity);
												window.clearInterval(timeoutID);

												parent.addEventListener("child-attached", function(el){

													console.log("VRFunc.js: VRController: _loadAudio,: parent child-attached, el=", el );

													if ( obj.blockly ){

														soundEntity.blockly = obj.blockly;
														soundEntity.setAttribute("sound", "autoplay: false");

													} else {

														let parentVisible = true;
														soundEntity.object3D.traverseAncestors( function(parent) {
															if (parent.type != "Scene"){
																console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: not Scene parent=", parent );
																if (parent.visible == false){
																	parentVisible = false;
																}
															} else {
																if (parentVisible == true && soundEntity.object3D.visible == true && audioBehavRef == false ){
																	console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: all parent visible true=", soundEntity.object3D );

																	//// 由於這邊是『載入場景』時候希望自動播放聲音，所以這邊需要用戶額外點擊
																	if ( (window.Browser.mobile == true && window.Browser.name == "safari" && window.allowAudioClicked != true) || 
																		(window.allowAudioClicked != true && location == parent.location ) ){
												
																		soundEntity.setAttribute("sound", "autoplay: false");
										
																		let clickToPlayAudio = document.getElementById("clickToPlayAudio");
																		clickToPlayAudio.style.display = "block";
																		
																		clickToPlayAudio.addEventListener('click', f_clickToPlayAudio );
																		function f_clickToPlayAudio (){
																			soundEntity.components.sound.playSound();

																			clickToPlayAudio.style.display = "none";
																			clickToPlayAudio.removeEventListener( 'click', f_clickToPlayAudio )
																			window.allowAudioClicked = true;
																		}
										
																	}else{
																		soundEntity.setAttribute("sound", "autoplay: true");
																	
																		//[start-20230815-howardhsu-add]//                                                         
																		checkAudioTypeAttr(obj, soundEntity, audioBehavRef)
																		//[end-20230815-howardhsu-add]//
																	}

																}else{
																	console.log("2 VRFunc.js: VRController: _loadAudio,: traverseAncestors: not all parent visible true=", soundEntity.object3D.children[0] );
																	soundEntity.setAttribute("sound", "autoplay: false"); 
																}
															}
														});

													}

												})

											} 
										}
									}, 1);
								}
								else{	
									console.log("VRFunc.js: _loadAudio: no parent set autoplay true", soundEntity.object3D , location );
									

									if ( obj.blockly ){

										soundEntity.blockly = obj.blockly;
										soundEntity.setAttribute("sound", "autoplay: false");

									} else {

										//// 由於這邊是『載入場景』時候希望自動播放聲音，所以這邊需要用戶額外點擊
										// if ( true ){
										// if ( window.allowAudioClicked != true ){
										if ( (window.Browser.mobile == true && window.Browser.name == "safari" && window.allowAudioClicked != true) || 
										(window.allowAudioClicked != true && location == parent.location ) ){
										
											soundEntity.setAttribute("sound", "autoplay: false");

											let clickToPlayAudio = document.getElementById("clickToPlayAudio");
											clickToPlayAudio.style.display = "block";
											
											clickToPlayAudio.addEventListener('click', f_clickToPlayAudio );
											function f_clickToPlayAudio (){
												soundEntity.components.sound.playSound();
												clickToPlayAudio.style.display = "none";
												clickToPlayAudio.removeEventListener( 'click', f_clickToPlayAudio )
												window.allowAudioClicked = true;
											}

										}else{
											//[start-20230815-howardhsu-add]//
											//// 看到XR有多這個判斷而加上
											if ( audioBehavRef == true ){
												soundEntity.setAttribute("sound", "autoplay: false");
												soundEntity.setAttribute("visible", false);

											}else{
												soundEntity.setAttribute("sound", "autoplay: true");

												//[start-20230815-howardhsu-add]//
												checkAudioTypeAttr(obj, soundEntity, audioBehavRef)
											}
											//[end-20230815-howardhsu-add]//
										}

									}

									
									
									self.vrScene.appendChild(soundEntity);
								}

				
								
								//// set audio attr according to the obj in makar with autoplay, volume, loop
								//// 自動播放、音量、循環
								function checkAudioTypeAttr(obj, soundEntity, audioBehavRef){  
									console.log("checkAudioTypeAttr obj", obj)
									//[start-20230815-howardhsu-add]//
									if ( obj.active == false || audioBehavRef){                                                           
										soundEntity.setAttribute("sound", "autoplay: false");
									}  
										
									if(obj){      
										if(obj.is_loop != undefined){ 
											soundEntity.setAttribute("sound", `loop: ${obj.is_loop}`); 
										}    
										if(obj.volume != undefined){ 
											soundEntity.setAttribute("sound", `volume: ${obj.volume}`); 
										}       
									} 
									//[end-20230815-howardhsu-add]//
								}

								soundEntity.addEventListener("loaded", function(evt){

									if (evt.target == evt.currentTarget){
										console.log("3 VRFunc.js: VRController: _loadAudio,: loaded, soundEntity.object3D.children[0]=", soundEntity.object3D.children[0] );
										soundEntity.object3D["makarObject"] = true; 
										if ( obj.behav ){

											//[start-20230920-howardhsu-modify]//
											//// 因目前quiz啟動物件的 behav 是在loadSceneObjs手動加上去的，所以這裡檢查一下
											if(soundEntity.object3D["behav"] && soundEntity.object3D["behav"].length != 0){
												obj.behav.forEach((b) => { soundEntity.object3D["behav"].push(b) })												
											} else {
												soundEntity.object3D["behav"] = obj.behav ;
											}
											//[end-20230920-howardhsu-modify]//		


											//// 載入時候建制「群組物件資料」「注視事件」
											self.setObjectBehavAll( obj );
										}
										if(obj.behav_reference){
											soundEntity.object3D["behav_reference"] = obj.behav_reference ;
										}

										audioResolve( soundEntity );
									}
								});
							}


						}else{							
							console.log("VRFunc.js: _loadAudio , obj url not exist ", obj );
							
							obj.main_type = 'model';
							obj.sub_type = 'glb';
							obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";

							self.loadGLTFModel( obj , position, rotation, scale , self.cubeTex );

							audioResolve( 1 );
						}

					});

				});

				return pAudio;

			}
			//20191105-end-thonsha-add

			this.loadVideo = function( obj, position, rotation, scale ){	

				let pVideo = new Promise( function( videoResolve ){

					UrlExists( obj.res_url , function( retStatus ){
						//// 先檢查「影片物件網址是否存在」，否的話，載入「問號模型物件」
						if ( retStatus == true ){

							let assets = document.getElementById("makarAssets");

							var mp4Video, mp4Texture ;
					
							mp4Video = document.createElement('video');
							mp4Video.src = obj.res_url; // url, "Data/makarVRDemo.mp4"
							mp4Video.playsInline = true;
							mp4Video.autoplay = false;
							//thonsha add
							mp4Video.loop = true;
							//thonsha add
							mp4Video.setAttribute('crossorigin', 'anonymous');
							mp4Video.setAttribute("id", obj.obj_id+"_"+obj.res_id+"_"+self.loadSceneCount );
							// mp4Video.setAttribute("hidden", "true");
							// mp4Video.setAttribute("loop", "true");
							assets.appendChild(mp4Video); ////// add video into a-assets

							
							//// 開發需要，先將所有影片禁音
							// mp4Video.muted = true;
							
							if (window.Browser){
								if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location )  ){
								// if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
									mp4Video.muted = true;
								}
							}
							
							// mp4Texture = new THREE.VideoTexture( mp4Video );
							// mp4Texture.minFilter = THREE.LinearFilter;
							// mp4Texture.magFilter = THREE.LinearFilter;
							// //// mp4Texture.flipY = false;
							// mp4Texture.format = THREE.RGBFormat;

							mp4Video.onloadedmetadata = function() {
								var videoWidth , videoHeight;
								if (mp4Video.videoWidth >= mp4Video.videoHeight){
									videoWidth = 1;
									videoHeight = 1*mp4Video.videoHeight/mp4Video.videoWidth;
								}else{
									videoWidth = 1*mp4Video.videoWidth/mp4Video.videoHeight;
									videoHeight = 1;
								}

								// console.log("VRFunc.js: video WH=", mp4Video.videoWidth , mp4Video.videoHeight);
								let videoPlane = document.createElement("a-video");
								//20191108-start-thonsha-add
								let transparentVideo = false
								if (obj.behav){
									for(let i=0;i<obj.behav.length;i++){
										if (obj.behav[i].simple_behav == "TransparentVideo"){
											// console.log(obj.behav[i])
											transparentVideo = true;
											chromaKey = obj.behav[i].chromakey;
											slope = obj.behav[i].slope;
											threshold = obj.behav[i].threshold;
											transparentBehav = obj.behav[i];
										}
									}
								}

								if (transparentVideo){
									let rgba = chromaKey.split(",");
									var color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));

									if (transparentBehav.mode == 'RGB' || !transparentBehav.mode){
										videoPlane.setAttribute( "material", "shader: chromaKey; color: #"+color.getHexString()+";transparent: true; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";" ); //// thonsha add shader
									}
									else if (transparentBehav.mode == 'HSV'){
										let HSV = transparentBehav.HSV.split(",");
										let keyH = parseFloat(HSV[0]);
										let keyS = parseFloat(HSV[1]);
										let keyV = parseFloat(HSV[2]);
										// console.log("VRFunc.js: video HSV---------------" , keyH , keyS , keyV , transparentBehav.hue , transparentBehav.saturation , transparentBehav.brightness  );
										videoPlane.setAttribute( "material", "shader: HSVMatting; transparent: true; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+transparentBehav.hue+"; _deltaS:"+transparentBehav.saturation+"; _deltaV:"+transparentBehav.brightness+";" ); //// thonsha add shader
									}

									//20191126-end-thonsha-mod
								}
								else{
									videoPlane.setAttribute( "material", "side:double; opacity: 1.0; transparent: true; " ); //// it is work
								}
								//20191108-end-thonsha-add

								if (obj.behav){
									if (obj.behav.length==1 && transparentVideo){
										videoPlane.setAttribute('class', "unclickable" ); //// fei add
									}
									else{
										videoPlane.setAttribute('class', "clickable" );
									}
								}
								else{
									videoPlane.setAttribute('class', "unclickable" ); //// fei add
								}

								

								videoPlane.setAttribute( "id", obj.obj_id );//// fei add 
								videoPlane.setAttribute("src", "#"+obj.obj_id+"_"+obj.res_id+"_"+self.loadSceneCount ); //  

								videoPlane.mp4Video = mp4Video;
								
								// videoPlane.setAttribute("src", obj.res_url);

								// position = new THREE.Vector3( 1.5 , 0.0 , 4.0 ); ////// set for test
								// rotation = new THREE.Vector3( 0 , 0 , 0 ); ////// set for test
								// scale.multiply( new THREE.Vector3(videoWidth, videoHeight, 1) ); ////// need calculate from elements paraemter.

								//// 假如『原始圖片像素』高於『進場景材質大小』，就需要『縮小』，原始『各向異性』設為 1，以下流程改設為最高
								let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
								videoPlane.addEventListener("materialtextureloaded", function(evt){
									console.log("VRFunc.js: _loadVideo: _materialtextureloaded: videoPlane = " , videoPlane.object3D , evt );
									evt.detail.texture.anisotropy = maxAnisotropy;
									evt.detail.texture.needsUpdate = true;
								});

								self.setTransform(videoPlane, position, rotation, scale);
								videoPlane.addEventListener("loaded", function(evt){
								
									if (evt.target == evt.currentTarget){

										// setTimeout(function(){
										// 	videoPlane.setAttribute("cursor-listener", true ); //// fei add
										// }, 500 );

										// videoPlane.object3D.children[0].scale.multiply(new THREE.Vector3(videoWidth, videoHeight, 1));
										videoPlane.object3D.children[0].scale.set(videoWidth , videoHeight, 1 );
										let r = new THREE.Vector3();
										r.set(0,Math.PI, 0); 
										videoPlane.object3D.children[0].rotation.setFromVector3(r);
										// var r = videoPlane.object3D.children[0].rotation.toVector3();
										// r.add( new THREE.Vector3(0,Math.PI, 0) );
										// videoPlane.object3D.children[0].rotation.setFromVector3(r);
										videoPlane.object3D["makarObject"] = true; 
										if ( obj.behav ){

											//[start-20230920-howardhsu-modify]//
											//// 因目前quiz啟動物件的 behav 是在loadSceneObjs手動加上去的，所以這裡檢查一下
											if(videoPlane.object3D["behav"] && videoPlane.object3D["behav"].length != 0){
												obj.behav.forEach((b) => { videoPlane.object3D["behav"].push(b) })												
											} else {
												videoPlane.object3D["behav"] = obj.behav ;	
											}
											//[end-20230920-howardhsu-modify]//		

											//// 載入時候建制「群組物件資料」「注視事件」
											self.setObjectBehavAll( obj );
										}
										if(obj.behav_reference){
											videoPlane.object3D["behav_reference"] = obj.behav_reference ;
										}

										videoResolve( videoPlane );
									}
								});
								
								self.makarObjects.push( videoPlane );

								//// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
								if ( obj.active == false ){
									videoPlane.setAttribute("visible", false);
									videoPlane.setAttribute('class', "unclickable" );
								}

								//20191227-start-thonsha-mod
								let videoBehavRef = false;
								if(obj.behav_reference){
									for(let i=0; i<obj.behav_reference.length;i++){
										if (obj.behav_reference[i].behav_name == 'ShowVideo'){
											videoBehavRef = true;
											videoPlane.setAttribute("visible", false);
											videoPlane.setAttribute('class', "unclickable" );
											break;
										}
									}
									
								}
								//20191227-end-thonsha-mod

								//20191029-start-thonhsa-add
								if(obj.obj_parent_id){
									// videoPlane.setAttribute("visible", false);
									// videoPlane.setAttribute('class', "unclickable" );
									mp4Video.autoplay = false;
									let timeoutID = setInterval( function () {
										let parent = document.getElementById(obj.obj_parent_id);
										if (parent){
											if(parent.object3D.children.length > 0){
												parent.appendChild(videoPlane);
												window.clearInterval(timeoutID);
												//// deal the behavior or not.
												parent.addEventListener("child-attached", function(el){
													console.log("VRFunc.js: VRController: _loadVideo,: parent child-attached, el=", el );

													//// 假如有掛載「邏輯功能」，需要禁止一般事件操控，在這邊無條件暫停影片
													if ( obj.blockly ){

														videoPlane.blockly = obj.blockly;
														mp4Video.pause();
														mp4Video.currentTime = 0;

													} else {

														let parentVisible = true;
														videoPlane.object3D.traverseAncestors( function(parent) {
															if (parent.type != "Scene"){
																// console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not Scene parent=", parent );
																if (parent.visible == false){
																	parentVisible = false;
																}
															} else {
																if (parentVisible == true && videoPlane.object3D.visible == true && videoBehavRef == false ){
																	console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: all parent visible true=", videoPlane.object3D , videoBehavRef );
																	
																	mp4Video.autoplay = true;
																	mp4Video.play();

																	//// 提醒用戶點擊開啟聲音
																	if (window.Browser){
																		if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
																		// if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
																			self.dealVideoMuted( mp4Video );
																		}
																	}

																}else{
																	console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not all parent visible true=", parentVisible, videoPlane.object3D.visible, videoBehavRef );
																	//// rootObject.visible = false; 
																	mp4Video.muted = false;
																	mp4Video.autoplay = false;
																	mp4Video.pause();
																	mp4Video.currentTime = 0;

																}
															}
														});

													}
												});

											} 
										}
									}, 1);
								}
								else{

									if ( obj.blockly ){
										videoPlane.blockly = obj.blockly;
										mp4Video.pause();
										mp4Video.currentTime = 0;
									} else {
										mp4Video.autoplay = true;
										mp4Video.play();//// this is not necessary 

										//// 提醒用戶點擊開啟聲音
										if (window.Browser){
											if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
											// if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
												self.dealVideoMuted( mp4Video );
											}
										}
										
									}
									
									self.vrScene.appendChild(videoPlane);
								}
								//20191029-end-thonhsa-add
							

								// }, 1 );
								// self.vrScene.appendChild(videoPlane);

								// console.log("VRFunc.js: VRController: loadVideo, videoPlane=", videoPlane );
							}


						}else{

							console.log("VRFunc.js: _loadVideo , obj url not exist ", obj );
							
							obj.main_type = 'model';
							obj.sub_type = 'glb';
							obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";

							self.loadGLTFModel( obj , position, rotation, scale , self.cubeTex );

							videoResolve( 1 );

						}
					});
					

				});


				return pVideo;
				
			}
						
			this.loadLight = function( obj, position, rotation, scale ){

				let pLight = new Promise( function( lightResolve ){

					// console.log("VRFunc.js: _loadLight: obj=", obj);  
					let Light = document.createElement("a-entity");
					Light.setAttribute("id", obj.obj_id);
					let attr = "type:"+obj.light.light_type
			
					let rgb = obj.light.color.split(",");
					let color = new THREE.Color(parseFloat(rgb[0]),parseFloat(rgb[1]),parseFloat(rgb[2]));
					attr += "; color:#"+color.getHexString()

					attr += ";intensity:"+obj.light.intensity

					if (obj.light.light_type == "point" || obj.light.light_type == "spot" ){
						attr += ";distance:"+obj.light.range
						attr += ";decay: 4"
					}

					if (obj.light.light_type == "spot"){
						attr += ";angle:"+(parseFloat(obj.light.spotAngle)/2).toString()
						attr += ";penumbra: 0.2";
					}

					if (obj.light.shadow != "None"){
						Light.setAttribute("castShadow", true);
						attr += ";castShadow: true ;shadowCameraVisible: false; shadowBias:-0.0005; shadowCameraTop:10; shadowCameraBottom:-10; shadowCameraRight:10; shadowCameraLeft:-10; shadowMapHeight:1024; shadowMapWidth:1024; shadowCameraFar: 500; shadowCameraNear: 0.5"
					}

					Light.setAttribute("light", attr);
							
					if (obj.light.light_type == "directional"){
						let a = new THREE.Vector3( 0, 0, -100 );
						let b = new THREE.Euler();
						let quaternion = obj.quaternionRotation.split(",");
						let quaternionRotation = new THREE.Quaternion(parseFloat(quaternion[1]),parseFloat(quaternion[2]),parseFloat(quaternion[3]),parseFloat(quaternion[0]))
						b.setFromQuaternion(quaternionRotation)
						b.y = -b.y
						b.z = -b.z
						a.applyEuler(b);

						// Light.setAttribute( "position", a );//// origin
						self.setTransform(Light, position, rotation, scale);

						//// 子物件修改
    					//[start-20230629-howardhsu-add]//
						//// 祥霆給的正解: 
						//// 備註：這邊確認 Light.object3D.children[0].target 沒有用處，因為不再場景內部
                        //// 備註：方向光假如沒有設定 target 或是 target 未在場景內，那此方向光指向「場景原點」
                        //// 假如此方向光有 target 在
                        Light.addEventListener( 'loaded' , function( e ){
                            if ( Light.object3D && Light.object3D.children && Light.object3D.children[0] && Light.object3D.children[0].type == "DirectionalLight" ){
                                let normalVector = new THREE.Vector3( 0, 0, 1 );
                                // console.log('VRFunc.js: _loadLight: normalVector=' , normalVector );

                                let lightTarget = Light.object3D.children[0].target;
                                lightTarget.position.copy( normalVector );     
                                // console.log('VRFunc.js: _loadLight: normalVector=' , lightTarget );

                                Light.object3D.children[0].add( lightTarget ); 
                            }
                        })
						//[end-20230629-howardhsu-add]//
						
						//// 強制「平行光」不產生陰影，編輯器也是如此
						Light.setAttribute("castShadow", false);
						Light.setAttribute("light", 'castShadow: false; ');
					}

					//[start-20230630-howardhsu-add]//
					else if (obj.light.light_type == "spot"){						
						self.setTransform(Light, position, rotation, scale);
						Light.addEventListener( 'loaded' , function( e ){
                            if ( Light.object3D && Light.object3D.children && Light.object3D.children[0] && Light.object3D.children[0].type == "SpotLight" ){
                                //// 調整聚光燈照射方向
								let normalVector = new THREE.Vector3( 0, 0, 1 );
                                let lightTarget = Light.object3D.children[0].target;
                                lightTarget.position.copy( normalVector );     
                                Light.object3D.children[0].add( lightTarget ); 
                            }
                        })
					}
					else if (obj.light.light_type == "point"){
						self.setTransform(Light, position, rotation, scale);
						// console.log("VRFunc.js: _loadLight: obj.light.light_type=", obj.light.light_type)
					}
					//[end-20230630-howardhsu-add]//
					else{
						//// 目前沒有 平行光、聚光燈、點光源 以外的光源類型，不應該會走進這段
						self.setTransform(Light, position, rotation, scale);
						console.log("VRFunc.js: _loadLight: Unexpected light type!!  obj.light.light_type=", obj.light.light_type)
					}

					//// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
					if ( obj.active == false ){
						Light.setAttribute("visible", false);
					}

					console.log("VRFunc.js: _loadLight: Light=", Light);
					self.makarObjects.push( Light );
					// self.vrScene.appendChild(Light);// this = vrScene

					if(obj.obj_parent_id){
						let timeoutID = setInterval( function () {
							let parent = document.getElementById(obj.obj_parent_id);
							if (parent){ 
								if(parent.object3D.children.length > 0){
									parent.appendChild(Light);
									window.clearInterval(timeoutID);
								} 
							}
						}, 1);
					}
					else{
						self.vrScene.appendChild(Light);
					}


					lightResolve( Light );

				});

				return pLight;
			}

			function getRandomInt(max) {
				return Math.floor(Math.random() * Math.floor(max));
			}


			this.setTransform = function( obj, position, rotation, scale ){
				// console.log("VRFunc.js: setTransform: obj=", obj, "\n position=", position , "\n rotation=", rotation , "\n scale=", scale); 
				let pos = position.clone(); 
				pos.multiply( new THREE.Vector3( -1, 1, 1 ) ); ////// reverse the x direction 
				obj.setAttribute( "position", pos );//// origin 

				let rot = rotation.clone(); 
				rot.multiply( new THREE.Vector3( 1 , -1 , -1 ) ); ////// reverse x y direction
				obj.setAttribute( "rotation", rot );//// origin 

				obj.setAttribute( "scale", scale );//// origin 

				// obj.setAttribute( "width" , scale.x );////// the unit ratio is 1:100
				// obj.setAttribute( "height", scale.y );

			}

			this.checkAnimation = function (obj, dt){
				if (obj.mixer){
					obj.mixer.update(dt);
				}
				if (obj.animationSlices ){
					if (obj.animationSlices[0].index){
						if (obj.animationSlices[obj.animationSlices[0].index]){
							if (obj.mixer._actions[0].time > obj.animationSlices[obj.animationSlices[0].index].timeEnd ||
								obj.mixer._actions[0].time < obj.animationSlices[obj.animationSlices[0].index].timeStart){
								obj.mixer._actions[0].time = obj.animationSlices[obj.animationSlices[0].index].timeStart;
							}
						}
					}
				}
			}

//[start-20200617-fei0097-add]//
			this.showObjectEvent = function(target, reset ){

				if (!target){
					console.log('VRFunc.js: _showObjectEvent: target not exist', target);
					return;
				}

				if (target.getAttribute("visible")){
					target.setAttribute("visible",false);
					target.setAttribute('class', "unclickable" );
					if(target.localName=="a-video"){
						let id = target.getAttribute("src");
						if(id!=undefined){
							id = id.split("#").pop();
							let v = document.getElementById(id);
							if (v instanceof HTMLElement){
								v.pause();
							}
						}
					}

					
					//// iOS 中，同時只能存在一隻「有聲音影片」，所以需要判定。
					//// 不論是要開啟還是關閉物件，都查找整個場景一遍中所有影片是否有「可見的」，挑選一隻影片為「有聲音」，其他為「靜音」
					if (window.Browser){
						if (window.Browser.name == undefined || window.Browser.name == "safari" ){
						// if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
							self.UnMutedAndPlayAllVisibleVideo();
						}
					}


					target.object3D.traverse(function(child){
						if (child.type=="Group"){
							child.el.setAttribute('class', "unclickable" );
							if(child.el.localName=="a-video"){

								//// 假如影片物件有「邏輯」，不予以控制
								if ( child.el.blockly  ){
									console.log('VRFunc.js: _showObjectEvent: set false, video blockly: do nothing ', child );
								} else {

									let id = child.el.getAttribute("src");
									if(id!=undefined){
										id = id.split("#").pop();
										let v = document.getElementById(id);
										if (v instanceof HTMLElement){
											v.pause();
										}
									}
								}
							}
							if(child.makarObject && child.el.getAttribute("sound")){
								// child.el.components.sound.stopSound();

								if ( child.el.blockly ){
									console.log('VRFunc.js: _showObjectEvent: set false, audio blockly: do nothing ', child );
								} else {

									if (child.behav_reference){
										child.el.setAttribute("visible", false);
									}
									for(let i in child.children ){
										if ( child.children[i].children[0].type == "Audio" ){					
											if (child.children[i].children[0].isPlaying == true ){
												child.el.components.sound.stopSound();
											}
										}
									}
									
								}

							}
						}
					});
					if (reset){
						target.object3D.traverse(function(child){
							if (child.type=="Group"){
								child.el.setAttribute("visible",false);
								child.el.setAttribute('class', "unclickable" );
							}
						});
					}
				}
				else{

					//// iOS 中，同時只能存在一隻「有聲音影片」，所以需要判定。
					//// 不論是要開啟還是關閉物件，都查找整個場景一遍中所有影片是否有「可見的」，挑選一隻影片為「有聲音」，其他為「靜音」
					if (window.Browser){
						if (window.Browser.name == undefined || window.Browser.name == "safari" ){
						// if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
							self.UnMutedAndPlayAllVisibleVideo( target );
						}
					}

					target.setAttribute("visible",true);
					let id = target.getAttribute("src");
					if(id!=undefined){
						id = id.split("#").pop();
						let v = document.getElementById(id);
						if (v instanceof HTMLElement){
							// v.load();
							v.play();
						}
					}
					if(target.object3D.behav){
						target.setAttribute('class', "clickable" );
					}
					target.object3D.traverse(function(child){
						if (child.type=="Group"){
							if (child.el.getAttribute("visible")){
								if(child.el.object3D.behav){
									child.el.setAttribute('class', "clickable" );
								}
								if(child.el.localName=="a-video"){

									if ( child.el.blockly  ){
										console.log('VRFunc.js: _showObjectEvent: set true, video blockly: do nothing  ', child );
									} else {
										let id = child.el.getAttribute("src");
										if(id!=undefined){
											id = id.split("#").pop();
											let v = document.getElementById(id);
											if (v instanceof HTMLElement){
												v.play();
											}
										}

									}

									
								}
								if(child.makarObject && child.el.getAttribute("sound")){
									
									if ( child.el.blockly ){
										console.log('VRFunc.js: _showObjectEvent: set true, audio blockly: do nothing ', child );
									} else {
										child.el.components.sound.playSound();
									}

								}
							}
						}
					});
				}

			}

			this.hideGroupObjectEvent = function(target){

				if ( !target ){
					console.log('VRFunc.js: _hideGroupObjectEvent: target not exist ', target );
					return;
				}

				if (target.getAttribute("visible")){
					target.setAttribute("visible",false);
					target.setAttribute('class', "unclickable" );
					target.object3D.traverse(function(child){
						if (child.type=="Group"){
							child.el.setAttribute('class', "unclickable" );
							if(child.el.localName=="a-video"){
								let id = child.el.getAttribute("src");
								if(id!=undefined){
									id = id.split("#").pop();
									let v = document.getElementById(id);
									if (v instanceof HTMLElement){
										v.pause();
									}
								}
							}
							if(child.makarObject && child.el.getAttribute("sound")){
								//// 假如此聲音物件有掛 behav_reference[ PlayMusic ], 則將visible 改為 false ，只有觸發 PlayMusic 才能再次開啟
								if (child.behav_reference){
									child.el.setAttribute("visible", false);
								}
								//// 假如聲音物件本來在播放，則停止。因應在手機上假如在沒播放的狀況下呼叫 stop，會報錯誤
								for(let i in child.children ){
									if ( child.children[i].children[0].type == "Audio" ){					
										if (child.children[i].children[0].isPlaying == true ){
											child.el.components.sound.stopSound();
										}
									}
								}
							}
						}
					});
				}
			}


			////
			//// 清除「場景物件的事件資料」，因為 VR 會「跳整場景」，流程上會清除所有場景物件，再載入新場景物件。所以在「載入前」，要清除就場景的事件相關
			//// 包含 「事件群組」「注視事件」
			////
			this.clearBehavs = function(){
				
				let self = this;

				//// 「群組事件」
				for ( let i in self.groupDict ){
					if ( Array.isArray( self.groupDict[i].objs ) ){
						self.groupDict[i].objs.length = 0;

					}
				}

				//// 「注視事件」
				self.lookAtObjectList.length = 0;
				self.lookAtObjectList = [];
				
				for ( let i in self.lookAtTimelineDict ){
					if ( typeof( self.lookAtTimelineDict[ i ].pause ) == 'function' && typeof( self.lookAtTimelineDict[ i ].kill ) == 'function' ){
						self.lookAtTimelineDict[ i ].pause(); 
						self.lookAtTimelineDict[ i ].kill(); 
					}
				}

				self.lookAtTimelineDict = {};

			}


			////
			//// 檢查場景中物件的「 事件 / behav 」與「 事件備註 / behav_reference 」 的狀況，因為目前編輯器有出現過錯誤
			//// 目前完全不參考「 儲存的 behav_reference 資料 」，都從「 behav 」來自製 「 behav_reference 」 
			////
			this.checkVRSceneResultBehav = function(){
				let self = this;
				//// 專案id 錯誤
				if ( ! Number.isFinite( Number( self.projectIdx ) )   ){
					console.error( ' _checkVRSceneResultBehav: projectIdx error ', self.projectIdx );
					return;
				}
				//// 專案資料內容錯誤
				if ( !Array.isArray( VRSceneResult ) ||  !VRSceneResult[ self.projectIdx ] || !Number.isInteger( Number( self.sceneIndex ) )  ){
					console.error( ' _checkVRSceneResultBehav: _VRSceneResult error ', self.projectIdx , self.sceneIndex , VRSceneResult);
					return;
				}

				if ( !self.VRSceneResult[ self.projectIdx ].editor_ver || typeof( self.VRSceneResult[ self.projectIdx ].editor_ver ) != 'string' ){
					console.error( ' _checkVRSceneResultBehav: editor_ver error ', self.VRSceneResult[ self.projectIdx] );
					return;
				}

				let editor_version = self.VRSceneResult[ self.projectIdx].editor_ver.split(".");
				let scene_objs = self.editorVersionControllObjs( editor_version, self.projectIdx , self.sceneIndex );

				console.log('_checkVRSceneResultBehav: _scene_objs ', scene_objs );

				if ( ! Array.isArray( scene_objs ) ){
					return;
				}

				//// 檢查「 behav / behav_reference 」

				///// 建制列表
				let behavAll = {};
				let behavRefAll = {}; //// 這部份預計拿來對答案用
				let sceneObjDict = {};
				
				for ( let i = 0, len = scene_objs.length; i < len; i++ ){
					let sceneObj = scene_objs[i];

					if ( sceneObj.behav ){
						behavAll[ sceneObj.obj_id ] = sceneObj.behav;
					}

					//// 無條件清除 「 儲存的  behav_reference 資料 」
					if ( sceneObj.behav_reference ){
						// behavRefAll[ sceneObj.obj_id ] = sceneObj.behav_reference;
						delete sceneObj.behav_reference;
					}

					if ( sceneObj.obj_id ){
						sceneObjDict[ sceneObj.obj_id ] = sceneObj;
					}
				}


				//// 從「 事件備註 _behavRef 」 來檢查，會不會有「明明沒有事件來觸發物件顯示，但是物件上確有掛 behav_reference 」
				//// 上述情況發生的話，會造成物件啟使的時候，被設置為「不可見」，但又沒有任何事件可以觸發顯示
				// for ( let i in behavRefAll ){
				// 	let behavRefs = behavRefAll[i];
				// 	for( let j = 0, len = behavRefs.length; j < len; j++ ){
				// 		let behavRef = behavRefs[ j ];
				// 		// console.log(' _checkVRSceneResultBehav: _behavRefAll: ', i.slice(0,6) , j , behavRef );
				// 		// let behavRefObj = sceneObjDict[i];

				// 		let getBehavObj = false;
				// 		for ( let k in behavAll ){
				// 			let behavs = behavAll[k];
				// 			for ( let m = 0; m < behavs.length; m++ ){
				// 				if ( behavs[m].obj_id == i && behavs[m].simple_behav == behavRef.behav_name ){
				// 					getBehavObj = { i: m, b: behavs[m] } ;
				// 				}
				// 			}
				// 		}

				// 		if ( getBehavObj == false ){
				// 			console.error('_checkVRSceneResultBehav: _getBehavObj false', i ,j, behavRefs );

				// 			// behavRef = null;
				// 			// behavRefs = null;

				// 			// behavRefs.fuck = '12354';
				// 			// behavRef.fuck = '123';
				// 			// behavRef.behav_name = '123';
							
				// 			behavRefs.length = 0;

				// 		}else{
				// 			// console.log('_checkVRSceneResultBehav: _getBehavObj true', i ,j, behavRefs , getBehavObj );
				// 		}
				// 	}
				// }

				//// 從 「事件 behav 」來檢查「全部場景物件」中是否有物件沒有帶到「 事件備註 behav_reference 」
				//// 沒有的話，補上
				for ( let i in behavAll ){
					let behavs = behavAll[i];
					// console.log(' _checkVRSceneResultBehav: _behavAll: ', i, behavs );
					for( let j = 0, len = behavs.length; j < len; j++ ){
						let behav = behavs[ j ];
						if ( behav.simple_behav != "FingerGesture" ){
							// console.log(' _checkVRSceneResultBehav: _behavAll: ', i.slice(0,6) , j ,behav );
						}
						
						if ( behav.obj_id ){
							let behavObj = sceneObjDict[ behav.obj_id ];

							//// 無條件自製 「 _behav_reference 」
							if ( behavObj && Array.isArray( behavObj.behav_reference ) ){
								behavObj.behav_reference.push({
									behav_name: behav.simple_behav,
									target_id: behav.obj_id,
								});
							}else if ( behavObj ){
								behavObj.behav_reference = [{
									behav_name: behav.simple_behav,
									target_id: behav.obj_id,
								}];
							}else{
								console.error('_checkVRSceneResultBehav: cant get _behavObj ', behav );
							}


							// if ( behavObj.behav_reference ){
								
							// 	let getBehaveRef = false;
							// 	for ( let k = 0; k < behavObj.behav_reference.length; k++ ){
							// 		if ( behavObj.behav_reference[k].behav_name == behav.simple_behav ){
							// 			getBehaveRef = true;
							// 		}
							// 	}

							// 	if ( getBehaveRef ){
							// 		// console.log('_checkVRSceneResultBehav: getBehaveRef true', behav, behavObj,  );
							// 	}else{
							// 		console.error('_checkVRSceneResultBehav: _getBehaveRef false', behav, behavObj );
							// 	}
								
							// }else{
							// 	console.error(' _checkVRSceneResultBehav: _behavObj ref not exist error: ', behavObj );

							// }

						}
					}
				}
			}


			////
			//// 載入「場景物件」完成之後，作的「物件區域」計算
			////
			this.calcSceneArea = function(){
				
				let self = this;
				let objList = {} ;

				let objMaxX = 0;
				let objMinX = 0;
				let objMaxZ = 0;
				let objMinZ = 0;

				for ( let i = 0, len = self.makarObjects.length; i< len ; i++ ){
					
					let obj3D = self.makarObjects[i].object3D;
					if ( obj3D && obj3D.el && obj3D.el.id ){
						let boxList = [];
						obj3D.traverse( function(c){

							if ( c.isMesh && c.geometry ){
								
								let box = new THREE.Box3();
								c.geometry.computeBoundingBox();
								box.copy( c.geometry.boundingBox ).applyMatrix4( c.matrixWorld );
								if ( box.max.z == box.min.z ){
									box.max.z += 0.01;
								}

								if ( box.max.x > objMaxX ) objMaxX = box.max.x;
								if ( box.min.x < objMinX ) objMinX = box.min.x;
								if ( box.max.z > objMaxZ ) objMaxZ = box.max.z;
								if ( box.min.z < objMinZ ) objMinZ = box.min.z;
							

								let boxHelper = new THREE.Box3Helper( box , 0x56a5d3 );
								boxList.push( boxHelper );								

								//// 顯示於畫面中，測試用
								// self.vrScene.object3D.add( boxHelper );
								// console.log(' .... ' , self.makarObjects[i], box.max.clone() , box.min.clone() );
								// console.log(' .... ' , self.makarObjects[i], boxHelper.position.clone() , boxHelper.rotation.clone(), boxHelper.scale.clone(), boxHelper  );

								// console.log(' .. ' , boxHelper.position.x , boxHelper.position.z  );

							}

						});

						objList[ obj3D.el.id ] = boxList;

					}
				}

				self.objList = objList;


				let areaMax = new THREE.Vector2( objMaxX , objMaxZ );
				let areaMin = new THREE.Vector2( objMinX , objMinZ );
				
				self.areaMax = areaMax;
				self.areaMin = areaMin;
				
				// console.log(' _calcSceneArea: x = [', objMaxX, ', ' , objMinX , '], z = [' , objMaxZ, ', ' , objMinZ, ']' );

				if ( publishVRProjs && Array.isArray(publishVRProjs.result) && Number.isFinite( self.projectIdx ) ){
					
					if ( typeof( publishVRProjs.result[ self.projectIdx ].proj_descr ) == 'string' && publishVRProjs.result[ self.projectIdx ].proj_descr.includes('_walking') == true  ){
						console.log(' _calcSceneArea: walking project ' , self.projectIdx , publishVRProjs.result[ self.projectIdx ] );

						let ground = document.getElementById('__ground');
						if ( ground ){
							let gw = (objMaxX - objMinX) *2 ;
							let gd = (objMaxZ - objMinZ) *2 ;
							let gc = new THREE.Vector2( (objMaxX + objMinX)/2 , (objMaxZ + objMinZ)/2 );

							ground.setAttribute('geometry', 'width:'+ gw +'; height:'+ gd+';'   );
							ground.setAttribute('position',  {x: gc.x, y: 0.1 , z: gc.y }  );

							
							console.log(' _calcSceneArea: gwdc ', gw , gd, gc );

						}

					}else{
						console.log(' _calcSceneArea: not walking project ' , self.projectIdx , publishVRProjs.result[ self.projectIdx ] );
					}
				}else{
					console.log(' _calcSceneArea: _publishVRProjs error ' , self.projectIdx , publishVRProjs );
				}


			}


			//// 
			//// 載入「場景物件」完成之後，作的「事件」處理，目前包含「注視事件」 而已
			//// 檢查場景中物件的「 事件 / behav 」與「 事件備註 / behav_reference 」 的狀況，因為目前編輯器有出現過錯誤
			//// 流程：掃一遍「場景中物件 2d/3d 」
			////
			////
			this.setupSceneBehav = function(){
				
				let self = this;

				let behavObj = {};
				for ( let i = 0, len = self.makarObjects.length; i< len ; i++ ){
					
					let obj3D = self.makarObjects[i].object3D;
					if ( obj3D ){

						if ( obj3D.behav ){
							
						}

						if ( obj3D.behav_reference ){

						}

					}else{	
						console.error(' _setupSceneBehav: 3d obj error', i, self.makarObjects[i] );
					}

				}

				// for ( let i = 0, len = self.makarObjects2D.length; i< len ; i++ ){

				// }


				//// 從載入過程紀錄的 「注視事件列表」 來建立互動事件 「」
				//// 只有「3d物件」會有注視事件
				for ( let i = 0, len = self.lookAtObjectList.length; i < len; i++ ){
					let lookAtEvent = self.lookAtObjectList[i];

					let lookObjId = lookAtEvent.lookObjId;
					let lookObj = document.getElementById( lookObjId );
					
					let lookBehav = lookAtEvent.lookBehav;
					let targetObjId = lookBehav.obj_id;
					let reverse = lookBehav.reverse;

					let targetObj = document.getElementById( targetObjId );
					//// 確保「目標物件」「注視物件」都存在，建立持續事件
					if (lookObj && lookObj.object3D && targetObj && targetObj.object3D ){
						
						self.addLookAtTimeLine( lookObj , targetObj , lookAtEvent );

					}else{
						console.log('_setupSceneBehav: _lookAt error, obj not exist', lookObj , targetObj );
					}

				}

			}



			///// 建立「注視事件功能」
			this.addLookAtTimeLine = function( lookObj , targetObj , lookAtEvent ){

				console.log(' _addLookAtTimeLine: ', lookAtEvent );

				let self = this;

				let targetPos = new THREE.Vector3();
				targetObj.object3D.getWorldPosition(targetPos);
				
				let tl = gsap.timeline();
				self.lookAtTimelineDict[ lookAtEvent.lookObjId ] = tl;
				//// 無條件不斷重複「注視功能」
				tl.to(lookObj.object3D, {
					duration: 1100,
					delay: 0, 
					ease: 'none',
					repeat: -1,
					onUpdate: function(){
						targetObj.object3D.getWorldPosition(targetPos);
						lookObj.object3D.lookAt(targetPos);
						if ( lookAtEvent.lookBehav && lookAtEvent.lookBehav.reverse == false ){
							lookObj.object3D.rotateOnAxis( new THREE.Vector3( 0, 1 ,0 ), Math.PI );
						}
					}
				});

			}


			////
			//// 所有 「物件觸發事件」 需要作的「前置動作」
			////
			//// 1. 場景載入物件時候，假如有「觸發事件」，則往下判斷是否有「群組」，並且紀錄下來
			//// 2. 「注視事件」
			////
			this.setObjectBehavAll = function( obj ){
				
				let self = this;

				for ( let i = 0, len = obj.behav.length; i < len; i++ ){
					//// 群組事件紀錄
					if ( obj.behav[i].group != '' ){
						if ( self.groupDict[ obj.behav[i].group ] ){
							let groupObj =  self.groupDict[ obj.behav[i].group ];

							groupObj.objs.push({
								behav:  obj.behav[i]
								
							} );

						}else{

						}		
					}


					//// 注視事件紀錄
					if ( obj.behav[i].simple_behav == 'LookAt' && obj.behav[i].obj_id ){

						let lookAtEvent = {
							lookBehav: obj.behav[i] ,
							lookObjId: obj.obj_id ,
						}

						self.lookAtObjectList.push( lookAtEvent );

					}

				}
			}


			////
			//// 處理全部的 群組功能 包含 2D / 3D 
			//// 注意：目前群組功能只有作用在 「顯示/隱藏」相關的功能。我們也只先處理這些，未來在新增
			////
			this.dealAllGroupHide = function( touchObject ){

				let self = this;

				if ( !self.groupDict ){
					console.log('_dealAllGroup: missing groupDict');
					return;
				}

				//// 符合當前群組功能的 事件
				let showEventStrList = ['ShowImage2D', 'ShowImage' , 'ShowText2D', 'ShowText', 'ShowModel', 'PlayMusic', 'ShowVideo'];

				for (let i = 0; i < touchObject.behav.length; i++ ){
					let behav = touchObject.behav[i];
					if ( behav.group != ''  && self.groupDict[ behav.group ]  ){
						let groupIndex = behav.group;

						// console.log(' _dealAllGroupHide:  ', groupIndex , self.groupDict[ groupIndex ].objs );

						self.groupDict[ groupIndex ].objs.forEach( ( groupObj , groupObjIndex  )=>{
							let obj_id = groupObj.behav.obj_id;
							let getObj = self.getObjectTypeByObj_id( obj_id );

							//// 要觸發顯示隱藏的物件 要區分為 2d/3d 
							if ( getObj.obj_type == '2d'  ){
								let obj2D = getObj.obj;
								//// 「 點擊到的事件的『要觸發顯示隱藏的物件id』 」 跟 「 群組中的個別物件的物件id  」 不一樣的話，全部隱藏。
								if (  behav.obj_id != obj_id ){
									//// 檢查事件是否符合所要
									// console.log(' ...2d  ', touchObject , obj2D );
									if ( obj2D.behav_reference ){
										for ( let j = 0; j < obj2D.behav_reference.length; j++ ){
											// console.log(' ...  ', obj2D.behav_reference[j] );
											if ( showEventStrList.filter( e => e == obj2D.behav_reference[j].behav_name ).length > 0 ){
												obj2D.visible = false;
												break;
											}
										}
									}

								}

							}else if ( getObj.obj_type == '3d' ){
								let obj3D = getObj.obj;

								// console.log(' ... _obj3D: ' , obj3D.object3D );

								// console.log(' ... obj3D: behav: ', obj3D.object3D );
								if ( obj3D.object3D.behav_reference && Array.isArray( obj3D.object3D.behav_reference ) && behav.obj_id != obj_id  ){
									for ( let j = 0; j < obj3D.object3D.behav_reference.length; j++ ){
										// console.log(' ...  ', groupObjIndex , obj3D.object3D.behav_reference[j] );
										if ( showEventStrList.filter( e => e == obj3D.object3D.behav_reference[j].behav_name ).length > 0 ){

											self.hideGroupObjectEvent( obj3D );

											// obj3D.setAttribute('visible' , false );
											// obj3D.object3D.visible = false;

											break;
										}
									}
								}
								
							}

						});

					}
				}
			}


			//// 朗讀文字物件功能
			this.speechTextObj = function( textObj ){

				console.log(' _speechTextObj: _textObj: ', textObj );
				if ( typeof( speechSynthesis ) == 'object' && typeof( SpeechSynthesisUtterance ) == 'function' ){

					//// 先判斷是否已經正在說話，假如是的話，暫停說話。假如沒有正在說話，才開始說話。
					if ( speechSynthesis.speaking == true ){
						speechSynthesis.pause();
						speechSynthesis.cancel();
					} 

					let speed = textObj.speed;
					let speechLangIndex = textObj.language;
					let content = textObj.content;

					let utterance = new SpeechSynthesisUtterance( content );

					//// makar / web = 2 / 1.67
					//// makar / web = 1.5 / 1.38
					//// makar / web = 1 / 1
					//// makar / web = 0.75 / 0.76
					//// makar / web = 0.5 / 0.42
					//// 速度方面怪怪的 沒辦法，經驗判斷加上 2 階 fitting 
					//// https://mycurvefit.com/ 
					 
					// utterance.rate = ( speed **2 ) * (-0.2963) + ( speed )*1.556 - 0.266 ; // 二階
					utterance.rate = ( speed**3 ) * ( 0.1837 ) + ( speed**2 ) * ( -0.9948 ) + ( speed )* ( 2.3352 ) + ( -0.5196 ) ; // 三階
					utterance.pitch = 1;

					//// 發音語言，目前測試由 lang / voice 來控制
					//// 1. 在沒有設置 voice 情況下， lang 改變的確會影響
					//// 2. 在有設定 voice 情況下，lang 就沒有效果了
					//// 所以先判斷 voice 沒有成功的話再設定 lang 

					//// MAKAR 設定
					//// 0: en 1: zh-Hant 2: zh-Hans 3: ja 4: ko
					let setLang = 'en';
					let voiceLang = 'en-US';

					switch( speechLangIndex ){
						case 0:
							setLang = 'en';
							voiceLang = 'en-US';
							break;
						case 1:
							setLang = 'zh-TW';
							voiceLang = 'zh-TW';
							break;
						case 2:
							setLang = 'zh-CN';
							voiceLang = 'zh-CN';
							break;
						case 3:
							setLang = 'ja';
							voiceLang = 'ja-JP';
							break;
						case 4:
							setLang = 'ko';
							voiceLang = 'ko-KR';
							break;
						default:
							setLang = 'en';
							voiceLang = 'en-US';
					}
					
					
					//// 發音標準，20230530, 美語 國語（台灣） 日本語（）
					//// 另外，以下可能無法取得，判斷
					
					let tID = setInterval( function(){
						let getVoice = false;
						let voices = speechSynthesis.getVoices();
						if ( voices.length > 0 ){
							clearInterval( tID );

							//// safari 的各語言發音效果怪怪的，改為只使用預設語言來選定聲音。
							if ( window.Browser && window.Browser.name != "safari"  ){

								voices.forEach( e => {
									if ( e.lang == voiceLang ){
										getVoice = true;
										utterance.voice = e;
									}
								});
	
							}

							if ( getVoice == false ){
								utterance.lang = setLang;
							}

							speechSynthesis.speak(utterance);
							
						}
						
					}, 1);

					
				}
				
			}



//[end---20200617-fei0097-add]//


//20211116-thonsha-add-start
			this.parseLogicXML = function(projIndex, sceneIndex){
				let pXML;

				//// 假如是切換場景，前面的場景可能有邏輯功能，清除
				if ( vrController.logic && typeof( vrController.logic.stopLogic ) == 'function'  ){
					vrController.logic.stopLogic();
				}
				
				if(publishVRProjs.result[projIndex].xml_urls && publishVRProjs.result[projIndex].xml_urls[sceneIndex]  ){
					let xmlURL = publishVRProjs.result[projIndex].xml_urls[sceneIndex];

					console.log('VRFunc.js: _parseLogicXML: xmlURL = ' , xmlURL);

					let logic = new Logic();
					pXML = logic.loadXMLtoDoc(xmlURL);
					vrController.logic = logic;
				}

				return pXML;
			}



//20211116-thonsha-add-end

			//// 注意，當前影片、聲音是共用「確認面板」

			//// 處理影片物件是否播放聲音
			//// 處理影片物件是否播放聲音，目前只有 ios safari 可能呼叫到這
			this.dealVideoMuted = function( video ){
				let clickToPlayAudio = document.getElementById("clickToPlayAudio");
				clickToPlayAudio.style.display = "block";													
				clickToPlayAudio.onclick = function(){
					
					// video.muted = false;

					self.UnMutedAndPlayAllVisibleVideo();
					
					clickToPlayAudio.style.display = "none";
					clickToPlayAudio.onclick = null;
					window.allowAudioClicked = true;
				}

			}

			//// 為了 iOS 無法同時播放「超過一個有聲音的影片」，在場景中尋找是否有「當前可見的影片」，只能有一隻切換為切換為「有聲音」
			//// 流程分兩種： 1. 點擊觸發「顯示任意物件」 2. 點擊觸發「關閉任意物件」 
			//// 確定是否傳入的物件為「影片」，假如是的話，以「此影片」為主，開啟聲音
			////
			this.UnMutedAndPlayAllVisibleVideo = function( targetVideo_in ){

				//// 確定是否傳入的物件為「影片」，假如是的話，以「此影片」為主，開啟聲音
				let targetVideo;
				if (targetVideo_in){
					if ( targetVideo_in.localName == 'a-video' ){
						targetVideo = targetVideo_in;
					}
				}
				

				//// 取得「所有影片」
				let aVideos = document.getElementsByTagName('a-video');

				console.log("VRFunc.js: _UnMutedAndPlayAllVideo: aVideos.length=", aVideos.length );


				if ( targetVideo ){
					//// 假如有「要顯示的影片」
					for ( let i = 0; i < aVideos.length; i++ ){

						let videoPlane = aVideos[i];
						let mp4Video = aVideos[i].mp4Video;

						//// 開啟此影片聲音
						if ( videoPlane == targetVideo ){

							targetVideo.mp4Video.muted = false;
							targetVideo.mp4Video.autoplay = true;
							targetVideo.mp4Video.play();

						}else{

							let parentVisible = true;
							videoPlane.object3D.traverseAncestors( function(parent) {
								if (parent.type != "Scene"){
									// console.log("VRFunc.js: VRController: _UnMutedAndPlayAllVideo,: traverseAncestors: not Scene parent=", parent );
									if (parent.visible == false){
										parentVisible = false;
									}
								} else {
		
									console.log("VRFunc.js: _UnMutedAndPlayAllVideo: videoPlane =", i, parentVisible , videoPlane.object3D.visible, videoPlane );
		
									//// 這邊選定影片改為「靜音」，不論是否是「邏輯操控」
									if (parentVisible == true && videoPlane.object3D.visible == true ){
										
										mp4Video.muted = true;
										mp4Video.autoplay = true;
										mp4Video.play();

									}

									//// 我擔心「先後順訊會影響」，所以多次將「此影片」執行「切換為非靜音」
									targetVideo.mp4Video.muted = false;
									targetVideo.mp4Video.autoplay = true;
									targetVideo.mp4Video.play();

								}
							});

						}
	
					}

				} else {
					//// 假如沒有「傳入影片」，則挑選一隻「改為非靜音」，其他隻都保持靜音
					//// 挑選方式尚未決定

					let setVideoUnMuted = false;

					for ( let i = 0; i < aVideos.length; i++ ){

						let videoPlane = aVideos[i];
						let mp4Video = aVideos[i].mp4Video;
	
						let parentVisible = true;
						videoPlane.object3D.traverseAncestors( function(parent) {
							if (parent.type != "Scene"){
								// console.log("VRFunc.js: VRController: _UnMutedAndPlayAllVideo,: traverseAncestors: not Scene parent=", parent );
								if (parent.visible == false){
									parentVisible = false;
								}
							} else {
								//// 假如「已經找到場景本體」、「母體都可見」、「本體也可見」、「尚未設定一隻影片有聲音」，則設定「此影片」為「有聲音」，同時紀錄「已經設定過」
	
								console.log("VRFunc.js: _UnMutedAndPlayAllVideo: videoPlane =", i, parentVisible , videoPlane.object3D.visible, videoPlane );

								//// 這邊注意，要撇除「邏輯控制的影片」
								if (parentVisible == true && videoPlane.object3D.visible == true &&  !videoPlane.blockly ){
									
									if ( setVideoUnMuted == false ){
										console.log("VRFunc.js: _UnMutedAndPlayAllVideo: all parent visible true , _setVideoUnMuted false ", videoPlane.object3D );
									
										mp4Video.muted = false;
										mp4Video.autoplay = true;
										mp4Video.play();
										
										setVideoUnMuted = true;
									
									} else {
										console.log("VRFunc.js: _UnMutedAndPlayAllVideo: all parent visible true, _setVideoUnMuted true", videoPlane.object3D );
									
										mp4Video.muted = true;
										mp4Video.autoplay = true;
										mp4Video.play();
										
									}
								}
	
							}
						});	

					}

				}

			}

			////
			//// 切換觀看模式，目前有「VR」跟「模型觀看」 兩種
			//// 起始預設為「VR」模式 
			//// 假如「有指定觀看模式」，則切換。假如沒有輸入，則判斷當前模式，改為另一個
			////
			this.setViewMode = function( mode = '' ){

				let self = this;

				let pSet = new Promise( function( setModeResolve ){

					let aCamera = document.getElementById('aCamera');
					let oCamera = document.getElementById('oCamera');

					let aCameraObject = aCamera.getObject3D('camera');
					let oCameraObject = oCamera.getObject3D('camera');

					if ( aCamera && oCamera && aCameraObject && oCameraObject ){

						if ( mode == 'VR' ){

							oCamera.setAttribute('camera', 'active' , false );
							aCamera.setAttribute('camera', 'active' , true );		

							self.vrScene.camera = aCameraObject;

							self.viewMode = 'VR';
							if ( Number.isFinite( self.walkingStatus ) && self.walkingStatus != -1 ){
								let ground = document.getElementById('__ground');
								if ( ground ) ground.setAttribute('visible' , true );
							}

							setModeResolve( 'VR' );

						}else if ( mode == 'model' ){
							
							oCamera.setAttribute('camera', 'active' , true );
							aCamera.setAttribute('camera', 'active' , false );

							self.vrScene.camera = oCameraObject;

							self.viewMode = 'model';

							self.setWalkingObjVisible( false );

							setModeResolve( 'model' );

						}else{
							if ( oCamera.getAttribute('camera').active == false ){
							
								oCamera.setAttribute('camera', 'active' , true );
								aCamera.setAttribute('camera', 'active' , false );

								self.vrScene.camera = oCameraObject;

								self.viewMode = 'model';

								self.setWalkingObjVisible( false );
								
								setModeResolve( 'model' );
	
							} else if ( aCamera.getAttribute('camera').active == false ){
	
								oCamera.setAttribute('camera', 'active' , false );
								aCamera.setAttribute('camera', 'active' , true );		

								self.vrScene.camera = aCameraObject;

								self.viewMode = 'VR';

								if ( Number.isFinite( self.walkingStatus ) && self.walkingStatus != -1 ){
									let ground = document.getElementById('__ground');
									if ( ground ) ground.setAttribute('visible' , true );
								}

								setModeResolve( 'VR' );

							}else{
								setModeResolve( -1 );
							}	
						}
						
					}else{
						setModeResolve( -1 );
					}
				});

				return pSet;
			}



			////// 設計將 VR 專案中 cursor 的功能取消，改以點擊觸發。 
			////// 因為 VR 場景中目前不讓使用者以點擊或是滑鼠來操控物件，所以不需要額外判斷 look-control 開啟與否
			////// --------------------- debug --------------------------------

			this.getMakarObject = function( obj ){
				if (obj.makarObject != true){
					if ( obj.parent ){
						// console.log("obj.parent exist, goto");
						return ( self.getMakarObject( obj.parent ) );
					}else{
						// console.log("obj.parent not exist, return 0");
						return 0;
					}
				}else{
					// console.log("obj.makarObject == true, return", obj);
					return obj ;
				}
			}


			//// 依照「 obj_id 」 來判斷 「物件型態」為 「 2d / 3d 」
			this.getObjectTypeByObj_id = function( obj_id ){

				let self = this;

				let getObj3D = null;
				let getObj3DIndex = null;
				let getObj2D = null;
				let getObj2DIndex = null;

				//// 基本上沒有道理「同一個 obj_id 」同時在「 2d / 3d 物件」
				let getObj = {
					obj_type: '',
					obj_index: null,
					obj: null,
				}

				if ( obj_id ){

					self.makarObjects.forEach( (e,i) =>{
						if ( e.id == obj_id ){
							getObj3D = e;
							getObj3DIndex = i;
						}
					});

					//// 目前 VR 沒有 2D 界面 
					// if ( self.makarObjects2D ){
					// 	self.makarObjects2D.forEach( (e,i) =>{
					// 		if ( e.obj_id == obj_id ){
					// 			getObj2D = e;
					// 			getObj2DIndex = i;
					// 		}
					// 	});
					// }


					
					if ( ( getObj3D != null && getObj3DIndex != null ) || ( getObj2D != null && getObj2DIndex != null ) ){
						
						if ( getObj3D != null && getObj3DIndex != null ){
							console.log('_getObjectTypeByObj_id: 3d: ' , getObj3DIndex , getObj3D );
							getObj.obj_type = '3d';
							getObj.obj_index = getObj3DIndex;
							getObj.obj = getObj3D;

						}else if ( getObj2D != null && getObj2DIndex != null ){
							console.log('_getObjectTypeByObj_id: 2d: ' , getObj2DIndex , getObj2D );
							getObj.obj_type = '2d';
							getObj.obj_index = getObj2DIndex;
							getObj.obj = getObj2D;
							
						}else{
							console.log('_getObjectTypeByObj_id: fucking logic trouble.' , getObj2DIndex , getObj2D );
						}

					}else if ( ( getObj3D != null && getObj3DIndex != null ) && ( getObj2D != null && getObj2DIndex != null ) ){
						console.log('_getObjectTypeByObj_id: warning, both 2D/3D object get', obj_id , ', 3d:' , getObj3DIndex , getObj3D , ', 2d:' , getObj2DIndex , getObj2D );
						getObj.obj_type = '3d';
						getObj.obj_index = getObj3DIndex;
						getObj.obj = getObj3D;
					}else{

					}

				}

				return getObj;

			} 


			this.cameraMoveToPoint = function( paraemter ){

				
				let pointerSphere = document.getElementById('pointerSphere');
				let currentPosSphere = document.getElementById('currentPosSphere');

				if ( !pointerSphere || !currentPosSphere ){
					return;
				}


				let pMove = new Promise(function(resolve, reject){
					
					let pointPosition = paraemter.position;
					let px = Math.round(pointPosition.x * 1000) / 1000;
					let py = Math.round(pointPosition.y * 1000) / 1000;
					let pz = Math.round(pointPosition.z * 1000) / 1000;

					//// 隱藏「選定目標位置」
					pointerSphere.setAttribute("visible", false);

					//// 設定「目標相機位置」
					currentPosSphere.setAttribute("visible", true );
					currentPosSphere.object3D.position.set( px , py , pz );


					let ox = self.vrScene.camera.el.object3D.position.x;
					let oy = self.vrScene.camera.el.object3D.position.y;
					let oz = self.vrScene.camera.el.object3D.position.z;

					let direction = new THREE.Vector3(px - ox, py - oy, pz - oz);
					let direction_normalized = new THREE.Vector3(px - ox, 0, pz - oz).normalize();

					let duration = Math.round(direction.length()) * 0.2;
					// console.log(' _duration: ', duration );
					
					duration = duration > 1 ? 1 : duration;
					

					let boundRaycaster = new THREE.Raycaster(self.vrScene.camera.el.object3D.position, direction_normalized);
					if (paraemter.dealBoundary == true){
						let boundIntersect = boundRaycaster.intersectObjects( boundaries, true);
						if (boundIntersect.length > 0) {
							console.log("_cameraMoveToPoint: initial position hit boundary, distance ", boundIntersect[0].distance );
							if (boundIntersect[0].distance < 1) {
								console.log("_cameraMoveToPoint: initial position hit boundary, dont run  ");

								//// 設定「目標相機位置」
								currentPosSphere.object3D.position.copy( self.vrScene.camera.el.object3D.position );
								resolve( 1 );
								return;
							}
						}
					}
					

					let tl = gsap.timeline();
					tl.to( gsapEmpty, {
						duration: duration,
						delay: 0,
						onStart: function(){

						},
						onUpdate: function(){
							let animePos = new THREE.Vector3(ox + direction.x * this.ratio , oy, oz + direction.z * this.ratio );

							if (paraemter.dealBoundary == true){
								let boundIntersect = boundRaycaster.intersectObjects( boundaries, true);
								if (boundIntersect.length > 0) {
									// console.log(" _cameraMoveToPoint: boundIntersect=", boundIntersect[0] );
									//// 假如與『相機與邊界的距離』小於『相機要設置下一步的距離』，不應該再往前位移
									if (boundIntersect[0].distance < animePos.distanceTo( self.vrScene.camera.el.object3D.position ) ) {
									// if (boundIntersect[0].distance < 1) {

										//// 設定「目標相機位置」
										currentPosSphere.object3D.position.copy( animePos );

										tl.pause();
										tl.kill();
										tl = null;

										resolve( 1 );
										return;
									}
								}
							}

							self.vrScene.camera.el.object3D.position.set(animePos.x, animePos.y, animePos.z);
							
						},
						onComplete: function(){

							resolve( duration );

						}

					});

				});	

				return pMove;

			}

			//// 設定「點擊移動」狀態， -1: 未啟動 , 0: 已啟動,  1. 移動中。
			this.setWalkingStatus = function( _value ){

				let self = this;

				if ( Number.isFinite( self.walkingStatus ) ){
					console.log(' _setWalkingStatus: set from [', self.walkingStatus , ']', ' to [', _value, ']' );

					let ground = document.getElementById('__ground');
					let pointerSphere = document.getElementById('pointerSphere');
					let currentPosSphere = document.getElementById('currentPosSphere');

					if ( self.walkingStatus == 0 || self.walkingStatus == -1 ){
						self.walkingStatus = _value;
					}

					if ( self.walkingStatus == -1 ){
						if ( pointerSphere && currentPosSphere && ground ){
							// ground.setAttribute("visible", false );
							// pointerSphere.setAttribute("visible", false );
							// currentPosSphere.setAttribute("visible", false );
							self.setWalkingObjVisible( false );
						}
					}

					if ( self.walkingStatus == 0 ){
						if ( ground){
							ground.setAttribute("visible", true );
						}
					}

				}else{
					console.log(' _setWalkingStatus: status not exist ', self.walkingStatus );
				}

			}


			this.setWalkingObjVisible = function( _status ){

				let ground = document.getElementById('__ground');
				let pointerSphere = document.getElementById('pointerSphere');
				let currentPosSphere = document.getElementById('currentPosSphere'); 

				if ( ground && pointerSphere && currentPosSphere ){
					if ( _status == true ){
						ground.setAttribute("visible", true );
						pointerSphere.setAttribute("visible", true );
						currentPosSphere.setAttribute("visible", true );
					}else{
						ground.setAttribute("visible", false );
						pointerSphere.setAttribute("visible", false );
						currentPosSphere.setAttribute("visible", false );
					}
				}
			}


			self.vrScene.canvas.addEventListener("touchstart", startEvent, false);
			self.vrScene.canvas.addEventListener("mousedown", startEvent, false);

			self.vrScene.canvas.addEventListener("touchmove", moveEvent, false);
			self.vrScene.canvas.addEventListener("mousemove", moveEvent, false);

			self.vrScene.canvas.addEventListener("touchend", endEvent, false);
			self.vrScene.canvas.addEventListener("mouseup", endEvent, false);

			//////
			////// raycaster for touch and mouse 
			//////
			let preMouse = new THREE.Vector2();
			var mouse = new THREE.Vector2();
			var raycaster = new THREE.Raycaster();

			function getMouse(event){
				let rect = self.GLRenderer.domElement.getBoundingClientRect();

				switch ( event.type ) {
					case "mouseup":
					case "mousemove":
					case "mousedown":
						mouse.x = ( (event.clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
						mouse.y = - ( (event.clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
						break;
					case "touchend":////// 20190709 Fei: add this event type for cellphone
					case "touchstart":
					case "touchmove":
						mouse.x = ( (event.changedTouches[0].clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
						mouse.y = - ( (event.changedTouches[0].clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
						break;
					default:
						console.log("default endEvent: event.type=", event.type, " not mouseup/touchend, return ");
						return ;
				}
				return mouse.clone();
			}

			function startEvent(event){
				preMouse = getMouse(event);

				self.touchMouseState = 0;
			}

			function moveEvent(event){
				
				// console.log(' _mv ' , self.touchMouseState  );
				let moveMouse = getMouse(event);
				
				if (self.touchMouseState == 0 ){
					
					if ( moveMouse.sub(preMouse).length() > 0.01 ){
						self.touchMouseState = 1;					
					}
					// console.log("VRFunc.js: moveEvent: ", moveMouse.sub(preMouse).length()  );
				}else{
					self.touchMouseState = 1;

				}

				let ground = document.getElementById('__ground');
				let pointerSphere = document.getElementById('pointerSphere');

				if ( pointerSphere && ground ){

					if ( self.touchMouseState == 0 || self.touchMouseState == 1 ){
				
						if (!self.triggerEnable){
							return;
						}
						//// 處理「點擊移動功能」，必須要 觀看模式 為 VR 且，啟動「可移動」
						if ( self.viewMode == 'VR' && Number.isInteger (self.walkingStatus) && self.walkingStatus >= 0  ){
							
							
							if ( Array.isArray( self.currentSceneMakarObjects ) && self.currentSceneMakarObjects.length > 0  ){

							}else{
								
								for ( let i = 0; i < self.makarObjects.length; i++ ){
									let makarObject = self.makarObjects[i];
									if ( makarObject.object3D && makarObject.className == "clickable" ){

										let parentVisible = true;
										makarObject.object3D.traverseAncestors( function(parent) {
											if (parent.type != "Scene"){
												if (parent.visible == false){
													parentVisible = false;
												}
											}
										});

										if (parentVisible){
											self.currentSceneMakarObjects.push(makarObject.object3D );
										}
										
									}
								}
								self.currentSceneMakarObjects.push( ground.object3D );
							}

							let makarTHREEObjects = self.currentSceneMakarObjects;
							let showEventStrList = ['ShowImage2D', 'ShowImage' , 'ShowText2D', 'ShowText', 'ShowModel', 'PlayMusic', 'ShowVideo'];

							let selectedObjWithBehav = false;

							raycaster.setFromCamera( moveMouse , self.vrScene.camera );
		
							let groundIntersect = raycaster.intersectObjects( makarTHREEObjects , true ); 
							if (groundIntersect.length > 0){
								
								//// 判斷是否有點集到「有事件的物件」
								// groundIntersect.forEach( ( e , i ) => {

								// 	if ( e.object && e.object.el && e.object.el.id && e.object.el.object3D && Array.isArray( e.object.el.object3D.behav )  ){
								// 		// console.log(' _moveEvent: ' , i, e.object.el.id, e.object.el.object3D.behav );

								// 		for ( let j = 0; j < e.object.el.object3D.behav.length; j++ ){
								// 			if ( showEventStrList.filter( ev => ev == e.object.el.object3D.behav[j].simple_behav ).length > 0 ){
								// 				selectedObjWithBehav = true;
								// 			}
								// 		}
								// 	}

								// });
								
								// console.log(' _moveEvent: _selectedObjWithBehav ' , selectedObjWithBehav );

								//// 假如當前指向的物件不是地板，則不顯示
								if ( selectedObjWithBehav == true || ( groundIntersect[0].object && groundIntersect[0].object.el && groundIntersect[0].object.el != ground ) ){
									pointerSphere.setAttribute("visible", false );
									// pointerSphere.object3D.position.copy(groundIntersect[0].point);
								}else{
									pointerSphere.setAttribute("visible", true );
									pointerSphere.object3D.position.copy(groundIntersect[0].point);
								}

							}
						}
	
					}else{
						pointerSphere.setAttribute("visible", false);
					}

				}
				
				


			}

			function endEvent( event ) {

				// console.log("VRFunc.js: _setupFunction: endEvent: event=", event , self.triggerEnable , self.touchMouseState );

				if (!self.triggerEnable){
					return;
				}
				if (self.touchMouseState == 1){
					//// 假如 是手機，「觸碰結束」，要把手指指到的位置刪除
					if ( event.type == 'touchend' ){
						let pointerSphere = document.getElementById('pointerSphere');
						if ( pointerSphere )  pointerSphere.setAttribute("visible", false);

					}
					return;
				}

				self.touchMouseState = 2;
				
				
				event.preventDefault(); ////// if not set this, on mobile will trigger twice 
				let rect = self.GLRenderer.domElement.getBoundingClientRect();
				switch ( event.type ) {
					case "mouseup":
						mouse.x = ( (event.clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
						mouse.y = - ( (event.clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
						break;
					case "touchend":////// 20190709 Fei: add this event type for cellphone
						mouse.x = ( (event.changedTouches[0].clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
						mouse.y = - ( (event.changedTouches[0].clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
						break;
					default:
						console.log("default endEvent: event.type=", event.type, " not mouseup/touchend, return ");
						return ;
				}
				// console.log("VRFunc.js: _setupFunction: endEvent, mouse=", mouse  );

				//// 紀錄此次點擊是否有「觸發事件」，不論是「2D」「3D」「點擊事件」「邏輯功能」
				let eventTriggered = {};

				////// for the 3D scene part
				let makarTHREEObjects = [];
				for ( let i = 0; i < self.makarObjects.length; i++ ){
					let makarObject = self.makarObjects[i];
					if ( makarObject.object3D && makarObject.className == "clickable" ){

						let parentVisible = true;
						makarObject.object3D.traverseAncestors( function(parent) {
							if (parent.type != "Scene"){
								if (parent.visible == false){
									parentVisible = false;
								}
							}
						});

						if (parentVisible){
							makarTHREEObjects.push(makarObject.object3D );
						}
							

					}
				}

				raycaster.setFromCamera( mouse, self.vrScene.camera );
				let intersects = raycaster.intersectObjects(  makarTHREEObjects, true ); 
				// console.log("VRFunc.js: _setupFunction: endEvent, intersects=", intersects , makarTHREEObjects , self.makarObjects );

				//// 為了「移動功能」的判斷，只要觸發「邏輯事件」或是「觸發事件」則不執行「移動」
				let objectWithLogicEvent = false;
				let objectWithClickEvent = false;

				if (intersects.length != 0 ){
					console.log("VRFunc.js: _setupFunction: 1 endEvent, intersects=", intersects );

					let touchObject = self.getMakarObject( intersects[0].object );
					// console.log("VRFunc.js: _setupFunction: endEvent, touchObject.behav=", touchObject.behav );
					// ------
					let intersectObject3D = touchObject.el ;
					if ( intersectObject3D ) {
						if(intersectObject3D.onclickBlock){	

							objectWithLogicEvent = true;

							for(let i = 0; i < intersectObject3D.onclickBlock.length; i++){
								if(intersectObject3D.onclickBlockState[i]){
									intersectObject3D.onclickBlockState[i] = false;
									if ( vrController.logic ){
										vrController.logic.parseBlock( intersectObject3D.onclickBlock[i], function(){
											intersectObject3D.onclickBlockState[i] = true;
										} ) ; 
										
										//// 紀錄觸發到的事件
										eventTriggered['3d_logic'] = intersectObject3D.onclickBlock[i] ;
									}
								}
							}
							
						}
					}
					// ------

//[start-20200915- fei 0101-add]//
					// console.log("VRFunc.js: _setupFunction: endEvent, touchObject.behav=", touchObject );
					touchObject.traverse(function(child){
						if (child.isMesh){
							// console.log("VRFunc.js: _setupFunction: endEvent, child = " , child );
						}

					});

//[end---20200915- fei 0101-add]//

					if (touchObject.behav){
						// self.triggerEvent( touchObject.behav[0] ); // 20190827: add the parameter obj( makarObject)
						// return;

						//// 處理所有群組相關事件，目前只處理「顯示/隱藏 相關功能」，其他功能比如 「切換動畫」等之後等定義明確後再執行
						//// 未來會有 2D/3D 物件，也一並於此處理
						self.dealAllGroupHide( touchObject );


						let reset = false;
						for(let i = 0; i < touchObject.behav.length; i++){
							if (touchObject.behav[i].simple_behav == "CloseAndResetChildren"){
								reset = true;
							}
						}
						for(let i = 0; i < touchObject.behav.length; i++){
							if (touchObject.behav[i].simple_behav != "CloseAndResetChildren"){

								//[start-20230920-howardhsu-modify]//	
								if(touchObject.behav[i].simple_behav == "ShowQuiz"){
									
									//// 顯示 quiz 之前，先判斷 "瀏覽器本次載入場景後" 是否已經遊玩
									if(touchObject.behav[i].played == false){
										touchObject.behav[i].played = true	
										self.triggerEvent( touchObject.behav[i], reset, touchObject )
									} else {
										console.log('VRFunc.js: _setupFunction: endEvent:  Quiz had been played.', touchObject.behav[i].played)
									}

								} else {
									console.log("behav=", touchObject.behav[i] )
									self.triggerEvent( touchObject.behav[i], reset, self.GLRenderer, null, touchObject );
								}
								//[end-20230920-howardhsu-modify]//	

							}

							if ( touchObject.behav[i].simple_behav != 'FingerGesture' && touchObject.behav[i].simple_behav != 'LookAt' ){
								objectWithClickEvent = true;

								//// 紀錄觸發到的事件
								eventTriggered['3d_behav'] = touchObject.behav ;
							}

							//[start-20230920-howardhsu-modify]//	
							if(touchObject.behav[i].simple_behav == "PushButton"){
								//// 紀錄觸發到的事件
								eventTriggered['3d_quizButton'] = touchObject ;
							}
							//[end-20230920-howardhsu-modify]//	
						}

					}

				}

				//// 假如「點擊觸發事件」跟「邏輯點擊」都沒有執行則判斷是否「點擊地板移動」
				console.log(' event logic check: ', objectWithLogicEvent , objectWithClickEvent );
				if (  objectWithLogicEvent == false && objectWithClickEvent == false ){
					// console.log(' both pass ', self.walkingStatus , self.viewMode );
					//// 先判斷是否有使用走動功能
					//// 也只有「VR觀看模式」可以使用
					if (  Number.isInteger (self.walkingStatus) && self.viewMode == 'VR' ){
						//// 只有在待命狀態，才能觸發移動
						if ( self.walkingStatus == 0 ){

							let ground = document.getElementById('__ground');
							let intersects = raycaster.intersectObjects( [ ground.object3D ], true ); 

							if ( intersects.length > 0 ){
								let selectedObject = intersects[0].object;

								console.log(' selectedObject ', selectedObject );
								
								if ( selectedObject.el ){
									if (selectedObject.el.getAttribute("id") == "__ground" ){
										console.log(' _endEvent: object is ground ');

										self.walkingStatus = 1;
										let pmd = self.cameraMoveToPoint( {position: intersects[0].point, dealBoundary: false } );
										pmd.then( function(){
											//// 將狀態設回來 
											self.walkingStatus = 0;
										});

										//// 紀錄觸發到的事件
										eventTriggered['ground_move'] = selectedObject ;
		
									}else{
										console.log(' _endEvent: object is not ground ');
									}
								}else{
									console.log(' _endEvent: object without el ');
								}
							}

						}else if ( self.walkingStatus == -1 ){
							console.log(' _endEvent: _walkingStatus =-1')
						}else if ( self.walkingStatus == 1 ){
							console.log(' _endEvent: _walkingStatus = 1')
						}

					}

				}

				//// 判斷點擊是否有「觸發事件」，沒有的話，判斷
				if ( Object.keys( eventTriggered ).length == 0 ){
					console.log(' _entEvent: not touch anything ');
					
					if ( parent && parent.projMenuGroup && parent.controlGroup && parent.pictureBackground && parent.projectUIController && 
						typeof(parent.projectUIController.showUI) == 'function' && typeof( parent.projectUIController.hideUI ) == 'function' 
					){
						if ( parent.projectUIController.status == 1){
							//// 假如當前狀態是「顯示」，判斷是否超過一定時間，超過的話延續，還未到的話執行「隱藏」
							if ( parent.projectUIController.g_tl_show._time > 3 ){
								parent.projectUIController.showUI();
							}else{
								parent.projectUIController.hideUI();
							}
						}else if ( parent.projectUIController.status == 0 ) {
							parent.projectUIController.showUI();
						}else{
							parent.projectUIController.showUI();
						}
					}

				}else{
					console.log(' _entEvent:  touch somethong ', eventTriggered );
				}

			}


		}

		VRController.prototype.triggerEvent = function( event, reset, GLRenderer, arScene, makarObj ){
			if (!this.FUNCTION_ENABLED){
				return;
			}
			var self = this;
			let obj_id
			let target;
			switch ( event.simple_behav ){
				case "PhoneCall":
					console.log("VRFunc.js: triggerEvent: PhoneCall: event=", event );	
					let telTag = window.document.getElementById("phoneCall");
					telTag.href = "tel:"+event.phone ;
					telTag.click();
					break;

				case "SendEmail": 
					console.log("VRFunc.js: triggerEvent: SendEmail: event=", event );	
					let mailTag = window.document.getElementById("sendEmail");
					mailTag.href = "mailto:" + event.mail_to ;
					mailTag.click();
					break;

				case "OpenWebPage":
					console.log("VRFunc.js: triggerEvent: OpenWebPage: event=", event , event.url );	
					let webTag = window.document.getElementById("openWebBrowser");
					webTag.href = event.url ;
					webTag.click();
					console.log("VRFunc.js: triggerEvent: OpenWebPage: webTag=", webTag );	
					break;

				case "SceneChange":
					console.log("VRFunc.js: triggerEvent: SceneChange: event=", event );

					let sceneID = event.scene_id;

					let idx = self.projectIdx;
					for (let i = 0;i<VRSceneResult[idx].scenes.length;i++){
						if(VRSceneResult[idx].scenes[i].scene_id == sceneID){
							// window.activeVRScenes(i,j);
							//// 先將觸控關閉，再跳轉場景
							self.triggerEnable = false;
							loadPage.style.display = "block";

							if ( typeof( self.loadingTickOn )  != undefined ){
								self.loadingTickOn = true;
							}

							self.loadScene(idx,i);

						}
					}
//20200807-thonsha-mod-end
					//20191023-end-thonsha-add
					break;

				case "ShowImage":
					console.log("VRFunc.js: triggerEvent: ShowImage: event=", event );	
					obj_id = event.obj_id;
					target = document.getElementById(obj_id);
					// console.log(target)

					self.showObjectEvent(target, reset);

					break;
				case "ShowText":
					console.log("VRFunc.js: triggerEvent: ShowText: event=", event );	
					obj_id = event.obj_id;
					target = document.getElementById(obj_id);
					
					//// 同時要處理 reset  子物件 影片播放 聲音播放
					self.showObjectEvent(target, reset);	
					break;
				
				case "ShowModel":
					console.log("VRFunc.js: triggerEvent: ShowModel: event=", event );	
					obj_id = event.obj_id;
					target = document.getElementById(obj_id);

					self.showObjectEvent(target, reset);

					break;

				case "PlayMusic":
					console.log()
					
					console.log("checkAudioTypeAttr obj")

					obj_id = event.obj_id;
					target = document.getElementById(obj_id);

					if (!target){
						console.log('VRFunc.js: _PlayMusic: target not exist', target);
						break;
					}

					console.log("VRFunc.js: triggerEvent: PlayMusic: event=", event );

					if(target.getAttribute("visible")){
						target.setAttribute("visible",false);
						target.setAttribute('class', "unclickable" );
						// target.components.sound.pauseSound();
						target.components.sound.stopSound();
					}
					else{
						target.setAttribute("visible",true);
						if(target.object3D.behav){
							target.setAttribute('class', "clickable" );
						}
						// target.components.sound.playSound();

						target.components.sound.playSound();

					}

					break;
					
				case "ShowVideo":
					console.log("VRFunc.js: triggerEvent: ShowVideo: event=", event );	
					obj_id = event.obj_id;
					target = document.getElementById(obj_id);
					// console.log(target)

					self.showObjectEvent(target, reset);

					break;
				
				case "PlayAnimation":
					
					console.log("VRFunc.js: triggerEvent: _PlayAnimation: event=", event );	
					obj_id = event.obj_id;
					target = document.getElementById(obj_id);

					if (!target){
						console.log('VRFunc.js: _PlayAnimation: target not exist', target);
						break;
					}
					
					var mainAnimation;
					for(let i=1;i<target.object3D.children[0].animationSlices.length;i++){
						if (target.object3D.children[0].animationSlices[i].uid == event.uid){
							mainAnimation = target.object3D.children[0].animationSlices[i].animationName;
						}
					}
					target.setAttribute("animation-mixer", "clip: "+mainAnimation);

					if(event.loop){
						target.object3D.children[0].animationSlices[0].loop = event.uid;
						// target.object3D.children[0].animationSlices[0].idle = event.uid;
						target.object3D.children[0].animationSlices[0].uid = event.uid;
						target.object3D.children[0].animationSlices[0].changed = true;
						target.object3D.children[0].animationSlices[0].reset = true;
						// target.setAttribute('class', "unclickable" );
					}
					else{
						target.object3D.children[0].animationSlices[0].uid = event.uid;
						target.object3D.children[0].animationSlices[0].changed = true;
						target.object3D.children[0].animationSlices[0].reset = event.reset;
					}

					break;

				case "ReadText":
					console.log("VRFunc.js: _ReadText: ", event );
					//// 找到對應的文字物件
					if ( event.obj_id ){
						let textObjID = event.obj_id;
						let idx = self.projectIdx;

						if ( VRSceneResult && VRSceneResult[idx] && VRSceneResult[idx].scenes[ self.sceneIndex ] && Array.isArray( VRSceneResult[idx].scenes[ self.sceneIndex ].objs ) ){
							VRSceneResult[idx].scenes[ self.sceneIndex ].objs.forEach( e =>{
								if ( e.obj_id == textObjID  ){
									self.speechTextObj( e );
								}
							});
						}
					}

					break;

				//[start-20230920-howardhsu-add]//
				case "ShowQuiz":
					//// 顯示問答初始頁面 "點擊開始遊玩"
					let startQuiz = document.getElementById("startQuiz")				
					startQuiz.style.display = "block"
					break

				case "PushButton":
					//// 看起來會用到原本pushButton函式的只有問答
					quiz.pushButton( makarObj.el )				
					break					
				//[end-20230920-howardhsu-add]//
				default:
					console.log("VRFunc.js: triggerEvent: default: event=", event );	

					break;
			}

		}


		VRController.prototype.getSnapShot = function(){

			let self = this;

			let pSnapShot = new Promise( function( snapResolve ){

				if (!self.FUNCTION_ENABLED){
					snapResolve( -1 ); 
					return;
				}

				if ( !self || !self.GLRenderer || !self.vrScene || !self.GLRenderer.domElement || !self.vrScene.object3D ||
					!self.GLRenderer.domElement.clientWidth || !self.GLRenderer.domElement.clientHeight || 
					!self.GLRenderer.domElement.width || !self.GLRenderer.domElement.height 
				){
					console.log(' _VRController: _getSnapShot: something error ', self );
					snapResolve( -1 );
					return;
				}
	
				self.GLRenderer.clearDepth();
				self.GLRenderer.render( self.vrScene.object3D, self.vrScene.camera );
				
				// let size = self.GLRenderer.getSize();
	
				let dataURL = self.GLRenderer.domElement.toDataURL("image/png", 1.0);
	
				//// 改變 canvas，必須的。讓圖片原版比例改變。
				// let ccw = self.GLRenderer.domElement.clientWidth;
				// let cch = self.GLRenderer.domElement.clientHeight;
				// let cw = self.GLRenderer.domElement.width;
				// let ch = self.GLRenderer.domElement.height;
	
				// console.log('XRFunc.js: _SnapShot: canvas client wh= ',  ccw, cch, 'canvas wh=', cw, ch );
				// let newCanvas = document.createElement('canvas');
				// newCanvas.width = cw;
				// newCanvas.height = cw * ( cch / ccw );
				// let newCtx = newCanvas.getContext('2d');
				// newCtx.drawImage(self.GLRenderer.domElement, 0, 0, cw, ch, 0, 0, newCanvas.width , newCanvas.height );
				// var dataURL = newCanvas.toDataURL("image/png", 1.0);
	
	
				snapResolve( dataURL ) ; 

			} );

			return pSnapShot ;

		}


		//////
		////// just update the VRController, not the renderer, so it is not consistent with renderer
		//////
		// VRController.prototype.update = function(){
		// 	if (!this.FUNCTION_ENABLED){
		// 		return;
		// 	}
		// 	var self = this;
			
		// 	this.delta = this.clock.getDelta() * 1;
		// 	this.time = this.clock.elapsedTime * 1;
			
		// 	// console.log("VRFunc.js: VRController update: this.time = ", this.time, this.delta, this.vrScene.delta );
		// 	// console.log("VRFunc.js: VRController update: self.vrScene = ", self.vrScene );

		// 	for ( let i = 0; i < self.makarObjects.length; i++ ){
		// 		let makarObject = self.makarObjects[i];
		// 		if ( makarObject.object3D ){
		// 			if ( makarObject.object3D.makarObject ){
		// 				if ( makarObject.object3D.children ){
		// 					if ( makarObject.object3D.children[0] ){ // it must have only one child. 

		// 						// console.log("VRFunc.js: VRController update: makarObject, model = ", makarObject.object3D.children[0] );
		// 						self.checkAnimation( makarObject.object3D.children[0], this.delta );

		// 					}
		// 				}
		// 			}
		// 		}
		// 	}

		// 	setTimeout(  function(){
		// 		self.update();
		// 	},  this.vrScene.delta );


			
		// 	// let tstart = new Date().getTime();
		// 	////// do something

		// 	// let tend = new Date().getTime(); // small to millisecond
		// 	// let td = 30;
		// 	// if ( (tend-tstart) < 30 ) td = 30 - (tend - tstart)+1;
		// 	// else td = 1;

			
		// 	// setTimeout( this.update() );
		// }

		// }

//[start-20191111-fei0079-add]//
        var checkHost_tick = function() {
            if ( typeof(checkHost) != "undefined" ){
                if ( checkHost == "yet" ){
                    // console.log("VRFunc.js: checkHost = yet");
                    setTimeout(checkHost_tick, 50);
                }else{
                    if ( checkHost == "correct" ){
                        console.log("VRFunc.js: _checkHost_tick correct");
                    } else if ( checkHost == "fail" ){
                        //// remove all childrens of documnet
                        while (document.body.firstChild) {
                            document.body.removeChild(document.body.firstChild);
                        }
                        //// add the warning about Host
                        var divHostWarn = document.createElement('div');
                        divHostWarn.innerHTML = "<br>The host of webVR seems unauthorized,<br> please contact MIFLY ";
                        divHostWarn.style.fontSize = "18px";
                        divHostWarn.style.margin = "5px";
                        divHostWarn.style.fontWeight = "700";
                        document.body.append( divHostWarn );
                    }
                }
            } else {
                console.log("VRFunc.js: checkHost = undefined, something ERROR.");
                // setTimeout(checkHost_tick, 50);
            }
        };
		checkHost_tick();
		Module.checkMifly();
//[end---20191111-fei0079-add]//

		function forbidden( message ){
			if (document.getElementById("freeUserWarnDiv")){
				document.getElementById("freeUserWarnDiv").style.display = "block";
				document.getElementById("pUserInfo").textContent = message;
				// document.getElementById("pUserInfo").style.color = "red";
				leaveIframe.onclick = function(event){
					event.preventDefault();
					if (parent.aUI){
						// parent.aUI.closeCoreIframe();
					}
				}
			}
		}


		window.showVRProjList = function(){

			console.log('VRFunc.js: version: 2022-07-28 1650 ');

//20200102-start-thonsha-add
			// requestDeviceMotionPermission();
//20200102-end-thonsha-add
			let url = window.serverUrl;
			let makarID;

//[start-20200211-fei0090-add]//
			////// 
			////// the user_id and project from main page
			//////

			////// check the webpage is iframe or not
			if ( window.top != window.self || true ){ 
				// console.log("__VRFunc.js: _showVRProjList: _getVRSceneByUserID: parent selectedProject=", parent.selectedProject , ", _userPublishProjs=" , parent._userPublishProjs);
				
				
				makarID = parent.selectedProject.user_id;
				
				//// 這邊指定「userID」
				// makarID = "thonsha" ;
				// makarID = "fefe" ;
				// makarID = "class05" ;
				// makarID = "1626f751-f2d6-4416-8e54-a1cb6b32f870" ;


				console.log("VRFunc.js: _showVRProjList: : makarID=", makarID);
				getVRSceneByUserID(url, makarID, function(data){

					console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID: VRSceneResult=", VRSceneResult , publishVRProjs , userPublishProjs );				
					
					if (typeof(data) == "string"){ // error occur
						str = data;
						if (document.getElementById("freeUserWarnDiv")){
							document.getElementById("freeUserWarnDiv").style.display = "block";
							document.getElementById("pUserInfo").textContent =  str  ;
							// document.getElementById("pUserInfo").style.color = "red";
							leaveIframe.onclick = function(){
								event.preventDefault();
								if (parent.aUI){
									// parent.aUI.closeCoreIframe();
								}
							}
						}

					}else{ // general state.
						if (document.getElementById("freeUserWarnDiv")){
							document.getElementById("freeUserWarnDiv").style.display = "none";
						}
						for (let i = 0 ; i < publishVRProjs.result.length ; i++  ){
							
							if (publishVRProjs.result[i].proj_id == parent.selectedProject.proj_id ){
								console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID: i=", i , publishVRProjs.result[i] , VRSceneResult[i] );		


								////// 假如判定為『不可使用web服務』的帳號，多判斷所選的專案是否帶有 license，假如有license 且沒有過期，則可以使用。
								if (window.allowedMakarIDUseWeb == false ){
								// if (window.allowedMakarIDUseWeb == false && false ){

									for ( let j = 0; j < userPublishProjs.proj_list.length; j++ ){
										//// 找到「對應的專案」
										if ( publishVRProjs.result[i].proj_name.toLowerCase() == userPublishProjs.proj_list[j].proj_name.toLowerCase()  ){											
											if ( userPublishProjs.proj_list[j].web_ar == true ){
												console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID( allow by license ): i=", i );
												
												activeVRScenes(i);
												// vrUI.setProjectTable();
											
											}else{
												forbidden( "this ID <br> [" + makarID + "] <br> is free user, not allow to use webVR" );
											}

											break;
										}
									}

									// forbidden( "this ID <br> [" + makarID + "] <br> is free user, not allow to use webVR" );

								}else{

									console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID( allow by user ): i=", i );

									activeVRScenes(i);
									// vrUI.setProjectTable();
								}
							}


							//// 這邊指定專案名稱
							// // if ( publishVRProjs.result[i].proj_name == "logicTest" ){
							// if ( publishVRProjs.result[i].proj_name == "log_1" ){
							// // if ( publishVRProjs.result[i].proj_name == "t1" ){
							// 	activeVRScenes( i );
							// }

						}
						

					}
				});
							
			}


			
//[end---20200211-fei0090-add]//
	
		};
	
		window.activeVRScenes = function( projIndex, sceneIndex=0){

			////// remove the video tag, and clean the memory, must be done before remove the div 
			let videos = document.getElementsByTagName("video");
			if ( videos.length > 0 ){
				for (let i = 0; i < videos.length; i++ ){
					videos[i].pause();
					videos[i].removeAttribute("src"); // empty source 	
					videos[i].load();
				}
			}
			
			////// set the same id=vrDiv, if load the different VR project, remove the div after remove video.
			if (document.getElementById("vrDiv")){
				document.getElementById("vrDiv").remove();
			}
 
			let vrDiv;
			////// set the aframe scene
			let vrScene = document.createElement('a-scene');
			vrScene.setAttribute('id', "vrscene" ); ////// just id
			vrScene.setAttribute('crossorigin', 'anonymous');

			vrScene.setAttribute( 'embedded', "" ); ////// add this will make the scene embedded into a div
			vrScene.setAttribute( 'vr-mode-ui', "enabled: false" ); ////// disable and hide the VR button
			vrScene.setAttribute( 'debug', "true" ); ////// disable and hide the VR button

			// vrScene.setAttribute( 'device-orientation-permission-ui', "enabled: false" );

			////// set a div above a-scene, must set one of width/height be "xxx px" 
			vrDiv = document.createElement('div');
			vrDiv.style.position = "relative" ;    //  "500px" or "80%"
			vrDiv.setAttribute('id', "vrDiv" ); ////// set the same id, if load the different VR project, remove the div first.
			vrDiv.setAttribute('crossorigin', 'anonymous');

			// console.log("VRFunc.js: activeVRScenes: documentDE.WH=", document.documentElement.clientWidth, document.documentElement.clientHeight);

			// vrDiv.style.width  = Math.round(document.documentElement.clientWidth *1.0 ) + "px" ;    //  "500px" or "80%"
			// vrDiv.style.height = Math.round(document.documentElement.clientHeight*0.9 ) + "px" ;//  "500px" or "80%"
			
			vrDiv.style.width = document.documentElement.clientWidth + "px" ;    //  "500px" or "100%"
			vrDiv.style.height = Math.round(document.documentElement.clientHeight - 0) + "px" ;//  "500px" or "80%"

			// vrDiv.style.left = window.innerWidth*0.1+"px" ; //
			vrDiv.style.top = "0px" ; //
			window.onresize = function(){
				// console.log("window resize: WH=", window.innerWidth, window.innerHeight, vrDiv.clientWidth, vrDiv.clientHeight );
				vrDiv.style.width = document.documentElement.clientWidth + "px" ;    //  "500px" or "100%"
				vrDiv.style.height = Math.round(document.documentElement.clientHeight - 0) + "px" ;//  "500px" or "80%"
			};
			document.body.appendChild(vrDiv);
			vrDiv.appendChild(vrScene);
		
			
	
			if (vrScene.hasLoaded) {
				initvrscene();
			} else {
				vrScene.addEventListener('loaded', initvrscene);
			}
	
			vrScene.addEventListener('enter-vr', function(){
				// console.log("VRFunc.js: vrScene enter-vr");
			});
			vrScene.addEventListener('renderstart', function(){
				// console.log("VRFunc.js: vrScene renderstart");
			});
			
			
			//////
			////// server V3 
			//////
	
			let vrController = new VRController();
			vrController.VRSceneResult = VRSceneResult;
			vrController.publishVRProjs = publishVRProjs;

			///// 3.5.0 Data 
			let new_proj = {
				"proj_id": "018966d4-ee1e-8ca8-85aa-cb1a3c1fcef8",
				"proj_name": "\\u0032\\u0030\\u0032\\u0033\\u002D\\u0030\\u0037\\u002D\\u0031\\u0038\\u002D\\u0030\\u0032",
				"user_id": "miflytest",
				"proj_type": "vr",
				"proj_descr": "",
				"snapshot_url": "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/ProjectSnapshot/31e1a7eb6bea4fd5b415c55c1738fa6a_snapshot.jpg",
				"proj_cover_urls": [],
				"proj_platform": [
					"app"
				],
				"create_date": "2023-07-18T02:29:37.948Z",
				"last_update_date": "2023-07-18T02:29:37.948Z",
				"proj_size": "0",
				"permission": 1,
				"permission_friend": [],
				"tags": [],
				"category": [],
				"module_type": [],
				"xml_urls": [
					"https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/XML/c51d6028-50e6-44df-8dbc-6864a27c17d2.xml",
					"https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/XML/035d0108-ba94-4b68-b088-ffa9cd8c3006.xml"
				],
				"loc": [],
				"target_ids": [],
				"editor_license_key": "",	
				"editor_ver": "3.4.5"
			}
			let new_scene = {
				"editor_ver": "3.4.5",				
				"scenes": [
					{
						"info": {
							"id": "\\u0031\\u0066\\u0063\\u0034\\u0034\\u0039\\u0065\\u0030\\u0032\\u0066\\u0063\\u0033\\u0034\\u0037\\u0033\\u0064\\u0061\\u0064\\u0037\\u0033\\u0038\\u0064\\u0061\\u0039\\u0062\\u0063\\u0035\\u0038\\u0030\\u0033\\u0033\\u0037",
							"name": "\\u0053\\u0063\\u0065\\u006E\\u0065\\u0020\\u0031",
							"size": 0
						},
						"environment": {
							"shader": "Skybox/Panoramic",
							"scene_skybox_res_id": "SphericalImage",
							"scene_skybox_snapshot_4096": "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/VRProjectMipmap/412918e164d54e6696a465fba025f494_4096.jpg",
							"scene_skybox_snapshot_2048": "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/VRProjectMipmap/f91d71ef9a2844ba93a2d4dd7adb66dc_2048.jpg",
							"scene_skybox_snapshot_1024": ""
						},
						"objs": [
							{
								"res_id": "Camera",
								"generalAttr": {
									"obj_id": "89db0641-9d8e-4e97-9a6c-590cca241f81",
									"obj_name": "Camera",
									"obj_type": "3d",
									"obj_parent_id": "",
									"active": true,
									"interactable": true,
									"logic": false
								},
								"transformAttr": {
									"transform": [
										"0,1.7,0",
										"0,0,0,1",
										"1,1,1"
									],
									"rect_transform": [],
									"simulatedRotation": "0,0,0"
								},
								"materialAttr": {
									"default_shader_name": "",
									"materials": []
								},
								"animationAttr": [],
								"blocklyAttr": {},
								"typeAttr": {
									"fov": 80.0
								}
							}
						],
						"behav": [],
						"target_ids": [],
						"blocklyXML_url": "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/XML/c51d6028-50e6-44df-8dbc-6864a27c17d2.xml"
					},
					{
						"info": {
							"id": "\\u0061\\u0066\\u0037\\u0039\\u0039\\u0063\\u0030\\u0034\\u0061\\u0039\\u0034\\u0039\\u0034\\u0065\\u0030\\u0062\\u0062\\u0038\\u0035\\u0066\\u0034\\u0038\\u0062\\u0031\\u0030\\u0036\\u0064\\u0032\\u0030\\u0034\\u0032\\u0038",
							"name": "\\u0053\\u0063\\u0065\\u006E\\u0065\\u0020\\u0032",
							"size": 0
						},
						"environment": {
							"shader": "Skybox/Panoramic",
							"scene_skybox_res_id": "c5f081e011205ca1a37b652cf66391d5",
							"scene_skybox_snapshot_4096": "",
							"scene_skybox_snapshot_2048": "",
							"scene_skybox_snapshot_1024": ""
						},
						"objs": [
							{
								"res_id": "Camera",
								"generalAttr": {
									"obj_id": "9619563d-014a-49ce-8b0f-1bf21573f08c",
									"obj_name": "Camera",
									"obj_type": "3d",
									"obj_parent_id": "",
									"active": true,
									"interactable": true,
									"logic": false
								},
								"transformAttr": {
									"transform": [
										"0,1.7,0",
										"0.1238961,0.08882516,-0.01113619,0.9882488",
										"1,1,1"
									],
									"rect_transform": [],
									"simulatedRotation": "14.2917,10.27204,-2.863382E-05"
								},
								"typeAttr": {
									"fov": 80.0
								}
							}
						],
						"behav": [],
						"target_ids": [],
						"blocklyXML_url": "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/XML/035d0108-ba94-4b68-b088-ffa9cd8c3006.xml"
					}
				]
			}

			window.vrController = vrController; // 20190921 for debug

			vrController.projectIdx = projIndex;

			//// 起始設定，由於目前 「朗讀文字」的功能棟有第一次無法取得 發聲列表 問題，所以這邊先行呼叫一次
			if ( typeof( speechSynthesis ) == 'object' && typeof( SpeechSynthesisUtterance ) == 'function' ){
				let voices = speechSynthesis.getVoices();
				vrController.voices = voices;
			}

			function initvrscene(){
				
				// console.log("VRFunc.js: activeVRScenes: initvrscene vrScene=", vrScene  );
				if ( vrScene.children[2].attributes ){

				}
				// vrScene.children[2].remove(); ////// 20190921: Fei want to remove the default camera, 

				////// add the listener for show the panel or not
				// vrScene.canvas.addEventListener("touchstart", vrSceneTouch, false);
				// vrScene.canvas.addEventListener("mousedown", vrSceneTouch, false);
				// let bottomProjs = document.getElementById("bottomProjs");
				// let projsInfo = document.getElementById("projsInfo");
				// let bottomArrow = document.getElementById("bottomArrow");
				// bottomProjs.style.display = "block";
				// function vrSceneTouch(event){
				// 	//// close the author's project list 
				// 	event.preventDefault();
				// 	// console.log("VRFunc.js: _vrSceneTouch: camera rotation=", document.getElementById("camera_cursor").object3D.rotation, document.getElementById("aCamera").object3D.rotation  );

				// 	bottomProjs.className =  'collapsed' ;
				// 	projsInfo.className =  'collapsed' ;
				// 	bottomArrow.className =  'collapsed' ;

				// }


//20200604-start-thonsha-add
				vrScene.setAttribute("shadow","type: pcfsoft");
//20200604-end-thonsha-add
				

				////// set member into vrController
				let rendererSize = new THREE.Vector2();
				vrScene.renderer.getSize( rendererSize );
//20191112-start-thonsha-add

				vrScene.renderer.sortObjects = true;

				//// 「 關閉 陰影自動更新 」
				// vrScene.renderer.shadowMap.autoUpdate = false;


				// vrScene.renderer.capabilities.logarithmicDepthBuffer = true;
				
				// preserveDrawingBuffer

				console.log(" **************** vrScene " , vrScene.object3D );

//20191112-end-thonsha-add
	
				vrController.vrScene = vrScene;
				vrController.GLRenderer = vrScene.renderer;

				vrController.setupFunction();
	
				////// set cursor with animation
//20200812-thonsha-mod-start
				setTimeout(function(){
					cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;" );
					cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );
					cursorEntity.setAttribute('animation__mouseenter', "property: geometry.thetaLength; delay: 5; startEvents: mouseenter; dur: 5; from: 0.5; to: 360" );
					cursorEntity.setAttribute('animation__mouseleave', "property: geometry.thetaLength; startEvents: mouseleave; dur: 100; from: 360; to: 0.5" );
					// cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.04; radiusInner: 0.02; thetaLength: 360; thetaStart: 0;" );
					vrController.cursorEntity = cursorEntity;
				}, 1);
				let cursorEntity = document.createElement('a-entity');
				cursorEntity.setAttribute('id', "cursor_main" );
				// cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );
				// cursorEntity.setAttribute('cursor', "fuse: false; fuseTimeout: 5" );
				cursorEntity.setAttribute('raycaster', "objects: .clickable" );
				// cursorEntity.setAttribute('animation__mouseenter', "property: geometry.thetaLength; delay: 5; startEvents: mouseenter; dur: 5; from: 0.5; to: 360" );
				// cursorEntity.setAttribute('animation__mouseleave', "property: geometry.thetaLength; startEvents: mouseleave; dur: 100; from: 360; to: 0.5" );
				// cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.04; radiusInner: 0.02; thetaLength: 360; thetaStart: 0;" );
				cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;" );
				cursorEntity.setAttribute('position', "0 0 -0.1" );
				cursorEntity.setAttribute('material', "color: red; shader: flat; " );
				////// set cursor default (green)
				let cursorEntityDefault = document.createElement('a-entity');
				cursorEntityDefault.setAttribute('id', "cursor_default" );
				cursorEntityDefault.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 360; thetaStart: 0;" );
				cursorEntityDefault.setAttribute('position', "0 0 -0.1001" );
				cursorEntityDefault.setAttribute('material', "color: #2ADD2A; shader: flat; " );
				////// set the entity to contain a-camera
//20200812-thonsha-mod-end
				let aCamera = document.createElement('a-entity');
				// let aCamera = document.createElement('a-camera');

				////// 20190921 Fei add some code inside  aframe-v0.9.2.js/aframe-v0.9.2.min.js for use touch control vertical view
				aCamera.setAttribute('camera', {active: true , fov: 80 } );
				aCamera.setAttribute('look-controls', "" ); 
				aCamera.setAttribute('wasd-controls', "" );
				// aCamera.setAttribute('wasd-controls', { enabled: true } ); 

				// aCamera.setAttribute('xytouch-look-controls', "" ); ///// 20190921 Fei stop use it for now.
				aCamera.setAttribute('id', "aCamera" );
				aCamera.setAttribute('position', { x: 0 , y: 0 , z: 0 } ); ////// it is work, but cant get value
				aCamera.setAttribute( 'camera', "fov", 60 ); ////// it is work, default is 80, 60 is unity set
				aCamera.setAttribute( 'camera', "near", 0.3 ); ////// it is work, default is 0.3
				aCamera.setAttribute( 'camera', "far", 20000 ); ////// it is work, default is 10000

				// console.log("VRFunc.js: aCamera.object3D.children=", aCamera.object3D.children.length );
				// aCamera.appendChild(cursorEntity);
				// aCamera.appendChild(cursorEntityDefault);
				console.log("VRFunc.js: aCamera=", aCamera );
	
				//// 模型觀看視角的相機，起始預設為「不啟動」。
				//// 注意：啟動指令為  oCamera.setAttribute('camera', 'active:true;')  同時會關閉所有場景中 camera （設定 active false）
				//// 反之，關閉指令為  oCamera.setAttribute('camera', 'active:false;')    
				//// 

				let oCamera = document.createElement('a-entity');
				oCamera.setAttribute('id', "oCamera" );
				oCamera.setAttribute('camera', {active: true, fov: 80 } );
				oCamera.setAttribute('orbit-controls', 
				`minPolarAngle: 0; 
				maxPolarAngle: 180; 
				minDistance: 0.1; 
				maxDistance: 1000; 
				initialPosition: -5 5 13;` ); 


				////// set the a-entity to wrap the a-camera, the position and roation set here is the default value, will replace when load scene.
				let cameraEntity = document.createElement('a-entity');
				cameraEntity.setAttribute('id', "camera_cursor" ); ////// it is work, can get value!
				cameraEntity.setAttribute('position', {x: 0, y: 1.7 , z: 0} ); ////// it is work, but cant get value
				cameraEntity.setAttribute('rotation', "0 0 0" ); ////// it is work too, but still can't get value

				cameraEntity.appendChild(aCamera);

				cameraEntity.appendChild(oCamera);

				vrScene.appendChild(cameraEntity);// this = vrScene

				let ambientLight = document.createElement("a-light");
				ambientLight.setAttribute("id", "ambientLight");
				ambientLight.setAttribute("type", "ambient" );
				ambientLight.setAttribute("color", "#808080" ); // white / gray / #fff  / #c8c8c8
				ambientLight.setAttribute("ground-color", "#fff" ); // #fff , Fei dont know how it work
				ambientLight.setAttribute("intensity", 1.0 );

				vrScene.appendChild(ambientLight);// this = vrScene


				//// 假如「專案描述」帶有特定字串 _walking 增加以下功能
				//// 製作「客製化 走動功能 」
				if (  publishVRProjs.result[ projIndex ].proj_descr.includes('_walking') == true  ){

					let self = vrController;
					
					///// 紀錄當前「移動相機功能」的狀態，基本上只有「 VR 體驗 」時候可以開啟
					//// -1: 2D UI 顯示為「尚未啟動」，3D icon 隱藏，此狀態只有點擊「開啟走動功能」才可以後續觸發走動
					////  0: 2D UI 顯示為「已經啟動」，3D icon 顯示白色，此狀態為可以觸發點擊移動功能，等待移動
					////  1: 2D UI 顯示為「已經啟動」，3D icon 顯示紅色，此狀態為移動中，不可再次移動
					self.walkingStatus = -1;

					let pointerSphere = document.createElement("a-entity");
					pointerSphere.setAttribute("id" , "pointerSphere" );
					pointerSphere.setAttribute("geometry" , "primitive: ring; radiusInner: 0.35; radiusOuter: 0.5" );
					pointerSphere.setAttribute("material" , "shader: flat; color: white; side: double; opacity: 0.3; ");
					pointerSphere.setAttribute('position', {x: 0, y: 0 , z: 0} ); 
					pointerSphere.setAttribute('rotation', {x: 90, y: 0 , z: 0} ); 
					pointerSphere.setAttribute("visible", false);
					self.vrScene.appendChild(pointerSphere); 

					let currentPosSphere = document.createElement("a-entity");
					currentPosSphere.setAttribute("id" , "currentPosSphere" );
					currentPosSphere.setAttribute("geometry" , "primitive: ring; radiusInner: 0.35; radiusOuter: 0.5" );
					currentPosSphere.setAttribute("material" , "shader: flat; color: #0AC4B6; side: double; opacity: 0.3; ");
					currentPosSphere.setAttribute('position', {x: 0, y: 0 , z: 0} ); 
					currentPosSphere.setAttribute('rotation', {x: 90, y: 0 , z: 0} ); 
					currentPosSphere.setAttribute("visible", false );
					self.vrScene.appendChild(currentPosSphere); 


					//// 地板
					let ground = document.createElement("a-entity");
					ground.setAttribute("id" , "__ground" );
					ground.setAttribute("geometry" , "primitive: plane; height: 1000; width: 1000; ");
					ground.setAttribute("material" , "shader: flat; color: blue; side: back; opacity: 0.05; visible: true ");
					ground.setAttribute("visible" , false);
					ground.setAttribute('position', {x: 0, y: 0.1 , z: 0} ); 
					ground.setAttribute('rotation', {x: 90, y: 0 , z: 0} ); 
					ground.addEventListener("loaded", function(){
						ground.object3D.renderOrder = 9999;
					});
					self.vrScene.appendChild(ground);


				}



				let firstCameraSetActive = function(evt){
					vrDiv = document.getElementById("vrDiv");
					// vrDiv.style.width = document.documentElement.clientWidth + "px" ;    //  "500px" or "100%"
					// vrDiv.style.height = Math.round(document.documentElement.clientHeight - 56) + "px" ;//  "500px" or "80%"
					console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera active = ", vrScene.camera.aspect, vrDiv.clientWidth, vrDiv.clientHeight );
					vrScene.camera.aspect = vrDiv.clientWidth/vrDiv.clientHeight;
					vrScene.camera.fov = 60;
					vrScene.camera.updateProjectionMatrix();

					//// 先將觸控關閉，再跳轉場景
					vrController.triggerEnable = false;
					vrController.loadScene(projIndex, sceneIndex);
					vrController.userStartTime = new Date().getTime();
					
					// vrController.update();
					checkHost_tick();
					Module.checkMifly();

					vrScene.removeEventListener('camera-set-active', firstCameraSetActive );
				}
				vrScene.addEventListener('camera-set-active', firstCameraSetActive );


				////// try to modify the aspect ratio of camera, 20190917 Fei fail, I check the vrScene.camera is same as aCamera.object3D.children[2].
				////// But it need wait for the camera loading, at first, it is default camera, then it is the a-camera's object3D
				// console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera = ", vrScene.camera, vrScene );
				// vrScene.addEventListener('camera-set-active', function(evt) { 
				// 	vrDiv = document.getElementById("vrDiv");
				// 	// vrDiv.style.width = document.documentElement.clientWidth + "px" ;    //  "500px" or "100%"
				// 	// vrDiv.style.height = Math.round(document.documentElement.clientHeight - 56) + "px" ;//  "500px" or "80%"
				// 	console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera active = ", vrScene.camera.aspect, vrDiv.clientWidth, vrDiv.clientHeight );
				// 	vrScene.camera.aspect = vrDiv.clientWidth/vrDiv.clientHeight;
				// 	vrScene.camera.fov = 60;
				// 	vrScene.camera.updateProjectionMatrix();

				// 	//// 先將觸控關閉，再跳轉場景
				// 	vrController.triggerEnable = false;
				// 	vrController.loadScene(projIndex, sceneIndex);
				// 	vrController.userStartTime = new Date().getTime();
					
				// 	// vrController.update();
				// 	checkHost_tick();
				// 	Module.checkMifly();

				// });

	
				////// setup the test 3D object, it is work
				// vrController.loadTexture();
	
				////// setup the default button.
				//// make the stable scene2D renderer, prepare for future.
				// let test = new THREE.Object3D();
				// vrController.loadTexture2D(test, "../images/homeIcon1.png"); // homeIcon1.png, homeIcon2.jpg			
				// test.position.set( -rendererSize.x + 150 , -rendererSize.y + 150, 0 );
				// scene2D.add(test);
	
				// let plane = new THREE.Mesh( new THREE.PlaneBufferGeometry(100, 100, 0), new THREE.MeshBasicMaterial( {side: THREE.BackSide, color: new THREE.Color("rgb(50,150,50)") } ) );
				// plane.position.set( -rendererSize.x + 50 , -rendererSize.y + 50, 0 );
				// scene2D.add(plane);

//20221206-thonsha-add-start
				let skyRenderTarget = new THREE.WebGLRenderTarget(1024,1024);
				vrController.skyRenderTarget = skyRenderTarget;
				vrController.needsRenderTarget = false;
				vrController.onlySkyScene = new THREE.Scene();
//20221206-thonsha-add-end		
				
				renderTick();
	
				// console.log("VRFunc.js: initvrscene, done", vrScene, vrScene.object3D );
			}
	
			
			var renderTick = function() {
				vrController.GLRenderer.clearDepth();
//20221206-thonsha-add-start
				if (vrController.needsRenderTarget){
					vrController.GLRenderer.setRenderTarget( vrController.skyRenderTarget );
					vrController.GLRenderer.render( vrController.onlySkyScene, vrController.vrScene.camera );
					vrController.GLRenderer.setRenderTarget( null );
				}
//20221206-thonsha-add-end
				vrController.GLRenderer.render( vrController.vrScene.object3D, vrController.vrScene.camera );
				// console.log("renderTick");
				requestAnimationFrame(renderTick); // dont use it, because of the haning problem
			};
	

		}

		
	}

	function makeid(length) {
		var result           = '';
		var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
		var charactersLength = characters.length;
		for ( var i = 0; i < length; i++ ) {
		result += characters.charAt(Math.floor(Math.random() * charactersLength));
		}
		return result;
	}

	var leavedSendLog = window.leavedSendLog = function(e) {
		if (!window.publishVRProjs) return;
		if (!publishVRProjs.result) return;
		if (!publishVRProjs.result[0].user_id) return;

		let device_id;
		if (localStorage.getItem("device_id")){
			if (localStorage.getItem("device_id") >= 24 ){
				device_id = localStorage.getItem("device_id");
			}else{
				device_id = new Date().getTime() + "_" + makeid(10) ;
				localStorage.setItem( "device_id",  device_id );
			}
		}else{
			device_id = new Date().getTime() + "_" + makeid(10) ;
			localStorage.setItem( "device_id",  device_id );
		}

		let leavedTime = new Date().getTime();

		let projData = {
			"brand": Browser.name + Browser.version ,
			"os": navigator.userAgent ,
			"device_id": device_id ,
			"client": "viewer" , //// 等amos修改玩之後再改為 web 
			"user_id": publishVRProjs.result[0].user_id ,
			"proj_id": "" ,
			"proj_type":"vr" ,
			"duration_time": 0 ,
			"explore_time": 0 ,
			"play_time": 0 ,
			"location_long":0.0 ,
			"location_lan":0.0 ,
		};
		projData.proj_id = publishVRProjs.result[ vrController.projectIdx ].proj_id;
		projData.duration_time = (leavedTime - vrController.userStartTime)/1000; // 單位是秒
		projData.play_time = (leavedTime - vrController.userStartTime)/1000; // 單位是秒
		console.log("VRFunc.js: project[" + vrController.projectIdx + "] playing time = " , projData.duration_time , projData.play_time , projData.explore_time );
		let savedProjLogs  = [projData];
		localStorage.setItem("savedProjLogs", JSON.stringify(savedProjLogs) );

		return undefined;
	}
	window.onbeforeunload = leavedSendLog;
	
	// let leftTopButton = document.getElementById("leftTopButton");
	// leftTopButton.addEventListener('click', function(event){
	// 	event.preventDefault();
	// 	event.stopPropagation();
	// 	event.stopImmediatePropagation();

	// 	if ( window.vrController ){
	// 		let pSet = vrController.setViewMode();
	// 		pSet.then( function(ret){
	// 			if ( ret == 'VR' ){
	// 				leftTopButton.children[0].innerHTML = '切換觀看模式(VR)';
	// 			}else if (ret == 'model'){
	// 				leftTopButton.children[0].innerHTML = '切換觀看模式(Model)';
	// 			}
	// 		});
	// 	}

	// 	// leavedSendLog();
	// 	// //// check if in iFrame?
	// 	// if ( window.top != window.self ){
	// 	// 	console.log("makarVR.html: get iframe = " , parent.document.getElementById("vrIframe") );
	// 	// 	// parent.document.getElementById("vrIframe").remove();
	// 	// 	parent.aUI.closeCoreIframe();
	// 	// }

	// });

	var scope;
	if (typeof window !== 'undefined') {
		scope = window;
	} else {
		scope = self;
	}
	// scope.VRController = VRController;
	
	let integrateCount = 0;
	var integrateTick = function() {
		integrateCount++ ;
		if ( integrateCount > 3 ){
			console.log("VRFunc.js: integrateTick, integrateCount=", integrateCount, ", too many times" );
			return;
		}

		if (scope.AFRAME && scope.THREE) {
			console.log("VRFunc.js: integrateTick, scope=", scope , integrateCount );
			integrate();
			window.addEventListener("keyup", function(event) {
				if (event.keyCode === 13) {
					event.preventDefault();
					// getScenes();
				}
			});
		} else {
			setTimeout( function(){
				integrateTick( integrateCount );
			} , 500);
		}
	};

	if (typeof window !== 'undefined') {
		integrateTick( integrateCount );
	}

	console.log("VRFunc done, window innerWH",  window.innerWidth, window.innerHeight);


	//// 輸出文字改為由網址的頁面判斷
	let languageType = window.languageType = "tw";
	if (parent){
		let indexOfFirst = parent.location.pathname.indexOf('/', 0);
		let indexOfSecond = parent.location.pathname.indexOf('/', indexOfFirst + 1);
		let lan = parent.location.pathname.substring(1, indexOfSecond);
		if (lan == "tw" || lan == "en"){
			languageType = window.languageType = lan;
		}
	}

	let worldContent = window.worldContent= {

		userAlreadyPlayed:{tw:"此登入用戶已經遊玩過", en:"This user already played"},
		userNotLoginInfo:{tw:"必須要登入MAKAR後才可遊玩", en:"Please login at first"},
		clickToPlay:{tw:"點擊開始遊玩", en:"Click to play"},

		backToHome:{tw:"專案標題", en:"back"},
		GPSDistanceMsg:{tw:"需在GPS的範圍內才能開啟 \r\n 距離：", en:"Please to the right place"},
		GPSErrorMsg:{tw:"GPS 錯誤", en:"GPS error"},
		GPSnotSupportMsg:{tw:"沒有支援 GPS ", en:"GPS not support"},
		comfirm:{tw:"確認", en:"Comfire"},
		
	};
  
	if(languageType == "en"){
		//// 留下來當作範例 
		// let rs = leftTopButton.children[0].innerHTML.replace("專案標題" , worldContent.backToHome[languageType] );
		// leftTopButton.children[0].innerHTML = rs;
	}


})();


/***/ }),

/***/ "./js/VRMain/version3_5/AddObjectToVrController.js":
/*!*********************************************************!*\
  !*** ./js/VRMain/version3_5/AddObjectToVrController.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
//// 主因: 3D物件載入都在 VRController 底下，要呼叫load系列都要透過 VRController
//// 同時 Quiz 物件要獨立出來，但 Quiz 會需要把物件加入場景 (要呼叫load系列)

//// 目的: 將額外的3D物件加到場景裡，因此它會和 vrController 互動

////           ________________________         ____________ 
////     介面: |AddObjectToVrController| -使用→ |VRController|
////           ¯¯¯¯¯¯¯↑¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯         ¯¯¯¯¯¯¯¯¯¯¯¯¯
////                  | 實作該介面　　　　　　
////                _____
////                |Quiz|　　　　　　　　                             (因此Quiz可以將3D物件加入場景)
////                ¯¯¯¯¯¯

//// 原本是想寫 interface 但發現 js 似乎還沒有，因此寫成 class  (上圖的實作其實是用extends繼承)

//// 有實作/繼承這個Class的 就表示它能跟vrController互動
class AddObjectToVrController {
        
    //// 此時 只要 Quiz 繼承這個 class 並實作它的方法，就能把物件加入場景
    //// howardhsu has not comfirm that this is good or not, yet. 
    
    //// 考慮了如果場中存在複數個 vrController 的情況(指定是與哪個vrController互動)
    // vrController = null
    // constructor(vrController){
    //     this.vrController = vrController
    // }
    //// 但，如果寫了 constructor 就變質了  (它會連 Abstract Class 都不是，也不是 interface。 Orz


    //// ----------------
    //// 以下是 "把物件加入到場景 或 vrController 常用到的函式們" 
    ////     實作或繼承了此抽象類別的class需要去覆寫它們 以便與vrController互動

    getProjectIdx(){
        // return window.vrController.projectIdx
    }

    addTextToScene(){
        //// 把文字物件加入場景
    }

    addTextureToScene(){
        //// 把圖片物件加入場景
    }

    addGLTFModelToScene(){
        //// 把模型物件加入場景
    }

    addAudioToScene(){
        //// 把聲音物件加入場景
    }

    addVideoToScene(){
        //// 把影片物件加入場景
    }

    pushObjectToMakarObjects(){
        //// 把3D物件加入到 makarObjects 陣列
    }

    setTransform(){
        //// 把物件放到對應的場景位置
    }

    appendToVrScene(){
        //// 把物件加入到場景裡
    }
    //// ----------------

    initTest(){
        console.log("AddObjectToVrController.initTest: ", window.vrController)
    }

    // static testStaticMethod(){
    //     console.log('static method test')
    // }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AddObjectToVrController);

/***/ }),

/***/ "./js/VRMain/version3_5/MakarWebXRVersionControl.js":
/*!**********************************************************!*\
  !*** ./js/VRMain/version3_5/MakarWebXRVersionControl.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   verionControl: () => (/* binding */ verionControl)
/* harmony export */ });

//// 因應 3.5.0 改版，未來所有「場景相關資料」，必須要過「版本判斷」

//// 由於需要判斷「 所有版本 」， v3.5.0 以後 編輯器版本號 變為 4 碼

//// 專案相關 基本判斷 
function projDataBasicCheck( projData ){
    if ( !projData ){
        console.warn(' _projDataBasicCheck : _projData not exist ')
        return -1;
    }

    let editor_ver = projData.editor_ver;

    if ( !editor_ver || typeof( editor_ver ) != 'string' ){
        console.warn(' _projDataBasicCheck_: editor_ver error ' , editor_ver)
        return -1;
    }

    let vArr = editor_ver.split('.');
    if ( vArr.length != 3 && vArr.length != 4  ){
        console.warn(' _projDataBasicCheck_: vArr error ' , vArr)
        return -1;
    }

}


//// 場景相關 基本判斷流程
function sceneBasicCheck( sceneData ) {
    if ( !sceneData  ){
        console.warn(' _sceneBasicCheck_ : _sceneData not exist ')
        return -1;
    }

    let editor_ver = sceneData.editor_ver;

    //// 必須強制要有 「 editor_ver 」
    if ( !editor_ver || typeof( editor_ver ) != 'string' ){
        console.warn(' _sceneBasicCheck_: editor_ver error ' , editor_ver)
        return -1;
    }

    let vArr = editor_ver.split('.');
    if ( vArr.length != 3 && vArr.length != 4 ){
        console.warn(' _sceneBasicCheck_: vArr error ' , vArr)
        return -1;
    }
}

//// 取得「版本號」
function getVersion( editor_ver ){

    let vArr = editor_ver.split('.');
    
    let va = {};

    //// 確定版本號都為「正整數」
    let intCheck = true;
    vArr.forEach( e =>{
        if ( !Number.isInteger( Number( e ) ) ){
            intCheck = false;
        }
    })

    if ( intCheck ){
        va.v0 = Number( vArr[0] ) ;
        va.v1 = Number( vArr[1] ) ;
        va.v2 = Number( vArr[2] ) ;

        //// v3.5.0 以後，改為四碼 v3.5.0.0
        if ( vArr.length == 3 ){

        }else if ( vArr.length == 4 ){
            va.v3 = Number( vArr[ 3 ] ) ;
        }
    }

    return va;
    
}

class VerionControl {

    //// 3.5.0 以後，取得專案資料的 路徑有所變化，希望後續維持
    getOneProj ( projData ){

        let project = {};
        if ( projData ){
            let isBasicChecked = projDataBasicCheck( projData )
            if ( isBasicChecked < 0 ){
                return {};
            }else{
                project = projData;
            }
        }
    
        return project;
    
    }


    //// 從「 專案資料 」 跟 「 場景編號 」 取得 「 邏輯 XML 位址 」
    getSceneLogicXML( sceneData , sceneIndex ){
        
        let xmlUrl = '';
        if ( sceneData  ){

            let isBasicChecked = sceneBasicCheck( sceneData );
            if ( isBasicChecked < 0 ){
                return xmlUrl;
            }
            let editor_ver = sceneData.editor_ver;

            let vo = getVersion( editor_ver );

            let v0 = vo.v0 ;
            let v1 = vo.v1 ;
            let v2 = vo.v2 ;
            let v3 = vo.v3 ;
            if ( v0 == 3 && v1 >= 5 ){
                let scenes = sceneData.scenes ;
                if ( scenes[ sceneIndex ] ){
                    xmlUrl = scenes[ sceneIndex ].xml_url;
                }

            }else{
                
            }
            
            // let isBasicChecked = projDataBasicCheck( projData )
            // if ( isBasicChecked < 0 ){
            //     return {};
            // }else{

            //     if ( Array.isArray( projData.xml_urls ) && 
            //     projData.xml_urls[ sceneIndex ]
            //     ){
            //         xmlUrl = projData.xml_urls[ sceneIndex ];
            //     }
            // }

        }
    
        return xmlUrl ;

    }

    //// 取得「專案」的「編輯器版本」，使用上，假如「場景物件」的參數因應「編輯器版本」有不同
    //// 例如「模型物件的動畫」「模型物件的材質」
    getProjDataEditorVer( projData ){

        let isBasicChecked = projDataBasicCheck( projData )
        if ( isBasicChecked < 0 ){
            return {};
        }

        let editor_ver = projData.editor_ver;

        let vo = getVersion( editor_ver ); 
        
        return vo;

    }

    //// 取得 專案 場景列表
    getScenes ( sceneData ){
        //// 基本判斷 ，假如失敗。回傳空陣列
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return [];
        }
    
        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;

        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let scenes = [];
        //// 3.5.0
        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes ) ){
                scenes = sceneData.scenes ;
                console.log(' _getScenes_: success ' , vo , scenes )
            }
            
        }else{
            console.warn(' _getScenes_: vo error ' , vo)
        }
    
        return scenes ;
    
    }

    //// 從「專案場景資料」中，找出是否帶有 「AR」類型場景
    checkSceneIncludeAR( sceneData ){
        //// 基本判斷 ，假如失敗。回傳空陣列
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return false;
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;

        let vo = getVersion( editor_ver );
        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;
        let isAR = false;

        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes ) ){
                let scenes = sceneData.scenes ;
                for ( let i = 0; i < scenes.length; i++ ){
                    let scene = scenes[i];
                    if ( scene && scene.info && scene.info.type == 'ar' ){
                        isAR = true;
                    }
                }
            }
        }
        return isAR;
    }

    //// 從「專案場景資料」中，找出是否帶有 「VR」類型場景
    checkSceneIncludeVR( sceneData ){
        //// 基本判斷 ，假如失敗。回傳空陣列
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return false;
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;

        let vo = getVersion( editor_ver );
        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;
        let isVR = false;

        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes ) ){
                let scenes = sceneData.scenes ;
                for ( let i = 0; i < scenes.length; i++ ){
                    let scene = scenes[i];
                    if ( scene && scene.info && scene.info.type == 'vr' ){
                        isVR = true;
                    }
                }
            }
        }
        return isVR;
    }

    //// 從「專案場景資料」中，找出是否帶有 「VR」類型場景
    checkSceneIncludeXR( sceneData ){
        //// 基本判斷 ，假如失敗。回傳空陣列
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return false;
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;

        let vo = getVersion( editor_ver );
        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;
        let isXR = false;

        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes ) ){
                let scenes = sceneData.scenes ;
                for ( let i = 0; i < scenes.length; i++ ){
                    let scene = scenes[i];
                    if ( scene && scene.info && scene.info.type == 'ar_slam' ){
                        isXR = true;
                    }
                }
            }
        }
        return isXR;
    }


    //// 從「專案場景資料」跟「場景編號」取得「場景類型」

    getSceneType( sceneData , sceneIndex ){
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return '';
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;
        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let sceneType = '';

        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes )  ){
                let scenes = sceneData.scenes ;
                if ( scenes[ sceneIndex ]  && scenes[ sceneIndex ].info && scenes[ sceneIndex ].info.type  ){
                    sceneType = scenes[ sceneIndex ].info.type;
                }
                console.log(' _getSceneType_ : success ' , sceneType )
            }
            
        }else{
            console.warn(' _getSceneType_ : error ' , sceneIndex , sceneData )
        }

        return sceneType;

    }


    //// 從「專案場景資料」跟「場景編號」取得「場景下物件列表」
    getSceneObjs( sceneData , sceneIndex ){
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return [];
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;
        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let objs = [];

        //// 3.5.0
        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes )  ){
                
                let scenes = sceneData.scenes ;
                
                if ( scenes[ sceneIndex ]  && Array.isArray( scenes[ sceneIndex ].objs )  ){

                    objs = scenes[ sceneIndex ].objs;

                }

                console.log(' _getSceneObjs_ : success ' , vo , scenes )
            }
            
        }else{
            console.warn(' _getSceneObjs_ : vo error ' , vo)
        }

        return objs;

    }


    //// 取得場景「所有事件列表」
    getSceneBehav( sceneData , sceneIndex ){
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return [];
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;
        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let scene_behavs = [];

        //// 3.5.0
        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes )  ){
                let scenes = sceneData.scenes ;
                if ( scenes[ sceneIndex ]  && Array.isArray( scenes[ sceneIndex ].behav )  ){
                    scene_behavs = scenes[ sceneIndex ].behav;
                }
                console.log(' _getSceneBehav_ : success ' , scene_behavs )
            }
            
        }else{
            console.warn(' _getSceneBehav_ : error ' , sceneIndex , sceneData );
        }

        return scene_behavs;
    }

    //// 從 「場景所有事件」找出 與「當前物件相關」，放入物件底下
    setBehavIntoObj( sceneData , sceneIndex , obj ){
        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return [];
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;
        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let scene_behavs = [];

        //// 3.5.0
        if ( v0 == 3 && v1 >= 5 ){
            if ( sceneData && Array.isArray( sceneData.scenes )  ){
                let scenes = sceneData.scenes ;
                if ( scenes[ sceneIndex ]  && Array.isArray( scenes[ sceneIndex ].behav )  ){
                    scene_behavs = scenes[ sceneIndex ].behav;
                }

                scene_behavs.forEach( behav => {    
                    if( behav.trigger_obj_id && behav.trigger_obj_id == obj.generalAttr.obj_id ){
                        if(obj.behav && Array.isArray(obj.behav) && obj.behav.length > 0){
                            obj.behav.push(behav)
                        } else {
                            obj.behav = [behav]
                        }
                    }
                })

            }
            
        }else{
            console.warn(' _setBehavIntoObj_ : version error ' , sceneIndex , sceneData );
        }

    }


    //// 取得 物件 的 基礎 「位置」「旋轉」「大小」參數
    getObjTransform( sceneData , scene_obj ){

        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return {};
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;
        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let transform = {
            position: null,
            rotation: null,
            scale: null , 
            quaternion: null,
        }
        //// 3.5.0
        if ( v0 == 3 && v1 >= 5 ){
            if ( scene_obj.generalAttr && scene_obj.generalAttr.obj_type == '2d'  ){

                if ( scene_obj.transformAttr && scene_obj.transformAttr.rect_transform && 
                    scene_obj.transformAttr.rect_transform[0] )
                {

                    transform.position = new THREE.Vector3().fromArray( scene_obj.transformAttr.rect_transform[0].position.split(",").map( x => Number(x) ) );

                    transform.rotation = new THREE.Vector3().fromArray( scene_obj.transformAttr.rect_transform[0].rotation.split(",").map( x => Number(x) ) );

                    transform.scale = new THREE.Vector3().fromArray( scene_obj.transformAttr.rect_transform[0].scale.split(",").map( x => Number(x) ) );

                    

                }else{
                    console.warn(' _getObjTransform_ : v3.5.0 type 2d error ' , scene_obj );
                }


            } else if ( scene_obj.generalAttr && scene_obj.generalAttr.obj_type == '3d' ){

                if ( scene_obj.transformAttr && scene_obj.transformAttr.transform ){

                    transform.position = new THREE.Vector3().fromArray( scene_obj.transformAttr.transform[0].split(",").map( x => Number(x) ) );

                    let quaternionArray = scene_obj.transformAttr.transform[1].split(",").map( x => Number(x) ) 
                    transform.quaternion = new THREE.Quaternion( quaternionArray[0], quaternionArray[1], quaternionArray[2], quaternionArray[3] )

                    let eulerAngle = new THREE.Euler().setFromQuaternion( transform.quaternion, "YXZ");
                    transform.rotation = new THREE.Vector3( eulerAngle.x , 1 * eulerAngle.y , 1 * eulerAngle.z );

                    transform.scale = new THREE.Vector3().fromArray(scene_obj.transformAttr.transform[2].split(",").map(function(x){return Number(x)}) );

                }else{
                    console.warn(' _getObjTransform_ : v3.5.0 type 3d error ' , scene_obj );
                }

            }
            

        }else{
            console.warn(' _getObjTransform_ :  error ' , scene_obj );
        }

        return transform ;

    }

    //// 取得 物件 的「 2D/3D 型態 」
    getObjObjType( sceneData , scene_obj ){

        let isBasicChecked = sceneBasicCheck( sceneData );
        if ( isBasicChecked < 0 ){
            return '';
        }

        //// 進入版本控制
        let editor_ver = sceneData.editor_ver;
        let vo = getVersion( editor_ver );

        let v0 = vo.v0 ;
        let v1 = vo.v1 ;
        let v2 = vo.v2 ;
        let v3 = vo.v3 ;

        let obj_type = '';
        //// 3.5.0
        if ( v0 == 3 && v1 >= 5 ){

            if ( scene_obj.generalAttr && scene_obj.generalAttr.obj_type ){
                obj_type = scene_obj.generalAttr.obj_type
            }

        }else{
            console.warn(' _getObjObjType_ :  error ' , scene_obj );
        }

        return obj_type ;

    }

    //// 取得 2D物件 的 位置 旋轉 大小
    getObj2DTransform(vo, scene_obj) {
        //// 2022 1123 之後 3.3.8 版本上線， 2D 物件的尺寸需要版本相容
        //// 位置    縮放    尺寸   旋轉
        let rectP, rectSizeDelta, rectScale , rectR ; 
        if ( Object.keys( vo ).length == 4 ){
            let largeV  = Number( vo.v0 );
            let middleV = Number( vo.v1 );
            let smallV  = Number( vo.v2 );

            let trans;
            if ( largeV > 3 || 
                ( largeV == 3 && middleV >= 5 ) 
            ){
                // console.log("呼叫 getObj2DTransform", "表示這裡是v3.5.1.1")
                trans = getObj2DInfo350();
            } else{
                trans = getObj2DInfo350();                                              
            }

            if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  ){
                // rectP = trans.rectP;
                // rectSizeDelta = trans.rectSizeDelta;
                // rectScale = trans.rectScale;
                // rectR = trans.rectR;
                return trans;
            }else{
                // video2DResolve( false );
                console.warn(' _getObj2DInfo_ :  error ' , scene_obj );
                return false;
            }

        }else{
            let trans = getObj2DInfo350();
            if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  ){
                // rectP=trans.rectP;
                // rectSizeDelta=trans.rectSizeDelta;
                // rectScale=trans.rectScale;
                // rectR = trans.rectR;
                return trans;
            }else{
                // video2DResolve( false );
                return false;
            }
        }

        function getObj2DInfo350 (){
            let tempInfo = {};
            //// 位置    縮放    尺寸   旋轉
            let rectP, rectSizeDelta, rectScale , rectR ; 
            if ( scene_obj.transformAttr.rect_transform && Array.isArray( scene_obj.transformAttr.rect_transform ) && scene_obj.transformAttr.rect_transform.length > 0 ){

                if ( !Number.isFinite( self.selectedResolutionIndex )   ){
                    console.log(' _getObj2DInfo350: error, missing _selectedResolutionIndex' );
                    self.selectedResolutionIndex = 0;
                }
                let selectedObj2DInfo = scene_obj.transformAttr.rect_transform[ self.selectedResolutionIndex ];

                if ( selectedObj2DInfo.position && selectedObj2DInfo.size_delta && selectedObj2DInfo.rotation && selectedObj2DInfo.scale ){
                    rectP = selectedObj2DInfo.position.split(",").map(function(x){return Number(x)}); 
                    rectSizeDelta = selectedObj2DInfo.size_delta.split(",").map(function(x){return Number(x)}); 
                    rectScale = selectedObj2DInfo.scale.split(",").map(function(x){return Number(x)}); 
                    rectR = selectedObj2DInfo.rotation.split(",").map(function(x){return Number(x)});

                    let quaternionRotation = new THREE.Quaternion(parseFloat(rectR[0]), parseFloat(rectR[1]), parseFloat(rectR[2]), parseFloat(rectR[3]))
                    let eulerAngle = new THREE.Euler().setFromQuaternion( quaternionRotation, "YXZ");
                    let _rectR = new THREE.Vector3( eulerAngle.x ,  eulerAngle.y ,  eulerAngle.z );

                    //// 為了相容 ，把「旋轉資料」取代 「原本 rotation」
                    // rotation.z = b.z/Math.PI * 180 ;                    
                    _rectR.z =  -1 * _rectR.z

                    // //// 為了相容 ，把「縮放資料」取代 「原本 scale」
                    // scale.x = rectScale[0];
                    // scale.y = rectScale[1];

                    tempInfo = {
                        rectP: rectP,
                        rectSizeDelta: rectSizeDelta,
                        rectScale: rectScale,
                        rectR: _rectR
                    }
                }

            }
            return tempInfo;
        }
    }

}

const verionControl = new VerionControl();



/***/ }),

/***/ "./js/VRMain/version3_5/Quiz.js":
/*!**************************************!*\
  !*** ./js/VRMain/version3_5/Quiz.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./networkAgent.js */ "./js/VRMain/version3_5/networkAgent.js");
/* harmony import */ var _AddObjectToVrController_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./AddObjectToVrController.js */ "./js/VRMain/version3_5/AddObjectToVrController.js");
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MakarWebXRVersionControl.js */ "./js/VRMain/version3_5/MakarWebXRVersionControl.js");






////  AddObjectToVrController 是一個 "與VRController互動" 的Class。 Quiz繼承它 表示Quiz可以和VRController互動
class Quiz extends _AddObjectToVrController_js__WEBPACK_IMPORTED_MODULE_1__["default"] {
    
    //[start-20231117-howardhsu-modify]//
    type = "Quiz";
    obj_id;
    obj_type;

    //// 避免user連續點擊造成pushButton重複呼叫
    isButtonPushed = false;

	//// 當有多個quiz同時在場景中，且有quiz已經載入且顯示時，阻止其他quiz物件載入  (註: Quiz獨立出來後 已確認同時顯示多個quiz可行。但計時器和提示的html元素尚未分開 所以用此方式阻擋)
    isPlaying = true;
    isPlayed = false;
    module = {}

    //// 從VRController取得的資料
    currentProjData = {};

	//[start-20231123-renhaohsu-add]//
    //// 記錄遊玩狀態 (原本記載於 module.record)
    //// 提問之後的結論是: 暫時不進行更多改動，但若要讓 module 維持"來自編輯器的json"的理念，擇日再把 record 和 record_time, record_score, qClock 等"遊玩記錄相關" 從 module 拿出來。
    record = []
	//[end-20231123-renhaohsu-add]//
    
    constructor(obj){
        super();
        
        this.obj_id = obj.generalAttr.obj_id
        this.obj_type = obj.generalAttr.obj_type

        //// 從VRController取得資料: 在 updateRecordModule() 時需要post到後端API的資料
        if(window.vrController){
            this.currentProjData.user_id         = window.vrController.currentProjData.user_id
            this.currentProjData.proj_id         = window.vrController.currentProjData.proj_id
            this.currentProjData.head_pic        = window.vrController.currentProjData.head_pic
            this.currentProjData.loc             = window.vrController.currentProjData.loc
            this.currentProjData.module_type     = window.vrController.currentProjData.module_type
            this.currentProjData.name            = window.vrController.currentProjData.name
            this.currentProjData.proj_cover_urls = window.vrController.currentProjData.proj_cover_urls
            this.currentProjData.proj_name       = window.vrController.currentProjData.proj_name
            this.currentProjData.shared_id       = window.vrController.currentProjData.shared_id
            this.currentProjData.snapshot_url    = window.vrController.currentProjData.snapshot_url
        }

        this.module = obj.typeAttr.module
        //// 2023.11.23 討論結果 暫時先維持與v3.4一樣，不進行改動
        //// 目前的流程: 
        //// 在 load() 時又把 "來自編輯器的 module" 放到 module.json 底下
        //// 再給 this.module 多加上quiz物件&相關遊玩記錄
        //[end-20231117-howardhsu-modify]//
    }
    
    //// ----------------
    //// 為了與vrController互動 先覆寫: "把物件加入到 場景 或 vrController 常用到的函式們" 

    addTextToScene( jsonObj, position, rotation, scale, index=0, sceneObjNum=1 ){
        //// 把文字物件加入場景
        if( jsonObj.generalAttr.obj_type == "3d" ){
            return window.vrController.loadText( jsonObj, position, rotation, scale )
        } else {
            return window.vrController.loadText2D( jsonObj, index, sceneObjNum, position, rotation, scale )
        }
    }
    
    addTextureToScene( jsonObj, position, rotation, scale, index=0, sceneObjNum=1 ){
        //// 把圖片物件加入場景
        if( jsonObj.generalAttr.obj_type == "3d" ){
            return window.vrController.loadTexture( jsonObj, position, rotation, scale )
        } else {
            return window.vrController.loadTexture2D( jsonObj, index, sceneObjNum, position, rotation, scale )
        }
    }

    addGLTFModelToScene( jsonObj, position, rotation, scale ){
        //// 把模型物件加入場景
        if( jsonObj.generalAttr.obj_type == "3d" ){
            return window.vrController.loadGLTFModel( jsonObj, position, rotation, scale, vrController.cubeTex )  
        } else {
            console.log("%c quiz loadGLTFModel: quiz currently does not support GLTFModel in 2D scene.", "color:tomato;")
        }
    }

    addAudioToScene( jsonObj, position, rotation, scale ){
        //// 把聲音物件加入場景
        if( jsonObj.generalAttr.obj_type == "3d" ){
            return window.vrController.loadAudio( jsonObj, position, rotation, scale )
        } else {
            console.log("%c quiz loadAudio: quiz currently does not support Audio in 2D scene.", "color:tomato;")
        }
    }

    addVideoToScene( jsonObj, position, rotation, scale, index=0, sceneObjNum=1 ){
        //// 把影片物件加入場景
        if( jsonObj.generalAttr.obj_type == "3d" ){
            return window.vrController.loadVideo( jsonObj, position, rotation, scale )
        } else {
            return window.vrController.loadVideo2D( jsonObj, index, sceneObjNum, position, rotation, scale )
        }
    }

    pushToMakarObjects( makarObject ){
        //// 把3D物件加入到 makarObjects 陣列
        window.vrController.makarObjects.push( makarObject );
    }

    pushToMakarObjects2d( makarObject ){
        //// 把3D物件加入到 makarObjects 陣列
        window.vrController.makarObjects2D.push( makarObject );
    }

    setTransform(base, circlePos, circleRot, circleScale){
        //// 把物件放到對應的場景位置
        window.vrController.setTransform(base, circlePos, circleRot, circleScale);
    }

    appendToVrScene(quizEntity, jsonObj){
        // window.vrController.vrScene.appendChild(quizEntity);

            if(jsonObj.generalAttr.obj_parent_id){
                // console.log("jsonObj.generalAttr.obj_parent_id", jsonObj.generalAttr.obj_parent_id)
                // this.scene3DRoot.appendChild(quizEntity);

                let timeoutID = setInterval( function () {
                    let parent = document.getElementById(jsonObj.generalAttr.obj_parent_id);
                    if (parent){ 
                        if(parent.object3D.children.length > 0){
                            parent.appendChild(quizEntity);
                            window.clearInterval(timeoutID);
                        } 
                    }
                }, 1);

            } else {
                // console.log("quizEntity", quizEntity)

                window.vrController.vrScene.appendChild(quizEntity);
            }
        }

    appendToVrScene2d(quizEntity, jsonObj){
        // window.vrController.scene2D.add(quizEntity.object3D);
        
        if(jsonObj.generalAttr.obj_parent_id){
        
            let timeoutID = setInterval( function () {
                let parent = null
                for (let i = 0; i < window.vrController.makarObjects2D.length; i++ ){
                    if ( window.vrController.makarObjects2D[i].obj_id == jsonObj.generalAttr.obj_parent_id  ){
                        parent = window.vrController.makarObjects2D[i];
                    }
                }

                if (parent){ 
                    // console.log("quiz2d find parentObj=", parent)
                    if(parent.children.length > 0){
                        parent.add(quizEntity.object3D)
                        // console.log("quizEntity.object3D", quizEntity.object3D)
                        window.clearInterval(timeoutID);
                    } 
                }
            }, 10);
        }
        else{
            window.vrController.scene2D.add(quizEntity.object3D)
        }

    }

    //// ---------------- 其他會用到 vrController 的細項們
    clearObject(){
        //// 把物件從 vrController.makarObject 清除、從頁面上移除
        
        if(this.obj_type == "3d"){

            let temp = []
            let quizEntity = this.module.quizEntity;

            for (let item of quizEntity.children) {
                temp.push(item);
            }
            temp.forEach( item => {
                // console.log("%c _quiz _clearObject item=", "color:salmon", item)
                for (let i = 0; i < window.vrController.makarObjects.length; i++ ){
                    if (window.vrController.makarObjects[i].id == item.id){
                        let makarObject = window.vrController.makarObjects[i];
                        if(makarObject.getAttribute("src")){
                            let id = makarObject.getAttribute("src").split('#')[1];
                            if (document.getElementById(id)){
                                document.getElementById(id).remove();
                            }
                        }
                        makarObject.remove();
                        window.vrController.makarObjects.splice(i,1);
                    }
                }
            });

        } else if(this.obj_type == "2d"){
            // console.log("%c 2d quizzzzzzzz children=", "color: salmon; font-size: 20px", this.module.quizEntity.object3D.children[0].children)

            // let childrens = this.module.quizEntity.object3D.children[0].children
            let childrens = this.module.quizEntity.object3D.children
            childrens.forEach( child => {
                vrController.makarObjects2D = vrController.makarObjects2D.filter(item => item !== child)
            })
            childrens.length = 0
            // console.log("%c quiz nextQuestion clearObjects childrens=", "color:cyan; font-size:20px", childrens)
        } else {
            console.log("_Quiz _loadQuestion: There shall not be any type except for 2d3d")
        }

    }
    //// ----------------
    
    
    //[start-20231006-howardhsu-add]//
    //// 從user線上素材庫拿json
    ////   (只有在 loadQuestion 使用，因為 loadOption 需要檢查不同東西)
    setTypesFromUserRes(obj){
        //// res_url and main_type no longer exist in ver. 3.5's VRSceneResult
        //// get res_url, main_type from userProjResDict or userOnlineResDict
        if( makarUserData.userProjResDict || typeof( makarUserData.userOnlineResDict ) == 'object' ){  
    
            if(makarUserData.userProjResDict[obj.res_id]){

                if(makarUserData.userProjResDict[obj.res_id].res_url){
                    obj.res_url = makarUserData.userProjResDict[obj.res_id].res_url
                }
                if(makarUserData.userProjResDict[obj.res_id].main_type){
                    obj.main_type = makarUserData.userProjResDict[obj.res_id].main_type
                }
                if(makarUserData.userProjResDict[obj.res_id].sub_type){
                    obj.sub_type = makarUserData.userProjResDict[obj.res_id].sub_type
                }

            } else if(makarUserData.userOnlineResDict[obj.res_id]){

                if(makarUserData.userOnlineResDict[obj.res_id].res_url){
                    obj.res_url = makarUserData.userOnlineResDict[obj.res_id].res_url
                }
                if(makarUserData.userOnlineResDict[obj.res_id].main_type){
                    obj.main_type = makarUserData.userOnlineResDict[obj.res_id].main_type
                }
                if(makarUserData.userOnlineResDict[obj.res_id].sub_type){
                    obj.sub_type = makarUserData.userOnlineResDict[obj.res_id].sub_type
                }

            } else {
                // checkDefaultImage(obj)
                (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_2__.checkDefaultObj)(obj)
                switch (obj.res_id) {

                    //// 編輯器裡，目前問答裡的物件不會是光或相機
                    // case "Camera":
                    // case "Light":
                    //     obj.main_type = obj.res_id.toLowerCase()
                    //     break
    
                    case "Text":
                        obj.main_type = obj.res_id.toLowerCase()
                        obj.sub_type = 'txt'
                        break;
                        
                    case "Button":
                        obj.main_type = obj.res_id.toLowerCase()
                        obj.main_type = 'button'
                        obj.sub_type = 'button'
                        break;

                    default:
                        //// check if obj is default model
                        let defaultModelNames = ["Cube", "Capsule", "Sphere", "ch_Bojue", "ch_Fei", "ch_Lina", "ch_Poyuan", "ch_Roger"]
                        if(defaultModelNames.find(name => name == obj.res_id)){
                            // console.log("是預設model: ", obj.res_id)
                            obj.main_type = "model"
                        } else {
                            console.warn("Quiz.js: setTypesFromUserRes: main_type does not exist. obj=", obj)        
                        }
                        break;
                }
                
                console.log("Quiz.js: setTypesFromUserRes: obj=", obj)
            }
    
        } else {
            console.warn("Quiz.js: setTypesFromUserRes: userProjResDict or userOnlineResDict does not exist. obj=", obj)    
        }
    
        return obj
    }
    //[end-20231006-howardhsu-add]//


    //// 載入 quiz
    load( obj, position, rotation, scale) {

        //// 載入之前已經先檢查是否網頁端有用戶登入，也已檢查是否玩過此專案，這裡只要進行載入
        let quizEntity = document.createElement("a-entity");
        quizEntity.setAttribute("id", obj.generalAttr.obj_id);

        let qObject3D = new THREE.Object3D();


        if(obj.generalAttr.obj_type == "3d"){
            this.pushToMakarObjects(quizEntity)
            quizEntity.addEventListener( 'loaded' , function(){
                ///// 增加一個「空物件」，代表此 entity 已經自身載入完成
                qObject3D["obj_id"]  = obj.generalAttr.obj_id
                qObject3D["makarType"] = 'quiz';
                qObject3D["makarObject"]  = true ;
                
                //// 2d似乎不影響 3d必須用add
                quizEntity.object3D.add( qObject3D );
            });

        } else if(obj.generalAttr.obj_type == "2d"){
            // let qObject3D = new THREE.Object3D();
            // qObject3D.obj_id = obj.generalAttr.obj_id
            // qObject3D.makarType = 'quiz2D';
            // qObject3D.makarObject = true ;
            // quizEntity.object3D.add( qObject3D );
            // this.pushToMakarObjects2d(qObject3D)

            
            let scaleRatioXY = window.vrController.scaleRatioXY
            let selectedResolutionIndex = window.vrController.selectedResolutionIndex
            if( !selectedResolutionIndex ) {
                //// 有時候會還沒有值 預設先給0
                selectedResolutionIndex = 0
            }
            let _position = new THREE.Vector3().fromArray( obj.transformAttr.rect_transform[selectedResolutionIndex].position.split(",").map( x => Number(x) ) )
            let _rotation = new THREE.Vector4().fromArray( obj.transformAttr.rect_transform[selectedResolutionIndex].rotation.split(",").map( x => Number(x) ) )
            let _scale = new THREE.Vector3().fromArray( obj.transformAttr.rect_transform[selectedResolutionIndex].scale.split(",").map( x => Number(x) ) )
            
            let quaternionRotation = new THREE.Quaternion( _rotation.x,  _rotation.y,  _rotation.z,  _rotation.w)
            let eulerAngle = new THREE.Euler().setFromQuaternion( quaternionRotation, "YXZ");
            let _rectR = new THREE.Vector3( eulerAngle.x ,  eulerAngle.y ,  eulerAngle.z );
    
            // //// 為了相容 ，把「旋轉資料」取代 「原本 rotation」
            _rectR.z =  -1 * _rectR.z


            // let qObject3D = new THREE.Object3D();
            qObject3D["obj_id"]  = obj.generalAttr.obj_id
            qObject3D["makarType"] = 'quiz2D';
            qObject3D["makarObject"]  = true ;

            //// 2d似乎不影響 3d必須用add
            // quizEntity.object3D.add( qObject3D );
            quizEntity.object3D = qObject3D 


            // //// 位置
            qObject3D.translateX(  _position.x*scaleRatioXY ) ;
            qObject3D.translateY( - _position.y*scaleRatioXY ) ;
            // qObject3D.translateZ( -1 + i/sceneObjNum );// [-1, 0] 
            qObject3D.translateZ( 1 );// [-1, 0] 
    
            qObject3D.rotateZ( _rectR.z ) 
    
            qObject3D.scale.set( _scale.x , _scale.y, 1 );



            this.pushToMakarObjects2d(qObject3D)

                
            


        } else {
            console.log("_Quiz _loadQuestion: There shall not be any type except for 2d3d")
        }

        
        
        if ( obj.behav ){
            qObject3D["behav"] = obj.behav ;

            //// 載入時候建制「群組物件資料」「注視事件」
            self.setObjectBehavAll( obj );
        }


        //[end-20240124-renhaohsu-modify]//


        
        qObject3D.visible = true
        if (obj.generalAttr.active == false){
            qObject3D.visible = false;
        }


        //// 處理亂序出題
        let randomQuestionList = [];
        for (let i=0; i<obj.typeAttr.module.question_list.length; i++){
            if (obj.typeAttr.module.question_list[i].allowRandom){
                randomQuestionList.push(i);
            }
        }
    
        //// user設定的題目排序方式 這邊判斷「呈現題目」是否有值。沒有的話直接返回
        if( !obj.typeAttr.module.display_order_list || obj.typeAttr.module.display_order_list.length == 0 ){
            console.warn("Quiz.js _load: ERROR - user has not set display_order_list. obj.typeAttr.module=", obj.typeAttr.module)
            return
        }

        let totalActiveScoreQuestion = 0
        for (let i=0;i<obj.typeAttr.module.display_order_list.length;i++){
            let tempIdx =  obj.typeAttr.module.display_order_list[i].index;
            if (tempIdx == -1){
                let randInt = (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_2__.getRandomInt)(randomQuestionList.length);
                let randomIdx = randomQuestionList[randInt];
                obj.typeAttr.module.display_order_list[i].index = randomIdx
                tempIdx = randomIdx;
                randomQuestionList.splice(randInt,1);
            }
            if (obj.typeAttr.module.question_list[tempIdx].active_score){
                totalActiveScoreQuestion += 1;
            }
        }
    
        //// 起始題目
        let idx = obj.typeAttr.module.display_order_list[0].index;
        let first_question = obj.typeAttr.module.question_list[idx];
    
        //// 計時器
        let timerContent = document.getElementById('timerContent');
    
        let firstTimer = -1;
        if (obj.typeAttr.module.timer_type == "Total"){
            firstTimer = obj.typeAttr.module.total_time;
            let timer = document.getElementById("timerDiv");
            timer.style.display = "block";
    
            let hour = Math.floor(firstTimer/3600);
            let min = Math.floor((firstTimer-hour*3600)/60);
            let sec = firstTimer-hour*3600-min*60;
            timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
        }
        else if(obj.typeAttr.module.timer_type == "Custom"){
            firstTimer = first_question.time_limit;
            let timer = document.getElementById("timerDiv");
            timer.style.display = "block";
    
            let hour = Math.floor(firstTimer/3600);
            let min = Math.floor((firstTimer-hour*3600)/60);
            let sec = firstTimer-hour*3600-min*60;
            timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
        }
    
        //// 提示區域
        let tipButtonDiv = document.getElementById("tipButtonDiv");
        if(first_question.show_tips){
            tipButtonDiv.style.display = "block";
            tipButtonDiv.addEventListener("click",function(){
                let tipDiv = document.getElementById("tipDiv");
                let tipConfirmButton = document.getElementById("tipConfirmButton");
                let tipContent = document.getElementById("tipContent");
                tipDiv.style.display = "block";
                tipContent.textContent = first_question.tips_content;
                tipConfirmButton.addEventListener("click",function(){
                    tipDiv.style.display = "none";
                });
            });
        }
        else{
            tipButtonDiv.style.display = "none";
        }
    
        this.module = {
            "json":obj.typeAttr.module, 
            "quizEntity":quizEntity, 
            "currentIndex":0, 
            "score":0, 
            "choices":[], 
            "correctAnswer":0, 
            "totalActiveScoreQuestion":totalActiveScoreQuestion, 
            "record":new Array(obj.typeAttr.module.question_list.length), 
            "timer":{"currentTimer":null,"counter":firstTimer } , 
            "record_time":0 , 
            "qClock": Date.now() 
        }
    
        let scoreDiv = document.getElementById("scoreDiv")
        scoreDiv.addEventListener("click", ()=>{
            scoreDiv.style.display = "none";
            this.nextQuestion();
        });
    
        // console.log("Quiz.js: _load: _first_question=", first_question );
    
        //// 載入第一題「題目物件」
        if ( first_question.questions_json && Array.isArray( first_question.questions_json ) ){
            for(let i=0; i<first_question.questions_json.length; i++){

                //[start-20231004-howardhsu-modify]//
                this.loadQuestion(first_question.questions_json[i])      
                //[end-20231004-howardhsu-modify]//          
            }
        }
        
        //// 載入第一題選項
        if ( first_question.options_json && Array.isArray( first_question.options_json ) ){
    
            for(let i=0; i<first_question.options_json.length; i++){

                //[start-20231006-howardhsu-modify]//
                let {pOption, sub_type} = this.loadOption(first_question.options_json[i])
                // console.log("Quiz.js: _load: _loadOption: pOption=", pOption )                
                //[end-20231006-howardhsu-modify]//
                
                //// 多選題要讓「選項物件」增加「圓圈」
                if (sub_type != "button" && (first_question.option_type == "MutiOption_Text"|| first_question.option_type == "MutiOption_Image")){
    
                    if ( (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_2__.isPromise)( pOption ) == false ){
                        continue;
                    }
    
                    pOption.then( ( ret ) => {
                        //[start-20240227-renhaohsu-modify]//	
                        let optionObject = ret;
    
                        let circlePos = new THREE.Vector3(0,0,0);
                        let circleRot = new THREE.Vector3(0,0,0);
                        let circleScale = new THREE.Vector3(1,1,1);
                        let quaternion = new THREE.Quaternion( );
    
                        if(first_question.option_type == "MutiOption_Text"){
                            switch (this.obj_type) {
                                case "3d":
                                    this.multiOptionTextCircle3d(optionObject, circlePos, circleRot, circleScale)
                                    break;

                                case "2d":
                                    this.multiOptionTextCircle2d(optionObject, circlePos, circleRot, circleScale)
                                    break;
                            
                                default:
                                    console.log("_Quiz _load: There shall not be any type except for 2d3d")
                                    break;
                            }    
                        } else if (first_question.option_type == "MutiOption_Image"){
                            switch (this.obj_type) {
                                case "3d":
                                    let timeoutID = setInterval( () => {
                                        //[start-20230923-renhaohsu-add]//    
                                        //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                                        if (this.module.currentIndex >= this.module.json.display_order_list.length){
                                            window.clearInterval(this.module.timer.currentTimer)
                                        }                             
                                        //[end-20230923-renhaohsu-add]//

                                        if (optionObject.getAttribute("heightForQuiz")){ 
                                            let height = optionObject.getAttribute("heightForQuiz");

                                            this.multiOptionImageCircle3d(optionObject, circlePos, circleRot, circleScale)
                                            
                                            window.clearInterval(timeoutID);
                                        }
                                    }, 1);
                                    break;

                                case "2d":
                                    this.multiOptionImageCircle2d(optionObject, circlePos, circleRot, circleScale)
                                    break;
                            
                                default:
                                    console.log("_Quiz _load: There shall not be any type except for 2d3d")
                                    break;
                            }
                        } else {
                            console.warn("MultiOption should be either MutiOption_Text or MutiOption_Image.")
                        }
                        //[end-20240227-renhaohsu-modify]//
                    });
                }
            }
        } else {
            console.warn("_quiz _load: data might be incorrect, first_question.options_json=", first_question.options_json)
            return
        }
    
        //// 20210107-每一秒執行一次，將counter減一，並顯示剩餘秒數，到0會跳時間到 ////
        if (this.module.timer.counter >= 0){
            this.module.qClock = Date.now();
            let timeoutID = setInterval( () => {                
                this.module.timer.currentTimer = timeoutID;
                this.module.timer.counter -= 1;
                
                //[start-20230923-howardhsu-add]//    
                //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                if (this.module.currentIndex >= this.module.json.display_order_list.length){
                    window.clearInterval(this.module.timer.currentTimer)
                }                             
                //[end-20230923-howardhsu-add]//

                let hour = Math.floor(this.module.timer.counter/3600);
                let min = Math.floor((this.module.timer.counter-hour*3600)/60);
                let sec = this.module.timer.counter-hour*3600-min*60;
                timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
                // console.log(this.module.timer.counter);
                if (this.module.timer.counter == 0){
    
                    window.clearInterval(this.module.timer.currentTimer);
                    if (obj.typeAttr.module.timer_type == "Custom"){
                        if (first_question.show_score){
                            let scoreDiv = document.getElementById("scoreDiv");
                            let score = document.getElementById("score");
                            scoreDiv.style.display = "block";
                            score.textContent = this.module.score;
                            
                        }
                        else{
                            this.nextQuestion();
                        }
                    }
                    else{
                        this.clearObject()
    
                        let tipButtonDiv = document.getElementById("tipButtonDiv");
                        let tipDiv = document.getElementById("tipDiv");
                        tipButtonDiv.style.display = "none";
                        tipDiv.style.display = "none";
    
                        // let startQuiz = document.getElementById("startQuiz");
                        let startQuiz = window.aQuizVR.UIs.startQuiz;
                        let QuizStartButton = document.getElementById("QuizStartButton");
                        let QuizStartContent = document.getElementById("QuizStartContent");
                        startQuiz.style.display = "block";
                        QuizStartContent.textContent = "時間到"
                        
                        let quizIndex = {
                            question: idx ,
                            get_score:  0,
                            answer_time: this.module.json.question_list[idx].time_limit ,
                            answer_options: [],
                            answer_cloze: "",
                            answer_is_enable: false,
                            answer_is: false,
                        }
                        this.module.record[idx] = quizIndex;

                        //[start-20231117-renhaohsu-add]//
                        this.record[idx] = quizIndex
                        //[end-20231117-renhaohsu-add]//

                        this.module.record_time += this.module.json.question_list[idx].time_limit;
                        this.module.qClock = Date.now();
    
                        // let timeup = document.getElementById("timeup");
                        // timeup.style.display = "block";
                        // let timeupConfirmButton = document.getElementById("timeupConfirmButton");
                        QuizStartButton.addEventListener("click", () => {
                            startQuiz.style.display = "none";
                            
                            //[start-20230712-howardhsu-add]//
                            //// 存檔: 沒有下一題，預定紀錄答題狀態上雲端 (就是this.nextQusetion底下else的全部)
                            this.saveQuizStatus();
                            //[end-20230712-howardhsu-add]//
                        });
    
                    }
                }
            },1000);
        }
        //// ---------------------------------------------------------------- ////	
        if(obj.generalAttr.obj_type == "3d"){
            this.setTransform(quizEntity, position, rotation, scale);
            this.appendToVrScene(quizEntity, obj)
        } else {
            //// 2D setransform 會正確 ?!  待測試
            this.setTransform(quizEntity, position, rotation, scale);
            this.appendToVrScene2d(quizEntity, obj)
        }
    }


    //[start-20231006-howardhsu-modify]//
    loadQuestion(question_json){
        
        //// 為每個物件設定 position、quaternion、scale
        let objTranform = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_3__.verionControl.getObjTransform( window.vrController.scenesData , question_json );
        let position = objTranform.position;
        let rotation = objTranform.rotation;
        let scale = objTranform.scale;
        let quaternion = objTranform.quaternion;
        
        //// get position, rotation, scale 
        if(question_json.generalAttr.obj_type == "3d"){
            console.log("Quiz _loadQuestion VC objTranform", position, rotation, scale)
        } else if (question_json.generalAttr.obj_type == "2d"){

            //// 2d物件 這裡給scale即可  (會從json裡的rect_transform找到position和rotation)
            let selectedResolutionIndex = window.vrController.selectedResolutionIndex
            if( !window.vrController.selectedResolutionIndex ) selectedResolutionIndex = 0;
            // scale = new THREE.Vector3().fromArray(question_json.transformAttr.rect_transform[selectedResolutionIndex].scale.split(",").map(x => Number(x) ) );

        } else {
            console.log("_Quiz _loadQuestion: There shall not be any type except for 2d3d")
        }


        let obj = this.setTypesFromUserRes(question_json)

        let pQuestion;

        let main_type = obj.main_type;       
        switch(main_type){
            case "text":                        
                pQuestion = this.addTextToScene( obj, position, rotation, scale )
                break;
            case "image":
                pQuestion = this.addTextureToScene( obj, position, rotation, scale, 0, 1 )
                break;
            case "video":
                pQuestion = this.addVideoToScene( obj, position, rotation, scale );
                break;
            case "model":   
                pQuestion = this.addGLTFModelToScene( obj, position, rotation, scale )            
                break;
            case "audio":
                pQuestion = this.addAudioToScene( obj, position, rotation, scale );
                break;
        }

        return pQuestion
    }

    loadOption(option_json){
        
        //// 為每個物件設定 position、quaternion、scale
        let objTranform = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_3__.verionControl.getObjTransform( window.vrController.scenesData , option_json );
        let position = objTranform.position;
        let rotation = objTranform.rotation;
        let scale = objTranform.scale;
        let quaternion = objTranform.quaternion;

        //// get position, rotation, scale 
        if(option_json.generalAttr.obj_type == "3d"){
            console.log("Quiz loadOption VC objTranform", position, rotation, scale)
        } else if (option_json.generalAttr.obj_type == "2d"){

            //// 2d物件 這裡給scale即可  (會從json裡的rect_transform找到position和rotation)
            let selectedResolutionIndex = window.vrController.selectedResolutionIndex
            if( !window.vrController.selectedResolutionIndex ) selectedResolutionIndex = 0;
            // scale = new THREE.Vector3().fromArray(option_json.transformAttr.rect_transform[selectedResolutionIndex].scale.split(",").map(x => Number(x) ) );

        } else {
            console.log("_Quiz _loadQuestion: There shall not be any type except for 2d3d")
        }

        //// get res_url and sub_type from user online resources dict
        let obj = option_json
        if( makarUserData.userProjResDict || typeof( makarUserData.userOnlineResDict ) == 'object' ){  
    
            if(makarUserData.userProjResDict[obj.res_id]){

                if(makarUserData.userProjResDict[obj.res_id].res_url) obj.res_url = makarUserData.userProjResDict[obj.res_id].res_url;

                if(makarUserData.userProjResDict[obj.res_id].sub_type) obj.sub_type = makarUserData.userProjResDict[obj.res_id].sub_type; 

            } else if(makarUserData.userOnlineResDict[obj.res_id]){

                if(makarUserData.userOnlineResDict[obj.res_id].res_url) obj.res_url = makarUserData.userOnlineResDict[obj.res_id].res_url;

                if(makarUserData.userOnlineResDict[obj.res_id].sub_type) obj.sub_type = makarUserData.userOnlineResDict[obj.res_id].sub_type;

            } else {
                //// if the obj doesn't exist in userProjResDict or userOnlineResDict, then it should be Makar default assets.
                // checkDefaultImage(obj)
                (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_2__.checkDefaultObj)(obj)                
                obj.main_type = 'button'
                switch (obj.res_id) {

                    //// Currently, options of quiz objects can only be text or image(has been checked by checkDefaultImage alreadly.)
                    case "Text":
                        obj.main_type = obj.res_id.toLowerCase()
                        obj.sub_type = 'txt'
                        break;                        
                        
                    case "Button":
                        obj.main_type = obj.res_id.toLowerCase()
                        obj.sub_type = 'button'
                        break;

                    default:
                        // console.warn("Quiz.js: loadOption: res does not exist. obj=", obj)      
                        break;
                }
                
                console.log("Quiz.js: loadOption: obj=", obj)
            }
    
        } else {
            console.warn("Quiz.js: loadOption: userProjResDict or userOnlineResDict does not exist. obj=", obj)    
        }

        //// 改用 behav 來觸發 quiz 點擊事件
        if( obj.behav ){

            //// 如果 behav 已經有 QuizOption 那就不再加
            let isPushButtonExist = false
            obj.behav.forEach(b => {
                if(b.behav_type == "QuizOption") isPushButtonExist = true;
            })

            if(!isPushButtonExist) obj.behav.push({behav_type: "QuizOption"});

        } else {
            obj.behav = [ {behav_type: "QuizOption"} ]
        }

        obj.main_type = "button"  //// 雖已改用 behav 來觸發，但VRFunc.js仍有一些需要用 main_type=="button" 來判斷的功能

        let sub_type = obj.sub_type;     
        let pOption;

        switch(sub_type){
            case "txt":                        
                console.log("Quiz.js:  sub_type=", sub_type)
                pOption = this.addTextToScene( obj, position, rotation, scale)
                break;

            case "gif":
            case "jpg":
            case "jpeg":
            case "png":
                pOption = this.addTextureToScene( obj, position, rotation, scale)
                break;

            case "button":
                obj.res_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png";
                pOption = this.addTextureToScene( obj, position, rotation, scale)
                break;
        }

        return  {
            pOption: pOption,
            sub_type: sub_type,
        }
    }
    //[end-20231006-howardhsu-modify]//

    //// 3d 文字多選 在文字選項左側加上圓圈
    multiOptionTextCircle3d(optionObject, circlePos, circleRot, circleScale, scaleCoefficient=25){
        let base = document.createElement("a-plane");
        base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
        base.setAttribute("id","circle_base");
        base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#2a2c31; depthWrite:false" );
        // this.setTransform(base, circlePos, circleRot, circleScale);
        optionObject.appendChild(base);

        let circle = document.createElement("a-plane");
        circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
        circle.setAttribute("id","circle_out");
        circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
        // this.setTransform(circle, circlePos, circleRot, circleScale);
        optionObject.appendChild(circle);
        
        let circle2 = document.createElement("a-plane");
        circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
        circle2.setAttribute("id","circle_in");
        circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
        circle2.setAttribute( "visible", false);
        // circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
        // this.setTransform(circle2, circlePos, circleRot, circleScale);
        optionObject.appendChild(circle2);

        let f_setRenderOrder = function( evt ){
            if (evt.target == evt.currentTarget){
                if ( evt.target.object3D ){
                    if ( evt.target.object3D.children[0] ){
                        evt.target.object3D.children[0].renderOrder = 1;
                    }
                }
            }
        }
        base.addEventListener("loaded", f_setRenderOrder );
        circle.addEventListener("loaded", f_setRenderOrder );
        circle2.addEventListener("loaded", f_setRenderOrder );

        /////////

        // console.log(" *** geometry-set: " , optionObject.object3D , optionObject.getObject3D("mesh").geometry.attributes.position.array[0] );
        // console.log('Quiz.js: _load: scale ', optionObject.object3D.parent.scale , optionObject.object3D  );

        let width = Math.abs(optionObject.getObject3D("mesh").geometry.attributes.position.array[0])*2;
        // circlePos.x = circlePos.x + width*0.5 + 0.3/optionObject.object3D.parent.el.getAttribute("scale").x;
        circlePos.x = circlePos.x + width*0.5 + 0.1/optionObject.object3D.parent.el.getAttribute("scale").x;
        circlePos.z = circlePos.z - 0.01;
        base.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
        circle.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );
        circle2.setAttribute("position" , circlePos.clone().multiply( new THREE.Vector3( -1, 1, 1 ) ) );

        //[start-20240223-howardhsu-modify]//
        optionObject.object3D.parent.el.addEventListener("loaded", ()=>{
            // console.log("%c optionObject.object3D.el.parentEl", "color: magenta", optionObject.object3D.el.parentEl.object3D.scale)

            //// source: v3.4 artoolkit.three.js _loadQuiz
            //// 圓圈大小設定方式為 「經驗大小」*「寬高中最大者」/「選項的世界大小」。## 備註一下： getWorldScale 並不一定會返回「正確的數值」，原因猜測跟取得方式是「worldMatrix」相關
            //// 這樣確保圓圈比例維持，且大小隨著選項而變動
            let optionTextWorldScale = new THREE.Vector3(1,1,1).multiply( optionObject.object3D.scale ).multiply( optionObject.object3D.parent.scale ).multiply( optionObject.object3D.parent.parent.scale );
            let optionTextBGWroldScale = optionObject.object3D.children[1].scale.clone().multiply( optionTextWorldScale );
            let maxS = Math.max( optionTextBGWroldScale.x , optionTextBGWroldScale.y );

            //// 微調圓圈比例 數值來自trial and error
            // const scaleCoefficient = 25
            circleScale.multiply(new THREE.Vector3(scaleCoefficient, scaleCoefficient, scaleCoefficient).multiplyScalar( maxS ));
            circleScale.divide(optionObject.object3D.parent.el.getAttribute("scale"))
            
            base.setAttribute("scale" , circleScale );
            circle.setAttribute("scale" , circleScale );
            circle2.setAttribute("scale" , circleScale.multiplyScalar( 0.7 )  );
        })
        //[end-20240223-howardhsu-modify]//
    }
    
    //// 2d 文字多選 : 在文字選項左側加上圓圈
    multiOptionTextCircle2d(optionObject, circlePos, circleRot, circleScale, scaleCoefficient=0.5){

        //// source: artoolkit.three.js 3329
        let optionTextBG = optionObject.children[0].children[1];
        let optionText2DBGLocalScale = optionTextBG.scale.clone();
        let optionText2DCoWorldScale = optionObject.children[0].getWorldScale( new THREE.Vector3() ) ;

        //[start-20240207-renhaohsu-modify]//
        //// v3.5.0.0 似乎編輯器改用最大值決定縮放
        // let minS = Math.min( optionText2DBGLocalScale.x * optionTextBG.geometry.parameters.width , 
        //                         optionText2DBGLocalScale.y * optionTextBG.geometry.parameters.height ,
        //                         1000000 );
        let maxS = Math.max( optionText2DBGLocalScale.x * optionTextBG.geometry.parameters.width , 
            optionText2DBGLocalScale.y * optionTextBG.geometry.parameters.height );

        //// 微調圓圈比例 數值來自trial and error
        // const scaleCoefficient = 0.5
        circleScale.multiply(new THREE.Vector3(scaleCoefficient, scaleCoefficient, scaleCoefficient).multiplyScalar( maxS ));
        circleScale.divide( optionText2DCoWorldScale );

        // console.log(' optionText2DBGLocalScale: ' , optionText2DBGLocalScale , 
        // '\noptionText2DBGWorldScale: ', optionText2DBGWorldScale, 
        // '\noptionText2DCoWorldScale: ', optionText2DCoWorldScale, 
        // '\noptionText2DCoLocalScale: ', optionText2DCoLocalScale, 
        // '\ncircleScale:' , circleScale ,'\n222' ,
        // optionTextBG.geometry.parameters.width , optionTextBG.geometry.parameters.height, '\n555' ,
        // optionText2DBGLocalScale.x * optionTextBG.geometry.parameters.width , optionText2DBGLocalScale.y * optionTextBG.geometry.parameters.height );

        //// 圓圈位置設定方式為「選項圖片高度」 + 「圓圈本身高度」 
        let optionImageScale = optionTextBG.geometry.parameters.width * optionText2DBGLocalScale.x  ;

        let tLoader = new THREE.TextureLoader();

        //// 內層圓圈 、 選到圓圈
        let resUrl = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png";
        tLoader.load(resUrl, function(texture){

            circlePos.x = -optionImageScale * 0.5 - 80 * 0.8 * circleScale.x ;

            let circle_base = new THREE.Mesh( 
                // new THREE.PlaneBufferGeometry( texture.image.width, texture.image.height ), 
                new THREE.PlaneGeometry( texture.image.width, texture.image.height ), 
                new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true, color:0x3c3c3c, depthWrite:false } ),
            );
            circle_base.name = "circle_base";
            circle_base.position.copy( circlePos.clone() ) ;//// 向下位移經驗上固定距離，需要normalize 上層大小
            circle_base.scale.copy(  circleScale.clone() ); //// 大小normalize 上層大小
            optionObject.children[0].add( circle_base );

            //// 選到圓圈
            let circle_in = new THREE.Mesh( 
                // new THREE.PlaneBufferGeometry(texture.image.width, texture.image.height ), 
                new THREE.PlaneGeometry( texture.image.width, texture.image.height ), 
                new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true, color:0x00d1c1 , depthWrite:false } ),
            );
            circle_in.name = "circle_in";
            circle_in.renderOrder = 1;
            circle_in.visible = false; //// 預設為『沒有選取』
            circle_in.position.copy( circlePos.clone() ) ;//// 向下位移經驗上固定距離，需要normalize 上層大小
            circle_in.scale.copy( circleScale.clone().multiplyScalar( 0.7 ) ); //// 大小normalize 上層大小
            optionObject.children[0].add( circle_in );
        });

        resUrl = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png";
        tLoader.load(resUrl, function(texture){
            
            circlePos.x = -optionImageScale * 0.5 - 80 * 0.8 * circleScale.x ;

            // //// 外層圓圈
            let circle_out = new THREE.Mesh( 
                new THREE.PlaneGeometry( texture.image.width, texture.image.height ), 
                new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true, color:0x7B7B7B , depthWrite:false} ),
            );
            circle_out.name = "circle_out";
            circle_out.renderOrder = 1;
            circle_out.position.copy( circlePos.clone() ) ;//// 向下位移經驗上固定距離，需要normalize 上層大小
            circle_out.scale.copy( circleScale.clone().multiplyScalar( 0.9 ) ); //// 大小normalize 上層大小
            optionObject.children[0].add( circle_out );
        });
        //[end-20240207-renhaohsu-modify]//
    }

    //// 3d 圖片多選 : 在圖片選項下方加上圓圈
    multiOptionImageCircle3d(optionObject, circlePos, circleRot, circleScale, scaleCoefficient=1){
        //// source: v3.4 artoolkit.three.js _loadQuiz
        //// 圓圈大小設定方式為 「經驗大小」*「寬高中最大者」/「選項的世界大小」
        //// 這樣確保圓圈比例維持，且大小隨著選項而變動
        let optionImgWorldScale = optionObject.object3D.getWorldScale(new THREE.Vector3());
        let optionImgLocalScale = optionObject.object3D.scale.clone()  ;
        let maxS = Math.max( optionImgLocalScale.x , optionImgLocalScale.y );
            
        //[start-20240222-howardhsu-modify]//                
        //// 微調圓圈比例 數值來自trial and error
        // const scaleCoefficient = 1
        circleScale.multiply(new THREE.Vector3(scaleCoefficient, scaleCoefficient, scaleCoefficient).multiplyScalar( maxS ));
        circleScale.divide( optionImgWorldScale );

        //// v3.4 原本圓圈位置設定方式為「選項圖片高度」 + 「圓圈本身高度」 
        let optionImageScale = optionObject.object3D.children[0].scale.clone() ;
        // // circlePos.y = circlePos.y - height/2 - 0.3/optionObject.getAttribute("scale").y;
        // circlePos.y = circlePos.y - height - (0.3/optionObject.getAttribute("scale").y);

        //// v3.5 位置在視覺上與編輯器不同而調整 
        circlePos.y = -circleScale.y*0.5 - optionImageScale.y * 0.6;
        //[end-20240222-howardhsu-modify]//

        let base = document.createElement("a-plane");
        base.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
        base.setAttribute("id","circle_base");
        base.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#2a2c31; depthWrite:false" );
        this.setTransform(base, circlePos, circleRot, circleScale);
        optionObject.appendChild(base);

        let circle = document.createElement("a-plane");
        circle.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png");
        circle.setAttribute("id","circle_out");
        circle.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#7B7B7B; depthWrite:false" ); 
        this.setTransform(circle, circlePos, circleRot, circleScale);
        optionObject.appendChild(circle);

        let circle2 = document.createElement("a-plane");
        circle2.setAttribute("src","https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png");
        circle2.setAttribute("id","circle_in");
        circle2.setAttribute( "material", "shader:flat; side:double; opacity: 1.0; transparent: true; color:#00d1c1; depthWrite:false" );
        circle2.setAttribute( "visible", false);
        circleScale.multiply( new THREE.Vector3( 0.7,0.7,0.7 ) );
        this.setTransform(circle2, circlePos, circleRot, circleScale);
        optionObject.appendChild(circle2);

        let f_setRenderOrder = function( evt ){
            if (evt.target == evt.currentTarget){
                if ( evt.target.object3D ){
                    if ( evt.target.object3D.children[0] ){
                        evt.target.object3D.children[0].renderOrder = 1;
                    }
                }
            }
        }
        base.addEventListener("loaded", f_setRenderOrder );
        circle.addEventListener("loaded", f_setRenderOrder );
        circle2.addEventListener("loaded", f_setRenderOrder );
    }

    //// 2d 圖片多選 : 在圖片選項下方加上圓圈
    multiOptionImageCircle2d(optionObject, circlePos, circleRot, circleScale, scaleCoefficient=0.0025){
        //// 圓圈大小設定方式為 「經驗大小」*「寬高中最大者」/「選項的世界大小」
        //// 這樣確保圓圈比例維持，且大小隨著選項而變動
        let optionImgWorldScale = optionObject.getWorldScale(new THREE.Vector3());
        let optionImgLocalScale = optionObject.scale.clone();  
        let maxS = Math.max( optionImgLocalScale.x * optionObject.children[0].geometry.parameters.width , 
                                optionImgLocalScale.y * optionObject.children[0].geometry.parameters.height  );

        //[start-20240207-renhaohsu-modify]//
        //// 微調圓圈比例 數值來自trial and error
        // const scaleCoefficient = 0.0025
        circleScale.multiply(new THREE.Vector3(scaleCoefficient, scaleCoefficient, scaleCoefficient).multiplyScalar( maxS )  );
        circleScale.divide( optionImgWorldScale );
        //[end-20240207-renhaohsu-modify]//

        //// 圓圈位置設定方式為「選項圖片高度」 + 「圓圈本身高度」 
        let optionImageScale = optionObject.children[0].scale.clone() ;
        let optionImageHeight = optionObject.children[0].geometry.parameters.height;

        let tLoader = new THREE.TextureLoader();

        //// 內層圓圈 、 選到圓圈
        let resUrl = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle.png";
        tLoader.load(resUrl, function(texture){
            circlePos.y =  optionImageScale.y * optionImageHeight * 0.5 + 80 * 0.6 * circleScale.y ;

            let circle_base = new THREE.Mesh( 
                new THREE.PlaneGeometry( texture.image.width, texture.image.height ), 
                new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true, color:0x3c3c3c, depthWrite:false } ),
            );
            circle_base.name = "circle_base";
            circle_base.position.copy( circlePos.clone() ) ;//// 向下位移經驗上固定距離，需要normalize 上層大小
            circle_base.scale.copy(  circleScale.clone() ); //// 大小normalize 上層大小
            optionObject.add( circle_base );

            //// 選到圓圈
            let circle_in = new THREE.Mesh( 
                new THREE.PlaneGeometry( texture.image.width, texture.image.height ), 
                new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true, color:0x00d1c1 , depthWrite:false } ),
            );
            circle_in.name = "circle_in";
            circle_in.renderOrder = 1;
            circle_in.visible = false; //// 預設為『沒有選取』
            circle_in.position.copy( circlePos.clone() ) ;//// 向下位移經驗上固定距離，需要normalize 上層大小
            circle_in.scale.copy( circleScale.clone().multiplyScalar( 0.7 ) ); //// 大小normalize 上層大小
            optionObject.add( circle_in );
        });

        resUrl = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/circle_frame.png";
        tLoader.load(resUrl, function(texture){
            circlePos.y =  optionImageScale.y * optionImageHeight * 0.5 + 80 * 0.6 * circleScale.y ;

            // //// 外層圓圈
            let circle_out = new THREE.Mesh( 
                new THREE.PlaneGeometry( texture.image.width, texture.image.height ), 
                new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true, color:0x7B7B7B , depthWrite:false} ),
            );
            circle_out.name = "circle_out";
            circle_out.renderOrder = 1;
            circle_out.position.copy( circlePos.clone() ) ;//// 向下位移經驗上固定距離，需要normalize 上層大小
            circle_out.scale.copy( circleScale.clone().multiplyScalar( 0.9 ) ); //// 大小normalize 上層大小
            optionObject.add( circle_out );

        });
    }

    //20200723-thonsha-add-start
	quizOption(target){

        //[start-20231117-howardhsu-modify]//   (舊稱: "PushButton" 由於在vrcontroller.triggerEvent改名 這裡跟著改)
        //// 避免同時有其它quiz正在顯示 答對/錯 的2D動畫html元素
        if( window.aQuizVR.checkIs2DPictureShowing() ) return;
        
        //// 避免user連續點擊造成pushButton重複呼叫
        if( this.isButtonPushed ) return;
        //[end-20231117-howardhsu-modify]//

        let answer_options = []; //// 答題 index
        let answer_is = false; //// 答對與否
        let get_score = 0;
        let idx = this.module.json.display_order_list[this.module.currentIndex].index;
        let currectQuestion = this.module.json.question_list[idx];
        let scoreType = this.module.json.score_type;

        let makarDragon = document.getElementById("makarDragon");
        let imgRight = document.getElementById("imgRight");
        let imgWrong = document.getElementById("imgWrong");

        //[start-20240207-renhaohsu-add]//
        let targetId;
        if( this.obj_type == "3d" ){
            if (target.localName=='a-text'){
                targetId = target.parentNode.id;
            }
            else{
                targetId = target.id;
            }
        } else if ( this.obj_type == "2d" ){
            targetId = target.obj_id;
        } else {
            console.log("%c _quiz _quizOption: target=", "color:tomato;", target)
        }
        //[end-20240207-renhaohsu-add]//

        if (currectQuestion.option_type == "Option_Text" || currectQuestion.option_type == "Option_Image"){
            
            //[start-20231019-howardhsu-add]//
            //// 避免user連續點擊造成pushButton重複呼叫
            this.isButtonPushed = true
            //[end-20231019-howardhsu-add]//

            if (currectQuestion.answer_list == null){
                currectQuestion.answer_list = []
            }
            let correctAnswerIdx = currectQuestion.answer_list[0];
            let correctAnswer = currectQuestion.options_json[correctAnswerIdx-1];
            
            //// 查找紀錄『選了哪個選項』
            for (let i = 0, len=currectQuestion.options_json.length; i < len; i++ ){
                if ( currectQuestion.options_json[i].generalAttr.obj_id == targetId ){
                    answer_options.push(i);
                }
            }

            if (correctAnswer && correctAnswer.generalAttr.obj_id == targetId){
                if (currectQuestion.active_score){
                    if (scoreType == 'Custom'){
                        this.module.score += currectQuestion.score;
                        get_score = currectQuestion.score;
                    }
                    else if(scoreType == 'Total'){
                        let scoreTotal = this.module.json.total_score;
                        this.module.correctAnswer += 1;
                        this.module.score =  Math.round(scoreTotal * this.module.correctAnswer/this.module.totalActiveScoreQuestion);
                        get_score = Math.round( scoreTotal/this.module.totalActiveScoreQuestion );
                    }
                }
                answer_is = true;
                makarDragon.style.display = "block";
                imgRight.style.display = "block";
                imgWrong.style.display = "none";
                console.log("Quiz.js: _pushButton: Congratulations! Correct Answer!");
            }
            else{
                answer_is = false;
                makarDragon.style.display = "block";
                imgRight.style.display = "none";
                imgWrong.style.display = "block";
                console.log("Quiz.js: _pushButton: 叭叭~ Incorrect Answer!");
            }
            
            window.clearInterval(this.module.timer.currentTimer);
            
            setTimeout( () => {
            
                makarDragon.style.display = "none";
                // 完成前一題，預定紀錄於本地的 database，但是viewer 端並沒有如此操作，之後再說
                let quizIndex = {
                    question: idx ,
                    get_score:  get_score,
                    answer_time: Math.round( (Date.now() - this.module.qClock)/1000 ),
                    answer_options: answer_options,
                    answer_cloze: "",
                    answer_is_enable: true,
                    answer_is: answer_is,
                }
                this.module.record[idx] = quizIndex;
                //[start-20231117-renhaohsu-add]//
                this.record[idx] = quizIndex
                //[end-20231117-renhaohsu-add]//
                
                this.module.record_time += Math.round( (Date.now() - this.module.qClock)/1000 );
                this.module.qClock = Date.now();

                if (currectQuestion.show_score){
                    let scoreDiv = document.getElementById("scoreDiv");
                    let score = document.getElementById("score");
                    scoreDiv.style.display = "block";
                    // scoreDiv.onclick = function(){
                    //     scoreDiv.style.display = "none";
                    //     self.nextQuestion();
                    // }
                    score.textContent = this.module.score;
                    
                }
                else{
                    this.nextQuestion();
                }

            },1600);
            console.log("Quiz.js: _pushButton: score: ", this.module.score , currectQuestion );

        }
        else if(currectQuestion.option_type == "MutiOption_Text" || currectQuestion.option_type == "MutiOption_Image"){
            
            console.log(" MutiOption_Text target", target)
            let targetObject = (this.obj_type == "3d") ? target.object3D : target;
            console.log(" MutiOption_Text targetObject", targetObject)

            //// 更改選項「選取狀態」
            //// 由於「多選圖片」跟「多選文字」的層級不同，改為完整尋找
            targetObject.traverse( ( child ) => { 

                if(this.obj_type == "3d"){

                    if ( child.type=='Group' && child.el && child.el.getAttribute('id') == 'circle_in' ){ 
                        let item = child.el;
                        item.setAttribute("visible", !item.getAttribute("visible"));
                        let targetId;
                        if (target.localName=='a-text'){
                            targetId = target.parentNode.id;
                        } else{
                            targetId = target.id;
                        }
                        //// 假如此選項曾經選擇過，需要移除。反之，加入 
                        if (this.module["choices"].includes(targetId)){
                            let choices_idx = this.module["choices"].indexOf(targetId);
                            this.module["choices"].splice(choices_idx,1);
                        }
                        else{
                            this.module["choices"].push(targetId);
                        }
                        console.log("Quiz.js: _pushButton: choices = ", this.module["choices"]);
    
                    } 
                    else if ( child.type=='Group' && child.el && child.el.getAttribute('id') == 'circle_out' ){
                        let item = child.el;
                        if (item.getAttribute( "material",).color == "#7B7B7B"){
                            item.setAttribute( "material", "color:#00d1c1;" ); 
                        }
                        else if (item.getAttribute( "material",).color == "#00d1c1"){
                            item.setAttribute( "material", "color:#7B7B7B;" ); 
                        }
                    }

                } else if( this.obj_type == "2d" && (target.makarType == 'text2D' || target.makarType == 'image2D') ){
                    if ( child.isMesh ){
                        if ( child.name == 'circle_in' ){
                            child.visible = !child.visible;
                            //// 假如此選項曾經選擇過，需要移除。反之，加入 
                            if ( this.module["choices"].includes(targetId) ){
                                let choices_idx = this.module["choices"].indexOf(targetId);
                                this.module["choices"].splice(choices_idx,1);
                            }else{
                                this.module["choices"].push(targetId);
                            }
                        }

                        if ( child.name == 'circle_out' ){
                            if (child.material.color.getHexString() == "7b7b7b" ){
                                child.material.color.setStyle( "#00d1c1" );
                            }else if ( child.material.color.getHexString() == "00d1c1" ){
                                child.material.color.setStyle( "#7b7b7b" );
                            }
                        }
                    }
                }
                else {
                    console.log("_Quiz _loadQuestion: There shall not be any type except for 2d3d")
                }

            });


            //// 判斷是否點擊到『確認按鈕』
            if (targetObject.sub_type == "button"){
                
                //[start-20231019-howardhsu-add]//
                //// 避免user連續點擊造成pushButton重複呼叫
                this.isButtonPushed = true
                //[end-20231019-howardhsu-add]//
                
                let correctCount = 0;
                if (currectQuestion.answer_list == null){
                    currectQuestion.answer_list = []
                }
                for (let correct_idx of currectQuestion.answer_list){
                    let correctAnswer = currectQuestion.options_json[correct_idx];
                    if (correctAnswer){
                        for (let choicesId of this.module["choices"]){
                            if(choicesId == correctAnswer.generalAttr.obj_id){
                                correctCount += 1;
                            }
                        }
                    }
                }


                for (let i = 0, len = currectQuestion.options_json.length; i < len; i++ ){
                    for (let j = 0, len2 = this.module["choices"].length; j < len2; j++ ){
                        if (currectQuestion.options_json[i].generalAttr.obj_id == this.module["choices"][j] ){
                            answer_options.push( i-1 );
                        }
                    }
                }

                if (correctCount == currectQuestion.answer_list.length && currectQuestion.answer_list.length == this.module["choices"].length){
                    if (currectQuestion.active_score){
                        if (scoreType == 'Custom'){
                            this.module.score += currectQuestion.score;
                            get_score = currectQuestion.score;
                        }
                        else if(scoreType == 'Total'){
                            let scoreTotal = this.module.json.total_score;
                            this.module.correctAnswer += 1;
                            this.module.score =  Math.round(scoreTotal * this.module.correctAnswer/this.module.totalActiveScoreQuestion);
                            get_score = Math.round( scoreTotal/this.module.totalActiveScoreQuestion );
                        }
                    }
                    answer_is = true;
                    makarDragon.style.display = "block";
                    imgRight.style.display = "block";
                    imgWrong.style.display = "none";
                    console.log("Quiz.js: _pushButton: Congratulations! Correct Answer!");
                }
                else{
                    answer_is = false;
                    makarDragon.style.display = "block";
                    imgRight.style.display = "none";
                    imgWrong.style.display = "block";
                    console.log("Quiz.js: _pushButton: 叭叭~ Incorrect Answer!");
                }
                window.clearInterval(this.module.timer.currentTimer);                
                
                //// 播放動畫 1.6 second
                let counter = this.module.timer.counter;
                setTimeout( () => {

                    makarDragon.style.display = "none";
                    // 完成前一題，預定紀錄於本地的 database，但是viewer 端並沒有如此操作，之後再說
                    // console.log("Quiz.js: score , currectQuestion = ", idx, this.module , this.module["choices"] , answer_options , get_score );
                    console.log("Quiz.js: _pushButton: " , this.module.json.question_list[idx].time_limit, counter, Math.round( (Date.now() - this.module.qClock)/1000 ) );
                    let quizIndex = {
                        question: idx ,
                        get_score:  get_score,
                        answer_time:  Math.round( (Date.now() - this.module.qClock)/1000 ) ,
                        answer_options: answer_options,
                        answer_cloze: "",
                        answer_is_enable: true,
                        answer_is: answer_is,
                    }
                    this.module.record[idx] = quizIndex;
                    //[start-20231117-renhaohsu-add]//
                    this.record[idx] = quizIndex
                    //[end-20231117-renhaohsu-add]//

                    this.module.record_time += Math.round( (Date.now() - this.module.qClock)/1000 );
                    this.module.qClock = Date.now();

                    if (currectQuestion.show_score){
                        let scoreDiv = document.getElementById("scoreDiv");
                        let score = document.getElementById("score");
                        scoreDiv.style.display = "block";
                        // scoreDiv.onclick = function(){
                        //     scoreDiv.style.display = "none";
                        //     self.nextQuestion();
                        // }
                        score.textContent = this.module.score;
                        
                    }
                    else{
                        this.nextQuestion();
                    }
                    
                },1600);
                console.log("Quiz.js: _pushButton: score: ", this.module.score , currectQuestion );
                
            }
        } else {
            //// 未知狀況

            return;
        }
        
    }
    //20200723-thonsha-add-end


    nextQuestion(){
        //[start-20231019-howardhsu-add]//
        //// 避免user連續點擊造成pushButton重複呼叫
        this.isButtonPushed = false
        //[end-20231019-howardhsu-add]//

        this.module["choices"] = []

        //[start-20230921-howardhsu-add]//
        window.clearInterval(this.module.timer.currentTimer)
        //[end-20230921-howardhsu-add]//

        this.clearObject()

        this.module.currentIndex += 1;
        if (this.module.currentIndex < this.module.json.display_order_list.length){
            let idx = this.module.json.display_order_list[this.module.currentIndex].index
            let next_question = this.module.json.question_list[idx];

            //// 時間限制部份       
            if(this.module.json.timer_type == "Custom"){
                this.module.timer.counter = next_question.time_limit;
            }

            //// 提示部份
            let tipButtonDiv = document.getElementById("tipButtonDiv");
            if(next_question.show_tips){
                tipButtonDiv.style.display = "block";
                tipButtonDiv.addEventListener("click",function(){
                    let tipDiv = document.getElementById("tipDiv");
                    let tipConfirmButton = document.getElementById("tipConfirmButton");
                    let tipContent = document.getElementById("tipContent");
                    tipDiv.style.display = "block";
                    tipContent.textContent = next_question.tips_content;
                    tipConfirmButton.addEventListener("click",function(){
                        tipDiv.style.display = "none";
                    });
                });
            }
            else{
                tipButtonDiv.style.display = "none";
            }

            ////載入下一題的場景
            //// 載入題目
            if ( next_question.questions_json && Array.isArray( next_question.questions_json ) ){
                for(let i=0; i<next_question.questions_json.length; i++){

                    //[start-20231006-howardhsu-modify]//
                    this.loadQuestion(next_question.questions_json[i])    
                    //[end-20231006-howardhsu-modify]//
                    
                }
            }
            

            //// 載入選項
            if ( next_question.options_json && Array.isArray( next_question.options_json ) ){

                for(let i=0; i<next_question.options_json.length; i++){
                    
                    //[start-20231006-howardhsu-modify]//
                    let {pOption, sub_type} = this.loadOption(next_question.options_json[i])                    
                    //[end-20231006-howardhsu-modify]//
                    
                    //// 多選題要讓「選項物件」增加「圓圈」
                    if (sub_type != "button" && (next_question.option_type == "MutiOption_Text"|| next_question.option_type == "MutiOption_Image")){

                        if ( (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_2__.isPromise)( pOption ) == false ){
                            continue;
                        }

                        pOption.then( ( ret ) => {
                            //[start-20240227-renhaohsu-modify]//
                            let optionObject = ret;

                            let circlePos = new THREE.Vector3(0,0,0);
                            let circleRot = new THREE.Vector3(0,0,0);
                            let circleScale = new THREE.Vector3(1,1,1);

                            if(next_question.option_type == "MutiOption_Text"){                                
                                switch (this.obj_type) {
                                    case "3d":
                                        this.multiOptionTextCircle3d(optionObject, circlePos, circleRot, circleScale)
                                        break;
                                
                                    case "2d":
                                        this.multiOptionTextCircle2d(optionObject, circlePos, circleRot, circleScale)
                                        break;
                            
                                    default:
                                        console.log("_Quiz _load: There shall not be any type except for 2d3d")
                                        break;
                                }
                            } else if (next_question.option_type == "MutiOption_Image"){
                                switch (this.obj_type) {
                                    case "3d":
                                        let timeoutID = setInterval( () => {
                                            //[start-20230923-howardhsu-add]//    
                                            //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                                            if (this.module.currentIndex >= this.module.json.display_order_list.length){
                                                window.clearInterval(this.module.timer.currentTimer)
                                            }                             
                                            //[end-20230923-howardhsu-add]//
    
                                            if (optionObject.getAttribute("heightForQuiz")){ 
                                                let height = optionObject.getAttribute("heightForQuiz");
    
                                                this.multiOptionImageCircle3d(optionObject, circlePos, circleRot, circleScale)
                                                
                                                window.clearInterval(timeoutID);
                                            }
                                        }, 1);
                                        break;
                                
                                    case "2d":
                                        this.multiOptionImageCircle2d(optionObject, circlePos, circleRot, circleScale)
                                        break;
                            
                                    default:
                                        console.log("_Quiz _load: There shall not be any type except for 2d3d")
                                        break;
                                }
                            } else {
                                console.warn("MultiOption should be either MutiOption_Text or MutiOption_Image.")
                            }
                            //[end-20240227-renhaohsu-modify]//
                        });
                    }
                }

            } else {
                console.warn("_quiz _load: data might be incorrect, first_question.options_json=", first_question.options_json)
                return
            }
            

            let timerContent = document.getElementById('timerContent');

            //// 處理『自訂時間』
            if(this.module.json.timer_type == "Custom"){
                if (this.module.timer.counter >= 0){
                    let hour = Math.floor(this.module.timer.counter/3600);
                    let min = Math.floor((this.module.timer.counter-hour*3600)/60);
                    let sec = this.module.timer.counter-hour*3600-min*60;
                    timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
                }
            }

            setTimeout( () => {                
                //// 20210107-每一秒執行一次，將counter減一，並顯示剩餘秒數，到0會跳時間到 ////
    
                if (this.module.timer.counter >= 0){
                    this.module.qClock = Date.now();
                    
                    window.clearInterval(this.module.timer.currentTimer)
                    
                    let timeoutID = setInterval( () => {
                        
                        this.module.timer.currentTimer = timeoutID;
                        this.module.timer.counter -= 1;

                        //[start-20230923-howardhsu-add]//
                        //// 在user點答案點很快的情況下 quiz的計時器不會被清除 因此補上這段                      
                        if (this.module.currentIndex >= this.module.json.display_order_list.length){
                            window.clearInterval(this.module.timer.currentTimer)
                        }
                        //[end-20230923-howardhsu-add]//

                        let hour = Math.floor(this.module.timer.counter/3600);
                        let min = Math.floor((this.module.timer.counter-hour*3600)/60);
                        let sec = this.module.timer.counter-hour*3600-min*60;
                        timerContent.textContent = hour.toString().padStart(2,'0')+":"+min.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');

                        if (this.module.timer.counter <= 0){
                            window.clearInterval(this.module.timer.currentTimer);
                            if (this.module.json.timer_type == "Custom"){
                                if (next_question.show_score){
                                    let scoreDiv = document.getElementById("scoreDiv");
                                    let score = document.getElementById("score");
                                    scoreDiv.style.display = "block";
                                    // scoreDiv.onclick = function(){
                                    //     scoreDiv.style.display = "none";
                                    //     self.nextQuestion();
                                    // }
                                    score.textContent = this.module.score;
                                    
                                }
                                else{
                                    this.nextQuestion();
                                }
                            }
                            else{
                                this.clearObject()

                                let tipButtonDiv = document.getElementById("tipButtonDiv");
                                let tipDiv = document.getElementById("tipDiv");
                                tipButtonDiv.style.display = "none";
                                tipDiv.style.display = "none";
                                
                                // let startQuiz = document.getElementById("startQuiz");
                                let startQuiz = window.aQuizVR.UIs.startQuiz;
                                let QuizStartButton = document.getElementById("QuizStartButton");
                                let QuizStartContent = document.getElementById("QuizStartContent");
                                QuizStartContent.textContent = "時間到"

                                //[start-2023mmdd-howardhsu-modify]//
                                if(this.module.timer.counter == 0){
                                    startQuiz.style.display = "block";
                                }
                                //[end-2023mmdd-howardhsu-modify]//

                                let quizIndex = {
                                    question: idx ,
                                    get_score:  0,
                                    answer_time: this.module.json.question_list[idx].time_limit ,
                                    answer_options: [],
                                    answer_cloze: "",
                                    answer_is_enable: false,
                                    answer_is: false,
                                }
                                this.module.record[idx] = quizIndex;
                                //[start-20231117-renhaohsu-add]//
                                this.record[idx] = quizIndex
                                //[end-20231117-renhaohsu-add]//
                                
                                this.module.record_time += this.module.json.question_list[idx].time_limit;
                                this.module.qClock = Date.now();

                                QuizStartButton.addEventListener("click", () => {
                                    startQuiz.style.display = "none";

                                    //[start-20230712-howardhsu-add]//
                                    //// 存檔: 沒有下一題，預定紀錄答題狀態上雲端 (就是底下else的全部)
                                    this.saveQuizStatus();
                                    //[end-20230712-howardhsu-add]//
                                });
                            }
                        }
                    },1000);
                }
                
                //// -------------------------------------------------------------- ////
                // cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.04; radiusInner: 0.02; thetaLength: 360; thetaStart: 0;" );
            }, 3000);
        }else{
            //// 沒有下一題
            this.saveQuizStatus()
        }
    }



    //[start-20240305-renaohsu-modify]//
    saveQuizStatus(){				
        //// 沒有下一題，把『觸控』開回來
        // vrController.cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );
        this.isPlayed = true;

        //// 沒有下一題，預定紀錄答題狀態上雲端        
        window.clearInterval(this.module.timer.currentTimer);
        let timer = document.getElementById("timerDiv");
        timer.style.display = "none";
        let tipButtonDiv = document.getElementById("tipButtonDiv");
        let tipDiv = document.getElementById("tipDiv");
        tipButtonDiv.style.display = "none";
        tipDiv.style.display = "none";

        let quizEndDiv = document.getElementById("quizEndDiv");
        quizEndDiv.style.display = "block";
        quizEndDiv.addEventListener("click", function(){
            quizEndDiv.style.display = "none";
        });

        console.log("VRFunc.js: quiz end , this.module.record = " , this.module.record  );
        let playing_user = "", device_id = "";

        //// 推測 localStorage 有 MakarUserID 表示user已經登入
        if (localStorage.getItem("MakarUserID") ){
            playing_user = localStorage.getItem("MakarUserID")           
        }
        if (localStorage.getItem("device_id")){
            device_id = localStorage.getItem("device_id");
        }

        //// 目前存放分為 『log資訊』給『數據分析』 跟 『專案遊玩資訊』給『viewer 查詢』 
        //// 『log資訊』給『數據分析』  quiz_log
        let quizLogData  = {
            "user_id":       this.currentProjData.user_id ,
            "playing_user":  playing_user , //// 在還沒有登入流程時候 一定要設為空字串
            "proj_id":       this.currentProjData.proj_id ,
            "proj_type":     "vr" ,
            "device_id":     device_id ,
            "module_id":     "",    //// Quiz 在 scenesData的typeAttr裡找不到 module_id
            "brand":         Browser.name + Browser.version ,
            "os":            Browser.platform ,
            "location_long": 0.0,
            "location_lan":  0.0,
            "module":        [ this.module.json ],
            "record_time":   this.module.record_time,
            "record_score":  this.module.score ,
            "record":        this.module.record,
        }
        _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].quizLog(quizLogData).then( result => {
            console.log("_quizLog post to api: result=", result,
                        "\n\n quizLogData=", quizLogData );
        })

        //// 更新使用者紀錄模組     
        let quizProjectModuleRecord;
        _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].getRecordModule( playing_user , this.currentProjData.proj_id ).then( result => {
            // console.log("getRecordModule: result=", result);
    
            //// 因為 update_record_module 是更新整筆資料，因此需要先get再post
            if( result.data.record_module_list && Array.isArray(result.data.record_module_list) ){
                if(result.data.record_module_list.length > 0){
                    if(result.data.record_module_list[0].project_module){
                        // console.log("getRecordModule: project_module", result.data.record_module_list[0].project_module );
                        quizProjectModuleRecord = result.data.record_module_list[0].project_module
                    }
                }                
            }

            let quizRecord = {
                //// 必要的keys是playing_user_id, proj_id, project_module (其他即使給錯 server端也會通過且只更新project_module)
                "head_pic":        this.currentProjData.head_pic,
                "loc":             this.currentProjData.loc,
                "module_type":     this.currentProjData.module_type,
                "name":            this.currentProjData.name,
                "playing_user_id": playing_user,
                "proj_cover_urls": this.currentProjData.proj_cover_urls,
                "proj_id":         this.currentProjData.proj_id,
                "proj_name":       this.currentProjData.proj_name,
                "proj_type":       "vr",
                "snapshot_url":    this.currentProjData.snapshot_url,
                "user_id":         this.currentProjData.user_id,
                "project_module":  quizProjectModuleRecord   //// 可以放json格式任意資料，會直接更新覆蓋掉，目前先把quiz記錄在它底下
            }
            
            if(quizProjectModuleRecord){
                //// 這裡需要提供 "Quiz id" 之後 GET 才能知道 "同專案下的哪個Quiz有遊玩記錄"
                if(quizProjectModuleRecord.playedQuizzes && Array.isArray(quizProjectModuleRecord.playedQuizzes)){
                    let quizIdExisted = quizProjectModuleRecord.playedQuizzes.find( item => item.obj_id==this.obj_id)
                    if(!quizIdExisted){
                        quizRecord.project_module.playedQuizzes.push( {"obj_id": this.obj_id, "record": this.module.record} )
                    }
                } else {
                    quizRecord.project_module.playedQuizzes = [ {"obj_id": this.obj_id, "record": this.module.record} ]
                }
            } else {
                quizRecord.project_module = {}
                quizRecord.project_module.playedQuizzes = [ {"obj_id": this.obj_id, "record": this.module.record} ]
            }

            //// 更新 同專案下的哪個Quiz有遊玩記錄
            _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].updateRecordModule( quizRecord ).then( result => {
                console.log("_updateRecordModule post to api: result=", result,
                            "\n\n quizRecord=", quizRecord );
            })
        })

        this.isPlaying = false
        console.log("Quiz.js: quiz end, quiz=" , this );
    }
    //[end-20240305-renaohsu-modify]//

}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Quiz);

//[start-20231116-renhaohsu-add]

//// 嘗試 design pattern: flywieght (享元模式)
//// 參考 https://wyattkidd.medium.com/翻譯-javascript-設計模式-fca4e2e16752#a9b3
//// 由一個只存在單一instance的class，來管理其他重複出現的小單元
////  
//// 但此處Quiz不會重複出現
//// 只是藉由上述特性來管理多個Quiz (因此只能說是參考了享元模式，但沒有使用到它最大的優點:節省記憶體)
//// 類似於 工廠模式 + 單例模式

//// According to wiki https://en.wikipedia.org/wiki/Flyweight_pattern#Implementation_details
//// the factory interface is commonly implemented as a singleton to provide global access for creating flyweights.
//// 
//// factory for quiz objects
class QuizFactory {
    
    quizData = [];
    loadedQuizzes = [];

    //// 記錄啟動物件
    triggers = [];

    //// 記錄"啟動物件"和對應的quiz物件obj_id
    quizIdOpenDirectly = [];
    quizIdWithTriggers = [];

    //// 當前被user點擊trigger 正要顯示的quiz
    currentlyTriggeredQuizId = "";

    //// 防止 QuizStartButton 的 html click event 重複呼叫
    alreadyTriggeredQuizId = "";

    constructor(){
        //// singleton pattern
        if(QuizFactory.exists)
        {
            return QuizFactory.instance
        }
        QuizFactory.instance = this
        QuizFactory.exists = true

        return this
    }

    createQuiz(objData){
        const obj_id = objData.generalAttr.obj_id
        let quiz = this.getQuiz(obj_id);
        if (quiz) {
            return quiz;
        } else {
            const newQuiz = new Quiz(objData);
            this.loadedQuizzes.push(newQuiz);
            return newQuiz;
        }
    }

    getQuiz(obj_id){
        return this.loadedQuizzes.find(quiz => quiz.obj_id === obj_id);
    }

    ////// 與 mDB 相關
    getQuizProjectFromMDB = function( proj_id ){        
        //// 20231116 rehnahowshu測試時發現這可以 .then 繼續往下chain
        return parent.mdb.getQuizProject( proj_id )
    }

    putQuizProjectToMDB = function(projInfo){
        return parent.mdb.putQuizProject( projInfo )
    }
    
    //// 確認是否正在顯示 答對/錯 動畫
    checkIs2DPictureShowing(){
        return this.loadedQuizzes.some( q => q.isButtonPushed )
    }

    //// 檢查是否有Quiz正在遊玩
    checkIsAnyQuizPlaying(){
        return this.loadedQuizzes.some( q => { return q.isPlaying == true; } )
    }

    //// 清除正在控管的quiz物件們。搭配 VRController loadScene()使用，讓場景切換時能清空aQuizVR
    clear(){
        this.quizData = [];
        this.loadedQuizzes = [];
    
        //// 記錄啟動物件
        this.triggers = [];

        //// 記錄"啟動物件"和對應的quiz物件obj_id
        this.quizIdOpenDirectly = [];
        this.quizIdWithTriggers = [];
    
        //// 當前被user點擊trigger 正要顯示的quiz
        this.currentlyTriggeredQuizId = "";
        this.alreadyTriggeredQuizId = "";
    }

    ////  載入了Quiz，記錄資料到mdb
    saveQuizDataToMDB(quiz_obj_id, user_id, project_id, device_id){   
        
        let quizzesInfo = {
            "user_id": user_id,
            "proj_id": project_id,
            "device_id": device_id,
            "obj_id": quiz_obj_id,   
            "is_played": true,
            "type":"quiz",

            "login_id": localStorage.getItem("MakarUserID") ? localStorage.getItem("MakarUserID") : "not logged in",
            "date_time": (new Date()).toString(),

            //// 記錄遊玩記錄 (暫時擱置，因為每個quiz物件底下的record或module已有記錄。)
            // "can_reward_point_count": scene_objs[j].project_module[0].can_reward_point_count,
            // "collected_points": [
            //     getPointTarget.target_id
            // ],
        }

        this.getQuizProjectFromMDB(project_id).then( getProjRet => {

            
            if ( Object.keys(getProjRet).length == 0 ) {    
                    
                //// mdb沒記錄 直接新增         
                let projInfo = {
                    "proj_id": project_id,
                    "quizzes": {}
                }
                projInfo.quizzes[quiz_obj_id] = quizzesInfo
                
                let p = this.putQuizProjectToMDB ( projInfo )    
                // p.then(data => console.log("____________mdb put!   data", data))         
                
            } else {
                //// 專案已在mdb記錄過
                let projInfo = getProjRet
                
                //// 新增or更新 該集點卡的資料
                if( !getProjRet.quizzes ){
                    //// 專案有記錄，但並非集點卡 新增
                    projInfo.quizzes = {}
                }
                projInfo.quizzes[quiz_obj_id] = quizzesInfo
                
                let p = this.putQuizProjectToMDB ( projInfo )    
                // p.then(data => console.log("____________mdb put!   data", data))         
            }

        }).catch((err) => {
            console.warn('Quiz.js _saveQuizDataToMDB: saveQuizDataToMDB but error:', err)
        });

    }

    //[start-20231207-howardhsu-modify]//	
    loadQuiz( jsonObj, transformData, proj_id, login_id, UIs, worldContent, languageType ){

        //// 要回傳給 VRController 的 Promise (需要在loadSceneObjects把這個加到 pAll)
        let pQuizCheckRecords = []

        const position = transformData.position
        const rotation = transformData.rotation
        const scale = transformData.scale


        //// v3.5.0.0 的 quiz 在 "實際要顯示" 的時候才加入 makarObjects
        this.quizData.push(jsonObj)

        //// html 2D介面 一句文字(點擊開始遊玩) + 確認按鈕
        // let startQuiz = document.getElementById("startQuiz");		
        let startQuiz = UIs.startQuiz
        
        //// 3.5.0 Quiz 啟動物件  ( 20240125 ↓ )
        //// typeAttr.module.trigger 應該就是quiz的啟動物件 但沒有 trigger_type 暫時當作有trigger就是"點擊物件啟動"   (註: 然而question_list的每個題目有trigger_type，若以後變成"每道題目"都有自己的啟動物件，這裡的流程可能要修改)
        if(jsonObj.typeAttr.module.trigger.length != 0 ){

            const trigger_id = jsonObj.typeAttr.module.trigger

            this.triggers.push(trigger_id)
            this.quizIdWithTriggers.push({ 
                "quiz_id": jsonObj.generalAttr.obj_id,
                "trigger_id": trigger_id,
                "force_login": jsonObj.typeAttr.module.force_login,
                "allow_retry": jsonObj.typeAttr.module.allow_retry
            } )
        }
    
        // let QuizStartButton = document.getElementById("QuizStartButton");
        let QuizStartButton = UIs.QuizStartButton

        let QuizStartContent = UIs.QuizStartContent

        //// click event for quiz start button
        let startQuizFunc = () => {      
            //// 如果quiz在編輯器的設定是"直接開啟"
            if(jsonObj.typeAttr.module.trigger.length == 0){    

                let quiz = this.createQuiz(jsonObj)	
                quiz.load( jsonObj, position, rotation, scale );
                startQuiz.style.display = "none";
                QuizStartButton.removeEventListener("click",startQuizFunc);
                
                ////  載入了Quiz，記錄資料到mdb
                const user_id = makarUserData.oneProjData.user_id
                // const project_id = self.scenesData.project_id
                const project_id = proj_id
                const device_id = localStorage.getItem('device_id')                                            
                this.saveQuizDataToMDB(quiz.obj_id, user_id, project_id, device_id)

            } else {
                //// 如果quiz在編輯器的設定是"點擊物件開啟"
                //// confirm which quiz should be shown
                if(this.currentlyTriggeredQuizId){
                    if( this.currentlyTriggeredQuizId == jsonObj.generalAttr.obj_id ){     
                        if( this.alreadyTriggeredQuizId == this.currentlyTriggeredQuizId ){
                            //// _QuizStartButton htmlClickEvent在轉場景時難以移除 因此要先確認是否重複呼叫
                            // console.log("_QuizStartButton htmlClickEvent在轉場景時難以移除 因此要先確認是否重複呼叫")
                        } else {
                            this.alreadyTriggeredQuizId = this.currentlyTriggeredQuizId

                            let quiz = this.createQuiz(jsonObj)	
                            quiz.load( jsonObj, position, rotation, scale )
                            startQuiz.style.display = "none"
                            QuizStartButton.removeEventListener("click", startQuizFunc)
                            
                            ////  載入了Quiz，記錄資料到mdb
                            const user_id = makarUserData.oneProjData.user_id
                            // const project_id = self.scenesData.project_id
                            const project_id = proj_id
                            const device_id = localStorage.getItem('device_id')                                            
                            this.saveQuizDataToMDB(quiz.obj_id, user_id, project_id, device_id)
                        }
                    }
                }
            }
        }							

        //// 離開quiz
        let quitQuizFunc = function(){
            startQuiz.style.display = "none";
            // QuizStartButton.removeEventListener("click",quitQuizFunc);
        }

        let url = window.serverUrl;
        
        // let proj_id = self.currentProjData.proj_id;

        ////  有MakarUserID可以代表user已經登入
        // let login_id = localStorage.getItem("MakarUserID") 
        ////  假如專案要求『強制登入作答』，檢查是否登入
        const force_login = jsonObj.typeAttr.module.force_login                            
        ////  檢查是否『允許重複作答』
        const allow_retry = jsonObj.typeAttr.module.allow_retry
        ////  確認問答開啟方式: 目前有兩種，"Directly"直接開啟，"Target"點擊物件開啟
        const showDirectly = jsonObj.typeAttr.module.trigger.length == 0
        
        //// 檢查 上述四種條件下 8+4 種組合
        if( force_login && allow_retry &&  showDirectly && login_id ){

            //// 可以重複作答，不用檢查紀錄，直接載入問答資料
            // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
            QuizStartContent.textContent = worldContent.clickToPlay[languageType];
            QuizStartButton.addEventListener("click",startQuizFunc);
            //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字
            this.quizIdOpenDirectly.push( {"quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent} )
        
        } else if(  force_login &&  allow_retry && !showDirectly && login_id ){

            //// 可以重複作答，不用檢查紀錄，直接載入問答資料
            // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
            QuizStartContent.textContent = worldContent.clickToPlay[languageType];
            QuizStartButton.addEventListener("click",startQuizFunc);
            //// html UI的 (startQuiz) 的文字、clickEvent(需要)在 triggerEvent "ShowQuiz"時再次設定

        } else if(  force_login && !allow_retry &&  showDirectly && login_id ){

            let getApiRecord = _quizCheckApiRecord(login_id, proj_id, showDirectly)
            // pObjs.push(getApiRecord)
            pQuizCheckRecords.push(getApiRecord)
            
        } else if(  force_login && !allow_retry && !showDirectly && login_id ){
            
            let getApiRecord = _quizCheckApiRecord(login_id, proj_id, showDirectly)
            // pObjs.push(getApiRecord)
            pQuizCheckRecords.push(getApiRecord)

        } else if(  force_login &&  allow_retry &&  showDirectly && !login_id ){
            //// 沒有登入，不給遊玩，跳出提示
            _userNotLoggedIn();
        } else if(  force_login &&  allow_retry && !showDirectly && !login_id ){
            _userNotLoggedIn();
        } else if(  force_login && !allow_retry &&  showDirectly && !login_id ){
            _userNotLoggedIn();
        } else if(  force_login && !allow_retry && !showDirectly && !login_id ){
            _userNotLoggedIn();        

        } else if( !force_login &&  allow_retry &&  showDirectly ){

            //// 可以重複作答，不用檢查紀錄，直接載入問答資料
            // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
            QuizStartContent.textContent = worldContent.clickToPlay[languageType];
            QuizStartButton.addEventListener("click",startQuizFunc);
            //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字  
            this.quizIdOpenDirectly.push( {"quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent} )
        
        } else if( !force_login &&  allow_retry && !showDirectly ){
            
            //// 可以重複作答，不用檢查紀錄，直接載入問答資料
            // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
            QuizStartContent.textContent = worldContent.clickToPlay[languageType];
            QuizStartButton.addEventListener("click",startQuizFunc);
            //// html UI的 (startQuiz) 的文字(需要)在 triggerEvent "ShowQuiz"時再次設定
            
        } else if( !force_login && !allow_retry &&  showDirectly ){

            //// 『不強制登入作答』、『不可重複遊玩』 檢查mdb 確認是否已有遊玩記錄、是否為『直接顯示』並做出對應處理
            let getMdbRecord = _quizCheckMdbRecord(proj_id, showDirectly)
            // pObjs.push(getMdbRecord)
            pQuizCheckRecords.push(getMdbRecord)

        } else if( !force_login && !allow_retry && !showDirectly ){

            let getMdbRecord = _quizCheckMdbRecord(proj_id, showDirectly)
            // pObjs.push(getMdbRecord.pQuizGetMdbRecord)
            pQuizCheckRecords.push(getMdbRecord.pQuizGetMdbRecord)

        }


        //// quiz在編輯器設定"強制登入遊玩" 但web端user沒登入：只顯示文字提示，不給遊玩 
        function _userNotLoggedIn(){
            //// 沒有登入，不給遊玩，跳出提示
            // QuizStartContent.textContent = self.worldContent.userNotLoginInfo[self.languageType];
            QuizStartContent.textContent = worldContent.userNotLoginInfo[languageType];
            QuizStartButton.addEventListener("click",quitQuizFunc);                 
            //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字               
            window.aQuizVR.quizIdOpenDirectly.push( {"quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent} )
        }

        //// 假如專案要求『強制登入作答』、『不可重複遊玩』 call後端API 來確認是否已有遊玩記錄
        function _quizCheckApiRecord(login_id, proj_id, showDirectly){
            return _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].getRecordModule( login_id, proj_id ).then(ret => {
                // console.log("vrController.js: _getRecordModule: login_id=", login_id, "proj_id=", proj_id , "\n  ret= " , ret );
                if(ret.data.record_module_list.length != 0){                                                
                    //// 此登入用戶已經有遊玩記錄 

                    // console.log("record_module_list", ret.data.record_module_list)
                    let quizProjectModuleRecord;
                    if( ret.data.record_module_list && Array.isArray(ret.data.record_module_list) ){
                        if(ret.data.record_module_list[0].project_module){
                            quizProjectModuleRecord = ret.data.record_module_list[0].project_module
                        }
                    }

                    //// 從記錄裡找 Quiz obj_id 確認是否玩過
                    let played = false
                    if(quizProjectModuleRecord){
                        if(quizProjectModuleRecord.playedQuizzes && Array.isArray(quizProjectModuleRecord.playedQuizzes)){
                            played = quizProjectModuleRecord.playedQuizzes.find( item => item.obj_id==jsonObj.generalAttr.obj_id)
                        }
                    }

                    if(played){
                        //// 這Quiz 已經遊玩過，跳出提示
                        QuizStartContent.textContent = worldContent.userAlreadyPlayed[languageType];
                        QuizStartButton.addEventListener("click",quitQuizFunc);
                    } else {
                        //// 這Quiz 沒有遊玩記錄 ，直接載入問答資料
                        QuizStartContent.textContent = worldContent.clickToPlay[languageType];
                        QuizStartButton.addEventListener("click",startQuizFunc);
                    }

                } else{
                    //// 沒有遊玩記錄 ，直接載入問答資料
                    QuizStartContent.textContent = worldContent.clickToPlay[languageType];
                    QuizStartButton.addEventListener("click",startQuizFunc);
                }
                
                if( showDirectly ){
                    //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字  
                    window.aQuizVR.quizIdOpenDirectly.push({ "quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent })
                }
                
            })
        }

        //// 假如專案要求『不 強制登入作答』、『不可重複遊玩』 檢查mdb 確認是否已有遊玩記錄
        function _quizCheckMdbRecord(proj_id, showDirectly){
            return parent.mdb.getProject(proj_id, getEvent => {
                if ( getEvent.target.readyState == "done" && getEvent.target.result ){
                    //// 檢查 mdb 已遊玩過的quiz 是否存在
                    if( getEvent.target.result.quizzes ){
                        // if( getEvent.target.result.quiz_obj_ids.find(ele => ele==jsonObj.generalAttr.obj_id) ){
                        const obj_id = jsonObj.generalAttr.obj_id
                        if( getEvent.target.result.quizzes[obj_id] ){

                            //// 有記錄 這個Quiz 已經遊玩過，跳出提示                                
                            console.log("VRController.js: indexedDB.js _getProject: already have the project with same proj_id and the quiz have been played.", getEvent.target.result , getEvent.target.result.getAwardIndex );
                            // QuizStartContent.textContent = self.worldContent.userAlreadyPlayed[self.languageType];
                            QuizStartContent.textContent = worldContent.userAlreadyPlayed[languageType];
                            QuizStartButton.addEventListener("click",quitQuizFunc);
                            if( showDirectly ){
                                //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字  
                                window.aQuizVR.quizIdOpenDirectly.push({ "quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent })
                            }

                            return getEvent
                        } else {              
                            //// 有記錄 但這個Quiz還沒有遊玩過，載入問答資料
                            // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
                            QuizStartContent.textContent = worldContent.clickToPlay[languageType];
                            QuizStartButton.addEventListener("click",startQuizFunc);
                            if( showDirectly ){
                                //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字  
                                window.aQuizVR.quizIdOpenDirectly.push({ "quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent })
                            }
                            
                            return getEvent
                        }

                    } else {              
                        //// 沒記錄 沒有遊玩過，載入問答資料
                        // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
                        QuizStartContent.textContent = worldContent.clickToPlay[languageType];
                        QuizStartButton.addEventListener("click",startQuizFunc);
                        if( showDirectly ){
                            //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字  
                            window.aQuizVR.quizIdOpenDirectly.push({ "quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent })
                        }
                        
                        return getEvent
                    }
                }else{                                            
                    //// 沒有遊玩過，載入問答資料
                    // QuizStartContent.textContent = self.worldContent.clickToPlay[self.languageType];
                    QuizStartContent.textContent = worldContent.clickToPlay[languageType];
                    QuizStartButton.addEventListener("click",startQuizFunc);
                    if( showDirectly ){
                        //// 記錄有quiz是直接顯示，以便在所有scene_objs都遍歷之後，給定 html UI的 (startQuiz) 的文字  
                        window.aQuizVR.quizIdOpenDirectly.push({ "quiz_obj_id": jsonObj.generalAttr.obj_id, "quizUiTextContext": QuizStartContent.textContent })
                    }
                    
                    return getEvent
                }
            })
        }

        return pQuizCheckRecords
    }
    //[end-20231207-howardhsu-modify]//

}

window.aQuizVR = new QuizFactory();

//// 一些測試和觀察 先等到確認完成後再移除:  單例模式: 限制QuizFactory只能存在一個實例
//// 
//// singleton pattern: every instances of QuizFactory should reference to the same object
// window.qf2 = new QuizFactory();
// console.log(`%c Quiz.js: \n  using singleton pattern: aQuizVR == qf2 is ${aQuizVR == qf2}`, 'color: DarkCyan;font-size:20px')

//// 一些測試和觀察 先等到確認完成後再移除:  享元模式的特性 - QuizFactory和Quiz的關係
////
//// flyweight pattern: the objects with same obj_id created by QuizFactory should reference to the same object
// const quiz = aQuizVR.createQuiz( {'generalAttr':{'obj_id': 'quiz_unit_1'}} )
// const quizWithSameID = aQuizVR.createQuiz( {'generalAttr':{'obj_id': 'quiz_unit_1'}} )
// console.log(`%c Quiz.js: \n  using flyweight pattern: quiz == quizWithSameID is ${quiz == quizWithSameID}`, 'color: Olive;font-size:20px')
//// 但Quiz不會用到這個特性  (只是用工廠模式+單一模式 把所有Quiz整理起來)

//[end-20231116-renhaohsu-add]

/***/ }),

/***/ "./js/VRMain/version3_5/VRController.js":
/*!**********************************************!*\
  !*** ./js/VRMain/version3_5/VRController.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./networkAgent.js */ "./js/VRMain/version3_5/networkAgent.js");
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _vrObjectModules_setTransform_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./vrObjectModules/setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");
/* harmony import */ var _vrObjectModules_SkyModule_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./vrObjectModules/SkyModule.js */ "./js/VRMain/version3_5/vrObjectModules/SkyModule.js");
/* harmony import */ var _vrObjectModules_AudioModule_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./vrObjectModules/AudioModule.js */ "./js/VRMain/version3_5/vrObjectModules/AudioModule.js");
/* harmony import */ var _vrObjectModules_GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./vrObjectModules/GLTFModelModule.js */ "./js/VRMain/version3_5/vrObjectModules/GLTFModelModule.js");
/* harmony import */ var _vrObjectModules_ImageModule_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./vrObjectModules/ImageModule.js */ "./js/VRMain/version3_5/vrObjectModules/ImageModule.js");
/* harmony import */ var _vrObjectModules_LightModule_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./vrObjectModules/LightModule.js */ "./js/VRMain/version3_5/vrObjectModules/LightModule.js");
/* harmony import */ var _vrObjectModules_TextModule_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./vrObjectModules/TextModule.js */ "./js/VRMain/version3_5/vrObjectModules/TextModule.js");
/* harmony import */ var _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./vrObjectModules/VideoModule.js */ "./js/VRMain/version3_5/vrObjectModules/VideoModule.js");
/* harmony import */ var _vrObjectModules_CurveModule_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./vrObjectModules/CurveModule.js */ "./js/VRMain/version3_5/vrObjectModules/CurveModule.js");
/* harmony import */ var _Quiz_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Quiz.js */ "./js/VRMain/version3_5/Quiz.js");
/* harmony import */ var _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./MakarWebXRVersionControl.js */ "./js/VRMain/version3_5/MakarWebXRVersionControl.js");
/* harmony import */ var _scripts_MakarEvents_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../scripts/MakarEvents.js */ "../scripts/MakarEvents.js");






 





//// v3.5 Quiz已被獨立出來 (在runtime可從 window.aQuizVR 取得)




// import MakarEvents from './MakarEvents.js';


class VRController {

    //// scene 2D part
    GLRenderer = null;
    scene2D = null;
    camera2D = null;
    light = null;
    videoScene = null;
    videoCamera = null;

    //// 依照當前裝置大小算出的「2D物件比例」
    scaleRatioXY = null;

    //// MAKAR part
    vrScene = null;


    makarVRscenes = {};

    makarObjects = [];

    makarObjects2D = [];

    ///// 此陣列只會在「每次載入場景完成之後作修改」，目前為了讓「點擊移動功能」可以在 滑鼠移動時候作判斷使用
    currentSceneMakarObjects = [];

    //20200528-thonsha-add-start
    loadSceneCount = 0
    module = null;
    cursorEntity = null;
    //20200528-thonsha-add-end
    
    //20200807-thonsha-add-start
    projectIdx = null;
    //20200807-thonsha-add-end

    //20220105-thonsha-add-start
    intervalList = [];
    //20220105-thonsha-add-end

    materials_texture_dict = {};

    init_gyro = null;

    //// for update
    FUNCTION_ENABLED = false;
    clock = new THREE.Clock();
    delta = this.time = 0;

    //// 沒有特別的用意，主要是為了讓每次 create <video> 的 id 不相同
    triggerEnable = false;

    //// 紀錄『滑鼠』『觸碰』狀態
    touchMouseState = -1;

    //// 紀錄「觸發事件」中帶有「群組」的事件
    groupDict = {
        0: {activeObj:null,objs:[]},
        1: {activeObj:null,objs:[]},
        2: {activeObj:null,objs:[]},
        3: {activeObj:null,objs:[]},
        4: {activeObj:null,objs:[]},
        5: {activeObj:null,objs:[]},
        6: {activeObj:null,objs:[]},
        7: {activeObj:null,objs:[]},
    };

    //// 紀錄「注視事件」
    // lookAtObjectList = [];
    lookAtTimelineDict = {};

    loadingTickOn;

    //[start-20230726-howardhsu-add]//
    //// 紀錄編輯器版本
    editor_version = [];
    sceneIndex = 0;

    type;
    currentProjData;
    scenesData;
    userOnlineResDict;
    userProjResDict;

    currentSceneIndex;

    //// ios safari 複數影片播放時 只能讓1個影片有聲音 其他靜音
    safariUnMutedVideo;

    //// 原本在VRFunc.js的語言、翻譯文字
    languageType;
    worldContent;

    //// html elements on this page, (不只這些)
    domElement = {
        "loadPage": document.getElementById("loadPage"),
        "homePage": document.getElementById("homePage"),
        "startQuiz": document.getElementById("startQuiz"),
        "gsapEmpty": document.getElementById("gsapEmpty"),

    }

    //// 
    //// 隨著 for_makarSDK 而新增的: behav觸發時給html發布event 
    ////      MakarEvents 以目前的使用方式 應該可以加上單例模式 (vrController ←→ makarEvents)
    makarEvents = new _scripts_MakarEvents_js__WEBPACK_IMPORTED_MODULE_13__["default"](self, vrDiv)

    //// fei v3.5.0.0 修改
    constructor( makarUserData ){
        
        this.type = 'VRController';

        if ( makarUserData.oneProjData ){
            this.currentProjData = makarUserData.oneProjData
        }

        if ( makarUserData.scenesData ){
            this.scenesData = makarUserData.scenesData
        }

        if ( makarUserData.userOnlineResDict ){
            this.userOnlineResDict = makarUserData.userOnlineResDict
        }
        if ( makarUserData.userProjResDict ){
            this.userProjResDict = makarUserData.userProjResDict
        }
        if ( makarUserData.userMaterialDict ){
            this.userMaterialDict = makarUserData.userMaterialDict
        }


        //[start-20231108-renhaohsu-add]//
        //// set those load_object functions as VRController's method
        this.setTransform = _vrObjectModules_setTransform_js__WEBPACK_IMPORTED_MODULE_2__.setTransform
        this.loadSky = _vrObjectModules_SkyModule_js__WEBPACK_IMPORTED_MODULE_3__.loadSky
        this.loadAudio = _vrObjectModules_AudioModule_js__WEBPACK_IMPORTED_MODULE_4__.loadAudio
        this.loadGLTFModel = _vrObjectModules_GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_5__.loadGLTFModel
        this.loadWebViewNotSupport = _vrObjectModules_GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_5__.loadWebViewNotSupport
        this.loadWebViewNotSupport2D = _vrObjectModules_GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_5__.loadWebViewNotSupport2D
        this.loadText = _vrObjectModules_TextModule_js__WEBPACK_IMPORTED_MODULE_8__.loadText
        this.loadText2D = _vrObjectModules_TextModule_js__WEBPACK_IMPORTED_MODULE_8__.loadText2D
        this.loadTexture2D = _vrObjectModules_ImageModule_js__WEBPACK_IMPORTED_MODULE_6__.loadTexture2D
        this.loadTexture =  _vrObjectModules_ImageModule_js__WEBPACK_IMPORTED_MODULE_6__.loadTexture
        this.loadLight = _vrObjectModules_LightModule_js__WEBPACK_IMPORTED_MODULE_7__.loadLight
        this.loadVideo = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.loadVideo
        this.loadVideo2D = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.loadVideo2D
        this.loadCurve = _vrObjectModules_CurveModule_js__WEBPACK_IMPORTED_MODULE_10__.loadCurve
        this.bezierPathAnime = _vrObjectModules_CurveModule_js__WEBPACK_IMPORTED_MODULE_10__.bezierPathAnime
        this.UnMutedAndPlayAllVisibleVideo = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.UnMutedAndPlayAllVisibleVideo
        this.mute2dVideos = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.mute2dVideos
        this.mute3dVideos = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.mute3dVideos
        this.pause2dVideos = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.pause2dVideos
        this.pause3dVideos = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.pause3dVideos
        this.loadYouTubeNotSupport = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.loadYouTubeNotSupport
        this.loadYouTubeNotSupport2D = _vrObjectModules_VideoModule_js__WEBPACK_IMPORTED_MODULE_9__.loadYouTubeNotSupport2D
        //[start-20231108-renhaohsu-add]//


        this.languageType = window.languageType = 'tw';
        
        this.worldContent = {

            userAlreadyPlayed:{tw:"此登入用戶已經遊玩過", en:"This user already played"},
            userNotLoginInfo:{tw:"必須要登入MAKAR後才可遊玩", en:"Please login at first"},
            clickToPlay:{tw:"點擊開始遊玩", en:"Click to play"},
    
            backToHome:{tw:"專案標題", en:"back"},
            GPSDistanceMsg:{tw:"需在GPS的範圍內才能開啟 \r\n 距離：", en:"Please to the right place"},
            GPSErrorMsg:{tw:"GPS 錯誤", en:"GPS error"},
            GPSnotSupportMsg:{tw:"沒有支援 GPS ", en:"GPS not support"},
            comfirm:{tw:"確認", en:"Confirm"},
            
        };

        //// for_makarSDK
        if(window.makarSDK && window.makarSDK.vrDiv){        
            console.log("window.makarSDK.vrDiv", window.makarSDK.vrDiv)
            //// 準備 js custom event 
            const event_vrControllerCreated = new CustomEvent("vrControllerCreated", {
                detail: {
                    "name": "(for webSDK) vrController is created.",
                    "vrController": this,
                    "currentActiveController": this
                },
            });
            window.makarSDK.vrDiv.dispatchEvent(event_vrControllerCreated);
        }

    }

    get2DScaleRatio(){

        let self = this;

        let scaleRatioXY;

        //// 編輯器基本上針對 AR 專案可以讓使用者選擇「2D界面比例」，由於「使用者裝置比例」無法確認，所以變成載入物件時候需要針對專案來設定物件大小位置
        //// 3:4 =「1440, 1920」
        //// 9:16 =「720, 1280」 
        //// 9:18 =「1080, 2160」
        //// 4:3 = 「1920, 1440」
        //// 16:9 =「1280, 720」 
        //// 18:9 = 「2160, 1080」

        let resolutionString = '';

        ////
        //// 2022 1123以後， 3.3.8 上線，修改資料
        //// 3.3.8 之後需要從「2D界面列表中判斷最適合的」
        //// 3.5.0.0 之後 editor_version 是物件型式
        if ( Object.keys( this.editor_version ).length == 4 ){
            let largeV  = Number( this.editor_version.v0 );
            let middleV = Number( this.editor_version.v1 );
            let smallV  = Number( this.editor_version.v2 );	
            
	        //[start-20231024-howardhsu-modify]//
            if ( largeV>3 || (largeV==3 && middleV>4) ){
                resolutionString = getResolution350()
            }else{
                // resolutionString = getResolution330();
            }
        }else{
            resolutionString = getResolution350()
            //[end-20231024-howardhsu-modify]//
        }

        //[start-20230818-howardhsu-modify]//
        function getResolution350(){

            let tempR = '';

            //// 當前用戶畫面大小， PC: w*600 mobile: w*300(?)
            let userWidth = self.vrScene.clientWidth;
            let userHeight = self.vrScene.clientHeight;

            if ( makarUserData.oneProjData && Array.isArray(makarUserData.oneProjData.orientation) ){
                let screenList = makarUserData.oneProjData.orientation;
                
                let minScore = 1000;
                let selectedResolutionIndex = 0;
                screenList.forEach( ( e , i )=>{
                    
                    //// 比例差距，比例相同為 1 、比例差距極端值為 0 or 無限大 
                    let resolutionDiff = ( e.width/e.height ) / ( userWidth/userHeight );

                    //// 寬高差距 比值，比例相同為 1 、比例差距極端值為 0 or 無限大
                    let widthDIff = e.width / userWidth;
                    let heightDIff = e.height / userHeight;

                    let nrd = resolutionDiff>1? resolutionDiff: 1/resolutionDiff;
                    let nwd = widthDIff>1? widthDIff: 1/widthDIff;
                    let nhd = heightDIff>1? heightDIff: 1/heightDIff;

                    e.nrdScore = nrd * ( nwd + nhd );

                    // console.log(' _getResolution350: sss ' , i , e.width, e.height, e.nrdScore );

                    if ( e.nrdScore < minScore ){
                        minScore = e.nrdScore 
                        selectedResolutionIndex = i
                    }

                });

                let selectResolution = screenList[ selectedResolutionIndex ];
                //// 紀錄「當前使用的 寬高比例 index 」	
                self.selectedResolutionIndex = selectedResolutionIndex

                tempR = String ( selectResolution.width ) + ',' + String ( selectResolution.height );
                console.log('VRController.js _get2DScaleRatio _getResolution350: ' , minScore , selectedResolutionIndex , selectResolution , tempR );

            }
            
            return tempR;

        }        
        //[end-20230818-howardhsu-modify]//

        // //// 判斷是否存在「專案大小比例」
        // if ( VRSceneResult[ self.projectIdx ] ){
        // 	if ( VRSceneResult[ self.projectIdx ].scene_objs_v2 ){
        // 		if ( VRSceneResult[ self.projectIdx ].scene_objs_v2.resolution ){
        // 			resolutionString = VRSceneResult[ self.projectIdx ].scene_objs_v2.resolution;
        // 		}
        // 	}
        // }



        if ( resolutionString == ''){
            console.log(' _get2DScaleRatio: fucking lose resolutionString '); 
            resolutionString = "720,1280";
        }

        let cameraWidth, cameraHeight;

        //// 假如有找到「專案大小比例」，調整
        if ( resolutionString != '' ){
            let resArr = resolutionString.split(',');

            //// 專案設定理想大小
            let idealWidth = Number( resArr[0] );
            let idealHeight = Number( resArr[1] );
            
            //// 使用者當下裝置大小
            let userWidth = self.vrScene.clientWidth;
            let userHeight = self.vrScene.clientHeight;

            //// 使用者當前 camera 2D 的比例
            cameraWidth = Math.abs( self.camera2D.right - self.camera2D.left );
            cameraHeight = Math.abs( self.camera2D.bottom - self.camera2D.top );

            //// 2D 相機預設寬度比例 跟 使用者裝置比例比較。
            //// 2D 相機基本上電腦為寬比例( 640x480 ) 手機上通常為高比例(480,640)
            if ( cameraWidth/cameraHeight >= userWidth/userHeight ){

                //// 使用者裝置 與 理想界面 比例比較
                if ( userWidth/userHeight >= idealWidth/idealHeight ){
                    let rw = userHeight * (idealWidth/idealHeight );
                    let rh = userHeight;
                    let d1 = ( userWidth / ( userHeight * ( cameraWidth / cameraHeight ) ) );
                    let d2 = ( rw / userWidth );
                    let d3 = ( rw / idealWidth );

                    scaleRatioXY = d3;
                    console.log(' _loadTexture2D: 1 ' , idealWidth, idealHeight, userWidth , userHeight, scaleRatioXY  );
                }else{
                    let rw = userWidth;
                    let rh = userWidth * ( idealHeight / idealWidth );

                    let d1 = ( userWidth / ( userHeight * ( cameraWidth / cameraHeight ) ) );
                    let d2 = ( rh / userHeight ) 
                    let d3 = ( rw / idealWidth );

                    scaleRatioXY = d3;
                    console.log(' _loadTexture2D: 2 ' , idealWidth, idealHeight, userWidth , userHeight, scaleRatioXY  );
                }

            }else{
                //// 假如相機比裝置寬，計算出對應轉化比例

                if ( userWidth/userHeight >= idealWidth/idealHeight ){
                    let rw = userHeight * ( idealWidth / idealHeight );
                    let rh = userHeight ;
                    let d1 = ( userHeight / ( userWidth * ( cameraHeight / cameraWidth ) ) );
                    let d2 = ( rw / userWidth );
                    let d3 = ( rw / idealWidth );

                    scaleRatioXY =   d3;
                    console.log(' _loadTexture2D: 3 ' , idealWidth, idealHeight, userWidth , userHeight, scaleRatioXY , d1 , d2, d3  );
                    
                } else {
                    let rw = userWidth ;
                    let rh = userWidth * ( idealHeight / idealWidth );
                    let d1 =  ( userHeight / ( userWidth * ( cameraHeight / cameraWidth ) ) )
                    let d2 = ( rh / userHeight ) 
                    let d3 = ( rw / idealWidth );

                    scaleRatioXY =  d3;
                    console.log(' _loadTexture2D: 4 ' , idealWidth, idealHeight, userWidth , userHeight, scaleRatioXY , d1 , d2, d3  );
                }

            }

        } else {
            console.log(' fucking lose resolutionString '); 
        }
        
        // console.log(' _get2DScaleRatio: srxy=' , scaleRatioXY , ', cwh' , cameraWidth , cameraHeight );
        console.log(' _get2DScaleRatio: srxy=' , scaleRatioXY );

        return scaleRatioXY;
    }

    set2DScaleRatio( scaleRatioXY ){
        this.scaleRatioXY = scaleRatioXY;
    }
    //[end-20230726-howardhsu-add]//

    loadAssets() {
        let assets = document.createElement("a-assets");
        assets.setAttribute('id', "makarAssets" );
        assets.setAttribute('timeout', "1000" );
        assets.setAttribute('crossorigin', 'anonymous');
        this.vrScene.appendChild(assets);
        // self.makarObjects.push( assets );
    };

    //// 清除與 MAKAR 相關的當前場景內容，包含「 場景物件 」跟「 天空物件 」
    //// 注意後續要補上 2D 界面
    clearAllSceneObjs(){

        let self = this;

        if(self.logic){
            self.logic.stopLogic();
        }
        
        //// 換場景時無條件先清除所有影片
        let videos = document.getElementsByTagName('video');
        if ( videos.length > 0 ){
            for (let i = 0; i < videos.length; i++ ){
                videos[i].pause();
                videos[i].removeAttribute("src"); // empty source 	
                videos[i].load();
            }
        }

        //// 換場景時無條件先清除所有聲音
        //[start-20231123-renhaohsu-add]//
        let audios = document.getElementsByTagName('audio');
        if ( audios.length > 0 ){
            for (let i = 0; i < audios.length; i++ ){
                audios[i].pause();
                //[start-20231123-renhaohsu-add]//
                //// 可解決 "跳轉場景後，再跳轉回原場景，聲音物件不會播放" 的問題
                // audios[i].removeAttribute("src"); // empty source 	
                // audios[i].load();                
                audios[i].remove()
                //[end-20231123-renhaohsu-add]//
            }
        }
        //[end-20231123-renhaohsu-add]//

        if (self.makarObjects){ //// clean the additional object( without default object like, camera, cursor,  )
            for (let i = 0; i < self.makarObjects.length; i++ ){
                let makarObject = self.makarObjects[i];
                // makarObject.parentNode.removeChild( makarObject ); // this will remove the children, childNodes and object3D's children

                if ( makarObject.object3D ){
                    if(makarObject.object3D.bezier){
                        makarObject.object3D.bezier.pause();
                    }
                    makarObject.object3D.traverse( c =>{
                        if ( c.isMesh ){
                            
                            if ( c.material ){
                                if ( c.material.map ){
                                    if ( c.material.map.dispose ){
                                        c.material.map.dispose();													
                                    }
                                }
                                c.material.dispose();
                            }

                            if ( c.geometry ){
                                c.geometry.dispose();
                            }
                        }
                    });
                }

                makarObject.remove();

            }
            self.makarObjects.length = 0; // clean the array.
        }

        //[start-20231102-howardhsu-add]
        if (self.makarObjects2D){ //// clean the additional object( without default object like, camera, cursor,  )
            for (let i = 0; i < self.makarObjects2D.length; i++ ){
                let makarObject2D = self.makarObjects2D[i];
                // makarObject2D.parentNode.removeChild( makarObject2D ); // this will remove the children, childNodes and object3D's children

                if ( makarObject2D.isObject3D ){
                    makarObject2D.traverse( c =>{
                        if ( c.isMesh ){
                            
                            if ( c.material ){
                                if ( c.material.map ){
                                    if ( c.material.map.image.tagName == 'VIDEO' ){
                                        //// 停止影片播放: 為了不那麼突兀 先把影片聲音漸弱 再停止播放
                                        let v = c.material.map.image
                                        let timerId = 0;
                                        let sec = 0;
                                        timerId = setInterval(function(){    
                                            if(sec >= 19) {
                                                v.volume = 0
                                                v.pause()
                                                window.clearInterval(timerId);
                                            } else {
                                                if(v.volume -0.05 >= 0) {
                                                    v.volume -= 0.05
                                                }
                                            }
                                            sec++;
                                            // console.log(sec, v.volume, timerId)
                                        }, 20);
                                    } 
                                    if ( c.material.map.dispose ) c.material.map.dispose(); 
                                }
                                c.material.dispose();
                            }

                            if ( c.geometry ){
                                c.geometry.dispose();
                            }
                        }
                    });
                }

                self.scene2D.remove(makarObject2D);

            }
            self.makarObjects2D.length = 0; // clean the array.
        }
        //[end-20231102-howardhsu-add]

        //// 清除「當前場景有的物件」
        if ( Array.isArray( self.currentSceneMakarObjects ) ){
            self.currentSceneMakarObjects.length = 0;
        }

        //// 假如曾經載入過環景圖片，清除
        if ( self.cubeTex ){
            if ( self.cubeTex.texture ){
                self.cubeTex.texture.dispose();
            }
            self.cubeTex.dispose();
        }

        //// 清除 天空 內容 ，尚未測試 圖片/影片 清除的流程 
        let aSky = document.getElementById('vrSky');
        if (aSky){
            if (aSky.localName == "a-sky"){
                aSky.remove();
            }else if (aSky.localName == "a-videosphere"){
                aSky.remove();
            }
        }

        // 清除場景事件的timeID
        for(let i = 0; i <self.intervalList.length;i++){
            window.clearInterval(self.intervalList[i]);
        }

        // 陀螺儀記錄清除
        self.init_gyro = null;

        //重置額外場景物件
        self.onlySkyScene = new THREE.Scene();
        self.cullFaceBackScene = new THREE.Scene();
        


        self.needsRenderTarget = false;

        self.needsCullFaceBack = false;



    }


    ////// load the nth scene in specific prroject
    ////// At first, will called for load the first scene. 
    loadScene( sceneIndex ) {
        
        //// 載入場景的時候，先顯示處『載入頁面』直到圖片或是影片 onload 再隱藏『載入頁面』，**** 目前不使用此功能 **** 
        
        let self = this

        self.currentSceneIndex = sceneIndex;
        
        let scenes = [];
        scenes = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getScenes( self.scenesData );

        ///// 看起來能拿掉，從 currentSceneIndex, sceneIndex 兩者擇一
        console.log("3.5 merge loadscene", sceneIndex)
        this.sceneIndex = sceneIndex

        // if (self.VRSceneResult[projIndex].scenes[sceneIndex] == undefined ){
        if ( scenes[ sceneIndex ] == undefined  ){
            console.log("VRFunc.js: VRController: _loadScene: error, [valid sceneIndex]=", self.scenesData , sceneIndex );
        }else{

            //// 換場景時無條件先清除所有影片
            self.clearAllSceneObjs();

            //[start-20231122-howardhsu-add]//
            window.aQuizVR.clear();
            //[end-20231122-howardhsu-add]//

            //// 判定「版本」
            let editor_version = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getProjDataEditorVer( self.currentProjData );

            //// 紀錄「當前使用的版本」
            self.editor_version = editor_version;

            //// 依照版本來確認「 sky 」
            let scene_skybox_url;
            
            //// v3.5.0.0
            //// 從「場景物件」取得「使用者物件」的詳細資料
            //// 由於需要「使用者素材庫」「使用者線上素材庫」，不進入個別模組使用
            let sceneSky_info = {};

            if ( editor_version.v0 == 3 && editor_version.v1 >= 5 ){

                let scene_skybox_res_id = '';
                if ( scenes[ sceneIndex ].environment && 
                    scenes[ sceneIndex ].environment.scene_skybox_res_id
                ){
                    scene_skybox_res_id = scenes[ sceneIndex ].environment.scene_skybox_res_id;

                    //// 從「使用者素材庫」查找天空物件資料
                    if ( self.userProjResDict[ scene_skybox_res_id ] ){
                        let skyObj = self.userProjResDict[ scene_skybox_res_id ]
                        if ( skyObj.main_type == 'spherical_image' || skyObj.main_type == 'spherical_video' ){
                            sceneSky_info = skyObj;
                        }                       
                    }
                    else{
                        sceneSky_info.main_type = "spherical_image"; // 找不到resources，補main type 和 url
                        sceneSky_info.res_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
                    }
                }
            }


            if ( sceneSky_info.main_type == 'spherical_video' ){
                scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg";
            }else if ( sceneSky_info.main_type == 'spherical_image' ){
                if ( sceneSky_info.res_url == "DefaultResource/Spherical_Image/SphericalImage.png"  ){
                    scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
                } else {
                    scene_skybox_url = sceneSky_info.res_url;
                }
            }else {
                scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
            }



            //// 檢查 「 sky 」是否存在，否的話使用「預設灰圖」作為 環景環境圖。往下載入「場景物件」
            (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_1__.UrlExists)( scene_skybox_url, function( retStatus ){
                if (retStatus == false){
                    scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg";
                }

                let targetCube;
                if ( THREE.WebGLRenderTargetCube ){
                    targetCube = new THREE.WebGLRenderTargetCube(1024, 1024);
                }else{
                    targetCube = new THREE.WebGLCubeRenderTarget( 1024 );
                }

                // let mPmremGenerator = new THREE.PMREMGenerator( self.vrScene.renderer );
                // mPmremGenerator.compileEquirectangularShader();    

                let renderer = self.vrScene.renderer;
                // renderer.toneMapping = THREE.ACESFilmicToneMapping;
                if ( THREE.GammaEncoding ){
                    renderer.outputEncoding = THREE.GammaEncoding;
                    // renderer.outputEncoding = THREE.sRGBEncoding;
                    renderer.gammaFactor = 1;
                }
                
                // renderer.outputEncoding = THREE.sRGBEncoding;

                //// 從「 場景資料 」來查看是否有「 behav / behav_reference 」設置錯誤，有的話把 behav_rederence 修改
                // self.checkVRSceneResultBehav();

                //// 每次載入場景，先清除「事件相關」的資料。包含「事件群組」「注視事件」
                self.clearBehavs();
                
                let envTexture = new THREE.TextureLoader().load(
                    scene_skybox_url,
                    function() 
                    {
                        //// for_makarSDK
                        if(window.makarSDK){
                            //// 實在找不到哪裡改的
                            console.log("實在找不到哪裡改的 style.cursor 總之改回來 但是改不回來 @_@")
                            document.body.style.cursor = "default"
                        }

                        let cubeTex = targetCube.fromEquirectangularTexture(renderer, envTexture);
                        self.cubeTex = cubeTex;

                        self.loadSceneCount++;
                        self.loadAssets(); //// for video elements

                        let pAll = self.loadSceneObjects( sceneIndex );                            
                        let scene_id = scenes[sceneIndex].info.id;

                        console.log(' 555555 ', scene_id, sceneSky_info, self.loadSceneCount );

                        let scene_skybox_res_id = scenes[ sceneIndex ].environment.scene_skybox_res_id;
                        if (scene_skybox_res_id != 'camera'){

                            let pSky = self.loadSky( self.vrScene, scene_id, sceneSky_info, self.loadSceneCount)   

                            pSky.then( function( ret ){
                                console.log('VRFunc.js: _loadScene: pSky then ret = ', ret );                            
                            });

                            pAll.push(pSky )
                        }
                        else{
                            if (document.getElementById("sky")){
                                let aSky = document.getElementById("sky");
                                aSky.remove();
                            }
                        }

                       //// 假如此專案的當前場景有「邏輯功能」，加入「處理列表」
                        if ( typeof( scenes[sceneIndex].xml_url ) == 'string' ){
                            //// 下載對應的「邏輯腳本」
                            // let pXML = self.parseLogicXML(projIndex , sceneIndex );
                            let pXML = self.parseLogicXMLBySceneIndex( sceneIndex );
                            
                            pAll.push( pXML );
                        }

                        Promise.all( pAll ).then( function( ret ){

                            console.log('VRFunc.js: _loadScene: pAll then ret = ', ret );

                            //// 記錄一開始手機初始陀螺儀資訊
                            if(self.init_gyro == null){
                                let cameraForGyro = document.getElementById('cameraForGyro');
                                self.init_gyro = cameraForGyro.components["look-controls"].magicWindowAbsoluteEuler.clone();
                            }


                            //20221206-thonsha-add-start
                            if(document.getElementById("sky"))
                                self.onlySkyScene.add(document.getElementById("sky").object3D.clone(true))
                            //20221206-thonsha-add-end

                            // self.vrScene.renderer.shadowMap.needsUpdate = true;
                            self.domElement.loadPage.style.display = "none";
                            self.domElement.homePage.style.display = "none";
                            
                            //// 同時關閉「起始載入畫面動畫」 和 「切換場景載入中動畫」
                            if ( window.homeTickOn ){
                                homeTickOn = false;
                            } else if ( window.makarSDK && window.makarSDK.homeTickOn ){
                                //// for_makarSDK
                                window.makarSDK.homeTickOn = false;
                            } else {
                            }

                            //[start-20230725-howardhsu-modify]//
                            //// 根據 mdn，typeof 回傳 string     
                            //// 因此底下的 if 判斷永遠會通過
                            //// 另外 這個 loadingTickOn 在原本 VRFunc.js 沒有初始化，我先試試把它加進 VRController 的屬性裡，暫時不確定其他js檔是否也有取用它。
                            // if ( typeof( loadingTickOn )  != undefined ){
                                self.loadingTickOn = false;
                            // }
                            //[end-20230725-howardhsu-modify]//

                            self.triggerEnable = true;

                            //// 假如此專案當前場景有「邏輯」，解析並且執行功能
                            // if (self.publishVRProjs.result[projIndex].xml_urls && self.publishVRProjs.result[projIndex].xml_urls[ sceneIndex ] &&
                            //     self.logic.xmlDoc != null 
                            // ) {
                            //     self.logic.parseXML();
                            // }

                            //// 假如此專案的當前場景有「貝茲曲線」，解析並且執行功能
                            if ( scenes[sceneIndex].bezier.length > 0 ){
                                for (let i = 0; i < scenes[sceneIndex].bezier.length;i++){
                                    self.bezierPathAnime( scenes[sceneIndex].bezier[i], sceneIndex );
                                }
                            }

                            //// 假如此專案的當前場景有「場景事件」，解析並且執行功能
                            if (scenes[sceneIndex].behav.length > 0){
                                for (let i = 0; i < scenes[sceneIndex].behav.length; i++){
                                    let behav = scenes[sceneIndex].behav[i];
                                    if (behav.trigger_type == 'Time'){
                                        let timeString = new Date().toTimeString();
                                        let hour = timeString.split(":")[0];
                                        if( behav.trigger_end_time - behav.trigger_start_time >= 0){
                                            if (hour >= behav.trigger_start_time && hour < behav.trigger_end_time){
                                                // self.triggerEvent(behav, false, null);
                                                handleTriggerEvent(behav)
                                            }
                                        }
                                        else{
                                            if (hour >= behav.trigger_start_time || hour < behav.trigger_end_time){
                                                // self.triggerEvent(behav, false, null);
                                                handleTriggerEvent(behav)
                                            }
                                        }
                                        
                                    }
                                    else if(behav.trigger_type == "Gyro"){
                                        let trigger = false;
                                        let tID = setInterval(function(){
                                            let yRotation;
                                            let cameraForGyro = document.getElementById('cameraForGyro');
                                            yRotation = (-(cameraForGyro.components["look-controls"].magicWindowAbsoluteEuler.y-self.init_gyro.y) / Math.PI * 180 ) % 360  ;
                                            if(yRotation < 0) yRotation += 360;

                                            // console.log(yRotation)

                                            let trigger_start_angle = behav.trigger_start_vec.split(",").map( x => Number(x) )[1];
                                            let trigger_end_angle = behav.trigger_end_vec.split(",").map( x => Number(x) )[1];

                                            trigger_start_angle = trigger_start_angle % 360
                                            if(trigger_start_angle < 0) trigger_start_angle += 360;

                                            trigger_end_angle = trigger_end_angle % 360
                                            if(trigger_end_angle < 0) trigger_end_angle += 360;

                                            if (trigger_end_angle - trigger_start_angle > 0){
                                                if (yRotation >= trigger_start_angle && yRotation <= trigger_end_angle){
                                                    if(!trigger){
                                                        trigger = true;
                                                        // self.triggerEvent(behav, false, null);
                                                        handleTriggerEvent(behav)
                                                    }
                                                }
                                                else{
                                                    trigger = false;
                                                }
                                            }
                                            else{
                                                if (yRotation >= trigger_start_angle || yRotation <= trigger_end_angle){
                                                    if(!trigger){
                                                        trigger = true;
                                                        // self.triggerEvent(behav, false, null);
                                                        handleTriggerEvent(behav)
                                                    }
                                                }
                                                else{
                                                    trigger = false;
                                                }
                                            }
                                           
                                        }, 0);

                                        self.intervalList.push(tID);
                                    }
                                }
                                
                                //[start-20240401-renhaohsu-modify]//
                                function handleTriggerEvent(behav){
                                    let gObj;
                                    if ( behav.obj_id ){
                                        gObj = self.getObjectTypeByObj_id( behav.obj_id );
                                        
                                        if (behav.behav_type == "Display"){
                                            console.log("gObj", gObj)

                                            const tempObj = { "behav": [behav] }
                                            self.dealAllGroupHide( tempObj );
                                            
                                            if ( gObj.obj_type == '2d' ){
                                                behav.behav_type = "Display2D"; //// seperate from Display
                                            } 
                                        }
                                    } 

                                    self.triggerEvent(behav, false, null);
    
                                }
                                //[end-20240401-renhaohsu-modify]//
                            }
                        
                            if ( self.logic &&  self.scenesData.scenes[ sceneIndex ].xml_url ){
                                // console.log("self.scenesData.scenes[ sceneIndex ].xml_url", self.scenesData.scenes[ sceneIndex ].xml_url)

                                //// 這句是 for_makarSDK (SDK將domElement封裝起來, logicSystem會因此拿不到gsapEmpty)
                                window.gsapEmpty = self.domElement.gsapEmpty

                                self.logic.parseXML();
                            }    

                            //// 載入場景完成後，解析一下場景的「事件 / behav」跟「事件參照 behav_reference 」是否有錯誤。
                            // self.setupSceneBehav();

                            
                            
                            //// 載入場景完成，解析物件所佔範圍
                            setTimeout( function(){
                                self.calcSceneArea();
                            }, 1 )
                            
                            //// 載入場景完成後，判斷當前 UI 是否顯示，顯示的話執行隱藏
                            if ( parent && parent.projMenuGroup && parent.controlGroup && parent.pictureBackground && parent.projectUIController && 
                                typeof(parent.projectUIController.showUI) == 'function' && typeof( parent.projectUIController.hideUI ) == 'function' 
                            ){
                                if ( parent.projectUIController.status == -1 ){
                                    parent.projectUIController.showUI();
                                }
                            }

                        }).then( () => {

                            //[start-20240614-renhaohsu-add]//
                            //// 20240614 再次為了safari重複把所有影片都靜音並播放
                            if (window.Browser){
                                if (window.Browser.name == undefined || window.Browser.name == "safari" ){
                                // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                    
                                    //// 發現safari的muted + play()沒有效果 乾脆把所有影片 靜音並播放  (若以後editor有設定初始播不播放 記得改這裡)
                                    self.mute3dVideos(true)
                                    self.mute2dVideos(true)
                                    
                                    //// 挑一隻可見的影片解除靜音
                                    self.UnMutedAndPlayAllVisibleVideo();
                                } else {
                                    // console.log("載完了")
                                }
                            } 
                            //[end-20240614-renhaohsu-add]//

                            //// v3.5.0.0 為 "點擊物件開啟"的quiz 的啟動物件 加上 behav
                            self.addBehavToQuizTriggerObj()
                            //// v3.5.0.0 如果有quiz是"直接顯示" 則顯示 html UI (startQuiz)
                            self.checkIfQuizOpenDirectly()                            
                            
                            
                            //// for_makarSDK : 場景物件載入完成：建立並觸發CustomEvent (for SDK)
                            let vrDiv = document.getElementById("vrDiv");

                            //// for_makarSDK
                            console.log("for_makarSDK vrDiv", vrDiv)
                            if(window.makarSDK && window.makarSDK.vrDiv){
                                console.log("for_makarSDK vrDiv", vrDiv)
                                vrDiv = window.makarSDK.vrDiv
                            }
                            console.log("%c vrScene=", 'color: pink', vrDiv)
                            //// 準備 js custom event 
                            const vrSceneObjsLoaded = new CustomEvent("vrSceneObjsLoaded", {
                                detail: {
                                    name: "vrSceneObjsLoaded",
                                    sceneId: self.scenesData.scenes[self.currentSceneIndex].info.id,
                                    scene: self.vrScene,
                                    clock: self.clock
                                },
                            });
                            vrDiv.dispatchEvent(vrSceneObjsLoaded);

                        }).catch((err) => {
                            console.warn('VRController.js _loadScene: loadScene Error, or quiz error:', err)
                        });


                    }
                );
            });
            

            //[start-20231013-howardhsu-add]//
            ///// 載入相機完成之後，設定對應 物件放大比例
            let  sr2D = self.get2DScaleRatio();
            self.set2DScaleRatio( sr2D ) ;
            //[end-20231013-howardhsu-add]//

        }
    }        

    //// 處理「觸發事件中帶有群組部份」。
    setBehavsGroup( scene_behavs ){
        
        let self = this;

        scene_behavs.forEach( behav =>{

            if ( behav.group != '' && Number.isFinite( Number( behav.group ) ) ){
                
                if ( self.groupDict[ behav.group ] ){

                    let groupObj =  self.groupDict[ behav.group ];
                    groupObj.objs.push( behav );
                    
                }
            }
        });

    }



    //// 處理 場景物件 的「事件相關」，包含「從場景事件放入物件中」、「設置物件的參考事件」、「設置群組相關」
    //// 「設置特定事件：注視等等」
    setObjBehav( scene_obj , scene_behavs ){

        //// 假如已經載入過，不再載入
        if ( scene_obj.behav && Array.isArray(scene_obj.behav) && scene_obj.behav.length > 0){

        }else{
            scene_behavs.forEach( behav => {    
                
                //// 紀錄「觸發事件的物件」
                if( behav.trigger_obj_id && behav.trigger_obj_id == scene_obj.generalAttr.obj_id ){

                    //// 假如「觸發物件」沒有放過「事件陣列」，新創陣列。假如有，添加進入頁面
                    if(scene_obj.behav && Array.isArray(scene_obj.behav) && scene_obj.behav.length > 0){
                        scene_obj.behav.push(behav)
                    } else {
                        scene_obj.behav = [behav]
                    }
                }
            })
        }

        //// 紀錄「觸發事件的要顯示物件」的「觸發事件參考」
        if ( scene_obj.behav_reference && Array.isArray(scene_obj.behav_reference) && scene_obj.behav_reference.length > 0 ){

        }else{

            scene_behavs.forEach( behav => {
                //// 紀錄「觸發事件的要顯示物件」的「觸發事件參考」
                if( behav.obj_id && behav.obj_id == scene_obj.generalAttr.obj_id ){

                    /* 
                        所有事件：
                        1. 外部相關：「撥打電話」「寄送信件」「開啟網頁」
                        2. 顯示相關：「圖片」「影片」「模型」「文字」「燈光」
                        3. 媒體相關：「影片」「聲音」
                        4. 動畫相關：「切換模型動畫」
                        5. 朗讀文字：「朗讀文字」
                        6. 去背相關：「影片去背」「圖片去背」

                        需要紀錄 「 事件參考 」 _behav_reference_ 的有「顯示相關」「媒體相關」
                        「顯示物件」，「交互切換」/「顯示」/「關閉」： [Display], [Switch]/[Show]/[Hide]
                        「播放媒體」，「交互切換」/「顯示」/「關閉」： [Media], [SwitchStop]/[SwitchPause]/[Play][Stop]

                    */
                    
                    if ( behav.behav_type == 'Display' ||  behav.behav_type == 'Media' ){

                        if ( scene_obj.behav_reference && Array.isArray( scene_obj.behav_reference ) && scene_obj.behav_reference.length > 0 ){

                            scene_obj.behav_reference.push({
                                behav_type: behav.behav_type ,
                                switch_type: behav.switch_type ,
                                trigger_obj_id: behav.trigger_obj_id ,
                            });

                        }else{

                            scene_obj.behav_reference = [{
                                behav_type: behav.behav_type ,
                                switch_type: behav.switch_type ,
                                trigger_obj_id: behav.trigger_obj_id ,
                            }];

                        }
                    }
                }
            })
        }



    }


    //[start-20231206-howardhsu-modify]//
    addBehavToQuizTriggerObj(){        
        //// 載入場景完成後，掃一遍 quiz 的啟動物件，給它加上behav
        const arr_trigger_ids = window.aQuizVR.triggers
        if(!Array.isArray(arr_trigger_ids)) return;
        if(arr_trigger_ids.length == 0) return;
        
        // const objs = this.scenesData.scenes[this.sceneIndex].objs

        //// 為了方便操作，取得記錄了全部 { 有設定啟動物件的quiz_id , trigger_id } 的陣列
        const quizIdWithTriggers = window.aQuizVR.quizIdWithTriggers

        //// 在每個 Quiz啟動物件 的behav，增加 "ShowQuiz"，記錄它對應的 Quiz物件id
        quizIdWithTriggers.forEach( q_t => {

            //// 從 3D物件裡尋找啟動物件
            let quizTrigger = document.getElementById(q_t.trigger_id)   
            // quizTrigger.className = "clickable"
            // console.warn("VRController.js: _addBehavToQuizTriggerObj get quizTrigger=", quizTrigger)
            
            //// 從 2D物件裡尋找啟動物件
            let quizTriggerObj2D = this.makarObjects2D.find(item=>item.obj_id == q_t.trigger_id)
            const tempBehav = { 
                obj_id: q_t.quiz_id, 
                played: false, 
                behav_type: 'ShowQuiz', 
                force_login: q_t.force_login, 
                allow_retry: q_t.allow_retry 
            }
            // console.warn("VRController.js: _addBehavToQuizTriggerObj get quizTriggerObj2D=", quizTriggerObj2D)
            
            if (quizTrigger){	
                quizTrigger.className = "clickable"

                let quizTriggerObj3D = quizTrigger.object3D       
                
                if ( quizTriggerObj3D.behav && Array.isArray(quizTriggerObj3D.behav) ) {  
                    //// 先確認: 該 quiz 和 與它一對一對應的啟動物件 還沒加過 啟動quiz的behav
                    if( !quizTriggerObj3D.behav.find(b => b.obj_id == q_t.quiz_id)){
                        quizTriggerObj3D.behav.push( tempBehav )
                    }
                } else {
                    quizTriggerObj3D.behav = [ tempBehav ]
                }	
                
            } else if (quizTriggerObj2D){
            
                if (quizTriggerObj2D.behav) {  
                    quizTriggerObj2D.behav.push( tempBehav )
                } else {
                    quizTriggerObj2D.behav = [ tempBehav ]
                }		
                
            } else {
                console.log("VRController.js _loadScene: can not find quiz's trigger", q_t.trigger_id, " performance.now()=", performance.now(), self.makarObjects2D.slice() )
            }                 
        })
    }

    //// for multiple quizzes:  if there exist any Quiz with trigger_type=="Directly", show the UI (startQuiz).
    checkIfQuizOpenDirectly(){
        // let startQuiz = document.getElementById("startQuiz");		
        const startQuiz = this.domElement.startQuiz
        if( window.aQuizVR.quizIdOpenDirectly.length >= 1 ){	
            QuizStartContent.textContent = window.aQuizVR.quizIdOpenDirectly[0].quizUiTextContext
            startQuiz.style.display = "block"
        } else {								
            startQuiz.style.display = "none"
        }
    }
    //[end-20231206-howardhsu-modify]//

    // editorVersionControllObjs(editor_version , projIndex , sceneIndex ) {
    editorVersionControllObjs(editor_version , sceneIndex ) {
        let self = this
        let scene_objs;
        
        if ( editor_version.v0 == 3 && editor_version.v1 >=5 ){
            
            scene_objs = self.scenesData.scenes[sceneIndex].objs;

        }else{
            console.log('VRController.js: version error ' , editor_version );
        }
        
        
        return scene_objs;
    }

    ////// load all object in the scene
    loadSceneObjects( sceneIndex ) {

        let self = this

        let userProjResDict = self.userProjResDict;
        let userOnlineResDict = self.userOnlineResDict;

        if ( typeof( userProjResDict ) == 'object' && !userProjResDict){
            console.log("%cVRFunc.js: _loadSceneObjects: error userProjResDict not exist, return -1", "color:red");
            return [];
        }

        let scene_objs = [];

        //// 取得專案版本
        let editor_version = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getProjDataEditorVer( self.currentProjData );


        //// 版本控制，3.2.0 版本以上會有 相機設定參數在 scenes 層級，也在此函式內設定
        scene_objs = self.editorVersionControllObjs(editor_version, sceneIndex); 
        

        if (!Array.isArray(scene_objs)) return [];


        //// v3.5.0.0 新增
        //// 取得「所有事件」
        let scene_behavs = self.scenesData.scenes[ sceneIndex ].behav

        //// 處理「 事件 群組物件 」
        self.setBehavsGroup( scene_behavs );



        //// 所有物件都要作 「 完成判斷 」各自設立 promise
        let pObjs = [];
        for (let i = 0; i < scene_objs.length ; i++  ){
            
            //// 為每個物件設定 position、quaternion、scale
            let objTranform = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getObjTransform( self.scenesData , scene_objs[i] );
            let position = objTranform.position;
            let rotation = objTranform.rotation;
            let scale = objTranform.scale;
            let quaternion = objTranform.quaternion;
            
            // let scene_behavs = self.VRSceneResult[self.projectIdx].scenes[self.sceneIndex].behav;
            let scene_obj = scene_objs[i];

            //// 處理 場景物件 的「事件相關」，包含「從場景事件放入物件中」、「設置物件的參考事件」、「設置群組相關」
            //// 「設置特定事件：注視等等」
            self.setObjBehav( scene_obj , scene_behavs );
            
            //[start-20230809-howardhsu-add]//
            //// res_url and main_type no longer exist in ver. 3.5's VRSceneResult
            //// get res_url, main_type from userProjResDict or userOnlineResDict
            if( userProjResDict || typeof( userOnlineResDict ) == 'object' ){  

                

                //// get main_type by user resource 
                if( userProjResDict[scene_objs[i].res_id] && userProjResDict[scene_objs[i].res_id].main_type ){
                    scene_objs[i].main_type = userProjResDict[scene_objs[i].res_id].main_type
                } else if( userOnlineResDict[scene_objs[i].res_id] && userOnlineResDict[scene_objs[i].res_id].res_url) {
                    scene_objs[i].main_type = userOnlineResDict[scene_objs[i].res_id].main_type
                } else {
                    //// userProjResDict usually does not contain Light, Text objects. Recognize them with res_id:
                    //// in ver. 3.5: if main_type does not exist, could be default objects

                    console.log(' before _checkDefaultObj: ', i , scene_objs[i].main_type , scene_objs[i].res_id );

                    (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_1__.checkDefaultObj)( scene_objs[i] );

                    console.log(' after _checkDefaultObj: ', i , scene_objs[i].main_type , scene_objs[i].res_id );

                }

                //// get sub_type by user resource
                if( userProjResDict[scene_objs[i].res_id] && userProjResDict[scene_objs[i].res_id].sub_type ){
                    scene_objs[i].sub_type = userProjResDict[scene_objs[i].res_id].sub_type
                } else if( userOnlineResDict[scene_objs[i].res_id] && userOnlineResDict[scene_objs[i].res_id].res_url) {
                    scene_objs[i].sub_type = userOnlineResDict[scene_objs[i].res_id].sub_type
                } else {
                    //// console.log("sub_type does not exist in user resource, deal with it later (in the switch block right below.)")
                }

                //// get res_url by user resource 
                if( userProjResDict[scene_objs[i].res_id] && userProjResDict[scene_objs[i].res_id].res_url ){
                    scene_objs[i].res_url = userProjResDict[scene_objs[i].res_id].res_url
                } else if( userOnlineResDict[scene_objs[i].res_id] && userOnlineResDict[scene_objs[i].res_id].res_url) {
                    scene_objs[i].res_url = userOnlineResDict[scene_objs[i].res_id].res_url
                } else {
                    console.log("VRFunc.js: _loadSceneObjects: res_url does not exist. scene_obj=", scene_objs[i])
                }     

                // get default_shader_name by user resource
                if( userProjResDict[ scene_obj.res_id] && userProjResDict[ scene_obj.res_id ].default_shader_name ){
                    scene_obj.default_shader_name = userProjResDict[ scene_obj.res_id ].default_shader_name
                } else if( userOnlineResDict[ scene_obj.res_id ] && userOnlineResDict[ scene_obj.res_id ].default_shader_name) {
                    scene_obj.default_shader_name = userOnlineResDict[ scene_obj.res_id ].default_shader_name
                } else {
                    console.log("VRFunc.js: default_shader_name does not exist. obj=", scene_obj )
                }


            } else {
                console.log("VRFunc.js: _loadSceneObjects: userProjResDict or userOnlineResDict does not exist. scene_obj=", scene_objs[i])    
            }
            //[end-20230809-howardhsu-add]//

            let obj_type = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getObjObjType( self.scenesData , scene_obj )

            switch( scene_objs[i].main_type ){  
                case "camera":
                    
                    //// ver3.5 測試相機位置正確 但推測如果位置能動 以下可能會出現些微差異 等有更多測試資料時要再確認

                    let camera_cursor = document.getElementById( "camera_cursor" );
                    
                    var setupCamera = function(){
                        if (!camera_cursor.hasLoaded){
                            setTimeout(setupCamera, 100);
                            console.log("VRFunc.js: _loadSceneObjects: camera: not loaded, wait" );							
                        }else{

                            //// v3.5.0.0 後會有「相機物件」，預計可以輸入「位置」「旋轉」「fov」
                            
                            console.log("VRFunc.js: _loadSceneObjects: camera: _objTranform ", objTranform );

                            // rotation.multiply( new THREE.Vector3(-1,-1,0) ).add( new THREE.Vector3(0, 180, 0) );
                            
                            rotation.multiply( new THREE.Vector3( -1 , -1 , 0 ) ).add( new THREE.Vector3( 0 , Math.PI , 0 ) ); 
                            
                            // camera_cursor.setAttribute("position", position ); ////// it is work
                            

                            let fov = 80;
                            if ( scene_obj && scene_obj.typeAttr && scene_obj.typeAttr.fov ){
                                fov = scene_obj.typeAttr.fov ; 
                            }

                            //// fov 相關資料，要在 「 VR觀看相機 載入完成」後才可設定
                            let aCamera = document.getElementById('aCamera');
                            let oCamera = document.getElementById('oCamera');

                            
                            function lookContorlsLoaded(){

                                let tID = setInterval( function(){
                                    let aCameraObject = aCamera.getObject3D('camera');
                                    let oCameraObject = oCamera.getObject3D('camera');
                                    if ( aCameraObject && aCameraObject.type == 'PerspectiveCamera' &&
                                        oCameraObject && oCameraObject.type == 'PerspectiveCamera'
                                    ){

                                        position.multiply( new THREE.Vector3( -1 , 1 , 1 )  );
                                        aCamera.object3D.position.copy( position );

                                        //// 設定 「VR 觀看相機」 FOV
                                        aCamera.setAttribute( 'camera', 'fov', fov );

                                        aCameraObject.fov = fov;
                                        oCameraObject.fov = fov;
                                        aCameraObject.updateProjectionMatrix();
                                        oCameraObject.updateProjectionMatrix();


                                        clearInterval( tID );
                                    }
                                }, 100 );

                                //// 設定 「VR 觀看相機」 位置 旋轉
                                // aCamera.components["look-controls"].yawObject.rotation.y = rotation.y/180*Math.PI;
                                // aCamera.components["look-controls"].pitchObject.rotation.x = rotation.x/180*Math.PI;

                                aCamera.components["look-controls"].yawObject.rotation.y = rotation.y ;
                                aCamera.components["look-controls"].pitchObject.rotation.x = rotation.x ;


                                aCamera.removeEventListener("look-controls-loaded", lookContorlsLoaded);
                            }

                            if ( aCamera && aCamera.components && aCamera.components["look-controls"] &&
                                aCamera.components["look-controls"].yawObject && aCamera.components["look-controls"].pitchObject )
                            {
                                lookContorlsLoaded();
                            }else{
                                aCamera.addEventListener("look-controls-loaded" , lookContorlsLoaded );
                            }
                            



                        }								
                    } 

                    setTimeout(setupCamera, 10);

                    // setTransform( camera_cursor, position, rotation, scale );
                    
                    break;
                    
                case "image":
                    console.log("VRController.js: _loadSceneObjects: image: ", i, scene_objs[i] );

                	//[start-20231110-howardhsu-modify]//
                    let pTexture;
                    if ( obj_type == '3d' ){
                        pTexture = self.loadTexture( scene_obj , position, rotation, scale ) ;
                    } else if ( obj_type == '2d' ){
                        pTexture = self.loadTexture2D( scene_obj, i, scene_objs.length, position, rotation, scale )
                    } else {
                        console.log("VRController.js: _loadSceneObjects: image obj_type=", obj_type)
                    }
                    pObjs.push( pTexture );

                    break;

                    
                //20191204-start-thonsha-add
                case "text":
                    console.log("VRController.js: _loadText: text: ", i, scene_objs[i] );
                    
                    let pText;
                    if ( obj_type == '3d' ){
                        pText = self.loadText( scene_objs[i] , position, rotation, scale )
                    } else if ( obj_type == '2d' ){
                        pText = self.loadText2D( scene_obj, i, scene_objs.length, position, rotation, scale )    
                    } else {
                        console.log("VRController.js: _loadSceneObjects: text obj_type=", obj_type)
                    }                    
                    pObjs.push( pText );

                    break;

                //20191204-end-thonsha-add
                
                //20191105-start-thonsha-add
                case "audio":

                    //[start-20230802-howardhsu-add]//  
                    if( scene_objs[i].sub_type == undefined ){                                        
                        let getSubType = scene_objs[i].res_url.split('.')
                        let subType = getSubType[getSubType.length-1]
                        scene_objs[i].sub_type = subType.toLowerCase();
                    } else {
                        // console.log("VRController.js: _loadSceneObjects: audio sub_type=", scene_objs[i].sub_type)
                    }                    
                    //[end-20230802-howardhsu-add]//

                    if ((scene_objs[i].sub_type == "mp3" || scene_objs[i].sub_type == "wav" || scene_objs[i].sub_type == "ogg" ) && scene_objs[i].res_url){
                        let pAudio = self.loadAudio( scene_objs[i] , position, rotation, scale );
                        pObjs.push( pAudio );
                    }

                    break;

                //20191105-end-thonsha-add

                case "video":

                    //[start-20230802-howardhsu-add]//  
                    if( scene_objs[i].sub_type == undefined ){                                        
                        let getSubType = scene_objs[i].res_url.split('.')
                        let subType = getSubType[getSubType.length-1]
                        scene_objs[i].sub_type = subType.toLowerCase();
                    } else {
                        // console.log("VRController.js: _loadSceneObjects: video sub_type=", scene_objs[i].sub_type )
                    }
                    //[end-20230802-howardhsu-add]//

                    if ( scene_objs[i].sub_type == 'mp4' ){
                        let pVideo;
                        if ( obj_type == '3d' ){
                            pVideo = self.loadVideo( scene_objs[i] , position, rotation, scale );
                        } else if ( obj_type == '2d' ){
                            pVideo = self.loadVideo2D( scene_obj, i, scene_objs.length, position, rotation, scale )
                        } else {
                            console.log("VRController.js: _loadSceneObjects: video obj_type=", obj_type)
                        }
                        pObjs.push( pVideo );
                    } else if ( scene_objs[i].sub_type == "youtube" ){
                        console.log("makar webXR currently does not support yt video, please wait until next update")

                        if ( obj_type == '3d' ){
                            self.loadYouTubeNotSupport(scene_obj, i, scene_objs.length, position, rotation, scale)
                        } else if ( obj_type == '2d' ){
                            self.loadYouTubeNotSupport2D(scene_obj, i, scene_objs.length, position, rotation, scale)
                        } else {
                            console.log("VRController.js: _loadSceneObjects: yt video obj_type=", obj_type)
                        }
                    }

                    break;

                case "model":
                    
                    if ( scene_obj.res_id == "WebView"){
                        console.log("webview obj", scene_obj)
                        if(obj_type == '3d'){
                            // self.loadWebViewNotSupport(scene_objs[i], position, rotation, scale , self.cubeTex );
                            self.loadWebViewNotSupport(scene_obj, i, scene_objs.length, position, rotation, scale , self.cubeTex );
                        } else if(obj_type == '2d'){
                            self.loadWebViewNotSupport2D(scene_obj, i, scene_objs.length, position, rotation, scale , self.cubeTex );
                        } else {

                        }

                    } else if ( obj_type == '3d' ){
                        let pModel = self.loadGLTFModel(scene_objs[i], position, rotation, scale , self.cubeTex );
                        pObjs.push( pModel );
                    }

                    break;

                case "curve":

                    if (obj_type == '3d'){
                        let pCurve = self.loadCurve(scene_obj, position, rotation, scale);
                        pObjs.push( pCurve );
                    }

                    break;
                    
                case "light":
                        console.log("VRController.js: _loadSceneObjects: light", i, scene_objs[i]  );                        
                        self.loadLight(scene_objs[i], position, rotation, scale);
                        break;
                    
                case "empty":
                    //// 之後空物件會有其他用途，目前大多
                    switch (scene_objs[i].sub_type){        
                        case "quiz":     
                            
                            //[start-20231207-howardhsu-modify]//	
                            //// 當user沒有在編輯器設定題目順序時 直接不載入 也不顯示html ui
                            if(!scene_objs[i].typeAttr.module.display_order_list){
                                console.log("%c _vrController _loadMakarARScene: user has not set display_order_list. obj.typeAttr.module=", "color:Salmon", scene_objs[i].typeAttr.module)
                                break;
                            }
                            
                            
                            //// 開發中，檢查內容，填值 (確認有填則移除) : editor在多選按鈕的obj_parent_id沒填值 幫補上
                            let question_list = scene_objs[i].typeAttr.module.question_list
                            question_list.forEach( q => {
                                let btnJson = q.options_json.find( o => o.res_id == "Button") 
                                if( btnJson ){
                                    if( !btnJson.generalAttr.obj_parent_id ){
                                        btnJson.generalAttr.obj_parent_id = scene_objs[i].generalAttr.obj_id
                                    }                                            
                                }
                            })
                            

                            //// v3.5.0.0 的 quiz 在 "實際要顯示" 的時候才加入 makarObjects
                            const transformData = { "position": position, "rotation": rotation, "scale": scale }

                            //// 其實這些資料也能從 VRController 之外的地方取得，但為了方便控管，暫時先用參數傳遞
                            const proj_id = self.currentProjData.proj_id;
                            const login_id = localStorage.getItem("MakarUserID") 
                            
                            // const startQuiz = document.getElementById("startQuiz");	
                            const startQuiz = self.domElement.startQuiz
                            const QuizStartButton = document.getElementById("QuizStartButton");
                            const QuizStartContent = document.getElementById("QuizStartContent");
                            const UIs = { "startQuiz": startQuiz, "QuizStartButton": QuizStartButton, "QuizStartContent": QuizStartContent }
                            
                            //// 依照 force_login, allow_retry, trigger_type, 使用者是否已登入 來決定是否顯示quiz。  ( 這裡只載入"Directly"(直接顯示) 的quiz，)
                            const pQuizCheckRecords = window.aQuizVR.loadQuiz( scene_objs[i], transformData, proj_id, login_id, UIs, self.worldContent, self.languageType)

                            //// 查找後端DB or 查indexedDB 的 Promise 加入倒 pObjs，讓之後能在 pAll.then 給Quiz啟動物件加上behav & 顯示html UI
                            pObjs.concat(pQuizCheckRecords)                        
                            //[end-20231207-howardhsu-modify]//	
                            
                            console.log("VRController.js: _loadSceneObjects: empty, quiz ", i, scene_objs[i] );
                            break;

                        default:
                            console.log("VRController.js: _loadSceneObjects: empty object default, ", i, scene_objs[i] );
                    }
                    break
                
                default:
                    console.log("VRController.js: _loadSceneObjects: default", i, scene_objs[i] );
                    
            }

        }


        return pObjs;
        // console.log("VRFunc.js: _loadSceneObjects: done, self.makarObjects ", self.makarObjects.length );
    }

    checkAnimation(obj, dt) {
        if (obj.mixer){
            obj.mixer.update(dt);
        }
        if (obj.animationSlices ){
            if (obj.animationSlices[0].index){
                if (obj.animationSlices[obj.animationSlices[0].index]){
                    if (obj.mixer._actions[0].time > obj.animationSlices[obj.animationSlices[0].index].timeEnd ||
                        obj.mixer._actions[0].time < obj.animationSlices[obj.animationSlices[0].index].timeStart){
                        obj.mixer._actions[0].time = obj.animationSlices[obj.animationSlices[0].index].timeStart;
                    }
                }
            }
        }
    }

    //[start-20200617-fei0097-add]//
    showObjectEvent(target, reset, switch_type) {

        let self = this;
        if (!target){
            console.log('VRFunc.js: _showObjectEvent: target not exist', target);
            return;
        }

        if(switch_type == "Switch"){
            if (target.getAttribute("visible")){
                hideObject();
            }
            else{
                showObject();
            }
        }
        else if(switch_type == "Show"){
            showObject();
        }
        else if(switch_type == "Hide"){
            hideObject();
        }
        

        function hideObject(){
            target.setAttribute("visible",false);
            target.setAttribute('class', "unclickable" );
            if(target.localName=="a-video"){
                let id = target.getAttribute("src");
                if(id!=undefined){
                    id = id.split("#").pop();
                    let v = document.getElementById(id);
                    if (v instanceof HTMLElement){
                        v.pause();
                    }
                }
            }

            
            //// iOS 中，同時只能存在一隻「有聲音影片」，所以需要判定。
            //// 不論是要開啟還是關閉物件，都查找整個場景一遍中所有影片是否有「可見的」，挑選一隻影片為「有聲音」，其他為「靜音」
            if (window.Browser){
                if (window.Browser.name == undefined || window.Browser.name == "safari" ){
                // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                    
                    self.UnMutedAndPlayAllVisibleVideo( self.safariUnMutedVideo );
                }
            }


            target.object3D.traverse(function(child){
                if (child.type=="Group"){
                    child.el.setAttribute('class', "unclickable" );
                    if(child.el.localName=="a-video"){

                        //// 假如影片物件有「邏輯」，不予以控制
                        if ( child.el.blockly  ){
                            console.log('VRFunc.js: _showObjectEvent: set false, video blockly: do nothing ', child );
                        } else {

                            let id = child.el.getAttribute("src");
                            if(id!=undefined){
                                id = id.split("#").pop();
                                let v = document.getElementById(id);
                                if (v instanceof HTMLElement){
                                    v.pause();
                                }
                            }
                        }
                    }
                    if(child.makarObject && child.el.getAttribute("sound")){
                        // child.el.components.sound.stopSound();

                        if ( child.el.blockly ){
                            console.log('VRFunc.js: _showObjectEvent: set false, audio blockly: do nothing ', child );
                        } else {

                            if (child.behav_reference){
                                child.el.setAttribute("visible", false);
                            }
                            for(let i in child.children ){
                                if ( child.children[i].children[0].type == "Audio" ){					
                                    if (child.children[i].children[0].isPlaying == true ){
                                        child.el.components.sound.stopSound();
                                        
                                        //// 手動觸發 聲音播放完畢的event (如果此物件有被邏輯"播放聲音物件等待直到結束" 讓它底下的block繼續執行下去)
                                        let event = new Event('sound-ended');
                                        child.el.dispatchEvent(event);
                                    }
                                }
                            }
                            
                        }

                    }
                }
            });
            if (reset){
                target.object3D.traverse(function(child){
                    if (child.type=="Group"){
                        child.el.setAttribute("visible",false);
                        child.el.setAttribute('class', "unclickable" );
                    }
                });
            }
        }

        function showObject(){
            //// iOS 中，同時只能存在一隻「有聲音影片」，所以需要判定。
            //// 不論是要開啟還是關閉物件，都查找整個場景一遍中所有影片是否有「可見的」，挑選一隻影片為「有聲音」，其他為「靜音」
            if (window.Browser){
                if (window.Browser.name == undefined || window.Browser.name == "safari" ){
                // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                    self.UnMutedAndPlayAllVisibleVideo( target );
                }
            }
            console.log('target 檢查是否有2D 2D影片是否靜音', )
            target.setAttribute("visible",true);
            let id = target.getAttribute("src");
            if(id!=undefined){
                id = id.split("#").pop();
                let v = document.getElementById(id);
                if (v instanceof HTMLElement){
                    // v.load();
                    v.play();
                }
            }
            if(target.object3D.behav){
                target.setAttribute('class', "clickable" );
            }
            target.object3D.traverse(function(child){
                if (child.type=="Group"){
                    if (child.el.getAttribute("visible")){
                        if(child.el.object3D.behav){
                            child.el.setAttribute('class', "clickable" );
                        }
                        if(child.el.localName=="a-video"){

                            if ( child.el.blockly  ){
                                console.log('VRFunc.js: _showObjectEvent: set true, video blockly: do nothing  ', child );
                            } else {
                                let id = child.el.getAttribute("src");
                                if(id!=undefined){
                                    id = id.split("#").pop();
                                    let v = document.getElementById(id);
                                    if (v instanceof HTMLElement){
                                        v.play();
                                    }
                                }

                            }

                            
                        }
                        if(child.makarObject && child.el.getAttribute("sound")){
                            
                            if ( child.el.blockly ){
                                console.log('VRFunc.js: _showObjectEvent: set true, audio blockly: do nothing ', child );
                            } else {
                                child.el.components.sound.playSound();
                            }

                        }
                    }
                }
            });
        }

    }

    hideGroupObjectEvent(target, isBehavRederenceTpyeDisplay=false) {

        if ( !target ){
            console.log('VRFunc.js: _hideGroupObjectEvent: target not exist ', target );
            return;
        }

        if (target.getAttribute("visible")){
            target.setAttribute("visible",false);
            target.setAttribute('class', "unclickable" );
            target.object3D.traverse(function(child){
                if (child.type=="Group"){
                    child.el.setAttribute('class', "unclickable" );
                    if(child.el.localName=="a-video"){
                        let id = child.el.getAttribute("src");
                        if(id!=undefined){
                            id = id.split("#").pop();
                            let v = document.getElementById(id);
                            if (v instanceof HTMLElement){
                                v.pause();
                            }
                        }
                    }
                    if(child.makarObject && child.el.getAttribute("sound")){
                        //// 假如此聲音物件有掛 behav_reference[ PlayMusic ], 則將visible 改為 false ，只有觸發 PlayMusic 才能再次開啟
                        if (child.behav_reference || isBehavRederenceTpyeDisplay){
                            child.el.setAttribute("visible", false);
                        }
                        //// 假如聲音物件本來在播放，則停止。因應在手機上假如在沒播放的狀況下呼叫 stop，會報錯誤
                        for(let i in child.children ){
                            if ( child.children[i].children[0].type == "Audio" ){					
                                if (child.children[i].children[0].isPlaying == true ){
                                    child.el.components.sound.stopSound();
                                    
                                    //// 手動觸發 聲音播放完畢的event (如果此物件有被邏輯"播放聲音物件等待直到結束" 讓它底下的block繼續執行下去)
                                    let event = new Event('sound-ended');
                                    child.el.dispatchEvent(event);
                                }
                            }
                        }
                    }
                }
            });
        }
    }

    //// 清除「場景物件的事件資料」，因為 VR 會「跳整場景」，流程上會清除所有場景物件，再載入新場景物件。所以在「載入前」，要清除就場景的事件相關
    //// 包含 「事件群組」「注視事件」
    clearBehavs() {
        
        let self = this;

        //// 「群組事件」
        for ( let i in self.groupDict ){
            if ( Array.isArray( self.groupDict[i].objs ) ){
                self.groupDict[i].objs.length = 0;

            }
        }

        // //// 「注視事件」
        // self.lookAtObjectList.length = 0;
        // self.lookAtObjectList = [];
        
        for ( let i in self.lookAtTimelineDict ){
            if ( typeof( self.lookAtTimelineDict[ i ].pause ) == 'function' && typeof( self.lookAtTimelineDict[ i ].kill ) == 'function' ){
                self.lookAtTimelineDict[ i ].pause(); 
                self.lookAtTimelineDict[ i ].kill(); 
            }
        }

        self.lookAtTimelineDict = {};

    }

    //// 檢查場景中物件的「 事件 / behav 」與「 事件備註 / behav_reference 」 的狀況，因為目前編輯器有出現過錯誤
    //// 目前完全不參考「 儲存的 behav_reference 資料 」，都從「 behav 」來自製 「 behav_reference 」 
    //[20231109-renhaohsu-comment]//    v3.5 已不使用 詳見 setObjBehav  
    checkVRSceneResultBehav() {
        let self = this;

        //// 專案id 錯誤
        if ( ! Number.isFinite( Number( self.projectIdx ) )   ){
            console.error( ' _checkVRSceneResultBehav: projectIdx error ', self.projectIdx );
            return;
        }
        //// 專案資料內容錯誤
        if ( !Array.isArray( self.VRSceneResult ) ||  !self.VRSceneResult[ self.projectIdx ] || !Number.isInteger( Number( self.sceneIndex ) )  ){
            console.error( ' _checkVRSceneResultBehav: _VRSceneResult error ', self.projectIdx , self.sceneIndex , self.VRSceneResult);
            return;
        }

        if ( !self.VRSceneResult[ self.projectIdx ].editor_ver || typeof( self.VRSceneResult[ self.projectIdx ].editor_ver ) != 'string' ){
            console.error( ' _checkVRSceneResultBehav: editor_ver error ', self.VRSceneResult[ self.projectIdx] );
            return;
        }

        let editor_version = self.VRSceneResult[ self.projectIdx].editor_ver.split(".");
        let scene_objs = self.editorVersionControllObjs( editor_version, self.projectIdx , self.sceneIndex );

        console.log('_checkVRSceneResultBehav: _scene_objs ', scene_objs );

        if ( ! Array.isArray( scene_objs ) ){
            return;
        }

        //// 檢查「 behav / behav_reference 」

        ///// 建制列表
        let behavAll = {};
        let behavRefAll = {}; //// 這部份預計拿來對答案用
        let sceneObjDict = {};

        //[start-20230807-howardhsu-add]//
        //// ver. 3.5 的 VRSceneResult 的 behav 已移到與 objs 同層
        self.VRSceneResult[self.projectIdx].scenes[self.sceneIndex].behav.forEach(( behav )=>{
            if ( behavAll[ behav.trigger_obj_id ] && Array.isArray( behavAll[ behav.trigger_obj_id ] ) ){
                behavAll[ behav.trigger_obj_id ].push([behav]);
            }else if ( behavAll ){
                behavAll[ behav.trigger_obj_id ] = [behav]
            }else{
                console.error('_checkVRSceneResultBehav: cant get behavAll ', behavAll );
            }
        })
        //[end-20230807-howardhsu-add]//

        for ( let i = 0, len = scene_objs.length; i < len; i++ ){
            let sceneObj = scene_objs[i];

            //[start-20230807-howardhsu-modify]//
            //// ver. 3.5 的 VRSceneResult 的 behav 已移到與 objs 同層
            // if ( sceneObj.behav ){
            //     behavAll[ sceneObj.obj_id ] = sceneObj.behav;
            // }
            //[end-20230807-howardhsu-modify]//

            //// 無條件清除 「 儲存的  behav_reference 資料 」
            if ( sceneObj.behav_reference ){
                // behavRefAll[ sceneObj.obj_id ] = sceneObj.behav_reference;
                delete sceneObj.behav_reference;
            }

            if ( sceneObj.generalAttr.obj_id ){
                sceneObjDict[ sceneObj.generalAttr.obj_id ] = sceneObj;
            }
        }

        //// 從「 事件備註 _behavRef 」 來檢查，會不會有「明明沒有事件來觸發物件顯示，但是物件上確有掛 behav_reference 」
        //// 上述情況發生的話，會造成物件啟使的時候，被設置為「不可見」，但又沒有任何事件可以觸發顯示
        // for ( let i in behavRefAll ){
        // 	let behavRefs = behavRefAll[i];
        // 	for( let j = 0, len = behavRefs.length; j < len; j++ ){
        // 		let behavRef = behavRefs[ j ];
        // 		// console.log(' _checkVRSceneResultBehav: _behavRefAll: ', i.slice(0,6) , j , behavRef );
        // 		// let behavRefObj = sceneObjDict[i];

        // 		let getBehavObj = false;
        // 		for ( let k in behavAll ){
        // 			let behavs = behavAll[k];
        // 			for ( let m = 0; m < behavs.length; m++ ){
        // 				if ( behavs[m].obj_id == i && behavs[m].behav_type == behavRef.behav_name ){
        // 					getBehavObj = { i: m, b: behavs[m] } ;
        // 				}
        // 			}
        // 		}

        // 		if ( getBehavObj == false ){
        // 			console.error('_checkVRSceneResultBehav: _getBehavObj false', i ,j, behavRefs );

        // 			// behavRef = null;
        // 			// behavRefs = null;

        // 			// behavRefs.fuck = '12354';
        // 			// behavRef.fuck = '123';
        // 			// behavRef.behav_name = '123';
                    
        // 			behavRefs.length = 0;

        // 		}else{
        // 			// console.log('_checkVRSceneResultBehav: _getBehavObj true', i ,j, behavRefs , getBehavObj );
        // 		}
        // 	}
        // }

        //// 從 「事件 behav 」來檢查「全部場景物件」中是否有物件沒有帶到「 事件備註 behav_reference 」
        //// 沒有的話，補上
        for ( let i in behavAll ){
            let behavs = behavAll[i];
            console.log(' _checkVRSceneResultBehav: _behavAll: ', i, behavs );
            for( let j = 0, len = behavs.length; j < len; j++ ){
                let behav = behavs[ j ];
                if ( behav.behav_type != "FingerGesture" ){
                    // console.log(' _checkVRSceneResultBehav: _behavAll: ', i.slice(0,6) , j ,behav );
                }
                
                if ( behav.obj_id ){
                    let behavObj = sceneObjDict[ behav.obj_id ];
                    //// 無條件自製 「 _behav_reference 」
                    if ( behavObj && Array.isArray( behavObj.behav_reference ) ){
                        behavObj.behav_reference.push({
                            behav_name: behav.behav_type,
                            target_id: behav.obj_id,
                        });
                    }else if ( behavObj ){
                        behavObj.behav_reference = [{
                            behav_name: behav.behav_type,
                            target_id: behav.obj_id,
                        }];
                    }else{
                        console.error('_checkVRSceneResultBehav: cant get _behavObj ', behav );
                    }


                    // if ( behavObj.behav_reference ){
                        
                    // 	let getBehaveRef = false;
                    // 	for ( let k = 0; k < behavObj.behav_reference.length; k++ ){
                    // 		if ( behavObj.behav_reference[k].behav_name == behav.behav_type ){
                    // 			getBehaveRef = true;
                    // 		}
                    // 	}

                    // 	if ( getBehaveRef ){
                    // 		// console.log('_checkVRSceneResultBehav: getBehaveRef true', behav, behavObj,  );
                    // 	}else{
                    // 		console.error('_checkVRSceneResultBehav: _getBehaveRef false', behav, behavObj );
                    // 	}
                        
                    // }else{
                    // 	console.error(' _checkVRSceneResultBehav: _behavObj ref not exist error: ', behavObj );

                    // }

                }
            }
        }
    }

    //// 載入「場景物件」完成之後，作的「物件區域」計算
    calcSceneArea() {
        
        let self = this;
        let objList = {} ;

        let objMaxX = 0;
        let objMinX = 0;
        let objMaxZ = 0;
        let objMinZ = 0;

        for ( let i = 0, len = self.makarObjects.length; i< len ; i++ ){
            
            let obj3D = self.makarObjects[i].object3D;
            if ( obj3D && obj3D.el && obj3D.el.id ){
                let boxList = [];
                obj3D.traverse( function(c){

                    if ( c.isMesh && c.geometry ){
                        
                        //// 20240619 YT物件由three平面和text組成，但a-text在這會報錯  renhaohsu暫時先跳過它
                        if(c.el){
                            if(c.el.tagName=="A-TEXT"){
                                if(c.el.object3D){
                                    if(c.el.object3D.isTempTextObj){
                                        return;
                                    }
                                }
                            }
                        }

                        let box = new THREE.Box3();
                        c.geometry.computeBoundingBox();
                        box.copy( c.geometry.boundingBox ).applyMatrix4( c.matrixWorld );
                        if ( box.max.z == box.min.z ){
                            box.max.z += 0.01;
                        }

                        if ( box.max.x > objMaxX ) objMaxX = box.max.x;
                        if ( box.min.x < objMinX ) objMinX = box.min.x;
                        if ( box.max.z > objMaxZ ) objMaxZ = box.max.z;
                        if ( box.min.z < objMinZ ) objMinZ = box.min.z;
                    

                        let boxHelper = new THREE.Box3Helper( box , 0x56a5d3 );
                        boxList.push( boxHelper );								

                        //// 顯示於畫面中，測試用
                        // self.vrScene.object3D.add( boxHelper );
                        // console.log(' .... ' , self.makarObjects[i], box.max.clone() , box.min.clone() );
                        // console.log(' .... ' , self.makarObjects[i], boxHelper.position.clone() , boxHelper.rotation.clone(), boxHelper.scale.clone(), boxHelper  );

                        // console.log(' .. ' , boxHelper.position.x , boxHelper.position.z  );

                    }

                });

                objList[ obj3D.el.id ] = boxList;

            }
        }

        self.objList = objList;

        let areaMax = new THREE.Vector2( objMaxX , objMaxZ );
        let areaMin = new THREE.Vector2( objMinX , objMinZ );
        
        self.areaMax = areaMax;
        self.areaMin = areaMin;
        
        // console.log(' _calcSceneArea: x = [', objMaxX, ', ' , objMinX , '], z = [' , objMaxZ, ', ' , objMinZ, ']' );

        if ( self.currentProjData && self.currentProjData.proj_descr.includes('_walking') ){
            
            let ground = document.getElementById('__ground');
                if ( ground ){
                    let gw = (objMaxX - objMinX) *2 ;
                    let gd = (objMaxZ - objMinZ) *2 ;
                    let gc = new THREE.Vector2( (objMaxX + objMinX)/2 , (objMaxZ + objMinZ)/2 );

                    ground.setAttribute('geometry', 'width:'+ gw +'; height:'+ gd+';'   );
                    ground.setAttribute('position',  {x: gc.x, y: 0.1 , z: gc.y }  );

                    
                    console.log(' _calcSceneArea: gwdc ', gw , gd, gc );

                }
        
        }

        // if ( self.publishVRProjs && Array.isArray(self.publishVRProjs.result) && Number.isFinite( self.projectIdx ) ){
            
        //     if ( typeof( self.publishVRProjs.result[ self.projectIdx ].proj_descr ) == 'string' && self.publishVRProjs.result[ self.projectIdx ].proj_descr.includes('_walking') == true  ){
        //         console.log(' _calcSceneArea: walking project ' , self.projectIdx , self.publishVRProjs.result[ self.projectIdx ] );

        //         let ground = document.getElementById('__ground');
        //         if ( ground ){
        //             let gw = (objMaxX - objMinX) *2 ;
        //             let gd = (objMaxZ - objMinZ) *2 ;
        //             let gc = new THREE.Vector2( (objMaxX + objMinX)/2 , (objMaxZ + objMinZ)/2 );

        //             ground.setAttribute('geometry', 'width:'+ gw +'; height:'+ gd+';'   );
        //             ground.setAttribute('position',  {x: gc.x, y: 0.1 , z: gc.y }  );

                    
        //             console.log(' _calcSceneArea: gwdc ', gw , gd, gc );

        //         }

        //     }else{
        //         console.log(' _calcSceneArea: not walking project ' , self.projectIdx , self.publishVRProjs.result[ self.projectIdx ] );
        //     }
        // }else{
        //     console.log(' _calcSceneArea: _publishVRProjs error ' , self.projectIdx , self.publishVRProjs );
        // }

    }

    //// 載入「場景物件」完成之後，作的「事件」處理，目前包含「注視事件」 而已
    //// 檢查場景中物件的「 事件 / behav 」與「 事件備註 / behav_reference 」 的狀況，因為目前編輯器有出現過錯誤
    //// 流程：掃一遍「場景中物件 2d/3d 」
    setupSceneBehav() {
        
        let self = this;

        let behavObj = {};
        for ( let i = 0, len = self.makarObjects.length; i< len ; i++ ){
            
            let obj3D = self.makarObjects[i].object3D;
            if ( obj3D ){

                if ( obj3D.behav ){
                    
                }

                if ( obj3D.behav_reference ){

                }

            }else{	
                console.error(' _setupSceneBehav: 3d obj error', i, self.makarObjects[i] );
            }

        }

        // for ( let i = 0, len = self.makarObjects2D.length; i< len ; i++ ){

        // }


        //// 從載入過程紀錄的 「注視事件列表」 來建立互動事件 「」
        //// 只有「3d物件」會有注視事件
        // for ( let i = 0, len = self.lookAtObjectList.length; i < len; i++ ){
        //     let lookAtEvent = self.lookAtObjectList[i];

        //     let lookObjId = lookAtEvent.lookObjId;
        //     let lookObj = document.getElementById( lookObjId );
            
        //     let lookBehav = lookAtEvent.lookBehav;
        //     let targetObjId = lookBehav.obj_id;
        //     let reverse = lookBehav.reverse;

        //     let targetObj = document.getElementById( targetObjId );
        //     //// 確保「目標物件」「注視物件」都存在，建立持續事件
        //     if (lookObj && lookObj.object3D && targetObj && targetObj.object3D ){
                
        //         self.addLookAtTimeLine( lookObj , targetObj , lookAtEvent );

        //     }else{
        //         console.log('_setupSceneBehav: _lookAt error, obj not exist', lookObj , targetObj );
        //     }

        // }

    }

    ///// 建立「注視事件功能」
    addLookAtTimeLine( lookObj , targetObj , facingEvent ) {

        console.log(' _addLookAtTimeLine: _facingEvent=', facingEvent );

        let self = this;

        let targetPos = new THREE.Vector3();
        targetObj.object3D.getWorldPosition(targetPos);
        
        let tl = gsap.timeline();
        self.lookAtTimelineDict[ facingEvent.lookObjId ] = tl;

        if( lookObj == document.getElementById("aCamera") ){

            if( self.viewMode == "VR" ){
                // console.log("%c 注視事件，lookObj是相機", 'color:wheat', lookObj == aCamera)
                
                //// 先停止 aframe 對相機html tag的控制
                lookObj.setAttribute('look-controls', {enabled: false});
                
                //// 旋轉相機物件 (利用THREE的lookAt)
                targetObj.object3D.getWorldPosition(targetPos);
                lookObj.object3D.lookAt(targetPos);
                
                //// 實驗結果發現：相機物件要先翻轉過來，再將rotation指定給aframe相機設定才會正確
                lookObj.object3D.rotateOnAxis( new THREE.Vector3( 0, 1 ,0 ), Math.PI );            
                
                if ( facingEvent && facingEvent.is_front == false ){
                    //// 背對: 該物體的 "朝向z軸負向" 的那一面 面對目標物體
                    lookObj.object3D.rotateOnAxis( new THREE.Vector3( 0, 1 ,0 ), Math.PI );
                }
                
                //// 調整aframe的相機設定後，再打開look-controls
                const afterRotation = lookObj.object3D.rotation.clone()
                aCamera.components["look-controls"].yawObject.rotation.y = afterRotation.y ;
                aCamera.components["look-controls"].pitchObject.rotation.x = afterRotation.x ;
                lookObj.setAttribute('look-controls', {enabled: true})
            }

        } else {

            //// 執行一次「注視效果」
            targetObj.object3D.getWorldPosition(targetPos);
            lookObj.object3D.lookAt(targetPos);
            if ( facingEvent && facingEvent.is_front == false ){
                //// 背對: 該物體的 "朝向z軸負向" 的那一面 面對目標物體
                lookObj.object3D.rotateOnAxis( new THREE.Vector3( 0, 1 ,0 ), Math.PI );
            }

            //// 暫時不使用「持續注視」
            //// 無條件不斷重複「注視功能」
            // tl.to(lookObj.object3D, {
            //     // duration: 1100,
            //     delay: 0, 
            //     ease: 'none',
            //     repeat: -1,
            //     onUpdate: function(){
            //         targetObj.object3D.getWorldPosition(targetPos);
            //         lookObj.object3D.lookAt(targetPos);
            //         if ( facingEvent && facingEvent.is_front == false ){
            //             //// 背對: 該物體的 "朝向z軸負向" 的那一面 面對目標物體
            //             lookObj.object3D.rotateOnAxis( new THREE.Vector3( 0, 1 ,0 ), Math.PI );
            //         }
            //     }
            // });
        }
    }

    //// 所有 「物件觸發事件」 需要作的「前置動作」
    //// 1. 場景載入物件時候，假如有「觸發事件」，則往下判斷是否有「群組」，並且紀錄下來
    //// 2. 「注視事件」
    setObjectBehavAll( obj ) {
        
        // let self = this;

        // for ( let i = 0, len = obj.behav.length; i < len; i++ ){
        //     //// 群組事件紀錄
        //     if ( obj.behav[i].group != '' ){
        //         if ( self.groupDict[ obj.behav[i].group ] ){
        //             let groupObj =  self.groupDict[ obj.behav[i].group ];

        //             groupObj.objs.push({
        //                 behav:  obj.behav[i]
                        
        //             } );

        //         }else{

        //         }		
        //     }


        //     //// 注視事件紀錄
        //     if ( obj.behav[i].behav_type == 'LookAt' && obj.behav[i].obj_id ){

        //         let lookAtEvent = {
        //             lookBehav: obj.behav[i] ,
        //             lookObjId: obj.obj_id ,
        //         }

        //         self.lookAtObjectList.push( lookAtEvent );

        //     }

        // }
    }

    //// 處理全部的 群組功能 包含 2D / 3D 
    //// 注意：目前群組功能只有作用在 「顯示/隱藏」相關的功能。我們也只先處理這些，未來在新增
    dealAllGroupHide( touchObject ) {

        let self = this;

        if ( !self.groupDict ){
            console.log('_dealAllGroup: missing groupDict');
            return;
        }

        //// 符合當前群組功能的 事件
        // let showEventStrList = ['ShowImage2D', 'ShowImage' , 'ShowText2D', 'ShowText', 'ShowModel', 'PlayMusic', 'ShowVideo'];

        console.log(' _dealAllGroupHide_:  ', touchObject );
        
        for (let i = 0; i < touchObject.behav.length; i++ ){
            let behav = touchObject.behav[i];
            if ( behav.group != ''  && self.groupDict[ behav.group ]  ){
                let groupIndex = behav.group;

                console.log(' _dealAllGroupHide:  ', groupIndex , self.groupDict[ groupIndex ].objs );

                self.groupDict[ groupIndex ].objs.forEach( ( groupObj , groupObjIndex  )=>{

                    //[start-20240319-renhaohsu-modify]//
                    //// 因為 "本次behav裡有存的obj_id" 的物件接下來在triggerEvent會被顯示/關閉 因此這裡都先跳過
                    let isObjIdExistInBehav = touchObject.behav.find(b => b.obj_id == groupObj.obj_id)

                    //// 剩下的obj_id就都是 "不在本次behav裡面 但屬於同一群組"
                    if( !isObjIdExistInBehav ){
                        //// v3.5.0.0 改版，這邊紀錄的 群組事件 是「觸發事件格式」
                        let obj_id = groupObj.obj_id;

                        //// 目前認定「顯示相關事件」與「媒體相關事件」，需要被群組所影響
                        //// 「顯示相關」，隱藏物件
                        let isBehavRederenceTpyeDisplay = false

                        self.scenesData.scenes[self.currentSceneIndex].behav.forEach( b => {
                            if(b.obj_id==obj_id && 
                                ( b.behav_type == 'Display' && ( b.switch_type == 'Switch' || b.switch_type == 'Show' ) )
                            ) {
                                isBehavRederenceTpyeDisplay = true
                            }
                        })
                        
                        //// 透過「場景物件 ID 」取得「 實體化物件 」，回傳同時帶有 2D / 3D 類別
                        let getObj = self.getObjectTypeByObj_id( obj_id );
                        
                        //// 要觸發顯示隱藏的物件 要區分為 2d/3d 
                        if ( getObj.obj_type == '2d' ){

                            let obj2D = getObj.obj;
                            //// 要找到「群組事件」中「不是當前所選到物件」
                            if ( behav.obj_id != obj_id && isBehavRederenceTpyeDisplay ){
                                obj2D.visible = false  
                            }

                        }else if ( getObj.obj_type == '3d' ){

                            let obj3D = getObj.obj;
                            // if ( obj3D.object3D.behav_reference && Array.isArray( obj3D.object3D.behav_reference ) && behav.obj_id != obj_id  ){
                            if ( behav.obj_id != obj_id && isBehavRederenceTpyeDisplay ){

                                self.hideGroupObjectEvent( obj3D, isBehavRederenceTpyeDisplay );
                                //// 「媒體相關」，目前 3D 會有「影片」「聲音」，確認類型之後，暫停
                                //// 尚未製作
                            }
                        }
                    }
                    //[end-20240319-renhaohsu-modify]//

                });

            }
        }
    }

    //// 朗讀文字物件功能
    speechTextObj( textObj, _speed, speechLangIndex ) {
        console.log(' _speechTextObj: _textObj: ', textObj );
        if ( typeof( speechSynthesis ) == 'object' && typeof( SpeechSynthesisUtterance ) == 'function' ){

            //// 先判斷是否已經正在說話，假如是的話，暫停說話。假如沒有正在說話，才開始說話。
            if ( speechSynthesis.speaking == true ){
                speechSynthesis.pause();
                speechSynthesis.cancel();
            } 

            //// speed 預設是 1
            let speed = 1;
            if ( Number.isFinite( _speed ) && _speed > 0 ){
                speed = _speed;
            }

            let content = textObj.typeAttr.content;

            let utterance = new SpeechSynthesisUtterance( content );

            //// makar / web = 2 / 1.67
            //// makar / web = 1.5 / 1.38
            //// makar / web = 1 / 1
            //// makar / web = 0.75 / 0.76
            //// makar / web = 0.5 / 0.42
            //// 速度方面怪怪的 沒辦法，經驗判斷加上 2 階 fitting 
            //// https://mycurvefit.com/ 
            
            // utterance.rate = ( speed **2 ) * (-0.2963) + ( speed )*1.556 - 0.266 ; // 二階
            utterance.rate = ( speed**3 ) * ( 0.1837 ) + ( speed**2 ) * ( -0.9948 ) + ( speed )* ( 2.3352 ) + ( -0.5196 ) ; // 三階
            utterance.pitch = 1;

            //// 發音語言，目前測試由 lang / voice 來控制
            //// 1. 在沒有設置 voice 情況下， lang 改變的確會影響
            //// 2. 在有設定 voice 情況下，lang 就沒有效果了
            //// 所以先判斷 voice 沒有成功的話再設定 lang 

            //// MAKAR 設定
            //// 0: en 1: zh-Hant 2: zh-Hans 3: ja 4: ko
            let setLang = 'en';
            let voiceLang = 'en-US';

            switch( speechLangIndex ){
                case 0:
                    setLang = 'en';
                    voiceLang = 'en-US';
                    break;
                case 1:
                    setLang = 'zh-TW';
                    voiceLang = 'zh-TW';
                    break;
                case 2:
                    setLang = 'zh-CN';
                    voiceLang = 'zh-CN';
                    break;
                case 3:
                    setLang = 'ja';
                    voiceLang = 'ja-JP';
                    break;
                case 4:
                    setLang = 'ko';
                    voiceLang = 'ko-KR';
                    break;
                default:
                    setLang = 'en';
                    voiceLang = 'en-US';
            }
                        
            //// 發音標準，20230530, 美語 國語（台灣） 日本語（）
            //// 另外，以下可能無法取得，判斷
            
            let tID = setInterval( function(){
                let getVoice = false;
                let voices = speechSynthesis.getVoices();
                if ( voices.length > 0 ){
                    clearInterval( tID );

                    //// safari 的各語言發音效果怪怪的，改為只使用預設語言來選定聲音。
                    if ( window.Browser && window.Browser.name != "safari"  ){

                        voices.forEach( e => {
                            if ( e.lang == voiceLang ){
                                getVoice = true;
                                utterance.voice = e;
                            }
                        });

                    }

                    if ( getVoice == false ){
                        utterance.lang = setLang;
                    }

                    speechSynthesis.speak(utterance);
                    
                }
                
            }, 1);
            
        }
        
    }
    //[end---20200617-fei0097-add]//


    //// v3.5.0.0 logic XML 放於 場景
    parseLogicXMLBySceneIndex = function( sceneIndex ){

        let pXML;
        let xmlUrl = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getSceneLogicXML( this.scenesData , sceneIndex );
        
        if ( xmlUrl != '' ){
            let logic = new Logic();
            pXML = logic.loadXMLtoDoc(xmlUrl);
            // vrController.logicList[ sceneIndex ] = logic;
            vrController.logic = logic;
        }

        return pXML;
    }


    ////
    //// 切換觀看模式，目前有「VR」跟「模型觀看」 兩種
    //// 起始預設為「VR」模式 
    //// 假如「有指定觀看模式」，則切換。假如沒有輸入，則判斷當前模式，改為另一個
    ////
    setViewMode( mode = '' ) {

        let self = this;

        let pSet = new Promise( function( setModeResolve ){

            let aCamera = document.getElementById('aCamera');
            let oCamera = document.getElementById('oCamera');
            let cameraForGyro = document.getElementById('cameraForGyro');

            let aCameraObject = aCamera.getObject3D('camera');
            let oCameraObject = oCamera.getObject3D('camera');

            if ( aCamera && oCamera && aCameraObject && oCameraObject ){

                if ( mode == 'VR' ){

                    oCamera.setAttribute('camera', 'active' , false );
                    aCamera.setAttribute('camera', 'active' , true );	
                    cameraForGyro.play();	

                    self.vrScene.camera = aCameraObject;


                    self.viewMode = 'VR';
                    if ( Number.isFinite( self.walkingStatus ) && self.walkingStatus != -1 ){
                        let ground = document.getElementById('__ground');
                        if ( ground ) ground.setAttribute('visible' , true );
                    }

                    setModeResolve( 'VR' );

                }else if ( mode == 'model' ){
                    oCamera.setAttribute('camera', 'active' , true );
                    aCamera.setAttribute('camera', 'active' , false );
                    cameraForGyro.play();

                    self.vrScene.camera = oCameraObject;

                    self.viewMode = 'model';

                    self.setWalkingObjVisible( false );

                    setModeResolve( 'model' );

                }else{
                    if ( oCamera.getAttribute('camera').active == false ){
                    
                        oCamera.setAttribute('camera', 'active' , true );
                        aCamera.setAttribute('camera', 'active' , false );
                        cameraForGyro.play();

                        self.vrScene.camera = oCameraObject;

                        self.viewMode = 'model';

                        self.setWalkingObjVisible( false );
                        
                        setModeResolve( 'model' );

                    } else if ( aCamera.getAttribute('camera').active == false ){

                        oCamera.setAttribute('camera', 'active' , false );
                        aCamera.setAttribute('camera', 'active' , true );		

                        self.vrScene.camera = aCameraObject;

                        self.viewMode = 'VR';

                        if ( Number.isFinite( self.walkingStatus ) && self.walkingStatus != -1 ){
                            let ground = document.getElementById('__ground');
                            if ( ground ) ground.setAttribute('visible' , true );
                        }

                        setModeResolve( 'VR' );

                    }else{
                        setModeResolve( -1 );
                    }	
                }
                
            }else{
                setModeResolve( -1 );
            }
        });

        return pSet;
    }

    ////// 設計將 VR 專案中 cursor 的功能取消，改以點擊觸發。 
    ////// 因為 VR 場景中目前不讓使用者以點擊或是滑鼠來操控物件，所以不需要額外判斷 look-control 開啟與否
    ////// --------------------- debug --------------------------------
    getMakarObject( obj ) {
        let self = this
        if (obj.makarObject != true){
            if ( obj.parent ){
                // console.log("obj.parent exist, goto");
                return ( self.getMakarObject( obj.parent ) );
            }else{
                // console.log("obj.parent not exist, return 0");
                return 0;
            }
        }else{
            // console.log("obj.makarObject == true, return", obj);
            return obj ;
        }
    }    

    //// 依照「 obj_id 」 來判斷 「物件型態」為 「 2d / 3d 」
    getObjectTypeByObj_id( obj_id ) {

        let self = this;

        let getObj3D = null;
        let getObj3DIndex = null;
        let getObj2D = null;
        let getObj2DIndex = null;

        //// 基本上沒有道理「同一個 obj_id 」同時在「 2d / 3d 物件」
        let getObj = {
            obj_type: '',
            obj_index: null,
            obj: null,
        }

        if ( obj_id ){

            self.makarObjects.forEach( (e,i) =>{
                if ( e.id == obj_id ){
                    getObj3D = e;
                    getObj3DIndex = i;
                }
            });

            if ( self.makarObjects2D ){
                self.makarObjects2D.forEach( (e,i) =>{
                    if ( e.obj_id == obj_id ){
                        getObj2D = e;
                        getObj2DIndex = i;
                    }
                });
            }

            
            if ( ( getObj3D != null && getObj3DIndex != null ) || ( getObj2D != null && getObj2DIndex != null ) ){
                
                if ( getObj3D != null && getObj3DIndex != null ){
                    // console.log('_getObjectTypeByObj_id: 3d: ' , getObj3DIndex , getObj3D );
                    getObj.obj_type = '3d';
                    getObj.obj_index = getObj3DIndex;
                    getObj.obj = getObj3D;

                }else if ( getObj2D != null && getObj2DIndex != null ){
                    // console.log('_getObjectTypeByObj_id: 2d: ' , getObj2DIndex , getObj2D );
                    getObj.obj_type = '2d';
                    getObj.obj_index = getObj2DIndex;
                    getObj.obj = getObj2D;
                    
                }else{
                    console.log('_getObjectTypeByObj_id: fucking logic trouble.' , getObj2DIndex , getObj2D );
                }

            }else if ( ( getObj3D != null && getObj3DIndex != null ) && ( getObj2D != null && getObj2DIndex != null ) ){
                console.log('_getObjectTypeByObj_id: warning, both 2D/3D object get', obj_id , ', 3d:' , getObj3DIndex , getObj3D , ', 2d:' , getObj2DIndex , getObj2D );
                getObj.obj_type = '3d';
                getObj.obj_index = getObj3DIndex;
                getObj.obj = getObj3D;
            }else{

            }

        }

        return getObj;

    } 

    cameraMoveToPoint( paraemter ) {
        let self = this
        
        let pointerSphere = document.getElementById('pointerSphere');
        let currentPosSphere = document.getElementById('currentPosSphere');

        if ( !pointerSphere || !currentPosSphere ){
            return;
        }


        let pMove = new Promise(function(resolve, reject){
            
            let pointPosition = paraemter.position;
            let px = Math.round(pointPosition.x * 1000) / 1000;
            let py = Math.round(pointPosition.y * 1000) / 1000;
            let pz = Math.round(pointPosition.z * 1000) / 1000;

            //// 隱藏「選定目標位置」
            pointerSphere.setAttribute("visible", false);

            //// 設定「目標相機位置」
            currentPosSphere.setAttribute("visible", true );
            currentPosSphere.object3D.position.set( px , py , pz );

            const cameraObject3D = self.vrScene.camera.el.object3D
            let ox = cameraObject3D.position.x;
            let oy = cameraObject3D.position.y;
            let oz = cameraObject3D.position.z;

            let direction = new THREE.Vector3(px - ox, py - oy, pz - oz);
            let direction_normalized = new THREE.Vector3(px - ox, 0, pz - oz).normalize();

            let duration = Math.round(direction.length()) * 0.2;
            // console.log(' _duration: ', duration );
            
            duration = duration > 1 ? 1 : duration;
            

            let boundRaycaster = new THREE.Raycaster(cameraObject3D.position, direction_normalized);
            if (paraemter.dealBoundary == true){
                let boundIntersect = boundRaycaster.intersectObjects( boundaries, true);
                if (boundIntersect.length > 0) {
                    console.log("_cameraMoveToPoint: initial position hit boundary, distance ", boundIntersect[0].distance );
                    if (boundIntersect[0].distance < 1) {
                        console.log("_cameraMoveToPoint: initial position hit boundary, dont run  ");

                        //// 設定「目標相機位置」
                        currentPosSphere.object3D.position.copy( cameraObject3D.position );
                        resolve( 1 );
                        return;
                    }
                }
            }
            

            let tl = gsap.timeline();
            tl.to( self.domElement.gsapEmpty, {
                duration: duration,
                delay: 0,
                onStart: function(){

                },
                onUpdate: function(){
                    //// 這裡this是gsap的tl
                    let animePos = new THREE.Vector3(ox + direction.x * this.ratio , oy, oz + direction.z * this.ratio );

                    if (paraemter.dealBoundary == true){
                        let boundIntersect = boundRaycaster.intersectObjects( boundaries, true);
                        if (boundIntersect.length > 0) {
                            // console.log(" _cameraMoveToPoint: boundIntersect=", boundIntersect[0] );
                            //// 假如與『相機與邊界的距離』小於『相機要設置下一步的距離』，不應該再往前位移
                            if (boundIntersect[0].distance < animePos.distanceTo( cameraObject3D.position ) ) {
                            // if (boundIntersect[0].distance < 1) {

                                //// 設定「目標相機位置」
                                currentPosSphere.object3D.position.copy( animePos );

                                tl.pause();
                                tl.kill();
                                tl = null;

                                resolve( 1 );
                                return;
                            }
                        }
                    }

                    cameraObject3D.position.set(animePos.x, animePos.y, animePos.z);
                    
                },
                onComplete: function(){

                    resolve( duration );

                }

            });

        });	

        return pMove;

    }

    //// 設定「點擊移動」狀態， -1: 未啟動 , 0: 已啟動,  1. 移動中。
    setWalkingStatus( _value ) {

        let self = this;

        if ( Number.isFinite( self.walkingStatus ) ){
            console.log(' _setWalkingStatus: set from [', self.walkingStatus , ']', ' to [', _value, ']' );

            let ground = document.getElementById('__ground');
            let pointerSphere = document.getElementById('pointerSphere');
            let currentPosSphere = document.getElementById('currentPosSphere');

            if ( self.walkingStatus == 0 || self.walkingStatus == -1 ){
                self.walkingStatus = _value;
            }

            if ( self.walkingStatus == -1 ){
                if ( pointerSphere && currentPosSphere && ground ){
                    // ground.setAttribute("visible", false );
                    // pointerSphere.setAttribute("visible", false );
                    // currentPosSphere.setAttribute("visible", false );
                    self.setWalkingObjVisible( false );
                }
            }

            if ( self.walkingStatus == 0 ){
                if ( ground){
                    ground.setAttribute("visible", true );
                }
            }

        }else{
            console.log(' _setWalkingStatus: status not exist ', self.walkingStatus );
        }

    }

    setWalkingObjVisible( _status ) {
        let ground = document.getElementById('__ground');
        let pointerSphere = document.getElementById('pointerSphere');
        let currentPosSphere = document.getElementById('currentPosSphere'); 

        if ( ground && pointerSphere && currentPosSphere ){
            if ( _status == true ){
                ground.setAttribute("visible", true );
                pointerSphere.setAttribute("visible", true );
                currentPosSphere.setAttribute("visible", true );
            }else{
                ground.setAttribute("visible", false );
                pointerSphere.setAttribute("visible", false );
                currentPosSphere.setAttribute("visible", false );
            }
        }
    }
    // --- 到上面為止是原本 setupFunction 的內容
    
    //// 原本的VRController.prototype.UrlExistsFetch 但我發現這個函式似乎沒有被呼叫過
    async UrlExistsFetch(url) {            
        let ret = await fetch(url, {method: 'HEAD'})

        console.log('_VRController: _UrlExists2: ret ', ret );
        if ( ret.status ){
            return ret.status == '200';
        }else{
            return false ;
        }
    }

    setupFunction() {

        if (this.FUNCTION_ENABLED) {
            return;
        }
        // console.log("VRFunc.js: VRController: setupFunction");
        this.FUNCTION_ENABLED = true;
        var self = this;  
    
        ////// add the listener for show the panel or not
        self.vrScene.canvas.addEventListener("touchstart", startEvent, false);
        self.vrScene.canvas.addEventListener("mousedown", startEvent, false);
    
        self.vrScene.canvas.addEventListener("touchmove", moveEvent, false);
        self.vrScene.canvas.addEventListener("mousemove", moveEvent, false);
    
        self.vrScene.canvas.addEventListener("touchend", endEvent, false);
        self.vrScene.canvas.addEventListener("mouseup", endEvent, false);
    
        //////
        ////// raycaster for touch and mouse 
        //////
        let preMouse = new THREE.Vector2();
        var mouse = new THREE.Vector2();
        var raycaster = new THREE.Raycaster();
    
        function getMouse(event){
            let rect = self.GLRenderer.domElement.getBoundingClientRect();
    
            switch ( event.type ) {
                case "mouseup":
                case "mousemove":
                case "mousedown":
                    mouse.x = ( (event.clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
                    mouse.y = - ( (event.clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
                    break;
                case "touchend":////// 20190709 Fei: add this event type for cellphone
                case "touchstart":
                case "touchmove":
                    mouse.x = ( (event.changedTouches[0].clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
                    mouse.y = - ( (event.changedTouches[0].clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
                    break;
                default:
                    console.log("default endEvent: event.type=", event.type, " not mouseup/touchend, return ");
                    return ;
            }
            return mouse.clone();
        }
    
        function startEvent(event){
            preMouse = getMouse(event);
    
            self.touchMouseState = 0;
        }
    
        function moveEvent(event){
            
            // console.log(' _mv ' , self.touchMouseState  );
            let moveMouse = getMouse(event);
            
            if (self.touchMouseState == 0 ){
                
                if ( moveMouse.sub(preMouse).length() > 0.01 ){
                    self.touchMouseState = 1;					
                }
                // console.log("VRFunc.js: moveEvent: ", moveMouse.sub(preMouse).length()  );
            }else{
                self.touchMouseState = 1;
    
            }
    
            let ground = document.getElementById('__ground');
            let pointerSphere = document.getElementById('pointerSphere');
    
            if ( pointerSphere && ground ){
    
                if ( self.touchMouseState == 0 || self.touchMouseState == 1 ){
            
                    if (!self.triggerEnable){
                        return;
                    }
                    //// 處理「點擊移動功能」，必須要 觀看模式 為 VR 且，啟動「可移動」
                    if ( self.viewMode == 'VR' && Number.isInteger (self.walkingStatus) && self.walkingStatus >= 0  ){
                        
                        
                        if ( Array.isArray( self.currentSceneMakarObjects ) && self.currentSceneMakarObjects.length > 0  ){
    
                        }else{
                            
                            for ( let i = 0; i < self.makarObjects.length; i++ ){
                                let makarObject = self.makarObjects[i];
                                if ( makarObject.object3D && makarObject.className == "clickable" ){
    
                                    let parentVisible = true;
                                    makarObject.object3D.traverseAncestors( function(parent) {
                                        if (parent.type != "Scene"){
                                            if (parent.visible == false){
                                                parentVisible = false;
                                            }
                                        }
                                    });
    
                                    if (parentVisible){
                                        self.currentSceneMakarObjects.push(makarObject.object3D );
                                    }
                                    
                                }
                            }
                            self.currentSceneMakarObjects.push( ground.object3D );
                        }
    
                        let makarTHREEObjects = self.currentSceneMakarObjects;
                        let showEventStrList = ['ShowImage2D', 'ShowImage' , 'ShowText2D', 'ShowText', 'ShowModel', 'PlayMusic', 'ShowVideo'];
    
                        let selectedObjWithBehav = false;
    
                        raycaster.setFromCamera( moveMouse , self.vrScene.camera );
    
                        let groundIntersect = raycaster.intersectObjects( makarTHREEObjects , true ); 
                        if (groundIntersect.length > 0){
                            
                            //// 判斷是否有點集到「有事件的物件」
                            // groundIntersect.forEach( ( e , i ) => {
    
                            // 	if ( e.object && e.object.el && e.object.el.id && e.object.el.object3D && Array.isArray( e.object.el.object3D.behav )  ){
                            // 		// console.log(' _moveEvent: ' , i, e.object.el.id, e.object.el.object3D.behav );
    
                            // 		for ( let j = 0; j < e.object.el.object3D.behav.length; j++ ){
                            // 			if ( showEventStrList.filter( ev => ev == e.object.el.object3D.behav[j].behav_type ).length > 0 ){
                            // 				selectedObjWithBehav = true;
                            // 			}
                            // 		}
                            // 	}
    
                            // });
                            
                            // console.log(' _moveEvent: _selectedObjWithBehav ' , selectedObjWithBehav );
    
                            //// 假如當前指向的物件不是地板，則不顯示
                            if ( selectedObjWithBehav == true || ( groundIntersect[0].object && groundIntersect[0].object.el && groundIntersect[0].object.el != ground ) ){
                                pointerSphere.setAttribute("visible", false );
                                // pointerSphere.object3D.position.copy(groundIntersect[0].point);
                            }else{
                                pointerSphere.setAttribute("visible", true );
                                pointerSphere.object3D.position.copy(groundIntersect[0].point);
                            }
    
                        }
                    }
    
                }else{
                    pointerSphere.setAttribute("visible", false);
                }
    
            }
            
            
    
    
        }
    
        function endEvent( event ) {
    
            // console.log("VRFunc.js: _setupFunction: endEvent: event=", event , self.triggerEnable , self.touchMouseState );
    
            if (!self.triggerEnable){
                return;
            }
            if (self.touchMouseState == 1){
                //// 假如 是手機，「觸碰結束」，要把手指指到的位置刪除
                if ( event.type == 'touchend' ){
                    let pointerSphere = document.getElementById('pointerSphere');
                    if ( pointerSphere )  pointerSphere.setAttribute("visible", false);
    
                }
                return;
            }
    
            self.touchMouseState = 2;
            
            
            event.preventDefault(); ////// if not set this, on mobile will trigger twice 
            let rect = self.GLRenderer.domElement.getBoundingClientRect();
            switch ( event.type ) {
                case "mouseup":
                    mouse.x = ( (event.clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
                    mouse.y = - ( (event.clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
                    break;
                case "touchend":////// 20190709 Fei: add this event type for cellphone
                    mouse.x = ( (event.changedTouches[0].clientX - rect.left) / self.GLRenderer.domElement.clientWidth ) * 2 - 1; // GLRenderer.domElement.clientWidth window.innerWidth
                    mouse.y = - ( (event.changedTouches[0].clientY - rect.top) / self.GLRenderer.domElement.clientHeight ) * 2 + 1; // GLRenderer.domElement.clientHeight  window.innerHeight
                    break;
                default:
                    console.log("default endEvent: event.type=", event.type, " not mouseup/touchend, return ");
                    return ;
            }
            // console.log("VRFunc.js: _setupFunction: endEvent, mouse=", mouse  );
    
            //// 紀錄此次點擊是否有「觸發事件」，不論是「2D」「3D」「點擊事件」「邏輯功能」
            let eventTriggered = {};
    
            //[start-20200315-fei0092-add]//
            ////// for the 2D scene part

            let makarTHREEObjects2D = [];
            for ( let i = 0; i < self.makarObjects2D.length; i++ ){
                let makarObject2D = self.makarObjects2D[i];
                if (makarObject2D.makarObject == true ){
                    makarTHREEObjects2D.push(makarObject2D );
                }
            }

            raycaster.setFromCamera( mouse, self.camera2D );
            let intersects2D = raycaster.intersectObjects(  makarTHREEObjects2D, true ); 
            // console.log("XRFunc.js: raycaster 2D: endEvent, intersects2D=", intersects2D , makarTHREEObjects2D );
            if (intersects2D.length != 0 ){
                let touchObject2D = self.getMakarObject( intersects2D[0].object );
                // console.log("XRFunc.js: raycaster 2D: endEvent, touchObject2D=", touchObject2D  );
                if (touchObject2D.behav){

                    //// 紀錄觸發到的事件
                    eventTriggered['2d_behav'] = touchObject2D.behav ;

                    self.dealAllGroupHide( touchObject2D );

                    let reset = false;
                    for(let i = 0; i < touchObject2D.behav.length; i++){
                        // if (touchObject2D.behav[i].simple_behav == "CloseAndResetChildren"){
                        if (touchObject2D.behav[i].behav_type == "CloseAndResetChildren"){
                            reset = true;
                        }
                    }

                    //// 從 3.3.8 版本以後， 2D/3D 物件可以互相觸發「事件」 
                    //// 所以每個物件點擊後，帶有的「 事件中物件id 」 來判斷「要觸發的物件類別」為 2D/3D                     
                    for(let i = 0; i < touchObject2D.behav.length; i++){

                        let gObj;
                        if ( touchObject2D.behav[i].obj_id ){
                            gObj = self.getObjectTypeByObj_id( touchObject2D.behav[i].obj_id );
                        }

                        if (touchObject2D.behav[i].behav_type == "Display"){
                            
                            if ( gObj.obj_type == '2d' ){
                                let tempBehav = Object.assign({}, touchObject2D.behav[i]);
                                tempBehav.behav_type = "Display2D"; //// seperate from Display
                                self.triggerEvent( tempBehav, reset , touchObject2D );
                            }else if ( gObj.obj_type == '3d' ){
                                self.triggerEvent( touchObject2D.behav[i] , reset , touchObject2D );
                            }
                            
                        // }else if ( touchObject2D.behav[i].behav_type == "Media" ){

                        //     if ( gObj.obj_type == '2d' ){
                        //         let tempBehav = Object.assign({}, touchObject2D.behav[i]);
                        //         tempBehav.behav_type = "Media2D"; //// seperate from Media2D
                        //         self.triggerEvent( tempBehav, reset , touchObject2D );
                        //     }else if ( gObj.obj_type == '3d' ){
                        //         self.triggerEvent( touchObject2D.behav[i] , reset , touchObject2D );
                        //     }
                            
                        }else{
                            self.triggerEvent( touchObject2D.behav[i], reset, touchObject2D );

                        }
                    }
                }
            }
            //[end---20200315-fei0092-add]//

            ////// for the 3D scene part
            let makarTHREEObjects = [];
            for ( let i = 0; i < self.makarObjects.length; i++ ){
                let makarObject = self.makarObjects[i];
                if ( makarObject.object3D && makarObject.className == "clickable" ){
    
                    let parentVisible = true;
                    makarObject.object3D.traverseAncestors( function(parent) {
                        if (parent.type != "Scene"){
                            if (parent.visible == false){
                                parentVisible = false;
                            }
                        }
                    });
    
                    if (parentVisible){
                        makarTHREEObjects.push(makarObject.object3D );
                    }                        
    
                }
            }
    
            raycaster.setFromCamera( mouse, self.vrScene.camera );
            let intersects = raycaster.intersectObjects(  makarTHREEObjects, true ); 
            // console.log("VRFunc.js: _setupFunction: endEvent, intersects=", intersects , makarTHREEObjects , self.makarObjects );
    
            //// 為了「移動功能」的判斷，只要觸發「邏輯事件」或是「觸發事件」則不執行「移動」
            let objectWithLogicEvent = false;
            let objectWithClickEvent = false;

            if (intersects.length != 0 ){
                console.log("VRFunc.js: _setupFunction: 1 endEvent, intersects=", intersects );
    
                let touchObject = self.getMakarObject( intersects[0].object );
                // console.log("VRFunc.js: _setupFunction: endEvent, touchObject.behav=", touchObject.behav );
                // ------
                let intersectObject3D = touchObject.el ;
                if ( intersectObject3D ) {
                    if(intersectObject3D.onclickBlock){	
    
                        objectWithLogicEvent = true;
    
                        for(let i = 0; i < intersectObject3D.onclickBlock.length; i++){
                            if(intersectObject3D.onclickBlockState[i]){
                                intersectObject3D.onclickBlockState[i] = false;
                                if ( vrController.logic ){
                                    vrController.logic.parseBlock( intersectObject3D.onclickBlock[i], function(){
                                        intersectObject3D.onclickBlockState[i] = true;
                                    } ) ; 
                                    
                                    //// 紀錄觸發到的事件
                                    eventTriggered['3d_logic'] = intersectObject3D.onclickBlock[i] ;
                                }
                            }
                        }
                        
                    }
                }
                // ------
    
    //[start-20200915- fei 0101-add]//
                // console.log("VRFunc.js: _setupFunction: endEvent, touchObject.behav=", touchObject );
                touchObject.traverse(function(child){
                    if (child.isMesh){
                        // console.log("VRFunc.js: _setupFunction: endEvent, child = " , child );
                    }
    
                });
    
    //[end---20200915- fei 0101-add]//
    
                if (touchObject.behav){
                    // self.triggerEvent( touchObject.behav[0] ); // 20190827: add the parameter obj( makarObject)
                    // return;
    
                    //// 處理所有群組相關事件，目前只處理「顯示/隱藏 相關功能」，其他功能比如 「切換動畫」等之後等定義明確後再執行
                    //// 未來會有 2D/3D 物件，也一並於此處理
                    self.dealAllGroupHide( touchObject );
    
                    //[start-20230809-howardhsu-add]//
                    //// CloseAndResetChildren 在 ver. 3.5 沒出現過
                    //[end-20230809-howardhsu-add]//

                    let reset = false;
                    for(let i = 0; i < touchObject.behav.length; i++){
                        if (touchObject.behav[i].behav_type == "CloseAndResetChildren"){
                            reset = true;
                        }
                    }
                    for(let i = 0; i < touchObject.behav.length; i++){
                        if (touchObject.behav[i].behav_type != "CloseAndResetChildren"){

                            let gObj;
                            if ( touchObject.behav[i].obj_id ){
                                gObj = self.getObjectTypeByObj_id( touchObject.behav[i].obj_id );
                            } 

                            //[start-20231110-howardhsu-modify]//	
                            if(touchObject.behav[i].behav_type == "ShowQuiz"){
                                
                                //// 顯示 quiz 之前，先判斷 "瀏覽器本次載入場景後" 是否已經遊玩
                                if(touchObject.behav[i].played == false){
                                    self.triggerEvent( touchObject.behav[i], reset, touchObject )
                                } else {
                                    console.log('VRFunc.js: _setupFunction: endEvent:  Quiz had been played.', touchObject.behav[i].played)
                                }

                            } else if (touchObject.behav[i].behav_type == "Display"){
									
                                if ( gObj.obj_type == '2d' ){
                                    let tempBehav = Object.assign({}, touchObject.behav[i]);
                                    tempBehav.behav_type = "Display2D"; //// seperate from Display
                                    self.triggerEvent( tempBehav, reset , touchObject );
                                }else if ( gObj.obj_type == '3d' ){
                                    self.triggerEvent( touchObject.behav[i], reset, touchObject );
                                }
                                
                            // } else if (touchObject.behav[i].behav_type == "Media"){
									
                            //     if ( gObj.obj_type == '2d' ){
                            //         let tempBehav = Object.assign({}, touchObject.behav[i]);
                            //         self.triggerEvent( tempBehav, reset , touchObject );
                            //     }else if ( gObj.obj_type == '3d' ){
                            //         self.triggerEvent( touchObject.behav[i], reset, touchObject );
                            //     }
                                
                            } else {
                                self.triggerEvent( touchObject.behav[i], reset, touchObject );
                            }
                            //[end-20231110-howardhsu-modify]//	

                        }

                        if ( touchObject.behav[i].behav_type != 'FingerGesture' && touchObject.behav[i].behav_type != 'LookAt' ){
                            objectWithClickEvent = true;

                            //// 紀錄觸發到的事件
                            eventTriggered['3d_behav'] = touchObject.behav ;
                        }

                    }

                }

            }
    
            //// 假如「點擊觸發事件」跟「邏輯點擊」都沒有執行則判斷是否「點擊地板移動」
            console.log(' event logic check: ', objectWithLogicEvent , objectWithClickEvent );
            if (  objectWithLogicEvent == false && objectWithClickEvent == false ){
                // console.log(' both pass ', self.walkingStatus , self.viewMode );
                //// 先判斷是否有使用走動功能
                //// 也只有「VR觀看模式」可以使用
                if (  Number.isInteger (self.walkingStatus) && self.viewMode == 'VR' ){
                    //// 只有在待命狀態，才能觸發移動
                    if ( self.walkingStatus == 0 ){
    
                        let ground = document.getElementById('__ground');
                        let intersects = raycaster.intersectObjects( [ ground.object3D ], true ); 
    
                        if ( intersects.length > 0 ){
                            let selectedObject = intersects[0].object;
    
                            console.log(' selectedObject ', selectedObject );
                            
                            if ( selectedObject.el ){
                                if (selectedObject.el.getAttribute("id") == "__ground" ){
                                    console.log(' _endEvent: object is ground ');
    
                                    self.walkingStatus = 1;
                                    let pmd = self.cameraMoveToPoint( {position: intersects[0].point, dealBoundary: false } );
                                    pmd.then( function(){
                                        //// 將狀態設回來 
                                        self.walkingStatus = 0;
                                    });
    
                                    //// 紀錄觸發到的事件
                                    eventTriggered['ground_move'] = selectedObject ;
    
                                }else{
                                    console.log(' _endEvent: object is not ground ');
                                }
                            }else{
                                console.log(' _endEvent: object without el ');
                            }
                        }
    
                    }else if ( self.walkingStatus == -1 ){
                        console.log(' _endEvent: _walkingStatus =-1')
                    }else if ( self.walkingStatus == 1 ){
                        console.log(' _endEvent: _walkingStatus = 1')
                    }
    
                }
    
            }
            
            //// 判斷點擊是否有「觸發事件」，沒有的話，判斷
            if ( Object.keys( eventTriggered ).length == 0 ){
                console.log(' _entEvent: not touch anything ');
                
                if ( parent && parent.projMenuGroup && parent.controlGroup && parent.pictureBackground && parent.projectUIController && 
                    typeof(parent.projectUIController.showUI) == 'function' && typeof( parent.projectUIController.hideUI ) == 'function' 
                ){
                    if ( parent.projectUIController.status == 1){
                        //// 假如當前狀態是「顯示」，判斷是否超過一定時間，超過的話延續，還未到的話執行「隱藏」
                        if ( parent.projectUIController.g_tl_show._time > 3 ){
                            parent.projectUIController.showUI();
                        }else{
                            parent.projectUIController.hideUI();
                        }
                    }else if ( parent.projectUIController.status == 0 ) {
                        parent.projectUIController.showUI();
                    }else{
                        parent.projectUIController.showUI();
                    }
                }
    
            }else{
                console.log(' _entEvent:  touch somethong ', eventTriggered );
            }
    
        }  

    }

    triggerEvent( event, reset, makarObj ) {
        if (!this.FUNCTION_ENABLED){
            return;
        }
        var self = this;
        let target;
    
        //[start-20231130-renhaohsu-mod]
        if(typeof reset == 'undefined') reset = false;
        //[end-20231130-renhaohsu-mod]

        //[start-20230807-howardhsu-modify]//
        let obj_id = event.obj_id

        //// 觸發behav時也都dispatchEvent ( 也算是 for_makarSDK ) 
        // let vrDiv = document.getElementById("vrDiv");
        // vrDiv.addEventListener("MakarEvent", e => {
        //     console.log("%c MakarEvent(behav) e.detail=", 'color: MediumAquamarine;', e.detail)
        // })
        this.makarEvents.dispatchEvent(event);

        //// 3.5 沒有 simple_behav 了 變成 behav_type
        switch ( event.behav_type ){
            case "Dialing":
                console.log("VRFunc.js: triggerEvent: Dialing: event=", event );	
                let telTag = window.document.getElementById("phoneCall");
                telTag.href = "tel:"+event.phone ;
                telTag.click();
                break;
    
            case "Email":  
                console.log("VRFunc.js: triggerEvent: SendEmail: event=", event );	
                let mailTag = window.document.getElementById("sendEmail");
                mailTag.href = "mailto:" + event.mail_to ;
                mailTag.click();
                break;
    
            case "URL":
                console.log("VRFunc.js: triggerEvent: URL: event=", event , event.url );	
                let webTag = window.document.getElementById("openWebBrowser");
                webTag.href = event.url ;
                webTag.click();
                console.log("VRFunc.js: triggerEvent: URL: webTag=", webTag );	
                break;
                
            case "Scenes":
                console.log("VRFunc.js: triggerEvent: SceneChange: event=", event );
                            
                //[start-20240102-howarhdsu-add]//
                //// 因應 editor 有 "立即執行"、"延遲執行" 的設定
                if(event.delay == true){
                    if(event.previousID){
                        clearTimeout(event.previousID);
                    }
                    console.log("VRcontroller.js _triggerEvent: Delayed for 3 second.", event.behav_type);
                    let timeoutID = setTimeout(() => {
                        behavScenes()
                    }, 3000); 
                    event.previousID = timeoutID;
                    
                } else {
                    behavScenes()
                }   
                //[end-20240102-howarhdsu-add]//

                function behavScenes(){
                    let sceneID = event.scene_id;
                    let idx = self.projectIdx;          
    
                    for (let i = 0;i<self.scenesData.scenes.length;i++){
                        if(self.scenesData.scenes[i].info.id == sceneID){
                            
                            // window.activeVRScenes(i,j);
                            //// 先將觸控關閉，再跳轉場景
                            self.triggerEnable = false;
                            self.domElement.loadPage.style.display = "block";
        
                            //[start-20230725-howardhsu-modify]//
                            // if ( typeof( loadingTickOn )  != undefined ){
                                self.loadingTickOn = true;
                            // }
                            //[end-20230725-howardhsu-modify]//

                            self.pause2dVideos()
                            self.pause3dVideos()
        
                            self.loadScene(i);
        
                        }
                    }
                    //20200807-thonsha-mod-end
                    //20191023-end-thonsha-add
                }
                
                break;
                
            //[start-20231208-howarhdus-modify]//   
            //// ver. 3.5 顯示圖片、文字、模型、影片、播放聲音
            case "Display":  
                console.log("VRFunc.js: triggerEvent: Display: event=", event );
                
                target = document.getElementById(obj_id);
                if (!target){
                    console.warn('VRFunc.js: Media: target not exist', target);
                    break;
                }    

                //// 因應 editor 有 "立即執行"、"延遲執行" 的設定
                if(event.delay == true){ 
                    if(event.previousID){
                        clearTimeout(event.previousID);
                    }
                    console.log("VRcontroller.js _triggerEvent: Delayed for 3 second.", event.behav_type); 
                    let timeoutID = setTimeout(() => {
                        behavDisplay()
                    }, 3000); 
                    event.previousID = timeoutID;
                } else {
                    behavDisplay()
                }

                function behavDisplay(){                                        
                    if (target.nodeName.toLowerCase() == "a-sound"){
                        //// 聲音
                        if (event.switch_type == "Switch"){
                            if(target.getAttribute("visible")){
                                target.setAttribute("visible",false);
                                target.setAttribute('class', "unclickable" );
                                // target.components.sound.pauseSound();
                                target.components.sound.stopSound();
                                
                                //// 手動觸發 聲音播放完畢的event (如果此物件有被邏輯"播放聲音物件等待直到結束" 讓它底下的block繼續執行下去)
                                let event = new Event('sound-ended');
                                target.dispatchEvent(event);
                            }
                            else{
                                target.setAttribute("visible",true);
                                if(target.object3D.behav){
                                    target.setAttribute('class', "clickable" );
                                }   
                                
                                if ( target.blockly ){
                                    target.needReplay = true
                                    console.log('VRFunc.js: _showObjectEvent: set true, audio blockly: do nothing ', target );
                                } else {
                                    target.components.sound.playSound();        
                                }

                            }
                        }
                        else if(event.switch_type == "Show"){
                            target.setAttribute("visible",true);
                            if(target.object3D.behav){
                                target.setAttribute('class', "clickable" );
                            }   

                            if ( target.blockly ){
                                console.log('VRFunc.js: _showObjectEvent: set true, audio blockly: do nothing ', target );
                            } else {
                                target.components.sound.playSound();      
                            }
                            
                        }
                        else if(event.switch_type == "Hide"){
                            target.setAttribute("visible",false);
                            target.setAttribute('class', "unclickable" );
                            // target.components.sound.pauseSound();
                            target.components.sound.stopSound();
                            
                            //// 手動觸發 聲音播放完畢的event (如果此物件有被邏輯"播放聲音物件等待直到結束" 讓它底下的block繼續執行下去)
                            let event = new Event('sound-ended');
                            target.dispatchEvent(event);
                        }
                        
    
                    } else {
                        self.showObjectEvent(target, reset, event.switch_type);
                    }
                }
                break;

            //// temporary behavs for 2D scene
            case "Display2D":
                console.log("VRFunc.js: _triggerEvent: Display2D: event=", event );	

                //// 因應 editor 有 "立即執行"、"延遲執行" 的設定
                if(event.delay == true){
                    if(event.previousID){
                        clearTimeout(event.previousID);
                    }
                    console.log("VRcontroller.js _triggerEvent: Delayed for 3 second.", event.behav_type);
                    let timeoutID = setTimeout(() => {
                        behavDisplay2D()
                    }, 3000); 
                    event.previousID = timeoutID;
                } else {
                    behavDisplay2D()
                }

                function behavDisplay2D(){
                    //// 顯示or隱藏
                    let obj2D = self.makarObjects2D.find( o => o.obj_id == event.obj_id )
                    switch (event.switch_type) {
                        case "Switch":
                            if(obj2D) obj2D.visible = !obj2D.visible;
                            break;
                        case "Show":
                            obj2D.visible = true;
                            break;
                        case "Hide":
                            obj2D.visible = false;
                            break;
                        default:
                            break;
                    }

                    //// 播放or暫停
                    obj2D.traverse(function(child){
                        if( child.children.length==0 ){ return; }
                        if( !child.children[0].material ){ return; }
                        if( !child.children[0].material.map ){ return; }
                        
                        let material = child.children[0].material.map.image
                        if( !child.children[0].material.map.image ){ return; }
                        if( material.tagName.toLowerCase() == 'video' ){
                            // const isVideoPlaying = (material) => !!(material.currentTime > 0 && !material.paused && !material.ended && material.readyState > 2);
                            switch (event.switch_type) {
                                case "Switch":
                                    if(obj2D.visible){
                                        if (window.Browser){
                                            if (window.Browser.name == undefined || window.Browser.name == "safari" ){
                                            // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                                self.mute3dVideos();
                                                self.mute2dVideos();
                                            }
                                        }
                                        material.play()
                                        material.muted = false;
                                        self.safariUnMutedVideo = obj2D;
                                        
                                    } else {
                                        material.pause();
                                        
                                        if (window.Browser){
                                            if (window.Browser.name == undefined || window.Browser.name == "safari" ){
                                            // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                                self.UnMutedAndPlayAllVisibleVideo();
                                            }
                                        }
                                    }

                                    break;
                                case "Show":
                                    material.play();
                                    material.muted = false;
                                    self.safariUnMutedVideo = obj2D;
                                    break;
                                case "Hide":
                                    material.pause();
                                    if (window.Browser){
                                        if (window.Browser.name == undefined || window.Browser.name == "safari" ){
                                        // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                            self.UnMutedAndPlayAllVisibleVideo();
                                        }
                                    }
                                    break;
                                default:
                                    break;
                            }
                        }
                    });
                }
                break;
                    
            case "Animation":
                
                console.log("VRFunc.js: triggerEvent: Animation: event=", event );
                target = document.getElementById(obj_id);
                if (!target){
                    console.log('VRFunc.js: Animation: target not exist', target);
                    break;
                }
                
                let mainAnimation;
                for(let i=1;i<target.object3D.children[0].animationSlices.length;i++){
                    if (target.object3D.children[0].animationSlices[i].uid == event.uid){
                        mainAnimation = target.object3D.children[0].animationSlices[i].animationName;
                    }
                }
                target.setAttribute("animation-mixer", "clip: " + mainAnimation);
    
                if(event.loop){
                    target.object3D.children[0].animationSlices[0].loop = event.uid;
                    // target.object3D.children[0].animationSlices[0].idle = event.uid;
                    target.object3D.children[0].animationSlices[0].uid = event.uid;
                    target.object3D.children[0].animationSlices[0].changed = true;
                    target.object3D.children[0].animationSlices[0].reset = true;
                    // target.setAttribute('class', "unclickable" );
                }
                else{
                    target.object3D.children[0].animationSlices[0].uid = event.uid;
                    target.object3D.children[0].animationSlices[0].changed = true;
                    target.object3D.children[0].animationSlices[0].reset = event.reset;
                }
                break;
    
            case "TTS":
                console.log("VRFunc.js: _ReadText: ", event );
                //// 找到對應的文字物件
                if ( event.obj_id ){
                    let textObjID = event.obj_id;
                    let idx = self.projectIdx;
                    
                    if ( self.scenesData && self.scenesData.scenes[ self.sceneIndex ] && Array.isArray( self.scenesData.scenes[ self.sceneIndex ].objs ) ){
                        self.scenesData.scenes[ self.sceneIndex ].objs.forEach( e =>{
                            if ( e.generalAttr.obj_id == textObjID  ){
                                self.speechTextObj( e , event.speed, event.language);
                            }
                        });
                    }
                }
                //[end-20230808-howardhsu-modify]//
    
                break;

            //[start-20231207-howardhsu-modify]//
            case "ShowQuiz":
                //// 先確認是否已經有Quiz正在玩
                if( !window.aQuizVR.checkIsAnyQuizPlaying() ){
                    //// 若需要同時有複數個quiz
                    // if( true ){

                        const login_id = localStorage.getItem("MakarUserID") 
                        const proj_id = self.currentProjData.proj_id;

                        //// 以下將  "是否強制登入" "可否重複遊玩"  四種情形分開處理
                        if( event.force_login ){
                            //// 若該quiz在編輯器設定為"強制登入遊玩"，初步檢查是否登入。
                            if ( login_id ){
                                if(event.allow_retry){
                                    //// 該 quiz 在編輯器裡 設定為 "強制登入" "可重複遊玩"
                                    showQuizUI( self.worldContent.clickToPlay[self.languageType] )
                                } else {
                                    //// "強制登入" "不可重複遊玩" call後端api檢查是否有遊玩記錄
                                    checkApiRecordAndShowUI()
                                }                                
                            } else {
                                //// user沒有登入
                                console.log("%c VRcontroller.js: _triggerEvent ShowQuiz: user is not logged in.", "color: orange;")
                            }
                        } else if ( !event.force_login && event.allow_retry ){
                            //// 該 quiz 在編輯器裡 設定為 "不強制登入" "可重複遊玩"
                            showQuizUI(self.worldContent.clickToPlay[self.languageType])
                        } else if ( !event.force_login && !event.allow_retry ){
                            //// "不強制登入" "不可重複遊玩"    檢查 mdb 目前被點擊的 quiz 是否已遊玩過
                            checkMdbAndShowUI()
                        } else{
                            console.warn("VRControoller _triggerEvent: ShowQuiz error")
                        }


                        //// 顯示 html UI (startQuiz) 並給定文字
                        function showQuizUI(textContent){
                            //// 記錄當前被點擊要打開的quiz id
                            window.aQuizVR.currentlyTriggeredQuizId = event.obj_id
                                                                
                            const findLoadedQuiz = window.aQuizVR.loadedQuizzes.find(q => q.obj_id == event.obj_id)
                            if( findLoadedQuiz ){
                                if( findLoadedQuiz.isPlayed == true ) {
                                    return;
                                }
                            }
                            
                            //// 顯示問答初始頁面 給html UI文字
                            document.getElementById("QuizStartContent").textContent = textContent;
                            // let startQuiz = document.getElementById("startQuiz")			
                            // startQuiz.style.display = "block"
                            self.domElement.startQuiz.style.display = "block"
        
                            //// 把當前的 quiz trigger behav 記錄為已經played
                            makarObj.behav.forEach( b => {
                                if(b.behav_type == "ShowQuiz"){
                                    b.played = true
                                } 
                            })     
                        }

                        //// 檢查 後端API getRecordModule 是否有quiz遊玩記錄 ? 有的話不載入 : 否則載入quiz
                        function checkApiRecordAndShowUI(){
                            _networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].getRecordModule( login_id, proj_id ).then(ret => {
                                if(ret.data.record_module_list.length != 0){                                                
                                    //// 此登入用戶已經有遊玩記錄 
                            
                                    // console.log("record_module_list", ret.data.record_module_list)
                                    let quizProjectModuleRecord;
                                    if( ret.data.record_module_list && Array.isArray(ret.data.record_module_list) ){
                                        if(ret.data.record_module_list[0].project_module){
                                            quizProjectModuleRecord = ret.data.record_module_list[0].project_module
                                        }
                                    }

                                    //// 從記錄裡找 Quiz obj_id 確認是否玩過
                                    let played = false
                                    if(quizProjectModuleRecord){
                                        if(quizProjectModuleRecord.playedQuizzes && Array.isArray(quizProjectModuleRecord.playedQuizzes)){
                                            played = quizProjectModuleRecord.playedQuizzes.find( item => item.obj_id==event.obj_id)
                                            // console.log("從記錄裡找 Quiz obj_id 確認是否玩過", played) 
                                        }
                                    }
                                    
                                    if(played){
                                        //// 這Quiz已經遊玩過，跳出提示 
                                        showQuizUI( self.worldContent.userAlreadyPlayed[self.languageType] )
                                        let quitQuizFunc = function(){
                                            self.domElement.startQuiz.style.display = "none";
                                            QuizStartButton.removeEventListener("click",quitQuizFunc);
                                        }
                                        QuizStartButton.addEventListener("click",quitQuizFunc);    
                                    } else {
                                        //// 沒有遊玩記錄 ，直接載入問答資料
                                        showQuizUI( self.worldContent.clickToPlay[self.languageType] )
                                    }
                                    
                                } else{
                                    //// 沒有遊玩記錄 ，直接載入問答資料
                                    showQuizUI( self.worldContent.clickToPlay[self.languageType] )
                                }
                            })
                        }

                        //// 檢查 mdb 目前被點擊的 quiz 是否已遊玩過 ? 有的話不載入 : 否則載入quiz
                        function checkMdbAndShowUI(){
                            //// 先從mdb檢查 現在應該展示的 quiz 是否已遊玩過 (已考慮複數個quiz的情況)
                            let isThisQuizPlayed = false
                            aQuizVR.getQuizProjectFromMDB(self.scenesData.project_id).then(result => {                                        
                                if ( result ){
                                    //// 檢查 現在應該展示的 quiz 是否已遊玩過
                                    if( result.quizzes ){
                                        if( result.quizzes[event.obj_id] ){
                                            isThisQuizPlayed = true;
                                        }
                                    }
                                }
                                //// 該 quiz 尚未遊玩過
                                if(!isThisQuizPlayed){
                                    showQuizUI( self.worldContent.clickToPlay[self.languageType] )
                                } else {
                                    //// 該 quiz 已經遊玩過               
                                    showQuizUI( self.worldContent.userAlreadyPlayed[self.languageType] )                 
                                    let quitQuizFunc = function(){
                                        self.domElement.startQuiz.style.display = "none";
                                        QuizStartButton.removeEventListener("click",quitQuizFunc);
                                    }
                                    QuizStartButton.addEventListener("click",quitQuizFunc);           
                                    console.log('%c VRcontroller.js: _triggerEvent ShowQuiz: user has played this quiz already', 'color:orange')
                                }
                            })
                        }

                } else {
                    console.log("%cVRController.js _triggerEvent: ShowQuiz triggered, but user hasn't finnish previous quiz yet.", "color: orange")
                }

                break

            case "QuizOption":
                //// 考慮多個Quiz存在場上的情況，找出被點擊的是哪個Quiz的選項  (舊稱: "PushButton")
                // console.log("_vrController _triggerEvent _quizOption makarObj=", makarObj)
                aQuizVR.loadedQuizzes.forEach( q => {
                    q.module.json.question_list.forEach( question => {
                        question.options_json.forEach( option => {
                            if( makarObj.el ){
                                //// 3d
                                if( makarObj.el.id == option.generalAttr.obj_id){                               
                                    q.quizOption( makarObj.el )  //// 觸發點擊事件
                                }

                            } else {
                                //// 2d
                                if( makarObj.obj_id == option.generalAttr.obj_id){                               
                                    q.quizOption( makarObj )  //// 觸發點擊事件
                                }
                            }
                        })
                    })
                })		
                break					
            //[end-20231207-howardhsu-modify]//

            case "MoveAlongPath":
                let obj = document.getElementById(event.obj_id);
                obj.object3D.bezier.play();
                break;

            case "Skybox":

                //// 因應 editor 有 "立即執行"、"延遲執行" 的設定
                if(event.delay == true){
                    if(event.previousID){
                        clearTimeout(event.previousID);
                    }
                    console.log("VRcontroller.js _triggerEvent: Delayed for 3 second.", event.behav_type);
                    let timeoutID = setTimeout(() => {
                        behavSkybox()
                    }, 3000); 
                    event.previousID = timeoutID;
                } else {
                    behavSkybox()
                }

                function behavSkybox(){

                    let scene_skybox_res_id = event.skybox_id;
                    let sceneSky_info = {};

                    //// 從「使用者素材庫」查找天空物件資料
                    if ( self.userProjResDict[ scene_skybox_res_id ] ){
                        let skyObj = self.userProjResDict[ scene_skybox_res_id ]
                        if ( skyObj.main_type == 'spherical_image' || skyObj.main_type == 'spherical_video' ){
                            sceneSky_info = skyObj;
                        }                        
                    }

                    let scene_skybox_url = sceneSky_info.res_url;
                    let targetCube;
                    if ( THREE.WebGLRenderTargetCube ){
                        targetCube = new THREE.WebGLRenderTargetCube(1024, 1024);
                    }else{
                        targetCube = new THREE.WebGLCubeRenderTarget( 1024 );
                    }

                    (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_1__.UrlExists)( scene_skybox_url, function( retStatus ){
                        if (retStatus == false){
                            scene_skybox_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg";
                        }

                        let envTexture = new THREE.TextureLoader().load(
                            scene_skybox_url,
                            function() 
                            {
                                let cubeTex = targetCube.fromEquirectangularTexture(self.vrScene.renderer, envTexture);
                                self.cubeTex = cubeTex;

                                let scenes = [];
                                scenes = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_12__.verionControl.getScenes( self.scenesData );
                                let scene_id = scenes[self.currentSceneIndex].info.id;

                                let pSky = self.loadSky( self.vrScene, scene_id, sceneSky_info, self.loadSceneCount)   

                                pSky.then( function( ret ){
                                    console.log('VRFunc.js: _loadScene: pSky then ret = ', ret );     
                                    
                                    for (let i = 0; i < self.makarObjects.length;i++){
                                        let objj = self.makarObjects[i].getObject3D('mesh');
                                        if (objj){
                                            objj.traverse(node => {
                                                if (node.material) {
                                
                                                    node.material.envMap = self.cubeTex.texture;
                                                }
                                            });
                                        }
                                    }
                                });
                            }
                        );


                    });

                }

                

                break;

            case "Facing":
                //[start-20240130-renhaohsu-add]//
                if(event.delay == true){
                    if(event.previousID){
                        clearTimeout(event.previousID);
                    }
                    console.log("VRcontroller.js _triggerEvent: Delayed for 3 second.", event.behav_type);
                    let timeoutID = setTimeout(() => {
                        behavFacing()
                    }, 3000); 
                    event.previousID = timeoutID;
                    
                } else {
                    behavFacing()
                }   

                function behavFacing(){
                    console.log("_triggerEvent: _Facing event=", event)
                    let lookObjId = event.source_id;
                    let lookObj = document.getElementById( lookObjId );
                    let targetObjId = event.toward_id;
                    let targetObj = document.getElementById( targetObjId );
                    // console.log("_triggerEvent: _Facing event=", event, lookObj, targetObj)

                    //// 檢查物件是不是相機
                    if( !lookObj ){
                        const findLookObjObjJson = self.scenesData.scenes[self.sceneIndex].objs.find( o => o.generalAttr.obj_id == lookObjId )
                        if( findLookObjObjJson ){
                            if( findLookObjObjJson.main_type == "camera"){
                                console.log("_triggerEvent: Facing event, lookObj is camera", event)

                                //// 20240415 目前設定為 只在VR檢視模式時旋轉oCamera
                                lookObj = document.getElementById('aCamera');
                            } 
                        }
                    }

                    if( !targetObj ){
                        const findTargetObjJson = self.scenesData.scenes[self.sceneIndex].objs.find( o => o.generalAttr.obj_id == targetObjId )
                        if( findTargetObjJson ){
                            if( findTargetObjJson.main_type == "camera"){
                                //// 注視目標如果是相機，依照檢視模式決定哪個相機
                                const viewModeCamera = { "VR": aCamera, "model": oCamera}
                                targetObj = viewModeCamera[self.viewMode];
                                console.log("_triggerEvent: Facing event, targetObj is camera", targetObj, event)
                            } 
                        }
                    }

                    //// 確保「目標物件」「注視物件」都存在，建立持續事件
                    if (lookObj && lookObj.object3D && targetObj && targetObj.object3D ){
                        
                        self.addLookAtTimeLine( lookObj , targetObj , event );

                    }else{
                        console.log('_triggerEvent: _Facing error, obj not exist', lookObj , targetObj );
                    }
                }
                //[end-20240130-renhaohsu-add]//
                break

            case "videoTogglePlayPause":
                //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
                console.log("_videoTogglePlayPause", event)

                //// 3D
                target = document.getElementById(obj_id);
                //// 2D
                let obj2D = self.makarObjects2D.find( o => o.obj_id == event.obj_id )
                
                //// ios safari 需要先把其他影片都靜音
                if (window.Browser){
                    if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                    // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                        // self.UnMutedAndPlayAllVisibleVideo( target );
                        self.mute3dVideos()
                        self.mute2dVideos()
                    }
                }


                if (target){
                    //// 3D
                    if(target.localName=="a-video"){
                        ////     假如影片物件有「邏輯」，不予以控制
                        ////     ↑ 20240607 確認viewer行為: 場景初始時影片不播放 一旦user點擊時會播且有聲 (看似是點擊事件會忽略blockly是否有開) --renhao
                        // if ( child.el.blockly  ){
                        //     console.log('VRFunc.js: _videoTogglePlayPause: set false, video blockly: do nothing ', child );
                        // } else {
                            // let id = child.el.getAttribute("src");
                        let id = target.getAttribute("src");
                        if(id!=undefined){
                            id = id.split("#").pop();
                            let v = document.getElementById(id);
                            if (v instanceof HTMLElement){

                                const isVideoPlaying = (material) => !!(material.currentTime > 0 && !material.paused && !material.ended && material.readyState > 2);

                                if(isVideoPlaying(v)) {
                                    v.pause();
                                    v.muted = true;

                                    
                                    //// ios safari 需要先把其他影片都靜音
                                    if (window.Browser){
                                        if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                                        // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                            console.log("這裡應該讓其他的影片發出聲音")
                                            //// 這裡應該讓其他的影片發出聲音
                                            self.UnMutedAndPlayAllVisibleVideo()
                                        }
                                    }
                                    

                                } else {
                                    v.play();
                                    v.muted = false;
                                    self.safariUnMutedVideo = target;
                                }
                            }
                        }
                        // }
                    }
                } else if(obj2D){
                    //// 2D

                    //// 錯誤處理  (理論上影片2D物件 都該有以下這些)
                    if( obj2D.makarType != "video2D" ){ return; }
                    if( obj2D.children.length == 0 ){ return; }
                    if( !obj2D.children[0].material ){ return; }
                    if( !obj2D.children[0].material.map ){ return; }
                    if( !obj2D.children[0].material.map.image ){ return; }
                    
                    if( obj2D.children[0].material.map.image.tagName == "VIDEO" ){
                        const video = obj2D.children[0].material.map.image
                        if(video){
                            console.log("video.volume", video.volume)
                            if(video.volume != 0){
                                //// ios safari 需要先把其他影片都靜音
                                if (window.Browser){
                                    if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                                    // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                        self.UnMutedAndPlayAllVisibleVideo( obj2D );
                                    }
                                    else if(window.Browser.mobile == true){
                                        console.log("明明沒有對chrome做處理 但chrome也會自動只播放它然後停止別人  因此在點擊事件也要像ios一樣嗎")
                                        self.UnMutedAndPlayAllVisibleVideo( obj2D );
                                    }
                                }
                            }
                            
                            const isVideoPlaying = (video) => !!(video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2);
                            console.log("_videoTogglePlayPause obj2D isVideoPlaying" , isVideoPlaying)
                            if(isVideoPlaying(video)) {
                                video.pause();
                                video.muted = true;

                                if(video.volume != 0){
                                    //// ios safari 需要先把其他影片都靜音
                                    if (window.Browser){
                                        if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                                        // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                            //// 這裡應該讓其他的影片發出聲音
                                            self.UnMutedAndPlayAllVisibleVideo()
                                        }
                                        else if(window.Browser.mobile == true){
                                            console.log("chrome mobile ios 為何chrome自動播放會只剩一個然後停止別人??  所以在點擊事件也要像ios一樣嗎")
                                            self.UnMutedAndPlayAllVisibleVideo();
                                        }
                                    }
                                }
                                

                            } else {
                                video.play();
                                video.muted = false;
                                self.safariUnMutedVideo = obj2D;
                            }

                            
                        }
                    }


                } else {
                    //// 2D 3D 都找不到該 obj_id, 不應該發生
                    console.warn('VRFunc.js: _videoTogglePlayPause: target not exist. obj_id=', obj_id, " target=", target);
                    break;
                }

                break;

            default:
                console.log("VRFunc.js: triggerEvent: default: event=", event );	
    
                break;
        }
    
    }

    getSnapShot() {

        let self = this;
    
        let pSnapShot = new Promise( function( snapResolve ){
    
            if (!self.FUNCTION_ENABLED){
                snapResolve( -1 ); 
                return;
            }
    
            if ( !self || !self.GLRenderer || !self.vrScene || !self.GLRenderer.domElement || !self.vrScene.object3D ||
                !self.GLRenderer.domElement.clientWidth || !self.GLRenderer.domElement.clientHeight || 
                !self.GLRenderer.domElement.width || !self.GLRenderer.domElement.height 
            ){
                console.log(' _VRController: _getSnapShot: something error ', self );
                snapResolve( -1 );
                return;
            }
    
            self.GLRenderer.clearDepth();
            self.GLRenderer.render( self.vrScene.object3D, self.vrScene.camera );
            self.GLRenderer.render( self.scene2D, self.camera2D );
            
            // let size = self.GLRenderer.getSize();
    
            let dataURL = self.GLRenderer.domElement.toDataURL("image/png", 1.0);
    
            //// 改變 canvas，必須的。讓圖片原版比例改變。
            // let ccw = self.GLRenderer.domElement.clientWidth;
            // let cch = self.GLRenderer.domElement.clientHeight;
            // let cw = self.GLRenderer.domElement.width;
            // let ch = self.GLRenderer.domElement.height;
    
            // console.log('XRFunc.js: _SnapShot: canvas client wh= ',  ccw, cch, 'canvas wh=', cw, ch );
            // let newCanvas = document.createElement('canvas');
            // newCanvas.width = cw;
            // newCanvas.height = cw * ( cch / ccw );
            // let newCtx = newCanvas.getContext('2d');
            // newCtx.drawImage(self.GLRenderer.domElement, 0, 0, cw, ch, 0, 0, newCanvas.width , newCanvas.height );
            // var dataURL = newCanvas.toDataURL("image/png", 1.0);
    
    
            snapResolve( dataURL ) ; 
    
        } );
    
        return pSnapShot ;
    
    }

    startWebCam( callback ){
        let self = this
        let onError = function(err) { 
            console.error("VRController: _startWebCam error:", err); 

            self.video = { videoWidth: innerWidth, videoHeight: innerHeight };

            let w = innerWidth;
            let h = innerHeight;

            let camera2D = new THREE.OrthographicCamera( -w/2, w/2, -h/2, h/2, -100, 20000);
            self.camera2D = camera2D;

            //////////////////////////////
            
            let camera3D = new THREE.PerspectiveCamera(  60, w/h, 0.3 ,  10000 );
            self.camera3D = camera3D;

            let aCamera = document.getElementById('aCamera');
            aCamera.setObject3D( 'camera', camera3D );
            let cameraData = {
                aspect: w/h,
                near: 0.3,
                far: 10000,
                fov: 60,
            }
            aCamera.setAttribute('camera' , cameraData );
            self.vrScene.camera = camera3D;

            let rotation = new THREE.Vector3();
            rotation.multiply( new THREE.Vector3(-1,-1,0) ).add( new THREE.Vector3(0, 180, 0) );
            aCamera.components["look-controls"].yawObject.rotation.y = rotation.y/180*Math.PI;
            aCamera.components["look-controls"].pitchObject.rotation.x = rotation.x/180*Math.PI;
            
            
            //////////////////////////////

            let oCamera = document.getElementById('oCamera');							
            let oCamera3D = new THREE.PerspectiveCamera(  60, w/h, 0.3 ,  10000 );

            let originOCameraPosition = oCamera.getObject3D('camera').position.clone();
            oCamera3D.position.copy( originOCameraPosition );

            self.oCamera3D = oCamera3D;
            oCamera.setObject3D( 'camera', oCamera3D );
            oCamera.setAttribute('camera' , cameraData );

            oCamera.components['camera'].camera = oCamera3D;
            oCamera.components['orbit-controls'].controls.object = oCamera3D;

            if ( parent.selectedProject ){
                if ( parent.selectedProject.viewMode == 'VR' ){
                    self.setViewMode( 'VR' );
                }else if (parent.selectedProject.viewMode == 'model'){
                    self.setViewMode( 'model' );
                }else{
                    self.setViewMode( 'VR' );
                }
            }else{
                self.setViewMode( 'VR' );
            }


            callback( false );

        };

        ////// check the previous camera facing
        var cameraFacing = localStorage.getItem("cameraFacing");	
        var doExchangeCamera = localStorage.getItem("doExchangeCamera");
        if ( doExchangeCamera == 1 ){
            if (cameraFacing == "environment"){ // base on last cameraFacing to reverse it 
                localStorage.setItem("cameraFacing", "user");
                console.log("------- set _cameraFacing to user");
            }else{
                localStorage.setItem("cameraFacing", "environment");
                console.log("------- set _cameraFacing to environment");
            }
        } else{
            localStorage.setItem("cameraFacing", "environment"); // reset facing to environment 
            if ( window.makarID ){  // directly startAR process if the window.makarID exist.
                localStorage.setItem( "makarID",  window.makarID );
            }else{
                console.log("three.js: doExchangeCamera != 1, window.makarID isn't exist, wait the Start AR button trigger" );	
            }
        }
        var currentCameraFacing = localStorage.getItem("cameraFacing");	
        localStorage.setItem( "doExchangeCamera", 0);

        let video = document.createElement('video');
        // let configuration = { facing: "environment", };
        let configuration = { facing: currentCameraFacing };
        let texture = new THREE.VideoTexture(video);
        texture.minFilter = THREE.LinearFilter;
        texture.flipY = false;
        // texture.format = THREE.RGBFormat; // THREE.RGBAFormat
        texture.format = THREE.RGBAFormat; // THREE.RGBAFormat

        //20221207-thonsha-add-start
        self.cameraTexture = texture;
        //20221207-thonsha-add-end

        let rendererSize = new THREE.Vector2();
        self.vrScene.renderer.getSize( rendererSize );
        

        if ( navigator.mediaDevices  ) {

            let videoSuccess = function(stream){
                console.log("VRFunc.js: _startWebCam: _videoSuccess: stream=", stream );

                window.videoStream = stream;
                // window.stopVideoStream = function(){
                // 	var track = stream.getTracks()[0];  // if only one media track
                // 	track.stop();
                // }

                video.srcObject = stream;
                let readyToPlay = true;
                video.playsInline = true;
                video.onloadedmetadata = function() {
                    function tick_video(){
                        if (video.videoWidth > 200 || video.videoHeight > 200){
                            console.log("VRFunc.js: tick_video play video[w, h]=", video.videoWidth, video.videoHeight );
                            //// 將video 物件記錄下來，在後面等 renderer 開始工作後再啟動
                            self.video  = video;
                            // video.play();

                            //////// set the div size depend on video
                            let videoWidth, videoHeight;
                            let vrDiv = document.getElementById("vrDiv");
                            let w, h;
                            if ( rendererSize.x/rendererSize.y > video.videoWidth/video.videoHeight ){
                                // videoWidth  = Math.round(rendererSize.y -0) * video.videoWidth/video.videoHeight ;
                                // videoHeight = Math.round(rendererSize.y -0);
                                
                                w = window.innerWidth  ;
                                h = (window.innerWidth/video.videoWidth)* video.videoHeight;

                                console.log(" 1 VRFunc.js: set div size = ", innerWidth, innerHeight, w ,h, videoWidth, videoHeight );
                            }else{
                                // videoWidth  = Math.round( rendererSize.x );
                                // videoHeight = Math.round( rendererSize.x * video.videoHeight/video.videoWidth );
                                
                                w = (window.innerHeight/video.videoHeight) * video.videoWidth ;
                                h = window.innerHeight;
                                
                                console.log(" 2 VRFunc.js: set div size = ", innerWidth, innerHeight, w ,h, videoWidth, videoHeight );
                            }
                            //// fill height or widht, left some area blank
                            // vrDiv.style.width  = videoWidth + "px" ;    //  
                            // vrDiv.style.height = videoHeight + "px" ;//
                            
                            // // full fill, left nothing blank
                            // vrDiv.style.width  = w + "px" ;
                            // vrDiv.style.height = h + "px" ;
                            // //// align the div and body
                            // vrDiv.style.left = ( innerWidth - w )/2 + "px" ;
                            // vrDiv.style.top  = ( innerHeight - h )/2 + "px" ;

                            //// 原本是「改動 div 」現在換「改動 canvas 」
                            self.GLRenderer.setSize( w , h );
                            self.vrScene.canvas.style.left = ( innerWidth - w )/2 + "px" ;
                            self.vrScene.canvas.style.top  = ( innerHeight - h )/2 + "px" ;

                            self.vrScene.resize(); ////// it must call after renderer resize

                            ///// 這邊發現，畫布的精細度可以依照下列方式調製整，讓手機上解析度提高                            
                            if (Browser){
                                let dw, dh;
                                if ( Browser.desktop == true ){
                                    //// 電腦端，調整概念為「短邊一定要超過 1280 、長邊不超過 2560 」，由於目前 新版 webXR 設定 此 iframe 高度只有 600 所以這邊必定要觸發
                                    //// 先預計未來 iframe 會調整大小，所以這邊還是好好寫判斷
                                    let wx = rendererSize.x;
                                    let wy = rendererSize.y;

                                    if ( w > 2560 || h > 2560 ){
                                        if ( w > h ){
                                            dw = 2560  ;
                                            dh = 2560 * h/w ;
                                        }else{
                                            dw = 2560 * w/h ;
                                            dh = 2560 ;
                                        }
                                        self.GLRenderer.setSize( dw , dh , false );
                                    }else if ( wx < 1280 || wy < 1280 ){
                                        if ( w > h ){
                                            dw = 1280 * w/h ;
                                            dh = 1280 ;
                                        }else{
                                            dw = 1280 ;
                                            dh = 1280 * h/w ;
                                        }
                                        self.GLRenderer.setSize( dw , dh , false );
                                    }

                                }else if ( Browser.mobile == true ){
                                    //// 手機端，調整概念為「無條件補滿 720 」
                                    if ( w < 720 || h < 720){
                                        
                                        if ( w > h ){
                                            dw = 720;
                                            dh = 720/w * h;
                                        }else{
                                            dw = 720/h * w;
                                            dh = 720;
                                        }
                                        self.GLRenderer.setSize( dw , dh , false );
                                    }
                                }
                            }

                            ////// setup the camera for 2D scene( 20200314 useless )
                            // let camera2D = new THREE.OrthographicCamera( -w/2, w/2, -h/2, h/2, -10, 20000);
                            //// 20201110 fei: 設定相機跟背景的時候直接使用『實體相機畫面尺寸』作為設定，手機端基本是[480, 640] 電腦端基本是[640, 480]
                            videoWidth = texture.image.videoWidth,  videoHeight = texture.image.videoHeight;

                            let camera2D = new THREE.OrthographicCamera( -w/2, w/2, -h/2, h/2, -100, 20000);
                            // let camera2D = new THREE.OrthographicCamera( -videoWidth/2, videoWidth/2, -videoHeight/2, videoHeight/2, -10, 20000);

                            self.camera2D = camera2D;


                            //// 重設 3D 場景相機
                            let camera3D = new THREE.PerspectiveCamera(  60, w/h, 0.3 ,  10000 );
                            self.camera3D = camera3D;

                            //// 設定 enitity 下的「預設相機」為新創建的相機
                            let aCamera = document.getElementById('aCamera');
                            aCamera.setObject3D( 'camera', camera3D );

                            let cameraData = {
                                aspect: w/h,
                                near: 0.3,
                                far: 10000,
                                fov: 60,
                            }

                            aCamera.setAttribute('camera' , cameraData );

                            //// 原本使用「把相機新增到容器下」、「指定相機」、「移除舊相機」
                            //// 但此方式還是會在 getObject3D('camera') 時候取得 舊相機。

                            // self.vrScene.camera.parent.add( camera3D  );
                            aCamera.components['camera'].camera = camera3D;
                            // self.vrScene.camera.parent.remove( self.vrScene.camera );

                            self.vrScene.camera = camera3D;

                            let rotation = new THREE.Vector3();
                            rotation.multiply( new THREE.Vector3(-1,-1,0) ).add( new THREE.Vector3(0, 180, 0) );

                            aCamera.components["look-controls"].yawObject.rotation.y = rotation.y/180*Math.PI;
                            aCamera.components["look-controls"].pitchObject.rotation.x = rotation.x/180*Math.PI;

                            /////////////////////////////////////////////////////////

                            let oCamera = document.getElementById('oCamera');							
                            let oCamera3D = new THREE.PerspectiveCamera(  60, w/h, 0.3 ,  10000 );

                            let originOCameraPosition = oCamera.getObject3D('camera').position.clone();
                            oCamera3D.position.copy( originOCameraPosition );

                            self.oCamera3D = oCamera3D;
                            oCamera.setObject3D( 'camera', oCamera3D );
                            oCamera.setAttribute('camera' , cameraData );

                            // oCamera.object3D.add( oCamera3D );
                            // oCamera.object3D.remove( oCamera.object3D.children[0] )
                            oCamera.components['camera'].camera = oCamera3D;
                            oCamera.components['orbit-controls'].controls.object = oCamera3D;

                            if ( parent.selectedProject ){
                                if ( parent.selectedProject.viewMode == 'VR' ){
                                    self.setViewMode( 'vR' );
                                }else if (parent.selectedProject.viewMode == 'model'){
                                    self.setViewMode( 'model' );
                                }else{
                                    self.setViewMode( 'VR' );
                                }
                            }else{
                                self.setViewMode( 'VR' );
                            }


                            ////// setup the camera for background video
                            let videoCamera = new THREE.OrthographicCamera( -videoWidth/2, videoWidth/2, -videoHeight/2, videoHeight/2, -10, 20000);
                            self.videoCamera = videoCamera;
                            
                            ////// setup videoPlane
                            let videoPlane = new THREE.Mesh(
                                // new THREE.PlaneBufferGeometry(640, 480),
                                // new THREE.PlaneBufferGeometry( document.documentElement.clientWidth , document.documentElement.clientHeight ),
                                // new THREE.PlaneBufferGeometry( videoWidth , videoHeight ),
                                new THREE.PlaneGeometry( videoWidth , videoHeight ),	
                                new THREE.MeshBasicMaterial( { map:texture, side: THREE.DoubleSide } ) ,
                            );
                            // videoPlane.material.depthTest = false;
                            // videoPlane.material.depthWrite = false;
                            videoPlane.position.set(0, 0, -1 );
                            self.videoScene.add( videoPlane );

                            //// 紀錄讓後續切換相機時候使用
                            self.videoPlane = videoPlane;
                            
                            if ( callback ) { callback( true ); }

                        }else{
                            console.log("tick_video else video[w, h]=", video.videoWidth, video.videoHeight );
                            setTimeout(tick_video, 100);
                        }
                    }
                    if ( self.videoCamera ){
                        console.log("VRFunc.js: _startWebCam: videoCamera exist, donothing ");
                    }else{
                        console.log("VRFunc.js: _startWebCam: videoCamera not exist, start video ");
                        tick_video();
                    }
                    
                }
            }

            
            navigator.mediaDevices.enumerateDevices().then(function(devices) {
                let useDeviceID = false;
                let cameraID, facingString, video_constraints;
                devices = devices.filter(function(devices) { return devices.kind === 'videoinput'; });
                if ( configuration.facing == "environment" ){facingString = "back";} 
                else if (configuration.facing == "user" ){facingString = "front";} 
                else{facingString = "back";}
                for (let i in devices){
                    // if ( !devices[i].label ){ useDeviceID = false; }
                    if( devices[i].label.toLowerCase().search( facingString ) != -1  ){ // front back
                        cameraID = devices[i].deviceId;
                        useDeviceID = true;
                    }
                    // console.log("VRFunc.js: devices=", devices[i] );
                }
                if (useDeviceID){ // PC, android chrome/FireFox, use the specific id by labels.
                    console.log("VRFunc.js: useDeviceID true, cameraID=", cameraID );
                    video_constraints = {
                        video: {
                            width: { min: 320, ideal: 640, max: 1280 },
                            height: { min: 240, ideal: 480, max: 800 }, 
                            frameRate: { min:15, ideal: 30, max: 60 },
                            deviceId: {'exact':cameraID }
                        }
                    };
                }else{
                    let facing;
                    if ( configuration.facing ){ //// usually iOS safari and QQ, use "user"/"environment" to start
                        facing = configuration.facing;
                        console.log("VRFunc.js: configuration.facing do exist: set facing = ", facing );
                        video_constraints = {
                            video: {
                                width: { min: 320, ideal: 640, max: 1280 },
                                height: { min: 240, ideal: 480, max: 800 }, 
                                frameRate: { min:15, ideal: 30, max: 60 },
                                facingMode: facing
                            }
                        };
                    }else{
                        console.log("api.js: configuration.facing dosent exist: set facing = environment" );
                        video_constraints = {
                            video: {
                                width: { min: 320, ideal: 640, max: 1280 },
                                height: { min: 240, ideal: 480, max: 800 }, 
                                frameRate: { min:15, ideal: 30, max: 60 },
                                facingMode: 'environment'
                            }
                        };
                    }
                }


                ///////// start simply //////////////
                navigator.mediaDevices.getUserMedia( video_constraints ).then(videoSuccess, onError); // successCallback
            
            });
            
        } else {
            if (navigator.getUserMedia) {
                navigator.getUserMedia(hdConstraints, success, onError);
            } else {
                onError('navigator.getUserMedia is not supported on your browser');
            }
        }
        
    }


    ///// 原本「切換鏡頭」的功能很蠢，要重新載入網頁，改為只要重新啟動相機即可
    switchCamera( cc ){

        let self = this ;

        //// 預設為「後鏡頭」
        let configuration = cc ? cc : { facing: 'environment' };

        //// 先確認當前相機是哪個面向。
        let facing = localStorage.getItem("cameraFacing");
        if ( facing == null ){
            localStorage.setItem("cameraFacing", 'environment' );
        } else if ( facing == 'environment' ){
            configuration.facing = 'user';
            localStorage.setItem("cameraFacing", 'user' );
        } else if ( facing == 'user' ){
            configuration.facing = 'environment';
            localStorage.setItem("cameraFacing", 'environment' );
        }

        self.video.srcObject.getTracks().forEach( e => {
            e.stop();
        }) ;
        

        let videoSuccess = function(stream){
            console.log("three.js: _startWebCam: videoSuccess: stream=", stream );

            window.videoStream = stream;

            if ( self.videoPlane.material.map.image ){
                let video = self.videoPlane.material.map.image;
                video.srcObject = stream;
                video.playsInline = true;
                video.onloadedmetadata = function() {
                    function tick_video(){
                        if (video.videoWidth > 200 || video.videoHeight > 200){
                            //// 將video 物件記錄下來，在後面等 renderer 開始工作後再啟動
                            video.play();
                            console.log('three.js: _switchCamera: video play  ');
                        }else{
                            setTimeout(tick_video, 100);
                        }
                    }
                    if ( self.videoCamera ){
                        console.log("three.js: _startWebCam: videoCamera exist, donothing ");
                    }else{
                        console.log("three.js: _startWebCam: videoCamera not exist, start video ");
                        // tick_video();
                    }
                    tick_video();
                }
                self.streamVideo = video;
            }
        }

        let onError = function( e ){
            console.log('three.js: _switchCamera: onError e = ', e );
        }

        navigator.mediaDevices.enumerateDevices().then(function(devices) {
            let useDeviceID = false;
            let cameraID, facingString, video_constraints;
            devices = devices.filter(function(devices) { return devices.kind === 'videoinput'; });
            if ( configuration.facing == "environment" ){facingString = "back";} 
            else if (configuration.facing == "user" ){facingString = "front";} 
            else{facingString = "back";}
            for (let i in devices){
                // if ( !devices[i].label ){ useDeviceID = false; }
                if( devices[i].label.toLowerCase().search( facingString ) != -1  ){ // front back
                    cameraID = devices[i].deviceId;
                    useDeviceID = true;
                }
                // console.log("three.js: devices=", devices[i] );
            }
            if (useDeviceID){ // PC, android chrome/FireFox, use the specific id by labels.
                console.log("three.js: _useDeviceID true, cameraID=", cameraID );
                video_constraints = {
                    video: {
                        width: { min: 320, ideal: 640, max: 1280 },
                        height: { min: 240, ideal: 480, max: 800 }, 
                        frameRate: { min:15, ideal: 30, max: 60 },
                        deviceId: {'exact':cameraID }
                    }
                };
            }else{
                let facing;
                if ( configuration.facing ){ //// usually iOS safari and QQ, use "user"/"environment" to start
                    facing = configuration.facing;
                    console.log("three.js: _configuration.facing do exist: set facing = ", facing );
                    video_constraints = {
                        video: {
                            width: { min: 320, ideal: 640, max: 1280 },
                            height: { min: 240, ideal: 480, max: 800 }, 
                            frameRate: { min:15, ideal: 30, max: 60 },
                            facingMode: facing
                        }
                    };
                }else{
                    console.log("api.js: _configuration.facing dosent exist: set facing = environment" );
                    video_constraints = {
                        video: {
                            width: { min: 320, ideal: 640, max: 1280 },
                            height: { min: 240, ideal: 480, max: 800 }, 
                            frameRate: { min:15, ideal: 30, max: 60 },
                            facingMode: 'environment'
                        }
                    };
                }
            }

            navigator.mediaDevices.getUserMedia( video_constraints ).then(videoSuccess, onError); // successCallback

        });

        
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (VRController);

/***/ }),

/***/ "./js/VRMain/version3_5/VRFunc.js":
/*!****************************************!*\
  !*** ./js/VRMain/version3_5/VRFunc.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _handleAframeEvent_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./handleAframeEvent.js */ "./js/VRMain/version3_5/handleAframeEvent.js");
/* harmony import */ var _VRController_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./VRController.js */ "./js/VRMain/version3_5/VRController.js");
/* harmony import */ var _networkAgent_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./networkAgent.js */ "./js/VRMain/version3_5/networkAgent.js");





// import "./Quiz.js";

// import { OrbitControls } from '../../../lib/three/addons/controls/OrbitControls.js';

// import { CSS2DRenderer, CSS2DObject } from '../../../lib/three/addons/renderers/CSS2DRenderer.js';

(function(){

    const integrate = () => {

		AFRAME.registerComponent('initvrscene', {
			init: function () {
				var sceneEl = this.el;
			}
		});
	
        AFRAME.registerComponent('cursor-listener', {
			init: function () {
				//20191023-start-thonsha-mod

				// this.el.addEventListener( 'touchend', endEvent, false );
				// this.el.addEventListener( 'mouseup', endEvent, false );
				// this.el.addEventListener( 'click', clickEvent, false );
				// this.el.addEventListener( 'fusing', fusingEvent, false );

				function fusingEvent(event){
					event.preventDefault();
                    (0,_handleAframeEvent_js__WEBPACK_IMPORTED_MODULE_1__.handleFusingEvent)( event )
				}	

				function clickEvent( event ) {
					event.preventDefault();
                    (0,_handleAframeEvent_js__WEBPACK_IMPORTED_MODULE_1__.handleClickEvent)( event ) 
				}				
				//20191023-end-thonsha-mod
			}
		});

        //[start-20191111-fei0079-add]//
        (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.checkHost_tick)();
        Module.checkMifly();
        //[end---20191111-fei0079-add]//
    
        window.showVRProjList = function( oneProjData ){

            console.log('VRFunc.js: version: 2022-07-28 1650 ');

            // if ( parent && parent.selectedProject && typeof( parent.selectedProject.proj_id ) == 'string' && typeof( parent.selectedProject.user_id ) == 'string'
            if ( oneProjData && typeof( oneProjData.user_id ) == 'string' && typeof( oneProjData.proj_id ) == 'string'
            ){
                //// 使用者 ID
                // let user_id = parent.selectedProject.user_id;
                let user_id = oneProjData.user_id

                //// 專案 ID
                let project_ids = [
                    // parent.selectedProject.proj_id
                    oneProjData.proj_id
                ]
                
                //// for_makarSDK : 若有 makarSDK 則檢查 proj_id
                //// 先認定SDK是 webXR 經過小幅度修改並打包的產物
                if(window.makarSDK){
                    let makarSDK_proj_id = window.makarSDK.config.proj_id
                    let makarSDK_user_id = window.makarSDK.config.user_id

                    //// 對 proj_id 做必要的檢查
                    if ( window.makarSDK && window.makarSDK.config.proj_id && typeof( makarSDK_proj_id ) == 'string' && typeof( makarSDK_user_id ) == 'string'
                    ){
                        if( makarSDK_proj_id != oneProjData.proj_id ) {
                            console.error("MakarSDK is initiated, but config is conflict with oneProjData. makarSDK.config=", makarSDK.config)
                            return;
                        }

                        //// 目前不允許SDK取得 好友/私人 專案 (permission為3 or 4)
                        if(makarSDK_user_id){
                            //// 因此 user_id 現在並非必要 (以後若架構或api有修改時再增加判斷)  
                            if( makarSDK_user_id != oneProjData.user_id ) {
                                //// 留一個log作為提醒
                                console.warn("MakarSDK is initiated, but config is conflict with oneProjData. Using oneProjData instead of makarSDK.config.")
                            }
                        }
                        
                        //// 上述都通過表示 "正在使用makarSDK"
                        project_ids = [
                            makarSDK_proj_id
                        ]
                        user_id = makarSDK_user_id
                        
                    } else {
                        console.error("MakarSDK is initiated, but lack of config.", MakarSDK.config)
                        return ;
                    }
                }
                
                //// 暫用的「 資料物件 」，預期會帶有 「當前專案」「當前場景列表」「使用者素材」「使用者線上塑」「使用者辨識圖素材」 。未來預計新增「使用者材質庫素材」
                let makarUserData = {};
                window.makarUserData = makarUserData;

                makarUserData.oneProjData = oneProjData;

                //// 所有 net 相關 Promise 列表
                let pScenesAll = [];

                let pScenes = _networkAgent_js__WEBPACK_IMPORTED_MODULE_3__["default"].getProjectSceneList( project_ids );
				let pUOR = _networkAgent_js__WEBPACK_IMPORTED_MODULE_3__["default"].getUserOnlineResources( user_id );
				let pUR = _networkAgent_js__WEBPACK_IMPORTED_MODULE_3__["default"].getUserResources( user_id );
                let pUM = _networkAgent_js__WEBPACK_IMPORTED_MODULE_3__["default"].GetUserMaterials( user_id );

                // let pUM = net.GetUserMaterialsbyID( user_id,  makarUserData.scenesData.scenes[0].material_ids);

				pScenesAll.push( pScenes );
				pScenesAll.push( pUOR );
                pScenesAll.push( pUR );
                pScenesAll.push( pUM );

                //// 場景相關資料
                pScenes.then( function(ret){
					console.log(' _pScenes_: ' , ret );
					if ( ret.data && Array.isArray( ret.data.projectSceneList ) && ret.data.projectSceneList.length == 1 ){
						makarUserData.scenesData = ret.data.projectSceneList[0];
					}
				});
                
                //// 使用者線上素材
                pUOR.then( function(ret){
					// console.log(' _pUOR_: ' , ret );
					if ( ret.data && Array.isArray( ret.data.onlineResourcesList ) ){
						let onlineResourcesList = ret.data.onlineResourcesList;

						makarUserData.onlineResourcesList = onlineResourcesList;

						//// 為了方便使用，將「使用者線上素材列表」轉換為「素材字典」
						/*
							userProjResDict={
								res_id: {}
							}

						*/
						
						let userOnlineResDict = {};
						for (let i = 0; i < onlineResourcesList.length; i++ ){
							userOnlineResDict[ onlineResourcesList[i].res_id ] = onlineResourcesList[i];
						}
						makarUserData.userOnlineResDict = userOnlineResDict;

					}
                });

                //// 使用者上傳素材
                pUR.then( function(ret){
					// console.log(' _pUR_: ' , ret );
					if ( ret.data && Array.isArray( ret.data.resourcesList ) ){
						let resourcesList = ret.data.resourcesList;
						makarUserData.resourcesList = resourcesList;

						//// 為了方便使用，將「素材列表」轉換為「素材字典」
						/*
							userProjResDict={
								res_id: {}
							}

						*/
						let userProjResDict = {};
						for (let i = 0; i < resourcesList.length; i++ ){
							userProjResDict[ resourcesList[i].res_id ] = resourcesList[i];
						}
						makarUserData.userProjResDict = userProjResDict;

					}
				});

                //// 使用者材質球
                pUM.then( function(ret){
					console.log(' _pUM_: ' , ret );
					if ( ret.data && Array.isArray( ret.data.materials ) ){
						let materials = ret.data.materials;
						makarUserData.materials = materials;

                        let userMaterialDict = {};
						for (let i = 0; i < materials.length; i++ ){
							userMaterialDict[ materials[i].id ] = materials[i];
						}
						makarUserData.userMaterialDict = userMaterialDict;

					}
				});

                Promise.all( pScenesAll ).then( function( ret ){
					console.log(' _pScenesAll_ ' , ret );

                    //// 看到AR有delete的寫法，VR這裡也加上 ()
                    window.showVRProjList  = undefined
                    
                    activeVRScenes( 0 );
					
				})

            }



        //     //20200102-start-thonsha-add
        //     // requestDeviceMotionPermission();
        //     //20200102-end-thonsha-add
        //     let url = window.serverUrl;
        //     let makarID;

        //     //[start-20200211-fei0090-add]//
        //     ////// 
        //     ////// the user_id and project from main page
        //     //////

        //     ////// check the webpage is iframe or not
        //     if ( window.top != window.self || true ){ 
        //         // console.log("__VRFunc.js: _showVRProjList: _getVRSceneByUserID: parent selectedProject=", parent.selectedProject , ", _userPublishProjs=" , parent._userPublishProjs);
            
        //         makarID = parent.selectedProject.user_id;
                
        //         //// 這邊指定「userID」
        //         // makarID = "thonsha" ;
        //         // makarID = "fefe" ;
        //         // makarID = "class05" ;
        //         // makarID = "1626f751-f2d6-4416-8e54-a1cb6b32f870" ;
                    
        //         console.log("VRFunc.js: _showVRProjList: : makarID=", makarID);
        //         getVRSceneByUserID(url, makarID, function(data){
        
        //             console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID: VRSceneResult=", VRSceneResult , publishVRProjs , userPublishProjs );				
                    
        //             if (typeof(data) == "string"){ // error occur
        //                 str = data;
        //                 if (document.getElementById("freeUserWarnDiv")){
        //                     document.getElementById("freeUserWarnDiv").style.display = "block";
        //                     document.getElementById("pUserInfo").textContent =  str  ;
        //                     // document.getElementById("pUserInfo").style.color = "red";
        //                     leaveIframe.onclick = function(){
        //                         event.preventDefault();
        //                         if (parent.aUI){
        //                             // parent.aUI.closeCoreIframe();
        //                         }
        //                     }
        //                 }
        
        //             }else{ // general state.
        //                 if (document.getElementById("freeUserWarnDiv")){
        //                     document.getElementById("freeUserWarnDiv").style.display = "none";
        //                 }
        //                 for (let i = 0 ; i < publishVRProjs.result.length ; i++  ){
                            
        //                     if (publishVRProjs.result[i].proj_id == parent.selectedProject.proj_id ){
        //                         console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID: i=", i , publishVRProjs.result[i] , VRSceneResult[i] );		
        
                                    
        //                         ////// 假如判定為『不可使用web服務』的帳號，多判斷所選的專案是否帶有 license，假如有license 且沒有過期，則可以使用。
        //                         if (window.allowedMakarIDUseWeb == false ){
        //                         // if (window.allowedMakarIDUseWeb == false && false ){
        
        //                             for ( let j = 0; j < userPublishProjs.proj_list.length; j++ ){
        //                                 //// 找到「對應的專案」
        //                                 if ( publishVRProjs.result[i].proj_name.toLowerCase() == userPublishProjs.proj_list[j].proj_name.toLowerCase()  ){											
        //                                     if ( userPublishProjs.proj_list[j].web_ar == true ){
        //                                         console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID( allow by license ): i=", i );
                                                
        //                                         activeVRScenes(i);
        //                                         // vrUI.setProjectTable();
                                            
        //                                     }else{
        //                                         forbidden( "this ID <br> [" + makarID + "] <br> is free user, not allow to use webVR" );
        //                                     }
        
        //                                     break;
        //                                 }
        //                             }
        
        //                             // forbidden( "this ID <br> [" + makarID + "] <br> is free user, not allow to use webVR" );
        
        //                         }else{
        
        //                             console.log("VRFunc.js: _showVRProjList: _getVRSceneByUserID( allow by user ): i=", i );
        
        //                             activeVRScenes(i);
        //                             // vrUI.setProjectTable();
        //                         }
        //                     }
        
        
        //                     //// 這邊指定專案名稱
        //                     // // if ( publishVRProjs.result[i].proj_name == "logicTest" ){
        //                     // if ( publishVRProjs.result[i].proj_name == "log_1" ){
        //                     // // if ( publishVRProjs.result[i].proj_name == "t1" ){
        //                     // 	activeVRScenes( i );
        //                     // }
        
        //                 }
                        
        
        //             }
        //         });
                            
        //     }
    
    
            
            //[end---20200211-fei0090-add]//
        
        };
        
        //// 這個 _activeVRScenes 只有這裡被呼叫 似乎不必掛在window底下
        // window.activeVRScenes = function( sceneIndex=0 ){
        const activeVRScenes = function( sceneIndex=0 ){
            ////// remove the video tag, and clean the memory, must be done before remove the div 
            let videos = document.getElementsByTagName("video");
            if ( videos.length > 0 ){
                for (let i = 0; i < videos.length; i++ ){
                    videos[i].pause();
                    videos[i].removeAttribute("src"); // empty source 	
                    videos[i].load();
                }
            }
            
            ////// set the same id=vrDiv, if load the different VR project, remove the div after remove video.
            if (document.getElementById("vrDiv")){
                document.getElementById("vrDiv").remove();
            }

            let vrDiv;
            ////// set the aframe scene
            let vrScene = document.createElement('a-scene');
            vrScene.setAttribute('id', "vrscene" ); ////// just id
            vrScene.setAttribute('crossorigin', 'anonymous');

            vrScene.setAttribute( 'embedded', "" ); ////// add this will make the scene embedded into a div
            vrScene.setAttribute( 'vr-mode-ui', "enabled: false" ); ////// disable and hide the VR button
            vrScene.setAttribute( 'debug', "true" ); ////// disable and hide the VR button

            // vrScene.setAttribute( 'device-orientation-permission-ui', "enabled: false" );

            ////// set a div above a-scene, must set one of width/height be "xxx px" 
            vrDiv = document.createElement('div');

            // console.log("VRFunc.js: activeVRScenes: documentDE.WH=", document.documentElement.clientWidth, document.documentElement.clientHeight);

            // vrDiv.style.width  = Math.round(document.documentElement.clientWidth *1.0 ) + "px" ;    //  "500px" or "80%"
            // vrDiv.style.height = Math.round(document.documentElement.clientHeight*0.9 ) + "px" ;//  "500px" or "80%"

            let container;
            if ( window.makarSDK && window.makarSDK.config && window.makarSDK.container ){
                //// for_makarSDK
                vrDiv = window.makarSDK.vrDiv
                container = window.makarSDK.container
            } else {
                container = document.documentElement
            }

            vrDiv.style.position = "relative" ;    //  "500px" or "80%"
            vrDiv.setAttribute('id', "vrDiv" ); ////// set the same id, if load the different VR project, remove the div first.
            vrDiv.setAttribute('crossorigin', 'anonymous');

            vrDiv.style.width = container.clientWidth + "px" ;    //  "500px" or "100%"
            vrDiv.style.height = Math.round(container.clientHeight - 0) + "px" ;//  "500px" or "80%"

            // vrDiv.style.left = window.innerWidth*0.1+"px" ; //
            vrDiv.style.top = "0px" ; //
            window.onresize = function(){
                // console.log("window resize: WH=", window.innerWidth, window.innerHeight, vrDiv.clientWidth, vrDiv.clientHeight );
                vrDiv.style.width = container.clientWidth + "px" ;    //  "500px" or "100%"
                vrDiv.style.height = Math.round(container.clientHeight - 0) + "px" ;//  "500px" or "80%"
                        
        	    //[start-20231024-howardhsu-modify]//
                //// VR也增加了2D介面 加上onresize對應的函式
                if ( window.vrController && vrController.vrScene && vrController.GLRenderer ){

                    //// 延遲觸發 「畫布縮放」跟「調整2D相機」。假如連續縮放畫面，則只會觸發最後一次
                    console.log('window _resize: _clearTimeout and _setTimeout ');

                    clearTimeout( vrController.sizeTimeOutID );
                    vrController.sizeTimeOutID = setTimeout( function(){
                        
                        let self = window.vrController;
                        let rendererSize = new THREE.Vector2();
                        self.vrScene.renderer.getSize( rendererSize );

                        // console.log(' window _rendererSize: ', rendererSize.x, rendererSize.y );

                        // let video = self.video;
                        // let videoWidth, videoHeight;
                        let w = (window.makarSDK) ? window.makarSDK.container.clientWidth : window.innerWidth;
                        let h = (window.makarSDK) ? window.makarSDK.container.clientHeight : window.innerHeight;
                        // if ( rendererSize.x/rendererSize.y > video.videoWidth/video.videoHeight ){							
                        //     w = window.innerWidth  ;
                        //     h = (window.innerWidth/video.videoWidth)* video.videoHeight;
                        // }else{							
                        //     w = (window.innerHeight/video.videoHeight) * video.videoWidth ;
                        //     h = window.innerHeight;
                        // }

                        //// 原本是「改動 div 」現在換「改動 canvas 」
                        self.GLRenderer.setSize( w , h );
                        
                        if(window.makarSDK){
                            //// for_makarSDK : 位置暫時不在這裡設定
                        } else {
                            self.vrScene.canvas.style.left = ( innerWidth - w )/2 + "px" ;
                            self.vrScene.canvas.style.top  = ( innerHeight - h )/2 + "px" ;
                        }

                        let oSR2D = vrController.scaleRatioXY;
                        let cSR2D = vrController.get2DScaleRatio();
                        
                        //// 調整 2D 相機 的「範圍」
                        self.camera2D.left = -w/2  * oSR2D/cSR2D ;
                        self.camera2D.right = w/2  * oSR2D/cSR2D ;
                        self.camera2D.top = -h/2   * oSR2D/cSR2D ;
                        self.camera2D.bottom = h/2 * oSR2D/cSR2D ;
                        self.camera2D.updateProjectionMatrix();

                        

                        // vrController.set2DScaleRatio( cSR2D ); //// 這段目前測試不該呼叫

                        self.vrScene.resize();

                        ///// 這邊發現，畫布的精細度可以依照下列方式調製整，讓手機上解析度提高

                        if (Browser){
                            let dw, dh;
                            if ( Browser.desktop == true ){
                                //// 電腦端，調整概念為「短邊一定要超過 1280 、長邊不超過 1280 」，由於目前 新版 webXR 設定 此 iframe 高度只有 600 所以這邊必定要觸發
                                //// 先預計未來 iframe 會調整大小，所以這邊還是好好寫判斷
                                let wx = rendererSize.x;
                                let wy = rendererSize.y;

                                if ( w > 2560 || h > 2560 ){
                                    if ( w > h ){
                                        dw = 2560  ;
                                        dh = 2560 * h/w ;
                                    }else{
                                        dw = 2560 * w/h ;
                                        dh = 2560 ;
                                    }
                                    self.GLRenderer.setSize( dw , dh , false );
                                }else if ( wx < 1280 || wy < 1280 ){
                                    if ( w > h ){
                                        dw = 1280 * w/h ;
                                        dh = 1280 ;
                                    }else{
                                        dw = 1280 ;
                                        dh = 1280 * h/w ;
                                    }
                                    self.GLRenderer.setSize( dw , dh , false );
                                }

                            }else if ( Browser.mobile == true ){
                                //// 手機端，調整概念為「 無條件補滿 720 」
                                if ( w < 720 || h < 720){
                                    
                                    if ( w > h ){
                                        dw = 720;
                                        dh = 720/w * h;
                                    }else{
                                        dw = 720/h * w;
                                        dh = 720;
                                    }
                                    self.GLRenderer.setSize( dw , dh , false );
                                }
                            }
                        }


                        //// 調整 3D 相機 aspect ratio
                        let camera3D = self.vrScene.camera
                        camera3D.aspect = w/h;
                        camera3D.updateProjectionMatrix();

                        let oCamera = document.getElementById('oCamera');
                        let oCamera3D = oCamera.components['camera'].camera
                        oCamera3D.aspect = w/h;
                        oCamera3D.updateProjectionMatrix();

                        console.log('2 window _resize: ', w, h, self.GLRenderer.getSize( rendererSize ) );

                    }, 50 );

                    
                }
            	//[end-20231024-howardhsu-modify]//

            };

            //// for_makarSDK 
            if(window.makarSDK){
                //// 準備 js custom event 
                const event_vrDivReady = new CustomEvent("vrDivReady", {
                    detail: {
                        "name": "(for webSDK) vrDiv is ready.",
                        "vrDiv": vrDiv
                    },
                });
                window.makarSDK.container.dispatchEvent(event_vrDivReady);

            } else {
                document.body.appendChild(vrDiv);
            }

            vrDiv.appendChild(vrScene);
        
            

            if (vrScene.hasLoaded) {
                initvrscene();
            } else {
                vrScene.addEventListener('loaded', ()=>{
                    initvrscene()
                });
            }

            vrScene.addEventListener('enter-vr', function(){
                // console.log("VRFunc.js: vrScene enter-vr");
            });
            vrScene.addEventListener('renderstart', function(){
                // console.log("VRFunc.js: vrScene renderstart");
            });            
        
            //////
            ////// server V3 
            //////            
            // let vrController = new VRController(VRSceneResult, publishVRProjs, projIndex, languageType, worldContent);
            // window.vrController = vrController; // 20190921 for debug   
            
            //[start-20230728-howardhsu-add]//
			///// 3.5.0 Data 
            
            //// 開發 3.5.0 「專案編號 與 場景編號 」固定
            // projIndex = 1;

            // let vrController = new VRController(new_scene , new_proj, projIndex, languageType, worldContent);
            // importModule('TextModule')
            
            let vrController = new _VRController_js__WEBPACK_IMPORTED_MODULE_2__["default"]( makarUserData );
            window.vrController = vrController;
            
            //// for_makarSDK
            //// 暫時這樣 之後問一下 是否SDK也維持 vrController掛在window下
            if(window.makarSDK){
                window.makarSDK.currentActiveController = vrController
            }
            //[end-20230728-howardhsu-add]//

            //// 起始設定，由於目前 「朗讀文字」的功能棟有第一次無法取得 發聲列表 問題，所以這邊先行呼叫一次
            if ( typeof( speechSynthesis ) == 'object' && typeof( SpeechSynthesisUtterance ) == 'function' ){
                let voices = speechSynthesis.getVoices();
                vrController.voices = voices;
            }

            
            //// add 2D scene
            let testCSS2D = false

            function initvrscene(){
                
                // console.log("VRFunc.js: activeVRScenes: initvrscene vrScene=", vrScene  );
                if ( vrScene.children[2].attributes ){

                }
                // vrScene.children[2].remove(); ////// 20190921: Fei want to remove the default camera, 

                ////// add the listener for show the panel or not
                // vrScene.canvas.addEventListener("touchstart", vrSceneTouch, false);
                // vrScene.canvas.addEventListener("mousedown", vrSceneTouch, false);
                // let bottomProjs = document.getElementById("bottomProjs");
                // let projsInfo = document.getElementById("projsInfo");
                // let bottomArrow = document.getElementById("bottomArrow");
                // bottomProjs.style.display = "block";
                // function vrSceneTouch(event){
                // 	//// close the author's project list 
                // 	event.preventDefault();
                // 	// console.log("VRFunc.js: _vrSceneTouch: camera rotation=", document.getElementById("camera_cursor").object3D.rotation, document.getElementById("aCamera").object3D.rotation  );

                // 	bottomProjs.className =  'collapsed' ;
                // 	projsInfo.className =  'collapsed' ;
                // 	bottomArrow.className =  'collapsed' ;

                // }


    //20200604-start-thonsha-add
                vrScene.setAttribute("shadow","type: pcfsoft");
    //20200604-end-thonsha-add
                

                ////// set member into vrController
                let rendererSize = new THREE.Vector2();
                vrScene.renderer.getSize( rendererSize );
    //20191112-start-thonsha-add

                vrScene.renderer.sortObjects = true;

                //// 「 關閉 陰影自動更新 」
                // vrScene.renderer.shadowMap.autoUpdate = false;


                // vrScene.renderer.capabilities.logarithmicDepthBuffer = true;
                
                // preserveDrawingBuffer

                console.log(" **************** vrScene " , vrScene.object3D );

    //20191112-end-thonsha-add

                //[start-20231013-howardhsu-add]//
                //// try to add 2D scene
                vrScene.renderer.autoClear = false; // make the 2D Camera can render to the same WebGLRenderer of VRScene
                
				//////// add the scene for 2D object
				let scene2D = new THREE.Scene();
				vrController.scene2D = scene2D;               
                
                let w = vrDiv.clientWidth
                let h = vrDiv.clientHeight

				let camera2D = new THREE.OrthographicCamera( -w/2, w/2, -h/2, h/2, -100, 20000);
				vrController.camera2D = camera2D;
                //[end-20231013-howardhsu-add]//
    
                vrController.vrScene = vrScene;
                vrController.GLRenderer = vrScene.renderer;

                //////// add the scene for background video  
				let videoScene = new THREE.Scene();
				vrController.videoScene = videoScene;

                // //[start-20231013-howardhsu-add]//
                // ///// 載入相機完成之後，設定對應 物件放大比例
                // let  sr2D = vrController.get2DScaleRatio();
                // vrController.set2DScaleRatio( sr2D ) ;
                // //[end-20231013-howardhsu-add]//

                vrController.setupFunction();

                ////// set cursor with animation
    //20200812-thonsha-mod-start
                setTimeout(function(){
                    cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;" );
                    cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );
                    cursorEntity.setAttribute('animation__mouseenter', "property: geometry.thetaLength; delay: 5; startEvents: mouseenter; dur: 5; from: 0.5; to: 360" );
                    cursorEntity.setAttribute('animation__mouseleave', "property: geometry.thetaLength; startEvents: mouseleave; dur: 100; from: 360; to: 0.5" );
                    // cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.04; radiusInner: 0.02; thetaLength: 360; thetaStart: 0;" );
                    vrController.cursorEntity = cursorEntity;
                }, 1);
                let cursorEntity = document.createElement('a-entity');
                cursorEntity.setAttribute('id', "cursor_main" );
                // cursorEntity.setAttribute('cursor', "fuse: true; fuseTimeout: 5" );
                // cursorEntity.setAttribute('cursor', "fuse: false; fuseTimeout: 5" );
                cursorEntity.setAttribute('raycaster', "objects: .clickable" );
                // cursorEntity.setAttribute('animation__mouseenter', "property: geometry.thetaLength; delay: 5; startEvents: mouseenter; dur: 5; from: 0.5; to: 360" );
                // cursorEntity.setAttribute('animation__mouseleave', "property: geometry.thetaLength; startEvents: mouseleave; dur: 100; from: 360; to: 0.5" );
                // cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.04; radiusInner: 0.02; thetaLength: 360; thetaStart: 0;" );
                cursorEntity.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 0; thetaStart: 0;" );
                cursorEntity.setAttribute('position', "0 0 -0.1" );
                cursorEntity.setAttribute('material', "color: red; shader: flat; " );
                ////// set cursor default (green)
                let cursorEntityDefault = document.createElement('a-entity');
                cursorEntityDefault.setAttribute('id', "cursor_default" );
                cursorEntityDefault.setAttribute('geometry', "primitive: ring; radiusOuter: 0.002; radiusInner: 0.0014; thetaLength: 360; thetaStart: 0;" );
                cursorEntityDefault.setAttribute('position', "0 0 -0.1001" );
                cursorEntityDefault.setAttribute('material', "color: #2ADD2A; shader: flat; " );


                
                ////// set the entity to contain a-camera
                //// v3.5.0.0 先判斷「初始觀看模式」
                let initViewMode = 'VR';
                let activeViewModeVR = (window.makarSDK) ? true : false;
                let activeViewModeModel = false;

                if ( parent.selectedProject ){
                    if ( parent.selectedProject.viewMode == 'XR' ){
                        initViewMode = 'VR';
                        activeViewModeVR = true;
                    }else if (parent.selectedProject.viewMode == 'model'){
                        initViewMode = 'model'
                        activeViewModeModel = true;
                    }else{
                        initViewMode = 'VR';
                        activeViewModeVR = true;
                    }
                }
                vrController.viewMode = initViewMode;


    //20200812-thonsha-mod-end
                let aCamera = document.createElement('a-entity');
                // let aCamera = document.createElement('a-camera');

                ////// 20190921 Fei add some code inside  aframe-v0.9.2.js/aframe-v0.9.2.min.js for use touch control vertical view
                aCamera.setAttribute('camera', {active: true , fov: 80 } );
                aCamera.setAttribute('look-controls', "" ); 
                aCamera.setAttribute('wasd-controls', "" );
                // aCamera.setAttribute('wasd-controls', { enabled: true } ); 
                aCamera.setAttribute("camera", "active", activeViewModeVR);

                // aCamera.setAttribute('xytouch-look-controls', "" ); ///// 20190921 Fei stop use it for now.
                aCamera.setAttribute('id', "aCamera" );
                aCamera.setAttribute('position', { x: 0 , y: 0 , z: 0 } ); ////// it is work, but cant get value
                aCamera.setAttribute( 'camera', "fov", 60 ); ////// it is work, default is 80, 60 is unity set
                aCamera.setAttribute( 'camera', "near", 0.3 ); ////// it is work, default is 0.3
                aCamera.setAttribute( 'camera', "far", 20000 ); ////// it is work, default is 10000

                // console.log("VRFunc.js: aCamera.object3D.children=", aCamera.object3D.children.length );
                // aCamera.appendChild(cursorEntity);
                // aCamera.appendChild(cursorEntityDefault);
                console.log("VRFunc.js: aCamera=", aCamera );

                //// 模型觀看視角的相機，起始預設為「不啟動」。
                //// 注意：啟動指令為  oCamera.setAttribute('camera', 'active:true;')  同時會關閉所有場景中 camera （設定 active false）
                //// 反之，關閉指令為  oCamera.setAttribute('camera', 'active:false;')    
                //// 

                let oCamera = document.createElement('a-entity');
                oCamera.setAttribute('id', "oCamera" );
                
                let oCameraConfig = {
                    active: activeViewModeModel , 
                    fov: 80, 
                    near: 0.3, 
                    far:10000, 
                    aspect: rendererSize.x/ rendererSize.y
                }

                oCamera.setAttribute('camera', oCameraConfig );
                oCamera.setAttribute('orbit-controls', 
                `minPolarAngle: 0; 
                maxPolarAngle: 180; 
                minDistance: 0.1; 
                maxDistance: 1000; 
                initialPosition: -5 5 13;` ); 

                // 創建一個camera for 陀螺儀
				let cameraForGyro = document.createElement("a-entity");
				cameraForGyro.setAttribute('id', 'cameraForGyro');
				cameraForGyro.setAttribute('crossorigin', 'anonymous');
				cameraForGyro.setAttribute('camera', {active: false} );
				cameraForGyro.setAttribute('look-controls', { enabled: true , touchEnabled: false } );

                ////// set the a-entity to wrap the a-camera, the position and roation set here is the default value, will replace when load scene.
                let cameraEntity = document.createElement('a-entity');
                cameraEntity.setAttribute('id', "camera_cursor" ); ////// it is work, can get value!

                // cameraEntity.setAttribute('position', {x: 0, y: 1.7 , z: 0} );
                cameraEntity.setAttribute('position', {x: 0, y: 0 , z: 0} ); 

                cameraEntity.setAttribute('rotation', "0 0 0" ); ////// it is work too, but still can't get value

                cameraEntity.appendChild(aCamera);

                cameraEntity.appendChild(oCamera);

                cameraEntity.appendChild(cameraForGyro);

                vrScene.appendChild(cameraEntity);// this = vrScene

                let ambientLight = document.createElement("a-light");
                ambientLight.setAttribute("id", "ambientLight");
                ambientLight.setAttribute("type", "ambient" );
                ambientLight.setAttribute("color", "#808080" ); // white / gray / #fff  / #c8c8c8
                ambientLight.setAttribute("ground-color", "#fff" ); // #fff , Fei dont know how it work
                ambientLight.setAttribute("intensity", 1.0 );

                vrScene.appendChild(ambientLight);// this = vrScene


                //// v3.5.0.0 將兩種觀看模式的相機 「 aCamera 」「 oCamera 」設定， 「初始觀看模式」
                let aCameraObject = aCamera.getObject3D('camera');
                let oCameraObject = oCamera.getObject3D('camera');


                //// 假如「專案描述」帶有特定字串 _walking 增加以下功能
                //// 製作「客製化 走動功能 」

                //// v3.5.0.0 開發中，測試走路功能

                makarUserData.oneProjData.proj_descr += '_walking';

                // if (  publishVRProjs.result[ projIndex ].proj_descr.includes('_walking') == true  ){
                if ( makarUserData.oneProjData.proj_descr.includes( '_walking' ) ){


                    let self = vrController;
                    
                    ///// 紀錄當前「移動相機功能」的狀態，基本上只有「 VR 體驗 」時候可以開啟
                    //// -1: 2D UI 顯示為「尚未啟動」，3D icon 隱藏，此狀態只有點擊「開啟走動功能」才可以後續觸發走動
                    ////  0: 2D UI 顯示為「已經啟動」，3D icon 顯示白色，此狀態為可以觸發點擊移動功能，等待移動
                    ////  1: 2D UI 顯示為「已經啟動」，3D icon 顯示紅色，此狀態為移動中，不可再次移動
                    self.walkingStatus = -1;

                    let pointerSphere = document.createElement("a-entity");
                    pointerSphere.setAttribute("id" , "pointerSphere" );
                    pointerSphere.setAttribute("geometry" , "primitive: ring; radiusInner: 0.35; radiusOuter: 0.5" );
                    pointerSphere.setAttribute("material" , "shader: flat; color: white; side: double; opacity: 0.3; ");
                    pointerSphere.setAttribute('position', {x: 0, y: 0 , z: 0} ); 
                    pointerSphere.setAttribute('rotation', {x: 90, y: 0 , z: 0} ); 
                    pointerSphere.setAttribute("visible", false);
                    self.vrScene.appendChild(pointerSphere); 

                    let currentPosSphere = document.createElement("a-entity");
                    currentPosSphere.setAttribute("id" , "currentPosSphere" );
                    currentPosSphere.setAttribute("geometry" , "primitive: ring; radiusInner: 0.35; radiusOuter: 0.5" );
                    currentPosSphere.setAttribute("material" , "shader: flat; color: #0AC4B6; side: double; opacity: 0.3; ");
                    currentPosSphere.setAttribute('position', {x: 0, y: 0 , z: 0} ); 
                    currentPosSphere.setAttribute('rotation', {x: 90, y: 0 , z: 0} ); 
                    currentPosSphere.setAttribute("visible", false );
                    self.vrScene.appendChild(currentPosSphere); 


                    //// 地板
                    let ground = document.createElement("a-entity");
                    ground.setAttribute("id" , "__ground" );
                    ground.setAttribute("geometry" , "primitive: plane; height: 1000; width: 1000; ");
                    ground.setAttribute("material" , "shader: flat; color: blue; side: back; opacity: 0.05; visible: true ");
                    ground.setAttribute("visible" , false);
                    ground.setAttribute('position', {x: 0, y: 0.1 , z: 0} ); 
                    ground.setAttribute('rotation', {x: 90, y: 0 , z: 0} ); 
                    ground.addEventListener("loaded", function(){
                        ground.object3D.renderOrder = 9999;
                    });
                    self.vrScene.appendChild(ground);


                }



                let firstCameraSetActive = function(evt){
                    // console.log("firstCameraSetActivefirstCameraSetActive")
                    vrDiv = document.getElementById("vrDiv");
                    // vrDiv.style.width = document.documentElement.clientWidth + "px" ;    //  "500px" or "100%"
                    // vrDiv.style.height = Math.round(document.documentElement.clientHeight - 56) + "px" ;//  "500px" or "80%"
                    console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera active = ", vrScene.camera.aspect, vrDiv.clientWidth, vrDiv.clientHeight );
                    vrScene.camera.aspect = vrDiv.clientWidth/vrDiv.clientHeight;
                    vrScene.camera.fov = 60;
                    vrScene.camera.updateProjectionMatrix();
                    
                    let cameraOpen = false;
                    for (let i = 0; i < vrController.scenesData.scenes.length;i++){
                        if(vrController.scenesData.scenes[i].environment.scene_skybox_res_id == 'camera'){
                            cameraOpen = true;
                        }
                    }

                    if(cameraOpen){
                        
                        if(window.makarSDK){
                            //// for_makarSDK 暫時先跳過     應該是要新增 method 讓SDK使用者可以在外部呼叫並切換
                        } else {
                            //// mobile browser 顯示切換前後鏡頭的按鈕
                            if(parent.projMenuMobileSwitchCam){
                                parent.projMenuMobileSwitchCam.style.display = "inline-block"
                            }
                        }

                        vrController.startWebCam(  function( camRet ){
    
                            ///// 假如沒有辦法取得「相機畫面」，則導入「預設的sky」
                            if ( camRet == false ){
                                console.log(' _XRFunc.js: _startWebCam: error ');
                                // return;
                                let aSky = document.createElement('a-sky');
                                aSky.setAttribute('id', "sky" );
                                // aSky.setAttribute("material", {src: "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png" });
                                
                                //[start-2023mmdd-howardhsu-add]//
                                aSky.setAttribute("material", {src: "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets/Users/76ad6ef7-e89e-4f35-9c8d-0f40617f64a1/VRProjectMipmap/740c26126aab4eeca6adf5dc268814b3_4096.jpg" });
                                //[end-2023mmdd-howardhsu-add]//
                                
                                vrController.vrScene.appendChild(aSky);
    
                                //20221207-thonsha-add-end
                                let timeoutID = setInterval( function () {
                                    if(document.getElementById("sky").object3D){
                                        vrController.onlySkyScene.add(document.getElementById("sky").object3D.clone(true))
                                        clearInterval(timeoutID);
                                    }
                                });
                                //20221207-thonsha-add-end
                            }
    
                            ///// 載入相機完成之後，設定對應 物件放大比例
                            let  sr2D = vrController.get2DScaleRatio();
                            vrController.set2DScaleRatio( sr2D ) ;
        
                            vrController.loadScene(sceneIndex);
                            vrController.userStartTime = new Date().getTime();
        
                            (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.checkHost_tick)();
                            Module.checkMifly();
                            //// 20201029 為了解決 iphone上畫面卡住問題
                            // 假如先執行 video.play() 等待 一段時間 再執行 tick 則畫面高機率卡住
                            // 假如先執行 tick 再執行 video.play() 則畫面高機率順暢（沒遇到卡住）
                            renderTick();
                            setTimeout(function(){
                                if ( vrController.video.play ){
                                    vrController.video.play();
                                }
                            }, 1000);
        
                            // switchLens.onclick = function(event){
                            // 	// console.log("three.js: _switchLens click , event= ", event );
                            // 	vrController.triggerEvent( { simple_behav: "exchangeCamera", enable: true} );
                            // };
            
                            ////// setup snapShot function
                            
                            // snapShotCamera.onclick = function() { 
                            // 	// console.log("three.js: snapShotCamera click , event= ", event );
                            // 	vrController.triggerEvent( { simple_behav: "SnapShot", enable: true} );
                            // };
        
                        });
                    }
                    else{
                        //// 先將觸控關閉，再跳轉場景
                        vrController.triggerEnable = false;
                        // vrController.loadScene(projIndex, sceneIndex);
                        vrController.loadScene( sceneIndex );
                        vrController.userStartTime = new Date().getTime();
                        
                        // vrController.update();
                        (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.checkHost_tick)();
                        Module.checkMifly();

                    }


                    
                    
                    vrScene.removeEventListener('camera-set-active', firstCameraSetActive );
                }
                vrScene.addEventListener('camera-set-active', firstCameraSetActive );


                ////// try to modify the aspect ratio of camera, 20190917 Fei fail, I check the vrScene.camera is same as aCamera.object3D.children[2].
                ////// But it need wait for the camera loading, at first, it is default camera, then it is the a-camera's object3D
                // console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera = ", vrScene.camera, vrScene );
                // vrScene.addEventListener('camera-set-active', function(evt) { 
                // 	vrDiv = document.getElementById("vrDiv");
                // 	// vrDiv.style.width = document.documentElement.clientWidth + "px" ;    //  "500px" or "100%"
                // 	// vrDiv.style.height = Math.round(document.documentElement.clientHeight - 56) + "px" ;//  "500px" or "80%"
                // 	console.log("VRFunc.js: activeVRScenes: initvrscene: vrScene.camera active = ", vrScene.camera.aspect, vrDiv.clientWidth, vrDiv.clientHeight );
                // 	vrScene.camera.aspect = vrDiv.clientWidth/vrDiv.clientHeight;
                // 	vrScene.camera.fov = 60;
                // 	vrScene.camera.updateProjectionMatrix();

                // 	//// 先將觸控關閉，再跳轉場景
                // 	vrController.triggerEnable = false;
                // 	vrController.loadScene(projIndex, sceneIndex);
                // 	vrController.userStartTime = new Date().getTime();
                    
                // 	// vrController.update();
                // 	checkHost_tick();
                // 	Module.checkMifly();

                // });


                ////// setup the test 3D object, it is work
                // vrController.loadTexture();

                ////// setup the default button.
                //// make the stable scene2D renderer, prepare for future.
                // let test = new THREE.Object3D();
                // vrController.loadTexture2D(test, "../images/homeIcon1.png"); // homeIcon1.png, homeIcon2.jpg			
                // test.position.set( -rendererSize.x + 150 , -rendererSize.y + 150, 0 );
                // scene2D.add(test);

                // let plane = new THREE.Mesh( new THREE.PlaneBufferGeometry(100, 100, 0), new THREE.MeshBasicMaterial( {side: THREE.BackSide, color: new THREE.Color("rgb(50,150,50)") } ) );
                // plane.position.set( -rendererSize.x + 50 , -rendererSize.y + 50, 0 );
                // scene2D.add(plane);

    //20221206-thonsha-add-start
                let skyRenderTarget = new THREE.WebGLRenderTarget(1024,1024);
                vrController.skyRenderTarget = skyRenderTarget;
                vrController.needsRenderTarget = false;
                // vrController.onlySkyScene = new THREE.Scene();
    //20221206-thonsha-add-end		
                // vrController.cullFaceBackScene = new THREE.Scene();

                renderTick();

                // console.log("VRFunc.js: initvrscene, done", vrScene, vrScene.object3D );
            }

            
            let renderTick = function() {

                vrController.GLRenderer.clear();
				if ( vrController.videoCamera ){
					if ( !vrController.video.paused ){
						vrController.GLRenderer.render( vrController.videoScene, vrController.videoCamera);
					}
				}

                vrController.GLRenderer.clearDepth();
    //20221206-thonsha-add-start
                if (vrController.needsRenderTarget){
                    vrController.GLRenderer.setRenderTarget( vrController.skyRenderTarget );
                    vrController.GLRenderer.clear();
                    vrController.GLRenderer.render( vrController.onlySkyScene, vrController.vrScene.camera );
                    vrController.GLRenderer.setRenderTarget( null );
                }
    //20221206-thonsha-add-end
                vrController.GLRenderer.render( vrController.vrScene.object3D, vrController.vrScene.camera );

                if (vrController.needsCullFaceBack){
                    for(let i = 0; i <vrController.cullFaceBackScene.children.length; i++){
						let objj = document.getElementById(vrController.cullFaceBackScene.children[i]["obj_id"]).object3D;
						vrController.cullFaceBackScene.children[i].position.setFromMatrixPosition(objj.matrixWorld)
            			vrController.cullFaceBackScene.children[i].setRotationFromMatrix(objj.matrixWorld)
					}
                    
                    vrController.GLRenderer.state.setCullFace(THREE.CullFaceFront);
                    vrController.GLRenderer.render( vrController.cullFaceBackScene, vrController.vrScene.camera );
                    vrController.GLRenderer.state.setCullFace(THREE.CullFaceBack);                    
                }

                //[start-20231013-howardhsu-add]//
                //// add 2D scene
                    vrController.GLRenderer.render( vrController.scene2D, vrController.camera2D );

                // if(testCSS2D){
                //     vrController.labelRenderer.render( vrController.vrScene.object3D, vrController.vrScene.camera );
                // }

                //// for_makarSDK
                if(window.makarSDK){
                    window.makarSDK.workWithRenderTick()
                }
                //[end-20231013-howardhsu-add]//

                // console.log("renderTick");
                requestAnimationFrame(renderTick); // dont use it, because of the haning problem
            };


        }
        
    }

    // function makeid(length) {
    //     var result           = '';
    //     var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    //     var charactersLength = characters.length;
    //     for ( var i = 0; i < length; i++ ) {
    //     result += characters.charAt(Math.floor(Math.random() * charactersLength));
    //     }
    //     return result;
    // }

    //// 20240815 renhaohsu 改寫到外層了
	// let leavedSendLog = window.leavedSendLog = function(e) {
    //     //[start-20231114-renhaohsu-modify]
	// 	if (!window.makarUserData) return;
	// 	if (!makarUserData.oneProjData) return;
	// 	if (!makarUserData.oneProjData.user_id) return;
    //     //[end-20231114-renhaohsu-modify]

	// 	let device_id;
	// 	if (localStorage.getItem("device_id")){
	// 		if (localStorage.getItem("device_id") >= 24 ){
	// 			device_id = localStorage.getItem("device_id");
	// 		}else{
	// 			device_id = new Date().getTime() + "_" + makeid(10) ;
	// 			localStorage.setItem( "device_id",  device_id );
	// 		}
	// 	}else{
	// 		device_id = new Date().getTime() + "_" + makeid(10) ;
	// 		localStorage.setItem( "device_id",  device_id );
	// 	}

	// 	let leavedTime = new Date().getTime();

	// 	let projData = {
	// 		"brand": Browser.name + Browser.version ,
	// 		"os": navigator.userAgent ,
	// 		"device_id": device_id ,
	// 		"client": "viewer" , //// 等amos修改玩之後再改為 web 
	// 		"user_id": makarUserData.oneProjData.user_id,
	// 		"proj_id": "" ,
	// 		"proj_type":"vr" ,
	// 		"duration_time": 0 ,
	// 		"explore_time": 0 ,
	// 		"play_time": 0 ,
	// 		"location_long":0.0 ,
	// 		"location_lan":0.0 ,
	// 	};
    //     //[start-20231114-renhaohsu-modify]
	// 	projData.proj_id = makarUserData.oneProjData.proj_id;
	// 	projData.duration_time = (leavedTime - vrController.userStartTime)/1000; // 單位是秒
	// 	projData.play_time = (leavedTime - vrController.userStartTime)/1000; // 單位是秒
	// 	console.log("VRFunc.js: project['" + projData.proj_id + "'] playing time = " , projData.duration_time , projData.play_time , projData.explore_time );
    //     //[end-20231114-renhaohsu-modify]
    //     let savedProjLogs  = [projData];
	// 	localStorage.setItem("savedProjLogs", JSON.stringify(savedProjLogs) );

	// 	return undefined;
	// }
	// window.onbeforeunload = leavedSendLog;

    // let leftTopButton = document.getElementById("leftTopButton");
    // leftTopButton.addEventListener('click', function(event){
    // 	event.preventDefault();
    // 	event.stopPropagation();
    // 	event.stopImmediatePropagation();

    // 	if ( window.vrController ){
    // 		let pSet = vrController.setViewMode();
    // 		pSet.then( function(ret){
    // 			if ( ret == 'VR' ){
    // 				leftTopButton.children[0].innerHTML = '切換觀看模式(VR)';
    // 			}else if (ret == 'model'){
    // 				leftTopButton.children[0].innerHTML = '切換觀看模式(Model)';
    // 			}
    // 		});
    // 	}

    // 	// leavedSendLog();
    // 	// //// check if in iFrame?
    // 	// if ( window.top != window.self ){
    // 	// 	console.log("makarVR.html: get iframe = " , parent.document.getElementById("vrIframe") );
    // 	// 	// parent.document.getElementById("vrIframe").remove();
    // 	// 	parent.aUI.closeCoreIframe();
    // 	// }

    // });

    let scope;
    if (typeof window !== 'undefined') {
        scope = window;
    } else {
        scope = self;
    }
    // scope.VRController = VRController;

    let integrateCount = 0;
    let integrateTick = function() {
        integrateCount++ ;
        if ( integrateCount > 3 ){
            console.log("VRFunc.js: integrateTick, integrateCount=", integrateCount, ", too many times" );
            return;
        }

        if (scope.AFRAME && scope.THREE) {
            console.log("VRFunc.js: integrateTick, scope=", scope , integrateCount );
            integrate();
            window.addEventListener("keyup", function(event) {
                if (event.key === 'Enter') {
                // if (event.keyCode === 13) {  //// According to MDN, event.keyCode had been Deprecated
                    event.preventDefault();
                    // getScenes();
                }
            });
        } else {
            setTimeout( function(){
                integrateTick( integrateCount );
            } , 500);
        }
    };

    if (typeof window !== 'undefined') {
        integrateTick( integrateCount );
    }

    console.log("VRFunc done, window innerWH",  window.innerWidth, window.innerHeight);

    //// 輸出文字改為由網址的頁面判斷
    let languageType = window.languageType = "tw";
    if (parent){
        let indexOfFirst = parent.location.pathname.indexOf('/', 0);
        let indexOfSecond = parent.location.pathname.indexOf('/', indexOfFirst + 1);
        let lan = parent.location.pathname.substring(1, indexOfSecond);
        if (lan == "tw" || lan == "en"){
            languageType = window.languageType = lan;
        }
    }

    let worldContent = window.worldContent = {

        userAlreadyPlayed:{tw:"此登入用戶已經遊玩過", en:"This user already played"},
        userNotLoginInfo:{tw:"必須要登入MAKAR後才可遊玩", en:"Please login at first"},
        clickToPlay:{tw:"點擊開始遊玩", en:"Click to play"},

        backToHome:{tw:"專案標題", en:"back"},
        GPSDistanceMsg:{tw:"需在GPS的範圍內才能開啟 \r\n 距離：", en:"Please to the right place"},
        GPSErrorMsg:{tw:"GPS 錯誤", en:"GPS error"},
        GPSnotSupportMsg:{tw:"沒有支援 GPS ", en:"GPS not support"},
        comfirm:{tw:"確認", en:"Comfire"},
        
    };

    if(languageType == "en"){
        //// 留下來當作範例 
        // let rs = leftTopButton.children[0].innerHTML.replace("專案標題" , worldContent.backToHome[languageType] );
        // leftTopButton.children[0].innerHTML = rs;
    }

})();

/***/ }),

/***/ "./js/VRMain/version3_5/handleAframeEvent.js":
/*!***************************************************!*\
  !*** ./js/VRMain/version3_5/handleAframeEvent.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   handleClickEvent: () => (/* binding */ handleClickEvent),
/* harmony export */   handleFusingEvent: () => (/* binding */ handleFusingEvent)
/* harmony export */ });
function handleFusingEvent( event ){

    //20191023-start-thonsha-mod
    event.preventDefault();
    // console.log('I was fusing, this.object3D = ', this.object3D , event );
    if (event.target == event.currentTarget){
        // console.log('I was fusing, this.object3D = ', this.object3D , event );.
        if (this.object3D.behav){
            delay = this.object3D.behav[0].display*1000+5;
            // console.log("======= delay :"+delay+" =====");
            let cursor = document.getElementById("cursor_main");
            cursor.setAttribute('cursor', "fuseTimeout:"+ delay);
            cursor.setAttribute('animation__mouseenter', "dur: "+delay );
        }

        if (this.object3D.main_type == "button"){
            delay = 3*1000+5;
            // console.log("======= delay :"+delay+" =====");
            let cursor = document.getElementById("cursor_main");
            cursor.setAttribute('cursor', "fuseTimeout:"+ delay);
            cursor.setAttribute('animation__mouseenter', "dur: "+delay );
        }

    }   

}	

function handleClickEvent( event ) {

    event.preventDefault();
    console.log('I was clicked, this.object3D = ', this.object3D , event );
    if (event.target == event.currentTarget){
        // console.log('I was clicked, this.object3D = ', this.object3D , event );
        
        if ( this.object3D.behav ){

            if (!vrController.triggerEnable){
                console.log("VRFunc.js: _clickEvent: please wait three second for _triggerEanble");
                return;
            }

            //// deal the group	
            //// 找出此次觸發事件中含有 group 的部份
            for (let i = 0; i < this.object3D.tWorldVisiblebehav.length; i++ ){
                if (this.object3D.behav[i].group){
                    //// 找出所有場上物件中，掛有觸發事件的物件
                    for ( let j = 0; j < vrController.makarObjects.length; j++ ){
                        let makarObject = vrController.makarObjects[j];
                        if (makarObject.object3D){
                            if (makarObject.object3D.makarObject && makarObject.object3D.behav ){

                                for (let k = 0; k < makarObject.object3D.behav.length; k++ ){
                                    //// 找出除了自己以外掛有相同 group 的物件
                                    if (makarObject.object3D.behav[k].group == this.object3D.behav[i].group &&  makarObject.object3D != this.object3D ){
                                        // console.log(" ************* " , i , j , k , makarObject.object3D.behav[k] , this.object3D.behav[i].group );
                                        let groupObj = document.getElementById(makarObject.object3D.behav[k].obj_id);
                                        vrController.hideGroupObjectEvent(groupObj);
                                    }
                                }

                            }
                        }
                    }
                }
            }




            let reset = false;
            for(let i=0;i<this.object3D.behav.length;i++){
                if (this.object3D.behav[i].behav_type == "CloseAndResetChildren"){
                    reset = true;
                }
            }

            for(let i=0;i<this.object3D.behav.length;i++){
                if (this.object3D.behav[i].behav_type != "CloseAndResetChildren"){
                   //[start-20230919-howardhsu-modify]//
                    if(touchObject.behav[i].behav_type == "ShowQuiz"){
                            
                        //// 顯示 quiz 之前，先判斷 "瀏覽器本次載入場景後" 是否已經遊玩
                        if(touchObject.behav[i].played == false){
                            touchObject.behav[i].played = true	
                            vrController.triggerEvent( touchObject.behav[i], reset, touchObject )
                        } else {
                            console.log('VRFunc.js: _setupFunction: endEvent:  Quiz had been played.', touchObject.behav[i].played)
                        }

                    } else {
                        vrController.triggerEvent( touchObject.behav[i], reset, self.GLRenderer, null, touchObject );
                    }
                    
                }
            }            
        }

        // if (this.object3D.main_type == "button"){
        // 	console.log("VRFunc.js: button click " , this.object3D );
        // 	vrController.pushButton(this);
        // }
        // [end-20230920-howardhsu-modify]//	
    }
    //20191023-end-thonsha-mod

}

/***/ }),

/***/ "./js/VRMain/version3_5/networkAgent.js":
/*!**********************************************!*\
  !*** ./js/VRMain/version3_5/networkAgent.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });

//// v3.5.0 修改 「網路相關功能」。

class NetworkAgent {

    constructor(){

        // this.url = "https://ssl-api-makar-v3-apps.miflyservice.com/Makar/";
        this.url = "https://test1.makar.app/Makar/"; // local test V3 makar server.

        //// 上一層基本上是「 next 框架 」，「 專案頁面 」「首頁」「內嵌頁面」都有可能。 取得「 MAKAR Server Url 」 來同步雲端資料。
        if ( typeof( parent ) == 'object' && parent.serverUrl ){
            // console.log(' _MakarServerApi_serverside: ' , process.env.serverUrl );
            this.url = parent.serverUrl;
        }

        //// 網頁版本：比照 四碼 辦理
        this.webVersion = '3.5.0.0';
        
        //[start-20230927-howardhsu-add]//
        //// for version 3.4.0 
        this.url_v340 = "https://ssl-api-makar-v3-apps.miflyservice.com/Makar/";
        this.webVersion_v340 = '3.0.0';
        //[end-20230927-howardhsu-add]//
    }

            
    sendPost(destination, dataObject) {
        // Reference: https://developers.google.com/web/fundamentals/primers/promises?hl=zh-tw

        let self = this;

        return new Promise(function(resolve, reject) {

            let request = {
                ver: self.webVersion,
                cid: 5,
                data: dataObject
            };
            
            fetch( destination, {
                body: JSON.stringify( request ),
                headers: {
                    'content-type': 'application/json'
                },
                method: 'POST',
                cache: 'no-cache',
                credentials: 'same-origin',
                mode: 'cors', // no-cors, cors, *same-origin  
            }).then( res => res.json() ).then(function( response ){

                setTimeout( function(){
                    resolve( response );
                }, 1 ) 

            })
        });
    }


    //// 使用範例

    async getTest(user_id, info_keys = [] ) {
        let specificUrl = this.url + "get_test";
        let data = {
            user_id: user_id,
            wanted_info_keys: info_keys
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// v3.5.0 新版使用 api

    //// 依照關鍵字搜尋作者
    //// 依照關鍵字搜尋專案

    //// 取得「專案資料」
    async getProjectInfoList ( project_ids, login_id ) {

        if ( !Array.isArray( project_ids ) ){
            console.warn( '_getProjectInfoList_: error',  project_ids )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetProjects";
        let data = {
            "login_user_id": login_id,
            // "login_user_id": "06744749-ca64-4918-b713-eaf9d3fa2f7d",
            "project_ids": project_ids,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }


    //// 取得專案列表，舊版本
    async getProjectInfoList_v340 ( project_ids ) {

        if ( !Array.isArray( project_ids ) ){
            console.warn( '_getProjectInfoList_v340_: error',  project_ids )
            return false;
        }

        let specificUrl = this.url + "get_vr_projs_by_proj_id";

        let data = {
            "proj_id_list": project_ids
        }

        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者專案列表，舊版本 ，目前完全不用
    async getUserPublishProjects_v340 ( _data ) {


        let specificUrl = this.url + "get_usr_publish_projs";

        let data = _data;

        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }


    //// 取得場景資料列表
    async getProjectSceneList ( project_ids ) {

        if ( !Array.isArray( project_ids ) ){
            console.warn( '_getProjectSceneList_: error',  project_ids )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetProjectSceneList";
        let data = {
            project_ids: project_ids,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }


    //// 取得場景資料列表，舊版本
    async getProjectSceneList_v340 ( project_ids ) {

        if ( !Array.isArray( project_ids ) ){
            console.warn( '_getProjectSceneList_: error',  project_ids )
            return false;
        }

        let specificUrl = this.url + "get_vr_proj_scene";

        let data = {
            "proj_id": project_ids[0]
        }

        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得辨識圖資料列表
    async getTargetList ( target_ids ) {

        if ( !Array.isArray( target_ids ) ){
            console.warn( '_getTargetList_: error',  target_ids )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetTargetList";
        let data = {
            target_ids: target_ids,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者資料
    async getUserInfo ( user_id ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserInfo_: error',  user_id )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetUserInfo";
        let data = {
            user_id: user_id,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者線上素材庫物件
    async getUserOnlineResources ( user_id ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserOnlineResources_: error',  user_id )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetUserOnlineResources";
        let data = {
            user_id: user_id,
            language: ''
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者已發佈專案資料
    async getUserPublishedProjects ( user_id , _in_proj_type ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserPublishedProjects_: error',  user_id )
            return false;
        }

        //// 可以選擇「請求 專案類型」
        let proj_type = [];
        if ( Array.isArray( _in_proj_type ) ){
            proj_type = _in_proj_type;
        }

        let specificUrl = this.url + "WebXR/GetUserPublishedProjects";
        let data = {
            user_id: user_id,
            proj_type: proj_type
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者上傳素材
    async getUserResources ( user_id ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserResources_: error',  user_id )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetUserResources";
        let data = {
            user_id: user_id,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者辨識圖資料列表
    async getUserTargetList ( user_id ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserTargetList_: error',  user_id )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetUserTargetList";
        let data = {
            user_id: user_id,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //// 取得使用者材質球列表
    async GetUserMaterials ( user_id ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserMaterials_: error',  user_id )
            return false;
        }

        // let specificUrl = this.url + "WebXR/GetUserMaterials";
        let specificUrl = this.url + "Editor/GetUserMaterials";  // webXR還沒接好，先暫用editor
        let data = {
            user_id: user_id,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    async GetUserMaterialsbyID ( user_id, _in_material_ids ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserMaterials_: error',  user_id )
            return false;
        }

        let material_ids = [];
        if ( Array.isArray( _in_material_ids ) ){
            material_ids = _in_material_ids;
        }

        let specificUrl = this.url + "WebXR/GetUserMaterials";
        let data = {
            user_id: user_id,
            ids: material_ids
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

    //[start-20240305-renhaohsu-add]//
    async getRecordModule( playing_user_id , proj_id ){   
        
        let specificUrl = this.url + "get_record_module";
        let data =  {
            "playing_user_id": playing_user_id,
            "proj_id": proj_id 
        } 
        let result = this.sendPost(specificUrl, data);

        return await result;
    }

    //// 上傳 quiz record 資訊到server，給viewer端檢驗 ，格式看起來和v3.4相比並沒有改變
    async updateRecordModule( data ){
        
        let specificUrl = this.url + "update_record_module";
        let result = this.sendPost(specificUrl, data);
        
        return await result;
    }

	////// 上傳集點卡紀錄至雲端資料庫
    async pointCardLog(data){
        let specificUrl = this.url + "point_card_log";
        return this.sendPost(specificUrl, data);
    }

	//// 上傳 quiz log資訊到server，給數據分析使用 
    async quizLog(data){
        let specificUrl = this.url + "quiz_log";
        return this.sendPost(specificUrl, data);
    }
    //[end-20240305-renhaohsu-add]//
    
    //// 以下為「 3.4.0 以前版本 」

    //[start-20230927-howardhsu-add]//
    //// sendPost ver.3.4.0以前，與sendPost不同的只有request.ver的值 
    sendPost_v340(destination, dataObject, ver=self.webVersion_v340) {
        // Reference: https://developers.google.com/web/fundamentals/primers/promises?hl=zh-tw

        let self = this;

        return new Promise(function(resolve, reject) {

            let request = {
                ver: ver,
                cid: 5,
                data: dataObject
            };
            
            fetch( destination, {
                body: JSON.stringify( request ),
                headers: {
                    'content-type': 'application/json'
                },
                method: 'POST',
                cache: 'no-cache',
                credentials: 'same-origin',
                mode: 'cors', // no-cors, cors, *same-origin  
            }).then( res => res.json() ).then(function( response ){

                setTimeout( function(){
                    resolve( response );
                }, 1 ) 

            })
        });
    }

    ////  ver. 3.4.0 取得使用者資料
    async getUserInfo_v340 ( user_id, wanted_info_keys = [] ){

        let specificUrl = this.url_v340 + "get_one_usr_info";
        let data = {
            "user_id": user_id,
            "wanted_info_keys": wanted_info_keys
        }
        let result = this.sendPost_v340(specificUrl, data);

        return await result;
    }

    //// ver. 3.4.0 舊稱 getUsrOnlineRes 取得使用者線上素材庫物件 
    async getUserOnlineResources_v340 ( user_id, main_type, sub_type, category ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserOnlineResources_v340_: error, user_id=',  user_id )
            user_id = "fefe";
            // return false;    //// 依照 3.4.0 以前的 neworkAgent 的內容 這裡似乎就讓它通過?
        }
        if ( !main_type || typeof(main_type) != 'string' ){
            console.warn( '_getUserOnlineResources_v340_: error, main_type=',  main_type )
            main_type = "";
            // return false;
        }
        if ( !sub_type || typeof(sub_type) != 'string' ){
            console.warn( '_getUserOnlineResources_v340_: error, sub_type=',  sub_type )
            sub_type = "";
            // return false;
        }
        if ( !category || typeof(category) != 'string' ){
            console.warn( '_getUserOnlineResources_v340_: error, category=',  category )
            category = "";
            // return false;
        }

        let self = this
        let specificUrl = this.url_v340 + "get_usr_online_res";
        let data = {
            "user_id": user_id , //miflytest
            "main_type": main_type , // ar, vr 
            "sub_type": sub_type ,
            "category": category 
        };

        let result = self.sendPost_v340(specificUrl, data).then(response => {
            return self._createOnlineResDictFromResList(response.data.online_res_list)
        })
    
        return await result;
    }
    
    //// ver. 3.4.0 搭配 getUserOnlineResources_v340 使用
    _createOnlineResDictFromResList = (userOnlineResList) => {
        return new Promise((resolve, reject) => {            
            // console.log(userOnlineResList)         

            if (!userOnlineResList) resolve(-1);
            let userOnlineResDict = {};
            for (let i = 0; i < userOnlineResList.length; i++ ){
                // console.log(userOnlineResList[i].res_id)
                userOnlineResDict[ userOnlineResList[i].res_id ] = userOnlineResList[i];

                if ( i == userOnlineResList.length-1 ){
                    console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback", i, userOnlineResList.length ); // Object.keys(userARResDict).length
                    resolve( userOnlineResDict );            
                }
            }
            // window.userOnlineResDict = userOnlineResDict;

            //// 看起來在 userOnlineResList 是 {} 的情況下沒有 resolve
            //// 那要 reject 嗎? 反正也只是 console列印出來?
            if( Object.keys(userOnlineResList).length === 0){
                console.log('reject')
                reject("userOnlineResList.length is 0")
            }

        })
    }

    //// ver. 3.4.0 舊稱 getResByUserID 取得使用者上傳素材
    async getUserResources_v340 ( user_id, main_type, sub_type ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserResources_v340_: error, user_id=',  user_id )
            user_id = "makarvr"
            // return false;    //// 依照 3.4.0 以前的 neworkAgent 的內容 這裡似乎就讓它通過?
        }
        if ( !main_type || typeof(main_type) != 'string' ){
            console.warn( '_getUserResources_v340_: error, main_type=',  main_type )
            main_type = ""
            // return false;
        }
        if ( !sub_type || typeof(sub_type) != 'string' ){
            console.warn( '_getUserResources_v340_: error, sub_type=',  sub_type )
            sub_type = ""
            // return false;
        }

        let self = this
        let specificUrl = this.url_v340 + "get_res";
        let data = {
            "user_id": user_id , //miflytest
            "main_type": main_type , // ar, vr 
            "sub_type": sub_type 
        }
        let result = self.sendPost_v340(specificUrl, data).then(response => {
            console.log(353, response.data.list)
            return self._createProjResDictFromResList(response.data.list)
        })
    
        return await result;
    }

    //// ver. 3.4.0 搭配 getUserResources_v340 使用
    _createProjResDictFromResList = (userResList) => {
        return new Promise((resolve, reject) => {
            
            if (!userResList) resolve(-1);
    
            let userProjResDict = {};
            for (let i = 0; i < userResList.length; i++ ){
                userProjResDict[ userResList[i].res_id ] = userResList[i];
    
                if ( i == userResList.length-1 ){
                    console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback", i, userResList.length ); // Object.keys(userARResDict).length
                    resolve(userProjResDict)
                }
            }
    
        })
    }

    
    //// ver. 3.4.0 給定[ ProjId₀, ProjId₁ , ... ] 取得VR專案資料
    async getVRProjsByProjId_v340 (projIDList){       

        let specificUrl = this.url_v340 + "get_vr_projs_by_proj_id";
        let data = {
            "proj_id_list": projIDList
        };
        let result = this.sendPost_v340(specificUrl, data);

        return await result;
	}

    //// ver. 3.4.0 get_vr_proj_scene
    async getVRProjScene_v340(user_id, proj_id){

        let specificUrl = this.url_v340 + "get_vr_proj_scene";
        let data = {
            "user_id": user_id,
            "proj_id": proj_id
        };
        let result = this.sendPost_v340(specificUrl, data);

        return await result;	
    }

    //// 改寫自 ver. 3.4.0 networkAgent 的 getUserPublishProjsByUserID
    async getUserPublishProjsByUserID_v340 ( user_id, main_type, sub_type ) {

        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getUserPublishProjsByUserID_v340_: error, user_id=',  user_id )
            user_id = "makarvr"
            // return false;    //// 依照 3.4.0 以前的 neworkAgent 的內容 這裡似乎就讓它通過?
        }
        if ( !main_type || typeof(main_type) != 'string' ){
            console.warn( '_getUserPublishProjsByUserID_v340_: error, main_type=',  main_type )
            main_type = ""
            // return false;
        }
        if ( !sub_type || typeof(sub_type) != 'string' ){
            console.warn( '_getUserPublishProjsByUserID_v340_: error, sub_type=',  sub_type )
            sub_type = ""
            // return false;
        }    
        
        //// for V3 server and Editor
		if ( window.serverVersion == "3.0.0"){

            let userProjResDict = this.getUserResources_v340(user_id)

            let userOnlineResDict = this.getUserOnlineResources_v340(user_id)

            let userPublishProjs = this.getUsrPublishProjs_v340(user_id).then(response => {
                window.userPublishProjs = response.data
                return  response.data
            })       

            return await Promise.all( [userPublishProjs, userProjResDict, userOnlineResDict] );
        }

        else {
            //// 要reject嗎?
            return Promise.reject(new Error(`_getUserPublishProjsByUserID_v340_:\n serverVersion= ${serverVersion}`))
        }
        // return await result;
    }

    //// ver. 3.4.0 的 getUserPublishProjsByUserID_v340 會用到它
    async getUsrPublishProjs_v340(user_id){

        let specificUrl = this.url_v340 + "get_usr_publish_projs";
        let data = {
			"user_id": user_id,
			'web_ar': true,
		}
        let result = this.sendPost_v340(specificUrl, data);
        
        return await result;
    }

    //// ver. 3.4.0 getNewestPublishProjs
    async getNewestPublishProjs_v340( proj_type ){

        if ( !proj_type || typeof(proj_type) != 'string' ){
            console.warn( '_getNewestPublishProjs_v340_: error, proj_type=',  proj_type )
            proj_type = "vr"
            // return false;    //// 依照 3.4.0 以前的 neworkAgent 的內容 這裡似乎就讓它通過?
        }
        let specificUrl = this.url_v340 + "get_newest_publish_projs";
        let data = {
            "proj_type": proj_type,
        }
        let result = this.sendPost_v340(specificUrl, data);

        return await result;
    }

    async readTextFile_v340(fileUrl) {

        return new Promise(function(resolve, reject) {
            fetch( fileUrl, {
                method: 'GET',
                cache: 'no-cache',
                credentials: 'same-origin',
                mode: 'cors', // no-cors, cors, *same-origin  
            }).then( res => res.json() ).then(function( response ){

                setTimeout( function(){
                    resolve( response );
                }, 1 ) 

            })
        }); 
	}

    //// ver. 3.4.0 getViewerConfig
    async getViewerConfig_v340(){

        let specificUrl = this.url_v340 + "get_viewer_config";
        let data = {}
        let result = this.sendPost_v340(specificUrl, data, "3.1.1");

        return await result;
    }

    //// ver. 3.4.0 getARProjsByProjID
    async getARProjsByProjID_v340( projIDList ){
        
        //// 因為 networkAgent 3.4.0 有檢查這個 但我覺得檢查isArray已足矣
        // if ( !projIDList || typeof(projIDList) != 'object' ){
        //     console.warn( '_getARProjsByProjID_v340_: error, projIDList=',  projIDList )
        //     return false;
        // }  
        if (  !projIDList || !Array.isArray(projIDList) ){
            console.warn( '_getARProjsByProjID_v340_: error, projIDList=',  projIDList )
            return false;
        }
        if ( projIDList.length < 1 ){
            console.warn( '_getARProjsByProjID_v340_: error, projIDList=',  projIDList )
            return false;
        }

        let specificUrl = this.url_v340 + "get_ar_projs_by_proj_id";
        let data = {
            "proj_id_list": projIDList
        }
        let result = this.sendPost_v340(specificUrl, data);

        return await result;
    }

    
    //// ver. 3.4.0 getVRSceneByUserID
    async getVRSceneByUserID_v340( user_id ){
        
        if ( !user_id || typeof(user_id) != 'object' ){
            console.warn( '_getVRSceneByUserID_v340_: error, user_id=',  user_id )
            user_id = "makarvr"
            // return false;  //// 依照 3.4.0 以前的 neworkAgent 的內容 這裡似乎就讓它通過?
        }  

        let self = this;
        let VRSceneResult = [];
		VRSceneResult.user_id = user_id;

        let result;
        
        if (serverVersion == "3.0.0"){
			// console.log("networkAgent.js: getVRSceneByUserID 22: ");
			var main_type = "";
			var sub_type = "";

            var getUserPublishProjsCallback = function(userPublishProjs, userProjResDict , userOnlineResDict){
				console.log("networkAgent.js: getVRSceneByUserID_v340: _getUserPublishProjsByUserID: userPublishProjs=", userPublishProjs);
                
                //// source: networkAgent 3.4.0 629行
                if ( typeof(userPublishProjs) != "string" ){

                    //// 
                    let projIDList = [];
                    for (let i in userPublishProjs.proj_list){
						if (userPublishProjs.proj_list[i].proj_type == "vr"){
                            //[start-20200522-fei0095-add]//
							//// 判斷只有在 editor 勾選「開啟網頁展示」的專案會顯示。為了不造成顯示錯誤，統一由 interface 控管
							if (parent.useEditorWebTag){
								if ( !userPublishProjs.proj_list[i].proj_platform.find( item => item == "web") ){
									continue;
								}
							}
                            //[end---20200522-fei0095-add]//
							projIDList.push( userPublishProjs.proj_list[i].proj_id  );
						}
					}
                    
                    self.getVRProjsByProjId_v340(projIDList).then( response => {
                        let publishVRProjs = response.data;
						window.publishVRProjs = publishVRProjs;

                        let count = 0;
						if ( publishVRProjs.result ){
							if ( publishVRProjs.result.length ){
								for (let j = 0; j < publishVRProjs.result.length; j++ ){	

                                    self.getVRProjScene_v340( publishVRProjs.result[j].user_id, publishVRProjs.result[j].proj_id ).then( response => {
										count++;
                                        // console.log("networkAgent.js: get_vr_proj_scene: onload, response=", response );
										VRSceneResult[j] = response.data;
                                        
                                        if ( count == publishVRProjs.result.length ){
											// console.log("%cnetworkAgent.js: get_vr_proj_scene: onload, save VRSceneResult ", "color:red", count );
											window.VRSceneResult = VRSceneResult;
											window.userProjResDict = userProjResDict;
											window.userOnlineResDict = userOnlineResDict;

											return VRSceneResult;
										}
                                    })

								}
							}
						}
                    })  
                }
            };

            self.searchUserIDByUserID_v340( user_id ).then( res => {
                for (let userID in  res.data.result ){
                    if ( user_id.toLowerCase() === res.data.result[userID].user_id.toLowerCase()  ){
                        console.log("networkAgentVR.js: _searchUserIDByUserID: match, replace from [" , user_id , "] to [", res.data.result[userID].user_id, "]"  );
                        user_id = res.data.result[userID].user_id;
                    }
                }            

                return self.getPayInfoByUserID_v340(user_id)
    
            }).then(userPayInfo => {                
            
                let userIDWhiteListUrl = 'https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/web_white_list/webVR_UserID_WhiteList.txt';
            
                return Promise.all([userPayInfo, self.readTextFile_v340(userIDWhiteListUrl)]); 
            
            }).then( ([userPayInfo, jsonObj])  => {
                // console.log("readTextFile_v340, userPayInfo=", userPayInfo)
                // console.log("readTextFile_v340, jsonObj=", jsonObj)
                
                let userIDList = jsonObj["customizedUserID"]["list"];
                let nameList = [];
                for (let i = 0; i < userIDList.length; i++){
                    nameList.push(userIDList[i]["name"]);
                }
                let isInNameList = (nameList.indexOf(user_id.toLowerCase() ) > -1);
            
                if (userPayInfo.data){
                    console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: userPayInfo =", userPayInfo.data );
            
                    ////// 改為使用 web_ar 這個 key 來判斷是否可以體驗，基本上 free 用戶 一定是 false, 而註冊送的一個月用戶也是 false, proA/B/C是true
                    ////// 假如在 白名單列表裡面，直接設定為可以使用
                    ////// 後續有一狀況，假如用戶本身為不可使用，但是透過 license 發出的專案卻需要判定可用，需要額外判斷。固在此無條件往下執行。
                    window.allowedMakarIDUseWeb = userPayInfo.data.web_ar || isInNameList ;
            
                    if ( userPayInfo.data.user_type == 'proA' || userPayInfo.data.user_type == 'proB' || userPayInfo.data.user_type == 'proC' || userPayInfo.data.user_type == 'custom' ){
                        window.allowedMakarIDUseWeb = true;
                    }
                    
                    // self.getUserPublishProjsByUserID( user_id, main_type, sub_type, getUserPublishProjsCallback );
                    self.getUserPublishProjsByUserID_v340( user_id, main_type, sub_type ).then( ([userPublishProjs, userProjResDict, userOnlineResDict]) => {
                        result = getUserPublishProjsCallback(userPublishProjs, userProjResDict , userOnlineResDict)
                    })
            
                }else{
                    console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: error, userPayInfo=", userPayInfo );	
                    // if(callback) callback("this ID <br> [" + user_id + "] <br> user data error, please contact MIFLY for more information. ");
                    reject("this ID <br> [" + user_id + "] <br> user data error, please contact MIFLY for more information. ");
                }
                
            })
            
        }
        
        return await result;
    }

    
    //// ver. 3.4.0 getPayInfoByUserID
    async getPayInfoByUserID_v340( user_id ){
        
        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_getPayInfoByUserID_v340_: error, user_id=',  user_id )
            return false;
        }  
        let specificUrl = this.url_v340 + "get_pay_info";
        let data = {
            "user_id": user_id
        }
        let result = this.sendPost_v340(specificUrl, data);

        return await result;
    }

    //// ver. 3.4.0 取得 license 相關的訊息 getELicenseInfo
    async getELicenseInfo_v340( license_key ){
        
        if ( !license_key || typeof(license_key) != 'string' ){
            console.warn( '_getELicenseInfo_v340_: error, license_key=',  license_key )
            return false;
        }  
        let specificUrl = this.url_v340 + "get_e_lice_info";
        let data = {
            "license_key": license_key
        }
        let result = this.sendPost_v340(specificUrl, data, '3.1.1');

        return await result;
    }

    //// 需要先寫好 userPublishProjs 才能往下
    ////// 檢查各專案是否帶有 lisence 
	// window.checkLicenseInProjs =

    //// ver. 3.4.0 從server 取得模組專案資訊
    async getRecordModule_v340( playing_user_id , proj_id ){
        
        let specificUrl = this.url_v340 + "get_record_module";
        let data =  {
            "playing_user_id": playing_user_id,
            "proj_id": proj_id 
        } 
        let result = this.sendPost_v340(specificUrl, data, '3.1.1');

        //// 此函示尚未測試
        //// 暫時在專案裡找不到 playing_user_id (在VR看來是在localStorage，但搜尋不到 setItem("login_shared_id") 的段落)
        console.log("networkAgentVR.js: _getRecordModule: ret" , ret );

        return await result;
    }

    //// ver. 3.4.0 上傳 quiz log資訊到server，給數據分析使用 
    async quizLog_v340( data ){
        
        let specificUrl = this.url_v340 + "quiz_log";
        let result = this.sendPost_v340(specificUrl, data, '3.1.1');
        
        return await result;
    }
    
    //// ver. 3.4.0 上傳 quiz record 資訊到server，給viewer端檢驗 
    async updateRecordModule_v340( data ){
        
        let specificUrl = this.url_v340 + "update_record_module";
        let result = this.sendPost_v340(specificUrl, data, '3.1.1');
        
        return await result;
    }    
    
    //// ver. 3.4.0 getVRDataByUserID
    //// 這個 getVRDataByUserID 函式在makar-web-xr裡搜尋找不到在哪裡被呼叫，
    //// 而用 postman 測試API網址會not found 因此這整段code並沒有測試過
    // async getVRDataByUserID_v340( user_id ){
        
    //     if ( !user_id || typeof(user_id) != 'string' ){
    //         console.warn( '_getVRDataByUserID_v340_: error, user_id=',  user_id )
    //         user_id = "makarvr"
    //         // return false;    //// 依照 3.4.0 以前的 neworkAgent 的內容 這裡似乎就讓它通過?
    //     }  

    //     let destination = this.url_v340

    //     return new Promise(function(resolve, reject) {
            
    //         let data = {
    //             "user_id": user_id,
    //             "cid": "20"
    //         }                   
    //         let strData = JSON.stringify(data);
    //         //// the formData
    //         let FD  = new FormData();
    //         FD.append("cmd", "get_vr_projs");	 
    //         FD.append("data", strData );
            
    //         fetch( destination, {
    //             body: FD,
    //             method: 'POST',
    //             cache: 'no-cache',
    //             credentials: 'same-origin',
    //             mode: 'cors', // no-cors, cors, *same-origin  
    //         }).then( res => res.json() ).then(function( response ){

    //             //// MAKAR "will" all use gzip compress the text as soon as We can(?)
    //             if (response.diaoyurar ){
    //                 // console.log("networkAgent.js: getVRDataByUserID: response.diaoyurar ");

    //                 let jsonData =  parseDiaoyurar(response.diaoyurar);
    //                 if (!jsonData.error){
    //                     if (jsonData.data){
    //                         userVRData = jsonData.data;
    //                         //// save the userVRData in window  
    //                         if (!window.userVRData){
    //                             console.log("networkAgent.js: getVRDataByUserID: save window.userARData ");
    //                             window.userVRData = userVRData; 
    //                         }else{
    //                             console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it..");
    //                             window.userVRData = userVRData; 
    //                         }
    //                         // if (callback) callback(userVRData);                             
    //                         setTimeout( function(){
    //                             resolve( response );
    //                         }, 1 )

    //                     }else{
    //                         // if (callback) callback("networkAgent.js:getVRDataByUserID:error: no jsonData.data"); 
    //                         reject("networkAgent.js:getVRDataByUserID:error: no jsonData.data")
    //                     }

    //                 }else{
    //                     // if (callback) callback( jsonData.error ); 
    //                     console.log("networkAgent.js: getVRDataByUserID: oops something wrong:", jsonData.error);
    //                     reject(jsonData.error)
    //                 }

    //                 // console.log(jsonData);
    //             }else{
    //                 // console.log("networkAgent.js: getVRDataByUserID: not response.diaoyurar ", response);

    //                 if (!response.error){
    //                     if (response.data){
                            
    //                         userVRData = response.data;

    //                         // console.log("networkAgent.js:getVRDataByUserID: onload, response=", response );
                            
    //                         //// save the userVRData in window
    //                         if (userVRData.proj_list) {

    //                             if (!window.userVRData){
    //                                 console.log("networkAgent.js: getVRDataByUserID: save window.userARData =", userVRData);
    //                                 window.userVRData = userVRData; 
    //                             }else{
    //                                 console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it..");
    //                                 window.userVRData = userVRData; 
    //                             }
        
    //                             // if (callback) callback(userVRData);
    //                             setTimeout( function(){
    //                                 resolve( response );
    //                             }, 1 )

    //                         }else{
    //                             console.log("%cnetworkAgent.js:getVRDataByUserID: onload, fail userVRData.proj_list is empty", "color:red" );
    //                             // if (callback) callback("the userVRData.proj_list is empty");
    //                             reject("the userVRData.proj_list is empty")
    //                         }
                        

    //                     }else{
    //                         // if (callback) callback("networkAgent.js:getVRDataByUserID:error: no response.data"); 
    //                         reject("networkAgent.js:getVRDataByUserID:error: no response.data")
    //                     }
    //                 }else{
    //                     // if (callback) callback( response.error ); 
    //                     console.log("networkAgent.js: getVRDataByUserID: oops something wrong:", response.error);
    //                     reject(response.error)
    //                 }
    //             }


    //         })
    //     });

    // }

    //// ver. 3.4.0 uploadDataToServer
    //// 這個 uploadDataToServer 函式在makar-web-xr裡搜尋找不到在哪裡被呼叫，data 內的資料暫時不知怎麼給 
    ////  因此這整段code並沒有測試過
    // async uploadDataToServer_v340( index ){
        
	// 	if ( serverVersion == "3.0.0"){
    //         let specificUrl = this.url_v340 + "add_scan_times";
    //         let data = {
    //             "user_id": userARData.user_id,
    //             "target_id": userARData.proj_list[index].target_id // 1545795389.8544426.1988048228
    //         }
    //         let result = this.sendPost_v340(specificUrl, data);
            
    //         return await result;
    //     } 
        
	// 	if ( serverVersion == "2.0.0"){
	// 		let strData = JSON.stringify(data);
	// 		let FD  = new FormData();
	// 		FD.append("cmd", "add_scan_times");	//get_ar_projs ,  get_ar_proj_scene	, get_ar_projs_by_proj_id
	// 		FD.append("data", strData );

    //         fetch( destination, {
    //             body: FD,
    //             method: 'POST',
    //             cache: 'no-cache',
    //             credentials: 'same-origin',
    //             mode: 'cors', // no-cors, cors, *same-origin  
    //         }).then( res => res.json() ).then(function( response ){    
	// 			console.log("networkAgent: uploadDataToServer, response.data = ", response.data );
    //             resolve(response.data)
	// 		})

	// 	}
    // }        

    //// ver. 3.4.0 searchUserIDByUserID 
    async searchUserIDByUserID_v340( user_id ){
        
        if ( !user_id || typeof(user_id) != 'string' ){
            console.warn( '_searchUserIDByUserID_v340_: error, user_id=',  user_id )
            return false;
        }  
        let specificUrl = this.url_v340 + "get_many_usr_info_keyword";
        let data =  {
			"keyword": user_id,
			"search_keys": ["user_id"]
        } 
        let result = this.sendPost_v340(specificUrl, data);
        
        return await result;
    }

    //[end-20230927-howardhsu-add]//
    


}

const net = new NetworkAgent();

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (net);



/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/AudioModule.js":
/*!*************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/AudioModule.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   loadAudio: () => (/* binding */ loadAudio)
/* harmony export */ });
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./GLTFModelModule.js */ "./js/VRMain/version3_5/vrObjectModules/GLTFModelModule.js");



function loadAudio( obj , position, rotation, scale) {
    //20191105-start-thonsha-add
    console.log("VRFunc.js: _loadAudio , obj=", obj );
    let self = this
    let pAudio = new Promise( function( audioResolve ){

        ;(0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.UrlExists)( obj.res_url , function( retStatus ){
            //// 先檢查「聲音物件網址是否存在」，否的話，載入「問號模型物件」
            if ( retStatus == true ){

                let assets = document.getElementById("makarAssets");

                console.log("_loadAudio: checkFileExtension", obj)

                //// 測試 "沒有副檔名的聲音檔"
                // let testUrl = "https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets/Users/80226cb1-a28b-4803-b3f4-92508ce5d3fa/Resource/625e3651-04b1-4fb7-8324-3d140558c559"
                // obj.res_url = testUrl

                //// 目前編輯器支援的聲音檔案格式 "mp3", "wav", "ogg"  且編輯器v3.5都會帶有副檔名
                let getTailOf_res_url = obj.res_url.substring(obj.res_url.lastIndexOf('.') + 1)

                //// 暫時當作 "檔案取名為.mp3 但該檔案其實沒有副檔名" 不會發生
                console.log("_loadAudio: checkFileExtension getTail" , getTailOf_res_url);

                let assetsitem = document.createElement("audio");
                
                let isAudioSetted = false
                switch (getTailOf_res_url) {
                    case "mp3":
                    case "wav":
                    case "ogg":
                        //// 有副檔名，且是 mp3 wav ogg
                        setAudioAttr(assetsitem, obj.res_url)
                        assetsitem.onloadedmetadata = function() {
                            // console.log("%c 到底會不會觸發?", "color: yellow;font-size:25px")
                            handleAudio()
                        }
                        
                        break;

                    default:
                        //// 沒有副檔名
                        fetch( obj.res_url, {
                            // headers: {
                            //     "Content-Type": "audio/mpeg",
                            // },
                            method: 'GET',
                            cache: 'no-cache',
                            credentials: 'same-origin',
                            mode: 'cors', // no-cors, cors, *same-origin
                        }).then(function( response ){
                            return response.blob();
                        }).then( function( audioBlob ){
                            let vid = URL.createObjectURL(audioBlob);
                            // assetsitem.setAttribute("src", vid );
                            console.log('__AudioModules.js: before _onloadedmetadata ' , vid );
                            
                            //// 沒有副檔名的情況下 ios 不會觸發 onloadedmetadata 因此底下多聽一個loadstart
                            assetsitem.onloadedmetadata = function() {
                                console.log(' 7777777777777777777 AudioModules.js: _onloadedmetadata ' , vid );
                                // console.log("%c 還是不會觸發orz", "color: yellow;font-size:25px")

                                if( !isAudioSetted ) {
                                    handleAudio()
                                }
                            }
                            
                            //// 這裡可以認定為audioBlob已經載完  使用loadstart事件應該沒問題
                            assetsitem.addEventListener("loadstart", function( event ) {
                                console.log('__AudioModules.js: loadstart  \n\n' , vid );

                                if( !isAudioSetted ) {
                                    handleAudio()
                                }
                                
                            })
                            
                            setAudioAttr(assetsitem, vid)
                            
                        })

                        break;
                }

                //// 設定 assets item 的屬性
                function setAudioAttr(assetsitem, src=obj.res_url){
                    assetsitem.setAttribute("id", obj.generalAttr.obj_id+"_"+obj.res_id);
                    assetsitem.setAttribute("src", src);
                    assetsitem.setAttribute('crossorigin', 'anonymous');
                    assetsitem.setAttribute("loop", true);
                    assetsitem.setAttribute("preload", "auto");
                    assets.appendChild(assetsitem);
                }

                //// 設定聲音物件並加到場景
                function handleAudio() {

                    let soundEntity = document.createElement('a-sound');  

                    //[start-20230816-howardhsu-modify]//
                    // soundEntity.setAttribute("sound", "src: "+"#"+obj.generalAttr.obj_id+"_"+obj.res_id+"; autoplay: true; loop: true; volume: 1; positional: false");
                    soundEntity.setAttribute("sound", "src: "+"#"+obj.generalAttr.obj_id+"_"+obj.res_id+"; positional: false");
                    //[end-20230816-howardhsu-modify]//

                    soundEntity.setAttribute( "id", obj.generalAttr.obj_id );
                    soundEntity.setAttribute("sound", "autoplay: false");                  
                        
                    self.setTransform(soundEntity, position, rotation, scale);
                    self.makarObjects.push( soundEntity );

                    //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
                    let audioVisible = true;
                    if ( obj.generalAttr.active == false ){
                        audioVisible = false;
                        
                        soundEntity.setAttribute("sound", "loop: false");
                        soundEntity.setAttribute("visible", false);
                        soundEntity.setAttribute('class', "unclickable" );
                    }

                    let audioBehavRef = false;
                    if(obj.behav_reference){
                        for(let i=0; i<obj.behav_reference.length;i++){
                            if (obj.behav_reference[i].behav_type == 'Display' && 
                                (obj.behav_reference[i].switch_type == 'Show'   || 
                                obj.behav_reference[i].switch_type == 'Switch' )
                            ){
                                audioVisible = false;
                                audioBehavRef = true;
                                soundEntity.setAttribute("sound", "loop: false");
                                soundEntity.setAttribute("visible", false);
                                // soundEntity.setAttribute('class', "unclickable" );
                                break;
                            }
                        }
                        
                    }else{
                        soundEntity.setAttribute("visible", true);
                    }
                    //20191227-end-thonsha-mod

                    if(obj.generalAttr.obj_parent_id){
                        
                        let timeoutID = setInterval( function () {
                            let parent = document.getElementById(obj.generalAttr.obj_parent_id);
                            if (parent){ 
                                if(parent.object3D.children.length > 0){
                                    parent.appendChild(soundEntity);
                                    window.clearInterval(timeoutID);

                                    parent.addEventListener("child-attached", function(el){

                                        console.log("VRFunc.js: VRController: _loadAudio,: parent child-attached, el=", el );

                                        if ( obj.generalAttr.logic ){

                                            soundEntity.blockly = obj.generalAttr.logic;
                                            soundEntity.setAttribute("sound", "autoplay: false");

                                        } else {

                                            let parentVisible = true;
                                            soundEntity.object3D.traverseAncestors( function(parent) {
                                                if (parent.type != "Scene"){
                                                    console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: not Scene parent=", parent );
                                                    if (parent.visible == false){
                                                        parentVisible = false;
                                                    }
                                                } else {
                                                    if (parentVisible == true && soundEntity.object3D.visible == true && audioBehavRef == false && audioVisible == true && obj.generalAttr.active ){
                                                        console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: all parent visible true=", soundEntity.object3D );

                                                        //// 由於這邊是『載入場景』時候希望自動播放聲音，所以這邊需要用戶額外點擊
                                                        if ( (window.Browser.mobile == true && window.Browser.name == "safari" && window.allowAudioClicked != true) || 
                                                            (window.allowAudioClicked != true && location == parent.location ) ){
                                    
                                                            soundEntity.setAttribute("sound", "autoplay: false");
                            
                                                            let clickToPlayAudio = document.getElementById("clickToPlayAudio");
                                                            clickToPlayAudio.style.display = "block";
                                                            
                                                            clickToPlayAudio.addEventListener('click', f_clickToPlayAudio );
                                                            function f_clickToPlayAudio (){
                                                                soundEntity.components.sound.playSound();

                                                                clickToPlayAudio.style.display = "none";
                                                                clickToPlayAudio.removeEventListener( 'click', f_clickToPlayAudio )
                                                                window.allowAudioClicked = true;
                                                            }
                            
                                                        }else{
                                                            soundEntity.setAttribute("sound", "autoplay: true");

                                                            //[start-20230815-howardhsu-add]//                                                         
                                                            checkAudioTypeAttr(obj, soundEntity, audioBehavRef)
                                                            //[end-20230815-howardhsu-add]//
                                                        }

                                                    }else{
                                                        console.log("2 VRFunc.js: VRController: _loadAudio,: traverseAncestors: not all parent visible true=", soundEntity.object3D.children[0] );
                                                        soundEntity.setAttribute("sound", "autoplay: false"); 
                                                    }
                                                }
                                            });

                                        }

                                    })

                                } 
                            }
                        }, 1);
                    }
                    else{	
                        console.log("VRFunc.js: _loadAudio: no parent set autoplay true", soundEntity.object3D , location );
                        
                        if ( obj.generalAttr.logic ){
                            soundEntity.blockly = obj.generalAttr.logic;
                            soundEntity.setAttribute("sound", "autoplay: false");
                        } else if ( !obj.generalAttr.active ) {
                            soundEntity.setAttribute("sound", "autoplay: false");
                        
                        }  else {        

                            //// 先判斷是否為「本體可見」和「 不是事件控制播放 」，是的話進入瀏覽器允許判斷
                            if ( audioVisible == true && audioBehavRef == false ){

                                //// 由於這邊是『載入場景』時候希望自動播放聲音，所以這邊需要用戶額外點擊
                                // if ( true ){
                                // if ( window.allowAudioClicked != true ){
                                if ( (window.Browser.mobile == true && window.Browser.name == "safari" && window.allowAudioClicked != true) || 
                                (window.allowAudioClicked != true && location == parent.location ) ){
                                
                                    soundEntity.setAttribute("sound", "autoplay: false");

                                    let clickToPlayAudio = document.getElementById("clickToPlayAudio");
                                    clickToPlayAudio.style.display = "block";
                                    
                                    clickToPlayAudio.addEventListener('click', f_clickToPlayAudio );
                                    function f_clickToPlayAudio (){
                                        soundEntity.components.sound.playSound();
                                        clickToPlayAudio.style.display = "none";
                                        clickToPlayAudio.removeEventListener( 'click', f_clickToPlayAudio )
                                        window.allowAudioClicked = true;
                                    }

                                }else{
                                    
                                    soundEntity.setAttribute("sound", "autoplay: true");
                                    checkAudioTypeAttr(obj, soundEntity, audioBehavRef)
                                    
                                }   

                            }else{
                                //// 假如 此聲音物件是被「 顯示事件 」所操控，那目前在 MAKAR App 強制設定為 此聲音物件「不可見」
                                //// 沒有掛「邏輯」、是透過顯示事件控制
                                //// 設定為「不自動播放」、「不可見」
                                soundEntity.setAttribute("sound", "autoplay: false");
                                soundEntity.setAttribute("visible", false );

                            }
                             

                        }                       
                        
                        self.vrScene.appendChild(soundEntity);
                    }

                    soundEntity.addEventListener("loaded", function(evt){

                        if (evt.target == evt.currentTarget){
                            console.log("3 VRFunc.js: VRController: _loadAudio,: loaded, soundEntity.object3D.children[0]=", soundEntity.object3D.children[0] );
                            soundEntity.object3D["makarObject"] = true; 
                            soundEntity.object3D["makarType"] = 'audio'; 
                            
                            if ( obj.behav ){
                                soundEntity.object3D["behav"] = obj.behav ;

                                //// 載入時候建制「群組物件資料」「注視事件」
                                self.setObjectBehavAll( obj );
                            }
                            if(obj.behav_reference){
                                soundEntity.object3D["behav_reference"] = obj.behav_reference ;
                            }


                            audioResolve( soundEntity );
                        }
                    });
                    isAudioSetted = true
                }

            }else{							
                console.log("VRFunc.js: _loadAudio , obj url not exist ", obj );
                
                obj.main_type = 'model';
                obj.sub_type = 'glb';
                obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";

                //[start-20230726-howardhsu-modify]//                                   
                (0,_GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_1__.loadGLTFModel)( obj , position, rotation, scale , self.cubeTex )
                //[end-20230726-howardhsu-modify]//

                audioResolve( 1 );
            }

        });

    });

    return pAudio;

//20191105-end-thonsha-add
}


//// set audio attr according to the obj in makar with autoplay, volume, loop
//// 自動播放、音量、循環
function checkAudioTypeAttr(obj, soundEntity, audioBehavRef){  
    //[start-20230815-howardhsu-add]//
    if ( obj.generalAttr.active == false || audioBehavRef){                                                           
        soundEntity.setAttribute("sound", "autoplay: false");
    }  
    else if(obj.typeAttr){           
        
        if(obj.typeAttr.is_play != undefined){                                                                         
            soundEntity.setAttribute("sound", `autoplay: ${obj.typeAttr.is_play}`);
        }    
        if(obj.typeAttr.is_loop != undefined){ 
            soundEntity.setAttribute("sound", `loop: ${obj.typeAttr.is_loop}`); 
        }    
        if(obj.typeAttr.volume != undefined){ 
            soundEntity.setAttribute("sound", `volume: ${obj.typeAttr.volume}`); 
        }       
    } 
    //[end-20230815-howardhsu-add]//      
}

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/CurveModule.js":
/*!*************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/CurveModule.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   bezierPathAnime: () => (/* binding */ bezierPathAnime),
/* harmony export */   loadCurve: () => (/* binding */ loadCurve)
/* harmony export */ });
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _setTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");
/* harmony import */ var _GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GLTFModelModule.js */ "./js/VRMain/version3_5/vrObjectModules/GLTFModelModule.js");




//// the html will use this function to load image
//// It is sad that I cant use default a-plane tag to get the image width/height 
function loadCurve( obj, position, rotation, scale ) {
    console.log("VRFunc.js: VRController: _loadCurve, obj=", obj, position, rotation, scale );
    let self = this
    
    //// 檢查是否為「預設物件」
    ;(0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.checkDefaultImage)( obj );
    
    let pCurve = new Promise( function( curveResolve ){
  
        let curveEntity = document.createElement('a-entity');   //最上層物件，用來放curve本身，不要apply transform
        let bezierEntity = document.createElement('a-entity');  //用來作用curve object的transformation
        
        bezierEntity.setAttribute( "id", obj.generalAttr.obj_id );//// fei add 
        bezierEntity.setAttribute('crossorigin', 'anonymous');
        (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_1__.setTransform)(bezierEntity, position, rotation, scale);

        self.makarObjects.push( curveEntity );
        self.makarObjects.push( bezierEntity );

        curveEntity.appendChild(bezierEntity);

        curveEntity.addEventListener("loaded", function(evt){

            for (let i=0; i<obj.typeAttr.nodes.length-1; i++){

                let curve , points , geometry , material , curveObject;
                curve = new THREE.CubicBezierCurve3(
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[i][1].split(",").map( x => Number(x) ) ).multiply( new THREE.Vector3( -1, 1, 1 ) )  ,    // p1
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[i][2].split(",").map( x => Number(x) ) ).multiply( new THREE.Vector3( -1, 1, 1 ) )  ,    // nextPoint of p1
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[i+1][0].split(",").map( x => Number(x) )  ).multiply( new THREE.Vector3( -1, 1, 1 ) )  , // prePoint of p2
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[i+1][1].split(",").map( x => Number(x) )  ).multiply( new THREE.Vector3( -1, 1, 1 ) )  , // p2
                );
                // points = curve.getPoints( 50 ); //預設切50點 可調整
                // geometry = new THREE.BufferGeometry().setFromPoints( points );
                let c = new THREE.Color( 0xffffff );
                c.setHex( Math.random() * 0xffffff );
                material = new THREE.LineBasicMaterial( { color: c } );
                // // Create the final object to add to the scene
                // curveObject = new THREE.Line( geometry, material );

                // self.vrScene.object3D.add( curveObject );
                // curveEntity.object3D.add(curveObject);

                let tubeGeometry = new THREE.TubeGeometry(curve, 20, 0.1, 2, false);
                let meshmaterial = new THREE.MeshBasicMaterial({ color: c, side: THREE.DoubleSide }); // MeshLambertMaterial,
                let tubeMesh = new THREE.Mesh(tubeGeometry, meshmaterial);
                tubeMesh.visible = false;
            
                curveEntity.object3D.add(tubeMesh);
            }

            if(obj.typeAttr.is_cycle){  // 首尾相連
                let curve , points , geometry , material , curveObject;
                curve = new THREE.CubicBezierCurve3(
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[obj.typeAttr.nodes.length-1][1].split(",").map( x => Number(x) ) ).multiply( new THREE.Vector3( -1, 1, 1 ) )  ,
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[obj.typeAttr.nodes.length-1][2].split(",").map( x => Number(x) ) ).multiply( new THREE.Vector3( -1, 1, 1 ) )  ,
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[0][0].split(",").map( x => Number(x) )  ).multiply( new THREE.Vector3( -1, 1, 1 ) )  ,
                    new THREE.Vector3 ().fromArray( obj.typeAttr.nodes[0][1].split(",").map( x => Number(x) )  ).multiply( new THREE.Vector3( -1, 1, 1 ) )  ,
                );
                // points = curve.getPoints( 50 );
                // geometry = new THREE.BufferGeometry().setFromPoints( points );
                let c = new THREE.Color( 0xffffff );
                c.setHex( Math.random() * 0xffffff );
                material = new THREE.LineBasicMaterial( { color: c } );
                // // Create the final object to add to the scene
                // curveObject = new THREE.Line( geometry, material );

                let tubeGeometry = new THREE.TubeGeometry(curve, 20, 0.1, 2, false);
                let meshmaterial = new THREE.MeshBasicMaterial({ color: c, side: THREE.DoubleSide }); // MeshLambertMaterial,
                let tubeMesh = new THREE.Mesh(tubeGeometry, meshmaterial);
                tubeMesh.visible = false;
                
                curveEntity.object3D.add(tubeMesh);
            }
            

            curveResolve(curveEntity);
            
        });

        bezierEntity.addEventListener( 'loaded' , function(){
            ///// 增加一個「空物件」，代表此 entity 已經自身載入完成
            let bezierbject3D = new THREE.Object3D();
            bezierEntity.object3D.add( bezierbject3D );
        });


        if(obj.generalAttr.obj_parent_id){

            let timeoutID = setInterval( function () {
                let parent = document.getElementById(obj.generalAttr.obj_parent_id);

                if (parent){ 
                    if(parent.object3D.children.length > 0){
                        parent.appendChild(curveEntity);
                        window.clearInterval(timeoutID);
                    } 
                }
            }, 100);
        }
        else{
            self.vrScene.appendChild(curveEntity);
        }
        
    });

    return pCurve;
    
}


function bezierPathAnime( bezierInfo, sceneIdx ){
    let self = this;

    let targetCurve = document.getElementById(bezierInfo.bezier_id).parentNode.object3D;
    let speed = bezierInfo.period;
    if (speed <= 0) return ;
    let offsetTranslate = bezierInfo.shift_position.split(",").map(x => Number(x));
    let offsetRotation = bezierInfo.shift_rotation.split(",").map(x => Number(x));
    let offsetQuaternion =  new THREE.Quaternion(offsetRotation[0], offsetRotation[1], offsetRotation[2], offsetRotation[3])
    let offsetEuler = new THREE.Euler().setFromQuaternion( offsetQuaternion, "XYZ");
    offsetQuaternion.setFromEuler(new THREE.Euler(offsetEuler.x, -offsetEuler.y, -offsetEuler.z) );
    let nodeNormals = [];
    let quaternionList = [];

    let pathMeshList = []; 
    let curveTotalLength = 0;
    for (let i = 0; i < targetCurve.children.length; i++) { // 找出curve geometry
        if(targetCurve.children[i].type == 'Mesh'){
            pathMeshList.push(targetCurve.children[i]);
            curveTotalLength += targetCurve.children[i].geometry.parameters.path.getLength();
        }
    }

    let objs= self.scenesData.scenes[sceneIdx].objs;
    let targetCurveData;
    let isCameraObj = false;
    for (let i = 0; i < objs.length; i++){
        if(objs[i].generalAttr.obj_id == bezierInfo.bezier_id)   targetCurveData = objs[i];
        if(objs[i].generalAttr.obj_id == bezierInfo.obj_id){
            if(objs[i].res_id == "camera"){
                isCameraObj = true;
            }  
        }
    }

    let movingObj;
    if (isCameraObj){
        bezierInfo.obj_id = "camera_cursor";   //若移動物件為相機，將obj_id改為camera_cursor
    } 

    movingObj = document.getElementById(bezierInfo.obj_id);

    for (let i = 0; i < targetCurveData.typeAttr.nodes.length; i++){    // 計算主要nodes的normal和quaternion
        let position = targetCurveData.typeAttr.nodes[i][1].split(",").map(x => Number(x));
        let normal = targetCurveData.typeAttr.nodes[i][3].split(",").map(x => Number(x));
        // let nodeQuaterData = targetCurveData.typeAttr.nodes[i][4].split(",").map(x => Number(x));
        // let nodeQuater = new THREE.Quaternion(nodeQuaterData[0], nodeQuaterData[1], nodeQuaterData[2], nodeQuaterData[3]);

        nodeNormals.push(new THREE.Vector3(-normal[0], normal[1], normal[2]).sub(new THREE.Vector3(-position[0], position[1], position[2])));
        // let inverseMatrix = new THREE.Matrix4().makeRotationFromQuaternion(nodeQuater);
        // inverseMatrix.getInverse(inverseMatrix);
        
        let quat =  new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0,1,0), nodeNormals[i].normalize());
        // let quatMatrix = new THREE.Matrix4().makeRotationFromQuaternion(quat);
        // nodeNormals[i].applyMatrix4(inverseMatrix.multiply(quatMatrix));
        // let quat2 =  new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0,1,0), nodeNormals[i].normalize());
        // quaternionList.push(quat2);
        quaternionList.push(quat);
    }
    if(targetCurveData.typeAttr.is_cycle){  //若有首尾相連多加第一個點為結尾
        nodeNormals.push(nodeNormals[0]);
        quaternionList.push(quaternionList[0]);
    }

    let duration =  curveTotalLength * 1000 / speed;

    let steps = 3000; //// 步數，代表要多精細的呈現 時間

    //// 使用 three 的 curve
    //// 計算位置與角度的變量
    let direction = new THREE.Vector3(), binormal = new THREE.Vector3(), normal = new THREE.Vector3(), position = new THREE.Vector3(), lookat = new THREE.Vector3(), matrixR = new THREE.Matrix4(), quaternion = new THREE.Quaternion();

    //// 先計算出來沿著曲線的『位置』跟『角度』以避免即時計算效能不足
    let PR = calculateCurvePRList(steps);
    // console.log(" -- PR = ", PR);

    function calculateCurvePRList(count) {

        let pList = new Array(count), rList = new Array(count);
        
        let t = 0;

        let currentGeoIdx = 0;
        let previosGeoLength = 0;
        let meshGeo;
    
        let lengths = pathMeshList[currentGeoIdx].geometry.parameters.path.getLengths((pathMeshList[currentGeoIdx].geometry.parameters.path.getLength()/curveTotalLength * count));
        for (let i = 0; i < count; i++) {
           
            if(i > (previosGeoLength + pathMeshList[currentGeoIdx].geometry.parameters.path.getLength())/curveTotalLength * count){
                previosGeoLength += pathMeshList[currentGeoIdx].geometry.parameters.path.getLength();
                currentGeoIdx +=1 ;
                lengths = pathMeshList[currentGeoIdx].geometry.parameters.path.getLengths((pathMeshList[currentGeoIdx].geometry.parameters.path.getLength()/curveTotalLength * count));

            }
            
            meshGeo = pathMeshList[currentGeoIdx].geometry;
            t = (i- previosGeoLength/curveTotalLength * count) / (pathMeshList[currentGeoIdx].geometry.parameters.path.getLength()/curveTotalLength * count);
            
            meshGeo.parameters.path.getPoint(t, position);

            // 取得線段方向
            direction = meshGeo.parameters.path.getTangent(t);

            direction.multiply( new THREE.Vector3( -1, -1, -1 ) );  // 網頁和MAKAR中的forward方向相反(觀察結果)，故將direction轉反方向
            
            // 取得『法向量』
            let currentQuater = quaternionList[currentGeoIdx].clone();
            currentQuater.slerp(quaternionList[currentGeoIdx+1], lengths[Math.floor(t * (pathMeshList[currentGeoIdx].geometry.parameters.path.getLength()/curveTotalLength * count))]/meshGeo.parameters.path.getLength());
            normal.set(0,1,0);
            normal.applyQuaternion(currentQuater);

            // 加上物件的中心位置
            pList[i] = position.clone();
            // 設置『視角方向』，基本的就是沿著行進路線方向
            lookat.copy( position ).add( direction );

            matrixR.lookAt(position, lookat, normal);
            quaternion.setFromRotationMatrix(matrixR);

            rList[i] = quaternion.clone();
        }

        return [pList, rList ];
    }

    let autoplay = false;
    if(bezierInfo.trigger_type == "Direct"){
        autoplay = true;
    }     
    else{   // 塞觸發事件到相關物件上
        let trigger_obj = document.getElementById(bezierInfo.trigger_id);
        trigger_obj.setAttribute('class', "clickable" );
        if (trigger_obj.object3D["behav"] == undefined) trigger_obj.object3D["behav"] = []
        trigger_obj.object3D["behav"].push(
            {
                "trigger_type": "Click",
                "trigger_obj_id": bezierInfo.trigger_id,
                "behav_type": "MoveAlongPath",
                "switch_type": "On",
                "obj_id": bezierInfo.obj_id,
                "group": "",
                "reset": false,
            }
        );
    }

    //// 以下為設定anime動作
    let aCameraInitPos;   //紀錄camera初始位置
    let objInitPos;       //紀錄targetObj初始位置
    let objInitQuat;      //紀錄targetObj初始旋轉
    let parentWorldQuat = new THREE.Quaternion();
    movingObj.parentNode.object3D.getWorldQuaternion(parentWorldQuat);

    var degree = {
        ratio: 0
    };
    let pBezier = anime({
        targets: degree,
        ratio: steps,
        loop: bezierInfo.loop, 
        easing: 'linear',
        round: 1,
        duration: duration,
        autoplay: autoplay,
        begin: function(){

            objInitPos = movingObj.object3D.position.clone();
            objInitQuat = movingObj.object3D.quaternion.clone();

            if(isCameraObj){
                let aCamera = document.getElementById('aCamera');
                aCameraInitPos = aCamera.object3D.position.clone();
                aCamera.object3D.position.set(0,0,0);

                if (self.viewMode == 'model'){
                    let oCamera = document.getElementById('oCamera');
                    oCamera.setAttribute('camera', 'active' , false );
                    aCamera.setAttribute('camera', 'active' , true );	
                }
                
            }

        },
        update: function () {

            //// 藉由『事先計算出來的位置旋轉』，代入所選物件『相機』，後面需要處理 VR 的 look-controls 衍生的 Yaw pitch
            let localPosition = PR[0][degree.ratio - 1].clone();
            movingObj.parentNode.object3D.worldToLocal(localPosition);
            localPosition.add(new THREE.Vector3(-offsetTranslate[0], offsetTranslate[1], offsetTranslate[2]));

            let localQuaternion = PR[1][degree.ratio - 1].clone();

            localQuaternion.premultiply(parentWorldQuat.clone().inverse());
            localQuaternion.multiply(offsetQuaternion);

            movingObj.object3D.position.copy(localPosition);
            if( !isCameraObj ){
                movingObj.object3D.quaternion.copy(localQuaternion);
            }
            
        

        },
        complete: function () {
            

            movingObj.object3D.position.copy(objInitPos);
            movingObj.object3D.quaternion.copy(objInitQuat);

            // console.log(" complete: ", self.vrScene.camera.el.object3D.position.clone(), self.vrScene.camera.el.object3D.rotation.clone());
            if(isCameraObj ){
                let aCamera = document.getElementById('aCamera');
                aCamera.object3D.position.copy(aCameraInitPos);

                if(self.viewMode == 'model'){
                    let aCamera = document.getElementById('aCamera');
                    let oCamera = document.getElementById('oCamera');
                    oCamera.setAttribute('camera', 'active' , true );
                    aCamera.setAttribute('camera', 'active' , false );	
                }
            }
        }
    });

    movingObj.object3D['bezier'] = pBezier;

}

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/GLTFModelModule.js":
/*!*****************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/GLTFModelModule.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   checkGLTFMaterialIndex: () => (/* binding */ checkGLTFMaterialIndex),
/* harmony export */   loadGLTFModel: () => (/* binding */ loadGLTFModel),
/* harmony export */   loadMaterial: () => (/* binding */ loadMaterial),
/* harmony export */   loadMaterialTexture: () => (/* binding */ loadMaterialTexture),
/* harmony export */   loadWebViewNotSupport: () => (/* binding */ loadWebViewNotSupport),
/* harmony export */   loadWebViewNotSupport2D: () => (/* binding */ loadWebViewNotSupport2D)
/* harmony export */ });
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _setTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");
/* harmony import */ var _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../MakarWebXRVersionControl.js */ "./js/VRMain/version3_5/MakarWebXRVersionControl.js");




function checkGLTFMaterialIndex( target, material ) {
        
    if ( !target || !target.object3D || !target.object3D.children[0] ){
        console.log('VRFunc.js: _checkGLTFMaterialIndex: target error', target );
        return;
    }

    if ( !material ){
        console.log('VRFunc.js: _checkGLTFMaterialIndex: material error', material );
        return;
    }

    //// 當前紀錄要調整材質的方式 很奇特：
    //// 第一個數值是： nodes 下面，撇除不帶有 mesh 的項目，的index，此 node 帶有的 「mesh」代表 meshes 下的 index
    //// 第二個數值是： meshes 下的 mesh，底下的 primitives 下的 material index 
    // let nodeMeshIndex = material.rendererIndex;
    // let primitiveIndex = material.materialIndex;
    let nodeMeshIndex = material.mesh_idx;
    let primitiveIndex = material.primitive_idx;

    //// 確認模型物件下面的scene
    let meshIndex = -1;
    let materialIndex = -1;

    //// 查找「nodes」底下「帶有 mesh」的node
    let nodes = target.object3D.children[0].ModelJson.nodes;
    let nodeMeshCount = -1;
    for ( let i = 0; i < nodes.length; i++ ){
        //// 假如此 node 帶有 mesh ，加一
        if ( typeof( nodes[i].mesh ) == 'number' ){
            nodeMeshCount++;
        }
        //// 確認是否為「對應 index 」
        if ( nodeMeshIndex == nodeMeshCount ){
            meshIndex = nodes[i].mesh;
            // console.log('VRFunc.js: _checkGLTFMaterialIndex: get nodeMeshIndex ', nodes[i] );
            break;
        }

    }

    //// 確認模型物件下的 meshes 下 特定 index 是否存在
    // console.log('VRFunc.js: _checkGLTFMaterialIndex: meshIndex = ', meshIndex , material  );
    if ( meshIndex >= 0 ){

        let meshData = target.object3D.children[0].ModelJson.meshes[ meshIndex ];
        // console.log('VRFunc.js: _checkGLTFMaterialIndex: get meshData ', meshIndex , meshData  );
        if ( meshData ){
            //// 確認模型物件下的 primitives 是否存在
            if ( meshData.primitives  ){
                let primitiveData = meshData.primitives[ primitiveIndex ];
                //// 確認模型物件下的 primitives 下 material 是否有值
                if ( primitiveData && primitiveData.material >= 0 ){
                    //// 確認 materials 下是否有此 index
                    materialIndex = primitiveData.material;

                    console.log('VRFunc.js: _checkGLTFMaterialIndex: materialIndex=' , materialIndex );
                }
            }
        }
    }
    
    // if ( materialIndex >= 0 ){

    // 	target.object3D.traverse(function(child){
    // 		if (child.isMesh){
    // 			//// 我們在 load GLTF 的時候把每一個 material name 最後面加上 _[index]，這邊找出最後一個來比較
    // 			let nameSlice = child.material.name.split("_");
    // 			let mIndex = nameSlice[ nameSlice.length - 1 ];
    // 			if ( mIndex == materialIndex){
    // 				console.log('VRFunc.js: _checkGLTFMaterialIndex: child.material =', child.material );
    // 			}
    // 		}
    // 	});
    // }

    return [materialIndex, meshIndex];

}

function loadGLTFModel( obj, position, rotation, scale, cubeTex) {
    //20191025-start-thonsha-add  
    //// 這邊 this 必須等於 vrController
    let self = this  

    let pModel = new Promise( function( modelResolve ){
                
        ;(0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.UrlExists)( obj.res_url , function( retStatus ){

            if ( retStatus == true ){

                let promiseList = [];
                
                //// 作檔案存在與否判斷
                //// 沒有檔案位址，
                if ( obj.res_url == '' || 
                ( obj.sub_type != 'glb' && obj.sub_type != 'gltf'  && obj.sub_type != 'gltf_sketchFab'  && obj.sub_type != 'gltf_sketchfab' &&
                    obj.sub_type != 'gltf_poly'
                ) ){
                    console.log("VRFunc.js: _loadGFLTFModel: obj not support ", obj );
                    modelResolve( -1 );
                    return;
                }

                let assets = document.getElementById("makarAssets");

                let assetsitem = document.createElement("a-asset-item")
                assetsitem.setAttribute("id", obj.generalAttr.obj_id+"_"+obj.res_id);
                assetsitem.setAttribute("src",obj.res_url);
                assetsitem.setAttribute("response-type", 'arraybuffer');
                // assetsitem.setAttribute("src", 'model/tga.glb' );
                
                // assetsitem.setAttribute("src", 'https://s3-ap-northeast-1.amazonaws.com/mifly0makar0assets0test/Users/miflytest/Resource/56a0a86b2d694c48bc7179d05a9f2c8cc833455ddc4442d481a73214d39aab4c.glb' );

                assetsitem.setAttribute('crossorigin', 'anonymous');
                assets.appendChild(assetsitem);
                
                //20191128-start-thonsha-add
                var animationSlices= null;	
                var mainAnimation;	
                if(obj.animationAttr){
                    animationSlices= [];
                    
                    ////
                    //// 2022 1123 這邊從 3.4.0 之後要作版本控制
                    //// 注意，在執行的程式碼端，將 key 結構改為 新版本
                    //// v3.5 editor_version 是個 object，帶有 v0, v1, v2, v3 四個key-value pair
                    if (typeof(self.editor_version) == "object"  && Object.keys( self.editor_version).length == 4 ){
                        
                        let largeV  = Number( self.editor_version.v0 );
                        let middleV = Number( self.editor_version.v1 );
                        let smallV  = Number( self.editor_version.v2 );

                        //// 版本在4以上 或 大於等於3.5， obj的第1層是駝峰式大小寫，第2層換字使用底線 _ 且都是小寫
                        if ( largeV > 3 || (largeV == 3 && middleV >= 5) ){
                            for(let i=0; i<obj.animationAttr.length; i++){
                                if (obj.animationAttr[i].is_default || obj.animationAttr[i].is_active){
                                    animationSlices.push({
                                        idle:obj.animationAttr[i].uid, 
                                        loop:obj.animationAttr[i].uid, 
                                        uid:obj.animationAttr[i].uid, 
                                        changed: false, 
                                        reset: true, 
                                        count: 0
                                    });
                                    mainAnimation = (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.unicodeToChar)(obj.animationAttr[i].animation_name);
                                }
                            }
                            for(let i=0; i<obj.animationAttr.length; i++){
                                animationSlices.push({
                                    name:obj.animationAttr[i].name,
                                    animationName:(0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.unicodeToChar)(obj.animationAttr[i].animation_name),
                                    startTime:obj.animationAttr[i].start_time,
                                    endTime:obj.animationAttr[i].end_time,
                                    uid:obj.animationAttr[i].uid
                                });
                            }

                        }

                    }
                    
                }
                //20191128-end-thonsha-add

                let modelEntity = document.createElement('a-entity');

                if(!obj.res_url){ return };
    
                modelEntity.setAttribute("gltf-model", "#"+obj.generalAttr.obj_id+"_"+obj.res_id);
                
                if(obj.animationAttr){
                    modelEntity.setAttribute("animation-mixer", "clip: "+mainAnimation);
                }
                
                if (obj.behav){
                    modelEntity.setAttribute('class', "clickable" ); //// fei add
                }
                //[start-20231229-renhaohsu-add]//
                else if (obj.generalAttr.logic){
                    modelEntity.setAttribute('class', "clickable" ); 
                }
                //[end-20231229-renhaohsu-add]//
                else{
                    modelEntity.setAttribute('class', "unclickable" ); //// fei add
                }
                modelEntity.setAttribute( "id", obj.generalAttr.obj_id );//// fei add 

                modelEntity.setAttribute('crossorigin', 'anonymous');

                //20200608-thonsha-add-start
                modelEntity.setAttribute("shadow","");
                //20200608-thonsha-add-end
                //20200619-thonsha0add-start
                if (obj.model_shift){  //// 3.5 這邊直接沒有 model_shift 不確定怎麼處理
                    let model_shift = new THREE.Vector3().fromArray(obj.model_shift.split(",").map(function(x){return Number(x)}) );
                    model_shift.multiply(scale);
                    position.add(model_shift);
                }
                //20200619-thonsha0add-end

                (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_1__.setTransform)(modelEntity, position, rotation, scale);
                self.makarObjects.push( modelEntity );

                //20191125-start-thonsha-add
                modelEntity.addEventListener("model-loaded", function(evt){ // model-loaded  / object3dset
                    // console.log("VRFunc.js: VRController: _loadGLTFModel, object3dset: evt=", evt );
                    if ( evt.target ==  evt.currentTarget ){

                        //// 假如『原始圖片像素』高於『進場景材質大小』，就需要『縮小』，原始『各向異性』設為 1，以下流程改設為最高
                        let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
                        evt.detail.model.traverse( ( object ) => {
                            if ( object.isMesh === true && object.material.map !== null ) {
                            object.material.map.anisotropy = maxAnisotropy;
                            object.material.map.needsUpdate = true;
                            }
                        });
                        
                        // setTimeout(function(){
                        // 	modelEntity.setAttribute("cursor-listener", true ); //// fei add
                        // }, 500 );        

                        if ( modelEntity.object3D ){
                            modelEntity.object3D["makarObject"] = true;
                            modelEntity.object3D["makarType"] = 'model';

                            if ( obj.behav ){
                                modelEntity.object3D["behav"] = obj.behav ;
                                
                                //// 載入時候建制「群組物件資料」「注視事件」
                                self.setObjectBehavAll( obj );
                            }
                            if(obj.behav_reference){
                                modelEntity.object3D["behav_reference"] = obj.behav_reference ;
                            }

                            let objj = modelEntity.getObject3D('mesh');
                            // console.log('VRFunc.js: gltf model objj=', objj );

                            objj.traverse(node => {
                                //// 取消所有「模型自帶光」
                                if (node.type){
                                    if (typeof(node.type) == 'string' ){
                                        if (node.type.toLowerCase().includes('light') ){
                                            console.log("loadGLTFModel: _取消所有「模型自帶光」 node=", node)
                                            node.visible = false;
                                        }
                                    }
                                }
                            });
                            
                            //20191203-start-thonsha-add
                            if (obj.materialAttr.materials && obj.materialAttr.materials.length > 0){

                                for(let i = 0; i < obj.materialAttr.materials.length; i++){

                                    if ( objj.ModelJson ){
                                        let materialArray = checkGLTFMaterialIndex( modelEntity, obj.materialAttr.materials[i] );

                                        //[start-20240411-renhaohsu-modify]//
                                        //// 檢查是不是 "舊版(v3.4)材質球"
                                        let material_idx = obj.materialAttr.materials[i].material_idx;
                                        if(!material_idx){
                                            //// 表示它是舊版(v3.4)材質球 但是專案升到新版(v3.5.0.0)
                                            loadMaterial_v340(self, modelEntity, obj, objj, i)
                                            continue;
                                        }
                                        //[start-20240411-renhaohsu-modify]//

                                        let pMaterial = loadMaterialTexture(self, obj);
                                        promiseList.push(pMaterial)
                                        pMaterial.then(textures =>{
                                            loadMaterial(self, modelEntity, obj.materialAttr.materials[i].material_idx, materialArray );
                                        });
                                    }
                                    
                                }

                            }
                            else if (obj.default_shader_name){
                                console.log("run default_shader_name: ",obj.default_shader_name)

                                switch(obj.default_shader_name){

                                    case "standard":
                                        // 不處理
                                        break;

                                    case "Unlit/Transparent":
                                        // 編輯器那邊錯誤 實際上是去背
                                        if ( objj.ModelJson ){
                                            objj.traverse(node => {
                                                if (node.material) {
                                                    node.material = new THREE.MeshStandardMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
                                                    node.material.opacity = 1;
                                                    node.material.alphaTest = 0.5;
                                                }
                                            });
                                        }

                                        break
                                    
                                    case "Unlit/Transparent Cutout":
                                        // 編輯器那邊錯誤 實際上是透明
                                        if ( objj.ModelJson ){
                                            objj.traverse(node => {
                                                if (node.material) {
                                                    node.material = new THREE.MeshStandardMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
                                                    node.material.opacity = 0.5;
                                                    node.material.depthWrite = false;
                                                    //// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                                                    node.renderOrder = 1;
                                                }
                                            });
                                        }

                                        break

                                    case "Unlit/Color":
                                        if ( objj.ModelJson ){
                                            objj.traverse(node => {
                                                if (node.material) {
                                                    node.material = new THREE.MeshBasicMaterial({color: node.material.color, name: node.material.name, skinning: node.material.skinning});
                                                }
                                            });
                                        }
                                        break;

                                    case "Unlit/Texture":
                                        objj.traverse(node => {
                                            if (node.material) {
                                 
                                                node.material = new THREE.MeshBasicMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
                                                if (node.material.map){
                                                    node.material.map.encoding = THREE.GammaEncoding;
                                                    node.material.map.needsUpdate = true;
                                                }
                                                node.material.needsUpdate = true;
                                            }

                                        });
                                        break;
                                }
                            }
                            else{
                                if ( objj.ModelJson ){

                                    if(objj.ModelJson.materials){
                                        console.log("run alphaMode: ",objj.ModelJson.materials)
                                        let renderer = modelEntity.sceneEl.renderer;

                                        for (let i = 0; i<objj.ModelJson.materials.length; i++){
                                            if(objj.ModelJson.materials[i].alphaMode){
                                                switch(objj.ModelJson.materials[i].alphaMode){

                                                    case "OPAQUE":

                                                        objj.traverse(node => {
                                                            if (node.material) {
                                                                let nameSlice = node.material.name.split("_");
                                                                let mIndex = nameSlice[ nameSlice.length - 1 ];
                                                                if(mIndex == i){
                                                                    // node.material = new THREE.MeshStandardMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
                                                                    node.material.opacity = 1;
                                                                    renderer.setClearAlpha(1);
                                        
                                                                    node.material.blending = THREE.CustomBlending;
                                                                    node.material.blendEquation = THREE.AddEquation;
                                                                    node.material.blendSrc = THREE.OneFactor;
                                                                    node.material.blendDst = THREE.ZeroFactor;
                                                                    node.material.blendSrcAlpha = THREE.ZeroFactor;
                                                                    node.material.blendDstAlpha = THREE.OneFactor;

                                                                }
                                                            }
                                                        });
                                                        
                                                        break;
                                

                                                    case "MASK":

                                                        objj.traverse(node => {
                                                            if (node.material) {
                                                                let nameSlice = node.material.name.split("_");
                                                                let mIndex = nameSlice[ nameSlice.length - 1 ];
                                                                if(mIndex == i){
                                                                    // node.material = new THREE.MeshStandardMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
                                                                    node.material.opacity = 1;
                                                                    node.material.alphaTest = 0.5;
                                                                    renderer.setClearAlpha(1);
                                        
                                                                    node.material.blending = THREE.CustomBlending;
                                                                    node.material.blendEquation = THREE.AddEquation;
                                                                    node.material.blendSrc = THREE.OneFactor;
                                                                    node.material.blendDst = THREE.ZeroFactor;
                                                                    node.material.blendSrcAlpha = THREE.ZeroFactor;
                                                                    node.material.blendDstAlpha = THREE.OneFactor;
                                        
                                                                    node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                                                        depthPacking: THREE.RGBADepthPacking,
                                                                        skinning: true,
                                                                        map: node.material.map,
                                                                        alphaTest: 0.5
                                                                    } );

                                                                }
                                                            }
                                                        });
                                                        
                                                        break;

                                                    case "BLEND":
                                                        objj.traverse(node => {
                                                            if (node.material) {
                                                                let nameSlice = node.material.name.split("_");
                                                                let mIndex = nameSlice[ nameSlice.length - 1 ];
                                                                if(mIndex == i){
                                                                    // node.material = new THREE.MeshStandardMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
                                                                    node.material.opacity = 0.5;
                                                                    node.material.depthWrite = false;
                                                                    node.material.blending = THREE.CustomBlending;
                                                                    node.material.blendEquation = THREE.AddEquation;
                                                                    node.material.blendSrc = THREE.OneFactor;
                                                                    node.material.blendDst = THREE.OneMinusSrcAlphaFactor;
                                                                    node.material.blendSrcAlpha = THREE.OneFactor;
                                                                    node.material.blendDstAlpha = THREE.OneMinusSrcAlphaFactor;
                                                                    //// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                                                                    node.renderOrder = 1;

                                                                    node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                                                        depthPacking: THREE.RGBADepthPacking,
                                                                        skinning: true,
                                                                        map: node.material.map,
                                                                        alphaTest: 0.5
                                                                    } );
                                                                }
                                                            }
                                                        });
                                                        
                                                        break

                                                }
                                            }
                                        }
                                    }

                                    
                                    
                                }
                            }
                            //20191203-start-thonsha-add		
                            //// if there is animation exist in GLTF, but the editor not contain the animation slices, the mixer will not init.
                            //// use the first animation( usually only one), to setup animationSlice.
                            if (Array.isArray(evt.detail.model.animations)){
                                if ( evt.detail.model.animations.length>0 && !modelEntity.getAttribute("animation-mixer") ){
                                    console.log("VRFunc.js: loadGFLTFModel: the model with animation but no animation-mixer, probabily older version of editor ", evt.detail.model );
                                    modelEntity.setAttribute("animation-mixer", "clip: "+ evt.detail.model.animations[0].name );
                                    animationSlices = [];
                                    animationSlices.push({ changed:false, idle:"mifly168", uid:"mifly168" });
                                    animationSlices.push({
                                        animationName: evt.detail.model.animations[0].name,
                                        name: evt.detail.model.animations[0].name,
                                        endTime: evt.detail.model.animations[0].duration ,
                                        startTime: 0,
                                        uid:"mifly168"
                                    });
                                }
                            }
                            evt.detail.model.animationSlices = animationSlices;

                            // 等待promiseList裡的東西都好了才resolve，以後有其他需要等的可以塞進去，目前是只有塞貼圖載入
                            Promise.all( promiseList ).then( function( ){
                
                                modelResolve(modelEntity);
                            
                            })


                        }
                    }else{
                        // console.log("VRFunc.js: VRController: _loadFBXModel, target!=currentTarget", obj.res_name, modelEntity.object3D.children );
                    }
                });

                //20191125-end-thonsha-add

                //20191226-start-thonsha-mod

                //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
                if ( obj.generalAttr.active == false ){
                    modelEntity.setAttribute("visible", false);
                    modelEntity.setAttribute('class', "unclickable" );
                }

                // if(obj.behav_reference){
                //     for(let i=0; i<obj.behav_reference.length;i++){
                //         // if (obj.behav_reference[i].behav_name == 'ShowModel'){
                //         if (obj.behav_reference[i].behav_type == 'Display'){
                //             modelEntity.setAttribute("visible", false);
                //             modelEntity.setAttribute('class', "unclickable" );
                //             break;
                //         }
                //     }
                    
                // }
                //20191029-start-thonhsa-add
                if(obj.generalAttr.obj_parent_id){
                    // modelEntity.setAttribute("visible", false);
                    // modelEntity.setAttribute('class', "unclickable" );
                    let timeoutID = setInterval( function () {
                        let parent = document.getElementById(obj.generalAttr.obj_parent_id);
                        if (parent){ 
                            if(parent.object3D.children.length > 0){
                                parent.appendChild(modelEntity);
                                window.clearInterval(timeoutID);
                            } 
                        }
                    }, 1);
                }
                else{
                    self.vrScene.appendChild(modelEntity);
                }


            }else{

                console.log("VRFunc.js: _loadGLTFModel , obj url not exist ", obj );
                
                obj.main_type = 'model';
                obj.sub_type = 'glb';
                obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";
                
                self.loadGLTFModel( obj , position, rotation, scale , self.cubeTex );
                modelResolve( 1 );

            }

        });            

    });

    return pModel;

//20191025-end-thonsha-add
}

//// 不會用到
// export function loadFBXModel( obj, position, rotation, scale ) {
//     let self = this
//     // console.log("VRFunc.js: VRController: loadFBXModel, obj=", obj, position, rotation, scale );
//     // console.log("VRFunc.js: VRController: loadFBXModel, obj res_url_fbx=", obj.res_url_fbx  );

//     let modelEntity = document.createElement('a-entity');
    
//     if ( !obj.res_url_fbx ){ return };
    
//     modelEntity.setAttribute('fbx-model', 'src:' + obj.res_url_fbx ); // res_url_fbx, load model first?

//     //20191028-end-thonsha-add
//     modelEntity.setAttribute("animation-mixer", "");
//     //20191028-end-thonsha-add
//     if (obj.behav){
//         modelEntity.setAttribute('class', "clickable" ); //// fei add
//     }
//     else{
//         modelEntity.setAttribute('class', "unclickable" ); //// fei add
//     }
//     modelEntity.setAttribute( "id", obj.obj_id );//// fei add 

//     // setTimeout(function(){
//     // 	modelEntity.setAttribute("cursor-listener", true ); //// fei add
//     // }, 500 );

//     self.setTransform(modelEntity, position, rotation, scale);
//     self.makarObjects.push( modelEntity );

//     //20191227-start-thonsha-mod
//     if(obj.behav_reference){
//         for(let i=0; i<obj.behav_reference.length;i++){
//             if (obj.behav_reference[i].behav_name != 'PlayAnimation'){
//                 modelEntity.setAttribute("visible", false);
//                 modelEntity.setAttribute('class', "unclickable" );
//                 break;
//             }
//         }
        
//     }
//     //20191227-end-thonsha-mod
//     //20191029-start-thonhsa-add
//     if(obj.obj_parent_id){
//         // modelEntity.setAttribute("visible", false);
//         // modelEntity.setAttribute('class', "unclickable" );
//         let timeoutID = setInterval( function () {
//             let parent = document.getElementById(obj.obj_parent_id);
//             if (parent){ 
//                 if(parent.object3D.children.length > 0){
//                     parent.appendChild(modelEntity);
//                     window.clearInterval(timeoutID);
//                 } 
//             }
//         }, 1);
//     }
//     else{	
//         self.vrScene.appendChild(modelEntity);
//     }
//     //20191029-end-thonhsa-add
//     modelEntity.addEventListener("model-loaded", function(evt){

//         if (evt.target == evt.currentTarget){
//             modelEntity.object3D["makarObject"] = true; 
//             if ( obj.behav ){
//                 modelEntity.object3D["behav"] = obj.behav ;
//             }
//         }
//     });

//     // console.log("VRFunc.js: VRController: loadFBXModel, modelEntity=", modelEntity );
//     // console.log("VRFunc.js: VRController: loadFBXModel, obj=", obj );

// }


function loadMaterial(self, modelEntity, material_idx, materialArray){

    let objj = modelEntity.getObject3D('mesh');
    let material = self.userMaterialDict[material_idx];
    let material_data = {};
    console.log("material_idx", material);
    let materialIndex = materialArray[0];
    let meshIdx = materialArray[1];

    material_data.name = material.res_name;
    material_data.shader = material.shader;

    for(let i = 0; i < material.properties.length; i++){
        switch (material.properties[i].key){
            case "alphaMode":
                // if(material.properties[i].value == "OPAQUE")    material_data.alphaMode = 0;
                // else if(material.properties[i].value == "MASK")  material_data.alphaMode = 1;
                // else if(material.properties[i].value == "BLEND")  material_data.alphaMode = 3;
                break;
            case "doubleSided":
                material_data.doubleSided = material.properties[i].value;
                break;
            case "_Color":
                let rgba = material.properties[i].value.split(",");
                material_data.color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));
                material_data.alpha = parseFloat(rgba[3]);
                break;
            case "_MainTex":
                material_data.map = self.materials_texture_dict[material_idx].mainTex;
                break;
            case "_Cutoff":
                material_data.cutoff = material.properties[i].value;
                break;
            case "_Glossiness":
                material_data.smoothness = material.properties[i].value;
                break;
            case "_SpecGlossMap":
                material_data.specGlossMap = self.materials_texture_dict[material_idx].specGlossMap;
            case "_Metallic":
                material_data.metallic = material.properties[i].value;
                break;
            case "_MetallicGlossMap":
                material_data.metalnessMap = self.materials_texture_dict[material_idx].metalnessMap;
                break;
            case "_SpecularHighlights":
                material_data.specularHighlights = material.properties[i].value;
                break;
            case "_GlossyReflections":
                material_data.glossyReflections = material.properties[i].value;
                break;
            case "_BumpScale":
                material_data.bumpscale = material.properties[i].value;
                break;
            case "_BumpMap":
                material_data.bumpMap = self.materials_texture_dict[material_idx].bumpMap;
                break;
            case "_Parallax":
                material_data.parallax = material.properties[i].value;
                break;
            case "_ParallaxMap":
                material_data.parallaxMap = self.materials_texture_dict[material_idx].parallaxMap;
                break;
            case "_OcclusionStrength":
                material_data.aoMapIntensity  = material.properties[i].value;
                break;
            case "_OcclusionMap":
                material_data.aoMap = self.materials_texture_dict[material_idx].aoMap;
                break;
            case "_EmissionColor":
                let ergba = material.properties[i].value.split(",");
                material_data.emissionColor = new THREE.Color(parseFloat(ergba[0]),parseFloat(ergba[1]),parseFloat(ergba[2]));
                break;
            case "_EmissionMap":
                material_data.emissionMap = self.materials_texture_dict[material_idx].emissionMap;
                break;
            case "_Mode":
                material_data.mode = material.properties[i].value;
                break;

            // TSF/baseOutline
            case "_ToonShade":
                material_data.toonShade = self.materials_texture_dict[material_idx].toonShade;
                break;
            case "_TintColor":
                if(material.properties[i].value == 1)   material_data.tintColor = true;
                else material_data.tintColor = false;
                break;
            case "_Brightness":
                material_data.brightness = material.properties[i].value;
                break;
            case "_OutlineColor":
                let outlineColor = material.properties[i].value.split(",");
                material_data.outlineColor = new THREE.Color(parseFloat(outlineColor[0]),parseFloat(outlineColor[1]),parseFloat(outlineColor[2]));
                break;
            case "_Outline":
                material_data.outlineWidth = material.properties[i].value;
                break;
            
            
        }
    }
    // console.log(material_data)

    switch (material_data.shader) {
        case "Unlit/Color":
            objj.traverse(node => {
                if (node.isMesh) {

                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx ){
                    // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                    // if (node.material.name === obj.materialAttr.materials[i].name) {
                        node.material = new THREE.MeshBasicMaterial({color: material_data.color, name: node.material.name, skinning: node.material.skinning});
                    }
                }
            });
            break;
        case "Standard":
        case "Autodesk Interactive":

            var renderer = modelEntity.sceneEl.renderer;
            objj.traverse(node => {

                if (node.material) {

                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx ){
                    // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                    // if (node.material.name == obj.materialAttr.materials[i].name) {
                        //20200803-thonsha-add-start
                        node.material = new THREE.MeshStandardMaterial({
                            // name: obj.materialAttr.materials[i].name, 
                            // name: material_data.name,
                            name : node.material.name,
                            skinning: node.material.skinning , 
                            map: material_data.map? material_data.map: null, 
                            // map: node.material.map,
                            emissive:material_data.emissionColor? material_data.emissionColor: node.material.emissive,
                            emissiveMap:material_data.emissionMap? material_data.emissionMap: null,
                            normalMap:node.material.normalMap,
                            bumpMap: material_data.bumpMap? material_data.bumpMap: null,
                            flatShading: node.material.flatShading
                        });					
                        //20200803-thonsha-add-end
                        node.material.color = material_data.color;
                        if(material_data.metalnessMap)
                            node.material.metalnessMap = material_data.metalnessMap;
                        else{
                            node.material.metalness = material_data.metallic;
                            node.material.roughness = 1 - material_data.smoothness;
                        }
                        node.material.bumpscale = material_data.bumpscale;

                        node.material.displacementMap = material_data.displacementMap? material_data.displacementMap: null;

                        if(material_data.aoMap){
                   
                            node.geometry.attributes.uv2 = node.geometry.attributes.uv.clone();         
                            // let uv2 = node.geometry.getAttribute("uv2");
                            // if(uv2 == undefined){
                            //     // const uv1Array = node.geometry.getAttribute("uv").array;
                            //     // node.geometry.setAttribute( 'uv2', new THREE.BufferAttribute( uv1Array, 2 ) );
                            //     // node.geometry.attributes.uv2 = node.geometry.attributes.uv.clone()
                            // }
                            
                            node.material.aoMap = material_data.aoMap;
                            node.material.aoMapIntensity = material_data.aoMapIntensity;
                        }
                        
                        //// 先行取消「模型呈現環景」
                        node.material.envMap = self.cubeTex.texture;
                        node.material.envMapIntensity = 1;
                        node.material.needsUpdate = true;
                        node.material.reflectivity = 0;
                        node.material.side = material_data.doubleSided? THREE.DoubleSide: THREE.FrontSide;
                        node.material.transparent = true;

                        // node.material.polygonOffset = true;
                        
                        // console.log('VRFunc.js: _loadGLTFModel: obj.materialAttr.materials',obj.materialAttr.materials);
                        // console.log('VRFunc.js: _loadGLTFModel: standard node.material',node.material);
                        //20200730-thonsha-add-start														
                        if (node.material.map){
                            if ( THREE.GammaEncoding ){
                                node.material.map.encoding = THREE.GammaEncoding;
                            }
                            
                            node.material.map.needsUpdate = true;
                        }
                        //20200730-thonsha-add-end	
                        if(material_data.mode == 0){
                            node.material.opacity = 1;
                            renderer.setClearAlpha(1);

                            node.material.blending = THREE.CustomBlending;
                            node.material.blendEquation = THREE.AddEquation;
                            node.material.blendSrc = THREE.OneFactor;
                            node.material.blendDst = THREE.ZeroFactor;
                            node.material.blendSrcAlpha = THREE.ZeroFactor;
                            node.material.blendDstAlpha = THREE.OneFactor;

                        }
                        else if(material_data.mode == 1){
                            node.material.opacity = 1;
                            node.material.alphaTest = material_data.cutoff;
                            renderer.setClearAlpha(1);

                            node.material.blending = THREE.CustomBlending;
                            node.material.blendEquation = THREE.AddEquation;
                            node.material.blendSrc = THREE.OneFactor;
                            node.material.blendDst = THREE.ZeroFactor;
                            node.material.blendSrcAlpha = THREE.ZeroFactor;
                            node.material.blendDstAlpha = THREE.OneFactor;

                            node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                depthPacking: THREE.RGBADepthPacking,
                                skinning: true,
                                map: material_data.map,
                                alphaTest: material_data.cutoff
                            } );
                        }
                        else if(material_data.mode == 2){
                            node.material.opacity = material_data.alpha
                            node.material.depthWrite = false;
                            
                            //// 假如是「淡出材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                            node.renderOrder = 1;
                        
                            node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                depthPacking: THREE.RGBADepthPacking,
                                skinning: true,
                                map: material_data.map,
                                alphaTest: material_data.cutoff
                            } );
                        }
                        else if(material_data.mode == 3){
                            node.material.opacity = Math.max(material_data.alpha, material_data.metallic);
                            node.material.depthWrite = false;
                            node.material.blending = THREE.CustomBlending;
                            node.material.blendEquation = THREE.AddEquation;
                            node.material.blendSrc = THREE.OneFactor;
                            node.material.blendDst = THREE.OneMinusSrcAlphaFactor;
                            node.material.blendSrcAlpha = THREE.OneFactor;
                            node.material.blendDstAlpha = THREE.OneMinusSrcAlphaFactor;

                            //// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                            node.renderOrder = 1;

                            node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                depthPacking: THREE.RGBADepthPacking,
                                skinning: true,
                                map: material_data.map,
                                alphaTest: material_data.cutoff
                            } );
                        }
                    }
                }
            });
            // renderer.toneMapping = THREE.ACESFilmicToneMapping;
            // renderer.outputEncoding = THREE.sRGBEncoding;
            
            
            break;
        case "Unlit/Transparent":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx){
                    // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                    // if (node.material.name == obj.materialAttr.materials[i].name) {
                        node.material.opacity = 1;
                        node.material.depthWrite = false;
                        //// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                        node.renderOrder = 1;
                    }
                }
            });
    //         break;
        case "Unlit/Transparent Cutout":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex  && node.meshIdx == meshIdx){
                    // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                    // if (node.material.name == obj.materialAttr.materials[i].name) {
                        node.material = new THREE.MeshBasicMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: material_data.map});
                        node.material.opacity = 1;
                        node.material.alphaTest = material_data.cutoff;
                    }
                }
            });
            break;
        case "Unlit/Texture":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx ){
                    // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                    // if (node.material.name == obj.materialAttr.materials[i].name) {
                        node.material = new THREE.MeshBasicMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: material_data.map});
                        //20200730-thonsha-add-start
                        if (node.material.map){
                            node.material.map.encoding = THREE.GammaEncoding;
                            node.material.map.needsUpdate = true;
                            // console.log(node.material.map)

                        }
                        //20200730-thonsha-add-end
                        node.material.needsUpdate = true;
                    }
                }
            });
            break;

        case "Unlit/Vertex":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx ){
                        node.material = new THREE.MeshStandardMaterial({color: new THREE.Color(1,1,1),  name: node.material.name, skinning: node.material.skinning}); 
                        node.material.vertexColors = true;
                    }
                }
            });            
            break

        //20221206-thonsha-add-start
        case "Unlit/ScreenCutoutShader":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx){
                    // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                    // if (node.material.name == obj.materialAttr.materials[i].name) {
                        self.needsRenderTarget = true;
                        
                        node.material.onBeforeCompile = function ( shader ) {
                            shader.uniforms.tEquirect = { value: self.skyRenderTarget.texture };
                            shader.vertexShader = 'varying vec4 vProjection;\n' + shader.vertexShader;
                            shader.vertexShader = shader.vertexShader.replace(
                            '#include <worldpos_vertex>',
                            [
                                '#include <worldpos_vertex>',
                                '	vProjection = projectionMatrix * mvPosition;',
                            ].join( '\n' )
                            );
                            shader.fragmentShader = 'uniform sampler2D tEquirect;\nvarying vec4 vProjection;\n' + shader.fragmentShader;
                            shader.fragmentShader = shader.fragmentShader.replace(
                            '#include <dithering_fragment>',
                            [
                                '#include <dithering_fragment>',
                                '	vec2 sampleUV;',
                                '	sampleUV.x = vProjection.x/vProjection.w*0.5 + 0.5;',
                                '	sampleUV.y = vProjection.y/vProjection.w*0.5 + 0.5;',
                                '	gl_FragColor = texture2D(tEquirect, sampleUV);',
                            ].join( '\n' )
                            );
                        };
                        
                    }
                }
            });
            break;
        //20221206-thonsha-add-end

        case "TSF/BaseOutline1":

            self.needsCullFaceBack = true;
            let objj2 = modelEntity.object3D.clone(true);
            objj2["obj_id"] = modelEntity.getAttribute("id");
            self.cullFaceBackScene.add( objj2 );

            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx){

                        let mat = new THREE.MeshBasicMaterial({color: new THREE.Color(1,1,1),  name: node.material.name, skinning: node.material.skinning});

                        mat.onBeforeCompile = function ( shader ) {
                            shader.uniforms.toonShade = { value:material_data.toonShade };
                            shader.uniforms.tintColor = { value:material_data.tintColor };
                            shader.uniforms.color = { value:material_data.color };
                            shader.uniforms.brightness = { value:material_data.brightness};
                            shader.vertexShader = 'varying vec3 vProjection;\n' + shader.vertexShader;
                            shader.vertexShader = shader.vertexShader.replace(
                            '#include <begin_vertex>',
                            [   
                                '#include <beginnormal_vertex>',
                                '#include <defaultnormal_vertex>',
                                '#include <begin_vertex>',
                            ].join( '\n' )
                            );
                            shader.vertexShader = shader.vertexShader.replace(
                            '#include <worldpos_vertex>',
                            [
                                '#include <worldpos_vertex>',
                                'vProjection = normalize( transformedNormal );',
                                'vProjection.y = -vProjection.y;',
                                'vProjection.z = -vProjection.z;',
                            ].join( '\n' )
                            );
                            shader.fragmentShader = 'uniform sampler2D toonShade;\nuniform bool tintColor;\nuniform vec3 color;\nuniform float brightness;\nvarying vec3 vProjection;\n' + shader.fragmentShader;
                            shader.fragmentShader = shader.fragmentShader.replace(
                            '#include <fog_fragment>',
                            [
                                '#include <fog_fragment>',
                                '	vec2 sampleUV;',
                                '   vec4 tmp;',
                                '	sampleUV.x = vProjection.x*0.5 + 0.5;',
                                '	sampleUV.y = vProjection.y*0.5 + 0.5;',
                                '   tmp = texture2D(toonShade, sampleUV);',
                                '   if(tintColor){',
                                '       tmp.x = tmp.x * color.x * brightness;',
                                '       tmp.y = tmp.y * color.y * brightness;',
                                '       tmp.z = tmp.z * color.z * brightness;',
                                '   }',
                                '   else{',
                                '       tmp.x = tmp.x * brightness;',
                                '       tmp.y = tmp.y * brightness;',
                                '       tmp.z = tmp.z * brightness;',
                                '   }',
                                '	gl_FragColor.x *= tmp.x;',
                                '	gl_FragColor.y *= tmp.y;',
                                '	gl_FragColor.z *= tmp.z;',
                            ].join( '\n' )
                            );
                        };

                        mat.map = material_data.map;
                        
                        // node.geometry.clearGroups();
                        // node.geometry.addGroup( 0, Infinity, 0 );
                        // node.geometry.addGroup( 0, Infinity, 1 );
                        // node.material = [ ori1, ori2 ]
                        node.material = mat;
                        
                    }
                }
            });

            objj2.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx){

                        let mat = node.material.clone();

                        mat.onBeforeCompile = function ( shader ) {
                            shader.uniforms.boarderColor = { value: material_data.outlineColor };
                            shader.uniforms.boarderWidth = { value: material_data.outlineWidth };
                            shader.vertexShader = 'uniform float boarderWidth;\nvarying vec3 vProjection;\n' + shader.vertexShader;
                            shader.vertexShader = shader.vertexShader.replace(
                            '#include <worldpos_vertex>',
                            [
                                '#include <worldpos_vertex>',
                                'mvPosition.xyz += vNormal * boarderWidth * 0.01;',
                                'gl_Position = projectionMatrix * mvPosition;'
                            ].join( '\n' )
                            );
                            shader.fragmentShader = 'uniform vec3 boarderColor;\n' + shader.fragmentShader;
                            shader.fragmentShader = shader.fragmentShader.replace(
                            '#include <dithering_fragment>',
                            [
                                '#include <dithering_fragment>',
                                'gl_FragColor = vec4(boarderColor, 1.0);',
                            ].join( '\n' )
                            );
                        };
                        
                        node.material = mat;
                        
                    }
                }
            });
            
            break;
        //20200828-thonsha-add-start
        case "Blocks/Basic":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx ){
                        let mat = node.material.clone();
                        mat.color = material_data.color;
                        node.material = mat;
                    }
                }
            });
            break;

        case "Blocks/BlocksGlass":
        case "Blocks/BlocksGem":
            objj.traverse(node => {
                if (node.material) {
                    let nameSlice = node.material.name.split("_");
                    let mIndex = nameSlice[ nameSlice.length - 1 ];
                    if( mIndex == materialIndex && node.meshIdx == meshIdx ){

                        let mat = node.material.clone();
                        mat.color = material_data.color;
                        node.material = mat;

                        node.material.depthWrite = false;
                        //// 假如是「頂點色材質」？，同時設定繪製排序往前，讓同距離的繪製可以顯示
                        node.renderOrder = 1;
                    }
                }
            });
            break;

        //20200828-thonsha-add-end
        default:
            console.log(`The shader of id ${material_idx} material is not supported currently.`);
            break;
    }

}


function loadMaterialTexture(self, obj){

    // let self = this;

    let pMaterial = new Promise( function( materialResolve ){

        if (obj.materialAttr.materials.length !=0) {

            let textures = [];  //可能會有許多貼圖須載入，每個分開promise全部通過才最終回傳            
            
            for (let i = 0; i < obj.materialAttr.materials.length;i++){

                let material_idx = obj.materialAttr.materials[i].material_idx;
                //// 暫時規避 新舊版本 材質問題
                if ( material_idx && typeof( material_idx ) == 'string' ){

                }else{
                    continue;
                }
                self.materials_texture_dict[material_idx] = {}

                let material = self.userMaterialDict[material_idx];
                for(let j = 0; j < material.properties.length; j++){

                    let texture_url = null;
                    let scale ;
                    if( material.properties[j].key == "_MainTex" || 
                        material.properties[j].key == "_MetallicGlossMap" ||
                        material.properties[j].key == "_SpecGlossMap" ||
                        material.properties[j].key == "_BumpMap" ||
                        material.properties[j].key == "_ParallaxMap" ||
                        material.properties[j].key == "_OcclusionMap" ||
                        material.properties[j].key == "_EmissionMap" || 
                        material.properties[j].key == "_ToonShade"
                    ){
                        texture_url = material.properties[j].value;
                        scale = material.properties[j].scale.split(',').map(x => Number(x));
                    }

                    let pTexture = new Promise(function(textureResolve){
                        
                        if(texture_url){
                            (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.UrlExists)( texture_url , function( retStatus ){

                                if ( retStatus == true ){

                                    let texture = new THREE.TextureLoader().load(texture_url, function(){
                                        texture.wrapS = THREE.RepeatWrapping;
                                        texture.wrapT = THREE.RepeatWrapping;
                                        texture.flipY = false;
                                        texture.repeat.x = scale[0];
                                        texture.repeat.y = scale[1];
                                        // texture.encoding = THREE.sRGBEncoding;
                                        texture.format = THREE.RGBAFormat;
                                        texture.needsUpdate = true;
                                        textureResolve(texture);
                                    });
                                    
                                    if( material.properties[j].key == "_MainTex")
                                        self.materials_texture_dict[material_idx].mainTex = texture;
                                    else if(material.properties[j].key == "_MetallicGlossMap")
                                        self.materials_texture_dict[material_idx].metalnessMap = texture;
                                    else if(material.properties[j].key == "_SpecGlossMap")
                                        self.materials_texture_dict[material_idx].specGlossMap = texture;
                                    else if(material.properties[j].key == "_BumpMap")
                                        self.materials_texture_dict[material_idx].bumpMap = texture;
                                    else if(material.properties[j].key == "_ParallaxMap")
                                        self.materials_texture_dict[material_idx].parallaxMap = texture;
                                    else if(material.properties[j].key == "_OcclusionMap")
                                        self.materials_texture_dict[material_idx].aoMap = texture;
                                    else if(material.properties[j].key == "_EmissionMap")
                                        self.materials_texture_dict[material_idx].emissionMap = texture;
                                    else if(material.properties[j].key == "_ToonShade")
                                        self.materials_texture_dict[material_idx].toonShade = texture;
                
                                }
                                else{
                                    console.log("_loadMaterialTexture: texture url not exists.")
                                    textureResolve(1);
                                }
                
                            });	
                        }
                        else
                            textureResolve(1);
                    })

                    textures.push(pTexture);
                }

                
            }

            Promise.all( textures ).then( function( ret ){
            
                console.log('GLTFModleModule.js: _loadMaterials: textures then ret = ', ret );

                materialResolve(textures);
            
            })
    
            
        }
        else{
            console.log("_loadMaterialTexture: obj no material texture");
            materialResolve(1);
        }
    
    });

    return pMaterial;

}

//// source: v3.4 VRFunc.js
//// 暫時以obj缺少obj.materialAttr.materials[i].material_idx來判斷
//// 表示它是舊版(v3.4)材質球 但是專案升到新版(v3.5.0.0)
function loadMaterial_v340(self, modelEntity, obj, objj, i){

    console.log("____loadGLTFModel obj.materialAttr=", obj.materialAttr)

    let materialIndex = obj.materialAttr.materials[i].materialIndex;
    if(Number.isInteger(materialIndex)){
        console.log("_loadMaterial_v340 materialIndex=", materialIndex)

        let _color = obj.materialAttr.materials[i].color

        //// 取得材質球的顏色，先預設為白色
        let rgba = [1,1,1,1];
        if( (typeof _color === 'string' || _color instanceof String) && _color.split(",").length>=3 ){
            rgba = _color.split(",");
        }
        let color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));
        
        // console.log("____loadGLTFModel materialIndex=", materialIndex)
        // console.log("____loadGLTFModel rgba=", rgba)
        // console.log("____loadGLTFModel color=", color)
        //// 至此看起來都與v3.4相同 因此以下沒有改動

        switch (obj.materialAttr.materials[i].shader) {
            case "Unlit/Color":
                objj.traverse(node => {
                    if (node.isMesh) {

                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name === obj.materialAttr.materials[i].name) {
                            node.material = new THREE.MeshBasicMaterial({color: color, name: node.material.name, skinning: node.material.skinning});
                        }
                    }
                });
                break;
            case "Standard":
                console.log("obj.materialAttr.materials[i]", obj.materialAttr.materials[i])

                var renderer = modelEntity.sceneEl.renderer;
                objj.traverse(node => {

                    // console.log("obj.materialAttr.materials[i] node", node)
                    // console.log("obj.materialAttr.materials[i] node.material", node.material)

                    if (node.material) {

                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
    //20200803-thonsha-add-start
                            node.material = new THREE.MeshStandardMaterial({
                                // name: obj.materialAttr.materials[i].name, 
                                name: node.material.name,
                                skinning: node.material.skinning , 
                                map: node.material.map, 
                                emissive:node.material.emissive,
                                emissiveMap:node.material.emissiveMap,
                                normalMap:node.material.normalMap
                            });					
    //20200803-thonsha-add-end
                            node.material.color = color;
                            node.material.metalness = obj.materialAttr.materials[i].metallic;
                            node.material.roughness = 1 - obj.materialAttr.materials[i].smoothness;
                            //// 先行取消「模型呈現環景」
                            node.material.envMap = self.cubeTex.texture;
                            node.material.envMapIntensity = 1;
                            node.material.needsUpdate = true;
                            node.material.reflectivity = 0;
                            node.material.side = THREE.DoubleSide;
                            node.material.transparent = true;

                            // node.material.polygonOffset = true;
                            
                            // console.log('VRFunc.js: _loadGLTFModel: obj.materialAttr.materials',obj.materialAttr.materials);
                            // console.log('VRFunc.js: _loadGLTFModel: standard node.material',node.material);
    //20200730-thonsha-add-start														
                            if (node.material.map){
                                if ( THREE.GammaEncoding ){
                                    node.material.map.encoding = THREE.GammaEncoding;
                                }
                                
                                node.material.map.needsUpdate = true;
                            }
    //20200730-thonsha-add-end	

                            // console.log("obj.materialAttr.materials[i].mode", obj.materialAttr.materials[i].mode)


                            if(obj.materialAttr.materials[i].mode == 0){
                                node.material.opacity = 1;
                                renderer.setClearAlpha(1);

                                node.material.blending = THREE.CustomBlending;
                                node.material.blendEquation = THREE.AddEquation;
                                node.material.blendSrc = THREE.OneFactor;
                                node.material.blendDst = THREE.ZeroFactor;
                                node.material.blendSrcAlpha = THREE.ZeroFactor;
                                node.material.blendDstAlpha = THREE.OneFactor;

                            }
                            else if(obj.materialAttr.materials[i].mode == 1){
                                node.material.opacity = 1;
                                node.material.alphaTest = obj.materialAttr.materials[i].cut_off;
                                renderer.setClearAlpha(1);

                                node.material.blending = THREE.CustomBlending;
                                node.material.blendEquation = THREE.AddEquation;
                                node.material.blendSrc = THREE.OneFactor;
                                node.material.blendDst = THREE.ZeroFactor;
                                node.material.blendSrcAlpha = THREE.ZeroFactor;
                                node.material.blendDstAlpha = THREE.OneFactor;

                                node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                    depthPacking: THREE.RGBADepthPacking,
                                    skinning: true,
                                    map: node.material.map,
                                    alphaTest: obj.materialAttr.materials[i].cut_off
                                } );
                            }
                            else if(obj.materialAttr.materials[i].mode == 2){
                                node.material.opacity = parseFloat(rgba[3]);
                                console.log("node.material.opacity", node.material.opacity)

                                node.material.depthWrite = false;
                                
                                //// 假如是「淡出材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                                node.renderOrder = 1;
                            
                                node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                    depthPacking: THREE.RGBADepthPacking,
                                    skinning: true,
                                    map: node.material.map,
                                    alphaTest: obj.materialAttr.materials[i].cut_off
                                } );
                            }
                            else if(obj.materialAttr.materials[i].mode == 3){
                                node.material.opacity = Math.max(parseFloat(rgba[3]), obj.materialAttr.materials[i].metallic);
                                node.material.depthWrite = false;
                                node.material.blending = THREE.CustomBlending;
                                node.material.blendEquation = THREE.AddEquation;
                                node.material.blendSrc = THREE.OneFactor;
                                node.material.blendDst = THREE.OneMinusSrcAlphaFactor;
                                node.material.blendSrcAlpha = THREE.OneFactor;
                                node.material.blendDstAlpha = THREE.OneMinusSrcAlphaFactor;

                                //// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                                node.renderOrder = 1;

                                node.customDepthMaterial = new THREE.MeshDepthMaterial( {
                                    depthPacking: THREE.RGBADepthPacking,
                                    skinning: true,
                                    map: node.material.map,
                                    alphaTest: obj.materialAttr.materials[i].cut_off
                                } );
                            }
                        }
                    }
                });
                // renderer.toneMapping = THREE.ACESFilmicToneMapping;
                // renderer.outputEncoding = THREE.sRGBEncoding;
                
                
                break;
            case "Unlit/Transparent":
                objj.traverse(node => {
                    if (node.material) {
                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
                            node.material.opacity = 1;
                            node.material.depthWrite = false;
                            //// 假如是「透明材質」，同時設定繪製排序往前，讓同距離的繪製可以顯示
                            node.renderOrder = 1;
                        }
                    }
                });
                break;
            case "Unlit/Transparent Cutout":
                objj.traverse(node => {
                    if (node.material) {
                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
                            node.material.opacity = 1;
                            node.material.alphaTest = 0.5;
                        }
                    }
                });
                break;
            case "Unlit/Texture":
                objj.traverse(node => {
                    if (node.material) {
                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
                            node.material = new THREE.MeshBasicMaterial({color: new THREE.Color(1,1,1), name: node.material.name, skinning: node.material.skinning, map: node.material.map});
    //20200730-thonsha-add-start
                            if (node.material.map){
                                node.material.map.encoding = THREE.GammaEncoding;
                                node.material.map.needsUpdate = true;
                                // console.log(node.material.map)

                            }
    //20200730-thonsha-add-end
                            node.material.needsUpdate = true;
                        }
                    }
                });
                break;

    //20221206-thonsha-add-start
            case "Unlit/ScreenCutoutShader":
                objj.traverse(node => {
                    if (node.material) {
                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
                            self.needsRenderTarget = true;
                            
                            node.material.onBeforeCompile = function ( shader ) {
                                shader.uniforms.tEquirect = { value: self.skyRenderTarget.texture };
                                shader.vertexShader = 'varying vec4 vProjection;\n' + shader.vertexShader;
                                shader.vertexShader = shader.vertexShader.replace(
                                '#include <worldpos_vertex>',
                                [
                                    '#include <worldpos_vertex>',
                                    '	vProjection = projectionMatrix * mvPosition;',
                                ].join( '\n' )
                                );
                                shader.fragmentShader = 'uniform sampler2D tEquirect;\nvarying vec4 vProjection;\n' + shader.fragmentShader;
                                shader.fragmentShader = shader.fragmentShader.replace(
                                '#include <dithering_fragment>',
                                [
                                    '#include <dithering_fragment>',
                                    '	vec2 sampleUV;',
                                    '	sampleUV.x = vProjection.x/vProjection.w*0.5 + 0.5;',
                                    '	sampleUV.y = vProjection.y/vProjection.w*0.5 + 0.5;',
                                    '	gl_FragColor = texture2D(tEquirect, sampleUV);',
                                ].join( '\n' )
                                );
                            };
                            
                        }
                    }
                });
                break;
    //20221206-thonsha-add-end

    //20200828-thonsha-add-start
            case "Blocks/Basic":
                // console.log("20200828",objj);
                break;

            case "Blocks/BlocksGem":
                objj.traverse(node => {
                    if (node.material) {
                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
                            node.material.depthWrite = false;
                            //// 假如是「頂點色材質」？，同時設定繪製排序往前，讓同距離的繪製可以顯示
                            node.renderOrder = 1;
                        }
                    }
                });
                break;
            case "Blocks/BlocksGlass":
                objj.traverse(node => {
                    if (node.material) {
                        let nameSlice = node.material.name.split("_");
                        let mIndex = nameSlice[ nameSlice.length - 1 ];
                        if( mIndex == materialIndex ){
                        // if( mIndex == obj.materialAttr.materials[i].materialIndex){
                        // if (node.material.name == obj.materialAttr.materials[i].name) {
                            node.material.depthWrite = false;
                            //// 假如是「頂點色材質」？，同時設定繪製排序往前，讓同距離的繪製可以顯示
                            node.renderOrder = 1;
                        }
                    }
                });
                break;
    //20200828-thonsha-add-end
            default:
                console.log(`The shader of no. ${i} material is not supported currently.`);
                break;
        }

    }
}

//// WebView 物件 3D
////   (只是暫時物件，先不加入promise all的行列)
////   (或者說 未來可預期  WebView 會處理較久 加入pAll會在場景載入等很久)
function loadWebViewNotSupport(obj, index, sceneObjNum, position, rotation, scale, cubeTex){
    //// 這裡this是vrController
    const self = this;
    console.log("loadWebViewNotSupport", obj, index, sceneObjNum, position, rotation, scale)

    //// 用threeJS做一個背板 文字物件放到它的子物件
    let ytEntity = document.createElement('a-entity');

    if (obj.behav){
        ytEntity.setAttribute('class', "clickable" );
    } else if (obj.generalAttr.logic){
        ytEntity.setAttribute('class', "clickable" ); 
    } else {
        ytEntity.setAttribute('class', "unclickable" );
    }

    ytEntity.setAttribute( "id", obj.generalAttr.obj_id ) 
    ytEntity.setAttribute('crossorigin', 'anonymous');
    ytEntity.setAttribute("shadow","");
    
    //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
    if ( obj.generalAttr.active == false ){
        ytEntity.setAttribute("visible", false);
        ytEntity.setAttribute('class', "unclickable" );
    }

    //// 微調一下整體的縮放
    const scaleCoefficient = 0.9
    ;(0,_setTransform_js__WEBPACK_IMPORTED_MODULE_1__.setTransform)(ytEntity, position, rotation, scale.multiplyScalar(scaleCoefficient));
    self.makarObjects.push( ytEntity );

    ytEntity.addEventListener("loaded", e => {
        
        ytEntity.object3D["makarObject"] = true;
        ytEntity.object3D["makarType"] = 'webview';

        if(obj.behav){
            ytEntity.object3D["behav"] = obj.behav ;
        }

        //// 準備一個three平面  作為文字背板    
        let plane, width, height;
        //// 長寬要與YT影片物件接近 數字來自經驗法則
        width  = 1.1 ;
        height = 1.2 ;
        plane = new THREE.Mesh( 
            new THREE.PlaneBufferGeometry( width, height , 0 ), 
            new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, transparent: true, opacity: 0.7 } ),
        );

        //// 印象中v3.5已經不需要這個 有待確認
        if(obj.behav_reference){
            plane["behav_reference"] = obj.behav_reference ;
        }

        ytEntity.object3D.add(plane);
        plane.position.set(0, 0.05, 0)

        //// 文字背板  給一個雜訊的視覺效果
        let paddingPlane;
        paddingPlane = new THREE.Mesh( 
            new THREE.PlaneBufferGeometry( width, height , 0 ), 
            // new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.BackSide, transparent: true, opacity: 0.1 } ),
            new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } ),
        );

        //// 把小平面作為children加入
        ytEntity.object3D.add(paddingPlane)

        paddingPlane.position.set(0, 0.05, 0)
        paddingPlane.rotation.set(0, 0, 0)
        //// 微調一下小平面的縮放
        const paddingCoeficient = 0.95
        paddingPlane.scale.set(paddingCoeficient*1, paddingCoeficient*1, paddingCoeficient*1)
    
        //// 給一個文字物件 寫著 webview not supported
        let tempTextObj = {
            "res_id": "Text",
            "typeAttr": {
                "color": "0.6, 0.6, 0.6, 0.6",
                "margin": 0,
                "content": "webview is\nunsupported\ncurrently.",
                "radious": 0,
                "back_color": "1,1,1,0",
                "anchor_type": 3
            },
            "blocklyAttr": {
                "uid": "",
                "reference": false
            },
            "generalAttr": {
                "logic": false,
                "active": true,
                "obj_id": `tempTextObj_${self.currentSceneIndex}_${index}`,
                "obj_name": obj.generalAttr.obj_name + "_tempTexObj",
                "obj_type": "3d",
                "interactable": false,
                "obj_parent_id": obj.generalAttr.obj_id
            },
            "materialAttr": {
                "materials": []
            },
            "animationAttr": [],
            "transformAttr": {
                "transform": [
                    "0,0,0",
                    "0,0,0,1",
                    "1,1,1"
                ],
                "rect_transform": [],
                "simulated_rotation": "0,0,0"
            },
            "main_type": "text",
            "sub_type": "txt",
            "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Text.glb"
        }
        
        let pText = self.loadText( tempTextObj , new THREE.Vector3(0, 0.05, 0), new THREE.Vector3(0,0,0), new THREE.Vector3(1,1,1), true )
        
        //// 背面也需要
        pText.then(result => {
            const backSideText = result.object3D.clone()
            // console.log("YT後文字 backSideText", backSideText)
            ytEntity.object3D.add(backSideText)
            backSideText.position.set(0,0,0.005)
        })
    })
    
    if(obj.generalAttr.obj_parent_id){
        let timeoutID = setInterval( () => {
            let parent = document.getElementById(obj.generalAttr.obj_parent_id);
            if (parent){ 
                if(parent.object3D.children.length > 0){
                    parent.appendChild(ytEntity);
                    window.clearInterval(timeoutID);
                }
            }
        }, 1);
    }
    else{
        self.vrScene.appendChild(ytEntity);
    }
}

//// WebView 物件 2D
////   (只是暫時物件，先不加入promise all的行列)
function loadWebViewNotSupport2D(obj, index, sceneObjNum, position, rotation, scale, cubeTex){

    //// 這裡this是vrController
    const self = this;
    console.log("loadWebViewNotSupport2D", obj, index, sceneObjNum, position, rotation, scale)

    // console.log("呼叫 getObj2DTransform VC=", VC)

    const trans = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_2__.verionControl.getObj2DTransform(self.editor_version, obj, index, sceneObjNum, position, rotation, scale)
    
    // console.log("呼叫 getObj2DTransform trans=", trans)

    let rectP, rectSizeDelta, rectScale , rectR ; 
    if( trans ){
        rectP = trans.rectP;
        rectSizeDelta = trans.rectSizeDelta;
        rectScale = trans.rectScale;
        rectR = trans.rectR;
    
        //// 為了相容 ，把「縮放資料」取代 「原本 scale」
        scale.x = trans.rectScale[0]
        scale.y = trans.rectScale[1]
    } else {
        // video2DResolve( false );
        return false;
    }
    
    
    let width, height;
    let scaleRatioXY = self.scaleRatioXY;

    //// 因應 3.3.8 以上版本，物件本身的 transform 不會作用在容器上 也不會作用在 圖片本身 
    width  = rectSizeDelta[0] * scaleRatioXY ;
    height = rectSizeDelta[1] * scaleRatioXY ;
        
    let rootObject = new THREE.Object3D();
    
    rootObject["makarObject"] = true ;
    rootObject["makarType"] = 'youtube2D';
    rootObject["obj_id"] = obj.generalAttr.obj_id ;

    //// 20240619 目前webXR不支援YT物件  去背事件應該也暫時不支援
    
    if ( obj.behav ){
        rootObject["behav"] = obj.behav ;
    }
    
    
    if (obj.generalAttr.active == false){
        rootObject.visible = false;
    }


    //// 準備一個three平面  作為文字背板    
    let plane;
    //// 長寬要與YT影片物件接近 數字來自經驗法則
    // width  = 1.1 ;
    // height = 0.65 ;
    plane = new THREE.Mesh( 
        new THREE.PlaneBufferGeometry( width, height , 0 ), 
        new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, transparent: true, opacity: 0.7 } ),
    );

    //// 文字背板  給一個雜訊的視覺效果
    let paddingPlane;
    paddingPlane = new THREE.Mesh( 
        new THREE.PlaneBufferGeometry( width, height , 0 ), 
        // new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.BackSide, transparent: true, opacity: 0.1 } ),
        new THREE.MeshBasicMaterial( { color: 0xaaaaaa, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } ),
    );
    paddingPlane.position.set(0, 0, 0)
    paddingPlane.rotation.set(0, 0, 0)
    //// 微調一下小平面的縮放
    const paddingCoeficient = 0.9
    paddingPlane.scale.set(paddingCoeficient*1, paddingCoeficient*1, paddingCoeficient*1)

    rootObject.add(plane);
    rootObject.add(paddingPlane);


    //// 給一個文字物件 寫著 WebView not supported
    let tempTextObj = {
        "res_id": "Text",
        "typeAttr": {
            "color": "0.6, 0.6, 0.6, 0.6",
            "margin": 0,
            "content": "WebView is\nunsupported\ncurrently.",
            "radious": 0,
            "back_color": "1,1,1,0",
            "anchor_type": 3
        },
        "blocklyAttr": {
            "uid": "",
            "reference": false
        },
        "generalAttr": {
            "logic": false,
            "active": true,
            "obj_id": `tempTextObj2D_${self.currentSceneIndex}_${index}`,
            "obj_name": obj.generalAttr.obj_name + "_tempTextObj2D",
            "obj_type": "2d",
            "interactable": false,
            "obj_parent_id": obj.generalAttr.obj_id
        },
        "materialAttr": {
            "materials": []
        },
        "animationAttr": [],
        "transformAttr": {
            "transform": [],
            "rect_transform": [
                {
                    "scale": "1,1,1",
                    "position": "0,0,0",
                    "rotation": "0,0,0,1",
                    // "size_delta": "100,100",
                    "size_delta": obj.transformAttr.rect_transform[self.selectedResolutionIndex].size_delta,
                    "simulated_rotation": "0,0,0"
                }
            ],
            "simulated_rotation": ""
        },
        "main_type": "text",
        "sub_type": "txt",
        "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Text.glb"
    }

    let pText = self.loadText2D( tempTextObj , index, sceneObjNum, null, null, null, true)  
    
    //// 文字的z值不好決定 由於YT物件2D只有一個文字子物件 renhaohsu暫時先等載入後在parent下再調整為0.01
    pText.then(result => {
        console.log("YT後文字 result", result)
        result.position.z = 0.01;
        result.position.z = 0.05;
    })

    if(obj.generalAttr.obj_parent_id){
        
        let setIntoParent = () => {
            let isParentSet = false;
            for (let i = 0; i<self.makarObjects2D.length; i++ ){
                if ( self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id  ){
                    isParentSet = true;
                }
            }

            if ( isParentSet == false ){
                setTimeout(setIntoParent, 200 );
            }else{
                for (let i = 0; i < self.makarObjects2D.length; i++){
                    if (self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id){
                    
                        rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                        rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
                        rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 
                        
                        //// 旋轉
                        // rootObject.rotateZ( -rotation.z /180*Math.PI);                            
                        rootObject.rotateZ( rectR.z )   

                        rootObject.scale.set( rectScale[0] , rectScale[1] , 1 );

                        rootObject["makarObject"] = true ;
                        rootObject["obj_id"] = obj.generalAttr.obj_id ;
                        rootObject["obj_parent_id"] = obj.generalAttr.obj_parent_id ;
                        self.makarObjects2D[i].add(rootObject);
                        self.makarObjects2D.push(rootObject); 
                    
                        break;
                    }
                    
                }
            }
    
        }
        setIntoParent();

    } else {
        //// 大小
        rootObject.scale.set( scale.x , scale.y, 1 );

        //// 位置
        rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
        rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
        rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 

        //// 旋轉
        rootObject.rotateZ( rectR.z )        
        
        self.scene2D.add(rootObject);
        self.makarObjects2D.push(rootObject);
        
        // video2DResolve( rootObject );
    }
}

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/ImageModule.js":
/*!*************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/ImageModule.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   loadTexture: () => (/* binding */ loadTexture),
/* harmony export */   loadTexture2D: () => (/* binding */ loadTexture2D)
/* harmony export */ });
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _setTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");



//// the html will use this function to load image
//// It is sad that I cant use default a-plane tag to get the image width/height 
function loadTexture( obj, position, rotation, scale ) {
    // console.log("VRFunc.js: VRController: _loadTexture, obj=", obj, position, rotation, scale );
    let self = this
    
    //// 檢查是否為「預設物件」
    ;(0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.checkDefaultImage)( obj );
    
    let pTexture = new Promise( function( textureResolve ){
        //// ver. 3.5 res_url 是 vrController 在 loadSceneObjects 加上的
        (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.UrlExists)( obj.res_url , function( retStatus ){
            if ( retStatus == true ){

                var texture = new THREE.TextureLoader().load( obj.res_url );
                
                let url_spit_length = obj.res_url.split(".").length
                let imgType = obj.res_url.split(".")[url_spit_length-1].toLowerCase();

                let plane;                
                
                // console.log(" _loadTexture_: _sub_type  ", obj.sub_type)

                if ( obj.sub_type == 'png' || obj.sub_type == 'jpg' || obj.sub_type == 'jpeg' || obj.sub_type == 'bmp' ){
                    imgType = obj.sub_type;
                    
                    // console.log(" _loadTexture_: _imgType ", imgType)

                    plane = document.createElement("a-plane");
                    plane.setAttribute( "src", obj.res_url ); //// origin
                }else if ( obj.sub_type == 'gif' ) {
                    imgType = obj.sub_type;
                    plane = document.createElement("a-entity")
                }else if ( obj.sub_type == 'button' ){
                    
                    ///// 因為預設 附型態 是「按鈕」，我又擔心會有物件副檔名不存在，那就設定為 png
                    if ( imgType != 'png' && imgType != 'jpg' && imgType != 'jpeg' ){
                        imgType = 'png';
                    }

                    plane = document.createElement("a-plane");
                    plane.setAttribute( "src", obj.res_url ); //// origin
                }else {
                    console.log('VRFunc.js: _loadTexture: sub_type empty, create empty plane ');
                    plane = document.createElement("a-plane");
                    textureResolve( plane );
                    return;
                }
                //20191101-end-thonsha-mod

                plane.setAttribute( "id", obj.generalAttr.obj_id );//// fei add 
                plane.setAttribute('crossorigin', 'anonymous');
                

                //[start-20240408-renhaohsu-modify]//
                let chromaKey, slope, threshold, transparentBehav;                    
                //20191108-start-thonsha-add
                let transparentImage = false
                if(makarUserData.scenesData.scenes[self.sceneIndex].behav && Array.isArray(makarUserData.scenesData.scenes[self.sceneIndex].behav)){

                    transparentBehav = makarUserData.scenesData.scenes[self.sceneIndex].behav.find(b => b.obj_id == obj.generalAttr.obj_id && b.behav_type == "Transparent")
                    if(transparentBehav){
                        console.log("%c ImageModule.js _loadImage: transparentBehav=", 'color:BlanchedAlmond;', transparentBehav)
                        transparentImage = true;
                        [chromaKey, slope, threshold] = [transparentBehav.color, transparentBehav.slope, transparentBehav.threshold]
                    }
                }
                //[end-20240408-renhaohsu-modify]//

                if (transparentImage && transparentBehav){
                    let rgba = chromaKey.split(",");
                    let color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));

                    
                    //[start-20240408-renhaohsu-modify]//   
                    //// rgb2hsv source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620
                    function rgb2hsv(r,g,b) {
                        let v=Math.max(r,g,b), c=v-Math.min(r,g,b);
                        let h= c && ((v==r) ? (g-b)/c : ((v==g) ? 2+(b-r)/c : 4+(r-g)/c)); 
                        return [60*(h<0?h+6:h), v&&c/v, v];
                    }
                    
                    let _hsv = rgb2hsv( parseFloat(rgba[0]), parseFloat(rgba[1]), parseFloat(rgba[2]) )
                    _hsv[0] /= 360;
                    console.log(`rgb: ${rgba} ,\n _hsv: (${ _hsv })`)
                    //[end-20240408-renhaohsu-modify]//

                    //20191127-start-thonsha-mod
                    // let HSV = transparentBehav.color.split(",");
                    // let keyH = parseFloat(HSV[0]);
                    // let keyS = parseFloat(HSV[1]);
                    // let keyV = parseFloat(HSV[2]);

                    if (imgType == "jpg" || imgType == "jpeg" || imgType == "png"){
                        if (transparentBehav.mode == 'RGB'){
                            // console.log("===============RGB==============")
                            plane.setAttribute( "material", "shader: chromaKey; color: #"+color.getHexString()+";transparent: true; side:double; depthWrite:false; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";" ); //// thonsha add shader
                        }
                        else if (transparentBehav.mode == 'HSV'){
                            // console.log("VRFunc.js: image HSV---------------" , keyH , keyS , keyV , transparentBehav.hue , transparentBehav.saturation , transparentBehav.brightness  );
                            // plane.setAttribute( "material", "shader: HSVMatting; transparent: true; side:double; depthWrite:false; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";" ); //// thonsha add shader
                            plane.setAttribute( "material", "shader: HSVMatting; transparent: true; side:double; depthWrite:false; _keyingColorH:"+_hsv[0]+"; _keyingColorS:"+_hsv[1]+"; _keyingColorV:"+_hsv[2]+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";" ); //// thonsha add shader
                        }
                    }
                    else if (imgType == "gif"){
                        
                        if (transparentBehav.mode == 'RGB'){
                            plane.setAttribute("geometry", "primitive: plane");
                            plane.setAttribute("material", "shader:gif_RGB;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; color: #"+color.getHexString()+"; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";");
                        }
                        else if (transparentBehav.mode == 'HSV'){
                            plane.setAttribute("geometry", "primitive: plane");
                            // plane.setAttribute("material", "shader:gif_HSV;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";");
                            plane.setAttribute("material", "shader:gif_HSV;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; _keyingColorH:"+_hsv[0]+"; _keyingColorS:"+_hsv[1]+"; _keyingColorV:"+_hsv[2]+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";");
                        }

                    }
                    //20191127-end-thonsha-mod
                }
                else{
                    if (imgType == "jpg" || imgType == "jpeg" || imgType == "png"){
                        // plane.setAttribute( "material", "side:double; opacity: 1.0; transparent: true; " ); //// it is work
                        plane.setAttribute( "material", "shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:false" ); //// 圖片不受場上光源影響
                        // plane.setAttribute( "material", "shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:true" ); //// 圖片不受場上光源影響
                        // plane.setAttribute( "material", "shader: flat; side:double; opacity: 1.0; transparent: true; depthWrite:false; depthTest:false;"); //// 圖片不受場上光源影響

                        plane.setAttribute("geometry", "primitive: plane");

                    }
                    else if (imgType == "gif"){
                        plane.setAttribute("geometry", "primitive: plane");
                        plane.setAttribute("material", "side:double; shader:gif;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; depthWrite:false");
                    }
                    
                }

                if (obj.behav){                      
                    //[start-20230811-howardhsu-modify]//
                    if (obj.behav.length==0 && transparentImage){                        
                    //[end-20230811-howardhsu-modify]//
                        plane.setAttribute('class', "unclickable" ); //// fei add
                    }
                    else{
                        plane.setAttribute('class', "clickable" );
                    }
                }
                //[start-20231229-renhaohsu-add]//
                else if (obj.generalAttr.logic){
                    plane.setAttribute('class', "clickable" ); 
                }
                //[end-20231229-renhaohsu-add]//
                else{
                    plane.setAttribute('class', "unclickable" ); //// fei add
                }
                //20191101-end-thonsha-mod


                (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_1__.setTransform)(plane, position, rotation, scale);
                self.makarObjects.push( plane );

                //// 假如『原始圖片像素』高於『進場景材質大小』，就需要『縮小』，原始『各向異性』設為 1，以下流程改設為最高
                let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
                plane.addEventListener("materialtextureloaded", function(evt){
                    // console.log("VRFunc.js: _loadTexture: _materialtextureloaded: plane = " , plane.object3D , evt );
                    evt.detail.texture.anisotropy = maxAnisotropy;
                    evt.detail.texture.needsUpdate = true;
                });

                plane.addEventListener("loaded", function(evt){
                    
                    // console.log(evt);
                    if (evt.target == evt.currentTarget){
                        // console.log("VRFunc.js: _loadTexture: loaded target same" );

                        // setTimeout(function(){
                        // 	plane.setAttribute("cursor-listener", true ); //// fei add
                        // }, 500 );

                        let timeoutID = setInterval( function () {
                            // let tempTexture = plane.object3D.children[0].material.map;
                            if (texture.image){ 											
                                plane.object3D.children[0].scale.set(texture.image.width*0.01, texture.image.height*0.01 , 1);
                                plane.setAttribute("heightForQuiz", texture.image.height*0.01 ); //// fei add
                                window.clearInterval(timeoutID);
                            }
                        }, 1);

                        plane.object3D.children[0].material.reflectivity = 0;
                        
                        let r = new THREE.Vector3();
                        r.set(0,Math.PI, 0); 
                        plane.object3D.children[0].rotation.setFromVector3(r);

                        //// 由於圖片設定為無光標準，且深度寫入為否，故設定繪製排序往前，讓同距離的繪製可以顯示
                        plane.object3D.children[0].renderOrder = 1;

                        plane.object3D["makarObject"] = true; 
                        plane.object3D["makarType"] = 'image'; 


                        if ( obj.behav ){
                            plane.object3D["behav"] = obj.behav ;
                            
                            //// 載入時候建制「群組物件資料」「注視事件」
                            self.setObjectBehavAll( obj );
                        }
                        if(obj.behav_reference){
                            plane.object3D["behav_reference"] = obj.behav_reference ;
                        }
                        
                        if (obj.main_type=="button"){
                            plane.object3D["main_type"] = obj.main_type ;
                            plane.object3D["sub_type"] = obj.sub_type ;
                            plane.setAttribute('class', "clickable" );
                        }

                        textureResolve( plane );

                    }else{
                        console.log("VRFunc.js: _loadTexture: loaded target different" );
                    }
                });
                //20191031-end-thonsha-mod

                //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
                if ( obj.generalAttr.active == false ){
                    plane.setAttribute("visible", false);
                    plane.setAttribute('class', "unclickable" );
                }

                //20191227-start-thonsha-add
                console.log("VRFunc.js: _loadTexture: image behav_reference: ",obj.behav_reference);
                // if(obj.behav_reference){
                //     for(let i=0; i<obj.behav_reference.length;i++){
                //         // if (obj.behav_reference[i].behav_name == 'ShowImage'){
                //         if (obj.behav_reference[i].behav_type == 'Display'){
                //             plane.setAttribute("visible", false);
                //             plane.setAttribute('class', "unclickable" );
                //             break;
                //         }
                //     }
                    
                // }
                //20191227-end-thonsha-add

                //20191029-start-thonhsa-add
                if(obj.generalAttr.obj_parent_id){
                    // plane.setAttribute("visible", false);
                    // plane.setAttribute('class', "unclickable" );
                    let timeoutID = setInterval( function () {
                        let parent = document.getElementById(obj.generalAttr.obj_parent_id);
                        if (parent){ 
                            if(parent.object3D.children.length > 0){
                                parent.appendChild(plane);
                                window.clearInterval(timeoutID);
                            }
                        }
                    }, 1);
                }
                else{
                    self.vrScene.appendChild(plane);
                }
                //20191029-end-thonhsa-add

                // if (obj.main_type=="button"){
                // 	return plane;
                // }

            }else{
                

                console.log("VRFunc.js: _loadTexture , obj url not exist ", obj );
                
                obj.main_type = 'model';
                obj.sub_type = 'glb';
                obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";

                self.loadGLTFModel( obj , position, rotation, scale , self.cubeTex )

                textureResolve( 1 );

            }
        });



    });

    return pTexture;
    
}

//[start-20200315-fei0092-add]//
function loadTexture2D ( obj, index, sceneObjNum, position=null, rotation=null, scale=null ){
    // console.log("VRFunc.js: VRController: _loadTexture2D , obj=", obj, position, rotation, scale );

    let self = this;

    let pTexture2D = new Promise( function( texture2DResolve ){
        var loader = new THREE.TextureLoader();
        loader.load(
            obj.res_url,
            function ( texture ) {
                console.log("VRFunc.js: _loadTexture2D: texture WH=", texture.image.width , texture.image.height );
                
                //// 2022 1123 之後 3.3.8 版本上線， 2D 物件的尺寸需要版本相容
                //// 位置    縮放    尺寸   旋轉
                let rectP, rectSizeDelta, rectScale , rectR ; 
                if ( Object.keys( self.editor_version ).length == 4 ){
                    let largeV  = Number( self.editor_version.v0 );
                    let middleV = Number( self.editor_version.v1 );
                    let smallV  = Number( self.editor_version.v2 );	

                    //[start-20231013-howardhsu-modify]//
                    let trans;
                    if ( largeV > 3 || 
                        ( largeV == 3 && middleV >= 5 ) 
                    ){
                        trans = getObj2DInfo350();
                    } else{
                        trans = getObj2DInfo350();                                              
                    }

                    if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  ){
                        rectP=trans.rectP; rectSizeDelta=trans.rectSizeDelta; rectScale=trans.rectScale; rectR=trans.rectR;
                    }else{
                        texture2DResolve( false );
                        return;
                    }
                    //[end-20231013-howardhsu-modify]//

                }else{
                    let trans = getObj2DInfo350();
                    if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  ){
                        rectP=trans.rectP;rectSizeDelta=trans.rectSizeDelta;rectScale=trans.rectScale; rectR=trans.rectR;
                    }else{
                        texture2DResolve( false );
                        return;
                    }

                }

                //[start-20231013-howardhsu-add]//
                function getObj2DInfo350 (){
                    // console.log('VRFunc.js: _loadSceneObjects: image: --------- 2d image    getObj2DInfo350')

                    let tempInfo = {};
                    //// 位置    縮放    尺寸   旋轉
                    let rectP, rectSizeDelta, rectScale , rectR ; 
                    if ( obj.transformAttr.rect_transform && Array.isArray( obj.transformAttr.rect_transform ) && obj.transformAttr.rect_transform.length > 0 ){

                        if ( !Number.isFinite( self.selectedResolutionIndex )   ){
                            console.warn(' _getObj2DInfo350: error, missing _selectedResolutionIndex', self.selectedResolutionIndex );
                            self.selectedResolutionIndex = 0;
                        }
                        let selectedObj2DInfo = obj.transformAttr.rect_transform[ self.selectedResolutionIndex ];

                        if ( selectedObj2DInfo.position && selectedObj2DInfo.size_delta && selectedObj2DInfo.rotation && selectedObj2DInfo.scale ){
                            rectP = selectedObj2DInfo.position.split(",").map(function(x){return Number(x)}); 
                            rectSizeDelta = selectedObj2DInfo.size_delta.split(",").map(function(x){return Number(x)}); 
                            rectScale = selectedObj2DInfo.scale.split(",").map(function(x){return Number(x)}); 
                            rectR = selectedObj2DInfo.rotation.split(",").map(function(x){return Number(x)});

                            let quaternionRotation = new THREE.Quaternion(parseFloat(rectR[0]), parseFloat(rectR[1]), parseFloat(rectR[2]), parseFloat(rectR[3]))
                            let eulerAngle = new THREE.Euler().setFromQuaternion( quaternionRotation, "YXZ");
                            let _rectR = new THREE.Vector3( eulerAngle.x ,  eulerAngle.y ,  eulerAngle.z );

                            //// 為了相容 ，把「旋轉資料」取代 「原本 rotation」
                            // rotation.z = b.z/Math.PI * 180 ;
                            _rectR.z =  -1 * _rectR.z

                            //// 為了相容 ，把「縮放資料」取代 「原本 scale」
                            rectScale.x = rectScale[0];
                            rectScale.y = rectScale[1];

                            tempInfo = {
                                rectP: rectP,
                                rectSizeDelta: rectSizeDelta,
                                rectScale: rectScale,
                                rectR: _rectR
                            }
                        }
                        

                    }

                    return tempInfo;
                }
                //[end-20231013-howardhsu-add]//

                // console.log(' ppppppppppppppp ' , rectP, rectSizeDelta, rectScale , scale );
                
                texture.flipY = false ; 
                //// scale part only x, y , temp work on both android and iOS
                console.log("VRFunc.js: _loadTexture2D: innerWH , camera2D ", innerWidth, innerHeight , self.vrScene.clientWidth, self.vrScene.clientHeight );

                let width, height;
                let scaleRatioXY = self.scaleRatioXY;
                // width  = rectSizeDelta[0] * scale.x * scaleRatioXY ;
                // height = rectSizeDelta[1] * scale.y * scaleRatioXY ;
                
                //// 因應 3.3.8 以上版本，物件本身的 transform 不會作用在容器上 也不會作用在 圖片本身 
                width  = rectSizeDelta[0] * scaleRatioXY ;
                height = rectSizeDelta[1] * scaleRatioXY ;


                let textureUrl = obj.res_url;
                let imgType = obj.sub_type ;

                let rootObject = new THREE.Object3D();
                rootObject.makarType = "image2D";

                let transparentImage = false

                //[start-20240408-renhaohsu-modify]//
                let chromaKey, slope, threshold, transparentBehav;                    
                //20191108-start-thonsha-add
                if(makarUserData.scenesData.scenes[self.sceneIndex].behav && Array.isArray(makarUserData.scenesData.scenes[self.sceneIndex].behav)){

                    transparentBehav = makarUserData.scenesData.scenes[self.sceneIndex].behav.find(b => b.obj_id == obj.generalAttr.obj_id && b.behav_type == "Transparent")
                    if(transparentBehav){
                        console.log("%c  ImageModule.js _loadImage: transparentBehav=", 'color:BlanchedAlmond;', transparentBehav)
                        transparentImage = true;
                        let _color = transparentBehav.color.split(",")
                        chromaKey = [parseFloat(_color[0]), parseFloat(_color[1]), parseFloat(_color[2])] 
                        slope = transparentBehav.slope 
                        threshold = transparentBehav.threshold
                    }
                }
                //[end-20240408-renhaohsu-modify]//

                let plane;
                let gifObject ;
                if (transparentImage && transparentBehav){
                    
                    //[start-20240408-renhaohsu-modify]//
                    //// rgb2hsv source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620
                    function rgb2hsv(r,g,b) {
                        let v=Math.max(r,g,b), c=v-Math.min(r,g,b);
                        let h= c && ((v==r) ? (g-b)/c : ((v==g) ? 2+(b-r)/c : 4+(r-g)/c)); 
                        return [60*(h<0?h+6:h), v&&c/v, v];
                    }
                    let _hsv = rgb2hsv( chromaKey[0], chromaKey[1], chromaKey[2] )
                    _hsv[0] /= 360;
                    console.log(`rgb: ${chromaKey} ,\n _hsv: (${ _hsv })`)
                    //[end-20240408-renhaohsu-modify]//

                    // let HSV = transparentBehav.HSV.split(",");
                    // let keyH = parseFloat(HSV[0]);
                    // let keyS = parseFloat(HSV[1]);
                    // let keyV = parseFloat(HSV[2]);
                    let chromaKeyMaterial;
                    if (imgType == "jpg" || imgType == "jpeg" || imgType == "png" || imgType == 'button' ){
                        if (transparentBehav.mode == "RGB"){
                            chromaKeyMaterial = new THREE.ChromaKeyMaterial({
                                map: texture , 
                                keyColor: chromaKey ,
                                side: THREE.DoubleSide, 
                                slope: slope,
                                threshold: threshold,
                            });
                            
                        } else if (transparentBehav.mode == "HSV"){
                            chromaKeyMaterial = new THREE.HSVMattingMaterial({
                                map: texture , 
                                side: THREE.DoubleSide, // DoubleSide
                                _keyingColorH: _hsv[0],
                                _keyingColorS: _hsv[1],
                                _keyingColorV: _hsv[2],
                                // _keyingColorH: keyH,
                                // _keyingColorS: keyS,
                                // _keyingColorV: keyV,
                                _deltaH: transparentBehav.hue,
                                _deltaS: transparentBehav.saturation,
                                _deltaV: transparentBehav.brightness,
                            });
                        }
                        // plane = THREE.SceneUtils.createMultiMaterialObject( new THREE.PlaneBufferGeometry(
                        // 	texture.image.width*25.4/dpi ,
                        // 	texture.image.height*25.4/dpi , 0 ), [ 
                        // 		chromaKeyMaterial,
                        // 		new THREE.MeshBasicMaterial( { color: 0xC0C0C0 , side: THREE.BackSide } ) 
                        // 	]
                        // );
                        plane = new THREE.Mesh( 
                            new THREE.PlaneBufferGeometry( width , height , 0 ), 
                            chromaKeyMaterial,
                        );
                    }else if (imgType == "gif"){

                        // gifObject = new THREE.gifAnimator();
                        // gifObject.init({ src: textureUrl , side: THREE.DoubleSide, transparent: true, opacity: 1.0, autoplay: true, chroma: transparentBehav });
                        // rootObject.gifObject = gifObject;

                        // //// 上下顛倒
                        // if ( gifObject.__texture.flipY ){
                        //     gifObject.__texture.flipY = false;
                        // }

                        // plane = new THREE.Mesh(
                        //     new THREE.PlaneBufferGeometry( width, height , 0 ),
                        //     gifObject.material,
                        // );


                        plane = document.createElement("a-entity");
                        // plane.setAttribute("geometry", "primitive: plane; width:" + width +"; height:" + height + ";" );
                        plane.setAttribute("material", "side:double; shader:gif;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; depthWrite:false; visible: false; ");


                        // let rgba = chromaKey.split(",");
                        let color = new THREE.Color(parseFloat(chromaKey[0]),parseFloat(chromaKey[1]),parseFloat(chromaKey[2]));
                        console.log("three color", color)
                        
                        if (transparentBehav.mode == 'RGB'){
                            plane.setAttribute("geometry", "primitive: plane; width:" + width +"; height:" + height + ";" );
                            plane.setAttribute("material", "shader:gif_RGB;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; color: #"+color.getHexString()+"; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";");
                        }
                        else if (transparentBehav.mode == 'HSV'){
                            plane.setAttribute("geometry", "primitive: plane; width:" + width +"; height:" + height + ";" );
                            // plane.setAttribute("material", "shader:gif_HSV;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";");
                            plane.setAttribute("material", "shader:gif_HSV;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; side:double; depthWrite:false; _keyingColorH:"+_hsv[0]+"; _keyingColorS:"+_hsv[1]+"; _keyingColorV:"+_hsv[2]+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";");
                        }

                    }
                    
                    
                } else {

                    if (imgType == "jpg" || imgType == "jpeg" || imgType == "png" || imgType == 'button' ){

                        plane = new THREE.Mesh( 
                            new THREE.PlaneBufferGeometry( width, height , 0 ), 
                            new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true  } ),
                        );

                    } else if (imgType == "gif"){

                        plane = document.createElement("a-entity");
                        plane.setAttribute("geometry", "primitive: plane; width:" + width +"; height:" + height + ";" );
                        plane.setAttribute("material", "side:double; shader:gif;  src: url("+ obj.res_url+"); opacity: 1; transparent: true; depthWrite:false; visible: false; ");

                    }

                }

                // if (obj.behav_reference){
                //     rootObject.behav_reference = obj.behav_reference;
                //     for (let j = 0; j < obj.behav_reference.length; j++){
                //         if (obj.behav_reference[j].behav_type == "Display"  ){
                //             rootObject.visible = false;
                //             if (imgType == "gif" ){
                //                 //// 這邊只有 pause不恰當，因為 gifAnimator 中的[__ready]在被呼叫的時候，會以 autoplay 為標準決定是否執行play
                //                 //// 無法確定 __ready執行的時間，假如已經執行過，這邊 pause則會暫停更新畫面，假如還沒執行過，這邊設 autoplay false會讓 ready時不 play
                //                 gifObject.pause();
                //                 gifObject.__autoplay = false;

                //             }
                //         }
                //     }
                // }


                // // for double side 
                // var plane = new THREE.Mesh(
                // 	new THREE.PlaneBufferGeometry( width , height , 0 ),
                // 	new THREE.MeshBasicMaterial( { map : texture,  side: THREE.DoubleSide,  transparent: true   } ) // DoubleSide, FrontSide
                // );
                
                if ( obj.behav ){
                    rootObject["behav"] = obj.behav ;

                    //// 載入時候建制「群組物件資料」「注視事件」
                    self.setObjectBehavAll( obj );
                }
                
                if (obj.generalAttr.active == false){
                    rootObject.visible = false;
                }

                // plane.makarType = 'image2D';
                rootObject["makarObject"] = true ;
                rootObject["obj_id"] = obj.generalAttr.obj_id ;

                if (obj.main_type=="button"){
                    // console.log("for 2d quiz button")
                    // rootObject["main_type"] = obj.main_type ;
                    rootObject["sub_type"] = obj.sub_type ;
                }

                //20191029-start-thonhsa-add
                if(obj.generalAttr.obj_parent_id){
                    // console.log("______VRFunc.js: _loadTexture2D: obj(parent) ", obj );

                    let setIntoParent = function(){
                        let isParentSet = false;
                        for (let i = 0; i < self.makarObjects2D.length; i++ ){
                            if ( self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id  ){
                                isParentSet = true;
                            }
                        }

                        if ( isParentSet == false ) {
                            setTimeout(setIntoParent, 500 );
                            console.log("______VRFunc.js: _loadTexture2D: isParentSet   ", obj , self.makarObjects2D );

                        }else{
                            for (let i = 0; i < self.makarObjects2D.length; i++){
                                if (self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id){
                                    
                                    //// 大小
                                    // rootObject.scale.set( scale.x , scale.y, 1 );
                                    rootObject.scale.set( rectScale.x , rectScale.y, 1 );

                                    //// 改為統一移動比例
                                    rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                                    rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
                                    rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 

                                    //// 旋轉
                                    // rootObject.rotateZ( -1*rectR.z )                                
                                    rootObject.rotateZ( rectR.z )                                

                                    if ( imgType == 'gif'  ){

                                        plane.addEventListener("loaded", function(evt){
                                    
                                            if (evt.target == evt.currentTarget){
                
                                                //// 取得圖片原始大小
                                                if ( plane && plane.object3D && plane.object3D.children && plane.object3D.children.length == 1  &&
                                                    plane.object3D.children[0] && plane.object3D.children[0].material
                                                ){

                                                    let m = plane.object3D.children[0].material ;

                                                    //// 由於"有去背behav的gif"使用的shader流程不同，分開判斷。 沒去背：
                                                    if ( m && m.map && m.map.image && m.map.image.width > 2 && m.map.image.height > 2 ){
                                                        //// gif上下顛倒
                                                        m.map.flipY = false;
                                                    }
                                                    
                                                    //// 有去背behav的gif (沒去背的gif也有可能沒進上面的區塊)  註: gif.self是在 aframe-gif-shader為此而新增的
                                                    if ( plane && plane.gif && plane.gif.self && plane.gif.self.__texture ){
                                                        //// gif上下顛倒
                                                        plane.gif.self.__texture.flipY  = false

                                                        //// 貼圖模糊問題: 把anisotropy提升到maxAnisotropy (但測試時看不出效果 暫時擱置) 
                                                        let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
                                                        if(maxAnisotropy){
                                                            plane.gif.self.__texture.anisotropy = maxAnisotropy
                                                            plane.gif.self.__texture.needsUpdate = true 
                                                            // console.log( "plane loaded maxAnisotropy needsUpdate" , plane.gif.self.__texture.needsUpdate)
                                                        }
                                                    }
                                                    
                                                    m.visible = true;
                                                    // console.log("_loadTexture2D: gif iwh ", m.map.image.width , m.map.image.height );
                                                    // plane.object3D.children[0].scale.set( m.map.image.width * 1, m.map.image.height * 1 , 1);
                                                    // clearInterval ( timeoutID );

                                                    rootObject.add( plane.object3D );
                                                    self.makarObjects2D[i].add(rootObject);
                                                    self.makarObjects2D.push(rootObject);

                                                    rootObject["makarObject"] = true ;
                                                    rootObject["obj_id"] = obj.generalAttr.obj_id ;
                                
                                                    plane.removeFromParent();
                                                    plane.remove();

                                                    texture2DResolve( rootObject );

                                                
                                                }

                        
                                            }else{
                                                console.log("_loadTexture2D: loaded target different" );
                                            }
                                        });

                                        self.vrScene.appendChild(plane);

                                    }else{

                                        rootObject.add( plane );
                                        self.makarObjects2D[i].add(rootObject);
                                        self.makarObjects2D.push(rootObject);

                                        texture2DResolve( rootObject );

                                        console.log("______VRFunc.js: _loadTexture2D: parent exit, set obj(parent) ", obj , plane , self.makarObjects2D.slice() , performance.now());

                                    }



                                }
                            }

                        }
                    };
                    setIntoParent();

                } else{
                    console.log("VRFunc.js: VRController: _loadTexture2D: obj() ", obj );

                    //// 大小
                    // rootObject.scale.set( scale.x , scale.y, 1 );
                    rootObject.scale.set( rectScale.x , rectScale.y, 1 );

                    //// 位置
                    rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                    rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
                    rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 

                    //// 旋轉
                    rootObject.rotateZ( rectR.z )      

                    // console.log("______VRFunc.js: _loadTexture2D: rectP", rectP );

                    self.makarObjects2D.push(rootObject);
                    self.scene2D.add(rootObject);

                    //// 2024 05 07 圖片類型會影響載入
                    if ( imgType == 'gif' ){
                        
                        //// gif 流程，基本上等同於 3D gif
                        // 1. 由 aframe 流程載入，先放置於 3D 場景下，但是材質不可見
                        // 2. 等待載入完成，找到 three 物件
                        // 3. 將 three 物件放入 2D 場景，刪除 3D 場景物件，並將材質可見打開
                        
                        plane.addEventListener("loaded", function(evt){

                            if (evt.target == evt.currentTarget){

                                console.log("_loadTexture2D: gif loaded target same" );

                                //// 取得圖片原始大小
                                if ( plane && plane.object3D && plane.object3D.children && plane.object3D.children.length == 1  &&
                                    plane.object3D.children[0] && plane.object3D.children[0].material
                                ){

                                    let m = plane.object3D.children[0].material ;
                                    
                                    //// 由於"有去背behav的gif"使用的shader流程不同，分開判斷。 沒去背：
                                    if ( m && m.map && m.map.image && m.map.image.width > 2 && m.map.image.height > 2 ){
                                        //// gif上下顛倒
                                        m.map.flipY = false;
                                    }

                                    //// 有去背behav的gif (沒去背的gif也有可能沒進上面的區塊)  註: gif.self是在 aframe-gif-shader為此而新增的
                                    if ( plane && plane.gif && plane.gif.self && plane.gif.self.__texture ){
                                        //// gif上下顛倒
                                        plane.gif.self.__texture.flipY  = false

                                        //// 貼圖模糊問題: 把anisotropy提升到maxAnisotropy (但測試時看不出效果 暫時擱置) 
                                        let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
                                        if(maxAnisotropy){
                                            plane.gif.self.__texture.anisotropy = maxAnisotropy
                                            plane.gif.self.__texture.needsUpdate = true 
                                            // console.log( "plane loaded maxAnisotropy needsUpdate" , plane.gif.self.__texture.needsUpdate)
                                        }
                                    }

                                    m.visible = true;

                                    rootObject.add( plane.object3D );
                                    rootObject["makarObject"] = true ;
                                    rootObject["obj_id"] = obj.generalAttr.obj_id ;
                
                                    plane.removeFromParent();
                                    plane.remove();

                                    texture2DResolve( rootObject );
                                    console.log("______VRFunc.js: _loadTexture2D: self.makarObjects2D.slice()=", self.makarObjects2D.slice() , performance.now())

                                }

        
                            }else{
                                console.log("_loadTexture2D: loaded target different" );
                            }
                        });

                        self.vrScene.appendChild(plane);
    

                    }else{
                        rootObject.add(plane);
                        rootObject["makarObject"] = true ;
                        rootObject["obj_id"] = obj.generalAttr.obj_id ;
    
                        texture2DResolve( rootObject );
                        console.log("______VRFunc.js: _loadTexture2D: self.makarObjects2D.slice()=", self.makarObjects2D.slice() , performance.now())
    
                    }


                }
                //20191029-end-thonhsa-add
                
                // console.log("VRFunc.js: VRController: _loadTexture2D ,obj=", obj );

            },
            undefined,
            function ( err ) {
                console.error( 'An error happened. _loadTexture2D , err=', err);
            }
        );

    });
    
    return pTexture2D;

}

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/LightModule.js":
/*!*************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/LightModule.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   loadLight: () => (/* binding */ loadLight)
/* harmony export */ });
/* harmony import */ var _setTransform_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");


function loadLight( obj, position, rotation, scale ) {
    let self = this
    let pLight = new Promise( function( lightResolve ){

        console.log("VRFunc.js: _loadLight: obj=", obj);  
        let Light = document.createElement("a-entity");
        Light.setAttribute("id", obj.generalAttr.obj_id);

        //[start-20230725-howardhsu-modify]//
        //// 原本的 attr 參數前面沒有 var 或 let，這裡因為要寫成module而加上 暫時不確定是否有其他js檔會用到它
        let attr = "type:" + obj.typeAttr.light_type    
        //[end-20230725-howardhsu-modify]//

        let rgb = obj.typeAttr.color.split(",");
        let color = new THREE.Color(parseFloat(rgb[0]),parseFloat(rgb[1]),parseFloat(rgb[2]));
        attr += "; color:#"+color.getHexString()

        attr += ";intensity:"+obj.typeAttr.intensity

        if (obj.typeAttr.light_type == "point" || obj.typeAttr.light_type == "spot" ){
            attr += ";distance:"+obj.typeAttr.range
            attr += ";decay: 4"
        }

        if (obj.typeAttr.light_type == "spot"){
            attr += ";angle:"+(parseFloat(obj.typeAttr.spotAngle)/2).toString()
            attr += ";penumbra: 0.2";
        }

        if (obj.typeAttr.shadow != "None"){
            Light.setAttribute("castShadow", true);
            attr += ";castShadow: true ;shadowCameraVisible: false; shadowBias:-0.0005; shadowCameraTop:10; shadowCameraBottom:-10; shadowCameraRight:10; shadowCameraLeft:-10; shadowMapHeight:1024; shadowMapWidth:1024; shadowCameraFar: 500; shadowCameraNear: 0.5"
        }

        Light.setAttribute("light", attr);
                
        if (obj.typeAttr.light_type == "directional"){
            
            (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_0__.setTransform)(Light, position, rotation, scale);

            //// 子物件修改
            //[start-20230629-howardhsu-add]//
            //// 祥霆給的正解: 
            //// 備註：這邊確認 Light.object3D.children[0].target 沒有用處，因為不再場景內部
            //// 備註：方向光假如沒有設定 target 或是 target 未在場景內，那此方向光指向「場景原點」
            //// 假如此方向光有 target 在
            Light.addEventListener( 'loaded' , function( e ){
                if ( Light.object3D && Light.object3D.children && Light.object3D.children[0] && Light.object3D.children[0].type == "DirectionalLight" ){
                    
                    Light.object3D["makarObject"] = true; 
                    Light.object3D["makarType"] = 'light'; 

                    let normalVector = new THREE.Vector3( 0, 0, 1 );
                    // console.log('VRFunc.js: _loadLight: normalVector=' , normalVector );

                    let lightTarget = Light.object3D.children[0].target;
                    lightTarget.position.copy( normalVector );     
                    // console.log('VRFunc.js: _loadLight: normalVector=' , lightTarget );

                    Light.object3D.children[0].add( lightTarget ); 
                }
            })
            //[end-20230629-howardhsu-add]//
            
            //// 強制「平行光」不產生陰影，編輯器也是如此
            Light.setAttribute("castShadow", false);
            Light.setAttribute("light", 'castShadow: false; ');
        }

        //[start-20230630-howardhsu-add]//
        else if (obj.typeAttr.light_type == "spot"){						
            (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_0__.setTransform)(Light, position, rotation, scale);
            console.log("3.5 rotation in loadLight spotLight", rotation)
            Light.addEventListener( 'loaded' , function( e ){
                if ( Light.object3D && Light.object3D.children && Light.object3D.children[0] && Light.object3D.children[0].type == "SpotLight" ){
                    //// 調整聚光燈照射方向
                    let normalVector = new THREE.Vector3( 0, 0, 1 );                    
                    let lightTarget = Light.object3D.children[0].target;
                    lightTarget.position.copy( normalVector );     
                    Light.object3D.children[0].add( lightTarget ); 
                }
            })
        }
        else if (obj.typeAttr.light_type == "point"){
            (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_0__.setTransform)(Light, position, rotation, scale);
        }
        //[end-20230630-howardhsu-add]//
        else{
            //// 目前沒有 平行光、聚光燈、點光源 以外的光源類型，不應該會走進這段
            (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_0__.setTransform)(Light, position, rotation, scale);
            console.log("VRFunc.js: _loadLight: Unexpected light type!!  obj.typeAttr.light_type=", obj.typeAttr.light_type)
        }

        //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
        if ( obj.generalAttr.active == false ){
            Light.setAttribute("visible", false);
        }

        console.log("VRFunc.js: _loadLight: Light=", Light);
        self.makarObjects.push( Light );
        // self.vrScene.appendChild(Light);// this = vrScene

        if(obj.generalAttr.obj_parent_id){
            let timeoutID = setInterval( function () {
                let parent = document.getElementById(obj.generalAttr.obj_parent_id);
                if (parent){ 
                    if(parent.object3D.children.length > 0){
                        parent.appendChild(Light);
                        window.clearInterval(timeoutID);
                    } 
                }
            }, 1);
        }
        else{
            self.vrScene.appendChild(Light);
        }


        lightResolve( Light );

    });

    return pLight;
}

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/SkyModule.js":
/*!***********************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/SkyModule.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   loadSky: () => (/* binding */ loadSky)
/* harmony export */ });
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");


////// load the sky, 360 image/video    
function loadSky( vrScene, scene_id, sceneSky_info, loadSceneCount) {
    // console.log("VRFunc.js: _loadSky: main type=", VRSceneResult[projIndex].scenes[0].main_type, VRSceneResult[projIndex].scenes[0].res_url);
    // main_type: "spherical_video"

    // let editor_version = [];
    // if (typeof(self.VRSceneResult[projIndex].editor_ver) != "string" ){
    // 	console.log("VRFunc.js: _loadSky: the editor_ver is not string, error and return ");
    // 	return -1;
    // }else{
    // 	editor_version = self.VRSceneResult[projIndex].editor_ver.split(".");
    // }

    // let sceneSky_info = self.editorVerionControllSky( editor_version , projIndex, sceneIndex );
    let pSky = new Promise( function( skyResolve ){
        
        (0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.UrlExists)( sceneSky_info.res_url , function( retStatus ){
            let aSky;
            console.log(' ******  retStatus = ', retStatus, sceneSky_info.res_url );
            if (retStatus == false){
                //// 因為有些舊的專案 sky url 會404，這邊改為先檢查 url status，假如不存在，則強迫設定為預設圖片（或是直接不載入）

                if (document.getElementById("sky")){
                    aSky = document.getElementById("sky");
                    if (aSky.localName == "a-sky"){
                        //// 之前的 sky 是圖片，什麼都不用作
                    }else if (aSky.localName == "a-videosphere"){
                        //// 之前的 sky 是影片
                        aSky.remove();
                        aSky = document.createElement('a-sky');
                        aSky.setAttribute('id', "sky" );
                        vrScene.appendChild(aSky);
                    }
                }else{
                    aSky = document.createElement('a-sky');
                    aSky.setAttribute('id', "sky" );
                    vrScene.appendChild(aSky);
                }
                
                if( sceneSky_info.res_url == "DefaultResource/Spherical_Image/SphericalImage.png"){
                    
                } else{

                    //// 跳出錯誤提示
                    let errorText = document.createElement('div');
                    errorText.style.position = 'absolute';
                    errorText.style.top = '30%';
                    errorText.style.left = '0%';
                    errorText.style.width = '100%';
                    errorText.style.height = '40%';
                    errorText.style.color = 'black';
                    errorText.style.backgroundColor = 'rgba(128,128,128,0.5)';
                    errorText.style.pointerEvents = 'none';
                    errorText.style.fontSize = '24px';
                    errorText.style.zIndex = 3;

                    document.body.appendChild( errorText )

                    let text = document.createElement('div');
                    text.className = 'centerText';
                    text.style.whiteSpace = 'pre-wrap';
                    text.textContent = '此專案的環景影片/圖片無法於瀏覽器支援，改為預設場景'
                    errorText.appendChild( text );

                    setTimeout(function(){
                        errorText.remove();
                    }, 8000);

                }

                //// 判斷是否「場景相同來源」，是的話直接隱藏「載入頁面」。否的話執行載入新圖片
                let skySameSrc = false;
                if (aSky.getAttribute('material') ){
                    if (aSky.getAttribute('material').src == sceneSky_info.res_url ){
                        // console.log(' VRFunc.js: _loadSky same src '  );
                        skySameSrc = true;
                    }
                }

                if ( skySameSrc == true ){
                    console.log("VRFunc.js: _loadSky: spherical_image same as previous(404)");

                    
                    skyResolve(aSky);
                } else {

                    aSky.setAttribute("material", {src: "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png" });

                    aSky.setAttribute("radius", 2000 ); // if not set this, will be infinite
                    
                    var handleLoadingPage = function(){
                        console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page ");
                        
                        //// 將自己移除事件，避免重複觸發事件
                        aSky.removeEventListener("materialtextureloaded" , handleLoadingPage );
                    };
                    aSky.addEventListener("materialtextureloaded" , handleLoadingPage );
                    skyResolve(aSky);
                }

                
            } else {
                switch ( sceneSky_info.main_type ){
                    case "spherical_image":
                    case "image":
                        // console.log("check ver3.5 sky object", sceneSky_info)
                        if (document.getElementById("sky")){
                            aSky = document.getElementById("sky");
                            if (aSky.localName == "a-sky"){
                                //// 之前的 sky 是圖片，什麼都不用作
                            }else if (aSky.localName == "a-videosphere"){
                                //// 之前的 sky 是影片
                                aSky.remove();
                                aSky = document.createElement('a-sky');
                                aSky.setAttribute('id', "sky" );
                                vrScene.appendChild(aSky);
                            }
                        }else{
                            aSky = document.createElement('a-sky');
                            aSky.setAttribute('id', "sky" );
                            vrScene.appendChild(aSky);
                        }
                        

                        if( sceneSky_info.res_url == "DefaultResource/Spherical_Image/SphericalImage.png"){
                            sceneSky_info.res_url = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png";
                        }

                        //// 判斷是否「場景相同來源」，是的話直接隱藏「載入頁面」。否的話執行載入新圖片
                        let skySameSrc = false;
                        if (aSky.getAttribute('material') ){
                            if (aSky.getAttribute('material').src == sceneSky_info.res_url ){
                                // console.log(' VRFunc.js: _loadSky same src '  );
                                skySameSrc = true;
                            }
                        }

                        if (skySameSrc == false){
                            // console.log("materialSRC", sceneSky_info.res_url)
                            aSky.setAttribute("material", {"src": sceneSky_info.res_url }); 

                            var handleLoadingPage = function(){
                                console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page ");
                                
                                
                                //// 將自己移除事件，避免重複觸發事件
                                aSky.removeEventListener("materialtextureloaded" , handleLoadingPage );
                                skyResolve(aSky);
                            };
                            aSky.addEventListener("materialtextureloaded" , handleLoadingPage );

                        }else{
                            console.log("VRFunc.js: _loadSky: spherical_image same as previous  ");

                            
                            skyResolve(aSky);
                        }

                        aSky.setAttribute("radius", 2000 ); // if not set this, will be infinite

                        break;

                    case "spherical_video":
                        ////// a-assets
                        let assets = document.getElementById("makarAssets");
                        
                        ////// mp4 video 
                        // var aSky = document.createElement('a-videosphere');
                        if (document.getElementById("sky")){
                            aSky = document.getElementById("sky");
                            if (aSky.localName == "a-sky"){
                                //// 之前的 sky 是圖片，刪掉再創新的
                                aSky.remove();
                                aSky = document.createElement('a-videosphere');
                                aSky.setAttribute('id', "sky" );
                                vrScene.appendChild(aSky);
                            }else if (aSky.localName == "a-videosphere"){
                                //// 之前的 sky 是影片，不用額外動作
                                
                            }
                        }else{
                            aSky = document.createElement('a-videosphere');
                            aSky.setAttribute('id', "sky" );
                            vrScene.appendChild(aSky);
                        }

                        // aSky.setAttribute("src", self.VRSceneResult[projIndex].scenes[0].res_url ); //  this is work, but hard to control the tag

                        let skyVideo = document.createElement("video");
                        skyVideo.src = sceneSky_info.res_url;  
                        skyVideo.playsInline = true;
                        skyVideo.autoplay = true;
                        //// 預設「靜音」								
                        skyVideo.muted = true;

                        skyVideo.setAttribute("loop", "true");
                        skyVideo.setAttribute('type', 'video/mp4');
                        if (window.Browser){
                            if ( window.Browser.name == undefined || window.Browser.name == "safari"){
                            // if ( Browser.mobile == true || Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                skyVideo.muted = true;
                            }
                        }
                        skyVideo.onloadedmetadata = function() {
                            console.log("VRFunc.js: _loadSky: spherical_video onloadedmetadata");
                            skyVideo.play();
                        }

                        skyVideo.setAttribute('crossorigin', 'anonymous');
                        // skyVideo.setAttribute('id', self.VRSceneResult[projIndex].scenes[sceneIndex].scene_id + "_" + self.loadSceneCount );
                        skyVideo.setAttribute('id', scene_id + "_" + loadSceneCount );

                        // skyVideo.play(); // play pause
                        skyVideo.setAttribute("autoplay", "true" ); 
                        // skyVideo.setAttribute("loop", "true" ); 

                        assets.appendChild(skyVideo); ////// add video into a-assets
                        // aSky.setAttribute("src", "#skyVideo" );  
                        // aSky.setAttribute("src", "#"+self.VRSceneResult[projIndex].scenes[sceneIndex].scene_id + "_" + self.loadSceneCount ); // 
                        aSky.setAttribute("src", "#" + scene_id + "_" + loadSceneCount ); // 


                        aSky.setAttribute("radius", 2000 ); // if not set this, will be infinite
                        

                        var handleLoadingPage = function(){
                            console.log("VRFunc.js: _loadSky: spherical_video materialtextureloaded, remove loading page ");
                            
                            //// 將自己移除事件，避免重複觸發事件
                            aSky.removeEventListener("materialtextureloaded" , handleLoadingPage );

                            skyResolve(aSky);
                        };
                        aSky.addEventListener("materialtextureloaded" , handleLoadingPage );

                        break;

                }
                console.log("VRFunc.js: _loadSky: aSky=", aSky );

            }
            
        });

    });    

    return pSky;

};


/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/TextModule.js":
/*!************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/TextModule.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   loadText: () => (/* binding */ loadText),
/* harmony export */   loadText2D: () => (/* binding */ loadText2D)
/* harmony export */ });
/* harmony import */ var _setTransform_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");


function loadText( obj, position, rotation, scale, isTempTextObj=false ) {
    //20191204-start-thonsha-add  
    // console.log("VRFunc.js: _laodText: obj, position, rotation, scale = ", obj, position, rotation, scale	);
    
    // let self = this
    
    let pText = new Promise( ( textResolve ) => {

        let anchor = document.createElement('a-entity');
            
        // anchor.setAttribute("geometry","primitive: sphere; radius: 0.05" );
        // anchor.setAttribute("material","roughness: 0.48; color:	#FF0000");
        (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_0__.setTransform)(anchor, position, rotation, scale);
        anchor.setAttribute( "id", obj.generalAttr.obj_id );//// fei add 

        // this.scaleRatioXY = this.scaleRatioXY*1.2
        console.log("scaleRatioXY=", this.scaleRatioXY)

        if( !isTempTextObj ){
            this.makarObjects.push( anchor );
        } else {
            //// isTempTextObj: 是 YT(not supported)物件底下的文字物件 暫時不放到makarObjects
        }

        if (obj.behav){  
            anchor.setAttribute('class', "clickable" ); //// fei add
        } else if (obj.main_type == "button"){  //// Quiz 單選題的文字選項、多選題的OK按鈕，在quiz載入時會被加上main_type "button"
            anchor.setAttribute('class', "clickable" ); 
        }
        //[start-20231229-renhaohsu-add]//
        else if (obj.generalAttr.logic){
            anchor.setAttribute('class', "clickable" ); 
        }
        //[end-20231229-renhaohsu-add]//
        else{
            anchor.setAttribute('class', "unclickable" ); //// fei add
        }
        
        // let textEntity = document.createElement('a-entity');
        // // textEntity.setAttribute("geometry","primitive: plane; width: auto; height: auto; width: auto");
        // // textEntity.setAttribute("material","color: #FFFFFF");
        // // textEntity.setAttribute("text","value: "+obj.content+"; color:red; shader: msdf; font:https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/notosans/NotoSans-Regular.json");
        // // textEntity.setAttribute("text","value: hello; color:red; shader: msdf; font:https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/creepster/Creepster-Regular.json");
        // textEntity.setAttribute("text","value: "+obj.content+"; color:blue; font:font/edukai-4.0-msdf.json");
        // =======================================================================
        let textEntity = document.createElement('a-text');
        //// 還是要加預設的 mesh，為了觸碰事件 
        textEntity.setAttribute("geometry","primitive:plane; width: auto; height: auto; skipCache: true;");
        textEntity.setAttribute("material","opacity: 0.0 ; depthWrite:false; color:#000000; side:double;");

        let textList = obj.typeAttr.content.split('\n');
        let longestSplit = 0;
        const REGEX_CHINESE = /[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u;
        const isChinese = (str) => REGEX_CHINESE.test(str);
        for (let i = 0; i < textList.length;i++) {
            let textLength = 0;
            for (let j = 0; j <  textList[i].length; j++) {
                if(isChinese(textList[i][j])){  // chinese
                    textLength += 1.6;
                }
                else if(textList[i][j] == textList[i][j].toUpperCase() && textList[i][j] != textList[i][j].toLowerCase()){ // upper-case
                    textLength += 1;
                }
                else if(textList[i][j] == textList[i][j].toLowerCase() && textList[i][j] != textList[i][j].toUpperCase()){ // lower-case
                    // textLength += 0.85;
                    textLength += 1.0;
                }
                else if(!isNaN(textList[i][j] * 1)){ //numeric
                    textLength += 1;
                }
                else{ // other symbols
                    textLength += 1.25;
                }
                
            }
            // console.log( textList[i], textLength);
            if (textLength > longestSplit) longestSplit =textLength;
        }
        textEntity.setAttribute("value",obj.typeAttr.content);
        // textEntity.setAttribute("width",longestSplit*0.08)	// 4 for 0.46  per 0.115  20201027：這個數值目前沒有用處
        // textEntity.setAttribute("wrap-count",longestSplit); // 1 for 1    20201027：這個數值目前沒有用處
        textEntity.setAttribute("anchor","center");
        textEntity.setAttribute("align","left");

        textEntity.setAttribute("backcolor", obj.typeAttr.back_color ); //// 這邊注意一重點，自己設定的 attribute 不能使用 『大寫英文』，否則aframe data內會找不到，參照 text物件
        textEntity.setAttribute("textcolor", obj.typeAttr.color ); //// 暫時沒有用，假如未來文字支援『透明度』功能時候會需要
        textEntity.setAttribute("side","double");

        var fontUrl = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/resource/fonts/";
        let fonts = [  fontUrl + "1-msdf.json", fontUrl + "2-msdf.json" , fontUrl + "3-msdf.json", fontUrl + "4-msdf.json", fontUrl + "5-msdf.json", 
                fontUrl + "6-msdf.json", fontUrl + "7-msdf.json" , fontUrl + "8-msdf.json", fontUrl + "9-msdf.json", fontUrl + "10-msdf.json", 
                fontUrl + "11-msdf.json", fontUrl + "12-msdf.json" ];
        // fonts = [ fontUrl + "1-msdf.json" ];
        textEntity.setAttribute("font", fonts );

        textEntity.setAttribute("negate","false");
        textEntity.setAttribute('crossorigin', 'anonymous');

        let rgb = obj.typeAttr.color.split(",");
        let color = new THREE.Color(parseFloat(rgb[0]),parseFloat(rgb[1]),parseFloat(rgb[2])); 
        textEntity.setAttribute("color", "#"+color.getHexString());

        // textEntity.setAttribute( "id", obj.typeAttr.obj_id );//// fei add 
        // if (obj.behav){
        // 	textEntity.setAttribute('class', "clickable" ); //// fei add
        // }
        // else if (obj.main_type == "button"){
        // 	textEntity.setAttribute('class', "clickable" ); //// fei add
        // }
        // else{
        // 	textEntity.setAttribute('class', "unclickable" ); //// fei add
        // }
        
        // setTransform(textEntity, position, rotation, scale);
        // this.makarObjects.push( textEntity );

        //// 因為無法確認「形狀確認」「物件載入完成」那個先行完成，所以增加判定
        let loadedCheck = 0;

        function checkGeometrySet(evt){
            console.log("VRFunc.js: _loadText: textEntity geometry-set: evt=" , evt  );
            if ( loadedCheck == 0 ){
                loadedCheck = 1;
            }else if ( loadedCheck == 1 ){
                textResolve( textEntity );
            }
            textEntity.removeEventListener("geometry-set", checkGeometrySet );
        }
        textEntity.addEventListener("geometry-set", checkGeometrySet );

        // textEntity.addEventListener("geometry-set", function(evt){
        // 	console.log(" textEntity geometry-set: evt=" , evt , textEntity.object3D  );
        // 	textResolve( textEntity );
        // });

        textEntity.addEventListener("loaded", (evt) => {
            if (evt.target == evt.currentTarget){

                // console.log("VRFunc.js: _loadText loaded textEntity=" , textEntity.object3D, textEntity.object3D.parent.scale.x );

                // console.log("tttexttt", obj)
                // setTimeout(function(){
                // 	textEntity.setAttribute("cursor-listener", true ); //// fei add
                // }, 500 );

                let r = new THREE.Vector3();
                r.set(0,Math.PI, 0); 
                textEntity.object3D.rotation.setFromVector3(r);
                // textEntity.object3D.children[0].rotation.setFromVector3(r);
                // textEntity.object3D.children[0].position.x = -textEntity.object3D.children[0].position.x;
                // textEntity.object3D["makarObject"] = true; 
                
                if( isTempTextObj ){
                    //// isTempTextObj 是 YT(not supported)物件底下的文字物件 加上Attribute方便區別
                    textEntity.object3D["isTempTextObj"] = true;
                } else {
                    anchor.object3D["makarObject"] = true; 
                }

                if ( obj.behav ){  
                    anchor.object3D["behav"] = obj.behav ;

                    //// 載入時候建制「群組物件資料」「注視事件」
                    this.setObjectBehavAll( obj );
                }
                if(obj.behav_reference){  
                    anchor.object3D["behav_reference"] = obj.behav_reference ;
                }
                if (obj.main_type=="button"){
                    // textEntity.object3D["main_type"] = obj.main_type;  
                    anchor.object3D["main_type"] = obj.main_type;
                }

                if ( loadedCheck == 0 ){
                    loadedCheck = 1;
                }else if ( loadedCheck == 1 ){
                    textResolve( textEntity );
                }
                
            }
        });


        ///
        anchor.appendChild(textEntity);
        ///

        //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
        if ( obj.generalAttr.active == false ){
            anchor.setAttribute("visible", false);
            anchor.setAttribute('class', "unclickable" );
        }

        //20191227-start-thonsha-add
        // if(obj.behav_reference){  
        //     for(let i=0; i<obj.behav_reference.length;i++){
        //         if (obj.behav_reference[i].behav_type == 'Display'){
        //             // textEntity.setAttribute("visible", false);
        //             // textEntity.setAttribute('class', "unclickable" );
        //             anchor.setAttribute("visible", false);
        //             anchor.setAttribute('class', "unclickable" );
        //             break;
        //         }
        //     }
            
        // }
        //20191227-end-thonsha-add
        console.log(" VRFunc.js: _loadText: anchor= ", anchor.object3D , ", obj=", obj );
        if(obj.generalAttr.obj_parent_id){
            // textEntity.setAttribute("visible", false);
            // textEntity.setAttribute('class', "unclickable" );
            let timeoutID = setInterval( function () {
                let parent = document.getElementById(obj.generalAttr.obj_parent_id);
                // console.log("0 VRFunc.js: _loadText: parent= ", parent.object3D  );

                if (parent){ 
                    if(parent.object3D.children.length > 0){
                        parent.appendChild(anchor);
                        window.clearInterval(timeoutID);
                    } 
                }
            }, 100);
        }
        else{
            this.vrScene.appendChild(anchor);
            // this.vrScene.appendChild(textEntity);
        }
        
        // if (obj.main_type=="button"){
        // 	return textEntity;
        // }


    });

    return pText;

//20191204-end-thonsha-add
}

//// 載入「 2D 文字 」 
function loadText2D( obj, index, sceneObjNum, position=null, rotation=null, scale=null, isTempTextObj=false ){

    let pText2D = new Promise( ( text2DResolve , text2DReject ) => {

        //// 2022 1123 之後 3.3.8 版本上線， 2D 物件的尺寸需要版本相容
        //// 位置    縮放    尺寸   旋轉
        let rectP, rectSizeDelta, rectScale , rectR ; 

        //[start-20231103-howardhsu-add]//   
        let getObj2DInfo350 = () => {

            let tempInfo = {};
            //// 位置    縮放    尺寸   旋轉
            let rectP, rectSizeDelta, rectScale , rectR ; 
            if ( obj.transformAttr.rect_transform && Array.isArray( obj.transformAttr.rect_transform ) && obj.transformAttr.rect_transform.length > 0 ){

                if ( !Number.isFinite( this.selectedResolutionIndex )   ){
                    console.log(' _loadText2D: _getObj2DInfo350: error, missing _selectedResolutionIndex', this.selectedResolutionIndex );
                    this.selectedResolutionIndex = 0;
                }
                let selectedObj2DInfo = obj.transformAttr.rect_transform[ this.selectedResolutionIndex ];

                if ( selectedObj2DInfo.position && selectedObj2DInfo.size_delta && selectedObj2DInfo.rotation && selectedObj2DInfo.scale ){
                    rectP = selectedObj2DInfo.position.split(",").map( x =>  Number(x) ); 
                    rectSizeDelta = selectedObj2DInfo.size_delta.split(",").map( x =>  Number(x) ); 
                    rectScale = selectedObj2DInfo.scale.split(",").map( x =>  Number(x) ); 
                    rectR = selectedObj2DInfo.rotation.split(",").map( x =>  Number(x) );

                    let quaternionRotation = new THREE.Quaternion(parseFloat(rectR[0]), parseFloat(rectR[1]), parseFloat(rectR[2]), parseFloat(rectR[3]))
                    let eulerAngle = new THREE.Euler().setFromQuaternion( quaternionRotation, "YXZ");
                    let _rectR = new THREE.Vector3( eulerAngle.x ,  eulerAngle.y ,  eulerAngle.z );

                    //// 為了相容 ，把「旋轉資料」取代 「原本 rotation」
                    // rotation.z = b.z/Math.PI * 180 ;
                    _rectR.z =  -1 * _rectR.z

                    //// 為了相容 ，把「縮放資料」取代 「原本 scale」
                    rectScale.x = rectScale[0];
                    rectScale.y = rectScale[1];

                    tempInfo = {
                        rectP: rectP,
                        rectSizeDelta: rectSizeDelta,
                        rectScale: rectScale,
                        rectR: _rectR
                    }
                }
                
            }

            return tempInfo;
        }
        //[end-20231103-howardhsu-add]//

        if ( Object.keys( this.editor_version ).length == 4 ){
            let largeV  = Number( this.editor_version.v0 );
            let middleV = Number( this.editor_version.v1 );
            let smallV  = Number( this.editor_version.v2 );	
            
            let trans
            if(  largeV > 3 || 
                (largeV == 3 && middleV >= 5)
            ){  
                trans = getObj2DInfo350();
            } else {
                trans = getObj2DInfo350();
            }

            if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  && trans.rectR ){
                rectP = trans.rectP; 
                rectSizeDelta = trans.rectSizeDelta; 
                rectScale = trans.rectScale; 
                rectR = trans.rectR;
            }else{
                text2DResolve( false );
                return;
            }
            
        }else{
            let trans = getObj2DInfo350();
            if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  && trans.rectR ){
                rectP = trans.rectP; 
                rectSizeDelta = trans.rectSizeDelta; 
                rectScale = trans.rectScale; 
                rectR = trans.rectR;
            }else{
                text2DResolve( false );
                return;
            }
        }
        // console.log('_loadText2D: info: ', obj, position, rotation, scale);
        console.log('_loadText2D: info: _rectAll= ', obj.typeAttr.content, rectP, rectSizeDelta, rectScale , rectR );

        let width, height;
        let scaleRatioXY = this.scaleRatioXY;

        width  = rectSizeDelta[0] * scaleRatioXY;
        height = rectSizeDelta[1] * scaleRatioXY;
        
        console.log('_loadText2D: info: wh = ',  width , height , scaleRatioXY );

        let maxWords = 0 ;
        let textObjList = obj.typeAttr.content.split('\n');
        for( let i = 0; i < textObjList.length; i++ ){
            if ( textObjList[i].length > maxWords ){
                maxWords = textObjList[i].length;
            }
        }

        let ws = width/maxWords * 1.0 ;
        let hs = height/textObjList.length * 0.9;
        // let ms = 150 * scaleRatioXY ;
        let ms = 175 * scaleRatioXY ; //// 最大可以接受的大小，此數值只跟編輯器端 設定 有關

        //[start-20240314-renhaohsu-modify]//
        //// 特定比例下 文字為2個英文字(例如NO)時 會超出文字背板範圍 原本推測跟scaleRatioXY的係數有關 但看來不是 (應該是換行?
        // if(scaleRatioXY > 0.7){
        //     ms = 100 * scaleRatioXY
        // }
        //[end-20240314-renhaohsu-modify]//

        let fontsize = Math.min( ws , hs, ms );
        console.log(' ******** ' , obj.typeAttr.content, fontsize,maxWords , '[', ws, ',', width , ']', ', [', hs, ',', height , '], ' , ms );

        let rootObject = new THREE.Object3D();
        rootObject.makarType = "text2D";
                
        if ( obj.behav ){
            rootObject["behav"] = obj.behav ;
            
            //// 載入時候建制「群組物件資料」「注視事件」
            this.setObjectBehavAll( obj );
        }

        //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
        if ( obj.generalAttr.active == false ){
            rootObject.visible = false;
        }

        //// 假如物件本身帶有『事件參考』，同時是『顯示模型』，則判定起始為『不可見』
        // if (obj.behav_reference){
        //     rootObject.behav_reference = obj.behav_reference;
        //     for (let j = 0;j<obj.behav_reference.length; j++){
        //         if (obj.behav_reference[j].behav_type == "Display"  ){
        //             rootObject.visible = false;
        //         }
        //     }
        // }

        let textEntity = document.createElement('a-text');
        textEntity.object3D.renderOrder = index
        textEntity.setAttribute("geometry","primitive:plane; width: auto; height: auto; skipCache: true;");
        textEntity.setAttribute("material","opacity: 0.0 ; depthWrite:false; color:#000000; side:double;");


        let textList = obj.typeAttr.content.split('\n');
        let longestSplit = 0;
        const REGEX_CHINESE = /[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u;
        const isChinese = (str) => REGEX_CHINESE.test(str);
        for (let i = 0; i < textList.length;i++) {
            let textLength = 0;
            for (let j = 0; j <  textList[i].length; j++) {
                if(isChinese(textList[i][j])){  // chinese
                    textLength += 1.6;
                }
                else if(textList[i][j] == textList[i][j].toUpperCase() && textList[i][j] != textList[i][j].toLowerCase()){ // upper-case
                    textLength += 1;
                }
                else if(textList[i][j] == textList[i][j].toLowerCase() && textList[i][j] != textList[i][j].toUpperCase()){ // lower-case
                    // textLength += 0.85;
                    textLength += 1.0;
                }
                else if(!isNaN(textList[i][j] * 1)){ //numeric
                    textLength += 1;
                }
                else{ // other symbols
                    textLength += 1.25;
                }
                
            }
            // console.log( textList[i], textLength);
            if (textLength > longestSplit) longestSplit =textLength;
        }

        //[start-20231026-howardhsu-add]//
        // console.log("_loadText2D obj.generalAttr.obj_id", obj.generalAttr.obj_id)
        textEntity.setAttribute( "id", obj.generalAttr.obj_id );
        //[end-20231026-howardhsu-add]//

        textEntity.setAttribute("value", obj.typeAttr.content);
        textEntity.setAttribute("width",longestSplit*0.08)	// 4 for 0.46  per 0.115  20201027：這個數值目前沒有用處
        
        textEntity.setAttribute("width", width );
        textEntity.setAttribute("height", height );
        textEntity.setAttribute("fontsize", fontsize );
        
        textEntity.setAttribute("wrap-count",longestSplit); // 1 for 1    20201027：這個數值目前沒有用處
        textEntity.setAttribute("anchor","center");
        textEntity.setAttribute("align","left");
        textEntity.setAttribute("baseline","center");
        
        textEntity.setAttribute("backcolor", obj.typeAttr.back_color ); //// 這邊注意一重點，自己設定的 attribute 不能使用 『大寫英文』，否則aframe data內會找不到，參照 text物件
        textEntity.setAttribute("textcolor", obj.typeAttr.color ); //// 暫時沒有用，假如未來文字支援『透明度』功能時候會需要
        textEntity.setAttribute("side","double");

        let fontUrl = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/resource/fonts/";
        let fonts = [  fontUrl + "1-msdf.json", fontUrl + "2-msdf.json" , fontUrl + "3-msdf.json", fontUrl + "4-msdf.json", fontUrl + "5-msdf.json", 
                fontUrl + "6-msdf.json", fontUrl + "7-msdf.json" , fontUrl + "8-msdf.json", fontUrl + "9-msdf.json", fontUrl + "10-msdf.json", 
                fontUrl + "11-msdf.json", fontUrl + "12-msdf.json" ];
        // fonts = [ fontUrl + "1-msdf.json" ];
        textEntity.setAttribute("font", fonts );

        textEntity.setAttribute("negate","false");
        textEntity.setAttribute('crossorigin', 'anonymous');

        let rgb = obj.typeAttr.color.split(",");
        let color = new THREE.Color(parseFloat(rgb[0]),parseFloat(rgb[1]),parseFloat(rgb[2])); 
        textEntity.setAttribute("color", "#"+color.getHexString());

        let aTempDiv;
        let aTempScene;

        if( document.getElementById("aTempScene") && document.getElementById("aTempDiv") ){
            aTempScene = document.getElementById("aTempScene");
        }else{

            aTempDiv = document.createElement('div');
            aTempDiv.style.display = "none";

            aTempScene = document.createElement("a-scene");
            aTempScene.setAttribute("id", "aTempScene");
            aTempScene.setAttribute("embedded", "");
            
            document.body.appendChild( aTempDiv );
            aTempDiv.appendChild( aTempScene );

        }
        
        aTempScene.appendChild(textEntity);


        textEntity.addEventListener("geometry-set", function(evt){
            
            let textObject = textEntity.object3D;
            if ( textObject ){
                if ( textObject.children[2] ){
                    if ( textObject.children[2] ){

                    }
                }
                console.log( '_loadText2D: textEntity geometry-set: textObject=' , textObject , evt );

            }

            text2DResolve( rootObject );
        });

        textEntity.addEventListener("loaded", (evt)=>{
            // console.log(" **** textEntity loaded evt " , textEntity.object3D );
            
            let textObject = textEntity.object3D;
            // if (obj.main_type=="button"){
            // 	rootObject["main_type"] = obj.main_type;
            // }
            
            //// 測試看 文字底板
            // let plane = new THREE.Mesh(
            // 	new THREE.PlaneBufferGeometry( width , height , 0 ),
            // 	new THREE.MeshBasicMaterial( { color: 0x424a54 ,  side: THREE.DoubleSide,  transparent: true   } ) // DoubleSide, FrontSide
            // );
            // plane.position.z = -1;
            // rootObject.add( plane ); 

            rootObject.add(textObject);

            //// 2D 物件基底都要「反轉」
            textObject.rotation.x = Math.PI;

            //// 基礎大小調整
            const baseScale = 190
            textObject.scale.set( baseScale , baseScale , 1 );
            
            if(obj.generalAttr.obj_parent_id){
                textObject.obj_parent_id = obj.generalAttr.obj_parent_id;

                let setIntoParent = () => {
                    let isParentSet = false;
                    for (let i = 0; i<this.makarObjects2D.length; i++ ){
                        if ( this.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id  ){
                            isParentSet = true;
                        }
                    }

                    if ( isParentSet == false ){
                        setTimeout(setIntoParent, 200 );
                    }else{
                        for (let i = 0; i < this.makarObjects2D.length; i++){
                            if (this.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id){
                            
                                rootObject.add(textObject);

                                rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                                rootObject.translateY( -rectP[1]*scaleRatioXY ) ;

                                rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 
                                
                                //// 旋轉
                                // rootObject.rotateZ( -rotation.z /180*Math.PI);                            
                                rootObject.rotateZ( rectR.z )   

                                rootObject.scale.set( rectScale.x , rectScale.y , 1 );

                                rootObject["makarObject"] = true ;
                                rootObject["obj_id"] = obj.generalAttr.obj_id ;
                                rootObject["obj_parent_id"] = obj.generalAttr.obj_parent_id ;
                                this.makarObjects2D[i].add(rootObject);
                                
                                if( !isTempTextObj ){
                                    this.makarObjects2D.push(rootObject); 
                                } else {
                                    //// isTempTextObj: 是 YT(not supported)物件底下的文字物件 暫時不放到makarObjects 2D
                                }
                            
                                break;
                            }
                            
                        }
                    }
            
                }
                setIntoParent();
                
            }else{

                rootObject.add(textObject);

                rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                rootObject.translateY( -rectP[1]*scaleRatioXY ) ;

                // // translate the plane lower, will not be smaller because the camera is OrthographicCamera, but make it must behind the default texture                
                rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 

                // //// rotation only at z direction
                // rootObject.rotateZ( -rotation.z /180*Math.PI);                    
                rootObject.rotateZ( rectR.z )

                rootObject.scale.set( rectScale.x , rectScale.y , 1 );
                
                rootObject["makarObject"] = true ;
                rootObject["obj_id"] = obj.generalAttr.obj_id ;

                if( !isTempTextObj ){
                    this.makarObjects2D.push(rootObject); 
                } else {
                    //// isTempTextObj: 是 YT(not supported)物件底下的文字物件 暫時不放到makarObjects 2D
                }

                this.scene2D.add( rootObject );

            }

            // text2DResolve( rootObject );

        })

        // text2DResolve( true );

    });

    return pText2D;

}    

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/VideoModule.js":
/*!*************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/VideoModule.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UnMutedAndPlayAllVisibleVideo: () => (/* binding */ UnMutedAndPlayAllVisibleVideo),
/* harmony export */   loadVideo: () => (/* binding */ loadVideo),
/* harmony export */   loadVideo2D: () => (/* binding */ loadVideo2D),
/* harmony export */   loadYouTubeNotSupport: () => (/* binding */ loadYouTubeNotSupport),
/* harmony export */   loadYouTubeNotSupport2D: () => (/* binding */ loadYouTubeNotSupport2D),
/* harmony export */   mute2dVideos: () => (/* binding */ mute2dVideos),
/* harmony export */   mute3dVideos: () => (/* binding */ mute3dVideos),
/* harmony export */   pause2dVideos: () => (/* binding */ pause2dVideos),
/* harmony export */   pause3dVideos: () => (/* binding */ pause3dVideos),
/* harmony export */   unmute2dVideos: () => (/* binding */ unmute2dVideos),
/* harmony export */   unmute3dVideos: () => (/* binding */ unmute3dVideos)
/* harmony export */ });
/* harmony import */ var _vrUtility_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vrUtility.js */ "./js/VRMain/version3_5/vrUtility.js");
/* harmony import */ var _setTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./setTransform.js */ "./js/VRMain/version3_5/vrObjectModules/setTransform.js");
/* harmony import */ var _GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GLTFModelModule.js */ "./js/VRMain/version3_5/vrObjectModules/GLTFModelModule.js");
/* harmony import */ var _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../MakarWebXRVersionControl.js */ "./js/VRMain/version3_5/MakarWebXRVersionControl.js");





function loadVideo( obj, position, rotation, scale ) {	
    let self = this
    let pVideo = new Promise( function( videoResolve ){

        ;(0,_vrUtility_js__WEBPACK_IMPORTED_MODULE_0__.UrlExists)( obj.res_url , function( retStatus ){
            //// 先檢查「影片物件網址是否存在」，否的話，載入「問號模型物件」
            if ( retStatus == true ){
                let assets = document.getElementById("makarAssets");

                var mp4Video, mp4Texture ;
        
                mp4Video = document.createElement('video');
                mp4Video.src = obj.res_url; // url, "Data/makarVRDemo.mp4"
                mp4Video.playsInline = true;
                mp4Video.autoplay = true;
                //thonsha add
                mp4Video.loop = true;
                //thonsha add           

                mp4Video.setAttribute('crossorigin', 'anonymous');
                mp4Video.setAttribute("id", obj.generalAttr.obj_id+"_"+obj.res_id+"_"+self.loadSceneCount );

                assets.appendChild(mp4Video); ////// add video into a-assets

                //// 只是為了方便safari debug
                mp4Video["name4debug"] = obj.generalAttr.obj_name; 

                mp4Video.setAttribute("preload", "auto");

                
                //// 開發需要，先將所有影片禁音
                // mp4Video.muted = true;
                
                if (window.Browser){
                    if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location )  ){
                    // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                        mp4Video.muted = true;
                    }
                    
                    if (window.Browser.mobile == true){
                        mp4Video.muted = true;
                        // mp4Video.currentTime = 0.1
                        mp4Video.play()
                    }
                }
                
                // mp4Texture = new THREE.VideoTexture( mp4Video );
                // mp4Texture.minFilter = THREE.LinearFilter;
                // mp4Texture.magFilter = THREE.LinearFilter;
                // //// mp4Texture.flipY = false;
                // mp4Texture.format = THREE.RGBFormat;

                mp4Video.onloadedmetadata = function() {
                    var videoWidth , videoHeight;
                    if (mp4Video.videoWidth >= mp4Video.videoHeight){
                        videoWidth = 1;
                        videoHeight = 1*mp4Video.videoHeight/mp4Video.videoWidth;
                    }else{
                        videoWidth = 1*mp4Video.videoWidth/mp4Video.videoHeight;
                        videoHeight = 1;
                    }

                    // console.log("VRFunc.js: video WH=", mp4Video.videoWidth , mp4Video.videoHeight);
                    let videoPlane = document.createElement("a-video");
                
                    //[start-20240408-renhaohsu-modify]//
                    let chromaKey, slope, threshold, transparentBehav;                    
                    //20191108-start-thonsha-add
                    let transparentVideo = false
                    if(makarUserData.scenesData.scenes[self.sceneIndex].behav && Array.isArray(makarUserData.scenesData.scenes[self.sceneIndex].behav)){

                        transparentBehav = makarUserData.scenesData.scenes[self.sceneIndex].behav.find(b => b.obj_id == obj.generalAttr.obj_id && b.behav_type == "Transparent")
                        if(transparentBehav){
                            console.log("%c VideoModule.js _loadVideo: transparentBehav=", 'color:BlanchedAlmond;', transparentBehav)
                            transparentVideo = true;
                            [chromaKey, slope, threshold] = [transparentBehav.color, transparentBehav.slope, transparentBehav.threshold]
                        }
                    }
                    //[end-20240408-renhaohsu-modify]//

                    if (transparentVideo && transparentBehav){
                        let rgba = chromaKey.split(",");
                        var color = new THREE.Color(parseFloat(rgba[0]),parseFloat(rgba[1]),parseFloat(rgba[2]));

                        if (transparentBehav.mode == 'RGB' || !transparentBehav.mode){
                            videoPlane.setAttribute( "material", "shader: chromaKey; color: #"+color.getHexString()+";transparent: true; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";" ); //// thonsha add shader
                        }
                        else if (transparentBehav.mode == 'HSV'){
                            // let HSV = transparentBehav.color.split(",");
                            // let keyH = parseFloat(HSV[0]);
                            // let keyS = parseFloat(HSV[1]);
                            // let keyV = parseFloat(HSV[2]);

                            //[start-20240408-renhaohsu-modify]//
                            //// rgb2hsv source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620
                            function rgb2hsv(r,g,b) {
                                let v=Math.max(r,g,b), c=v-Math.min(r,g,b);
                                let h= c && ((v==r) ? (g-b)/c : ((v==g) ? 2+(b-r)/c : 4+(r-g)/c)); 
                                return [60*(h<0?h+6:h), v&&c/v, v];
                            }
                            
                            let _hsv = rgb2hsv( parseFloat(rgba[0]), parseFloat(rgba[1]), parseFloat(rgba[2]) )
                            _hsv[0] /= 360;
                            console.log(`rgb: ${rgba} ,\n _hsv: (${ _hsv })`)
                            //[end-20240408-renhaohsu-modify]//

                            // console.log("VRFunc.js: video HSV---------------" , keyH , keyS , keyV , transparentBehav.hue , transparentBehav.saturation , transparentBehav.brightness  );
                            // videoPlane.setAttribute( "material", "shader: HSVMatting; transparent: true; _keyingColorH:"+keyH+"; _keyingColorS:"+keyS+"; _keyingColorV:"+keyV+"; _deltaH:"+transparentBehav.hue+"; _deltaS:"+transparentBehav.saturation+"; _deltaV:"+transparentBehav.brightness+";" ); //// thonsha add shader
                            videoPlane.setAttribute( "material", "shader: HSVMatting; transparent: true; _keyingColorH:"+_hsv[0]+"; _keyingColorS:"+_hsv[1]+"; _keyingColorV:"+_hsv[2]+"; _deltaH:"+transparentBehav.hue+"; _deltaS:"+transparentBehav.saturation+"; _deltaV:"+transparentBehav.brightness+";" ); //// thonsha add shader
                        }
                        //20191126-end-thonsha-mod
                    }
                    else{
                        videoPlane.setAttribute( "material", "side:double; opacity: 1.0; transparent: true; " ); //// it is work
                    }
                    //20191108-end-thonsha-add

                    if (obj.behav){
                        if (obj.behav.length==0 && transparentVideo){
                            videoPlane.setAttribute('class', "unclickable" ); //// fei add
                        }
                        else{
                            videoPlane.setAttribute('class', "clickable" );
                        }
                    }
                    //[start-20231229-renhaohsu-add]//
                    else if (obj.generalAttr.logic){
                        videoPlane.setAttribute('class', "clickable" ); 
                    }
                    //[end-20231229-renhaohsu-add]//
                    else{
                        videoPlane.setAttribute('class', "unclickable" ); //// fei add
                    }                    

                    videoPlane.setAttribute( "id", obj.generalAttr.obj_id );//// fei add 
                    videoPlane.setAttribute("src", "#"+obj.generalAttr.obj_id+"_"+obj.res_id+"_"+self.loadSceneCount ); //  

                    videoPlane.mp4Video = mp4Video;
                    
                    // videoPlane.setAttribute("src", obj.res_url);

                    // position = new THREE.Vector3( 1.5 , 0.0 , 4.0 ); ////// set for test
                    // rotation = new THREE.Vector3( 0 , 0 , 0 ); ////// set for test
                    // scale.multiply( new THREE.Vector3(videoWidth, videoHeight, 1) ); ////// need calculate from elements paraemter.

                    //// 假如『原始圖片像素』高於『進場景材質大小』，就需要『縮小』，原始『各向異性』設為 1，以下流程改設為最高
                    let maxAnisotropy = self.vrScene.renderer.capabilities.getMaxAnisotropy();
                    videoPlane.addEventListener("materialtextureloaded", function(evt){
                        console.log("VRFunc.js: _loadVideo: _materialtextureloaded: videoPlane = " , videoPlane.object3D , evt );
                        evt.detail.texture.anisotropy = maxAnisotropy;
                        evt.detail.texture.needsUpdate = true;
                    });

                    (0,_setTransform_js__WEBPACK_IMPORTED_MODULE_1__.setTransform)(videoPlane, position, rotation, scale);
                    videoPlane.addEventListener("loaded", function(evt){
                    
                        if (evt.target == evt.currentTarget){

                            // setTimeout(function(){
                            // 	videoPlane.setAttribute("cursor-listener", true ); //// fei add
                            // }, 500 );

                            // videoPlane.object3D.children[0].scale.multiply(new THREE.Vector3(videoWidth, videoHeight, 1));
                            videoPlane.object3D.children[0].scale.set(videoWidth , videoHeight, 1 );
                            
                            //[start-20230809-howardhsu-modify]//
                            let r = new THREE.Vector3();
                            r.set(0, -1 * Math.PI, 0);
                            videoPlane.object3D.children[0].rotation.setFromVector3(r);
                            //[end-20230809-howardhsu-modify]//

                            // var r = videoPlane.object3D.children[0].rotation.toVector3();
                            // r.add( new THREE.Vector3(0,Math.PI, 0) );
                            // videoPlane.object3D.children[0].rotation.setFromVector3(r);
                            videoPlane.object3D["makarObject"] = true; 
                            videoPlane.object3D["makarType"] = 'video'; 
            
                            //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
                            const tempBehav = {
                                behav_type : "videoTogglePlayPause",
                                // delay : false,
                                // is_front : true,
                                obj_id : obj.generalAttr.obj_id,
                                // toward_id : "7e30d242-3485-4f2f-8e61-e55ff9723e44",
                                // trigger_obj_id : "d60e0385-9037-41dd-a899-d1479293b1db",
                                // trigger_type : "Click"
                            }

                            if ( obj.behav ){
                                videoPlane.object3D["behav"] = obj.behav ;
                                videoPlane.object3D["behav"].push(tempBehav)

                                //// 載入時候建制「群組物件資料」「注視事件」
                                self.setObjectBehavAll( obj );
                            } else {
                                //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
                                videoPlane.object3D["behav"] = [ tempBehav ]
                            }

                            //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
                            videoPlane.setAttribute('class', "clickable" )


                            if(obj.behav_reference){
                                videoPlane.object3D["behav_reference"] = obj.behav_reference ;
                            }

                            videoResolve( videoPlane );
                        }
                    });
                    
                    self.makarObjects.push( videoPlane );

                    //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
                    if ( obj.generalAttr.active == false ){
                        videoPlane.setAttribute("visible", false);
                        videoPlane.setAttribute('class', "unclickable" );
                    }

                    //20191227-start-thonsha-mod
                    // let videoBehavRef = false;
                    // if(obj.behav_reference){
                    //     for(let i=0; i<obj.behav_reference.length;i++){
                    //         // if (obj.behav_reference[i].behav_name == 'Media'){
                    //         if (obj.behav_reference[i].behav_type == 'Display'){
                    //             videoBehavRef = true;
                    //             videoPlane.setAttribute("visible", false);
                    //             videoPlane.setAttribute('class', "unclickable" );
                    //             break;
                    //         }
                    //     }
                        
                    // }
                    //20191227-end-thonsha-mod

                    //20191029-start-thonhsa-add
                    if(obj.generalAttr.obj_parent_id){
                        // videoPlane.setAttribute("visible", false);
                        // videoPlane.setAttribute('class', "unclickable" );
                        mp4Video.autoplay = false;
                        let timeoutID = setInterval( function () {
                            let parent = document.getElementById(obj.generalAttr.obj_parent_id);
                            if (parent){
                                if(parent.object3D.children.length > 0){
                                    parent.appendChild(videoPlane);
                                    window.clearInterval(timeoutID);
                                    //// deal the behavior or not.
                                    parent.addEventListener("child-attached", function(el){
                                        console.log("VRFunc.js: VRController: _loadVideo,: parent child-attached, el=", el );

                                        //// 假如有掛載「邏輯功能」，需要禁止一般事件操控，在這邊無條件暫停影片
                                        if ( obj.generalAttr.logic ){

                                            videoPlane.blockly = obj.generalAttr.logic;
                                            mp4Video.pause();
                                            mp4Video.currentTime = 0;

                                        } else {

                                            let parentVisible = true;
                                            videoPlane.object3D.traverseAncestors( function(parent) {
                                                if (parent.type != "Scene"){
                                                    // console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not Scene parent=", parent );
                                                    if (parent.visible == false){
                                                        parentVisible = false;
                                                    }
                                                } else {
                                                    // if (parentVisible == true && videoPlane.object3D.visible == true && videoBehavRef == false ){
                                                    if (parentVisible == true && videoPlane.object3D.visible == true ){
                                                        console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: all parent visible true=", videoPlane.object3D );
                                                        
                                                        mp4Video.autoplay = true;
                                                        //[start-20240611-renhaohsu-mod]//
                                                        //// seems like if a video object is a child, should call play() 
                                                        mp4Video.play();

                                                        //// set video attr according to the obj in makar with autoplay, volume, loop
                                                        checkVideoTypeAttr(obj, mp4Video)
                                                        //[end-20240611-renhaohsu-mod]//                     
                                                    
                                                        //// 提醒用戶點擊開啟聲音
                                                        if (window.Browser){
                                                            if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                                                            // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                                                dealVideoMuted( mp4Video, true );
                                                            } else if (window.Browser.mobile == true){
                                                                //// safari 以外的手機瀏覽器
                                                                dealVideoMuted( mp4Video, false );
                                                            }
                                                        }

                                                    }else{
                                                        console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not all parent visible true=", parentVisible, videoPlane.object3D.visible );
                                                        //// rootObject.visible = false; 
                                                        mp4Video.muted = false;
                                                        mp4Video.autoplay = false;
                                                        mp4Video.pause();
                                                        mp4Video.currentTime = 0;

                                                    }
                                                }
                                            });

                                        }
                                    });

                                } 
                            }
                        }, 1);
                    }
                    else{

                        if ( obj.generalAttr.logic ){
                            videoPlane.blockly = obj.generalAttr.logic;
                            mp4Video.pause();
                            mp4Video.currentTime = 0;
                        } else {
                            mp4Video.autoplay = true;
                            mp4Video.play();//// this is not necessary 

                            //[start-20230815-howardhsu-add]//
                            //// set video attr according to the obj in makar with autoplay, volume, loop
                            checkVideoTypeAttr(obj, mp4Video)
                            //[end-20230815-howardhsu-add]//                     
                            
                            //// 提醒用戶點擊開啟聲音
                            if (window.Browser){
                                if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                                // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                    dealVideoMuted( mp4Video, true );
                                } else if (window.Browser.mobile == true){
                                    //// safari 以外的手機瀏覽器
                                    dealVideoMuted( mp4Video, false );
                                }
                            }
                            
                        }
                        
                        self.vrScene.appendChild(videoPlane);
                    }
                    //20191029-end-thonhsa-add
                

                    // }, 1 );
                    // self.vrScene.appendChild(videoPlane);

                    // console.log("VRFunc.js: VRController: loadVideo, videoPlane=", videoPlane );
                }


            }else{

                console.log("VRFunc.js: _loadVideo , obj url not exist ", obj );
                
                obj.main_type = 'model';
                obj.sub_type = 'glb';
                obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";
                
                //[start-20230726-howardhsu-modify]//                               
                (0,_GLTFModelModule_js__WEBPACK_IMPORTED_MODULE_2__.loadGLTFModel)( obj , position, rotation, scale , self.cubeTex )
                //[end-20230726-howardhsu-modify]//

                videoResolve( 1 );

            }
        });
        

    });


    return pVideo;
    
}

//// set video attr according to the obj in makar with autoplay, volume, loop
//// 自動播放、音量、循環
function checkVideoTypeAttr(obj, mp4Video, videoBehavRef=false){
    // console.log("checkVideoTypeAttr obj=", obj)

    //[start-20230807-howardhsu-add]//
    //// 這要去確認app的行為
    if ( obj.generalAttr.active == false || videoBehavRef){
        mp4Video.autoplay = false
        mp4Video.pause();
        mp4Video.currentTime = 0;
    }
    //[end-20230807-howardhsu-add]//       
        
    //[start-20230811-howardhsu-add]//
    else if(obj.typeAttr){       
        //// 20240516 沒看到 is_play 這個key    
        // if(obj.typeAttr.is_play != undefined){ 
        //     mp4Video.autoplay = obj.typeAttr.is_play;
        //     if( obj.typeAttr.is_play == false ){                                        
        //         mp4Video.pause();
        //         mp4Video.currentTime = 0;
        //     }
        // }    
        if(obj.typeAttr.is_loop != undefined){ 
            mp4Video.loop = obj.typeAttr.is_loop;

            //// 多影片在手機chrome上不會loop 多影片的情況暫時以靜音來讓它繼續播放
            if (window.Browser){
                if (window.Browser.mobile == true && window.Browser.name != "safari" ){
                    //// safari 以外的手機瀏覽器
                    if(obj.typeAttr.is_loop){
                        mp4Video.loop = false; 
                        // console.log("影片還沒結束", obj.generalAttr.obj_name)
                        mp4Video.addEventListener('ended', function() { 
                            // console.log("影片結束", mp4Video.name4debug)
                            //// 20240617 renhaohsu 測試chrome看似是每次重播時都要先靜音才能播      
                            if( document.getElementsByTagName('a-video').length + window.vrController.makarObjects2D.filter( o=>o.makarType == "video2D").length == 1 ){
                                mp4Video.muted = false
                                mp4Video.currentTime=0.1;
                                mp4Video.play(); 
                            } else {
                                // console.log("你播ㄚㄚㄚㄚ")
                                mp4Video.muted = true
                                mp4Video.currentTime=0.1;
                                mp4Video.play()
                                UnMutedAndPlayAllVisibleVideo()
                            }
                        }, false);
                    }
                }
            }

        }    
        if(obj.typeAttr.volume  != undefined){ 
            mp4Video.volume = obj.typeAttr.volume;
            // if(obj.typeAttr.volume == 0){
            //     // console.log("音量是0會被瀏覽器自動暫停?!")  //// 20240611 test by renhaohsu
            //     mp4Video.play()
            // }
        }
    }
    //[end-20230811-howardhsu-add]//             
}


//// 注意，當前影片、聲音是共用「確認面板」
//// ios safari, mobile browser(例如chrome) 可能呼叫到這
//// 處理影片物件是否播放聲音
function dealVideoMuted( video, isSafari=false ){      
    console.log("dealVideoMuted")  

    //// html確認面板"允許聲音播放"
    let clickToPlayAudio = document.getElementById("clickToPlayAudio");

    clickToPlayAudio.onclick = function(){
        clickToPlayAudio.setAttribute("didUserClick", true)
        clickToPlayAudio.style.display = "none";
        clickToPlayAudio.onclick = null;
        window.allowAudioClicked = true;
        
        if( isSafari ){
            //// safari: 讓全部影片靜音但播放，然後挑一個影片發出聲音
            mute3dVideos(true)
            mute2dVideos(true)
            UnMutedAndPlayAllVisibleVideo();
        } else {
            //// chrome(或其他): 需要user互動後才能發出聲音
            console.log("isSafari=", isSafari)
            unmute3dVideos(true)
            unmute2dVideos(true)
        }
    }

    //// 初次載入, 跳轉場景 時影片聲音的處理
    if( !clickToPlayAudio.getAttribute("didUserClick") ){
        //// user還沒click"允許聲音播放" (頁面初次載入)
        clickToPlayAudio.style.display = "block";
        
    } else {        
        console.log("user已允許聲音播放 (跳轉場景)")
        //// user已"允許聲音播放" (跳轉場景)
        // if( isSafari ){
            mute3dVideos(true)
            mute2dVideos(true)
            UnMutedAndPlayAllVisibleVideo();
        // } else {
        //  ////   20240618 renhaohsu觀察到在chrome放5個影片物件 會出現有些影片不播放的情形 但他們明明走同樣的code...
        //     console.log("isSafari=", isSafari)
        //     unmute3dVideos(true, true)
        //     unmute2dVideos(true, true)
        // }
    }
}

//// 為了 iOS 無法同時播放「超過一個有聲音的影片」，在場景中尋找是否有「當前可見的影片」，只能有一隻切換為切換為「有聲音」
//// 流程分兩種： 1. 點擊觸發「顯示任意物件」 2. 點擊觸發「關閉任意物件」 
//// 確定是否傳入的物件為「影片」，假如是的話，以「此影片」為主，開啟聲音
////
function UnMutedAndPlayAllVisibleVideo( targetVideo_in ) {
    //// 確定是否傳入的物件為「影片」，假如是的話，以「此影片」為主，開啟聲音
    let targetVideo;
    let targetVideo2D;
    if (targetVideo_in){
        if ( targetVideo_in.localName == 'a-video' ){
            //// 3D影片物件
            targetVideo = targetVideo_in;
        } else if ( targetVideo_in.makarType == "video2D" ){
            //// 2D影片物件
            targetVideo2D = targetVideo_in;
        }
    }        

    //// 取得「所有影片」  3D
    let aVideos = document.getElementsByTagName('a-video');
    console.log("VRFunc.js: _UnMutedAndPlayAllVideo: aVideos.length=", aVideos.length );

    //// 取得「所有影片」  2D
    let videos2D = window.vrController.makarObjects2D

    //// 靜音所有2D影片物件
    // mute2dVideos()

    if ( targetVideo ){
        //// 假如有「要顯示的影片」 3D影片物件
        for ( let i = 0; i < aVideos.length; i++ ){

            let videoPlane = aVideos[i];
            let mp4Video = aVideos[i].mp4Video;

            //// 開啟此影片聲音
            if ( videoPlane == targetVideo ){

                targetVideo.mp4Video.muted = false;
                targetVideo.mp4Video.autoplay = true;
                targetVideo.mp4Video.play();
                self.safariUnMutedVideo = targetVideo;

            }else{

                let parentVisible = true;
                videoPlane.object3D.traverseAncestors( function(parent) {
                    if (parent.type != "Scene"){
                        // console.log("VRFunc.js: VRController: _UnMutedAndPlayAllVideo,: traverseAncestors: not Scene parent=", parent );
                        if (parent.visible == false){
                            parentVisible = false;
                        }
                    } else {

                        console.log("VRFunc.js: _UnMutedAndPlayAllVideo: videoPlane =", i, parentVisible , videoPlane.object3D.visible, videoPlane );

                        //// 這邊選定影片改為「靜音」，不論是否是「邏輯操控」
                        if (parentVisible == true && videoPlane.object3D.visible == true && mp4Video.volume!=0 ){
                            
                            mp4Video.muted = true;
                            mp4Video.autoplay = true;
                            mp4Video.play();

                        }

                        //// 我擔心「先後順序會影響」，所以多次將「此影片」執行「切換為非靜音」
                        targetVideo.mp4Video.muted = false;
                        targetVideo.mp4Video.autoplay = true;
                        targetVideo.mp4Video.play();

                    }
                });

            }

        }

    } else if ( !targetVideo && targetVideo2D ){
        //// 傳入的是2D影片物件 
        
        //// 把3D影片 可見的 全部靜音
        mute3dVideos()

        //// 檢查該2D影片 若可見就解除靜音
        let parentVisible2D = true;
        targetVideo2D.traverseAncestors( function(parent) {
            if (parent.type != "Scene"){
                // console.log("VRFunc.js: VRController: _UnMutedAndPlayAllVideo,: traverseAncestors: not Scene parent=", parent );
                if (parent.visible == false){
                    parentVisible2D = false;
                }
            } else {
                //// 假如「已經找到場景本體」、「母體都可見」、「本體也可見」 ，解除靜音
                if (parentVisible2D == true && targetVideo2D.visible == true ){
                    //// 錯誤處理  (理論上影片2D物件 都該有以下這些)
                    if( targetVideo2D.makarType != "targetVideo2D" ){ return; }
                    if( targetVideo2D.children.length == 0 ){ return; }
                    if( !targetVideo2D.children[0].material ){ return; }
                    if( !targetVideo2D.children[0].material.map ){ return; }
                    if( !targetVideo2D.children[0].material.map.image ){ return; }

                    if( targetVideo2D.children[0].material.map.image.tagName == "VIDEO"){
                        const video = targetVideo2D.children[0].material.map.image
                        if(video && video.volume!=0){
                            video.muted = false
                            video.autoplay = true;
                            self.safariUnMutedVideo = targetVideo2D;
                        }
                    }
                }
            }
        });

    } else if ( !targetVideo && !targetVideo2D ){
        //// 假如沒有「傳入影片」，則挑選一隻「改為非靜音」，其他隻都保持靜音
        //// 挑選方式尚未決定
        // console.log("應該是進這裡了才對")

        let setVideoUnMuted = false;

        for ( let i = 0; i < aVideos.length; i++ ){

            let videoPlane = aVideos[i];
            let mp4Video = aVideos[i].mp4Video;

            //// 只挑選正在播放的影片
            const isVideoPlaying = (material) => !!(material.currentTime >= 0 && !material.paused && !material.ended && material.readyState > 2);
            if( !isVideoPlaying(mp4Video) ){ 
                console.log("mp4Video", isVideoPlaying(mp4Video))
                continue;
            }

            let parentVisible = true;
            videoPlane.object3D.traverseAncestors( function(parent) {
                if (parent.type != "Scene"){
                    // console.log("VRFunc.js: VRController: _UnMutedAndPlayAllVideo,: traverseAncestors: not Scene parent=", parent );
                    if (parent.visible == false){
                        parentVisible = false;
                    }
                } else {
                    //// 假如「已經找到場景本體」、「母體都可見」、「本體也可見」、「尚未設定一隻影片有聲音」，則設定「此影片」為「有聲音」，同時紀錄「已經設定過」

                    console.log("VRFunc.js: _UnMutedAndPlayAllVideo: videoPlane =", i, parentVisible , videoPlane.object3D.visible, videoPlane );

                    //// 這邊注意，要撇除「邏輯控制的影片」
                    if (parentVisible == true && videoPlane.object3D.visible == true && !videoPlane.blockly && mp4Video.volume!=0 ){
                        
                        if ( setVideoUnMuted == false ){
                            console.log("VRFunc.js: _UnMutedAndPlayAllVideo: all parent visible true , _setVideoUnMuted false ", videoPlane.object3D.name4debug );
                        
                            mp4Video.muted = false;
                            mp4Video.autoplay = true;

                            //// 正在播放且沒有被user按暫停
                            const isVideoPlaying = (video) => !!(video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2);

                            //// 跳轉場景時的影片可能還沒播 但可以播放 (不是被user暫停的)
                            const isVideoReadyToPlay = (video) => !!(video.currentTime >= 0 && !video.paused && !video.ended && video.readyState >= 1);

                            if(mp4Video && (isVideoPlaying(mp4Video) || isVideoReadyToPlay(mp4Video)) && mp4Video.volume!=0 ){
                                mp4Video.play();
                            }
                            
                            setVideoUnMuted = true;
                            self.safariUnMutedVideo = videoPlane;
                        
                        } else {
                            console.log("VRFunc.js: _UnMutedAndPlayAllVideo: all parent visible true, _setVideoUnMuted true", videoPlane.object3D );
                            if(mp4Video.volume!=0){
                                mp4Video.muted = true;
                                mp4Video.autoplay = true;

                                //// 理論上此影片已正在播放 只是為了保險多讓呼叫一下play
                                const isVideoPlaying = (video) => !!(video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2);
                                if(isVideoPlaying(mp4Video)){
                                    mp4Video.play();
                                }
                            }
                        }
                    }

                }
            });	

        }

        //// 如果沒有3D影片物件 找1個 "正在播放的2D影片" 解除靜音
        if(aVideos.length == 0 || setVideoUnMuted==false){
            // console.log("沒有3D影片物件或不合條件") 
            videos2D.forEach( video2d =>{
                let parentVisible2D = true;
                video2d.traverseAncestors( function(parent) {
                    if (parent.type != "Scene"){
                        // console.log("VRFunc.js: VRController: _UnMutedAndPlayAllVideo,: traverseAncestors: not Scene parent=", parent );
                        if (parent.visible == false){
                            parentVisible2D = false;
                        }
                    } else {
                        //// 假如「已經找到場景本體」、「母體都可見」、「本體也可見」、「尚未設定一隻影片有聲音」，則設定「此影片」為「有聲音」，同時紀錄「已經設定過」
                        if (parentVisible2D == true && video2d.visible == true && setVideoUnMuted == false ){
                            //// 雖然不應該出現 makarType 已是 video2D 的影片2D物件卻沒有以下這些，但還是寫一下錯誤處理
                            if( video2d.makarType != "video2D" ){ return; }
                            if( video2d.children.length == 0 ){ return; }
                            if( !video2d.children[0].material ){ return; }
                            if( !video2d.children[0].material.map ){ return; }
                            if( !video2d.children[0].material.map.image ){ return; }

                            if( video2d.children[0].material.map.image.tagName == "VIDEO"){
                                const video = video2d.children[0].material.map.image

                                //// 正在播放且沒有被user按暫停
                                const isVideoPlaying = (video) => !!(video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2);

                                //// 跳轉場景時的影片可能還沒播 但可以播放 (不是被user暫停的)
                                const isVideoReadyToPlay = (video) => !!(video.currentTime >= 0 && !video.paused && !video.ended && video.readyState >= 1);

                                if(video && (isVideoPlaying(video) || isVideoReadyToPlay(video)) && video.volume!=0 ){
                                    // console.log("播一下聲音阿 2d", video.name4debug );
                                    video.muted = false
                                    video.autoplay = true;

                                    // const isVideoPlaying = (video) => !!(video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2);
                                    // if(!isVideoPlaying){
                                        video.play()
                                    // }
                            
                                    setVideoUnMuted = true;
                                    self.safariUnMutedVideo = video2d;
                                } else {
                                    video.muted = true
                                    video.autoplay = true;  
                                    // const isVideoPlaying = (video) => !!(video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2);
                                    // if(!isVideoPlaying){
                                        video.play()
                                    // }
                                }
                            }
                        }
                    }
                });
            })
        
        }

    }

}

//// for safari: 20240612 autoplay+muted失效, 先靜音全部、播放全部 再呼叫 UnMutedAndPlayAllVisibleVideo() 給它挑一個影片解除靜音
function mute2dVideos(playVideo=false){
    //// 取得「所有影片」  2D
    let videos2D = window.vrController.makarObjects2D

    //// 靜音所有2D影片物件
    videos2D.forEach( video2d =>{
        //// 雖然不應該出現 makarType 已是 video2D 的影片2D物件卻沒有以下這些，但還是寫一下錯誤處理
        if( video2d.makarType != "video2D" ){ return; }
        if( video2d.children.length == 0 ){ return; }
        if( !video2d.children[0].material ){ return; }
        if( !video2d.children[0].material.map ){ return; }
        if( !video2d.children[0].material.map.image ){ return; }
        
        if( video2d.children[0].material.map.image.tagName == "VIDEO" ){
            const video = video2d.children[0].material.map.image
            if(video){
                // console.log("靜音2D影片", video)
                video.muted = true
                if(playVideo){
                    video.play()
                }
            }
        }
    })
}

//// 3D影片物件需要特地再全部呼叫一次play
function mute3dVideos(playVideo=false){
    //// 取得「所有影片」  3D
    let aVideos = document.getElementsByTagName('a-video');

    //// 把3D影片 可見的 全部靜音
    Array.from(aVideos).forEach( videoPlane => {
        let mp4Video = videoPlane.mp4Video;

        let parentVisible = true;
        videoPlane.object3D.traverseAncestors( function(parent) {
            if (parent.type != "Scene"){
                if (parent.visible == false){
                    parentVisible = false;
                }
            } else {
                //// 這邊注意，要撇除「邏輯控制的影片」      20240611 v3.5要確認一下viewer是否還是如此
                if (parentVisible == true && videoPlane.object3D.visible == true && !videoPlane.blockly ){
                    mp4Video.muted = true;
                    if(playVideo){
                        console.log("拜託播阿", mp4Video.name4debug)
                        // mp4Video.currentTime = 0
                        mp4Video.play()
                        mp4Video.muted = false
                    }
                }
            }
        });	
    })
}


//// for safari: 20240612 autoplay+muted失效, 先靜音全部、播放全部 再呼叫 UnMutedAndPlayAllVisibleVideo() 給它挑一個影片解除靜音
function unmute2dVideos(playVideo=false, playFromStart=false){
    //// 取得「所有影片」  2D
    let videos2D = window.vrController.makarObjects2D

    //// 靜音所有2D影片物件
    videos2D.forEach( video2d =>{
        //// 雖然不應該出現 makarType 已是 video2D 的影片2D物件卻沒有以下這些，但還是寫一下錯誤處理
        if( video2d.makarType != "video2D" ){ return; }
        if( video2d.children.length == 0 ){ return; }
        if( !video2d.children[0].material ){ return; }
        if( !video2d.children[0].material.map ){ return; }
        if( !video2d.children[0].material.map.image ){ return; }
        
        if( video2d.children[0].material.map.image.tagName == "VIDEO" ){
            const video = video2d.children[0].material.map.image
            if(video){
                let parentVisible = true;
                video2d.traverseAncestors( function(parent) {
                    if (parent.type != "Scene"){
                        if (parent.visible == false){
                            parentVisible = false;
                        }
                    } else {
                        //// 這邊注意，要撇除「邏輯控制的影片」      20240611 v3.5要確認一下viewer是否還是如此
                        // if (parentVisible == true && videoPlane.object3D.visible == true && !videoPlane.blockly ){
                        if (parentVisible == true && video2d.visible == true ){
                            console.log("解除靜音 2D影片", video.name4debug, video.currentTime)
                            if(playFromStart){
                                video.currentTime = 0.1
                            }
                            if(playVideo){
                                video.autoplay = true
                                video.play()
                            }
                            video.muted = false
                        }
                    }
                });	
            }
        }
    })
}

//// 3D影片物件需要特地再全部呼叫一次play
function unmute3dVideos(playVideo=false, playFromStart=false){
    //// 取得「所有影片」  3D
    let aVideos = document.getElementsByTagName('a-video');

    //// 把3D影片 可見的 全部靜音
    Array.from(aVideos).forEach( videoPlane => {
        let mp4Video = videoPlane.mp4Video;

        let parentVisible = true;
        videoPlane.object3D.traverseAncestors( function(parent) {
            if (parent.type != "Scene"){
                if (parent.visible == false){
                    parentVisible = false;
                }
            } else {
                //// 這邊注意，要撇除「邏輯控制的影片」      20240611 v3.5要確認一下viewer是否還是如此
                if (parentVisible == true && videoPlane.object3D.visible == true && !videoPlane.blockly ){
                    // mp4Video.muted = true;
                    console.log("解除靜音 3D影片",mp4Video.name4debug, mp4Video.currentTime)
                    // mp4Video.currentTime = 0.1
                    // mp4Video.play()
                    if(playFromStart){
                        mp4Video.currentTime = 0.1
                    }
                    if(playVideo){
                        mp4Video.autoplay = true
                        mp4Video.play()
                    }
                    mp4Video.muted = false
                }
            }
        });	
    })
}


//// 暫停所有2D影片物件
function pause2dVideos(){
    //// 取得「所有影片」  2D
    let videos2D = window.vrController.makarObjects2D

    //// 靜音所有2D影片物件
    videos2D.forEach( video2d =>{
        //// 雖然不應該出現 makarType 已是 video2D 的影片2D物件卻沒有以下這些，但還是寫一下錯誤處理
        if( video2d.makarType != "video2D" ){ return; }
        if( video2d.children.length == 0 ){ return; }
        if( !video2d.children[0].material ){ return; }
        if( !video2d.children[0].material.map ){ return; }
        if( !video2d.children[0].material.map.image ){ return; }
        
        if( video2d.children[0].material.map.image.tagName == "VIDEO" ){
            const video = video2d.children[0].material.map.image
            if(video){
                // console.log("暫停2D影片", video)
                const isVideoPlaying = (material) => !!(material.currentTime > 0 && !material.paused && !material.ended && material.readyState > 2);
                if(isVideoPlaying(video)){
                    try {
                        video.pause()                        
                    } catch (error) {
                        console.log("VideoModule.js, video pause error=", error)
                    }
                }
            }
        }
    })
}

//// 暫停所有3D影片物件
function pause3dVideos(){
    //// 取得「所有影片」  3D
    let aVideos = document.getElementsByTagName('a-video');

    //// 把3D影片 可見的 全部靜音
    Array.from(aVideos).forEach( videoPlane => {
        let mp4Video = videoPlane.mp4Video;

        const isVideoPlaying = (material) => !!(material.currentTime > 0 && !material.paused && !material.ended && material.readyState > 2);
        if(isVideoPlaying(mp4Video)){
            try {
                mp4Video.pause()                    
            } catch (error) {
                console.log("VideoModule.js, video pause error=", error)
            }
        }

    })
}

//[start-20231031-renhaohsu-modify]//
function loadVideo2D( obj, index, sceneObjNum, position, rotation, scale ){
    let self = this;

    let pVideo2D = new Promise( ( video2DResolve ) => {

        //// 2022 1123 之後 3.3.8 版本上線， 2D 物件的尺寸需要版本相容
        //// 位置    縮放    尺寸   旋轉
        let rectP, rectSizeDelta, rectScale , rectR ; 
        if ( Object.keys( self.editor_version ).length == 4 ){
            let largeV  = Number( self.editor_version.v0 );
            let middleV = Number( self.editor_version.v1 );
            let smallV  = Number( self.editor_version.v2 );	

            //[start-20231013-howardhsu-modify]//
            let trans;
            if ( largeV > 3 || 
                ( largeV == 3 && middleV >= 5 ) 
            ){
                trans = getObj2DInfo350();
            } else{
                trans = getObj2DInfo350();                                              
            }

            if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  ){
                rectP = trans.rectP;
                rectSizeDelta = trans.rectSizeDelta;
                rectScale = trans.rectScale;
                rectR = trans.rectR;
            }else{
                video2DResolve( false );
                return;
            }
            //[end-20231013-howardhsu-modify]//

        }else{
            let trans = getObj2DInfo350();
            if ( trans.rectP && trans.rectSizeDelta && trans.rectScale  ){
                rectP=trans.rectP;
                rectSizeDelta=trans.rectSizeDelta;
                rectScale=trans.rectScale;
                rectR = trans.rectR;
            }else{
                video2DResolve( false );
                return;
            }
        }

        //[start-20231013-howardhsu-add]//
        function getObj2DInfo350 (){
            let tempInfo = {};
            //// 位置    縮放    尺寸   旋轉
            let rectP, rectSizeDelta, rectScale , rectR ; 
            if ( obj.transformAttr.rect_transform && Array.isArray( obj.transformAttr.rect_transform ) && obj.transformAttr.rect_transform.length > 0 ){

                if ( !Number.isFinite( self.selectedResolutionIndex )   ){
                    console.log(' _getObj2DInfo350: error, missing _selectedResolutionIndex' );
                    self.selectedResolutionIndex = 0;
                }
                let selectedObj2DInfo = obj.transformAttr.rect_transform[ self.selectedResolutionIndex ];

                if ( selectedObj2DInfo.position && selectedObj2DInfo.size_delta && selectedObj2DInfo.rotation && selectedObj2DInfo.scale ){
                    rectP = selectedObj2DInfo.position.split(",").map(function(x){return Number(x)}); 
                    rectSizeDelta = selectedObj2DInfo.size_delta.split(",").map(function(x){return Number(x)}); 
                    rectScale = selectedObj2DInfo.scale.split(",").map(function(x){return Number(x)}); 
                    rectR = selectedObj2DInfo.rotation.split(",").map(function(x){return Number(x)});

                    let quaternionRotation = new THREE.Quaternion(parseFloat(rectR[0]), parseFloat(rectR[1]), parseFloat(rectR[2]), parseFloat(rectR[3]))
                    let eulerAngle = new THREE.Euler().setFromQuaternion( quaternionRotation, "YXZ");
                    let _rectR = new THREE.Vector3( eulerAngle.x ,  eulerAngle.y ,  eulerAngle.z );

                    //// 為了相容 ，把「旋轉資料」取代 「原本 rotation」
                    // rotation.z = b.z/Math.PI * 180 ;                    
                    _rectR.z =  -1 * _rectR.z

                    //// 為了相容 ，把「縮放資料」取代 「原本 scale」
                    scale.x = rectScale[0];
                    scale.y = rectScale[1];

                    tempInfo = {
                        rectP: rectP,
                        rectSizeDelta: rectSizeDelta,
                        rectScale: rectScale,
                        rectR: _rectR
                    }
                }

            }
            return tempInfo;
        }
        //[end-20231013-howardhsu-add]//
        
        let mp4Video, mp4Texture ;

        mp4Video = document.createElement('video');
        mp4Video.src = obj.res_url; // url, "Data/makarVRDemo.mp4"
        mp4Video.playsInline = true;
        mp4Video.autoplay = true;
        mp4Video.loop = true;
        mp4Video.setAttribute('crossorigin', 'anonymous');
        mp4Video.setAttribute("id", obj.generalAttr.obj_id+"_"+obj.res_id+"_"+self.loadSceneCount );
        mp4Video["name4debug"] = obj.generalAttr.obj_name; 

        mp4Video.setAttribute("preload", "auto");
        // mp4Video.setAttribute("playsinline ", true);

        //// 開發需要，先將所有影片禁音
        // mp4Video.muted = true;
        if (window.Browser){
            if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location )  ){
            // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                mp4Video.muted = true;
            }
            
            if (window.Browser.mobile == true){
                mp4Video.muted = true;
                // mp4Video.currentTime = 0.1
                mp4Video.play()
            }
        }
        
        mp4Texture = new THREE.VideoTexture( mp4Video );
        mp4Texture.colorSpace = THREE.SRGBColorSpace;
        mp4Texture.flipY = false;
        console.log("_loadVideo2D: mp4Texture", mp4Texture)

        mp4Video.onloadedmetadata = function() {
            // var videoWidth , videoHeight;
            // if (mp4Video.videoWidth >= mp4Video.videoHeight){
            //     videoWidth = 1;
            //     videoHeight = 1*mp4Video.videoHeight/mp4Video.videoWidth;
            // }else{
            //     videoWidth = 1*mp4Video.videoWidth/mp4Video.videoHeight;
            //     videoHeight = 1;
            // }

            let width, height;
            let scaleRatioXY = self.scaleRatioXY;
            // width  = rectSizeDelta[0] * scale.x * scaleRatioXY ;
            // height = rectSizeDelta[1] * scale.y * scaleRatioXY ;
            
            //// 因應 3.3.8 以上版本，物件本身的 transform 不會作用在容器上 也不會作用在 圖片本身 
            width  = rectSizeDelta[0] * scaleRatioXY ;
            height = rectSizeDelta[1] * scaleRatioXY ;
                
            let rootObject = new THREE.Object3D();
            rootObject.makarType = "video2D";

            //[start-20240408-renhaohsu-modify]//
            let chromaKey, slope, threshold, transparentBehav;                    
            //20191108-start-thonsha-add
            let transparentVideo = false
            if(makarUserData.scenesData.scenes[self.sceneIndex].behav && Array.isArray(makarUserData.scenesData.scenes[self.sceneIndex].behav)){

                transparentBehav = makarUserData.scenesData.scenes[self.sceneIndex].behav.find(b => b.obj_id == obj.generalAttr.obj_id && b.behav_type == "Transparent")
                if(transparentBehav){
                    console.log("%c VideoModule.js _loadVideo: transparentBehav=", 'color:BlanchedAlmond;', transparentBehav)
                    transparentVideo = true;
                    let _color = transparentBehav.color.split(",")
                    chromaKey = [parseFloat(_color[0]), parseFloat(_color[1]), parseFloat(_color[2])] 
                    slope = transparentBehav.slope 
                    threshold = transparentBehav.threshold
                }
            }
            //[end-20240408-renhaohsu-modify]//

            let plane;
            if (transparentVideo && transparentBehav){
                        
                let chromaKeyMaterial;

                if (transparentBehav.mode == "RGB"){
                    chromaKeyMaterial = new THREE.ChromaKeyMaterial({
                        map: mp4Texture , 
                        keyColor: chromaKey ,
                        side: THREE.DoubleSide, 
                        slope: slope,
                        threshold: threshold,
                    });
                    
                } else if (transparentBehav.mode == "HSV"){

                    //[start-20240408-renhaohsu-modify]//
                    //// rgb2hsv source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620
                    function rgb2hsv(r,g,b) {
                        let v=Math.max(r,g,b), c=v-Math.min(r,g,b);
                        let h= c && ((v==r) ? (g-b)/c : ((v==g) ? 2+(b-r)/c : 4+(r-g)/c)); 
                        return [60*(h<0?h+6:h), v&&c/v, v];
                    }
                    let _hsv = rgb2hsv( chromaKey[0], chromaKey[1], chromaKey[2] )
                    _hsv[0] /= 360;
                    console.log(`rgb: ${chromaKey} ,\n _hsv: (${ _hsv })`)
                    //[end-20240408-renhaohsu-modify]//

                    chromaKeyMaterial = new THREE.HSVMattingMaterial({
                        map: mp4Texture , 
                        side: THREE.DoubleSide, // DoubleSide
                        _keyingColorH: _hsv[0],
                        _keyingColorS: _hsv[1],
                        _keyingColorV: _hsv[2],
                        _deltaH: transparentBehav.hue,
                        _deltaS: transparentBehav.saturation,
                        _deltaV: transparentBehav.brightness,
                    });
                }
                // plane = THREE.SceneUtils.createMultiMaterialObject( new THREE.PlaneBufferGeometry(
                // 	mp4Texture.image.width*25.4/dpi ,
                // 	mp4Texture.image.height*25.4/dpi , 0 ), [ 
                // 		chromaKeyMaterial,
                // 		new THREE.MeshBasicMaterial( { color: 0xC0C0C0 , side: THREE.BackSide } ) 
                // 	]
                // );
                plane = new THREE.Mesh( 
                    new THREE.PlaneBufferGeometry( width , height , 0 ), 
                    chromaKeyMaterial,
                );                
                
            } else {
                    
                plane = new THREE.Mesh( 
                    new THREE.PlaneBufferGeometry( width, height , 0 ), 
                    new THREE.MeshBasicMaterial( { map: mp4Texture, side: THREE.DoubleSide, transparent: true  } ),
                );

            }

            // let videoBehavRef = false;                    
            // if (obj.behav_reference){
            //     rootObject.behav_reference = obj.behav_reference;
            //     for (let j = 0;j<obj.behav_reference.length; j++){
            //         if ( obj.behav_reference[j].behav_type == "Display" ){
            //             videoBehavRef = true;
            //             rootObject.visible = false;
            //             mp4Video.pause();
            //             mp4Video.autoplay = false;
            //             mp4Video.currentTime = 0;     
            //             break;                   
            //         }
            //     }
            // }

            // // for double side 
            // var plane = new THREE.Mesh(
            // 	new THREE.PlaneBufferGeometry( width , height , 0 ),
            // 	new THREE.MeshBasicMaterial( { map : texture,  side: THREE.DoubleSide,  transparent: true   } ) // DoubleSide, FrontSide
            // );
            
            //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
            const tempBehav = {
                behav_type : "videoTogglePlayPause",
                // delay : false,
                // is_front : true,
                obj_id : obj.generalAttr.obj_id,
                // toward_id : "7e30d242-3485-4f2f-8e61-e55ff9723e44",
                // trigger_obj_id : "d60e0385-9037-41dd-a899-d1479293b1db",
                // trigger_type : "Click"
            }

            if ( obj.behav ){
                rootObject["behav"] = obj.behav ;

                //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
                rootObject["behav"].push(tempBehav)

                //// 載入時候建制「群組物件資料」「注視事件」
                self.setObjectBehavAll( obj );
            } else {
                //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
                rootObject["behav"] = [ tempBehav ]
            }

            //// 依照 v3.5 viewer的設定: 所有影片物件都多了 "點擊時toggle播放暫停"
            // videoPlane.setAttribute('class', "clickable" )
            
            if (obj.generalAttr.active == false){
                rootObject.visible = false;
            }

            // plane.makarType = 'video2D';
            rootObject["makarObject"] = true ;
            rootObject["obj_id"] = obj.generalAttr.obj_id ;

            //20191029-start-thonhsa-add
            if(obj.generalAttr.obj_parent_id){
                // console.log("______VRFunc.js: _loadTexture2D: obj(parent) ", obj );

                mp4Video.autoplay = false;
                
                let setIntoParent = function(){
                    let isParentSet = false;
                    for (let i = 0; i < self.makarObjects2D.length; i++ ){
                        if ( self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id  ){
                            isParentSet = true;
                        }
                    }

                    if ( isParentSet == false ) {
                        setTimeout(setIntoParent, 500 );
                        // console.log("______VRFunc.js: _loadTexture2D: isParentSet   ", obj , self.makarObjects2D );

                    }else{
                        for (let i = 0; i < self.makarObjects2D.length; i++){
                            if (self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id){

                                //// 大小
                                rootObject.scale.set( scale.x , scale.y, 1 );

                                //// 改為統一移動比例
                                rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                                rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
                                rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 

                                //// 旋轉
                                rootObject.rotateZ( rectR.z )             

                                rootObject.add( plane );
                                self.makarObjects2D[i].add(rootObject);
                                self.makarObjects2D.push(rootObject);

                                let parentVisible = true;
                                rootObject.traverseAncestors( function(parent) {                                    
                                    if (parent.visible == false){
                                        parentVisible = false;
                                    }
                                                                            
                                    // if (parentVisible == true && rootObject.visible == true && videoBehavRef == false ){
                                    if (parentVisible == true && rootObject.visible == true ){
                                        console.log("VideoModule.js: _loadVideo2D: traverseAncestors: all parent visible true=", rootObject );
                                        
                                        mp4Video.autoplay = true;
                                        //[start-20240611-renhaohsu-mod]//
                                        //// seems like if a video object is a child, should call play() 
                                        mp4Video.play();

                                        //// set video attr according to the obj in makar with autoplay, volume, loop
                                        checkVideoTypeAttr(obj, mp4Video)
                                        //[end-20240611-renhaohsu-add]//                     
                                    
                                        //// 提醒用戶點擊開啟聲音
                                        if (window.Browser){
                                            if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                                            // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                                                dealVideoMuted( mp4Video, true );
                                            } else if (window.Browser.mobile == true){
                                                //// safari 以外的手機瀏覽器
                                                dealVideoMuted( mp4Video, false );
                                            }
                                        }

                                    }else{
                                        console.log("VideoModule.js: _loadVideo2D: traverseAncestors: not all parent visible true=", parentVisible);
                                        //// rootObject.visible = false; 
                                        mp4Video.muted = false;
                                        mp4Video.autoplay = false;
                                        mp4Video.pause();
                                        mp4Video.currentTime = 0;

                                    }                                        
                                });

                                video2DResolve( rootObject );
                                // console.log("______VRFunc.js: _loadTexture2D: parent exist, set obj(parent) ", obj , plane );

                            }
                        }

                    }
                };
                setIntoParent();

            } else {
                console.log("______VRFunc.js: _loadTexture2D: obj() ", obj );

                //// 大小
                rootObject.scale.set( scale.x , scale.y, 1 );

                //// 位置
                rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
                rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 
                
                // console.log("______VRFunc.js: _loadTexture2D: rectP", rectP );                
                
                //// 旋轉
                rootObject.rotateZ( rectR.z )        
                
                mp4Video.autoplay = true;

                //// set video attr according to the obj in makar with autoplay, volume, loop
                checkVideoTypeAttr(obj, mp4Video)
                
                //// 提醒用戶點擊開啟聲音
                if (window.Browser){
                    if (window.Browser.name == undefined || window.Browser.name == "safari" || (window.allowAudioClicked != true && location == parent.location ) ){
                    // if ( window.Browser.mobile == true || window.Browser.iOS == true || navigator.platform.includes('armv8l') == true  ){
                        dealVideoMuted( mp4Video, true );
                    } else if (window.Browser.mobile == true){
                        //// safari 以外的手機瀏覽器
                        dealVideoMuted( mp4Video, false );
                    }
                    
                    // else if (window.Browser.mobile == true){
                    //     mp4Video.muted = true;
                    //     mp4Video.currentTime = 0.1
                    //     mp4Video.play()
                    //     dealVideoMuted( mp4Video , true);
                    // }
                }

                self.makarObjects2D.push(rootObject);
                self.scene2D.add(rootObject);


                // const loader = new THREE.TextureLoader();
                // const texture1 = loader.load( 'https://threejs.org/examples/textures/brick_diffuse.jpg' );                    
                // texture1.colorSpace = THREE.SRGBColorSpace;
                // const material = new THREE.MeshBasicMaterial( { map: texture1 } );
                // plane.material.map = material.map
                // console.log("....", plane.material.map)

                rootObject.add(plane);
                rootObject["makarObject"] = true ;
                rootObject["obj_id"] = obj.generalAttr.obj_id ;
                
                video2DResolve( rootObject );

            }
            //20191029-end-thonhsa-add



        }



    })

    return pVideo2D;
}
//[end-20231031-renhaohsu-modify]//


//// YT影片物件 3D
////   (只是暫時物件，先不加入promise all的行列)
////   (或者說 未來可預期YT影片會處理較久 加入pAll會在場景載入等很久)
function loadYouTubeNotSupport(obj, index, sceneObjNum, position, rotation, scale){
    //// 這裡this是vrController
    const self = this;
    console.log("loadYoutubeNotSupport", obj, index, sceneObjNum, position, rotation, scale)

    //// 用threeJS做一個背板 文字物件放到它的子物件
    let ytEntity = document.createElement('a-entity');

    if (obj.behav){
        ytEntity.setAttribute('class', "clickable" );
    } else if (obj.generalAttr.logic){
        ytEntity.setAttribute('class', "clickable" ); 
    } else {
        ytEntity.setAttribute('class', "unclickable" );
    }

    ytEntity.setAttribute( "id", obj.generalAttr.obj_id ) 
    ytEntity.setAttribute('crossorigin', 'anonymous');
    ytEntity.setAttribute("shadow","");
    
    //// 編輯器「場景物件」上 「眼睛開啟關閉」判斷
    if ( obj.generalAttr.active == false ){
        ytEntity.setAttribute("visible", false);
        ytEntity.setAttribute('class', "unclickable" );
    }

    //// 微調一下整體的縮放
    const scaleCoefficient = 0.9
    ;(0,_setTransform_js__WEBPACK_IMPORTED_MODULE_1__.setTransform)(ytEntity, position, rotation, scale.multiplyScalar(scaleCoefficient));
    self.makarObjects.push( ytEntity );

    ytEntity.addEventListener("loaded", e => {
        
        ytEntity.object3D["makarObject"] = true;
        ytEntity.object3D["makarType"] = 'youtube';

        if(obj.behav){
            ytEntity.object3D["behav"] = obj.behav ;
        }

        //// 準備一個three平面  作為文字背板    
        let plane, width, height;
        //// 長寬要與YT影片物件接近 數字來自經驗法則
        width  = 1.1 ;
        height = 0.65 ;
        plane = new THREE.Mesh( 
            new THREE.PlaneBufferGeometry( width, height , 0 ), 
            new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, transparent: true, opacity: 0.7 } ),
        );

        //// 印象中v3.5已經不需要這個 有待確認
        if(obj.behav_reference){
            plane["behav_reference"] = obj.behav_reference ;
        }

        ytEntity.object3D.add(plane);

        //// 文字背板  給一個雜訊的視覺效果
        let paddingPlane;
        paddingPlane = new THREE.Mesh( 
            new THREE.PlaneBufferGeometry( width, height , 0 ), 
            // new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.BackSide, transparent: true, opacity: 0.1 } ),
            new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } ),
        );

        //// 把小平面作為children加入
        ytEntity.object3D.add(paddingPlane)

        paddingPlane.position.set(0, 0, 0)
        paddingPlane.rotation.set(0, 0, 0)
        //// 微調一下小平面的縮放
        const paddingCoeficient = 0.95
        paddingPlane.scale.set(paddingCoeficient*1, paddingCoeficient*1, paddingCoeficient*1)
    
        //// 給一個文字物件 寫著 youtube not supported
        let tempTextObj = {
            "res_id": "Text",
            "typeAttr": {
                "color": "0.6, 0.6, 0.6, 0.6",
                "margin": 0,
                "content": "youtube is\nunsupported\ncurrently.",
                "radious": 0,
                "back_color": "1,1,1,0",
                "anchor_type": 3
            },
            "blocklyAttr": {
                "uid": "",
                "reference": false
            },
            "generalAttr": {
                "logic": false,
                "active": true,
                "obj_id": `tempTextObj_${self.currentSceneIndex}_${index}`,
                "obj_name": obj.generalAttr.obj_name + "_tempTexObj",
                "obj_type": "3d",
                "interactable": false,
                "obj_parent_id": obj.generalAttr.obj_id
            },
            "materialAttr": {
                "materials": []
            },
            "animationAttr": [],
            "transformAttr": {
                "transform": [
                    "0,0,0",
                    "0,0,0,1",
                    "1,1,1"
                ],
                "rect_transform": [],
                "simulated_rotation": "0,0,0"
            },
            "main_type": "text",
            "sub_type": "txt",
            "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Text.glb"
        }
        
        let pText = self.loadText( tempTextObj , new THREE.Vector3(0,0,0), new THREE.Vector3(0,0,0), new THREE.Vector3(1,1,1), true )
        
        //// 背面也需要
        pText.then(result => {
            const backSideText = result.object3D.clone()
            // console.log("YT後文字 backSideText", backSideText)
            ytEntity.object3D.add(backSideText)
            backSideText.position.set(0,0,0.005)
        })
    })
    
    if(obj.generalAttr.obj_parent_id){
        let timeoutID = setInterval( () => {
            let parent = document.getElementById(obj.generalAttr.obj_parent_id);
            if (parent){ 
                if(parent.object3D.children.length > 0){
                    parent.appendChild(ytEntity);
                    window.clearInterval(timeoutID);
                }
            }
        }, 1);
    }
    else{
        self.vrScene.appendChild(ytEntity);
    }
}

//// YT影片物件 2D
////   (只是暫時物件，先不加入promise all的行列)
function loadYouTubeNotSupport2D(obj, index, sceneObjNum, position, rotation, scale){

    //// 這裡this是vrController
    const self = this;
    console.log("loadYoutubeNotSupport", obj, index, sceneObjNum, position, rotation, scale)

    console.log("呼叫 getObj2DTransform VC=", _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_3__.verionControl)

    const trans = _MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_3__.verionControl.getObj2DTransform(self.editor_version, obj, index, sceneObjNum, position, rotation, scale)
    
    console.log("呼叫 getObj2DTransform trans=", trans)

    let rectP, rectSizeDelta, rectScale , rectR ; 
    if( trans ){
        rectP = trans.rectP;
        rectSizeDelta = trans.rectSizeDelta;
        rectScale = trans.rectScale;
        rectR = trans.rectR;
    
        //// 為了相容 ，把「縮放資料」取代 「原本 scale」
        scale.x = trans.rectScale[0]
        scale.y = trans.rectScale[1]
    } else {
        // video2DResolve( false );
        return false;
    }
    
    
    let width, height;
    let scaleRatioXY = self.scaleRatioXY;

    //// 因應 3.3.8 以上版本，物件本身的 transform 不會作用在容器上 也不會作用在 圖片本身 
    width  = rectSizeDelta[0] * scaleRatioXY ;
    height = rectSizeDelta[1] * scaleRatioXY ;
        
    let rootObject = new THREE.Object3D();
    
    rootObject["makarObject"] = true ;
    rootObject["makarType"] = 'youtube2D';
    rootObject["obj_id"] = obj.generalAttr.obj_id ;

    //// 20240619 目前webXR不支援YT物件  去背事件應該也暫時不支援
    
    if ( obj.behav ){
        rootObject["behav"] = obj.behav ;
    }
    
    
    if (obj.generalAttr.active == false){
        rootObject.visible = false;
    }


    //// 準備一個three平面  作為文字背板    
    let plane;
    //// 長寬要與YT影片物件接近 數字來自經驗法則
    // width  = 1.1 ;
    // height = 0.65 ;
    plane = new THREE.Mesh( 
        new THREE.PlaneBufferGeometry( width, height , 0 ), 
        new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, transparent: true, opacity: 0.7 } ),
    );

    //// 文字背板  給一個雜訊的視覺效果
    let paddingPlane;
    paddingPlane = new THREE.Mesh( 
        new THREE.PlaneBufferGeometry( width, height , 0 ), 
        // new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.BackSide, transparent: true, opacity: 0.1 } ),
        new THREE.MeshBasicMaterial( { color: 0xaaaaaa, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } ),
    );
    paddingPlane.position.set(0, 0, 0)
    paddingPlane.rotation.set(0, 0, 0)
    //// 微調一下小平面的縮放
    const paddingCoeficient = 0.9
    paddingPlane.scale.set(paddingCoeficient*1, paddingCoeficient*1, paddingCoeficient*1)

    rootObject.add(plane);
    rootObject.add(paddingPlane);


    //// 給一個文字物件 寫著 youtube not supported
    let tempTextObj = {
        "res_id": "Text",
        "typeAttr": {
            "color": "0.6, 0.6, 0.6, 0.6",
            "margin": 0,
            "content": "youtube is\nunsupported\ncurrently.",
            "radious": 0,
            "back_color": "1,1,1,0",
            "anchor_type": 3
        },
        "blocklyAttr": {
            "uid": "",
            "reference": false
        },
        "generalAttr": {
            "logic": false,
            "active": true,
            "obj_id": `tempTextObj2D_${self.currentSceneIndex}_${index}`,
            "obj_name": obj.generalAttr.obj_name + "_tempTextObj2D",
            "obj_type": "2d",
            "interactable": false,
            "obj_parent_id": obj.generalAttr.obj_id
        },
        "materialAttr": {
            "materials": []
        },
        "animationAttr": [],
        "transformAttr": {
            "transform": [],
            "rect_transform": [
                {
                    "scale": "1,1,1",
                    "position": "0,0,0",
                    "rotation": "0,0,0,1",
                    // "size_delta": "100,100",
                    "size_delta": obj.transformAttr.rect_transform[self.selectedResolutionIndex].size_delta,
                    "simulated_rotation": "0,0,0"
                }
            ],
            "simulated_rotation": ""
        },
        "main_type": "text",
        "sub_type": "txt",
        "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Text.glb"
    }

    let pText = self.loadText2D( tempTextObj , index, sceneObjNum, null, null, null, true)  
    
    //// 文字的z值不好決定 由於YT物件2D只有一個文字子物件 renhaohsu暫時先等載入後在parent下再調整為0.01
    pText.then(result => {
        console.log("YT後文字 result", result)
        result.position.z = 0.01;
    })

    if(obj.generalAttr.obj_parent_id){
        
        let setIntoParent = () => {
            let isParentSet = false;
            for (let i = 0; i<self.makarObjects2D.length; i++ ){
                if ( self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id  ){
                    isParentSet = true;
                }
            }

            if ( isParentSet == false ){
                setTimeout(setIntoParent, 200 );
            }else{
                for (let i = 0; i < self.makarObjects2D.length; i++){
                    if (self.makarObjects2D[i].obj_id == obj.generalAttr.obj_parent_id){
                    
                        rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
                        rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
                        rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 
                        
                        //// 旋轉
                        // rootObject.rotateZ( -rotation.z /180*Math.PI);                            
                        rootObject.rotateZ( rectR.z )   

                        rootObject.scale.set( rectScale[0] , rectScale[1] , 1 );

                        rootObject["makarObject"] = true ;
                        rootObject["obj_id"] = obj.generalAttr.obj_id ;
                        rootObject["obj_parent_id"] = obj.generalAttr.obj_parent_id ;
                        self.makarObjects2D[i].add(rootObject);
                        self.makarObjects2D.push(rootObject); 
                    
                        break;
                    }
                    
                }
            }
    
        }
        setIntoParent();

    } else {
        //// 大小
        rootObject.scale.set( scale.x , scale.y, 1 );

        //// 位置
        rootObject.translateX(  rectP[0]*scaleRatioXY ) ;
        rootObject.translateY( -rectP[1]*scaleRatioXY ) ;
        rootObject.translateZ( -1 + index/sceneObjNum );// [-1, 0] 

        //// 旋轉
        rootObject.rotateZ( rectR.z )        
        
        self.scene2D.add(rootObject);
        self.makarObjects2D.push(rootObject);
        
        // video2DResolve( rootObject );
    }
}

/***/ }),

/***/ "./js/VRMain/version3_5/vrObjectModules/setTransform.js":
/*!**************************************************************!*\
  !*** ./js/VRMain/version3_5/vrObjectModules/setTransform.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   setTransform: () => (/* binding */ setTransform)
/* harmony export */ });
function setTransform( obj, position, rotation, scale ) {
        
    // console.log("VRFunc.js: setTransform: obj=", obj, "\n position=", position , "\n rotation=", rotation , "\n scale=", scale); 
    let pos = position.clone(); 
    pos.multiply( new THREE.Vector3( -1, 1, 1 ) ); ////// reverse the x direction 
    obj.setAttribute( "position", pos );//// origin 

    let rot = rotation.clone(); 
    // rot.multiply( new THREE.Vector3( 1 , -1 , -1 ) ); ////// reverse x y direction
    rot.multiply( new THREE.Vector3( 1 , -1 , -1 ).multiplyScalar( 180 / Math.PI ) ); 
    
    obj.setAttribute( "rotation", rot );//// origin 

    obj.setAttribute( "scale", scale );//// origin 

    // obj.setAttribute( "width" , scale.x );////// the unit ratio is 1:100
    // obj.setAttribute( "height", scale.y );

}

/***/ }),

/***/ "./js/VRMain/version3_5/vrUtility.js":
/*!*******************************************!*\
  !*** ./js/VRMain/version3_5/vrUtility.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UrlExists: () => (/* binding */ UrlExists),
/* harmony export */   checkDefaultImage: () => (/* binding */ checkDefaultImage),
/* harmony export */   checkDefaultObj: () => (/* binding */ checkDefaultObj),
/* harmony export */   checkHost_tick: () => (/* binding */ checkHost_tick),
/* harmony export */   forbidden: () => (/* binding */ forbidden),
/* harmony export */   getRandomInt: () => (/* binding */ getRandomInt),
/* harmony export */   isPromise: () => (/* binding */ isPromise),
/* harmony export */   makeid: () => (/* binding */ makeid),
/* harmony export */   unicodeToChar: () => (/* binding */ unicodeToChar)
/* harmony export */ });
/* harmony import */ var _scripts_DefaultResource_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../scripts/DefaultResource.js */ "../scripts/DefaultResource.js");

//// 以下都不能使用，備註
// import data  from "./DefaultResource.json" ;
// import * as data from './DefaultResource.json';

// import data from "./DefaultResource.json" assert { type: "json" };

// @ts-ignore
// import  data  from "../../../../scripts/DefaultResource.json" assert { type: "json" };



// let data = import('/scripts/DefaultResource.json', {
//     assert: {
//         type: 'json'
//     }
// });

function makeid(length) {
    var result           = '';
    var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var charactersLength = characters.length;
    for ( var i = 0; i < length; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
}  

function UrlExists(url , callback ){
    let httpRequest = new XMLHttpRequest();
    httpRequest.open('HEAD', url, true);
    httpRequest.onload = function(e){
        console.log(" VRFunc.js: _UrlExists: httpRequest status= " , httpRequest.status  );
        callback( httpRequest.status == "200" );
    }
    
    httpRequest.onerror = function(e){
        console.log( 'onerror e=', e );
        callback( httpRequest.status == "200" );

    }
    httpRequest.onabort = function(e){
        console.log( 'onabort e=', e );
        callback( httpRequest.status == "200" );
    }
    httpRequest.send();
}

function isPromise(p) {
    if (typeof p === 'object' && typeof p.then === 'function') {
        return true;
    }
    return false;
}

//[start-20191111-fei0079-add]//
function checkHost_tick() {
    if ( typeof(checkHost) != "undefined" ){
        if ( checkHost == "yet" ){
            // console.log("VRFunc.js: checkHost = yet");
            setTimeout(checkHost_tick, 50);
        }else{
            if ( checkHost == "correct" ){
                console.log("VRFunc.js: _checkHost_tick correct");
            } else if ( checkHost == "fail" ){
                //// remove all childrens of documnet
                while (document.body.firstChild) {
                    document.body.removeChild(document.body.firstChild);
                }
                //// add the warning about Host
                var divHostWarn = document.createElement('div');
                divHostWarn.innerHTML = "<br>The host of webVR seems unauthorized,<br> please contact MIFLY ";
                divHostWarn.style.fontSize = "18px";
                divHostWarn.style.margin = "5px";
                divHostWarn.style.fontWeight = "700";
                document.body.append( divHostWarn );
            }
        }
    } else {
        console.log("VRFunc.js: checkHost = undefined, something ERROR.");
        // setTimeout(checkHost_tick, 50);
    }
};
//[end---20191111-fei0079-add]//

function forbidden( message ){
    if (document.getElementById("freeUserWarnDiv")){
        document.getElementById("freeUserWarnDiv").style.display = "block";
        document.getElementById("pUserInfo").textContent = message;
        // document.getElementById("pUserInfo").style.color = "red";
        leaveIframe.onclick = function(event){
            event.preventDefault();
            if (parent.aUI){
                // parent.aUI.closeCoreIframe();
            }
        }
    }
}

function getRandomInt(max) {
    return Math.floor(Math.random() * Math.floor(max));
}

function unicodeToChar(text) {
    return text.replace(/\\u[\dA-F]{4}/gi, 
            function (match) {
                return String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16));
            });
}

//// check: is image default image
function checkDefaultImage( obj ) {
    // console.log("vrUtility.js _checkDefaultImage: obj.red_id=", obj.res_id)
    switch(obj.res_id){
        case "MakAR_Call":
            obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Call.png";
            obj.main_type = "image"
            obj.sub_type = "png"
            break;
        case "MakAR_Room": 
            obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Room.png";
            obj.main_type = "image"
            obj.sub_type = "png"
            break;
        case "MakAR_Mail": 
            obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Mail.png";
            obj.main_type = "image"
            obj.sub_type = "png"
            break;
        case "Line_icon":
            obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Line_icon.png";
            obj.main_type = "image"
            obj.sub_type = "png"
            break;
        case "FB_icon":
            obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/FB_icon.png";
            obj.main_type = "image"
            obj.sub_type = "png"
            break;
        default:
            console.log("vrUtility.js: _checkDefaultImage, obj=",  obj );
    }

}


//// 檢查是否為「預設素材」，是的話把網址賦予
function checkDefaultObj( obj ) {

    // console.log( ' 66666666 ' , data.default )

    let getRes = false;
    //// v3.5.0.0 預設素材 有作過更新，先判斷新版本
    if ( _scripts_DefaultResource_js__WEBPACK_IMPORTED_MODULE_0__["default"] && _scripts_DefaultResource_js__WEBPACK_IMPORTED_MODULE_0__["default"].data && Array.isArray( _scripts_DefaultResource_js__WEBPACK_IMPORTED_MODULE_0__["default"].data.list )  ){
    // if ( data && data.default && data.default.data && Array.isArray( data.default.data.list )  ){

        // let list = data.default.data.list;
        let list = _scripts_DefaultResource_js__WEBPACK_IMPORTED_MODULE_0__["default"].data.list;

        list.forEach( e => {
            if ( e.res_id == obj.res_id ){
                obj.main_type = e.main_type;
                obj.sub_type = e.sub_type;
                obj.res_url = e.res_url;
                getRes = true;
            }
        });
    }

    //// 假如沒有找到，走舊版流程
    console.log('  .getRes ' , getRes , obj );
    
    if ( getRes ){
        return ;
    }

    switch(obj.res_id){ 
        //// Quiz 
        case "quiz":
            obj.main_type = "empty";
            obj.sub_type = "quiz";
            break;

        case "Curve":
            obj.main_type = "curve";
            break;

        default:
            if (obj.res_gltf_resource){
                break;
            }

            ///// 假如「場景物件資料」不具有「場景維度」，設定為 3d
            if ( !obj.generalAttr ){
                obj.generalAttr = {
                    obj_type: '3d'
                };
            }else{
                if ( !obj.generalAttr.obj_type ){
                    obj.generalAttr.obj_type = '3d';
                }
            }

            //// 假如「場景物件資料」不具有「位置資料」，設定在「原點」
            if ( !obj.transformAttr  ){
                obj.transformAttr = {
                    transform: [
                        '0,0,0',
                        '0,0,0,1',
                        '1,1,1',
                    ]
                }
            }else{
                if ( !obj.transformAttr.transform  ){
                    obj.transformAttr.transform = [
                        '0,0,0',
                        '0,0,0,1',
                        '1,1,1',
                    ]
                }
            }

            obj.main_type = "model";
            obj.sub_type = 'glb';
            obj.res_url = "https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb";
            break;
    }

}

/***/ }),

/***/ "./js/VrSdk/EventSubject.js":
/*!**********************************!*\
  !*** ./js/VrSdk/EventSubject.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   BoxObserver: () => (/* binding */ BoxObserver),
/* harmony export */   Subject: () => (/* binding */ Subject)
/* harmony export */ });
//// 以狀態列表來播放動畫
////   引用 "觀察者模式"
////      觀察者物件: 可以訂閱 "主題"
////      主題: 帶有狀態列表  每個狀態開始時, 通知有訂閱的觀察者
////      當觀察者收到通知 按照通知的state來播動畫

// 觀察者 interface
class Observer {
    update(subject) {}
}

// 具體觀察者
class BoxObserver extends Observer {
    constructor(obj_id) {
        super();
        this.obj_id = obj_id
        this.element = document.getElementById(obj_id);
        //// 這裡應該要做錯誤處理
    }

    update(subject) {
        if(!subject.state){ return; }
        if(!subject.state.typeAttr){ return; }

        //// 先模仿triggerEvent的方式來寫
        let position;
        switch (subject.state.behavType) {
            case "transform":
                position = subject.state.typeAttr.position
                if(!position){ return; }

                console.log("position", position)
                anime({
                    targets: this.element.object3D.position,
                    // round: 1,
                    easing: 'linear',
                    x: (position.x || position.x === 0) ? position.x : this.element.object3D.position.x,
                    y: (position.y || position.y === 0) ? position.y : this.element.object3D.position.y,
                    z: (position.z || position.z === 0) ? position.z : this.element.object3D.position.z,
                    update: () => {
                        // console.log("update update subject.state", subject.state)
                    },
                    complete: () => {
                        console.log("position complete")
                        subject.notifyNext()
                    }
                });
                
                break;
            
            case "lookAt":
                position = subject.state.typeAttr.position
                const targetObjId = subject.state.typeAttr.targetObjId
                if(!position && !targetObjId){ return; }
                
                //// 開一個物件用來取得lookAt之後的rotation, 再用anime.js來轉動原本物件
                const tempObj = this.element.object3D.clone()
                tempObj.rotation.order = "YXZ"

                //// 可以是位置或物件id  暫時設定成position優先
                if(position){

                    this.element.object3D.lookAt(position.x, position.y, position.z);

                } else if(targetObjId){

                    let targetObj = makarSDK.sceneObjs3D_arr.find(obj => obj.obj_id === targetObjId );
                    if(targetObj){
                        //// 這裡拿到的是 makarSDK 物件Array裡的資料 它被設計成要往下拿.obj才是THREE Object3D
                        targetObj = targetObj.obj

                        let targetPos = new THREE.Vector3();
                        targetObj.getWorldPosition(targetPos);
                        // this.element.object3D.lookAt(targetPos);
                        
                        tempObj.lookAt(targetPos);
                    }

                } 
                
                console.log("rotation", tempObj.rotation)
                anime({
                    targets: this.element.object3D.rotation,
                    // round: 1,
                    easing: 'linear',
                    x: (tempObj.rotation.x || tempObj.rotation.x === 0) ? tempObj.rotation.x : this.element.object3D.rotation.x,
                    y: (tempObj.rotation.y || tempObj.rotation.y === 0) ? tempObj.rotation.y : this.element.object3D.rotation.y,
                    z: (tempObj.rotation.z || tempObj.rotation.z === 0) ? tempObj.rotation.z : this.element.object3D.rotation.z,
                    update: () => {
                        // console.log("update update subject.state", subject.state)
                    },
                    complete: () => {
                        console.log("rotation complete")
                        subject.notifyNext()
                    }
                });

                break;
            
            default:
                break;
        }
    
    }
}


//// 狀態表 或者說timeline
////        主題 → 狀態表  目前設定為 1to1, 但不是onto     (設計成每個主題要有狀態表才能運作 之後要考慮主題能不能更換狀態表)
const stateConfig = {
    stateMap: [
        {
            stateName: "bearMove1",
            obj_id: "obj_id",
            behavType: "transform",
            typeAttr: {
                position: {y: 5},
                // rotation: {y: 5},
            },
        },
        { 
            stateName: "penguinMove",
            obj_id: "obj_id",
            behavType: "transform",
            typeAttr: {
                position: {x: -4}, 
                // rotation: {x: 2},
            },
        },
    ],
    startIndex: 0
};

// 主題
class Subject {

    stateConfig = {}

    _state = {};
    _stateMap = [];
    _startIndex = 0;
    // _stateNames = [];

    stateIndex = 0;

    constructor(newStateConfig) {
        this.observers = [];
        // this.currentObserverIndex = 0;

        this._stateMap = newStateConfig.stateMap;
        // this._stateNames = newStateConfig.stateNames;
        this.stateIndex = newStateConfig.startIndex || 0;
    }

    //// 觀察者訂閱主題
    attach(observer) {
        this.observers.push(observer);
    }

    detach(observer) {
        this.observers = this.observers.filter(obs => obs !== observer);
    }

    notify() {
        // if (this._stateNames.length > 0 && this.stateIndex < this._stateNames.length) {
        if (this._stateMap.length > 0 && this.stateIndex < this._stateMap.length) {
            // const stateName = this._stateNames[this.stateIndex];
            const state = this._stateMap[this.stateIndex];
            this._state = state;
            const observer = this.observers.find(obs => obs.element.id === state.obj_id);
            if (observer) {
                observer.update(this);
            }
        }
    }

    notifyNext() {
        this.stateIndex++;
        // if (this.stateIndex < this._stateNames.length) {
        if (this.stateIndex < this._stateMap.length) {
            this.notify();
        }
    }

    //// 設定狀態表 or 更換狀態表(todo: 規劃為可以更換 但是在什麼時機呼叫? SDK怎麼呼叫?)
    /**
     * @param {{ stateMap: any[]; startIndex: number; }} newStateConfig
     */
    set stateConfig(newStateConfig) {
        console.log("subject set stateConfig")
        this._stateMap = newStateConfig.stateMap;
        // this._stateNames = newStateConfig.stateNames;
        this.stateIndex = newStateConfig.startIndex || 0;
    }

    get stateConfig() {
        // return { stateMap: this._stateMap, stateNames: this._stateNames };
        return { stateMap: this._stateMap, startIndex: this._startIndex };
    }

    get state() {
        return this._state;
    }

    set state(newState) {
        this._state = newState;
        this.notify();
    }

    triggerState(stateName) {
        this.stateIndex = this._startIndex;
        if (this.stateIndex !== -1) {
            this.notify();
        }

        //// todo: 要處理連續觸發的問題
    }





}


/***/ }),

/***/ "./js/VrSdk/commonTools.js":
/*!*********************************!*\
  !*** ./js/VrSdk/commonTools.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
class CommonTools {

    static url = "https://ssl-api-makar-v3-apps.miflyservice.com/Makar/";

    


    // source: https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve

    // Standard Normal variate using Box-Muller transform.
    static gaussianRandom(mean=0, stdev=1) {
        const u = 1 - Math.random(); // Converting [0,1) to (0,1]
        const v = Math.random();
        const z = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
        // Transform to the desired mean and standard deviation:
        return z * stdev + mean;
    }



    static sendPost(destination, dataObject) {
        // Reference: https://developers.google.com/web/fundamentals/primers/promises?hl=zh-tw

        let self = this;

        return new Promise(function(resolve, reject) {

            let request = {
                ver: self.webVersion,
                cid: 5,
                data: dataObject
            };
            
            fetch( destination, {
                body: JSON.stringify( request ),
                headers: {
                    'content-type': 'application/json'
                },
                method: 'POST',
                cache: 'no-cache',
                credentials: 'same-origin',
                mode: 'cors', // no-cors, cors, *same-origin  
            }).then( res => res.json() ).then(function( response ){

                setTimeout( function(){
                    resolve( response );
                }, 1 ) 

            })
        });
    }

    static async getProjectInfoList ( project_ids, login_id ) {

        if ( !Array.isArray( project_ids ) ){
            console.warn( '_getProjectInfoList_: error',  project_ids )
            return false;
        }

        let specificUrl = this.url + "WebXR/GetProjects";
        let data = {
            "login_user_id": login_id,
            "project_ids": project_ids,
        };
        let result = this.sendPost(specificUrl, data);
    
        return await result;
    }

}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CommonTools);

/***/ }),

/***/ "./js/VrSdk/makarSDK.js":
/*!******************************!*\
  !*** ./js/VrSdk/makarSDK.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_animejs_lib_anime_es_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../node_modules/animejs/lib/anime.es.js */ "./node_modules/animejs/lib/anime.es.js");
/* harmony import */ var _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/gsap/src/index.js */ "./node_modules/gsap/src/index.js");
/* harmony import */ var _node_modules_gsap_src_ScrollTrigger_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../node_modules/gsap/src/ScrollTrigger.js */ "./node_modules/gsap/src/ScrollTrigger.js");
/* harmony import */ var _node_modules_gsap_src_ScrollToPlugin_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../node_modules/gsap/src/ScrollToPlugin.js */ "./node_modules/gsap/src/ScrollToPlugin.js");
/* harmony import */ var _node_modules_gsap_src_TextPlugin_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../node_modules/gsap/src/TextPlugin.js */ "./node_modules/gsap/src/TextPlugin.js");
/* harmony import */ var _commonTools_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonTools.js */ "./js/VrSdk/commonTools.js");
/* harmony import */ var _EventSubject_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./EventSubject.js */ "./js/VrSdk/EventSubject.js");
//// curve物件需要 anime
// import anime from '../node_modules/animejs/lib/anime.es.js';


//// 測試，之後可移除
console.log("anime\n", _node_modules_animejs_lib_anime_es_js__WEBPACK_IMPORTED_MODULE_0__["default"])
;(0,_node_modules_animejs_lib_anime_es_js__WEBPACK_IMPORTED_MODULE_0__["default"])({
    targets: '#anime-animate-anything-css',
    width: "50%",
    translateX: 250,
    rotate: '1turn',
    backgroundColor: '#777',
    duration: 800
});

window.anime = _node_modules_animejs_lib_anime_es_js__WEBPACK_IMPORTED_MODULE_0__["default"];

//// logicSystem需要gsap

    




_node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.registerPlugin(_node_modules_gsap_src_ScrollTrigger_js__WEBPACK_IMPORTED_MODULE_2__.ScrollTrigger,_node_modules_gsap_src_ScrollToPlugin_js__WEBPACK_IMPORTED_MODULE_3__.ScrollToPlugin,_node_modules_gsap_src_TextPlugin_js__WEBPACK_IMPORTED_MODULE_4__.TextPlugin);

//// utility


//// 狀態列表: 主題, 觀察者 


//// 測試，之後可移除
console.log("gsap\n", _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap)

//// 這樣user都知道我們用gsap 應該沒有關係吧?
window.gsap = _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap;

_node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.set("#gsap-animate-anything-css", {
    backgroundColor: "black",
    width: "100px",
    height: "100px",
})
_node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.to("#gsap-animate-anything-css", {
    backgroundColor: "black",
    width: "100px",
    height: "100px",
    duration: 10,
    ease: "none",
    repeat: -1,
    rotation: 360,
})

console.log("2024-06-25T15:50:00+08:00")

window.addEventListener('click', () => {
    const scene = document.querySelector('a-scene');
    // scene.style.cursor = 'default';

    document.documentElement.style.cursor = 'default';
    console.log("aframe scene", scene)
});

//// 1. 出現的全域變數 都需要放到MakarSDK底下
////    例如 homeTickOn  (這種在 VRController 裡面使用的 因此VRController也要查homeTickOn然後一起改動)
////    例如 parent.proj_id 等等
//// 
//// 2. 往後傳遞的參數 例如 proj_id 和 user_id 等等 也要檢查修改
class MakarSDK{
    config = { 
        proj_id: "a826d480-736f-4517-81e8-2f322e543e79",
        // user_id: "76ad6ef7-e89e-4f35-9c8d-0f40617f64a1" 
        user_id: "" 
    }
    
    container = null;
    vrDiv = document.createElement('div');   
    currentActiveController = null;

    //// 最初認為sdk應該在必要資料有缺時不該啟動  (但似乎都能用預設值代替? 問一下哪種方式較適合)
    isEnabled = false;

    //// 增加預先載入圖片功能，目前只做用在「載入中圖片」
    imageBase = 'https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/Loading_20220630/Loading_An000';
    
    /////// start the pop note when document ready
    homeTickOn = true;

    //// 準備 js custom event 
    constructorEvent = new CustomEvent("webSDKconstructor", {
        detail: {
            name: "webSDK constructor",
        },
    });

    
    //// --- 記錄每個場景 ---
    scenesData = [];
    currentSceneData = null;

    // //// 讓user可輕鬆取得場景物件  目前規劃為物件都載入後呼叫 getCurrentSceneObjs
    // sceneObjs3D = null;
    // sceneObjs2D = null;

    //// 狀態列表 使用觀察者模式
    // eventList = [
    //     {
    //         "behav_type": "",
    //         "obj_id": ""
    //     },
    //     {
    //         "behav_type": "",
    //         "obj_id": ""
    //     }
    // ]
    //// 狀態列表 觀察者們  (觀察者放在MakarSDK 用fly-weight pattern來避免同一個物件重複新增觀察者)
    loadedObservers = [];


    //// workWithRenderTick
    //// 物理 需要在`renderTick`寫 不太確定哪種方式比較好
    //// 先寄在這裡
    workWithRenderTick_callbacks = {}



    //// 建構子只用來做基本設定  暫時先設定user需要呼叫 init 來初始化SDK
    constructor( config={}, container=null ){
        //// 給一些預設值?
        // this.config = config
        // if( !config.user_id ){
        //     console.log("缺少user_id, 以預設值帶入")
        //     this.config.user_id = "76ad6ef7-e89e-4f35-9c8d-0f40617f64a1" 
        // }
        // this.config = container
    }


    //// 檢查專案權限
    //// 目前先不給輸入 user_id 因為user_id是公開的 以後可能會增加token的流程再加入
    checkPermission(){
        return new Promise((resolve, reject) => {
            let permission = 0
            // let pScenes = CommonTools.getProjectInfoList( [this.config.proj_id], this.config.user_id );
            let pScenes = _commonTools_js__WEBPACK_IMPORTED_MODULE_5__["default"].getProjectInfoList( [this.config.proj_id], "" );

            pScenes.then( function( ret ){
                console.log('_checkPermission ____getProjectInfoList_: ' , ret );
                if (ret.error) {
                    reject(`Promise 失敗, ret.error=${ret.error}`)
                } else {
                    console.log('_checkPermission ____getProjectInfoList_: permission' , ret.data.projects[0].permission );
                    permission = ret.data.projects[0].permission
    
                    if (permission==1 || permission==2) {
                        resolve(`Promise 成功， permission: ${permission}  `)
                    } else {
                        reject('Promise 失敗')
                    }
                }
            })
        });
    }

    async init(config, container){
        this.config = config
        this.container = container

        if( !config.user_id ){
            console.log("缺少user_id, 以預設值帶入")
            this.config.user_id = "76ad6ef7-e89e-4f35-9c8d-0f40617f64a1" 
        }
        
        if( !container ){
            console.log("todo: 缺少container, 以預設值帶入 (開一個新的給他放在頁面上 ")
            this.isEnabled = false
        } 

        if( !Array.isArray(container) ){
            console.log("SDK attempt container", container)
        }

        //// 檢查專案權限
        try{
            let permission = await this.checkPermission()
        } catch (err) {
            console.log('catch err=', err); //catch Promise 失敗
            console.warn("此專案設定並非公開")
            this.isEnabled = false
            return
        }

        //// 開始載入SDK
        //// 以下部分來自 vr html
        console.log("SDK attempt makarSDK=", this)

        //// 增加預先載入圖片功能，目前只做用在「載入中圖片」
        // let imageBase = 'https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/Loading_20220630/Loading_An000';
        for (let i = 0; i < 30; i++ ){
            let strIndex = '';
            if (i < 10){
                strIndex = String( '0'+ i ) ;
            }else{
                strIndex = String( i );
            }
            let linkElement = document.createElement('link');
            linkElement.setAttribute('as', 'image');
            linkElement.setAttribute('rel', 'preload');
            linkElement.setAttribute('href', this.imageBase + strIndex + '.png' );
            document.head.appendChild( linkElement );
        }

        // window.serverUrl = "https://ssl-api-makar-apps.miflyservice.com/Makar"; // makar server Amazon 
        //////
        ////// set the version of server, will also change the function in networkAgent.js
        //////
        window.serverVersion = "3.0.0";
        //// 20240531 renhaohsu: 其實在這裡寫這個暫時是沒用的  webxr有用是因為裡面寫 parent 但 sdk 不是 parent 是同一個頁面
        switch(serverVersion){
            case "2.0.0":
                window.serverUrl = "https://ssl-api-makar-apps.miflyservice.com/Makar/"; // makar V2 server Amazon 
                // window.serverUrl = "https://makar-ali-sh-cn.miflyservice.com/Makar" ; // makar V2 server Ali-sh-cn
            break;
            
            case "3.0.0":
                    // window.serverUrl = "https://60.250.125.146:8888/Makar/"; // local V3 makar server.
                    window.serverUrl = "https://ssl-api-makar-v3-apps.miflyservice.com/Makar/"; // official V3 makar server.
                    // window.serverUrl = "https://test1.makar.app/Makar/"; // AWS test V3 makar server.
                    // window.serverUrl = "https://makar.app/Makar/";	// local test server 20200316
            break;
            
        }

        //// 從「 母頁面取得 MAKAR server api 位址」
        if ( parent && parent.serverUrl ){
            console.log(' makarXR.html: use parent server url ', parent.serverUrl );
            window.serverUrl = parent.serverUrl;
        }
        
        
        //20200102-start-thonsha-add
        window.requestDeviceMotionPermission = function (){
            console.log("makarVR.html: requestDeviceMotionPermission  " );
            if (typeof(DeviceMotionEvent) !== 'undefined' && typeof(DeviceMotionEvent.requestPermission) === 'function') {
                DeviceMotionEvent.requestPermission().then(response => {
                    console.log("makarVR.html: requestPermission response =", response );
                    // alert('Orientation tracking '+ response);
                    if (response == 'granted') {
                        window.addEventListener('devicemotion', (e) => {
                            // but.style.visibility='hidden';
                        })
                    }
                }).catch(console.error)
            }else {
                // alert('DeviceMotionEvent is not defined');
                console.log("makarVR.html: requestPermission: DeviceMotionEvent is not defined " );
            }
        }
        //20200102-end-thonsha-add

        //// 準備 vr 需要的 html標籤們
        this.addElementToContainer()

        //// 準備並開始載入場景
        this.load()

    }

    //// 準備 vr 需要的 html標籤們
    addElementToContainer(){

        //// 先開一個容器放html需要的標籤
        const tempElement = document.createElement('div')
        tempElement.setAttribute("id", "tempElement");
        console.log("tempElement", tempElement)


        tempElement.innerHTML = `
            <div id="freeUserWarnDiv">
            <div id = 'freeUserWarnContent'>
                <p id="pUserInfo" >  info  </p>
                <div id = "leaveIframe">
                    返回
                </div>
            </div>
            </div>


            <div style="position: relative; height:100%">
            <div id = "homePage" style = "display: block;">
                <div id = 'homeImageContainer'></div>
            </div>

            <div id = "loadPage">
                <div class="centerText"> 
                    Loading
                    <div class="lds-ellipsis">
                        <div>.</div><div>.</div><div>.</div><div>.</div><div>.</div>
                    </div>
                </div>
            </div>

            <div id = "clickToPlayAudio">
                請點擊畫面來播放聲音
            </div>

            <div id = "clickToUnMuteVideo">
                請點擊來播放影片聲音
            </div>

            <div id = "timerDiv"  style="display: none" >
                <p id = "timerContent" class="centerText"> 答題計時 </p>
            </div>

            <div id = "tipButtonDiv"  style="display: none" >
                <p id = "tipButtonContent" class="centerText"> 提示 </p>
            </div>

            <div id = "tipDiv" class="modal" style="display: none">
                <div id="tipModalContent" class="modal-content" >
                    <div id="tipContentDiv">
                        <p id = "tipContent" class="centerText"> 提示內文 </p>
                    </div>
                    <div id = "tipConfirmButton">
                        <p id = "tipConfirmConetent" class="centerText"> 確認 </p>
                    </div>
                </div>
            </div>

            <div id = "startQuiz" class="modal" style="display: none">
                <div id="QuizModalContent" class="modal-content" >
                    <div id="QuizStartContentDiv">
                        <p id = "QuizStartContent" class="centerText"> 點擊開始問答 </p>
                    </div>
                    <div id = "QuizStartButton">
                        <p id = "QuizstartTitle" class="centerText"> 確認 </p>
                    </div>
                </div>
            </div>

            <div id = "makarDragon" style="display: none">
                <img id = "mdTail" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/tail.png"></img>
                <img id = "mdBody" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/body.png"></img>
                <div id = "leftEye">
                <img id = "leftCloseEye" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/close eyes.png"></img>
                <img id = "leftOpenEye" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/open eyes.png"></img>
                </div>
                <img id = "mdOpenEye2" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/open eyes.png"></img>
                <img id = "mdCloseEye" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/close eyes.png"></img>
                <img id = "mdSign" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/sign.png"></img>

                <img id = "imgRight" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/right.png" style="display: none"></img>
                <img id = "imgWrong" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/wrong.png" style="display: none"></img>

                <img id = "mdRightHand" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/right hand.png"></img>
                <img id = "mdLeftHand" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/MD/left hand.png"></img>
            </div>


            <div id="quizEndDiv" class="blocker" style="display: none">
                <img id ="quizEndImg" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/quiz/bg_quiz_zh.png"></img>
            </div>

            <div id="scoreDiv" class="blocker" style="display: none">
                <img id ="scoreImg" src = "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/quiz/bg_quiz_score.png"></img>
                <div id = scoreContentDiv>
                    <p id = "scoreContent"> 目前分數 </p>
                </div>
                <div id ="scoreNumDiv">
                    <p id = "score"> 0 </p>
                </div>
            </div>
            </div> 


            <div id = 'gsapEmpty'></div>
            <a href = "tel:666666" id ="phoneCall"></a>
            <a href = "https://www.miflydesign.com" id ="openWebBrowser" target="_blank" ></a>

            <a href="mailto:infomakar@miflydesign.com" id ="sendEmail"></a>
        `


        // //// 把html標籤都用 js 加到頁面上
        // //// 之後把 tempElement 那個用 innerHTML 的改過來 ?
        // function createDivWithIDandAppend(id, parent=document.body){
        //     const element = document.createElement('div')
        //     // element.classList.add('class-name')
        //     element.setAttribute("id", id);
        //     parent.appendChild(element)
        //     return element;
        // }

        // //// html需要的標籤們
        // const ids = ["homePage", "loadPage", "clickToPlayAudio", "clickToUnMuteVideo", "timerDiv", "tipButtonDiv", "tipDiv", "startQuiz", "makarDragon", "quizEndDiv", "scoreDiv"]
        // let tempArray = []
        // // homePage, loadPage, clickToPlayAudio, clickToUnMuteVideo, timerDiv, tipButtonDiv, tipDiv, startQuiz, makarDragon, quizEndDiv, scoreDiv, 
        // ids.forEach(id=>{
        //     tempArray.push( createDivWithIDandAppend(id, tempElement) )
        // })


        // let [ homePage, loadPage, clickToPlayAudio, clickToUnMuteVideo, timerDiv, tipButtonDiv, tipDiv, startQuiz, makarDragon, quizEndDiv, scoreDiv ] = [...tempArray]
        // homePage.style.display = "block"
        // createDivWithIDandAppend("homeImageContainer", homePage)




        // document.body.appendChild(tempElement)
        tempElement.style.width = "100%"
        tempElement.style.height = "100%"
        tempElement.style.position = "relative"
        tempElement.style.zIndex = "5"
        tempElement.style.pointerEvents = "none"

        this.container.appendChild(tempElement)


        const homePage = document.getElementById("homePage")
        homePage.style.display = "block"
        homePage.style.position = "relative"
        homePage.style.top = "0"
        homePage.style.left = "0"
        homePage.style.width = "100%"
        homePage.style.height = "100%"
        homePage.style.objectFit = "cover"

        const homeImageContainer = document.getElementById("homeImageContainer")
        homeImageContainer.style.position = "relative"
        homeImageContainer.style.top = "0"
        homeImageContainer.style.left = "0"
        homeImageContainer.style.width = "100%"
        homeImageContainer.style.height = "100%"
        // homeImageContainer.style.zIndex = "5"
        homeImageContainer.style.pointerEvents = "none"
        
        //// 這個br不應該縮短 當前用 CSSStyleSheet 的做法(css selector)有可能改動到user的頁面
        //// 目前只能想到給他加上 makarSDK_id 之類的方式    (沒有其他方法嗎)
        const sheet = new CSSStyleSheet();
        sheet.replaceSync(`
            #vrscene {
                cursor: default;
            }

            #freeUserWarnDiv {
                display: none; 
                position: fixed; 
                z-index: 1; 
                left: 0;
                top: 0;
                width: 100%; 
                height: 100%; 
                overflow: auto; 
                background-color: rgba(0,0,0,0.1); 
            
                z-index:3;
                text-align: left;
            }
                    
            #freeUserWarnContent{
                position: absolute;
                top: calc( 50% - 90px );
                left: calc( 50% - 150px);
                width: 300px;
                height: 180px;
            
                background-color: #D9D9D9;
                border-radius: 8px;
            }
            
            @media only screen and (max-width:300px)
            {   
                #freeUserWarnContent{
                top: calc( 50% - 80px );
                left: calc( 50% - 133px);
                width: 266px;
                height: 160px;
                }
            }
            
            #pUserInfo{
                color: black;
                text-align: center;
                font-size: 16pt;
            }
            
            #leaveIframe {
                position: absolute;
                top: 66.66%;
                border-radius: 8px;
                width: 26.66%;
                left: 36.66%;
                background-color:#3973ED;
                z-index: 1;
                padding: 10px;
                text-align: center;
            }
            
            #leaveIframe:active {
                background-color: #274ea1;
            }
            
            #homePage{
                display: block;
                position: relative;
                top:0px;
                width:100%;
                height:100%;
                /* background-color: rgba(128,128,128,0.5); */
                z-index: 1;
                text-align: center;
                font-size: 32pt;
                line-height: 80vh;
                overflow: hidden;
                -webkit-user-select: none;
                user-select: none;
                pointer-events: none;
            }
            
            #loadImg,
            #homeImg{
                width:100%;
                height:100%;
                object-fit: cover;
            }
            
            #loadingImageContainer, #homeImageContainer{
                position: relative;
                top: 0%;
                left: 0%;
                width: 100%;
                height: 100%;
            }
            
            .homePlayImage { 
                position: absolute;
                width: 100%;
                height: 100%;
            
                object-fit: contain;
                display: none;
            }

            .loadingPlayImage.show , .homePlayImage.show {
            display: block;
            }
            
            #clickToPlayAudio , #clickToUnMuteVideo {
                display: none;
                position: absolute;
                top:0px;
                width: 100vw;
                height: 100vh;
                background-color: rgba(128,128,128,0.5);
                z-index: 1;
                text-align: center;
                font-size: 24pt;
                line-height: 90vh;
                overflow: hidden;
                /* -webkit-user-select: none;
                user-select: none;
                pointer-events: none; */
            }
            
            /* 跳轉場景載入頁面 start */
            
            #loadPage{
                display: none;
                position: absolute;
                top:0px;
                width:100vw;
                height:100vh;
                background-color: rgba(128,128,128,0.5);
                z-index: 1;
                text-align: center;
                font-size: 32pt;
                line-height: 80vh;
                overflow: hidden;
                -webkit-user-select: none;
                user-select: none;
                pointer-events: none;
            }
            
            .lds-ellipsis {
                display: inline-block;
                position: relative;
                left: -10px;
                width: 50%;
                height: 20%;
                top:0%;
                font-size: 32pt;
            }
            
            .lds-ellipsis > div {
                position: absolute;
                top: -15px;
                width: 33px;
                height: 33px;
                border-radius: 50%;
                /* background: #000000; */
                animation-timing-function: cubic-bezier(0, 1, 1, 0);
                line-height: 0pt;
            }
            
            .lds-ellipsis img {
                position: absolute;
                top: 0;
                left: 0;
                object-fit: contain;
                width:100%;
                height:100%;
            }
            
            .lds-ellipsis div:nth-child(1) {
                left: 0px;
                animation: lds-ellipsis1 0.6s infinite;
            }
            .lds-ellipsis div:nth-child(2) {
                left: 0px;
                animation: lds-ellipsis2 0.6s infinite;
            }
            .lds-ellipsis div:nth-child(3) {
                left: 16px;
                animation: lds-ellipsis2 0.6s infinite;
            }
            .lds-ellipsis div:nth-child(4) {
                left: 32px;
                animation: lds-ellipsis2 0.6s infinite;
            }
            .lds-ellipsis div:nth-child(5) {
                left: 48px;
                animation: lds-ellipsis3 0.6s infinite;
            }
            
            @keyframes lds-ellipsis1 {
                0% {
                /* transform: scale(0); */
                opacity: 0;
                }
                100% {
                /* transform: scale(1); */
                opacity: 1;
                }
            }
            @keyframes lds-ellipsis3 {
                0% {
                /* transform: scale(1); */
                opacity: 1;
                }
                100% {
                /* transform: scale(0); */
                opacity: 0;
                }
            }
            @keyframes lds-ellipsis2 {
                0% {
                transform: translate(0, 0);
                }
                100% {
                transform: translate(16px, 0);
                }
            }
            
            /* 跳轉場景載入頁面 end */
            
            
            #homeStartButton{
                display: none;
                position: absolute;
                bottom: 9%;
                border-radius: 100px;
                width: 60%;
                left:20%;
                /* height: 100px; */
                background-color:#1ADAD6;
                z-index: 1;
                padding: 20px;
                text-align: center;
            }
            
            #homeStartP{
                margin:0px;
                font-size: 20px;
                color:white;
            }
            
            /* 留著這個作為提醒: 這樣子會讓user的頁面出現他預期不到的變化*/
            hr {
                position: relative;
                top: 0px;
                left: 0px;
                width: 90%;
                border: 1px solid #4a4d54;
            }
            
            #bottomProjs {
                position:absolute;
                float:left;
                bottom:100px;
                right:0px;
                height:34px;
                width: 120px;
                z-index:2;
                cursor:pointer;
            
                border-top-left-radius: 5px;
                background: rgba(49, 51, 63, 0.85); 
            
                transition: bottom .1s ease-in-out;
                -webkit-transition: bottom .1s ease-in-out;
                -moz-transition: bottom .1s ease-in-out;
            }
            
            #bottomProjs.collapsed {
                bottom:0px;
                right:0px;
                height:34px;
                width: 120px;
            
            }
            
            #bottomProjs h4 {
                text-align: left;
                margin: 1px;
                padding-left: 10px;
            
                color: rgba(200, 200, 200, 1.0);
            }
            
            
            #bottomProjs i {
                border: solid rgba(255, 255, 255, 1.0);
                border-width: 0 3px 3px 0;
                display: inline-block;
                padding: 3px;
            
                transform: rotate(45deg);
                -webkit-transform: rotate(45deg);
            }
            
            #bottomProjs i.collapsed {
                transform: rotate(-135deg);
                -webkit-transform: rotate(-135deg);
            }
            
            #projsInfo {
                position:absolute;
                bottom:0;
                float:left;
                right:0px;
                width:100%;
                height:100px;
                cursor:pointer;
                overflow-x:auto;
                overflow-y:hidden;
                text-align:center;
                z-index:2;
                background: rgba(49, 51, 63, 0.85); 
            
                transition: height .1s ease-in-out;
                -webkit-transition: height .1s ease-in-out;
                -moz-transition: height .1s ease-in-out;
            }
            
            #projsInfo.collapsed {
                height:1px;
            }
            
            #projsTable{
                float: left;
                margin-top: 5px;
                left: 0px;
                position: relative;
                border-spacing: 0px;
            }
            
            #proj_name{
                font-size: 12px;
                color: white;
            }
            
            #leftTopButton {
                position: absolute;
                top: 20px;
                left: 10px;
                cursor:pointer;
                z-index: 2;
            
                user-select: none;
            }
            
            #leftTopButton p {
                color: rgba(200,200,200,1.0);
                font-size: 24px;
                margin: 10px;
            }
            
            #leftTopArrow{
                vertical-align: -10%;
                width:25px;
                height:25px;
            }
            
            .projNameOneRow{
                width:50px;
                text-align: center;
                overflow: hidden;
                white-space : nowrap;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 1;
            }
            
            
            .circular--square {
                border-radius: 50%;
            }
            
            .circular--square-marker {
                
                border-width: 3px;
                border-style: solid;
                -webkit-border-radius: 50%;
                -moz-border-radius: 50%;
            
                border-radius: 50%;
                border-color: rgb(33, 184, 187);
            }
            
            /* The Modal (background) */
            .modal {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                z-index: 1; /* Sit on top */
                left: 0;
                top: 0;
                width: 100%; /* Full width */
                height: 100%; /* Full height */
                overflow: auto; /* Enable scroll if needed */
                background-color: rgb(0,0,0); /* Fallback color */
                background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            
                z-index:3;
                text-align: left;
            }
            /* Modal Content/Box */
            .modal-content {
            
                position: relative;
                background-color: #202125;
                margin: 3% auto;
                border-radius: 16px;
                width: 85vw;
                height: 85vh;
                overflow: auto;
            
            }
            
            .modal-content > div {
                position: relative;
                margin-left: 2%;
                margin-right: 2%;
                width: 90%;
            }
            
            #projectTypeDiv{
                position: relative;
                /* width:90%; */
                margin-top: 15px;
                min-height: 30px;
            }
            
            #projectTypeImg{
                position: absolute;
                width:30px;
                height:30px;
                left:5px ;
                /* bottom: 6px; */
            }
            
            #projectTypeInfo{
                position: relative;
                font-size: 12pt;
                color: #8b93a6;
                left:  45px ;
            }
            
            #projectNameDiv{
                position: relative;
                width:95%;
                margin-top: 20px;
            }
            
            #projectNameInfo {
                margin:0px;
                font-size: 14pt;
                color: #ffffff;
            }
            
            #projectUserImage {
                width: 30px;
                height: 30px;
                margin-top: 5px;
                border-radius: 50%;
            }
            
            #projectUserName {
                position: relative;
                top: -12px;
                margin-left: 5px;
                font-size: 9pt;
                color: #8b93a6;
            }
            
            #projectLastUpdateDate {
                position: absolute;
                font-size: 9pt;
                right: 0%;
                top: 40px;
                color: #8b93a6;
            }
            
            #scanList{
                position: relative;
            }
            
            #projectUsageDiv{
                margin-top: 7px;
                position: relative;
            
            }
            
            #projectDescriptionDiv
            {
                margin-top: 5px;
                position: relative;
            }
            
            #scanListTitle,
            #projectUsageTitle,
            #projectDescriptionTitle
            {
                margin-top: 3px;
                font-size: 10pt;
                margin: 0px;
                color: #8b93a6;
            }
            
            #projectUsageInfo{
                color:#ffffff;
                font-size: 8pt;
                margin: 0px;
            }
            
            #projectDescription
            {
                color:#ffffff;
                overflow-y: auto;
                font-size: 8pt;
                margin: 0px;
                height: 40px;
            }
            
            #projectPicture{
                height:100px;
            }
            
            #projectPicture > img {
                margin-top: 3px;
                margin-right: 15px;
                width: 90px;
                height: 90px;
            }
            
            #scanListEndLine{
                display: none;
            }
            
            #projectGPSDiv{
                color:#8b93a6;
                margin-top: 7px;
                position: relative;
                display: none;
                /* margin-bottom: 3px; */
            }
            #projectGPStitle{
                font-size: 10pt;
                margin:2px;
            }
            
            #projectGPSInfo{
                background-color: #4a4d54;
                border-radius:10px;
                padding-left:10px;
                padding-top:3px;
                padding-bottom:3px;
                font-size: 8pt;
                color: rgba(240,240,240,1);
            }
            #projectGPSDivEndLine{
                display: none;
            }
            
            #projectStartButton {
                position: absolute;
                bottom: 10px;
                width: 96%;
                height: 54px;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
                border: 0;
                padding: 0px 0 0 0px;
                background: #31333f;
                cursor: pointer;
            }
            
            #projectStartButton:active {
                background-color: #4a4d54;
            }
            
            #startTitle{
                position: relative;
                top:16px;
                margin: 0px;
                font-size: 12pt;
                left:calc( 25% + 20px  ) ;
                width:50%;
            }
            
            #startBGImage{
                position: absolute;
                width:40px;
                height:40px;
                left:calc(50% - 90px) ;
                bottom: 6px;
            }
            
            /* The Close Button */
            .close {
                color: #aaa;
                /* float: right; */
                position: absolute;
                top: 10px;
                right: 10px;
                font-size: 18px;
                font-weight: bold;
                cursor: pointer;
            }
            
            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            } 
            
            
            #timerDiv{
            
                position: absolute;
                top: 15%;
                /* margin-left: 2%; */
                left:calc(50% - 50px) ;
                width: 100px;
                height: 30px;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
            
                background: #18e2d8de;
                z-index: 1;
            
            }
            
            #tipButtonDiv{
            
                position: absolute;
                top: 20%;
                /* margin-left: 2%; */
                left:calc(50% - 40px) ;
                width: 80px;
                height: 30px;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
            
                background: #18e2d8de;
                z-index: 1;
                cursor: pointer;
            
            }
            
            #tipContentDiv{
            
                position: absolute;
                top: 20px;
                /* margin-left: 2%; */
            
                width: 96%;
                height: 85%;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
            
            }
            
            #tipConfirmButton{
            
                position: absolute;
                bottom: 10px;
                /* margin-left: 2%; */
            
                width: 96%;
                height: 54px;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
            
                border: 0;
                /* 273 = 203 + 45 + 25 */
                padding: 0px 0 0 0px;
                /* background: 203px 34px / 45px 45px no-repeat url(/images/icon/start/start.png),#31333f; */
                background: #31333f;
                cursor: pointer;
                pointer-events:"none";
            }
            
            #tipConfirmButton:active {
                background-color: #4a4d54;
            }
            
            
            #QuizStartContentDiv{
            
                position: absolute;
                top: 20px;
                /* margin-left: 2%; */
            
                width: 96%;
                height: 85%;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
            
            }
            
            #QuizStartButton{
            
                position: absolute;
                bottom: 10px;
                /* margin-left: 2%; */
            
                width: 96%;
                height: 54px;
                border-radius: 16px;
                color: #ffffff;
                text-align: center;
            
                border: 0;
                /* 273 = 203 + 45 + 25 */
                padding: 0px 0 0 0px;
                /* background: 203px 34px / 45px 45px no-repeat url(/images/icon/start/start.png),#31333f; */
                background: #31333f;
                cursor: pointer;
                pointer-events:"none";
            }
            
            #QuizStartButton:active {
                background-color: #4a4d54;
            }
            
            .centerText {
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                white-space:nowrap;
            }
            
            .blocker {
                position: absolute;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.7);
                z-index: 1;
            }
            
            #quizEndImg{
                position: absolute;
                top:50%;
                left:50%;
                height:80%;
                transform: translate(-50%, -50%);
                z-index: 1;
            
            }
            
            #scoreImg{
                position: absolute;
                top:50%;
                left:50%;
                height:70%;
                transform: translate(-50%, -50%);
                z-index: 1;
            
            }
            
            #scoreContentDiv{
                position: absolute;
                top:60%;
                left:50%;
                width: 100%;
                height: 20%;
                transform: translate(-50%, -50%);
                z-index: 1;
            }
            
            #scoreContent{
                margin: 0;
                position: absolute;
                top:50%;
                left:50%;
                font-size: 30px;
                transform: translate(-50%, -50%);
                z-index: 1;
            }
            
            #scoreNumDiv{
                position: absolute;
                top:33%;
                left:50%;
                width: 50%;
                height: 20%;
                transform: translate(-50%, -50%);
                z-index: 1;
            }
            
            #score{
                margin: 0;
                position: absolute;
                top:50%;
                left:50%;
                font-size: 100px;
                transform: translate(-50%, -50%);
                z-index: 1;
                color: #ffffff;
            }
        `);
        document.adoptedStyleSheets.push(sheet);


    }



    //// 準備並開始載入場景
    load(){
        console.log("\n MakarSDK loading \n", "config=", this.config)


        setTimeout( () => {

            console.log("makarVR.html: document is ready");

            //// 建制「起始載入動畫」
            // let imageBase = 'https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/Loading_20220630/Loading_An000';
            let homeImageContainer = document.getElementById('homeImageContainer');

            // homeImageContainer.style.


            let hicw = homeImageContainer.clientWidth;
            let hich = homeImageContainer.clientHeight;
            let imgW = ( hicw > 210 ) ?  210 : hicw;
            let imgH = ( hich > 240 ) ?  240 : hich;

            console.log('_makarVR.html: hicw h = ', hicw , hich );

            for( let i = 0; i < 30; i++ ){
                let strIndex = '';
                if (i < 10){
                    strIndex = String( '0'+ i ) ;
                }else{
                    strIndex = String( i );
                }
                let imgElement = document.createElement('img');
                //// 調整位置大小
                imgElement.style.top = (hich - imgH)/2 + 'px' ; 
                imgElement.style.left = (hicw - imgW)/2 + 'px' ; 
                imgElement.style.width = imgW + 'px' ;
                imgElement.style.height = imgH + 'px' ;
                
                imgElement.setAttribute('src', this.imageBase + strIndex + '.png' );
                imgElement.classList.add('homePlayImage');
                homeImageContainer.appendChild( imgElement );

            }
            let homePlayImages = document.getElementsByClassName('homePlayImage');
            // console.log(' homePlayImages length ' , homePlayImages.length  );

            this.homeTickOn = true;
            let homeImageCount = 0;
            let playHomeImageTick = () => {

                //// 假如累積播放到最後一張，則記數歸零
                if ( homeImageCount > homePlayImages.length - 1 ){
                    homeImageCount = 0;
                }

                if ( homePlayImages[ homeImageCount ] ){

                    homePlayImages[ homeImageCount ].classList.add('show');

                    if ( homeImageCount > 0 ){
                        homePlayImages[ homeImageCount - 1 ].classList.remove('show');
                    }else{
                        homePlayImages[ homePlayImages.length - 1 ].classList.remove('show');
                    }

                    if ( homeImageCount < homePlayImages.length - 1 ){
                        homePlayImages[ homeImageCount + 1 ].classList.remove('show');
                    }else{
                        homePlayImages[ 0 ].classList.remove('show');
                    }
                }
                // console.log("homeImageCount", homeImageCount)
                homeImageCount++;

                //// 起始畫面，只要載入完成，就不會再使用了
                if ( this.homeTickOn == true ){
                    setTimeout( playHomeImageTick , 50 );
                }
                // requestAnimationFrame(playHomeImageTick); 
                
            }
            playHomeImageTick(); //// 執行

            //// 判斷是 3.4 或 3.5 再呼叫對應的 showVRProjectList()
            showVRProjListWithVersionControl()
            //// 覺得需要有一個return/event/then來得知 "showVRProjListWithVersionControl" 完成了      還需要判斷是ar/xr/vr
            

            //// 在 vr html 裡看到的 好像SDK可以有類似的概念
            // document.getElementById("testButton").onclick = showVRProjList;


            //// 實在找不到哪裡改的
            document.body.style.cursor = "default"
            //// 怎麼改都沒有用阿


            //// 調整html元素在視覺上的位置
            this.container.addEventListener("vrDivReady", (e) => {
                console.log("vrDivReady e=", e)
                document.getElementById("vrDiv").style.top = "-100%"
                
                if(  e.detail.vrDiv ){
                    console.log("vrDivReady vrDiv=", this.vrDiv)
                    this.vrDiv = e.detail.vrDiv
                    
                    //// 場景載入: 接收 vrDiv 傳來的 vrScene 物件載入完成的 custom event
                    this.vrDiv.addEventListener("vrSceneObjsLoaded", (e)=>{
                        console.log("vrSceneObjsLoaded e=", e)
                        const sceneId = e.detail.sceneId

                        let sceneData = this.scenesData.find(s => s.get(sceneId))
                        if( !sceneData ){
                            //// 表示這個場景沒載入過
                            sceneData = new Map([
                                ['sceneId', sceneId],
                                ['sceneObjs3D', new Map()],
                                ['sceneObjs2D', new Map()],
                                ['timelineDict', {}],
                                
                                // ['scene', vrScene],
                            ])
                            this.scenesData.push( sceneData )
                        }
                        this.currentSceneData = sceneData


                        const [sceneObjs3D, sceneObjs2D] = this.getCurrentSceneObjs(sceneData)
                        // console.log("場景物件載入完成, \n sceneObjs3D=", sceneObjs3D, "\n sceneObjs2D=", sceneObjs2D)
                        console.log("場景物件載入完成, \n this.scenesData=", this.scenesData)

                        const vrSceneLoaded = new CustomEvent("vrSceneLoaded", {
                            detail: {
                                name: "vrSceneLoaded",
                                // scene: vrScene
                            },
                        });
                        vrDiv.dispatchEvent(vrSceneLoaded);

                                
                        document.addEventListener('keydown', (event)=>{

                            // 阻止使用AWSD鍵移動
                            if (event.key === 'w' || event.key === 'a' || event.key === 's' || event.key === 'd') {
                                event.stopPropagation();
                            }

                        })
                        

                    })
                }
                
            })
            



        }, 50 );


    }

    //// 讓user可輕鬆取得場景物件  目前規劃為物件都載入後呼叫 getCurrentSceneObjs
    getCurrentSceneObjs(sceneData = this.currentSceneData){

        //// 先試試 array 的寫法
        this.sceneObjs3D_arr = [];
        this.sceneObjs2D_arr = [];
 
        sceneData.set('sceneObjs3D', new Map());
        sceneData.set('sceneObjs2D', new Map());
        
        this.currentActiveController.scenesData.scenes[this.currentActiveController.currentSceneIndex].objs.forEach(jsonObj => {
            if ( jsonObj.res_id != "camera" ) {

                let getObj = this.currentActiveController.getObjectTypeByObj_id( jsonObj.generalAttr.obj_id )
                
                getObj.obj_id = jsonObj.generalAttr.obj_id
                getObj.obj = (getObj.obj_type == "3d") ? getObj.obj.object3D : getObj.obj;
                
                let _sceneObjsMap = (getObj.obj_type == "3d") ? sceneData.get('sceneObjs3D') : sceneData.get('sceneObjs2D');
                _sceneObjsMap.set(getObj.obj_id, getObj);

                let _sceneObjs_arr = (getObj.obj_type == "3d") ? this.sceneObjs3D_arr : this.sceneObjs2D_arr;
                _sceneObjs_arr.push(getObj);

            }
        });

        return [sceneData.get('sceneObjs3D'), sceneData.get('sceneObjs2D')]

        //// todo: 如果user在同一個場景呼叫 直接return結果
    }


    //// ---  準備一些給user自由使用的基本互動功能  ---

    //// 顯示/隱藏物件
    toggleShowHide(sceneObj){
        sceneObj.visible = !sceneObj.visible;
    }

    //// 直接設定物件位置
    setSceneObjPosition(sceneObj, position=[0,2,2]){
        sceneObj.position.set(position[0], position[1], position[2]);
    }

    //// gsap動畫 - 移動物件 到某處 花幾秒
    moveSceneObjTo(sceneObj, position=[0,2,2], duration=2){
        let tl = _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.timeline();
        this.currentSceneData.get('timelineDict')[ sceneObj.obj_id ] = tl ;
        tl.to(sceneObj.position, {
            'duration': duration,
            'delay': 0, 
            // 'ease': 'none',
            'ease': "elastic.out(1,0.3)",
            'x' : position[0],
            'y' : position[1],
            'z' : position[2]
        });
    }

    //// 翻桌    數值來自經驗法則與視覺效果
    flipTheTable(){
        if(this.currentSceneData){
            this.currentSceneData.get('sceneObjs3D').forEach((objData,i)=>{
                let tl = _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.timeline();
                this.currentSceneData.get('timelineDict')[ objData.obj_id ] = tl ;
                tl.to(objData.obj.position, {
                    'duration': Math.random()*10,
                    'delay': 0, 
                    'ease': "elastic.out(1,0.2)",
                    'x' : Math.random()*20-10,
                    'y' : Math.random()*20-10,
                    'z' : Math.random()*20+5
                });
                
                let tl_rotation = _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.timeline();
                tl_rotation.to(objData.obj.rotation, {
                    'duration': Math.random()*10,
                    'delay': 0, 
                    'ease': "power4.out",
                    'x' : Math.random()*20,
                    'y' : Math.random()*20,
                    'z' : Math.random()*20
                });
            })
            
            this.currentSceneData.get('sceneObjs2D').forEach((objData,i)=>{
                let tl = _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.timeline();
                this.currentSceneData.get('timelineDict')[ objData.obj_id ] = tl ;
                tl.to(objData.obj.position, {
                    'duration': Math.random()*10,
                    'delay': 0, 
                    'ease': "elastic.out(1,0.3)",
                    'x' : Math.random()*1000 - 500,
                    'y' : Math.random()*1000 - 500
                });
                let tl_scale = _node_modules_gsap_src_index_js__WEBPACK_IMPORTED_MODULE_1__.gsap.timeline();
                tl_scale.to(objData.obj.scale, {
                    'duration': Math.random()*2,
                    'delay': 0, 
                    'ease': "elastic.out(1,0.3)",
                    'x' : _commonTools_js__WEBPACK_IMPORTED_MODULE_5__["default"].gaussianRandom(),
                    'y' : _commonTools_js__WEBPACK_IMPORTED_MODULE_5__["default"].gaussianRandom()
                });
            })
        }
    }


    //// 新增一個function給tick的時候執行
    workWithRenderTick( callbackID, callback ){
        // console.log("makarSDK", this)
        if( typeof(callback)==='function' ){
            // console.log("makarSDK ", callback)
            this.workWithRenderTick_callbacks[callbackID] = callback
        }

        for (const [key, value] of Object.entries(this.workWithRenderTick_callbacks)) {
            // console.log(`${key}: ${value}`);
            value()
        }

        
    }


    //// 先在這裡讓 makarObject 對 BoxObserver 之間是 FlyWieght 模式
    createObserver(obj_id){
        let observer = this.getObserver(obj_id);
        if (observer) {
            return observer;
        } else {
            const newObserver = new _EventSubject_js__WEBPACK_IMPORTED_MODULE_6__.BoxObserver(obj_id);
            this.loadedObservers.push(newObserver);
            return newObserver;
        }
    }
    getObserver(obj_id){
        return this.loadedObservers.find(observer => observer.obj_id === obj_id);
    }

    //// 播放動畫: 依照狀態列表 建立"主題, 觀察者們"
    startEventList( stateConfig ){
        
        //// 初始化: 每次都新建一個主題
        const makarSubject = new _EventSubject_js__WEBPACK_IMPORTED_MODULE_6__.Subject(stateConfig);
        
        // makarSubject.stateConfig = stateConfig;

        this.makarSubject = makarSubject
        // console.log( "stateConfig.stateNames", stateConfig.stateNames)

        ////

        stateConfig.stateMap.forEach( state => {
            console.log("state", state)
            const objObserver = this.createObserver( state.obj_id );
            makarSubject.attach(objObserver)
            console.log("new objObserver", objObserver)
        })



        // makarSubject.triggerState( stateConfig.stateNames[stateConfig.startIndex] );
        makarSubject.triggerState(stateConfig.startIndex);


    }

}


////  todo: 預想的使用方式 - 使用事件
// dispatch the events
// document.dispatchEvent(window.makarSDK.constructorEvent);

//// 目前user確認頁面載入後 可直接取用 window.makarSDK
const config = { proj_id: "5d6f66e5-1eb8-40c3-8951-558ee450dc34" }
window.makarSDK = new MakarSDK(config)



/***/ }),

/***/ "./js/VrSdk/vrVersionControl.js":
/*!**************************************!*\
  !*** ./js/VrSdk/vrVersionControl.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _VRMain_version3_5_networkAgent_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../VRMain/version3_5/networkAgent.js */ "./js/VRMain/version3_5/networkAgent.js");
/* harmony import */ var _VRMain_version3_5_MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../VRMain/version3_5/MakarWebXRVersionControl.js */ "./js/VRMain/version3_5/MakarWebXRVersionControl.js");



( () => {

    // get publishVRProjs and VRSceneResult for version control
    // 進行版本判斷 (3.4 or 3.5)
    // 用 js ESM 動態 import 
    window.showVRProjListWithVersionControl = () => {
        
        console.log("這裡?")

        let pList = [];
        // const proj_id = "5d6f66e5-1eb8-40c3-8951-558ee450dc34"

        // if ( parent && parent.selectedProject && parent.selectedProject.proj_id ){
        if ( makarSDK && makarSDK.config && makarSDK.config.proj_id ){
            pList.push( makarSDK.config.proj_id );
            
            //// url 暫時先這樣處理 感覺不適合去動其他script
            console.log("_getProjectInfoList_ net.url", _VRMain_version3_5_networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].url )
            _VRMain_version3_5_networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].url = "https://ssl-api-makar-v3-apps.miflyservice.com/Makar/"

            let pScenes = _VRMain_version3_5_networkAgent_js__WEBPACK_IMPORTED_MODULE_0__["default"].getProjectInfoList( pList, makarSDK.config.user_id );
            pScenes.then(  async function( ret ){

                console.log('_getProjectInfoList_: ' , ret );

                if ( ret && ret.data && Array.isArray( ret.data.projects ) &&
                    ret.data.projects.length == 1
                ){
                    let oneProjData = ret.data.projects[0];                    
                    let vo = _VRMain_version3_5_MakarWebXRVersionControl_js__WEBPACK_IMPORTED_MODULE_1__.verionControl.getProjDataEditorVer( oneProjData );

                    console.log('_getProjectInfoList_: vo' , vo );

                    //// 先判斷是 3碼 還是 4碼。
                    if ( Number.isInteger( Number( vo.v3 ) ) ){
                        //// 目前支援 v3.5.0.0
                        if ( vo.v0 == 3 && vo.v1 >= 5 ){

                            await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../VRMain/version3_5/VRFunc.js */ "./js/VRMain/version3_5/VRFunc.js"));    
                            showVRProjList( oneProjData );     
                        }

                    }else{
                        //// 支援 3.1.0 - 3.4.0
                        if ( vo.v0 == 3 && vo.v1 >= 1 ){
                            await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../VRMain/version3_4/VRFunc.js */ "./js/VRMain/version3_4/VRFunc.js"));    
                            showVRProjList();      
                        }
                    }


                } else{

                    if ( ret && ret.error ){
                        console.log(`%c got data but with error:${ret.error}, ret=`, 'color:tomato;font-size:1rem', ret)
                        console.log(`%c might be the case of user_id does not get permission of the project with proj_id`, 'color:tomato;')

                        //// SDK 應該需要一個流程 顯示錯誤訊息、或是給出原因讓user能接著進行錯誤處理
                    } else {
                        //// 測試用 直接開3.4.0   
                        //// 不明原因的錯誤
                        await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../VRMain/version3_4/VRFunc.js */ "./js/VRMain/version3_4/VRFunc.js"));    
                        showVRProjList();      
                    }

                }
            });

        }

    }

})();

/***/ }),

/***/ "./js/VrSdk/whiteList.min.js":
/*!***********************************!*\
  !*** ./js/VrSdk/whiteList.min.js ***!
  \***********************************/
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {


console.log("WhiteList");

var key,Module=void 0!==Module?Module:{},moduleOverrides={};for(key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);Module.arguments=[],Module.thisProgram="./this.program",Module.quit=function(e,r){throw r},Module.preRun=[],Module.postRun=[];var nodeFS,nodePath,ENVIRONMENT_IS_WEB=!1,ENVIRONMENT_IS_WORKER=!1,ENVIRONMENT_IS_NODE=!1,ENVIRONMENT_IS_SHELL=!1;if(Module.ENVIRONMENT)if("WEB"===Module.ENVIRONMENT)ENVIRONMENT_IS_WEB=!0;else if("WORKER"===Module.ENVIRONMENT)ENVIRONMENT_IS_WORKER=!0;else if("NODE"===Module.ENVIRONMENT)ENVIRONMENT_IS_NODE=!0;else{if("SHELL"!==Module.ENVIRONMENT)throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");ENVIRONMENT_IS_SHELL=!0}else ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&"function"=="function"&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;ENVIRONMENT_IS_NODE?(Module.read=function(e,r){var n;return(n=tryParseAsDataURI(e))||(nodeFS||(nodeFS=__webpack_require__(/*! fs */ "?30e5")),nodePath||(nodePath=__webpack_require__(/*! path */ "?c470")),e=nodePath.normalize(e),n=nodeFS.readFileSync(e)),r?n:n.toString()},Module.readBinary=function(e){var r=Module.read(e,!0);return r.buffer||(r=new Uint8Array(r)),assert(r.buffer),r},process.argv.length>1&&(Module.thisProgram=process.argv[1].replace(/\\/g,"/")),Module.arguments=process.argv.slice(2), true&&(module.exports=Module),process.on("uncaughtException",function(e){if(!(e instanceof ExitStatus))throw e}),process.on("unhandledRejection",function(e,r){process.exit(1)}),Module.inspect=function(){return"[Emscripten Module object]"}):ENVIRONMENT_IS_SHELL?("undefined"!=typeof read&&(Module.read=function(e){var r=tryParseAsDataURI(e);return r?intArrayToString(r):read(e)}),Module.readBinary=function(e){var r;return(r=tryParseAsDataURI(e))?r:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(assert("object"==typeof(r=read(e,"binary"))),r)},"undefined"!=typeof scriptArgs?Module.arguments=scriptArgs:"undefined"!=typeof arguments&&(Module.arguments=arguments),"function"==typeof quit&&(Module.quit=function(e,r){quit(e)})):(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(Module.read=function(e){try{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText}catch(r){var n=tryParseAsDataURI(e);if(n)return intArrayToString(n);throw r}},ENVIRONMENT_IS_WORKER&&(Module.readBinary=function(e){try{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}catch(r){var n=tryParseAsDataURI(e);if(n)return n;throw r}}),Module.readAsync=function(e,r,n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){if(200==t.status||0==t.status&&t.response)r(t.response);else{var i=tryParseAsDataURI(e);i?r(i.buffer):n()}},t.onerror=n,t.send(null)},"undefined"!=typeof arguments&&(Module.arguments=arguments),Module.setWindowTitle=function(e){document.title=e});for(key in Module.print="undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null,Module.printErr="undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||Module.print,Module.print=Module.print,Module.printErr=Module.printErr,moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);moduleOverrides=void 0;var STACK_ALIGN=16;function staticAlloc(e){assert(!staticSealed);var r=STATICTOP;return STATICTOP=STATICTOP+e+15&-16,r}function dynamicAlloc(e){assert(DYNAMICTOP_PTR);var r=HEAP32[DYNAMICTOP_PTR>>2],n=r+e+15&-16;if((HEAP32[DYNAMICTOP_PTR>>2]=n,n>=TOTAL_MEMORY)&&!enlargeMemory())return HEAP32[DYNAMICTOP_PTR>>2]=r,0;return r}function alignMemory(e,r){return r||(r=STACK_ALIGN),e=Math.ceil(e/r)*r}function getNativeTypeSize(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return 4;if("i"===e[0]){var r=parseInt(e.substr(1));return assert(r%8==0),r/8}return 0}}function warnOnce(e){warnOnce.shown||(warnOnce.shown={}),warnOnce.shown[e]||(warnOnce.shown[e]=1,Module.printErr(e))}var jsCallStartIndex=1,functionPointers=new Array(0);function addFunction(e,r){for(var n=0;n<0;n++)if(!functionPointers[n])return functionPointers[n]=e,jsCallStartIndex+n;throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."}function removeFunction(e){functionPointers[e-jsCallStartIndex]=null}var funcWrappers={};function getFuncWrapper(e,r){if(e){assert(r),funcWrappers[r]||(funcWrappers[r]={});var n=funcWrappers[r];return n[e]||(1===r.length?n[e]=function(){return dynCall(r,e)}:2===r.length?n[e]=function(n){return dynCall(r,e,[n])}:n[e]=function(){return dynCall(r,e,Array.prototype.slice.call(arguments))}),n[e]}}function makeBigInt(e,r,n){return n?+(e>>>0)+4294967296*+(r>>>0):+(e>>>0)+4294967296*+(0|r)}function dynCall(e,r,n){return n&&n.length?Module["dynCall_"+e].apply(null,[r].concat(n)):Module["dynCall_"+e].call(null,r)}var Runtime={dynCall:dynCall},GLOBAL_BASE=8,ABORT=0,EXITSTATUS=0;function assert(e,r){e||abort("Assertion failed: "+r)}var globalScope=this;function getCFunc(e){var r=Module["_"+e];return assert(r,"Cannot call unknown function "+e+", make sure it is exported"),r}var JSfuncs={stackSave:function(){stackSave()},stackRestore:function(){stackRestore()},arrayToC:function(e){var r=stackAlloc(e.length);return writeArrayToMemory(e,r),r},stringToC:function(e){var r=0;if(null!=e&&0!==e){var n=1+(e.length<<2);stringToUTF8(e,r=stackAlloc(n),n)}return r}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};function ccall(e,r,n,t,i){var a=getCFunc(e),o=[],u=0;if(t)for(var l=0;l<t.length;l++){var f=toC[n[l]];f?(0===u&&(u=stackSave()),o[l]=f(t[l])):o[l]=t[l]}var c=a.apply(null,o);return"string"===r&&(c=Pointer_stringify(c)),0!==u&&stackRestore(u),c}function cwrap(e,r,n){n=n||[];var t=getCFunc(e),i=n.every(function(e){return"number"===e});return"string"!==r&&i?t:function(){return ccall(e,r,n,arguments)}}function setValue(e,r,n,t){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":HEAP8[e>>0]=r;break;case"i16":HEAP16[e>>1]=r;break;case"i32":HEAP32[e>>2]=r;break;case"i64":tempI64=[r>>>0,(tempDouble=r,+Math_abs(tempDouble)>=1?tempDouble>0?(0|Math_min(+Math_floor(tempDouble/4294967296),4294967295))>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=r;break;case"double":HEAPF64[e>>3]=r;break;default:abort("invalid type for setValue: "+n)}}function getValue(e,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":return HEAP8[e>>0];case"i16":return HEAP16[e>>1];case"i32":case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for getValue: "+r)}return null}var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;function allocate(e,r,n,t){var i,a;"number"==typeof e?(i=!0,a=e):(i=!1,a=e.length);var o,u="string"==typeof r?r:null;if(o=n==ALLOC_NONE?t:["function"==typeof _malloc?_malloc:staticAlloc,stackAlloc,staticAlloc,dynamicAlloc][void 0===n?ALLOC_STATIC:n](Math.max(a,u?1:r.length)),i){var l;for(t=o,assert(0==(3&o)),l=o+(-4&a);t<l;t+=4)HEAP32[t>>2]=0;for(l=o+a;t<l;)HEAP8[t++>>0]=0;return o}if("i8"===u)return e.subarray||e.slice?HEAPU8.set(e,o):HEAPU8.set(new Uint8Array(e),o),o;for(var f,c,s,d=0;d<a;){var A=e[d];0!==(f=u||r[d])?("i64"==f&&(f="i32"),setValue(o+d,A,f),s!==f&&(c=getNativeTypeSize(f),s=f),d+=c):d++}return o}function getMemory(e){return staticSealed?runtimeInitialized?_malloc(e):dynamicAlloc(e):staticAlloc(e)}function Pointer_stringify(e,r){if(0===r||!e)return"";for(var n,t=0,i=0;t|=n=HEAPU8[e+i>>0],(0!=n||r)&&(i++,!r||i!=r););r||(r=i);var a="";if(t<128){for(var o;r>0;)o=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(r,1024))),a=a?a+o:o,e+=1024,r-=1024;return a}return UTF8ToString(e)}function AsciiToString(e){for(var r="";;){var n=HEAP8[e++>>0];if(!n)return r;r+=String.fromCharCode(n)}}function stringToAscii(e,r){return writeAsciiToMemory(e,r,!1)}var UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function UTF8ArrayToString(e,r){for(var n=r;e[n];)++n;if(n-r>16&&e.subarray&&UTF8Decoder)return UTF8Decoder.decode(e.subarray(r,n));for(var t,i,a,o,u,l="";;){if(!(t=e[r++]))return l;if(128&t)if(i=63&e[r++],192!=(224&t))if(a=63&e[r++],224==(240&t)?t=(15&t)<<12|i<<6|a:(o=63&e[r++],240==(248&t)?t=(7&t)<<18|i<<12|a<<6|o:(u=63&e[r++],t=248==(252&t)?(3&t)<<24|i<<18|a<<12|o<<6|u:(1&t)<<30|i<<24|a<<18|o<<12|u<<6|63&e[r++])),t<65536)l+=String.fromCharCode(t);else{var f=t-65536;l+=String.fromCharCode(55296|f>>10,56320|1023&f)}else l+=String.fromCharCode((31&t)<<6|i);else l+=String.fromCharCode(t)}}function UTF8ToString(e){return UTF8ArrayToString(HEAPU8,e)}function stringToUTF8Array(e,r,n,t){if(!(t>0))return 0;for(var i=n,a=n+t-1,o=0;o<e.length;++o){var u=e.charCodeAt(o);if(u>=55296&&u<=57343&&(u=65536+((1023&u)<<10)|1023&e.charCodeAt(++o)),u<=127){if(n>=a)break;r[n++]=u}else if(u<=2047){if(n+1>=a)break;r[n++]=192|u>>6,r[n++]=128|63&u}else if(u<=65535){if(n+2>=a)break;r[n++]=224|u>>12,r[n++]=128|u>>6&63,r[n++]=128|63&u}else if(u<=2097151){if(n+3>=a)break;r[n++]=240|u>>18,r[n++]=128|u>>12&63,r[n++]=128|u>>6&63,r[n++]=128|63&u}else if(u<=67108863){if(n+4>=a)break;r[n++]=248|u>>24,r[n++]=128|u>>18&63,r[n++]=128|u>>12&63,r[n++]=128|u>>6&63,r[n++]=128|63&u}else{if(n+5>=a)break;r[n++]=252|u>>30,r[n++]=128|u>>24&63,r[n++]=128|u>>18&63,r[n++]=128|u>>12&63,r[n++]=128|u>>6&63,r[n++]=128|63&u}}return r[n]=0,n-i}function stringToUTF8(e,r,n){return stringToUTF8Array(e,HEAPU8,r,n)}function lengthBytesUTF8(e){for(var r=0,n=0;n<e.length;++n){var t=e.charCodeAt(n);t>=55296&&t<=57343&&(t=65536+((1023&t)<<10)|1023&e.charCodeAt(++n)),t<=127?++r:r+=t<=2047?2:t<=65535?3:t<=2097151?4:t<=67108863?5:6}return r}var UTF16Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function UTF16ToString(e){for(var r=e,n=r>>1;HEAP16[n];)++n;if((r=n<<1)-e>32&&UTF16Decoder)return UTF16Decoder.decode(HEAPU8.subarray(e,r));for(var t=0,i="";;){var a=HEAP16[e+2*t>>1];if(0==a)return i;++t,i+=String.fromCharCode(a)}}function stringToUTF16(e,r,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var t=r,i=(n-=2)<2*e.length?n/2:e.length,a=0;a<i;++a){var o=e.charCodeAt(a);HEAP16[r>>1]=o,r+=2}return HEAP16[r>>1]=0,r-t}function lengthBytesUTF16(e){return 2*e.length}function UTF32ToString(e){for(var r=0,n="";;){var t=HEAP32[e+4*r>>2];if(0==t)return n;if(++r,t>=65536){var i=t-65536;n+=String.fromCharCode(55296|i>>10,56320|1023&i)}else n+=String.fromCharCode(t)}}function stringToUTF32(e,r,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var t=r,i=t+n-4,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(HEAP32[r>>2]=o,(r+=4)+4>i)break}return HEAP32[r>>2]=0,r-t}function lengthBytesUTF32(e){for(var r=0,n=0;n<e.length;++n){var t=e.charCodeAt(n);t>=55296&&t<=57343&&++n,r+=4}return r}function allocateUTF8(e){var r=lengthBytesUTF8(e)+1,n=_malloc(r);return n&&stringToUTF8Array(e,HEAP8,n,r),n}function allocateUTF8OnStack(e){var r=lengthBytesUTF8(e)+1,n=stackAlloc(r);return stringToUTF8Array(e,HEAP8,n,r),n}function demangle(e){return e}function demangleAll(e){return e.replace(/__Z[\w\d_]+/g,function(e){var r=demangle(e);return e===r?e:e+" ["+r+"]"})}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(r){e=r}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function stackTrace(){var e=jsStackTrace();return Module.extraStackTrace&&(e+="\n"+Module.extraStackTrace()),demangleAll(e)}var HEAP,buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE,STATICTOP,staticSealed,STACK_BASE,STACKTOP,STACK_MAX,DYNAMIC_BASE,DYNAMICTOP_PTR,PAGE_SIZE=16384,WASM_PAGE_SIZE=65536,ASMJS_PAGE_SIZE=16777216,MIN_TOTAL_MEMORY=16777216;function alignUp(e,r){return e%r>0&&(e+=r-e%r),e}function updateGlobalBuffer(e){Module.buffer=buffer=e}function updateGlobalBufferViews(){Module.HEAP8=HEAP8=new Int8Array(buffer),Module.HEAP16=HEAP16=new Int16Array(buffer),Module.HEAP32=HEAP32=new Int32Array(buffer),Module.HEAPU8=HEAPU8=new Uint8Array(buffer),Module.HEAPU16=HEAPU16=new Uint16Array(buffer),Module.HEAPU32=HEAPU32=new Uint32Array(buffer),Module.HEAPF32=HEAPF32=new Float32Array(buffer),Module.HEAPF64=HEAPF64=new Float64Array(buffer)}function abortOnCannotGrowMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+TOTAL_MEMORY+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or (4) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function enlargeMemory(){abortOnCannotGrowMemory()}STATIC_BASE=STATICTOP=STACK_BASE=STACKTOP=STACK_MAX=DYNAMIC_BASE=DYNAMICTOP_PTR=0,staticSealed=!1;var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216;function getTotalMemory(){return TOTAL_MEMORY}if(TOTAL_MEMORY<TOTAL_STACK&&Module.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+TOTAL_MEMORY+"! (TOTAL_STACK="+TOTAL_STACK+")"),Module.buffer?buffer=Module.buffer:(buffer=new ArrayBuffer(TOTAL_MEMORY),Module.buffer=buffer),updateGlobalBufferViews(),HEAP32[0]=1668509029,HEAP16[1]=25459,115!==HEAPU8[2]||99!==HEAPU8[3])throw"Runtime error: expected the system to be little-endian!";function callRuntimeCallbacks(e){for(;e.length>0;){var r=e.shift();if("function"!=typeof r){var n=r.func;"number"==typeof n?void 0===r.arg?Module.dynCall_v(n):Module.dynCall_vi(n,r.arg):n(void 0===r.arg?null:r.arg)}else r()}}var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__),runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPreMain(e){__ATMAIN__.unshift(e)}function addOnExit(e){__ATEXIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}function writeStringToMemory(e,r,n){var t,i;warnOnce("writeStringToMemory is deprecated and should not be called! Use stringToUTF8() instead!"),n&&(i=r+lengthBytesUTF8(e),t=HEAP8[i]),stringToUTF8(e,r,1/0),n&&(HEAP8[i]=t)}function writeArrayToMemory(e,r){HEAP8.set(e,r)}function writeAsciiToMemory(e,r,n){for(var t=0;t<e.length;++t)HEAP8[r++>>0]=e.charCodeAt(t);n||(HEAP8[r>>0]=0)}function unSign(e,r,n){return e>=0?e:r<=32?2*Math.abs(1<<r-1)+e:Math.pow(2,r)+e}function reSign(e,r,n){if(e<=0)return e;var t=r<=32?Math.abs(1<<r-1):Math.pow(2,r-1);return e>=t&&(r<=32||e>t)&&(e=-2*t+e),e}var Math_abs=Math.abs,Math_cos=Math.cos,Math_sin=Math.sin,Math_tan=Math.tan,Math_acos=Math.acos,Math_asin=Math.asin,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_sqrt=Math.sqrt,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_imul=Math.imul,Math_fround=Math.fround,Math_round=Math.round,Math_min=Math.min,Math_max=Math.max,Math_clz32=Math.clz32,Math_trunc=Math.trunc,runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var r=dependenciesFulfilled;dependenciesFulfilled=null,r()}}Module.preloadedImages={},Module.preloadedAudios={};var memoryInitializer=null,dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(e){return String.prototype.startsWith?e.startsWith(dataURIPrefix):0===e.indexOf(dataURIPrefix)}var ASM_CONSTS=[function(e,r){if("undefined"!=typeof window){let e=arguments,r=new Uint8Array(Module.HEAPU8.buffer,e[0],e[1]),n=new TextDecoder("utf-8").decode(r);window.checkHost="yet";let t=new XMLHttpRequest;t.open("GET",n),t.responseType="json",t.onload=function(e){let r=t.response.customizedWebSites;if(void 0!==r){let e=r.list;if(void 0!==e)for(let r in e){if(e[r].name==location.hostname){window.checkHost="correct";break}r==e.length-1&&(window.checkHost="fail")}}},t.send()}}];function _emscripten_asm_const_iii(e,r,n){return ASM_CONSTS[e](r,n)}STATICTOP=(STATIC_BASE=GLOBAL_BASE)+3472,__ATINIT__.push({func:function(){__GLOBAL__sub_I_whiteList_cpp()}},{func:function(){__GLOBAL__sub_I_bind_cpp()}}),memoryInitializer="data:application/octet-stream;base64,jAEAAD8HAACMAQAAfgcAAIwBAAC8BwAAjAEAAAIIAACMAQAAPwgAAIwBAABeCAAAjAEAAH0IAACMAQAAnAgAAIwBAAC7CAAAjAEAANoIAACMAQAA+QgAAIwBAAA2CQAAjAEAAFUJAAD4AQAAaAkAAAAAAAABAAAAiAAAAAAAAACMAQAApwkAAPgBAADNCQAAAAAAAAEAAACIAAAAAAAAAPgBAAAMCgAAAAAAAAEAAACIAAAAAAAAALQBAAADCwAA0AAAAAAAAAC0AQAAsAoAAOAAAAAAAAAAjAEAANEKAAC0AQAA3goAAMAAAAAAAAAAtAEAACULAADQAAAAAAAAANwBAABNCwAA3AEAAE8LAADcAQAAUQsAANwBAABTCwAA3AEAAFULAADcAQAAVwsAANwBAABZCwAA3AEAAFsLAADcAQAAXQsAANwBAABfCwAA3AEAAGELAADcAQAAYwsAANwBAABlCwAAtAEAAGcLAADAAAAAAAAAAEABAAAAAAAAwAAAAAEAAAACAAAAAwAAAAQAAAABAAAAAQAAAAEAAAABAAAAAAAAAOgAAAABAAAABQAAAAMAAAAEAAAAAQAAAAIAAAACAAAAAgAAAAAAAAD4AAAAAQAAAAYAAAADAAAABAAAAAIAAAAAAAAAcAEAAAEAAAAHAAAAAwAAAAQAAAABAAAAAwAAAAMAAAADAAAAaHR0cHM6Ly9zMy1hcC1ub3J0aGVhc3QtMS5hbWF6b25hd3MuY29tL21ha2FyLndlYmFyLmRlZmF1bHRvYmplY3Qvd2ViX3doaXRlX2xpc3Qvd2ViU2l0ZUxpc3QudHh0AHsgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7IGxldCBhID0gYXJndW1lbnRzOyBsZXQgeSA9IG5ldyBVaW50OEFycmF5KCBNb2R1bGUuSEVBUFU4LmJ1ZmZlciwgYVswXSwgYVsxXSApOyBsZXQgbGlzdFVybCA9IG5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoeSk7IHdpbmRvdy5jaGVja0hvc3QgPSAieWV0IjsgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyB4aHIub3BlbiggJ0dFVCcsIGxpc3RVcmwgKTsgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJzsgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsgbGV0IGN1c3RvbWl6ZWRXZWJTaXRlcyA9IHhoci5yZXNwb25zZS5jdXN0b21pemVkV2ViU2l0ZXM7IGlmICggdHlwZW9mKGN1c3RvbWl6ZWRXZWJTaXRlcykgIT0gInVuZGVmaW5lZCIgKXsgbGV0IGxpc3QgPSBjdXN0b21pemVkV2ViU2l0ZXMubGlzdCA7IGlmICggdHlwZW9mKGxpc3QpICE9ICJ1bmRlZmluZWQiICl7IGZvciAobGV0IGkgaW4gbGlzdCApeyBpZiAoIGxpc3RbaV0ubmFtZSA9PSBsb2NhdGlvbi5ob3N0bmFtZSl7IHdpbmRvdy5jaGVja0hvc3QgPSAiY29ycmVjdCI7IGJyZWFrOyB9IGlmICggaSA9PSBsaXN0Lmxlbmd0aCAtIDEgKXsgd2luZG93LmNoZWNrSG9zdCA9ICJmYWlsIjsgfSB9IH0gfSB9OyB4aHIuc2VuZCgpOyB9IH0AY2hlY2tNaWZseQBpaQB2b2lkAGJvb2wAc3RkOjpzdHJpbmcAc3RkOjpiYXNpY19zdHJpbmc8dW5zaWduZWQgY2hhcj4Ac3RkOjp3c3RyaW5nAGVtc2NyaXB0ZW46OnZhbABlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8c2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIHNob3J0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MTZfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dWludDMyX3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGxvbmcgZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0llRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lkRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZmxvYXQ+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWZFRQBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1bnNpZ25lZCBsb25nPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0ltRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZz4ATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJbEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWpFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lpRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJdEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SXNFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0loRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJYUVFAGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGNoYXI+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWNFRQBOMTBlbXNjcmlwdGVuM3ZhbEUATlN0M19fMjEyYmFzaWNfc3RyaW5nSXdOU18xMWNoYXJfdHJhaXRzSXdFRU5TXzlhbGxvY2F0b3JJd0VFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJY05TXzExY2hhcl90cmFpdHNJY0VFTlNfOWFsbG9jYXRvckljRUVFRQBkb3VibGUAZmxvYXQAdW5zaWduZWQgbG9uZwBsb25nAHVuc2lnbmVkIGludABpbnQAdW5zaWduZWQgc2hvcnQAc2hvcnQAdW5zaWduZWQgY2hhcgBzaWduZWQgY2hhcgBjaGFyAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAE4xMF9fY3h4YWJpdjEyM19fZnVuZGFtZW50YWxfdHlwZV9pbmZvRQB2AGIAYwBoAGEAcwB0AGkAagBsAG0AZgBkAE4xMF9fY3h4YWJpdjEyMV9fdm1pX2NsYXNzX3R5cGVfaW5mb0U=";var tempDoublePtr=STATICTOP;function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}STATICTOP+=16;var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:function(e){if(!e||EXCEPTIONS.infos[e])return e;for(var r in EXCEPTIONS.infos){if(EXCEPTIONS.infos[r].adjusted===e)return r}return e},addRef:function(e){e&&EXCEPTIONS.infos[e].refcount++},decRef:function(e){if(e){var r=EXCEPTIONS.infos[e];assert(r.refcount>0),r.refcount--,0!==r.refcount||r.rethrown||(r.destructor&&Module.dynCall_vi(r.destructor,e),delete EXCEPTIONS.infos[e],___cxa_free_exception(e))}},clearRef:function(e){e&&(EXCEPTIONS.infos[e].refcount=0)}};function ___resumeException(e){throw EXCEPTIONS.last||(EXCEPTIONS.last=e),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var e=EXCEPTIONS.last;if(!e)return 0|(setTempRet0(0),0);var r=EXCEPTIONS.infos[e],n=r.type;if(!n)return 0|(setTempRet0(0),e);var t=Array.prototype.slice.call(arguments);Module.___cxa_is_pointer_type(n);___cxa_find_matching_catch.buffer||(___cxa_find_matching_catch.buffer=_malloc(4)),HEAP32[___cxa_find_matching_catch.buffer>>2]=e,e=___cxa_find_matching_catch.buffer;for(var i=0;i<t.length;i++)if(t[i]&&Module.___cxa_can_catch(t[i],n,e))return e=HEAP32[e>>2],r.adjusted=e,0|(setTempRet0(t[i]),e);return e=HEAP32[e>>2],0|(setTempRet0(n),e)}function ___gxx_personality_v0(){}function getShiftFromSize(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function embind_init_charCodes(){for(var e=new Array(256),r=0;r<256;++r)e[r]=String.fromCharCode(r);embind_charCodes=e}var embind_charCodes=void 0;function readLatin1String(e){for(var r="",n=e;HEAPU8[n];)r+=embind_charCodes[HEAPU8[n++]];return r}var awaitingDependencies={},registeredTypes={},typeDependencies={},char_0=48,char_9=57;function makeLegalFunctionName(e){if(void 0===e)return"_unknown";var r=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return r>=char_0&&r<=char_9?"_"+e:e}function createNamedFunction(e,r){return e=makeLegalFunctionName(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(r)}function extendError(e,r){var n=createNamedFunction(r,function(e){this.name=r,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))});return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var BindingError=void 0;function throwBindingError(e){throw new BindingError(e)}var InternalError=void 0;function throwInternalError(e){throw new InternalError(e)}function whenDependentTypesAreResolved(e,r,n){function t(r){var t=n(r);t.length!==e.length&&throwInternalError("Mismatched type converter count");for(var i=0;i<e.length;++i)registerType(e[i],t[i])}e.forEach(function(e){typeDependencies[e]=r});var i=new Array(r.length),a=[],o=0;r.forEach(function(e,r){registeredTypes.hasOwnProperty(e)?i[r]=registeredTypes[e]:(a.push(e),awaitingDependencies.hasOwnProperty(e)||(awaitingDependencies[e]=[]),awaitingDependencies[e].push(function(){i[r]=registeredTypes[e],++o===a.length&&t(i)}))}),0===a.length&&t(i)}function registerType(e,r,n){if(n=n||{},!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var t=r.name;if(e||throwBindingError('type "'+t+'" must have a positive integer typeid pointer'),registeredTypes.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;throwBindingError("Cannot register type '"+t+"' twice")}if(registeredTypes[e]=r,delete typeDependencies[e],awaitingDependencies.hasOwnProperty(e)){var i=awaitingDependencies[e];delete awaitingDependencies[e],i.forEach(function(e){e()})}}function __embind_register_bool(e,r,n,t,i){var a=getShiftFromSize(n);registerType(e,{name:r=readLatin1String(r),fromWireType:function(e){return!!e},toWireType:function(e,r){return r?t:i},argPackAdvance:8,readValueFromPointer:function(e){var t;if(1===n)t=HEAP8;else if(2===n)t=HEAP16;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+r);t=HEAP32}return this.fromWireType(t[e>>a])},destructorFunction:null})}var emval_free_list=[],emval_handle_array=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function __emval_decref(e){e>4&&0==--emval_handle_array[e].refcount&&(emval_handle_array[e]=void 0,emval_free_list.push(e))}function count_emval_handles(){for(var e=0,r=5;r<emval_handle_array.length;++r)void 0!==emval_handle_array[r]&&++e;return e}function get_first_emval(){for(var e=5;e<emval_handle_array.length;++e)if(void 0!==emval_handle_array[e])return emval_handle_array[e];return null}function init_emval(){Module.count_emval_handles=count_emval_handles,Module.get_first_emval=get_first_emval}function __emval_register(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var r=emval_free_list.length?emval_free_list.pop():emval_handle_array.length;return emval_handle_array[r]={refcount:1,value:e},r}}function simpleReadValueFromPointer(e){return this.fromWireType(HEAPU32[e>>2])}function __embind_register_emval(e,r){registerType(e,{name:r=readLatin1String(r),fromWireType:function(e){var r=emval_handle_array[e].value;return __emval_decref(e),r},toWireType:function(e,r){return __emval_register(r)},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:null})}function _embind_repr(e){if(null===e)return"null";var r=typeof e;return"object"===r||"array"===r||"function"===r?e.toString():""+e}function floatReadValueFromPointer(e,r){switch(r){case 2:return function(e){return this.fromWireType(HEAPF32[e>>2])};case 3:return function(e){return this.fromWireType(HEAPF64[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function __embind_register_float(e,r,n){var t=getShiftFromSize(n);registerType(e,{name:r=readLatin1String(r),fromWireType:function(e){return e},toWireType:function(e,r){if("number"!=typeof r&&"boolean"!=typeof r)throw new TypeError('Cannot convert "'+_embind_repr(r)+'" to '+this.name);return r},argPackAdvance:8,readValueFromPointer:floatReadValueFromPointer(r,t),destructorFunction:null})}function new_(e,r){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var n=createNamedFunction(e.name||"unknownFunctionName",function(){});n.prototype=e.prototype;var t=new n,i=e.apply(t,r);return i instanceof Object?i:t}function runDestructors(e){for(;e.length;){var r=e.pop();e.pop()(r)}}function craftInvokerFunction(e,r,n,t,i){var a=r.length;a<2&&throwBindingError("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var o=null!==r[1]&&null!==n,u=!1,l=1;l<r.length;++l)if(null!==r[l]&&void 0===r[l].destructorFunction){u=!0;break}var f="void"!==r[0].name,c="",s="";for(l=0;l<a-2;++l)c+=(0!==l?", ":"")+"arg"+l,s+=(0!==l?", ":"")+"arg"+l+"Wired";var d="return function "+makeLegalFunctionName(e)+"("+c+") {\nif (arguments.length !== "+(a-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(a-2)+" args!');\n}\n";u&&(d+="var destructors = [];\n");var A=u?"destructors":"null",_=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],v=[throwBindingError,t,i,runDestructors,r[0],r[1]];o&&(d+="var thisWired = classParam.toWireType("+A+", this);\n");for(l=0;l<a-2;++l)d+="var arg"+l+"Wired = argType"+l+".toWireType("+A+", arg"+l+"); // "+r[l+2].name+"\n",_.push("argType"+l),v.push(r[l+2]);if(o&&(s="thisWired"+(s.length>0?", ":"")+s),d+=(f?"var rv = ":"")+"invoker(fn"+(s.length>0?", ":"")+s+");\n",u)d+="runDestructors(destructors);\n";else for(l=o?1:2;l<r.length;++l){var m=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==r[l].destructorFunction&&(d+=m+"_dtor("+m+"); // "+r[l].name+"\n",_.push(m+"_dtor"),v.push(r[l].destructorFunction))}return f&&(d+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),d+="}\n",_.push(d),new_(Function,_).apply(null,v)}function ensureOverloadTable(e,r,n){if(void 0===e[r].overloadTable){var t=e[r];e[r]=function(){return e[r].overloadTable.hasOwnProperty(arguments.length)||throwBindingError("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[r].overloadTable+")!"),e[r].overloadTable[arguments.length].apply(this,arguments)},e[r].overloadTable=[],e[r].overloadTable[t.argCount]=t}}function exposePublicSymbol(e,r,n){Module.hasOwnProperty(e)?((void 0===n||void 0!==Module[e].overloadTable&&void 0!==Module[e].overloadTable[n])&&throwBindingError("Cannot register public name '"+e+"' twice"),ensureOverloadTable(Module,e,e),Module.hasOwnProperty(n)&&throwBindingError("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),Module[e].overloadTable[n]=r):(Module[e]=r,void 0!==n&&(Module[e].numArguments=n))}function heap32VectorToArray(e,r){for(var n=[],t=0;t<e;t++)n.push(HEAP32[(r>>2)+t]);return n}function replacePublicSymbol(e,r,n){Module.hasOwnProperty(e)||throwInternalError("Replacing nonexistant public symbol"),void 0!==Module[e].overloadTable&&void 0!==n?Module[e].overloadTable[n]=r:(Module[e]=r,Module[e].argCount=n)}function embind__requireFunction(e,r){var n;if(e=readLatin1String(e),void 0!==Module["FUNCTION_TABLE_"+e])n=Module["FUNCTION_TABLE_"+e][r];else if("undefined"!=typeof FUNCTION_TABLE)n=FUNCTION_TABLE[r];else{var t=Module.asm["dynCall_"+e];void 0===t&&void 0===(t=Module.asm["dynCall_"+e.replace(/f/g,"d")])&&throwBindingError("No dynCall invoker for signature: "+e),n=function(n){for(var t=[],i=1;i<e.length;++i)t.push("a"+i);var a="return function "+("dynCall_"+e+"_"+r)+"("+t.join(", ")+") {\n";return a+="    return dynCall(rawFunction"+(t.length?", ":"")+t.join(", ")+");\n",a+="};\n",new Function("dynCall","rawFunction",a)(n,r)}(t)}return"function"!=typeof n&&throwBindingError("unknown function pointer with signature "+e+": "+r),n}var UnboundTypeError=void 0;function getTypeName(e){var r=___getTypeName(e),n=readLatin1String(r);return _free(r),n}function throwUnboundTypeError(e,r){var n=[],t={};throw r.forEach(function e(r){t[r]||registeredTypes[r]||(typeDependencies[r]?typeDependencies[r].forEach(e):(n.push(r),t[r]=!0))}),new UnboundTypeError(e+": "+n.map(getTypeName).join([", "]))}function __embind_register_function(e,r,n,t,i,a){var o=heap32VectorToArray(r,n);e=readLatin1String(e),i=embind__requireFunction(t,i),exposePublicSymbol(e,function(){throwUnboundTypeError("Cannot call "+e+" due to unbound types",o)},r-1),whenDependentTypesAreResolved([],o,function(n){var t=[n[0],null].concat(n.slice(1));return replacePublicSymbol(e,craftInvokerFunction(e,t,null,i,a),r-1),[]})}function integerReadValueFromPointer(e,r,n){switch(r){case 0:return n?function(e){return HEAP8[e]}:function(e){return HEAPU8[e]};case 1:return n?function(e){return HEAP16[e>>1]}:function(e){return HEAPU16[e>>1]};case 2:return n?function(e){return HEAP32[e>>2]}:function(e){return HEAPU32[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function __embind_register_integer(e,r,n,t,i){r=readLatin1String(r),-1===i&&(i=4294967295);var a=getShiftFromSize(n),o=function(e){return e};if(0===t){var u=32-8*n;o=function(e){return e<<u>>>u}}var l=-1!=r.indexOf("unsigned");registerType(e,{name:r,fromWireType:o,toWireType:function(e,n){if("number"!=typeof n&&"boolean"!=typeof n)throw new TypeError('Cannot convert "'+_embind_repr(n)+'" to '+this.name);if(n<t||n>i)throw new TypeError('Passing a number "'+_embind_repr(n)+'" from JS side to C/C++ side to an argument of type "'+r+'", which is outside the valid range ['+t+", "+i+"]!");return l?n>>>0:0|n},argPackAdvance:8,readValueFromPointer:integerReadValueFromPointer(r,a,0!==t),destructorFunction:null})}function __embind_register_memory_view(e,r,n){var t=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][r];function i(e){var r=HEAPU32,n=r[e>>=2],i=r[e+1];return new t(r.buffer,i,n)}registerType(e,{name:n=readLatin1String(n),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})}function __embind_register_std_string(e,r){registerType(e,{name:r=readLatin1String(r),fromWireType:function(e){for(var r=HEAPU32[e>>2],n=new Array(r),t=0;t<r;++t)n[t]=String.fromCharCode(HEAPU8[e+4+t]);return _free(e),n.join("")},toWireType:function(e,r){function n(e,r){return e[r]}var t;r instanceof ArrayBuffer&&(r=new Uint8Array(r)),r instanceof Uint8Array?t=n:r instanceof Uint8ClampedArray?t=n:r instanceof Int8Array?t=n:"string"==typeof r?t=function(e,r){return e.charCodeAt(r)}:throwBindingError("Cannot pass non-string to std::string");var i=r.length,a=_malloc(4+i);HEAPU32[a>>2]=i;for(var o=0;o<i;++o){var u=t(r,o);u>255&&(_free(a),throwBindingError("String has UTF-16 code units that do not fit in 8 bits")),HEAPU8[a+4+o]=u}return null!==e&&e.push(_free,a),a},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(e){_free(e)}})}function __embind_register_std_wstring(e,r,n){var t,i;n=readLatin1String(n),2===r?(t=function(){return HEAPU16},i=1):4===r&&(t=function(){return HEAPU32},i=2),registerType(e,{name:n,fromWireType:function(e){for(var r=t(),n=HEAPU32[e>>2],a=new Array(n),o=e+4>>i,u=0;u<n;++u)a[u]=String.fromCharCode(r[o+u]);return _free(e),a.join("")},toWireType:function(e,n){var a=t(),o=n.length,u=_malloc(4+o*r);HEAPU32[u>>2]=o;for(var l=u+4>>i,f=0;f<o;++f)a[l+f]=n.charCodeAt(f);return null!==e&&e.push(_free,u),u},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(e){_free(e)}})}function __embind_register_void(e,r){registerType(e,{isVoid:!0,name:r=readLatin1String(r),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,r){}})}var _emscripten_asm_const_int=!0;function _emscripten_memcpy_big(e,r,n){return HEAPU8.set(HEAPU8.subarray(r,r+n),e),e}function ___setErrNo(e){return Module.___errno_location&&(HEAP32[Module.___errno_location()>>2]=e),e}embind_init_charCodes(),BindingError=Module.BindingError=extendError(Error,"BindingError"),InternalError=Module.InternalError=extendError(Error,"InternalError"),init_emval(),UnboundTypeError=Module.UnboundTypeError=extendError(Error,"UnboundTypeError"),DYNAMICTOP_PTR=staticAlloc(4),STACK_BASE=STACKTOP=alignMemory(STATICTOP),DYNAMIC_BASE=alignMemory(STACK_MAX=STACK_BASE+TOTAL_STACK),HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE,staticSealed=!0;var ASSERTIONS=!1;function intArrayFromString(e,r,n){var t=n>0?n:lengthBytesUTF8(e)+1,i=new Array(t),a=stringToUTF8Array(e,i,0,i.length);return r&&(i.length=a),i}function intArrayToString(e){for(var r=[],n=0;n<e.length;n++){var t=e[n];t>255&&(ASSERTIONS&&assert(!1,"Character code "+t+" ("+String.fromCharCode(t)+")  at offset "+n+" not in 0x00-0xFF."),t&=255),r.push(String.fromCharCode(t))}return r.join("")}var decodeBase64="function"==typeof atob?atob:function(e){var r,n,t,i,a,o,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{r=u.indexOf(e.charAt(f++))<<2|(i=u.indexOf(e.charAt(f++)))>>4,n=(15&i)<<4|(a=u.indexOf(e.charAt(f++)))>>2,t=(3&a)<<6|(o=u.indexOf(e.charAt(f++))),l+=String.fromCharCode(r),64!==a&&(l+=String.fromCharCode(n)),64!==o&&(l+=String.fromCharCode(t))}while(f<e.length);return l};function intArrayFromBase64(e){if("boolean"==typeof ENVIRONMENT_IS_NODE&&ENVIRONMENT_IS_NODE){var r;try{r=Buffer.from(e,"base64")}catch(n){r=new Buffer(e,"base64")}return new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}try{for(var n=decodeBase64(e),t=new Uint8Array(n.length),i=0;i<n.length;++i)t[i]=n.charCodeAt(i);return t}catch(e){throw new Error("Converting base64 string to bytes failed.")}}function tryParseAsDataURI(e){if(isDataURI(e))return intArrayFromBase64(e.slice(dataURIPrefix.length))}function invoke_i(e){try{return Module.dynCall_i(e)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_ii(e,r){try{return Module.dynCall_ii(e,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_iiii(e,r,n,t){try{return Module.dynCall_iiii(e,r,n,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_vi(e,r){try{Module.dynCall_vi(e,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiii(e,r,n,t,i){try{Module.dynCall_viiii(e,r,n,t,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiiii(e,r,n,t,i,a){try{Module.dynCall_viiiii(e,r,n,t,i,a)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiiiii(e,r,n,t,i,a,o){try{Module.dynCall_viiiiii(e,r,n,t,i,a,o)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}Module.asmGlobalArg={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0},Module.asmLibraryArg={abort:abort,assert:assert,enlargeMemory:enlargeMemory,getTotalMemory:getTotalMemory,abortOnCannotGrowMemory:abortOnCannotGrowMemory,invoke_i:invoke_i,invoke_ii:invoke_ii,invoke_iiii:invoke_iiii,invoke_vi:invoke_vi,invoke_viiii:invoke_viiii,invoke_viiiii:invoke_viiiii,invoke_viiiiii:invoke_viiiiii,__ZSt18uncaught_exceptionv:__ZSt18uncaught_exceptionv,___cxa_find_matching_catch:___cxa_find_matching_catch,___gxx_personality_v0:___gxx_personality_v0,___resumeException:___resumeException,___setErrNo:___setErrNo,__embind_register_bool:__embind_register_bool,__embind_register_emval:__embind_register_emval,__embind_register_float:__embind_register_float,__embind_register_function:__embind_register_function,__embind_register_integer:__embind_register_integer,__embind_register_memory_view:__embind_register_memory_view,__embind_register_std_string:__embind_register_std_string,__embind_register_std_wstring:__embind_register_std_wstring,__embind_register_void:__embind_register_void,__emval_decref:__emval_decref,__emval_register:__emval_register,_embind_repr:_embind_repr,_emscripten_asm_const_iii:_emscripten_asm_const_iii,_emscripten_memcpy_big:_emscripten_memcpy_big,count_emval_handles:count_emval_handles,craftInvokerFunction:craftInvokerFunction,createNamedFunction:createNamedFunction,embind__requireFunction:embind__requireFunction,embind_init_charCodes:embind_init_charCodes,ensureOverloadTable:ensureOverloadTable,exposePublicSymbol:exposePublicSymbol,extendError:extendError,floatReadValueFromPointer:floatReadValueFromPointer,getShiftFromSize:getShiftFromSize,getTypeName:getTypeName,get_first_emval:get_first_emval,heap32VectorToArray:heap32VectorToArray,init_emval:init_emval,integerReadValueFromPointer:integerReadValueFromPointer,makeLegalFunctionName:makeLegalFunctionName,new_:new_,readLatin1String:readLatin1String,registerType:registerType,replacePublicSymbol:replacePublicSymbol,runDestructors:runDestructors,simpleReadValueFromPointer:simpleReadValueFromPointer,throwBindingError:throwBindingError,throwInternalError:throwInternalError,throwUnboundTypeError:throwUnboundTypeError,whenDependentTypesAreResolved:whenDependentTypesAreResolved,DYNAMICTOP_PTR:DYNAMICTOP_PTR,tempDoublePtr:tempDoublePtr,ABORT:ABORT,STACKTOP:STACKTOP,STACK_MAX:STACK_MAX};var initialStackTop,asm=function(e,r,n){"use asm";var t=new e.Int8Array(n);var i=new e.Int16Array(n);var a=new e.Int32Array(n);var o=new e.Uint8Array(n);var u=new e.Uint16Array(n);var l=new e.Uint32Array(n);var f=new e.Float32Array(n);var c=new e.Float64Array(n);var s=r.DYNAMICTOP_PTR|0;var d=r.tempDoublePtr|0;var A=r.ABORT|0;var _=r.STACKTOP|0;var v=r.STACK_MAX|0;var m=0;var p=0;var h=0;var y=0;var b=e.NaN,g=e.Infinity;var T=0,E=0,M=0,w=0,I=0.0;var P=0;var S=e.Math.floor;var R=e.Math.abs;var N=e.Math.sqrt;var C=e.Math.pow;var k=e.Math.cos;var O=e.Math.sin;var F=e.Math.tan;var B=e.Math.acos;var H=e.Math.asin;var U=e.Math.atan;var W=e.Math.atan2;var V=e.Math.exp;var x=e.Math.log;var L=e.Math.ceil;var D=e.Math.imul;var X=e.Math.min;var Z=e.Math.max;var G=e.Math.clz32;var z=r.abort;var j=r.assert;var Y=r.enlargeMemory;var Q=r.getTotalMemory;var J=r.abortOnCannotGrowMemory;var K=r.invoke_i;var q=r.invoke_ii;var $=r.invoke_iiii;var ee=r.invoke_vi;var re=r.invoke_viiii;var ne=r.invoke_viiiii;var te=r.invoke_viiiiii;var ie=r.__ZSt18uncaught_exceptionv;var ae=r.___cxa_find_matching_catch;var oe=r.___gxx_personality_v0;var ue=r.___resumeException;var le=r.___setErrNo;var fe=r.__embind_register_bool;var ce=r.__embind_register_emval;var se=r.__embind_register_float;var de=r.__embind_register_function;var Ae=r.__embind_register_integer;var _e=r.__embind_register_memory_view;var ve=r.__embind_register_std_string;var me=r.__embind_register_std_wstring;var pe=r.__embind_register_void;var he=r.__emval_decref;var ye=r.__emval_register;var be=r._embind_repr;var ge=r._emscripten_asm_const_iii;var Te=r._emscripten_memcpy_big;var Ee=r.count_emval_handles;var Me=r.craftInvokerFunction;var we=r.createNamedFunction;var Ie=r.embind__requireFunction;var Pe=r.embind_init_charCodes;var Se=r.ensureOverloadTable;var Re=r.exposePublicSymbol;var Ne=r.extendError;var Ce=r.floatReadValueFromPointer;var ke=r.getShiftFromSize;var Oe=r.getTypeName;var Fe=r.get_first_emval;var Be=r.heap32VectorToArray;var He=r.init_emval;var Ue=r.integerReadValueFromPointer;var We=r.makeLegalFunctionName;var Ve=r.new_;var xe=r.readLatin1String;var Le=r.registerType;var De=r.replacePublicSymbol;var Xe=r.runDestructors;var Ze=r.simpleReadValueFromPointer;var Ge=r.throwBindingError;var ze=r.throwInternalError;var je=r.throwUnboundTypeError;var Ye=r.whenDependentTypesAreResolved;var Qe=0.0;function Je(e){e=e|0;var r=0;r=_;_=_+e|0;_=_+15&-16;return r|0}function Ke(){return _|0}function qe(e){e=e|0;_=e}function $e(e,r){e=e|0;r=r|0;_=e;v=r}function er(e,r){e=e|0;r=r|0;if((m|0)==0){m=e;p=r}}function rr(e){e=e|0;P=e}function nr(){return P|0}function tr(){var e=0,r=0,n=0;n=_;e=ge(0,536|0,96)|0;return 1}function ir(){var e=0,r=0;r=_;tr()|0;return}function ar(){var e=0,r=0;r=_;or(0);return}function or(e){e=e|0;var r=0,n=0;n=_;ur(1307,1);return}function ur(e,r){e=e|0;r=r|0;var n=0,t=0,i=0,a=0,o=0,u=0;u=_;_=_+16|0;n=u;t=fr(n)|0;i=cr(n)|0;a=Ar()|0;de(e|0,t|0,i|0,a|0,1|0,r|0);_=u;return}function lr(e){e=e|0;var r=0,n=0,t=0,i=0,o=0;o=_;_=_+16|0;r=o;n=Zt[e&1]()|0;a[r>>2]=n;t=sr(r)|0;_=o;return t|0}function fr(e){e=e|0;var r=0,n=0;n=_;return 1}function cr(e){e=e|0;var r=0,n=0,t=0;t=_;r=dr()|0;return r|0}function sr(e){e=e|0;var r=0,n=0,t=0;t=_;r=a[e>>2]|0;return r|0}function dr(){var e=0,r=0;r=_;return 384|0}function Ar(){var e=0,r=0;r=_;return 1318|0}function _r(){var e=0,r=0;r=_;ir();ar();return}function vr(){var e=0,r=0;r=_;mr();return}function mr(){var e=0,r=0;r=_;pr(0);return}function pr(e){e=e|0;var r=0,n=0,t=0,i=0,a=0,o=0,u=0,l=0;l=_;r=hr()|0;pe(r|0,1321|0);n=yr()|0;fe(n|0,1326|0,1,1,0);br();gr();Tr();Er();Mr();wr();Ir();Pr();Sr();Rr();Nr();t=Cr()|0;ve(t|0,1331|0);i=kr()|0;ve(i|0,1343|0);a=Or()|0;me(a|0,4,1376|0);o=Fr()|0;ce(o|0,1389|0);Br();Hr(1405);Ur(1442);Wr(1481);Vr(1512);xr(1552);Lr(1581);Dr();Xr();Hr(1619);Ur(1651);Wr(1684);Vr(1717);xr(1751);Lr(1784);Zr();Gr();zr();return}function hr(){var e=0,r=0,n=0;n=_;e=Gn()|0;return e|0}function yr(){var e=0,r=0,n=0;n=_;e=Zn()|0;return e|0}function br(){var e=0,r=0,n=0;n=_;e=Dn()|0;Ae(e|0,2731|0,1,-128,127);return}function gr(){var e=0,r=0,n=0;n=_;e=xn()|0;Ae(e|0,2719|0,1,-128,127);return}function Tr(){var e=0,r=0,n=0;n=_;e=Wn()|0;Ae(e|0,2705|0,1,0,255);return}function Er(){var e=0,r=0,n=0;n=_;e=Hn()|0;Ae(e|0,2699|0,2,-32768,32767);return}function Mr(){var e=0,r=0,n=0;n=_;e=Fn()|0;Ae(e|0,2684|0,2,0,65535);return}function wr(){var e=0,r=0,n=0;n=_;e=kn()|0;Ae(e|0,2680|0,4,-2147483648,2147483647);return}function Ir(){var e=0,r=0,n=0;n=_;e=Nn()|0;Ae(e|0,2667|0,4,0,-1);return}function Pr(){var e=0,r=0,n=0;n=_;e=Sn()|0;Ae(e|0,2662|0,4,-2147483648,2147483647);return}function Sr(){var e=0,r=0,n=0;n=_;e=In()|0;Ae(e|0,2648|0,4,0,-1);return}function Rr(){var e=0,r=0,n=0;n=_;e=Mn()|0;se(e|0,2642|0,4);return}function Nr(){var e=0,r=0,n=0;n=_;e=Tn()|0;se(e|0,2635|0,8);return}function Cr(){var e=0,r=0,n=0;n=_;e=gn()|0;return e|0}function kr(){var e=0,r=0,n=0;n=_;e=bn()|0;return e|0}function Or(){var e=0,r=0,n=0;n=_;e=yn()|0;return e|0}function Fr(){var e=0,r=0,n=0;n=_;e=hn()|0;return e|0}function Br(){var e=0,r=0,n=0;n=_;e=mn()|0;_e(e|0,0,2328|0);return}function Hr(e){e=e|0;var r=0,n=0,t=0;t=_;r=_n()|0;_e(r|0,0,e|0);return}function Ur(e){e=e|0;var r=0,n=0,t=0;t=_;r=dn()|0;_e(r|0,1,e|0);return}function Wr(e){e=e|0;var r=0,n=0,t=0;t=_;r=cn()|0;_e(r|0,2,e|0);return}function Vr(e){e=e|0;var r=0,n=0,t=0;t=_;r=ln()|0;_e(r|0,3,e|0);return}function xr(e){e=e|0;var r=0,n=0,t=0;t=_;r=on()|0;_e(r|0,4,e|0);return}function Lr(e){e=e|0;var r=0,n=0,t=0;t=_;r=tn()|0;_e(r|0,5,e|0);return}function Dr(){var e=0,r=0,n=0;n=_;e=rn()|0;_e(e|0,4,2081|0);return}function Xr(){var e=0,r=0,n=0;n=_;e=$r()|0;_e(e|0,5,2011|0);return}function Zr(){var e=0,r=0,n=0;n=_;e=Kr()|0;_e(e|0,6,1949|0);return}function Gr(){var e=0,r=0,n=0;n=_;e=Qr()|0;_e(e|0,7,1886|0);return}function zr(){var e=0,r=0,n=0;n=_;e=jr()|0;_e(e|0,7,1818|0);return}function jr(){var e=0,r=0,n=0;n=_;e=Yr()|0;return e|0}function Yr(){var e=0,r=0;r=_;return 8|0}function Qr(){var e=0,r=0,n=0;n=_;e=Jr()|0;return e|0}function Jr(){var e=0,r=0;r=_;return 16|0}function Kr(){var e=0,r=0,n=0;n=_;e=qr()|0;return e|0}function qr(){var e=0,r=0;r=_;return 24|0}function $r(){var e=0,r=0,n=0;n=_;e=en()|0;return e|0}function en(){var e=0,r=0;r=_;return 32|0}function rn(){var e=0,r=0,n=0;n=_;e=nn()|0;return e|0}function nn(){var e=0,r=0;r=_;return 40|0}function tn(){var e=0,r=0,n=0;n=_;e=an()|0;return e|0}function an(){var e=0,r=0;r=_;return 48|0}function on(){var e=0,r=0,n=0;n=_;e=un()|0;return e|0}function un(){var e=0,r=0;r=_;return 56|0}function ln(){var e=0,r=0,n=0;n=_;e=fn()|0;return e|0}function fn(){var e=0,r=0;r=_;return 64|0}function cn(){var e=0,r=0,n=0;n=_;e=sn()|0;return e|0}function sn(){var e=0,r=0;r=_;return 72|0}function dn(){var e=0,r=0,n=0;n=_;e=An()|0;return e|0}function An(){var e=0,r=0;r=_;return 80|0}function _n(){var e=0,r=0,n=0;n=_;e=vn()|0;return e|0}function vn(){var e=0,r=0;r=_;return 88|0}function mn(){var e=0,r=0,n=0;n=_;e=pn()|0;return e|0}function pn(){var e=0,r=0;r=_;return 96|0}function hn(){var e=0,r=0;r=_;return 104|0}function yn(){var e=0,r=0;r=_;return 112|0}function bn(){var e=0,r=0;r=_;return 144|0}function gn(){var e=0,r=0;r=_;return 168|0}function Tn(){var e=0,r=0,n=0;n=_;e=En()|0;return e|0}function En(){var e=0,r=0;r=_;return 360|0}function Mn(){var e=0,r=0,n=0;n=_;e=wn()|0;return e|0}function wn(){var e=0,r=0;r=_;return 352|0}function In(){var e=0,r=0,n=0;n=_;e=Pn()|0;return e|0}function Pn(){var e=0,r=0;r=_;return 344|0}function Sn(){var e=0,r=0,n=0;n=_;e=Rn()|0;return e|0}function Rn(){var e=0,r=0;r=_;return 336|0}function Nn(){var e=0,r=0,n=0;n=_;e=Cn()|0;return e|0}function Cn(){var e=0,r=0;r=_;return 328|0}function kn(){var e=0,r=0,n=0;n=_;e=On()|0;return e|0}function On(){var e=0,r=0;r=_;return 320|0}function Fn(){var e=0,r=0,n=0;n=_;e=Bn()|0;return e|0}function Bn(){var e=0,r=0;r=_;return 312|0}function Hn(){var e=0,r=0,n=0;n=_;e=Un()|0;return e|0}function Un(){var e=0,r=0;r=_;return 304|0}function Wn(){var e=0,r=0,n=0;n=_;e=Vn()|0;return e|0}function Vn(){var e=0,r=0;r=_;return 288|0}function xn(){var e=0,r=0,n=0;n=_;e=Ln()|0;return e|0}function Ln(){var e=0,r=0;r=_;return 296|0}function Dn(){var e=0,r=0,n=0;n=_;e=Xn()|0;return e|0}function Xn(){var e=0,r=0;r=_;return 280|0}function Zn(){var e=0,r=0;r=_;return 272|0}function Gn(){var e=0,r=0;r=_;return 264|0}function zn(e){e=e|0;var r=0,n=0,t=0,i=0,o=0;o=_;r=e+4|0;n=a[r>>2]|0;t=Kn(n)|0;return t|0}function jn(e){e=e|0;var r=0,n=0,t=0,i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0;var E=0,M=0,w=0,I=0,P=0,S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0,L=0,D=0;var X=0,Z=0,G=0,z=0,j=0,Y=0,Q=0,J=0,K=0,q=0,$=0,ee=0,re=0,ne=0,te=0,ie=0,ae=0,oe=0,ue=0,le=0;var fe=0,ce=0,se=0,de=0,Ae=0,_e=0,ve=0,me=0,pe=0,he=0,ye=0,be=0,ge=0,Te=0,Ee=0,Me=0,we=0,Ie=0,Pe=0,Se=0;var Re=0,Ne=0,Ce=0,ke=0,Oe=0,Fe=0,Be=0,He=0,Ue=0,We=0,Ve=0,xe=0,Le=0,De=0,Xe=0,Ze=0,Ge=0,ze=0,je=0,Ye=0;var Qe=0,Je=0,Ke=0,qe=0,$e=0,er=0,rr=0,nr=0,tr=0,ir=0,ar=0,or=0,ur=0,lr=0,fr=0,cr=0,sr=0,dr=0,Ar=0,_r=0;var vr=0,mr=0,pr=0,hr=0,yr=0,br=0,gr=0,Tr=0,Er=0,Mr=0,wr=0,Ir=0,Pr=0,Sr=0,Rr=0,Nr=0,Cr=0,kr=0,Or=0,Fr=0;var Br=0,Hr=0,Ur=0,Wr=0,Vr=0,xr=0,Lr=0,Dr=0,Xr=0,Zr=0,Gr=0,zr=0,jr=0,Yr=0,Qr=0,Jr=0,Kr=0,qr=0,$r=0,en=0;var rn=0,nn=0,tn=0,an=0,on=0,un=0,ln=0,fn=0,cn=0,sn=0,dn=0,An=0,_n=0,vn=0,mn=0,pn=0,hn=0,yn=0,bn=0,gn=0;var Tn=0,En=0,Mn=0,wn=0,In=0,Pn=0,Sn=0,Rn=0,Nn=0,Cn=0,kn=0,On=0,Fn=0,Bn=0,Hn=0,Un=0,Wn=0,Vn=0,xn=0,Ln=0;var Dn=0,Xn=0,Zn=0,Gn=0,zn=0,jn=0,Yn=0,Jn=0,Kn=0,qn=0,$n=0,et=0,rt=0,nt=0,tt=0,it=0,at=0,ot=0,ut=0,lt=0;var ft=0,ct=0,st=0,dt=0,At=0,_t=0,vt=0,mt=0,pt=0,ht=0,yt=0,bt=0,gt=0,Tt=0,Et=0,Mt=0,wt=0,It=0,Pt=0,St=0;var Nt=0,Ct=0,kt=0,Ot=0,Ft=0,Bt=0,Ht=0,Ut=0,Wt=0,Vt=0,xt=0,Lt=0,Dt=0,Xt=0,Zt=0,Gt=0,zt=0,jt=0,Yt=0,Qt=0;var Jt=0,Kt=0,qt=0,$t=0,ei=0,ri=0,ni=0,ti=0,ii=0,ai=0,oi=0,ui=0,li=0,fi=0,ci=0,si=0,di=0,Ai=0,_i=0,vi=0;var mi=0,pi=0,hi=0,yi=0,bi=0,gi=0,Ti=0,Ei=0,Mi=0,wi=0,Ii=0,Pi=0,Si=0,Ri=0,Ni=0,Ci=0,ki=0,Oi=0,Fi=0,Bi=0;var Hi=0,Ui=0,Wi=0,Vi=0,xi=0,Li=0,Di=0,Xi=0,Zi=0,Gi=0,zi=0,ji=0,Yi=0,Qi=0,Ji=0,Ki=0,qi=0,$i=0,ea=0,ra=0;var na=0,ta=0,ia=0,aa=0,oa=0,ua=0,la=0,fa=0,ca=0,sa=0,da=0,Aa=0,_a=0,va=0,ma=0,pa=0,ha=0,ya=0,ba=0,ga=0;var Ta=0,Ea=0,Ma=0,wa=0,Ia=0,Pa=0,Sa=0,Ra=0,Na=0,Ca=0,ka=0,Oa=0,Fa=0,Ba=0,Ha=0,Ua=0,Wa=0,Va=0,xa=0,La=0;var Da=0,Xa=0,Za=0,Ga=0,za=0,ja=0,Ya=0,Qa=0,Ja=0,Ka=0,qa=0,$a=0,eo=0,ro=0,no=0,to=0,io=0,ao=0,oo=0,uo=0;var lo=0,fo=0,co=0,so=0,Ao=0,_o=0,vo=0,mo=0,po=0,ho=0,yo=0,bo=0,go=0,To=0,Eo=0,Mo=0,wo=0,Io=0,Po=0,So=0;var Ro=0,No=0,Co=0,ko=0,Oo=0,Fo=0,Bo=0,Ho=0,Uo=0,Wo=0,Vo=0,xo=0,Lo=0,Do=0,Xo=0,Zo=0,Go=0,zo=0,jo=0,Yo=0;var Qo=0,Jo=0,Ko=0,qo=0,$o=0,eu=0,ru=0,nu=0,tu=0,iu=0,au=0,ou=0,uu=0,lu=0,fu=0,cu=0,su=0,du=0,Au=0,_u=0;var vu=0,mu=0,pu=0,hu=0,yu=0,bu=0,gu=0,Tu=0,Eu=0,Mu=0,wu=0,Iu=0,Pu=0,Su=0,Ru=0,Nu=0,Cu=0,ku=0,Ou=0,Fu=0;var Bu=0,Hu=0,Uu=0,Wu=0,Vu=0,xu=0,Lu=0,Du=0,Xu=0,Zu=0,Gu=0,zu=0,ju=0,Yu=0,Qu=0,Ju=0,Ku=0,qu=0,$u=0,el=0;var rl=0,nl=0,tl=0,il=0,al=0,ol=0,ul=0,ll=0,fl=0,cl=0,sl=0,dl=0,Al=0,_l=0,vl=0,ml=0,pl=0,hl=0,yl=0,bl=0;var gl=0,Tl=0,El=0,Ml=0,wl=0,Il=0,Pl=0,Sl=0,Rl=0,Nl=0,Cl=0,kl=0,Ol=0,Fl=0,Bl=0,Hl=0,Ul=0,Wl=0,Vl=0,xl=0;var Ll=0,Dl=0,Xl=0,Zl=0,Gl=0,zl=0,jl=0,Yl=0,Ql=0,Jl=0,Kl=0,ql=0,$l=0,ef=0,rf=0,nf=0,tf=0,af=0,of=0,uf=0;var lf=0,ff=0,cf=0,sf=0,df=0,Af=0,_f=0,vf=0,mf=0,pf=0,hf=0,yf=0,bf=0,gf=0,Tf=0,Ef=0,Mf=0,wf=0,If=0,Pf=0;var Sf=0,Rf=0,Nf=0,Cf=0,kf=0,Of=0,Ff=0,Bf=0,Hf=0,Uf=0,Wf=0,Vf=0,xf=0,Lf=0,Df=0,Xf=0,Zf=0,Gf=0,zf=0,jf=0;var Yf=0,Qf=0,Jf=0,Kf=0,qf=0,$f=0,ec=0,rc=0,nc=0,tc=0,ic=0,ac=0,oc=0,uc=0,lc=0,fc=0,cc=0,sc=0,dc=0,Ac=0;var _c=0,vc=0,mc=0,pc=0,hc=0,yc=0,bc=0,gc=0,Tc=0,Ec=0,Mc=0,wc=0,Ic=0,Pc=0,Sc=0,Rc=0,Nc=0,Cc=0,kc=0,Oc=0;var Fc=0,Bc=0,Hc=0,Uc=0,Wc=0,Vc=0,xc=0,Lc=0,Dc=0,Xc=0,Zc=0,Gc=0,zc=0,jc=0,Yc=0,Qc=0,Jc=0,Kc=0,qc=0,$c=0;var es=0,rs=0,ns=0,ts=0,is=0,as=0,os=0,us=0,ls=0,fs=0,cs=0,ss=0,ds=0,As=0,_s=0,vs=0,ms=0,ps=0,hs=0,ys=0;var bs=0,gs=0,Ts=0,Es=0,Ms=0,ws=0,Is=0,Ps=0,Ss=0,Rs=0,Ns=0,Cs=0,ks=0,Os=0,Fs=0,Bs=0,Hs=0,Us=0,Ws=0,Vs=0;var xs=0,Ls=0,Ds=0,Xs=0,Zs=0,Gs=0,zs=0,js=0,Ys=0,Qs=0,Js=0,Ks=0,qs=0,$s=0,ed=0,rd=0,nd=0,td=0,id=0,ad=0;var od=0,ud=0,ld=0,fd=0,cd=0,sd=0,dd=0,Ad=0,_d=0,vd=0,md=0,pd=0,hd=0,yd=0,bd=0,gd=0,Td=0,Ed=0,Md=0,wd=0;var Id=0,Pd=0,Sd=0,Rd=0,Nd=0,Cd=0,kd=0,Od=0,Fd=0,Bd=0,Hd=0,Ud=0,Wd=0,Vd=0,xd=0,Ld=0,Dd=0,Xd=0,Zd=0,Gd=0;var zd=0,jd=0,Yd=0,Qd=0,Jd=0,Kd=0,qd=0,$d=0,eA=0,rA=0,nA=0,tA=0,iA=0,aA=0,oA=0,uA=0,lA=0,fA=0,cA=0,sA=0;var dA=0,AA=0,_A=0,vA=0,mA=0,pA=0,hA=0,yA=0,bA=0,gA=0,TA=0,EA=0,MA=0,wA=0,IA=0,PA=0,SA=0,RA=0,NA=0,CA=0;var kA=0,OA=0,FA=0,BA=0,HA=0,UA=0,WA=0,VA=0,xA=0,LA=0,DA=0,XA=0,ZA=0,GA=0,zA=0,jA=0,YA=0,QA=0,JA=0,KA=0;var qA=0,$A=0,e_=0,r_=0,n_=0,t_=0,i_=0,a_=0,o_=0,u_=0,l_=0,f_=0,c_=0,s_=0,d_=0,A_=0,__=0,v_=0,m_=0,p_=0;var h_=0,y_=0,b_=0,g_=0,T_=0,E_=0,M_=0,w_=0,I_=0,P_=0,S_=0,R_=0,N_=0,C_=0,k_=0,O_=0,F_=0,B_=0,H_=0,U_=0;var W_=0,V_=0,x_=0,L_=0,D_=0,X_=0,Z_=0,G_=0,z_=0,j_=0,Y_=0,Q_=0,J_=0,K_=0,q_=0,$_=0,ev=0,rv=0,nv=0,tv=0;var iv=0,av=0,ov=0,uv=0,lv=0,fv=0,cv=0,sv=0,dv=0,Av=0,_v=0,vv=0,mv=0,pv=0,hv=0,yv=0,bv=0,gv=0,Tv=0,Ev=0;var Mv=0,wv=0,Iv=0,Pv=0,Sv=0,Rv=0,Nv=0,Cv=0,kv=0,Ov=0,Fv=0,Bv=0,Hv=0,Uv=0,Wv=0,Vv=0,xv=0,Lv=0,Dv=0,Xv=0;var Zv=0,Gv=0,zv=0,jv=0,Yv=0,Qv=0,Jv=0,Kv=0,qv=0,$v=0,em=0,rm=0,nm=0,tm=0,im=0,am=0,om=0,um=0,lm=0,fm=0;var cm=0,sm=0,dm=0,Am=0,_m=0,vm=0,mm=0,pm=0,hm=0,ym=0,bm=0,gm=0,Tm=0,Em=0,Mm=0,wm=0,Im=0,Pm=0,Sm=0,Rm=0;var Nm=0,Cm=0,km=0,Om=0,Fm=0,Bm=0,Hm=0,Um=0,Wm=0,Vm=0,xm=0,Lm=0,Dm=0,Xm=0,Zm=0,Gm=0,zm=0,jm=0,Ym=0,Qm=0;var Jm=0,Km=0,qm=0,$m=0,ep=0,rp=0,np=0,tp=0,ip=0,ap=0,op=0,up=0,lp=0,fp=0,cp=0,sp=0,dp=0,Ap=0,_p=0,vp=0;var mp=0,pp=0,hp=0,yp=0,bp=0,gp=0,Tp=0,Ep=0,Mp=0,wp=0,Ip=0,Pp=0,Sp=0,Rp=0,Np=0,Cp=0,kp=0,Op=0,Fp=0,Bp=0;var Hp=0,Up=0,Wp=0,Vp=0,xp=0,Lp=0,Dp=0,Xp=0,Zp=0,Gp=0,zp=0,jp=0,Yp=0,Qp=0,Jp=0,Kp=0,qp=0,$p=0,eh=0,rh=0;var nh=0,th=0,ih=0,ah=0,oh=0,uh=0,lh=0,fh=0,ch=0,sh=0,dh=0,Ah=0,_h=0,vh=0,mh=0,ph=0,hh=0,yh=0,bh=0,gh=0;var Th=0,Eh=0,Mh=0,wh=0,Ih=0,Ph=0,Sh=0,Rh=0,Nh=0,Ch=0,kh=0,Oh=0,Fh=0,Bh=0,Hh=0,Uh=0,Wh=0,Vh=0,xh=0,Lh=0;var Dh=0,Xh=0,Zh=0,Gh=0,zh=0,jh=0,Yh=0,Qh=0,Jh=0,Kh=0,qh=0,$h=0,ey=0,ry=0,ny=0;ny=_;_=_+16|0;Oe=ny;Un=e>>>0<245;do{if(Un){Di=e>>>0<11;zo=e+11|0;Ql=zo&-8;$c=Di?16:Ql;nA=$c>>>3;av=a[740]|0;lp=av>>>nA;Fe=lp&3;Ge=(Fe|0)==0;if(!Ge){nr=lp&1;Ar=nr^1;Mr=Ar+nA|0;Br=Mr<<1;zr=3000+(Br<<2)|0;tn=zr+8|0;vn=a[tn>>2]|0;In=vn+8|0;Wn=a[In>>2]|0;Jn=(Wn|0)==(zr|0);if(Jn){ut=1<<Mr;ht=ut^-1;Nt=av&ht;a[740]=Nt}else{Lt=Wn+12|0;a[Lt>>2]=zr;a[tn>>2]=Wn}qt=Mr<<3;fi=qt|3;bi=vn+4|0;a[bi>>2]=fi;Ci=vn+qt|0;Xi=Ci+4|0;ea=a[Xi>>2]|0;sa=ea|1;a[Xi>>2]=sa;u=In;_=ny;return u|0}Ta=a[2968>>2]|0;Oa=$c>>>0>Ta>>>0;if(Oa){Za=(lp|0)==0;if(!Za){ro=lp<<nA;Ao=2<<nA;Mo=0-Ao|0;Bo=Ao|Mo;jo=ro&Bo;iu=0-jo|0;vu=jo&iu;Iu=vu+-1|0;Uu=Iu>>>12;Yu=Uu&16;al=Iu>>>Yu;ml=al>>>5;Pl=ml&8;Wl=Pl|Yu;Jl=al>>>Pl;lf=Jl>>>2;yf=lf&4;Nf=Wl|yf;Lf=Jl>>>yf;qf=Lf>>>1;fc=qf&2;bc=Nf|fc;Cc=Lf>>>fc;Dc=Cc>>>1;es=Dc&1;ss=bc|es;Ts=Cc>>>es;Os=ss+Ts|0;Zs=Os<<1;rd=3000+(Zs<<2)|0;dd=rd+8|0;Ed=a[dd>>2]|0;Fd=Ed+8|0;Gd=a[Fd>>2]|0;tA=(Gd|0)==(rd|0);if(tA){_A=1<<Os;wA=_A^-1;HA=av&wA;a[740]=HA;fp=HA}else{jA=Gd+12|0;a[jA>>2]=rd;a[dd>>2]=Gd;fp=av}i_=Os<<3;v_=i_-$c|0;I_=$c|3;U_=Ed+4|0;a[U_>>2]=I_;Y_=Ed+$c|0;ov=v_|1;pv=Y_+4|0;a[pv>>2]=ov;Sv=Ed+i_|0;a[Sv>>2]=v_;Vv=(Ta|0)==0;if(!Vv){Jv=a[2980>>2]|0;um=Ta>>>3;hm=um<<1;Rm=3000+(hm<<2)|0;xm=1<<um;Km=fp&xm;bp=(Km|0)==0;if(bp){Cp=fp|xm;a[740]=Cp;me=Rm+8|0;h=Rm;Ie=me}else{Dp=Rm+8|0;$p=a[Dp>>2]|0;h=$p;Ie=Dp}a[Ie>>2]=Jv;ch=h+12|0;a[ch>>2]=Jv;gh=Jv+8|0;a[gh>>2]=h;kh=Jv+12|0;a[kh>>2]=Rm}a[2968>>2]=v_;a[2980>>2]=Y_;u=Fd;_=ny;return u|0}Bh=a[2964>>2]|0;Hh=(Bh|0)==0;if(Hh){p=$c}else{Be=0-Bh|0;He=Bh&Be;Ue=He+-1|0;We=Ue>>>12;Ve=We&16;xe=Ue>>>Ve;Le=xe>>>5;De=Le&8;Xe=De|Ve;Ze=xe>>>De;ze=Ze>>>2;je=ze&4;Ye=Xe|je;Qe=Ze>>>je;Je=Qe>>>1;Ke=Je&2;qe=Ye|Ke;$e=Qe>>>Ke;er=$e>>>1;rr=er&1;tr=qe|rr;ir=$e>>>rr;ar=tr+ir|0;or=3264+(ar<<2)|0;ur=a[or>>2]|0;lr=ur+4|0;fr=a[lr>>2]|0;cr=fr&-8;sr=cr-$c|0;dr=ur+16|0;_r=a[dr>>2]|0;vr=(_r|0)==(0|0);Re=vr&1;mr=(ur+16|0)+(Re<<2)|0;pr=a[mr>>2]|0;hr=(pr|0)==(0|0);if(hr){d=ur;v=sr}else{A=ur;m=sr;br=pr;while(1){yr=br+4|0;gr=a[yr>>2]|0;Tr=gr&-8;Er=Tr-$c|0;wr=Er>>>0<m>>>0;n=wr?Er:m;r=wr?br:A;Ir=br+16|0;Pr=a[Ir>>2]|0;Sr=(Pr|0)==(0|0);Pe=Sr&1;Rr=(br+16|0)+(Pe<<2)|0;Nr=a[Rr>>2]|0;Cr=(Nr|0)==(0|0);if(Cr){d=r;v=n;break}else{A=r;m=n;br=Nr}}}kr=d+$c|0;Or=kr>>>0>d>>>0;if(Or){Fr=d+24|0;Hr=a[Fr>>2]|0;Ur=d+12|0;Wr=a[Ur>>2]|0;Vr=(Wr|0)==(d|0);do{if(Vr){Zr=d+20|0;Gr=a[Zr>>2]|0;jr=(Gr|0)==(0|0);if(jr){Yr=d+16|0;Qr=a[Yr>>2]|0;Jr=(Qr|0)==(0|0);if(Jr){ee=0;break}else{x=Qr;L=Yr}}else{x=Gr;L=Zr}while(1){Kr=x+20|0;qr=a[Kr>>2]|0;$r=(qr|0)==(0|0);if(!$r){x=qr;L=Kr;continue}en=x+16|0;rn=a[en>>2]|0;nn=(rn|0)==(0|0);if(nn){break}else{x=rn;L=en}}a[L>>2]=0;ee=x}else{xr=d+8|0;Lr=a[xr>>2]|0;Dr=Lr+12|0;a[Dr>>2]=Wr;Xr=Wr+8|0;a[Xr>>2]=Lr;ee=Wr}}while(0);an=(Hr|0)==(0|0);do{if(!an){on=d+28|0;un=a[on>>2]|0;ln=3264+(un<<2)|0;fn=a[ln>>2]|0;cn=(d|0)==(fn|0);if(cn){a[ln>>2]=ee;Uh=(ee|0)==(0|0);if(Uh){sn=1<<un;dn=sn^-1;An=Bh&dn;a[2964>>2]=An;break}}else{_n=Hr+16|0;mn=a[_n>>2]|0;pn=(mn|0)!=(d|0);Ne=pn&1;hn=(Hr+16|0)+(Ne<<2)|0;a[hn>>2]=ee;yn=(ee|0)==(0|0);if(yn){break}}bn=ee+24|0;a[bn>>2]=Hr;gn=d+16|0;Tn=a[gn>>2]|0;En=(Tn|0)==(0|0);if(!En){Mn=ee+16|0;a[Mn>>2]=Tn;wn=Tn+24|0;a[wn>>2]=ee}Pn=d+20|0;Sn=a[Pn>>2]|0;Rn=(Sn|0)==(0|0);if(!Rn){Nn=ee+20|0;a[Nn>>2]=Sn;Cn=Sn+24|0;a[Cn>>2]=ee}}}while(0);kn=v>>>0<16;if(kn){On=v+$c|0;Fn=On|3;Bn=d+4|0;a[Bn>>2]=Fn;Hn=d+On|0;Vn=Hn+4|0;xn=a[Vn>>2]|0;Ln=xn|1;a[Vn>>2]=Ln}else{Dn=$c|3;Xn=d+4|0;a[Xn>>2]=Dn;Zn=v|1;Gn=kr+4|0;a[Gn>>2]=Zn;zn=kr+v|0;a[zn>>2]=v;jn=(Ta|0)==0;if(!jn){Yn=a[2980>>2]|0;Kn=Ta>>>3;qn=Kn<<1;$n=3000+(qn<<2)|0;et=1<<Kn;rt=av&et;nt=(rt|0)==0;if(nt){tt=av|et;a[740]=tt;pe=$n+8|0;l=$n;we=pe}else{it=$n+8|0;at=a[it>>2]|0;l=at;we=it}a[we>>2]=Yn;ot=l+12|0;a[ot>>2]=Yn;lt=Yn+8|0;a[lt>>2]=l;ft=Yn+12|0;a[ft>>2]=$n}a[2968>>2]=v;a[2980>>2]=kr}ct=d+8|0;u=ct;_=ny;return u|0}else{p=$c}}}else{p=$c}}else{st=e>>>0>4294967231;if(st){p=-1}else{dt=e+11|0;At=dt&-8;_t=a[2964>>2]|0;vt=(_t|0)==0;if(vt){p=At}else{mt=0-At|0;pt=dt>>>8;yt=(pt|0)==0;if(yt){F=0}else{bt=At>>>0>16777215;if(bt){F=31}else{gt=pt+1048320|0;Tt=gt>>>16;Et=Tt&8;Mt=pt<<Et;wt=Mt+520192|0;It=wt>>>16;Pt=It&4;St=Pt|Et;Ct=Mt<<Pt;kt=Ct+245760|0;Ot=kt>>>16;Ft=Ot&2;Bt=St|Ft;Ht=14-Bt|0;Ut=Ct<<Ft;Wt=Ut>>>15;Vt=Ht+Wt|0;xt=Vt<<1;Dt=Vt+7|0;Xt=At>>>Dt;Zt=Xt&1;Gt=Zt|xt;F=Gt}}zt=3264+(F<<2)|0;jt=a[zt>>2]|0;Yt=(jt|0)==(0|0);e:do{if(Yt){$=0;ne=0;te=mt;ry=57}else{Qt=(F|0)==31;Jt=F>>>1;Kt=25-Jt|0;$t=Qt?0:Kt;ei=At<<$t;R=0;k=mt;O=jt;H=ei;W=0;while(1){ri=O+4|0;ni=a[ri>>2]|0;ti=ni&-8;ii=ti-At|0;ai=ii>>>0<k>>>0;if(ai){oi=(ii|0)==0;if(oi){fe=0;de=O;Ae=O;ry=61;break e}else{G=O;z=ii}}else{G=R;z=k}ui=O+20|0;li=a[ui>>2]|0;ci=H>>>31;si=(O+16|0)+(ci<<2)|0;di=a[si>>2]|0;Ai=(li|0)==(0|0);_i=(li|0)==(di|0);Gh=Ai|_i;j=Gh?W:li;vi=(di|0)==(0|0);Lh=vi^1;mi=Lh&1;B=H<<mi;if(vi){$=j;ne=G;te=z;ry=57;break}else{R=G;k=z;O=di;H=B;W=j}}}}while(0);if((ry|0)==57){pi=($|0)==(0|0);hi=(ne|0)==(0|0);Xh=pi&hi;if(Xh){yi=2<<F;gi=0-yi|0;Ti=yi|gi;Ei=_t&Ti;Mi=(Ei|0)==0;if(Mi){p=At;break}wi=0-Ei|0;Ii=Ei&wi;Pi=Ii+-1|0;Si=Pi>>>12;Ri=Si&16;Ni=Pi>>>Ri;ki=Ni>>>5;Oi=ki&8;Fi=Oi|Ri;Bi=Ni>>>Oi;Hi=Bi>>>2;Ui=Hi&4;Wi=Fi|Ui;Vi=Bi>>>Ui;xi=Vi>>>1;Li=xi&2;Zi=Wi|Li;Gi=Vi>>>Li;zi=Gi>>>1;ji=zi&1;Yi=Zi|ji;Qi=Gi>>>ji;Ji=Yi+Qi|0;Ki=3264+(Ji<<2)|0;qi=a[Ki>>2]|0;oe=0;se=qi}else{oe=ne;se=$}$i=(se|0)==(0|0);if($i){ae=oe;le=te}else{fe=te;de=se;Ae=oe;ry=61}}if((ry|0)==61){while(1){ry=0;ra=de+4|0;na=a[ra>>2]|0;ta=na&-8;ia=ta-At|0;aa=ia>>>0<fe>>>0;i=aa?ia:fe;ce=aa?de:Ae;oa=de+16|0;ua=a[oa>>2]|0;la=(ua|0)==(0|0);Ce=la&1;fa=(de+16|0)+(Ce<<2)|0;ca=a[fa>>2]|0;da=(ca|0)==(0|0);if(da){ae=ce;le=i;break}else{fe=i;de=ca;Ae=ce;ry=61}}}Aa=(ae|0)==(0|0);if(Aa){p=At}else{_a=a[2968>>2]|0;va=_a-At|0;ma=le>>>0<va>>>0;if(ma){pa=ae+At|0;ha=pa>>>0>ae>>>0;if(!ha){u=0;_=ny;return u|0}ya=ae+24|0;ba=a[ya>>2]|0;ga=ae+12|0;Ea=a[ga>>2]|0;Ma=(Ea|0)==(ae|0);do{if(Ma){Ra=ae+20|0;Na=a[Ra>>2]|0;Ca=(Na|0)==(0|0);if(Ca){ka=ae+16|0;Fa=a[ka>>2]|0;Ba=(Fa|0)==(0|0);if(Ba){ie=0;break}else{Y=Fa;Q=ka}}else{Y=Na;Q=Ra}while(1){Ha=Y+20|0;Ua=a[Ha>>2]|0;Wa=(Ua|0)==(0|0);if(!Wa){Y=Ua;Q=Ha;continue}Va=Y+16|0;xa=a[Va>>2]|0;La=(xa|0)==(0|0);if(La){break}else{Y=xa;Q=Va}}a[Q>>2]=0;ie=Y}else{wa=ae+8|0;Ia=a[wa>>2]|0;Pa=Ia+12|0;a[Pa>>2]=Ea;Sa=Ea+8|0;a[Sa>>2]=Ia;ie=Ea}}while(0);Da=(ba|0)==(0|0);do{if(Da){Su=_t}else{Xa=ae+28|0;Ga=a[Xa>>2]|0;za=3264+(Ga<<2)|0;ja=a[za>>2]|0;Ya=(ae|0)==(ja|0);if(Ya){a[za>>2]=ie;Vh=(ie|0)==(0|0);if(Vh){Qa=1<<Ga;Ja=Qa^-1;Ka=_t&Ja;a[2964>>2]=Ka;Su=Ka;break}}else{qa=ba+16|0;$a=a[qa>>2]|0;eo=($a|0)!=(ae|0);ke=eo&1;no=(ba+16|0)+(ke<<2)|0;a[no>>2]=ie;to=(ie|0)==(0|0);if(to){Su=_t;break}}io=ie+24|0;a[io>>2]=ba;ao=ae+16|0;oo=a[ao>>2]|0;uo=(oo|0)==(0|0);if(!uo){lo=ie+16|0;a[lo>>2]=oo;fo=oo+24|0;a[fo>>2]=ie}co=ae+20|0;so=a[co>>2]|0;_o=(so|0)==(0|0);if(_o){Su=_t}else{vo=ie+20|0;a[vo>>2]=so;mo=so+24|0;a[mo>>2]=ie;Su=_t}}}while(0);po=le>>>0<16;do{if(po){ho=le+At|0;yo=ho|3;bo=ae+4|0;a[bo>>2]=yo;go=ae+ho|0;To=go+4|0;Eo=a[To>>2]|0;wo=Eo|1;a[To>>2]=wo}else{Io=At|3;Po=ae+4|0;a[Po>>2]=Io;So=le|1;Ro=pa+4|0;a[Ro>>2]=So;No=pa+le|0;a[No>>2]=le;Co=le>>>3;ko=le>>>0<256;if(ko){Oo=Co<<1;Fo=3000+(Oo<<2)|0;Ho=a[740]|0;Uo=1<<Co;Wo=Ho&Uo;Vo=(Wo|0)==0;if(Vo){xo=Ho|Uo;a[740]=xo;ge=Fo+8|0;V=Fo;Me=ge}else{Lo=Fo+8|0;Do=a[Lo>>2]|0;V=Do;Me=Lo}a[Me>>2]=pa;Xo=V+12|0;a[Xo>>2]=pa;Zo=pa+8|0;a[Zo>>2]=V;Go=pa+12|0;a[Go>>2]=Fo;break}Yo=le>>>8;Qo=(Yo|0)==0;if(Qo){U=0}else{Jo=le>>>0>16777215;if(Jo){U=31}else{Ko=Yo+1048320|0;qo=Ko>>>16;$o=qo&8;eu=Yo<<$o;ru=eu+520192|0;nu=ru>>>16;tu=nu&4;au=tu|$o;ou=eu<<tu;uu=ou+245760|0;lu=uu>>>16;fu=lu&2;cu=au|fu;su=14-cu|0;du=ou<<fu;Au=du>>>15;_u=su+Au|0;mu=_u<<1;pu=_u+7|0;hu=le>>>pu;yu=hu&1;bu=yu|mu;U=bu}}gu=3264+(U<<2)|0;Tu=pa+28|0;a[Tu>>2]=U;Eu=pa+16|0;Mu=Eu+4|0;a[Mu>>2]=0;a[Eu>>2]=0;wu=1<<U;Pu=Su&wu;Ru=(Pu|0)==0;if(Ru){Nu=Su|wu;a[2964>>2]=Nu;a[gu>>2]=pa;Cu=pa+24|0;a[Cu>>2]=gu;ku=pa+12|0;a[ku>>2]=pa;Ou=pa+8|0;a[Ou>>2]=pa;break}Fu=a[gu>>2]|0;Bu=(U|0)==31;Hu=U>>>1;Wu=25-Hu|0;Vu=Bu?0:Wu;xu=le<<Vu;N=xu;C=Fu;while(1){Lu=C+4|0;Du=a[Lu>>2]|0;Xu=Du&-8;Zu=(Xu|0)==(le|0);if(Zu){ry=97;break}Gu=N>>>31;zu=(C+16|0)+(Gu<<2)|0;ju=N<<1;Qu=a[zu>>2]|0;Ju=(Qu|0)==(0|0);if(Ju){ry=96;break}else{N=ju;C=Qu}}if((ry|0)==96){a[zu>>2]=pa;Ku=pa+24|0;a[Ku>>2]=C;qu=pa+12|0;a[qu>>2]=pa;$u=pa+8|0;a[$u>>2]=pa;break}else if((ry|0)==97){el=C+8|0;rl=a[el>>2]|0;nl=rl+12|0;a[nl>>2]=pa;a[el>>2]=pa;tl=pa+8|0;a[tl>>2]=rl;il=pa+12|0;a[il>>2]=C;ol=pa+24|0;a[ol>>2]=0;break}}}while(0);ul=ae+8|0;u=ul;_=ny;return u|0}else{p=At}}}}}}while(0);ll=a[2968>>2]|0;fl=ll>>>0<p>>>0;if(!fl){cl=ll-p|0;sl=a[2980>>2]|0;dl=cl>>>0>15;if(dl){Al=sl+p|0;a[2980>>2]=Al;a[2968>>2]=cl;_l=cl|1;vl=Al+4|0;a[vl>>2]=_l;pl=sl+ll|0;a[pl>>2]=cl;hl=p|3;yl=sl+4|0;a[yl>>2]=hl}else{a[2968>>2]=0;a[2980>>2]=0;bl=ll|3;gl=sl+4|0;a[gl>>2]=bl;Tl=sl+ll|0;El=Tl+4|0;Ml=a[El>>2]|0;wl=Ml|1;a[El>>2]=wl}Il=sl+8|0;u=Il;_=ny;return u|0}Sl=a[2972>>2]|0;Rl=Sl>>>0>p>>>0;if(Rl){Nl=Sl-p|0;a[2972>>2]=Nl;Cl=a[2984>>2]|0;kl=Cl+p|0;a[2984>>2]=kl;Ol=Nl|1;Fl=kl+4|0;a[Fl>>2]=Ol;Bl=p|3;Hl=Cl+4|0;a[Hl>>2]=Bl;Ul=Cl+8|0;u=Ul;_=ny;return u|0}Vl=a[858]|0;xl=(Vl|0)==0;if(xl){a[3440>>2]=4096;a[3436>>2]=4096;a[3444>>2]=-1;a[3448>>2]=-1;a[3452>>2]=0;a[3404>>2]=0;Ll=Oe;Dl=Ll&-16;Xl=Dl^1431655768;a[858]=Xl;jl=4096}else{be=a[3440>>2]|0;jl=be}Zl=p+48|0;Gl=p+47|0;zl=jl+Gl|0;Yl=0-jl|0;Kl=zl&Yl;ql=Kl>>>0>p>>>0;if(!ql){u=0;_=ny;return u|0}$l=a[3400>>2]|0;ef=($l|0)==0;if(!ef){rf=a[3392>>2]|0;nf=rf+Kl|0;tf=nf>>>0<=rf>>>0;af=nf>>>0>$l>>>0;Zh=tf|af;if(Zh){u=0;_=ny;return u|0}}of=a[3404>>2]|0;uf=of&4;ff=(uf|0)==0;e:do{if(ff){cf=a[2984>>2]|0;sf=(cf|0)==(0|0);r:do{if(sf){ry=118}else{s=3408;while(1){df=a[s>>2]|0;Af=df>>>0>cf>>>0;if(!Af){_f=s+4|0;vf=a[_f>>2]|0;mf=df+vf|0;pf=mf>>>0>cf>>>0;if(pf){break}}hf=s+8|0;bf=a[hf>>2]|0;gf=(bf|0)==(0|0);if(gf){ry=118;break r}else{s=bf}}zf=zl-Sl|0;jf=zf&Yl;Yf=jf>>>0<2147483647;if(Yf){Qf=Rt(jf|0)|0;Jf=a[s>>2]|0;Kf=a[_f>>2]|0;$f=Jf+Kf|0;ec=(Qf|0)==($f|0);if(ec){rc=(Qf|0)==(-1|0);if(rc){J=jf}else{_e=jf;ve=Qf;ry=135;break e}}else{K=Qf;q=jf;ry=126}}else{J=0}}}while(0);do{if((ry|0)==118){Tf=Rt(0)|0;Ef=(Tf|0)==(-1|0);if(Ef){J=0}else{Mf=Tf;wf=a[3436>>2]|0;If=wf+-1|0;Pf=If&Mf;Sf=(Pf|0)==0;Rf=If+Mf|0;Cf=0-wf|0;kf=Rf&Cf;Of=kf-Mf|0;Ff=Sf?0:Of;o=Ff+Kl|0;Bf=a[3392>>2]|0;Hf=o+Bf|0;Uf=o>>>0>p>>>0;Wf=o>>>0<2147483647;Dh=Uf&Wf;if(Dh){Vf=a[3400>>2]|0;xf=(Vf|0)==0;if(!xf){Df=Hf>>>0<=Bf>>>0;Xf=Hf>>>0>Vf>>>0;Jh=Df|Xf;if(Jh){J=0;break}}Zf=Rt(o|0)|0;Gf=(Zf|0)==(Tf|0);if(Gf){_e=o;ve=Tf;ry=135;break e}else{K=Zf;q=o;ry=126}}else{J=0}}}}while(0);do{if((ry|0)==126){nc=0-q|0;tc=(K|0)!=(-1|0);ic=q>>>0<2147483647;ey=ic&tc;ac=Zl>>>0>q>>>0;zh=ac&ey;if(!zh){mc=(K|0)==(-1|0);if(mc){J=0;break}else{_e=q;ve=K;ry=135;break e}}oc=a[3440>>2]|0;uc=Gl-q|0;lc=uc+oc|0;cc=0-oc|0;sc=lc&cc;dc=sc>>>0<2147483647;if(!dc){_e=q;ve=K;ry=135;break e}Ac=Rt(sc|0)|0;_c=(Ac|0)==(-1|0);if(_c){Rt(nc|0)|0;J=0;break}else{vc=sc+q|0;_e=vc;ve=K;ry=135;break e}}}while(0);pc=a[3404>>2]|0;hc=pc|4;a[3404>>2]=hc;ue=J;ry=133}else{ue=0;ry=133}}while(0);if((ry|0)==133){yc=Kl>>>0<2147483647;if(yc){gc=Rt(Kl|0)|0;Tc=Rt(0)|0;Ec=(gc|0)!=(-1|0);Mc=(Tc|0)!=(-1|0);qh=Ec&Mc;wc=gc>>>0<Tc>>>0;jh=wc&qh;Ic=Tc;Pc=gc;Sc=Ic-Pc|0;Rc=p+40|0;Nc=Sc>>>0>Rc>>>0;t=Nc?Sc:ue;Yh=jh^1;kc=(gc|0)==(-1|0);xh=Nc^1;Oc=kc|xh;Kh=Oc|Yh;if(!Kh){_e=t;ve=gc;ry=135}}}if((ry|0)==135){Fc=a[3392>>2]|0;Bc=Fc+_e|0;a[3392>>2]=Bc;Hc=a[3396>>2]|0;Uc=Bc>>>0>Hc>>>0;if(Uc){a[3396>>2]=Bc}Wc=a[2984>>2]|0;Vc=(Wc|0)==(0|0);do{if(Vc){xc=a[2976>>2]|0;Lc=(xc|0)==(0|0);Xc=ve>>>0<xc>>>0;Qh=Lc|Xc;if(Qh){a[2976>>2]=ve}a[3408>>2]=ve;a[3412>>2]=_e;a[3420>>2]=0;Zc=a[858]|0;a[2996>>2]=Zc;a[2992>>2]=-1;a[3012>>2]=3e3;a[3008>>2]=3e3;a[3020>>2]=3008;a[3016>>2]=3008;a[3028>>2]=3016;a[3024>>2]=3016;a[3036>>2]=3024;a[3032>>2]=3024;a[3044>>2]=3032;a[3040>>2]=3032;a[3052>>2]=3040;a[3048>>2]=3040;a[3060>>2]=3048;a[3056>>2]=3048;a[3068>>2]=3056;a[3064>>2]=3056;a[3076>>2]=3064;a[3072>>2]=3064;a[3084>>2]=3072;a[3080>>2]=3072;a[3092>>2]=3080;a[3088>>2]=3080;a[3100>>2]=3088;a[3096>>2]=3088;a[3108>>2]=3096;a[3104>>2]=3096;a[3116>>2]=3104;a[3112>>2]=3104;a[3124>>2]=3112;a[3120>>2]=3112;a[3132>>2]=3120;a[3128>>2]=3120;a[3140>>2]=3128;a[3136>>2]=3128;a[3148>>2]=3136;a[3144>>2]=3136;a[3156>>2]=3144;a[3152>>2]=3144;a[3164>>2]=3152;a[3160>>2]=3152;a[3172>>2]=3160;a[3168>>2]=3160;a[3180>>2]=3168;a[3176>>2]=3168;a[3188>>2]=3176;a[3184>>2]=3176;a[3196>>2]=3184;a[3192>>2]=3184;a[3204>>2]=3192;a[3200>>2]=3192;a[3212>>2]=3200;a[3208>>2]=3200;a[3220>>2]=3208;a[3216>>2]=3208;a[3228>>2]=3216;a[3224>>2]=3216;a[3236>>2]=3224;a[3232>>2]=3224;a[3244>>2]=3232;a[3240>>2]=3232;a[3252>>2]=3240;a[3248>>2]=3240;a[3260>>2]=3248;a[3256>>2]=3248;Gc=_e+-40|0;zc=ve+8|0;jc=zc;Yc=jc&7;Qc=(Yc|0)==0;Jc=0-jc|0;Kc=Jc&7;qc=Qc?0:Kc;rs=ve+qc|0;ns=Gc-qc|0;a[2984>>2]=rs;a[2972>>2]=ns;ts=ns|1;is=rs+4|0;a[is>>2]=ts;as=ve+Gc|0;os=as+4|0;a[os>>2]=40;us=a[3448>>2]|0;a[2988>>2]=us}else{E=3408;while(1){ls=a[E>>2]|0;fs=E+4|0;cs=a[fs>>2]|0;ds=ls+cs|0;As=(ve|0)==(ds|0);if(As){ry=143;break}_s=E+8|0;vs=a[_s>>2]|0;ms=(vs|0)==(0|0);if(ms){break}else{E=vs}}if((ry|0)==143){ps=E+12|0;hs=a[ps>>2]|0;ys=hs&8;bs=(ys|0)==0;if(bs){gs=ls>>>0<=Wc>>>0;Es=ve>>>0>Wc>>>0;$h=Es&gs;if($h){Ms=cs+_e|0;a[fs>>2]=Ms;ws=a[2972>>2]|0;Is=ws+_e|0;Ps=Wc+8|0;Ss=Ps;Rs=Ss&7;Ns=(Rs|0)==0;Cs=0-Ss|0;ks=Cs&7;Fs=Ns?0:ks;Bs=Wc+Fs|0;Hs=Is-Fs|0;a[2984>>2]=Bs;a[2972>>2]=Hs;Us=Hs|1;Ws=Bs+4|0;a[Ws>>2]=Us;Vs=Wc+Is|0;xs=Vs+4|0;a[xs>>2]=40;Ls=a[3448>>2]|0;a[2988>>2]=Ls;break}}}Ds=a[2976>>2]|0;Xs=ve>>>0<Ds>>>0;if(Xs){a[2976>>2]=ve}Gs=ve+_e|0;D=3408;while(1){zs=a[D>>2]|0;js=(zs|0)==(Gs|0);if(js){ry=151;break}Ys=D+8|0;Qs=a[Ys>>2]|0;Js=(Qs|0)==(0|0);if(Js){c=3408;break}else{D=Qs}}if((ry|0)==151){Ks=D+12|0;qs=a[Ks>>2]|0;$s=qs&8;ed=($s|0)==0;if(ed){a[D>>2]=ve;nd=D+4|0;td=a[nd>>2]|0;id=td+_e|0;a[nd>>2]=id;ad=ve+8|0;od=ad;ud=od&7;ld=(ud|0)==0;fd=0-od|0;cd=fd&7;sd=ld?0:cd;Ad=ve+sd|0;_d=Gs+8|0;vd=_d;md=vd&7;pd=(md|0)==0;hd=0-vd|0;yd=hd&7;bd=pd?0:yd;gd=Gs+bd|0;Td=gd;Md=Ad;wd=Td-Md|0;Id=Ad+p|0;Pd=wd-p|0;Sd=p|3;Rd=Ad+4|0;a[Rd>>2]=Sd;Nd=(Wc|0)==(gd|0);do{if(Nd){Cd=a[2972>>2]|0;kd=Cd+Pd|0;a[2972>>2]=kd;a[2984>>2]=Id;Od=kd|1;Bd=Id+4|0;a[Bd>>2]=Od}else{Hd=a[2980>>2]|0;Ud=(Hd|0)==(gd|0);if(Ud){Wd=a[2968>>2]|0;Vd=Wd+Pd|0;a[2968>>2]=Vd;a[2980>>2]=Id;xd=Vd|1;Ld=Id+4|0;a[Ld>>2]=xd;Dd=Id+Vd|0;a[Dd>>2]=Vd;break}Xd=gd+4|0;Zd=a[Xd>>2]|0;zd=Zd&3;jd=(zd|0)==1;if(jd){Yd=Zd&-8;Qd=Zd>>>3;Jd=Zd>>>0<256;e:do{if(Jd){Kd=gd+8|0;qd=a[Kd>>2]|0;$d=gd+12|0;eA=a[$d>>2]|0;rA=(eA|0)==(qd|0);if(rA){iA=1<<Qd;aA=iA^-1;oA=a[740]|0;uA=oA&aA;a[740]=uA;break}else{lA=qd+12|0;a[lA>>2]=eA;fA=eA+8|0;a[fA>>2]=qd;break}}else{cA=gd+24|0;sA=a[cA>>2]|0;dA=gd+12|0;AA=a[dA>>2]|0;vA=(AA|0)==(gd|0);do{if(vA){bA=gd+16|0;gA=bA+4|0;TA=a[gA>>2]|0;EA=(TA|0)==(0|0);if(EA){MA=a[bA>>2]|0;IA=(MA|0)==(0|0);if(IA){re=0;break}else{X=MA;Z=bA}}else{X=TA;Z=gA}while(1){PA=X+20|0;SA=a[PA>>2]|0;RA=(SA|0)==(0|0);if(!RA){X=SA;Z=PA;continue}NA=X+16|0;CA=a[NA>>2]|0;kA=(CA|0)==(0|0);if(kA){break}else{X=CA;Z=NA}}a[Z>>2]=0;re=X}else{mA=gd+8|0;pA=a[mA>>2]|0;hA=pA+12|0;a[hA>>2]=AA;yA=AA+8|0;a[yA>>2]=pA;re=AA}}while(0);OA=(sA|0)==(0|0);if(OA){break}FA=gd+28|0;BA=a[FA>>2]|0;UA=3264+(BA<<2)|0;WA=a[UA>>2]|0;VA=(WA|0)==(gd|0);do{if(VA){a[UA>>2]=re;Wh=(re|0)==(0|0);if(!Wh){break}xA=1<<BA;LA=xA^-1;DA=a[2964>>2]|0;XA=DA&LA;a[2964>>2]=XA;break e}else{ZA=sA+16|0;GA=a[ZA>>2]|0;zA=(GA|0)!=(gd|0);Se=zA&1;YA=(sA+16|0)+(Se<<2)|0;a[YA>>2]=re;QA=(re|0)==(0|0);if(QA){break e}}}while(0);JA=re+24|0;a[JA>>2]=sA;KA=gd+16|0;qA=a[KA>>2]|0;$A=(qA|0)==(0|0);if(!$A){e_=re+16|0;a[e_>>2]=qA;r_=qA+24|0;a[r_>>2]=re}n_=KA+4|0;t_=a[n_>>2]|0;a_=(t_|0)==(0|0);if(a_){break}o_=re+20|0;a[o_>>2]=t_;u_=t_+24|0;a[u_>>2]=re}}while(0);l_=gd+Yd|0;f_=Yd+Pd|0;f=l_;M=f_}else{f=gd;M=Pd}c_=f+4|0;s_=a[c_>>2]|0;d_=s_&-2;a[c_>>2]=d_;A_=M|1;__=Id+4|0;a[__>>2]=A_;m_=Id+M|0;a[m_>>2]=M;p_=M>>>3;h_=M>>>0<256;if(h_){y_=p_<<1;b_=3000+(y_<<2)|0;g_=a[740]|0;T_=1<<p_;E_=g_&T_;M_=(E_|0)==0;if(M_){w_=g_|T_;a[740]=w_;ye=b_+8|0;P=b_;Ee=ye}else{P_=b_+8|0;S_=a[P_>>2]|0;P=S_;Ee=P_}a[Ee>>2]=Id;R_=P+12|0;a[R_>>2]=Id;N_=Id+8|0;a[N_>>2]=P;C_=Id+12|0;a[C_>>2]=b_;break}k_=M>>>8;O_=(k_|0)==0;do{if(O_){S=0}else{F_=M>>>0>16777215;if(F_){S=31;break}B_=k_+1048320|0;H_=B_>>>16;W_=H_&8;V_=k_<<W_;x_=V_+520192|0;L_=x_>>>16;D_=L_&4;X_=D_|W_;Z_=V_<<D_;G_=Z_+245760|0;z_=G_>>>16;j_=z_&2;Q_=X_|j_;J_=14-Q_|0;K_=Z_<<j_;q_=K_>>>15;$_=J_+q_|0;ev=$_<<1;rv=$_+7|0;nv=M>>>rv;tv=nv&1;iv=tv|ev;S=iv}}while(0);uv=3264+(S<<2)|0;lv=Id+28|0;a[lv>>2]=S;fv=Id+16|0;cv=fv+4|0;a[cv>>2]=0;a[fv>>2]=0;sv=a[2964>>2]|0;dv=1<<S;Av=sv&dv;_v=(Av|0)==0;if(_v){vv=sv|dv;a[2964>>2]=vv;a[uv>>2]=Id;mv=Id+24|0;a[mv>>2]=uv;hv=Id+12|0;a[hv>>2]=Id;yv=Id+8|0;a[yv>>2]=Id;break}bv=a[uv>>2]|0;gv=(S|0)==31;Tv=S>>>1;Ev=25-Tv|0;Mv=gv?0:Ev;wv=M<<Mv;w=wv;I=bv;while(1){Iv=I+4|0;Pv=a[Iv>>2]|0;Rv=Pv&-8;Nv=(Rv|0)==(M|0);if(Nv){ry=192;break}Cv=w>>>31;kv=(I+16|0)+(Cv<<2)|0;Ov=w<<1;Fv=a[kv>>2]|0;Bv=(Fv|0)==(0|0);if(Bv){ry=191;break}else{w=Ov;I=Fv}}if((ry|0)==191){a[kv>>2]=Id;Hv=Id+24|0;a[Hv>>2]=I;Uv=Id+12|0;a[Uv>>2]=Id;Wv=Id+8|0;a[Wv>>2]=Id;break}else if((ry|0)==192){xv=I+8|0;Lv=a[xv>>2]|0;Dv=Lv+12|0;a[Dv>>2]=Id;a[xv>>2]=Id;Xv=Id+8|0;a[Xv>>2]=Lv;Zv=Id+12|0;a[Zv>>2]=I;Gv=Id+24|0;a[Gv>>2]=0;break}}}while(0);Th=Ad+8|0;u=Th;_=ny;return u|0}else{c=3408}}while(1){zv=a[c>>2]|0;jv=zv>>>0>Wc>>>0;if(!jv){Yv=c+4|0;Qv=a[Yv>>2]|0;Kv=zv+Qv|0;qv=Kv>>>0>Wc>>>0;if(qv){break}}$v=c+8|0;em=a[$v>>2]|0;c=em}rm=Kv+-47|0;nm=rm+8|0;tm=nm;im=tm&7;am=(im|0)==0;om=0-tm|0;lm=om&7;fm=am?0:lm;cm=rm+fm|0;sm=Wc+16|0;dm=cm>>>0<sm>>>0;Am=dm?Wc:cm;_m=Am+8|0;vm=Am+24|0;mm=_e+-40|0;pm=ve+8|0;ym=pm;bm=ym&7;gm=(bm|0)==0;Tm=0-ym|0;Em=Tm&7;Mm=gm?0:Em;wm=ve+Mm|0;Im=mm-Mm|0;a[2984>>2]=wm;a[2972>>2]=Im;Pm=Im|1;Sm=wm+4|0;a[Sm>>2]=Pm;Nm=ve+mm|0;Cm=Nm+4|0;a[Cm>>2]=40;km=a[3448>>2]|0;a[2988>>2]=km;Om=Am+4|0;a[Om>>2]=27;a[_m>>2]=a[3408>>2]|0;a[_m+4>>2]=a[3408+4>>2]|0;a[_m+8>>2]=a[3408+8>>2]|0;a[_m+12>>2]=a[3408+12>>2]|0;a[3408>>2]=ve;a[3412>>2]=_e;a[3420>>2]=0;a[3416>>2]=_m;Bm=vm;while(1){Fm=Bm+4|0;a[Fm>>2]=7;Hm=Bm+8|0;Um=Hm>>>0<Kv>>>0;if(Um){Bm=Fm}else{break}}Wm=(Am|0)==(Wc|0);if(!Wm){Vm=Am;Lm=Wc;Dm=Vm-Lm|0;Xm=a[Om>>2]|0;Zm=Xm&-2;a[Om>>2]=Zm;Gm=Dm|1;zm=Wc+4|0;a[zm>>2]=Gm;a[Am>>2]=Dm;jm=Dm>>>3;Ym=Dm>>>0<256;if(Ym){Qm=jm<<1;Jm=3000+(Qm<<2)|0;qm=a[740]|0;$m=1<<jm;ep=qm&$m;rp=(ep|0)==0;if(rp){np=qm|$m;a[740]=np;he=Jm+8|0;g=Jm;Te=he}else{tp=Jm+8|0;ip=a[tp>>2]|0;g=ip;Te=tp}a[Te>>2]=Wc;ap=g+12|0;a[ap>>2]=Wc;op=Wc+8|0;a[op>>2]=g;up=Wc+12|0;a[up>>2]=Jm;break}cp=Dm>>>8;sp=(cp|0)==0;if(sp){T=0}else{dp=Dm>>>0>16777215;if(dp){T=31}else{Ap=cp+1048320|0;_p=Ap>>>16;vp=_p&8;mp=cp<<vp;pp=mp+520192|0;hp=pp>>>16;yp=hp&4;gp=yp|vp;Tp=mp<<yp;Ep=Tp+245760|0;Mp=Ep>>>16;wp=Mp&2;Ip=gp|wp;Pp=14-Ip|0;Sp=Tp<<wp;Rp=Sp>>>15;Np=Pp+Rp|0;kp=Np<<1;Op=Np+7|0;Fp=Dm>>>Op;Bp=Fp&1;Hp=Bp|kp;T=Hp}}Up=3264+(T<<2)|0;Wp=Wc+28|0;a[Wp>>2]=T;Vp=Wc+20|0;a[Vp>>2]=0;a[sm>>2]=0;xp=a[2964>>2]|0;Lp=1<<T;Xp=xp&Lp;Zp=(Xp|0)==0;if(Zp){Gp=xp|Lp;a[2964>>2]=Gp;a[Up>>2]=Wc;zp=Wc+24|0;a[zp>>2]=Up;jp=Wc+12|0;a[jp>>2]=Wc;Yp=Wc+8|0;a[Yp>>2]=Wc;break}Qp=a[Up>>2]|0;Jp=(T|0)==31;Kp=T>>>1;qp=25-Kp|0;eh=Jp?0:qp;rh=Dm<<eh;y=rh;b=Qp;while(1){nh=b+4|0;th=a[nh>>2]|0;ih=th&-8;ah=(ih|0)==(Dm|0);if(ah){ry=213;break}oh=y>>>31;uh=(b+16|0)+(oh<<2)|0;lh=y<<1;fh=a[uh>>2]|0;sh=(fh|0)==(0|0);if(sh){ry=212;break}else{y=lh;b=fh}}if((ry|0)==212){a[uh>>2]=Wc;dh=Wc+24|0;a[dh>>2]=b;Ah=Wc+12|0;a[Ah>>2]=Wc;_h=Wc+8|0;a[_h>>2]=Wc;break}else if((ry|0)==213){vh=b+8|0;mh=a[vh>>2]|0;ph=mh+12|0;a[ph>>2]=Wc;a[vh>>2]=Wc;hh=Wc+8|0;a[hh>>2]=mh;yh=Wc+12|0;a[yh>>2]=b;bh=Wc+24|0;a[bh>>2]=0;break}}}}while(0);Eh=a[2972>>2]|0;Mh=Eh>>>0>p>>>0;if(Mh){wh=Eh-p|0;a[2972>>2]=wh;Ih=a[2984>>2]|0;Ph=Ih+p|0;a[2984>>2]=Ph;Sh=wh|1;Rh=Ph+4|0;a[Rh>>2]=Sh;Nh=p|3;Ch=Ih+4|0;a[Ch>>2]=Nh;Oh=Ih+8|0;u=Oh;_=ny;return u|0}}Fh=Qn()|0;a[Fh>>2]=12;u=0;_=ny;return u|0}function Yn(e){e=e|0;var r=0,n=0,t=0,i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0;var E=0,M=0,w=0,I=0,P=0,S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0,L=0,D=0;var X=0,Z=0,G=0,z=0,j=0,Y=0,Q=0,J=0,K=0,q=0,$=0,ee=0,re=0,ne=0,te=0,ie=0,ae=0,oe=0,ue=0,le=0;var fe=0,ce=0,se=0,de=0,Ae=0,_e=0,ve=0,me=0,pe=0,he=0,ye=0,be=0,ge=0,Te=0,Ee=0,Me=0,we=0,Ie=0,Pe=0,Se=0;var Re=0,Ne=0,Ce=0,ke=0,Oe=0,Fe=0,Be=0,He=0,Ue=0,We=0,Ve=0,xe=0,Le=0,De=0,Xe=0,Ze=0,Ge=0,ze=0,je=0,Ye=0;var Qe=0,Je=0,Ke=0,qe=0,$e=0,er=0,rr=0,nr=0,tr=0,ir=0,ar=0,or=0,ur=0,lr=0,fr=0,cr=0,sr=0,dr=0,Ar=0,_r=0;var vr=0,mr=0,pr=0,hr=0,yr=0,br=0,gr=0,Tr=0,Er=0,Mr=0,wr=0,Ir=0,Pr=0,Sr=0,Rr=0,Nr=0,Cr=0,kr=0,Or=0,Fr=0;var Br=0,Hr=0,Ur=0,Wr=0,Vr=0,xr=0,Lr=0,Dr=0,Xr=0,Zr=0,Gr=0,zr=0,jr=0,Yr=0,Qr=0,Jr=0,Kr=0,qr=0,$r=0,en=0;var rn=0,nn=0,tn=0,an=0,on=0,un=0,ln=0,fn=0,cn=0,sn=0,dn=0,An=0,_n=0,vn=0,mn=0,pn=0,hn=0,yn=0,bn=0,gn=0;var Tn=0,En=0,Mn=0,wn=0,In=0,Pn=0,Sn=0,Rn=0,Nn=0,Cn=0,kn=0,On=0,Fn=0,Bn=0,Hn=0,Un=0,Wn=0,Vn=0,xn=0,Ln=0;var Dn=0,Xn=0,Zn=0,Gn=0,zn=0,jn=0,Yn=0,Qn=0,Jn=0,Kn=0,qn=0,$n=0,et=0,rt=0,nt=0,tt=0,it=0,at=0,ot=0,ut=0;var lt=0,ft=0,ct=0,st=0,dt=0,At=0,_t=0,vt=0,mt=0,pt=0,ht=0,yt=0,bt=0,gt=0,Tt=0,Et=0,Mt=0,wt=0,It=0,Pt=0;var St=0,Rt=0,Nt=0,Ct=0,kt=0,Ot=0,Ft=0,Bt=0,Ht=0,Ut=0,Wt=0,Vt=0,xt=0,Lt=0,Dt=0,Xt=0,Zt=0,Gt=0,zt=0,jt=0;var Yt=0,Qt=0,Jt=0,Kt=0,qt=0,$t=0,ei=0,ri=0,ni=0,ti=0,ii=0,ai=0,oi=0,ui=0,li=0,fi=0,ci=0,si=0,di=0,Ai=0;var _i=0,vi=0,mi=0;mi=_;T=(e|0)==(0|0);if(T){return}wr=e+-8|0;Zn=a[2976>>2]|0;rt=e+-4|0;dt=a[rt>>2]|0;Et=dt&-8;Ft=wr+Et|0;Gt=dt&1;ni=(Gt|0)==0;do{if(ni){E=a[wr>>2]|0;F=dt&3;G=(F|0)==0;if(G){return}ne=0-E|0;Ae=wr+ne|0;Me=E+Et|0;Be=Ae>>>0<Zn>>>0;if(Be){return}ze=a[2980>>2]|0;tr=(ze|0)==(Ae|0);if(tr){Zt=Ft+4|0;zt=a[Zt>>2]|0;jt=zt&3;Yt=(jt|0)==3;if(!Yt){l=Ae;f=Me;$t=Ae;break}a[2968>>2]=Me;Qt=zt&-2;a[Zt>>2]=Qt;Jt=Me|1;Kt=Ae+4|0;a[Kt>>2]=Jt;qt=Ae+Me|0;a[qt>>2]=Me;return}_r=E>>>3;Ir=E>>>0<256;if(Ir){Ur=Ae+8|0;Yr=a[Ur>>2]|0;on=Ae+12|0;pn=a[on>>2]|0;Sn=(pn|0)==(Yr|0);if(Sn){Vn=1<<_r;Ln=Vn^-1;Dn=a[740]|0;Xn=Dn&Ln;a[740]=Xn;l=Ae;f=Me;$t=Ae;break}else{Gn=Yr+12|0;a[Gn>>2]=pn;zn=pn+8|0;a[zn>>2]=Yr;l=Ae;f=Me;$t=Ae;break}}jn=Ae+24|0;Yn=a[jn>>2]|0;Qn=Ae+12|0;Jn=a[Qn>>2]|0;Kn=(Jn|0)==(Ae|0);do{if(Kn){tt=Ae+16|0;it=tt+4|0;at=a[it>>2]|0;ot=(at|0)==(0|0);if(ot){ut=a[tt>>2]|0;lt=(ut|0)==(0|0);if(lt){m=0;break}else{c=ut;s=tt}}else{c=at;s=it}while(1){ft=c+20|0;ct=a[ft>>2]|0;st=(ct|0)==(0|0);if(!st){c=ct;s=ft;continue}At=c+16|0;_t=a[At>>2]|0;vt=(_t|0)==(0|0);if(vt){break}else{c=_t;s=At}}a[s>>2]=0;m=c}else{qn=Ae+8|0;$n=a[qn>>2]|0;et=$n+12|0;a[et>>2]=Jn;nt=Jn+8|0;a[nt>>2]=$n;m=Jn}}while(0);mt=(Yn|0)==(0|0);if(mt){l=Ae;f=Me;$t=Ae}else{pt=Ae+28|0;ht=a[pt>>2]|0;yt=3264+(ht<<2)|0;bt=a[yt>>2]|0;gt=(bt|0)==(Ae|0);if(gt){a[yt>>2]=m;Ai=(m|0)==(0|0);if(Ai){Tt=1<<ht;Mt=Tt^-1;wt=a[2964>>2]|0;It=wt&Mt;a[2964>>2]=It;l=Ae;f=Me;$t=Ae;break}}else{Pt=Yn+16|0;St=a[Pt>>2]|0;Rt=(St|0)!=(Ae|0);b=Rt&1;Nt=(Yn+16|0)+(b<<2)|0;a[Nt>>2]=m;Ct=(m|0)==(0|0);if(Ct){l=Ae;f=Me;$t=Ae;break}}kt=m+24|0;a[kt>>2]=Yn;Ot=Ae+16|0;Bt=a[Ot>>2]|0;Ht=(Bt|0)==(0|0);if(!Ht){Ut=m+16|0;a[Ut>>2]=Bt;Wt=Bt+24|0;a[Wt>>2]=m}Vt=Ot+4|0;xt=a[Vt>>2]|0;Lt=(xt|0)==(0|0);if(Lt){l=Ae;f=Me;$t=Ae}else{Dt=m+20|0;a[Dt>>2]=xt;Xt=xt+24|0;a[Xt>>2]=m;l=Ae;f=Me;$t=Ae}}}else{l=wr;f=Et;$t=wr}}while(0);ei=$t>>>0<Ft>>>0;if(!ei){return}ri=Ft+4|0;ti=a[ri>>2]|0;ii=ti&1;ai=(ii|0)==0;if(ai){return}oi=ti&2;ui=(oi|0)==0;if(ui){li=a[2984>>2]|0;fi=(li|0)==(Ft|0);if(fi){ci=a[2972>>2]|0;si=ci+f|0;a[2972>>2]=si;a[2984>>2]=l;di=si|1;M=l+4|0;a[M>>2]=di;w=a[2980>>2]|0;I=(l|0)==(w|0);if(!I){return}a[2980>>2]=0;a[2968>>2]=0;return}P=a[2980>>2]|0;S=(P|0)==(Ft|0);if(S){R=a[2968>>2]|0;N=R+f|0;a[2968>>2]=N;a[2980>>2]=$t;C=N|1;k=l+4|0;a[k>>2]=C;O=$t+N|0;a[O>>2]=N;return}B=ti&-8;H=B+f|0;U=ti>>>3;W=ti>>>0<256;do{if(W){V=Ft+8|0;x=a[V>>2]|0;L=Ft+12|0;D=a[L>>2]|0;X=(D|0)==(x|0);if(X){Z=1<<U;z=Z^-1;j=a[740]|0;Y=j&z;a[740]=Y;break}else{Q=x+12|0;a[Q>>2]=D;J=D+8|0;a[J>>2]=x;break}}else{K=Ft+24|0;q=a[K>>2]|0;$=Ft+12|0;ee=a[$>>2]|0;re=(ee|0)==(Ft|0);do{if(re){ue=Ft+16|0;le=ue+4|0;fe=a[le>>2]|0;ce=(fe|0)==(0|0);if(ce){se=a[ue>>2]|0;de=(se|0)==(0|0);if(de){p=0;break}else{d=se;A=ue}}else{d=fe;A=le}while(1){_e=d+20|0;ve=a[_e>>2]|0;me=(ve|0)==(0|0);if(!me){d=ve;A=_e;continue}pe=d+16|0;he=a[pe>>2]|0;ye=(he|0)==(0|0);if(ye){break}else{d=he;A=pe}}a[A>>2]=0;p=d}else{te=Ft+8|0;ie=a[te>>2]|0;ae=ie+12|0;a[ae>>2]=ee;oe=ee+8|0;a[oe>>2]=ie;p=ee}}while(0);be=(q|0)==(0|0);if(!be){ge=Ft+28|0;Te=a[ge>>2]|0;Ee=3264+(Te<<2)|0;we=a[Ee>>2]|0;Ie=(we|0)==(Ft|0);if(Ie){a[Ee>>2]=p;_i=(p|0)==(0|0);if(_i){Pe=1<<Te;Se=Pe^-1;Re=a[2964>>2]|0;Ne=Re&Se;a[2964>>2]=Ne;break}}else{Ce=q+16|0;ke=a[Ce>>2]|0;Oe=(ke|0)!=(Ft|0);g=Oe&1;Fe=(q+16|0)+(g<<2)|0;a[Fe>>2]=p;He=(p|0)==(0|0);if(He){break}}Ue=p+24|0;a[Ue>>2]=q;We=Ft+16|0;Ve=a[We>>2]|0;xe=(Ve|0)==(0|0);if(!xe){Le=p+16|0;a[Le>>2]=Ve;De=Ve+24|0;a[De>>2]=p}Xe=We+4|0;Ze=a[Xe>>2]|0;Ge=(Ze|0)==(0|0);if(!Ge){je=p+20|0;a[je>>2]=Ze;Ye=Ze+24|0;a[Ye>>2]=p}}}}while(0);Qe=H|1;Je=l+4|0;a[Je>>2]=Qe;Ke=$t+H|0;a[Ke>>2]=H;qe=a[2980>>2]|0;$e=(l|0)==(qe|0);if($e){a[2968>>2]=H;return}else{v=H}}else{er=ti&-2;a[ri>>2]=er;rr=f|1;nr=l+4|0;a[nr>>2]=rr;ir=$t+f|0;a[ir>>2]=f;v=f}ar=v>>>3;or=v>>>0<256;if(or){ur=ar<<1;lr=3000+(ur<<2)|0;fr=a[740]|0;cr=1<<ar;sr=fr&cr;dr=(sr|0)==0;if(dr){Ar=fr|cr;a[740]=Ar;h=lr+8|0;u=lr;y=h}else{vr=lr+8|0;mr=a[vr>>2]|0;u=mr;y=vr}a[y>>2]=l;pr=u+12|0;a[pr>>2]=l;hr=l+8|0;a[hr>>2]=u;yr=l+12|0;a[yr>>2]=lr;return}br=v>>>8;gr=(br|0)==0;if(gr){o=0}else{Tr=v>>>0>16777215;if(Tr){o=31}else{Er=br+1048320|0;Mr=Er>>>16;Pr=Mr&8;Sr=br<<Pr;Rr=Sr+520192|0;Nr=Rr>>>16;Cr=Nr&4;kr=Cr|Pr;Or=Sr<<Cr;Fr=Or+245760|0;Br=Fr>>>16;Hr=Br&2;Wr=kr|Hr;Vr=14-Wr|0;xr=Or<<Hr;Lr=xr>>>15;Dr=Vr+Lr|0;Xr=Dr<<1;Zr=Dr+7|0;Gr=v>>>Zr;zr=Gr&1;jr=zr|Xr;o=jr}}Qr=3264+(o<<2)|0;Jr=l+28|0;a[Jr>>2]=o;Kr=l+16|0;qr=l+20|0;a[qr>>2]=0;a[Kr>>2]=0;$r=a[2964>>2]|0;en=1<<o;rn=$r&en;nn=(rn|0)==0;do{if(nn){tn=$r|en;a[2964>>2]=tn;a[Qr>>2]=l;an=l+24|0;a[an>>2]=Qr;un=l+12|0;a[un>>2]=l;ln=l+8|0;a[ln>>2]=l}else{fn=a[Qr>>2]|0;cn=(o|0)==31;sn=o>>>1;dn=25-sn|0;An=cn?0:dn;_n=v<<An;t=_n;i=fn;while(1){vn=i+4|0;mn=a[vn>>2]|0;hn=mn&-8;yn=(hn|0)==(v|0);if(yn){vi=73;break}bn=t>>>31;gn=(i+16|0)+(bn<<2)|0;Tn=t<<1;En=a[gn>>2]|0;Mn=(En|0)==(0|0);if(Mn){vi=72;break}else{t=Tn;i=En}}if((vi|0)==72){a[gn>>2]=l;wn=l+24|0;a[wn>>2]=i;In=l+12|0;a[In>>2]=l;Pn=l+8|0;a[Pn>>2]=l;break}else if((vi|0)==73){Rn=i+8|0;Nn=a[Rn>>2]|0;Cn=Nn+12|0;a[Cn>>2]=l;a[Rn>>2]=l;kn=l+8|0;a[kn>>2]=Nn;On=l+12|0;a[On>>2]=i;Fn=l+24|0;a[Fn>>2]=0;break}}}while(0);Bn=a[2992>>2]|0;Hn=Bn+-1|0;a[2992>>2]=Hn;Un=(Hn|0)==0;if(Un){n=3416}else{return}while(1){r=a[n>>2]|0;Wn=(r|0)==(0|0);xn=r+8|0;if(Wn){break}else{n=xn}}a[2992>>2]=-1;return}function Qn(){var e=0,r=0;r=_;return 3456|0}function Jn(e){e=e|0;var r=0,n=0,i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0;var M=0,w=0,I=0,P=0,S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0;B=_;c=e;T=c&3;P=(T|0)==0;e:do{if(P){n=e;F=4}else{i=e;I=c;while(1){S=t[i>>0]|0;R=S<<24>>24==0;if(R){f=I;break e}N=i+1|0;C=N;k=C&3;O=(k|0)==0;if(O){n=N;F=4;break}else{i=N;I=C}}}}while(0);if((F|0)==4){r=n;while(1){s=a[r>>2]|0;d=s+-16843009|0;A=s&-2139062144;v=A^-2139062144;m=v&d;p=(m|0)==0;h=r+4|0;if(p){r=h}else{break}}y=s&255;b=y<<24>>24==0;if(b){o=r}else{u=r;while(1){g=u+1|0;l=t[g>>0]|0;E=l<<24>>24==0;if(E){o=g;break}else{u=g}}}M=o;f=M}w=f-c|0;return w|0}function Kn(e){e=e|0;var r=0,n=0,t=0,i=0,a=0,o=0,u=0;u=_;n=Jn(e)|0;t=n+1|0;i=jn(t)|0;a=(i|0)==(0|0);if(a){r=0}else{Pt(i|0,e|0,t|0)|0;r=i}return r|0}function qn(e){e=e|0;var r=0,n=0;n=_;return}function $n(e){e=e|0;var r=0,n=0;n=_;qn(e);vt(e);return}function et(e){e=e|0;var r=0,n=0;n=_;return}function rt(e){e=e|0;var r=0,n=0;n=_;return}function nt(e,r,n){e=e|0;r=r|0;n=n|0;var t=0,i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0;var w=0,I=0,P=0,S=0;P=_;_=_+64|0;h=P;y=ot(e,r,0)|0;if(y){i=1}else{b=(r|0)==(0|0);if(b){i=0}else{g=ct(r,208,192,0)|0;T=(g|0)==(0|0);if(T){i=0}else{E=h+4|0;w=E;S=w+52|0;do{a[w>>2]=0|0;w=w+4|0}while((w|0)<(S|0));a[h>>2]=g;M=h+8|0;a[M>>2]=e;o=h+12|0;a[o>>2]=-1;u=h+48|0;a[u>>2]=1;l=a[g>>2]|0;f=l+28|0;c=a[f>>2]|0;s=a[n>>2]|0;Yt[c&3](g,h,s,1);d=h+24|0;A=a[d>>2]|0;v=(A|0)==1;if(v){m=h+16|0;p=a[m>>2]|0;a[n>>2]=p;t=1}else{t=0}i=t}}}_=P;return i|0}function tt(e,r,n,t,i,o){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0;s=_;u=r+8|0;l=a[u>>2]|0;f=ot(e,l,o)|0;if(f){ft(0,r,n,t,i)}return}function it(e,r,n,i,o){e=e|0;r=r|0;n=n|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0,P=0;var S=0,R=0,N=0,C=0,k=0,O=0,F=0;F=_;S=r+8|0;R=a[S>>2]|0;N=ot(e,R,o)|0;do{if(N){lt(0,r,n,i)}else{C=a[r>>2]|0;k=ot(e,C,o)|0;if(k){u=r+16|0;l=a[u>>2]|0;f=(l|0)==(n|0);if(!f){c=r+20|0;s=a[c>>2]|0;d=(s|0)==(n|0);if(!d){m=r+32|0;a[m>>2]=i;a[c>>2]=n;p=r+40|0;h=a[p>>2]|0;y=h+1|0;a[p>>2]=y;b=r+36|0;g=a[b>>2]|0;T=(g|0)==1;if(T){E=r+24|0;M=a[E>>2]|0;w=(M|0)==2;if(w){I=r+54|0;t[I>>0]=1}}P=r+44|0;a[P>>2]=4;break}}A=(i|0)==1;if(A){v=r+32|0;a[v>>2]=1}}}}while(0);return}function at(e,r,n,t){e=e|0;r=r|0;n=n|0;t=t|0;var i=0,o=0,u=0,l=0,f=0;f=_;i=r+8|0;o=a[i>>2]|0;u=ot(e,o,0)|0;if(u){ut(0,r,n,t)}return}function ot(e,r,n){e=e|0;r=r|0;n=n|0;var t=0,i=0,a=0;a=_;t=(e|0)==(r|0);return t|0}function ut(e,r,n,i){e=e|0;r=r|0;n=n|0;i=i|0;var o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0;T=_;v=r+16|0;m=a[v>>2]|0;p=(m|0)==(0|0);do{if(p){a[v>>2]=n;h=r+24|0;a[h>>2]=i;y=r+36|0;a[y>>2]=1}else{b=(m|0)==(n|0);if(!b){f=r+36|0;c=a[f>>2]|0;s=c+1|0;a[f>>2]=s;d=r+24|0;a[d>>2]=2;A=r+54|0;t[A>>0]=1;break}o=r+24|0;u=a[o>>2]|0;l=(u|0)==2;if(l){a[o>>2]=i}}}while(0);return}function lt(e,r,n,t){e=e|0;r=r|0;n=n|0;t=t|0;var i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0;d=_;i=r+4|0;o=a[i>>2]|0;u=(o|0)==(n|0);if(u){l=r+28|0;f=a[l>>2]|0;c=(f|0)==1;if(!c){a[l>>2]=t}}return}function ft(e,r,n,i,o){e=e|0;r=r|0;n=n|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0,P=0;var S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0;x=_;k=r+53|0;t[k>>0]=1;O=r+4|0;F=a[O>>2]|0;B=(F|0)==(i|0);do{if(B){H=r+52|0;t[H>>0]=1;u=r+16|0;l=a[u>>2]|0;f=(l|0)==(0|0);if(f){a[u>>2]=n;c=r+24|0;a[c>>2]=o;s=r+36|0;a[s>>2]=1;d=r+48|0;A=a[d>>2]|0;v=(A|0)==1;m=(o|0)==1;U=v&m;if(!U){break}p=r+54|0;t[p>>0]=1;break}h=(l|0)==(n|0);if(!h){S=r+36|0;R=a[S>>2]|0;N=R+1|0;a[S>>2]=N;C=r+54|0;t[C>>0]=1;break}y=r+24|0;b=a[y>>2]|0;g=(b|0)==2;if(g){a[y>>2]=o;w=o}else{w=b}T=r+48|0;E=a[T>>2]|0;M=(E|0)==1;I=(w|0)==1;W=M&I;if(W){P=r+54|0;t[P>>0]=1}}}while(0);return}function ct(e,r,n,o){e=e|0;r=r|0;n=n|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0,P=0;var S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0,L=0,D=0,X=0,Z=0,G=0,z=0,j=0;var Y=0,Q=0,J=0,K=0,q=0,$=0,ee=0,re=0,ne=0,te=0,ie=0,ae=0,oe=0,ue=0,le=0;ue=_;_=_+64|0;L=ue;J=a[e>>2]|0;K=J+-8|0;q=a[K>>2]|0;$=e+q|0;ee=J+-4|0;c=a[ee>>2]|0;a[L>>2]=n;s=L+4|0;a[s>>2]=e;d=L+8|0;a[d>>2]=r;A=L+12|0;a[A>>2]=o;v=L+16|0;m=L+20|0;p=L+24|0;h=L+28|0;y=L+32|0;b=L+40|0;ae=v;le=ae+36|0;do{a[ae>>2]=0|0;ae=ae+4|0}while((ae|0)<(le|0));i[v+36>>1]=0|0;t[v+38>>0]=0|0;g=ot(c,n,0)|0;e:do{if(g){T=L+48|0;a[T>>2]=1;E=a[c>>2]|0;M=E+20|0;w=a[M>>2]|0;Jt[w&3](c,L,$,$,1,0);I=a[p>>2]|0;P=(I|0)==1;u=P?$:0;l=u}else{S=L+36|0;R=a[c>>2]|0;N=R+24|0;C=a[N>>2]|0;Qt[C&3](c,L,$,1,0);k=a[S>>2]|0;switch(k|0){case 0:{O=a[b>>2]|0;F=(O|0)==1;B=a[h>>2]|0;H=(B|0)==1;re=F&H;U=a[y>>2]|0;W=(U|0)==1;ne=re&W;V=a[m>>2]|0;f=ne?V:0;l=f;break e;break}case 1:{break}default:{l=0;break e}}x=a[p>>2]|0;D=(x|0)==1;if(!D){X=a[b>>2]|0;Z=(X|0)==0;G=a[h>>2]|0;z=(G|0)==1;te=Z&z;j=a[y>>2]|0;Y=(j|0)==1;ie=te&Y;if(!ie){l=0;break}}Q=a[v>>2]|0;l=Q}}while(0);_=ue;return l|0}function st(e){e=e|0;var r=0,n=0;n=_;qn(e);vt(e);return}function dt(e,r,n,t,i,o){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0;p=_;s=r+8|0;d=a[s>>2]|0;A=ot(e,d,o)|0;if(A){ft(0,r,n,t,i)}else{v=e+8|0;u=a[v>>2]|0;l=a[u>>2]|0;f=l+20|0;c=a[f>>2]|0;Jt[c&3](u,r,n,t,i,o)}return}function At(e,r,n,i,o){e=e|0;r=r|0;n=n|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0,P=0;var S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0,L=0,D=0,X=0,Z=0,G=0,z=0,j=0;var Y=0,Q=0,J=0,K=0,q=0,$=0,ee=0;ee=_;Y=r+8|0;Q=a[Y>>2]|0;J=ot(e,Q,o)|0;do{if(J){lt(0,r,n,i)}else{K=a[r>>2]|0;q=ot(e,K,o)|0;if(!q){X=e+8|0;Z=a[X>>2]|0;G=a[Z>>2]|0;z=G+24|0;j=a[z>>2]|0;Qt[j&3](Z,r,n,i,o);break}f=r+16|0;c=a[f>>2]|0;s=(c|0)==(n|0);if(!s){d=r+20|0;A=a[d>>2]|0;v=(A|0)==(n|0);if(!v){h=r+32|0;a[h>>2]=i;y=r+44|0;b=a[y>>2]|0;g=(b|0)==4;if(g){break}T=r+52|0;t[T>>0]=0;E=r+53|0;t[E>>0]=0;M=e+8|0;w=a[M>>2]|0;I=a[w>>2]|0;P=I+20|0;S=a[P>>2]|0;Jt[S&3](w,r,n,n,1,o);R=t[E>>0]|0;N=R<<24>>24==0;if(N){u=4;$=11}else{C=t[T>>0]|0;k=C<<24>>24==0;if(k){u=3;$=11}else{l=3}}if(($|0)==11){a[d>>2]=n;O=r+40|0;F=a[O>>2]|0;B=F+1|0;a[O>>2]=B;H=r+36|0;U=a[H>>2]|0;W=(U|0)==1;if(W){V=r+24|0;x=a[V>>2]|0;L=(x|0)==2;if(L){D=r+54|0;t[D>>0]=1;l=u}else{l=u}}else{l=u}}a[y>>2]=l;break}}m=(i|0)==1;if(m){p=r+32|0;a[p>>2]=1}}}while(0);return}function _t(e,r,n,t){e=e|0;r=r|0;n=n|0;t=t|0;var i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0;v=_;u=r+8|0;l=a[u>>2]|0;f=ot(e,l,0)|0;if(f){ut(0,r,n,t)}else{c=e+8|0;s=a[c>>2]|0;d=a[s>>2]|0;i=d+28|0;o=a[i>>2]|0;Yt[o&3](s,r,n,t)}return}function vt(e){e=e|0;var r=0,n=0;n=_;Yn(e);return}function mt(e){e=e|0;var r=0,n=0;n=_;return}function pt(e){e=e|0;var r=0,n=0;n=_;qn(e);vt(e);return}function ht(e,r,n){e=e|0;r=r|0;n=n|0;var t=0,i=0,a=0;a=_;t=ot(e,r,0)|0;return t|0}function yt(e){e=e|0;var r=0,n=0;n=_;qn(e);vt(e);return}function bt(e,r,n,i,o,u){e=e|0;r=r|0;n=n|0;i=i|0;o=o|0;u=u|0;var l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0,P=0,S=0;var R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0,L=0,D=0,X=0;X=_;W=r+8|0;V=a[W>>2]|0;x=ot(e,V,u)|0;if(x){ft(0,r,n,i,o)}else{L=r+52|0;f=t[L>>0]|0;c=r+53|0;s=t[c>>0]|0;d=e+16|0;A=e+12|0;v=a[A>>2]|0;m=(e+16|0)+(v<<3)|0;t[L>>0]=0;t[c>>0]=0;Mt(d,r,n,i,o,u);p=(v|0)>1;e:do{if(p){h=e+24|0;y=r+24|0;b=e+8|0;g=r+54|0;l=h;while(1){T=t[g>>0]|0;E=T<<24>>24==0;if(!E){break e}M=t[L>>0]|0;w=M<<24>>24==0;if(w){C=t[c>>0]|0;k=C<<24>>24==0;if(!k){O=a[b>>2]|0;F=O&1;B=(F|0)==0;if(B){break e}}}else{I=a[y>>2]|0;P=(I|0)==1;if(P){break e}S=a[b>>2]|0;R=S&2;N=(R|0)==0;if(N){break e}}t[L>>0]=0;t[c>>0]=0;Mt(l,r,n,i,o,u);H=l+8|0;U=H>>>0<m>>>0;if(U){l=H}else{break}}}}while(0);t[L>>0]=f;t[c>>0]=s}return}function gt(e,r,n,i,o){e=e|0;r=r|0;n=n|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0,P=0;var S=0,R=0,N=0,C=0,k=0,O=0,F=0,B=0,H=0,U=0,W=0,V=0,x=0,L=0,D=0,X=0,Z=0,G=0,z=0,j=0;var Y=0,Q=0,J=0,K=0,q=0,$=0,ee=0,re=0,ne=0,te=0,ie=0,ae=0,oe=0,ue=0,le=0,fe=0,ce=0,se=0,de=0,Ae=0;var _e=0,ve=0,me=0,pe=0,he=0,ye=0,be=0,ge=0,Te=0,Ee=0,Me=0,we=0,Ie=0,Pe=0,Se=0,Re=0,Ne=0,Ce=0,ke=0,Oe=0;var Fe=0,Be=0,He=0,Ue=0,We=0,Ve=0,xe=0,Le=0,De=0,Xe=0,Ze=0,Ge=0,ze=0,je=0,Ye=0,Qe=0,Je=0,Ke=0,qe=0;qe=_;te=r+8|0;_e=a[te>>2]|0;we=ot(e,_e,o)|0;e:do{if(we){lt(0,r,n,i)}else{He=a[r>>2]|0;je=ot(e,He,o)|0;if(!je){ce=e+16|0;se=e+12|0;de=a[se>>2]|0;Ae=(e+16|0)+(de<<3)|0;wt(ce,r,n,i,o);ve=e+24|0;me=(de|0)>1;if(!me){break}pe=e+8|0;he=a[pe>>2]|0;ye=he&2;be=(ye|0)==0;if(be){ge=r+36|0;Te=a[ge>>2]|0;Ee=(Te|0)==1;if(!Ee){Ne=he&1;Ce=(Ne|0)==0;if(Ce){Fe=r+54|0;v=ve;while(1){Ze=t[Fe>>0]|0;Ge=Ze<<24>>24==0;if(!Ge){break e}ze=a[ge>>2]|0;Ye=(ze|0)==1;if(Ye){break e}wt(v,r,n,i,o);Qe=v+8|0;Je=Qe>>>0<Ae>>>0;if(Je){v=Qe}else{break e}}}ke=r+24|0;Oe=r+54|0;s=ve;while(1){Be=t[Oe>>0]|0;Ue=Be<<24>>24==0;if(!Ue){break e}We=a[ge>>2]|0;Ve=(We|0)==1;if(Ve){xe=a[ke>>2]|0;Le=(xe|0)==1;if(Le){break e}}wt(s,r,n,i,o);De=s+8|0;Xe=De>>>0<Ae>>>0;if(Xe){s=De}else{break e}}}}Me=r+54|0;u=ve;while(1){Ie=t[Me>>0]|0;Pe=Ie<<24>>24==0;if(!Pe){break e}wt(u,r,n,i,o);Se=u+8|0;Re=Se>>>0<Ae>>>0;if(Re){u=Se}else{break e}}}p=r+16|0;h=a[p>>2]|0;y=(h|0)==(n|0);if(!y){b=r+20|0;g=a[b>>2]|0;T=(g|0)==(n|0);if(!T){w=r+32|0;a[w>>2]=i;I=r+44|0;P=a[I>>2]|0;S=(P|0)==4;if(S){break}R=e+16|0;N=e+12|0;C=a[N>>2]|0;k=(e+16|0)+(C<<3)|0;O=r+52|0;F=r+53|0;B=r+54|0;H=e+8|0;U=r+24|0;l=0;f=R;c=0;r:while(1){W=f>>>0<k>>>0;if(!W){m=l;Ke=18;break}t[O>>0]=0;t[F>>0]=0;Mt(f,r,n,n,1,o);V=t[B>>0]|0;x=V<<24>>24==0;if(!x){m=l;Ke=18;break}L=t[F>>0]|0;D=L<<24>>24==0;do{if(D){d=l;A=c}else{X=t[O>>0]|0;Z=X<<24>>24==0;if(Z){J=a[H>>2]|0;K=J&1;q=(K|0)==0;if(q){m=1;Ke=18;break r}else{d=1;A=c;break}}G=a[U>>2]|0;z=(G|0)==1;if(z){Ke=23;break r}j=a[H>>2]|0;Y=j&2;Q=(Y|0)==0;if(Q){Ke=23;break r}else{d=1;A=1}}}while(0);$=f+8|0;l=d;f=$;c=A}do{if((Ke|0)==18){if(!c){a[b>>2]=n;ee=r+40|0;re=a[ee>>2]|0;ne=re+1|0;a[ee>>2]=ne;ie=r+36|0;ae=a[ie>>2]|0;oe=(ae|0)==1;if(oe){ue=a[U>>2]|0;le=(ue|0)==2;if(le){t[B>>0]=1;if(m){Ke=23;break}else{fe=4;break}}}}if(m){Ke=23}else{fe=4}}}while(0);if((Ke|0)==23){fe=3}a[I>>2]=fe;break}}E=(i|0)==1;if(E){M=r+32|0;a[M>>2]=1}}}while(0);return}function Tt(e,r,n,i){e=e|0;r=r|0;n=n|0;i=i|0;var o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0;E=_;m=r+8|0;p=a[m>>2]|0;h=ot(e,p,0)|0;e:do{if(h){ut(0,r,n,i)}else{y=e+16|0;b=e+12|0;g=a[b>>2]|0;u=(e+16|0)+(g<<3)|0;Et(y,r,n,i);l=(g|0)>1;if(l){f=e+24|0;c=r+54|0;o=f;while(1){Et(o,r,n,i);s=t[c>>0]|0;d=s<<24>>24==0;if(!d){break e}A=o+8|0;v=A>>>0<u>>>0;if(v){o=A}else{break}}}}}while(0);return}function Et(e,r,n,t){e=e|0;r=r|0;n=n|0;t=t|0;var i=0,o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0;M=_;p=e+4|0;h=a[p>>2]|0;y=h>>8;b=h&1;g=(b|0)==0;if(g){i=y}else{T=a[n>>2]|0;o=T+y|0;u=a[o>>2]|0;i=u}l=a[e>>2]|0;f=a[l>>2]|0;c=f+28|0;s=a[c>>2]|0;d=n+i|0;A=h&2;v=(A|0)!=0;m=v?t:2;Yt[s&3](l,r,d,m);return}function Mt(e,r,n,t,i,o){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;o=o|0;var u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0,I=0;I=_;g=e+4|0;T=a[g>>2]|0;E=T>>8;M=T&1;l=(M|0)==0;if(l){u=E}else{f=a[t>>2]|0;c=f+E|0;s=a[c>>2]|0;u=s}d=a[e>>2]|0;A=a[d>>2]|0;v=A+20|0;m=a[v>>2]|0;p=t+u|0;h=T&2;y=(h|0)!=0;b=y?i:2;Jt[m&3](d,r,n,p,b,o);return}function wt(e,r,n,t,i){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;var o=0,u=0,l=0,f=0,c=0,s=0,d=0,A=0,v=0,m=0,p=0,h=0,y=0,b=0,g=0,T=0,E=0,M=0,w=0;w=_;y=e+4|0;b=a[y>>2]|0;g=b>>8;T=b&1;E=(T|0)==0;if(E){o=g}else{u=a[n>>2]|0;l=u+g|0;f=a[l>>2]|0;o=f}c=a[e>>2]|0;s=a[c>>2]|0;d=s+24|0;A=a[d>>2]|0;v=n+o|0;m=b&2;p=(m|0)!=0;h=p?t:2;Qt[A&3](c,r,v,h,i);return}function It(){}function Pt(e,r,n){e=e|0;r=r|0;n=n|0;var i=0;var o=0;var u=0;var l=0;if((n|0)>=8192){return Te(e|0,r|0,n|0)|0}i=e|0;l=e+n|0;if((e&3)==(r&3)){while(e&3){if((n|0)==0)return i|0;t[e>>0]=t[r>>0]|0;e=e+1|0;r=r+1|0;n=n-1|0}o=l&-4|0;u=o-64|0;while((e|0)<=(u|0)){a[e>>2]=a[r>>2]|0;a[e+4>>2]=a[r+4>>2]|0;a[e+8>>2]=a[r+8>>2]|0;a[e+12>>2]=a[r+12>>2]|0;a[e+16>>2]=a[r+16>>2]|0;a[e+20>>2]=a[r+20>>2]|0;a[e+24>>2]=a[r+24>>2]|0;a[e+28>>2]=a[r+28>>2]|0;a[e+32>>2]=a[r+32>>2]|0;a[e+36>>2]=a[r+36>>2]|0;a[e+40>>2]=a[r+40>>2]|0;a[e+44>>2]=a[r+44>>2]|0;a[e+48>>2]=a[r+48>>2]|0;a[e+52>>2]=a[r+52>>2]|0;a[e+56>>2]=a[r+56>>2]|0;a[e+60>>2]=a[r+60>>2]|0;e=e+64|0;r=r+64|0}while((e|0)<(o|0)){a[e>>2]=a[r>>2]|0;e=e+4|0;r=r+4|0}}else{o=l-4|0;while((e|0)<(o|0)){t[e>>0]=t[r>>0]|0;t[e+1>>0]=t[r+1>>0]|0;t[e+2>>0]=t[r+2>>0]|0;t[e+3>>0]=t[r+3>>0]|0;e=e+4|0;r=r+4|0}}while((e|0)<(l|0)){t[e>>0]=t[r>>0]|0;e=e+1|0;r=r+1|0}return i|0}function St(e,r,n){e=e|0;r=r|0;n=n|0;var i=0,o=0,u=0,l=0;i=e+n|0;r=r&0xff;if((n|0)>=67){while((e&3)!=0){t[e>>0]=r;e=e+1|0}o=i&-4|0;u=o-64|0;l=r|r<<8|r<<16|r<<24;while((e|0)<=(u|0)){a[e>>2]=l;a[e+4>>2]=l;a[e+8>>2]=l;a[e+12>>2]=l;a[e+16>>2]=l;a[e+20>>2]=l;a[e+24>>2]=l;a[e+28>>2]=l;a[e+32>>2]=l;a[e+36>>2]=l;a[e+40>>2]=l;a[e+44>>2]=l;a[e+48>>2]=l;a[e+52>>2]=l;a[e+56>>2]=l;a[e+60>>2]=l;e=e+64|0}while((e|0)<(o|0)){a[e>>2]=l;e=e+4|0}}while((e|0)<(i|0)){t[e>>0]=r;e=e+1|0}return i-n|0}function Rt(e){e=e|0;var r=0;var n=0;var t=0;var i=0;e=e+15&-16|0;r=a[s>>2]|0;t=r+e|0;if((e|0)>0&(t|0)<(r|0)|(t|0)<0){J()|0;le(12);return-1}a[s>>2]=t;i=Q()|0;if((t|0)>(i|0)){if((Y()|0)==0){a[s>>2]=r;le(12);return-1}}return r|0}function Nt(e){e=e|0;return Zt[e&1]()|0}function Ct(e,r){e=e|0;r=r|0;return Gt[e&1](r|0)|0}function kt(e,r,n,t){e=e|0;r=r|0;n=n|0;t=t|0;return zt[e&3](r|0,n|0,t|0)|0}function Ot(e,r){e=e|0;r=r|0;jt[e&7](r|0)}function Ft(e,r,n,t,i){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;Yt[e&3](r|0,n|0,t|0,i|0)}function Bt(e,r,n,t,i,a){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;a=a|0;Qt[e&3](r|0,n|0,t|0,i|0,a|0)}function Ht(e,r,n,t,i,a,o){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;a=a|0;o=o|0;Jt[e&3](r|0,n|0,t|0,i|0,a|0,o|0)}function Ut(){z(0);return 0}function Wt(e){e=e|0;z(1);return 0}function Vt(e,r,n){e=e|0;r=r|0;n=n|0;z(2);return 0}function xt(e){e=e|0;z(3)}function Lt(e,r,n,t){e=e|0;r=r|0;n=n|0;t=t|0;z(4)}function Dt(e,r,n,t,i){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;z(5)}function Xt(e,r,n,t,i,a){e=e|0;r=r|0;n=n|0;t=t|0;i=i|0;a=a|0;z(6)}var Zt=[Ut,tr];var Gt=[Wt,lr];var zt=[Vt,nt,ht,Vt];var jt=[xt,qn,$n,et,rt,st,pt,yt];var Yt=[Lt,at,_t,Tt];var Qt=[Dt,it,At,gt];var Jt=[Xt,tt,dt,bt];return{__GLOBAL__sub_I_bind_cpp:vr,__GLOBAL__sub_I_whiteList_cpp:_r,___errno_location:Qn,___getTypeName:zn,_free:Yn,_malloc:jn,_memcpy:Pt,_memset:St,_sbrk:Rt,dynCall_i:Nt,dynCall_ii:Ct,dynCall_iiii:kt,dynCall_vi:Ot,dynCall_viiii:Ft,dynCall_viiiii:Bt,dynCall_viiiiii:Ht,establishStackSpace:$e,getTempRet0:nr,runPostSets:It,setTempRet0:rr,setThrew:er,stackAlloc:Je,stackRestore:qe,stackSave:Ke}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer),__GLOBAL__sub_I_bind_cpp=Module.__GLOBAL__sub_I_bind_cpp=asm.__GLOBAL__sub_I_bind_cpp,__GLOBAL__sub_I_whiteList_cpp=Module.__GLOBAL__sub_I_whiteList_cpp=asm.__GLOBAL__sub_I_whiteList_cpp,___errno_location=Module.___errno_location=asm.___errno_location,___getTypeName=Module.___getTypeName=asm.___getTypeName,_free=Module._free=asm._free,_malloc=Module._malloc=asm._malloc,_memcpy=Module._memcpy=asm._memcpy,_memset=Module._memset=asm._memset,_sbrk=Module._sbrk=asm._sbrk,establishStackSpace=Module.establishStackSpace=asm.establishStackSpace,getTempRet0=Module.getTempRet0=asm.getTempRet0,runPostSets=Module.runPostSets=asm.runPostSets,setTempRet0=Module.setTempRet0=asm.setTempRet0,setThrew=Module.setThrew=asm.setThrew,stackAlloc=Module.stackAlloc=asm.stackAlloc,stackRestore=Module.stackRestore=asm.stackRestore,stackSave=Module.stackSave=asm.stackSave,dynCall_i=Module.dynCall_i=asm.dynCall_i,dynCall_ii=Module.dynCall_ii=asm.dynCall_ii,dynCall_iiii=Module.dynCall_iiii=asm.dynCall_iiii,dynCall_vi=Module.dynCall_vi=asm.dynCall_vi,dynCall_viiii=Module.dynCall_viiii=asm.dynCall_viiii,dynCall_viiiii=Module.dynCall_viiiii=asm.dynCall_viiiii,dynCall_viiiiii=Module.dynCall_viiiiii=asm.dynCall_viiiiii;if(Module.asm=asm,memoryInitializer)if(isDataURI(memoryInitializer)||("function"==typeof Module.locateFile?memoryInitializer=Module.locateFile(memoryInitializer):Module.memoryInitializerPrefixURL&&(memoryInitializer=Module.memoryInitializerPrefixURL+memoryInitializer)),ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL){var data=Module.readBinary(memoryInitializer);HEAPU8.set(data,GLOBAL_BASE)}else{addRunDependency("memory initializer");var applyMemoryInitializer=function(e){e.byteLength&&(e=new Uint8Array(e)),HEAPU8.set(e,GLOBAL_BASE),Module.memoryInitializerRequest&&delete Module.memoryInitializerRequest.response,removeRunDependency("memory initializer")};function doBrowserLoad(){Module.readAsync(memoryInitializer,applyMemoryInitializer,function(){throw"could not load memory initializer "+memoryInitializer})}var memoryInitializerBytes=tryParseAsDataURI(memoryInitializer);if(memoryInitializerBytes)applyMemoryInitializer(memoryInitializerBytes.buffer);else if(Module.memoryInitializerRequest){function useRequest(){var e=Module.memoryInitializerRequest,r=e.response;if(200!==e.status&&0!==e.status){var n=tryParseAsDataURI(Module.memoryInitializerRequestURL);if(!n)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+memoryInitializer),void doBrowserLoad();r=n.buffer}applyMemoryInitializer(r)}Module.memoryInitializerRequest.response?setTimeout(useRequest,0):Module.memoryInitializerRequest.addEventListener("load",useRequest)}else doBrowserLoad()}function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var calledMain=!1;function run(e){function r(){Module.calledRun||(Module.calledRun=!0,ABORT||(ensureInitRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),postRun()))}e=e||Module.arguments,runDependencies>0||(preRun(),runDependencies>0||Module.calledRun||(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),r()},1)):r()))}function exit(e,r){r&&Module.noExitRuntime&&0===e||(Module.noExitRuntime||(ABORT=!0,EXITSTATUS=e,STACKTOP=initialStackTop,exitRuntime(),Module.onExit&&Module.onExit(e)),ENVIRONMENT_IS_NODE&&process.exit(e),Module.quit(e,new ExitStatus(e)))}dependenciesFulfilled=function e(){Module.calledRun||run(),Module.calledRun||(dependenciesFulfilled=e)},Module.run=run,Module.exit=exit;var abortDecorators=[];function abort(e){throw Module.onAbort&&Module.onAbort(e),void 0!==e?(Module.print(e),Module.printErr(e),e=JSON.stringify(e)):e="",ABORT=!0,EXITSTATUS=1,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(Module.abort=abort,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();Module.noExitRuntime=!0,run();

window.Module = Module;
console.log("WhiteList")

/***/ }),

/***/ "./js/checkBrowser.js":
/*!****************************!*\
  !*** ./js/checkBrowser.js ***!
  \****************************/
/***/ (() => {

(function() {
	'use strict'
	function uaMatch( ua ) {
		// If an UA is not provided, default to the current browser UA.
		if ( ua === undefined ) {
		  ua = window.navigator.userAgent;
		}
		ua = ua.toLowerCase();
	
		var match = /(edge)\/([\w.]+)/.exec( ua ) ||
			/(opr)[\/]([\w.]+)/.exec( ua ) ||
			/(chrome)[ \/]([\w.]+)/.exec( ua ) ||
			/(iemobile)[\/]([\w.]+)/.exec( ua ) ||
			/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec( ua ) ||
			/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec( ua ) ||
			/(webkit)[ \/]([\w.]+)/.exec( ua ) ||
			/(opera)(?:.*version|)[ \/]([\w.]+)/.exec( ua ) ||
			/(msie) ([\w.]+)/.exec( ua ) ||
			ua.indexOf("trident") >= 0 && /(rv)(?::| )([\w.]+)/.exec( ua ) ||
			ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec( ua ) ||
			[];
	
		var platform_match = /(ipad)/.exec( ua ) ||
			/(ipod)/.exec( ua ) ||
			/(windows phone)/.exec( ua ) ||
			/(iphone)/.exec( ua ) ||
			/(kindle)/.exec( ua ) ||
			/(silk)/.exec( ua ) ||
			/(android)/.exec( ua ) ||
			/(win)/.exec( ua ) ||
			/(mac)/.exec( ua ) ||
			/(linux)/.exec( ua ) ||
			/(cros)/.exec( ua ) ||
			/(playbook)/.exec( ua ) ||
			/(bb)/.exec( ua ) ||
			/(blackberry)/.exec( ua ) ||
			[];
	
		var browser = {},
			matched = {
			  browser: match[ 5 ] || match[ 3 ] || match[ 1 ] || "",
			  version: match[ 2 ] || match[ 4 ] || "0",
			  versionNumber: match[ 4 ] || match[ 2 ] || "0",
			  platform: platform_match[ 0 ] || ""
			};
	
		if ( matched.browser ) {
		  browser[ matched.browser ] = true;
		  browser.version = matched.version;
		  browser.versionNumber = parseInt(matched.versionNumber, 10);
		}
	
		if ( matched.platform ) {
		  browser[ matched.platform ] = true;
		}
	
		// These are all considered mobile platforms, meaning they run a mobile browser
		if ( browser.android || browser.bb || browser.blackberry || browser.ipad || browser.iphone ||
		  browser.ipod || browser.kindle || browser.playbook || browser.silk || browser[ "windows phone" ]) {
		  browser.mobile = true;
		}
	
		// These are all considered desktop platforms, meaning they run a desktop browser
		if ( browser.cros || browser.mac || browser.linux || browser.win ) {
		  browser.desktop = true;
		}
	
		// Chrome, Opera 15+ and Safari are webkit based browsers
		if ( browser.chrome || browser.opr || browser.safari ) {
		  browser.webkit = true;
		}
	
		// IE11 has a new token so we will assign it msie to avoid breaking changes
		if ( browser.rv || browser.iemobile) {
		  var ie = "msie";
	
		  matched.browser = ie;
		  browser[ie] = true;
		}
	
		// Edge is officially known as Microsoft Edge, so rewrite the key to match
		if ( browser.edge ) {
		  delete browser.edge;
		  var msedge = "msedge";
	
		  matched.browser = msedge;
		  browser[msedge] = true;
		}
	
		// Blackberry browsers are marked as Safari on BlackBerry
		if ( browser.safari && browser.blackberry ) {
		  var blackberry = "blackberry";
	
		  matched.browser = blackberry;
		  browser[blackberry] = true;
		}
	
		// Playbook browsers are marked as Safari on Playbook
		if ( browser.safari && browser.playbook ) {
		  var playbook = "playbook";
	
		  matched.browser = playbook;
		  browser[playbook] = true;
		}
	
		// BB10 is a newer OS version of BlackBerry
		if ( browser.bb ) {
		  var bb = "blackberry";
	
		  matched.browser = bb;
		  browser[bb] = true;
		}
	
		// Opera 15+ are identified as opr
		if ( browser.opr ) {
		  var opera = "opera";
	
		  matched.browser = opera;
		  browser[opera] = true;
		}
	
		// Stock Android browsers are marked as Safari on Android.
		if ( browser.safari && browser.android ) {
		  var android = "android";
	
		  matched.browser = android;
		  browser[android] = true;
		}
	
		// Kindle browsers are marked as Safari on Kindle
		if ( browser.safari && browser.kindle ) {
		  var kindle = "kindle";
	
		  matched.browser = kindle;
		  browser[kindle] = true;
		}
	
		 // Kindle Silk browsers are marked as Safari on Kindle
		if ( browser.safari && browser.silk ) {
		  var silk = "silk";
	
		  matched.browser = silk;
		  browser[silk] = true;
		}

		// Assign the name and platform variable
		browser.name = matched.browser;
		browser.platform = matched.platform;
//[start-20190214-fei0054-add]//

		var isWeChat = /micromessenger/.test(ua);
		var isLine = /line/.test(ua);
		var isFB = /fban/.test(ua) || /fbav/.test(ua) ;

		if (isWeChat) browser.app = "weChat";
		else if (isLine) browser.app = "Line";
		else if (isFB) browser.app = "FB";

		var isIOS = [
			'iPad Simulator',
			'iPhone Simulator',
			'iPod Simulator',
			'iPad',
			'iPhone',
			'iPod'
		].includes(navigator.platform)
		// iPad on iOS 13 detection
		|| (navigator.userAgent.includes("Mac") && "ontouchend" in document);

		if (isIOS) browser.iOS = true;
		
		// if (isLine) browser.app = "Line";
		// if (isFB) browser.app = "FB";

//[end---20190214-fei0054-add]//
		return browser;
	}
	if (!start) var start = new Date().getTime();
	window.Browser = uaMatch( window.navigator.userAgent );
	if (!elapsed) var elapsed = new Date().getTime();
	if (elapsed && start ) console.log("processing time(uaMatch):", elapsed-start );

})();


/***/ }),

/***/ "./js/networkAgentVR.js":
/*!******************************!*\
  !*** ./js/networkAgentVR.js ***!
  \******************************/
/***/ (() => {

(function() {
	'use strict'

	window.parseUserData = function( url, callback ) {
		let xhr = new XMLHttpRequest(); // why use const ??
		xhr.open( 'GET', url , true ) //  
		xhr.responseType = 'json' // set reponse as arraybuffer or text or json
		xhr.onload = function(e) {
			
			if (xhr.response.data){
				window.file = xhr.response.data ;
			}else{
				window.file = xhr.response ;
			}
			//// parse the transform from string to float array
			for (var i in window.file.scene_objs_v2){
				for (var j in window.file.scene_objs_v2[i].transform){
					var strings = window.file.scene_objs_v2[i].transform[j].split(",");
					if (strings.length != 3) { return -1; } 
					var floats = [ parseFloat(strings[0]), parseFloat(strings[1]), parseFloat(strings[2]) ];
					window.file.scene_objs_v2[i].transform[j]= floats;
				}	
			}

			return window.file;
		}
		xhr.send();
		return xhr.response ;
	}

//[start-20190215-fei0054-add]//
	function parseDiaoyurar( diaoyurarData ){
		let b64Data = diaoyurarData;
		// Decode base64 (convert ascii to binary)
		let strData     = atob(b64Data);
		// Convert binary string to character-number array
		let charData    = strData.split('').map(function(x){return x.charCodeAt(0);});
		// Turn number array into byte-array
		let binData     = new Uint8Array(charData);
		// Pako magic
		let data        = pako.inflate(binData);
		// Convert gunzipped byteArray back to ascii string:
		let resData     = String.fromCharCode.apply(null, new Uint16Array(data));
		// Convert string to JSON object  
		let resJsonData = JSON.parse(resData);

		return resJsonData;
	}
//[end---20190215-fei0054-add]//

	////// query server for basic data by user_id
	////// 20190921: Fei abandon this function on server V3 
	window.getARProjsByUserID = function( url, user_id, callback ) {
		if (!url ) return -1;
		if (!user_id) user_id = "makarvr";
		let xhr = new XMLHttpRequest();
		let data = {
			"user_id": user_id,
			"cid": "20"
		}
//[start-20190904-fei0073-add]//
		//////
		///////// for V3 server and Editor
		//////
		if ( serverVersion == "3.0.0"){
			console.log("%cnetWorkAgent.js: getARProjsByUserID: you shoudnt see this, Fei abandon this function in server V3", "color:red");
			getResByUserID(url, user_id, "", "", function(){
				console.log("netWorkAgent.js: getARProjsByUserID: getResByUserID: callback");

				let specificUrl = url+"get_ar_projs";
				let request = {
					"ver":"3.0.0",
					"cid": 5,
					"data":data
				};
				let jsonReq = JSON.stringify(request);
				// console.log("netWorkAgent.js: getARProjsByUserID: POST open, specificUrl=", specificUrl);
				xhr.open( 'POST', specificUrl , true );

				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
				xhr.onload = function(e) {
					console.log("networkAgent.js: getARProjsByUserID,  onload xhr.response = ", xhr.response );
					let userData;
					if (!xhr.response.error){
						if (xhr.response.data){
							userData = xhr.response.data;
							//// save the userData in window  
							if (!window.userARData){
								window.userARData = userData; 
							}else{
								// console.log("networkAgent.js: getARProjsByUserID: window.userARData already exist, replace it..");
								window.userARData = userData; 
							}

							if (callback) callback(userData); 
						}else{
							if (callback) callback("networkAgent.js:error: no xhr.response.data"); 
						}
					}else{
						if (callback) callback( xhr.response.error ); 
						console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",xhr.response.error);
					}
				}
				// console.log("netWorkAgent.js: getARProjsByUserID: POST send, jsonReq=", jsonReq);
				xhr.send( jsonReq );

			}); // get the ARResList and create ARResDict 

			
		}
		

//[end---20190904-fei0073-add]//
		//////
		////// server V2 part 
		//////
		if ( serverVersion == "2.0.0"){
			let strData = JSON.stringify(data);
			//// the formData
			let FD  = new FormData();
			FD.append("cmd", "get_ar_projs");	//get_ar_projs ,  get_ar_proj_scene	, get_ar_projs_by_proj_id
			FD.append("data", strData );

			xhr.open( 'POST', url , true );
			// xhr.setRequestHeader('Content-Type', 'text/plain' );		
			xhr.responseType = 'json' // set reponse as arraybuffer or text or json

			xhr.onload = function(e) {
				console.log("networkAgent.js:getARProjsByUserID:", xhr.response );
				let userData;

//[start-20190214-fei0054-mod]//
				//// MAKAR "will" all use gzip compress the text as soon as We can(?)
				if (xhr.response.diaoyurar ){
					// console.log("networkAgent.js: getARProjsByUserID: xhr.response.diaoyurar ");

					let jsonData =  parseDiaoyurar(xhr.response.diaoyurar);
					if (!jsonData.error){
						if (jsonData.data){
							userData = jsonData.data;
							//// save the userData in window  
							if (!window.userARData){
								window.userARData = userData; 
							}else{
								console.log("networkAgent.js: getARProjsByUserID: window.userARData already exist, replace it..");
								window.userARData = userData; 
							}
							if (callback) callback(userData); 
						}else{
							if (callback) callback("networkAgent.js:error: no jsonData.data"); 
						}

					}else{
						if (callback) callback( jsonData.error ); 
						console.log("networkAgent.js: getARProjsByUserID: oops something wrong:", jsonData.error);
					}

					// console.log(jsonData);
				}else{
					// console.log("networkAgent.js: getARProjsByUserID: not xhr.response.diaoyurar ", xhr.response);

					if (!xhr.response.error){
						if (xhr.response.data){
							
							userData = xhr.response.data;

							// console.log("networkAgent.js:getARProjsByUserID: onload" );
							//// save the userData in window  
							if (!window.userARData){
								window.userARData = userData; 
							}else{
								// console.log("networkAgent.js: getARProjsByUserID: window.userARData already exist, replace it..");
								window.userARData = userData; 
							}
		
							if (callback) callback(userData); 
						}else{
							if (callback) callback("networkAgent.js:error: no xhr.response.data"); 
						}
					}else{
						if (callback) callback( xhr.response.error ); 
						console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",xhr.response.error);
					}
				}
//[end---20190214-fei0054-mod]//
			}
			xhr.send( FD );
		}
		

	}

//[start-20190905-fei0073-add]//

	// window.getMessageByUserID = function( url, user_id, callback ) {
	// 	if (!url ) return -1;
	// 	if (!user_id) user_id = "makarvr";
	// 	let xhr = new XMLHttpRequest();
	// 	let data = {
	// 		"user_id": user_id,
	// 	}
	// 	//////
	// 	///////// for V3 server and Editor
	// 	//////
	// 	if ( serverVersion == "3.0.0"){
	// 		let specificUrl = url+"get_message";
	// 		let request = {
	// 			"ver":"3.0.0",
	// 			"cid": 5,
	// 			"data":data
	// 		};
	// 		let jsonReq = JSON.stringify(request);
	// 		// console.log("netWorkAgent.js: getMessageByUserID: POST open, specificUrl=", specificUrl);
	// 		xhr.open( 'POST', specificUrl , true );

	// 		xhr.setRequestHeader('Content-Type', 'application/json');
	// 		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
	// 		xhr.onload = function(e) {
	// 			console.log("networkAgent.js: getMessageByUserID,  onload xhr.response = ", xhr.response );			 
	// 		}
	// 		console.log("networkAgent.js: getMessageByUserID, jsonReq=", jsonReq );
	// 		xhr.send( jsonReq );
	// 	}
	// }

	window.getUserPublishProjsByUserID = function( url, user_id, main_type, sub_type, callback ) {
		if (!url ) return -1;
		if (!user_id) user_id = "makarvr";
		if (!main_type) main_type = "";
		if (!sub_type) sub_type = "";

		// console.log("networkAgent.js: _getUserPublishProjs: ");
		let xhr = new XMLHttpRequest();
		let data = {
			"user_id": user_id,
			'web_ar': true,
		}
		//////
		///////// for V3 server and Editor
		//////
		if ( serverVersion == "3.0.0"){
			// getResByUserID(url, user_id, main_type, sub_type, function(){
			getResByUserID(url, user_id, main_type, sub_type, function( userProjResDict ){
				
				getUsrOnlineRes(url, user_id, main_type, sub_type , "" , function( userOnlineResDict ){
					// console.log("netWorkAgent.js: _getUserPublishProjs: getResByUserID: callback");

					let specificUrl = url+"get_usr_publish_projs";
					let request = {
						"ver":"3.0.0",
						"cid": 5,
						"data":data
					};
					let jsonReq = JSON.stringify(request);
					// console.log("netWorkAgent.js: _getUserPublishProjs: POST open, specificUrl=", specificUrl);
					xhr.open( 'POST', specificUrl , true );
		
					xhr.setRequestHeader('Content-Type', 'application/json');
					xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
					xhr.onload = function(e) {
						// console.log("networkAgent.js: _getUserPublishProjs,  onload xhr.response = ", xhr.response );
						let userPublishProjs;
						if (!xhr.response.error){
		
							if (xhr.response.data){
								userPublishProjs = xhr.response.data;
								//// save the userData in window  
								if (!window.userPublishProjs){
									window.userPublishProjs = userPublishProjs; 
								}else{
									// console.log("networkAgent.js: _getUserPublishProjs: window.userPublishProjs already exist, replace it..");
									window.userPublishProjs = userPublishProjs; 
								}

								if (callback){
									// console.log("networkAgent.js: _getUserPublishProjs,  onload, do callback");
									// callback(userPublishProjs);
									callback(userPublishProjs , userProjResDict , userOnlineResDict );
								}  
							}else{
								if (callback) callback("networkAgent.js:error: no xhr.response.data"); 
							}
		
						}else{
							if (callback) callback( xhr.response.error ); 
							console.log('%cnetworkAgent.js: _getUserPublishProjs: oops something wrong: ', 'color:red', xhr.response.error);
						}
		
					}
					// console.log("networkAgent.js: _getUserPublishProjs, jsonReq=", jsonReq );
					xhr.send( jsonReq );


				});


				

			}); // get the ARResList and create ARResDict 

		
		}
	}

	window.getNewestPublishProjs = function( url, proj_type, callback ) {
		if (!url ) return -1;
		if (!proj_type) proj_type = "vr";
		let xhr = new XMLHttpRequest();
		let data = {
			"proj_type": proj_type,
		}
		//////
		///////// for V3 server and Editor
		//////
		if ( serverVersion == "3.0.0"){
			let specificUrl = url+"get_newest_publish_projs";
			let request = {
				"ver":"3.0.0",
				"cid": 5,
				"data":data
			};
			let jsonReq = JSON.stringify(request);
			// console.log("netWorkAgent.js: getNewestPublishProjs: POST open, specificUrl=", specificUrl);
			xhr.open( 'POST', specificUrl , true );

			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
			xhr.onload = function(e) {
				console.log("networkAgent.js: getNewestPublishProjs,  onload xhr.response = ", xhr.response );
			}
			console.log("networkAgent.js: getNewestPublishProjs, jsonReq=", jsonReq );
			xhr.send( jsonReq );
		}
	}
//[end---20190905-fei0073-add]//


//[start-20190904-fei0073-add]//
	//////
	////// server V3 get_res / get_usr_online_res
	//////
	window.getResByUserID = function(url, user_id, main_type, sub_type, callback ){
		if (!user_id) user_id = "makarvr";
		if (!main_type) main_type = "";
		if (!sub_type) sub_type = "";
		// console.log("networkAgent.js: _getResByUserID: ");

		let specificUrl = url+"get_res";
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"user_id": user_id , //miflytest
			"main_type": main_type , // ar, vr 
			"sub_type": sub_type 
		}
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			// console.log("networkAgent: _getResByUserID,  onload xhr.response = ", xhr.response );
			// console.log('%cnetworkAgent: _getResByUserID,  onload error ', 'color: blue');  //// color: #bada55

			if ( xhr.response.error ){
				console.log('%cnetworkAgent: _getResByUserID,  onload error ', 'color:red', xhr.response );  //// color: #bada55
			}else{
				console.log('%cnetworkAgent: _getResByUserID,  onload save ', 'color:blue', xhr.response.data.list );  //// color: #bada55
				
				// createProjResDictFromResList(xhr.response.data.list);

				if ( xhr.response.data.list.length > 0 ){
					createProjResDictFromResList(xhr.response.data.list, function( userProjResDict ){
						if (callback){
							callback( userProjResDict );
						}
					});
				}else{
					if (callback){
						console.log('networkAgent: _getResByUserID,  onload  use res is empty ' );  //// color: #bada55
						callback( {} ); // "use res is empty"
					}
				}

			}

			// if (callback){
			// 	callback();
			// }

		}
		xhr.send( jsonReq );
	}

	//////
	////// search the res_id from res
	//////
	var createProjResDictFromResList = function( userResList , callback ){
		if (!userResList) return -1;
		let userProjResDict = {};
		for (let i = 0; i < userResList.length; i++ ){
			userProjResDict[ userResList[i].res_id ] = userResList[i];

			if ( i == userResList.length-1 ){
				console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback", i, userResList.length ); // Object.keys(userARResDict).length
				if (callback){
					callback( userProjResDict );
				}
			}
		}
		// window.userProjResDict = userProjResDict;
		// console.log("%cnetWorkAgent.js: createProjResDictFromResList:, userProjResDict=", "color:blue",userProjResDict); // Object.keys(userARResDict).length
	}

//[end---20190904-fei0073-add]//

//[start-20200220-fei0090-add]//
	window.getUsrOnlineRes = function( url, user_id, main_type, sub_type , category , callback ){
		
		if (!user_id) user_id = "fefe";
		if (!main_type) main_type = "";
		if (!sub_type) sub_type = "";
		if (!category) category = ""

		//get_usr_online_res
		let specificUrl = url+"get_usr_online_res";
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"user_id": user_id , //miflytest
			"main_type": main_type , // ar, vr 
			"sub_type": sub_type ,
			"category": category ,
		}
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			console.log("networkAgentVR.js: _getUsrOnlineRes: res = ", xhr.response );

			if ( xhr.response.error ){
				console.log('networkAgent.js: _getUsrOnlineRes,  onload error ', xhr.response );  //// color: #bada55
			}else{
				console.log('networkAgent.js: _getUsrOnlineRes,  onload save ' , xhr.response );  //// color: #bada55
				
				if ( xhr.response.data.online_res_list.length > 0 ){
					createOnlineResDictFromResList( xhr.response.data.online_res_list , function( userOnlineResDict ){
						if (callback){
							callback( userOnlineResDict );
						}
					});
				}else{
					if (callback){
						console.log('networkAgent: _getUsrOnlineRes,  onload  use res is empty ' );  //// color: #bada55
						callback( {} ); // "use res is empty"
					}
				}
			}

		}
		xhr.send( jsonReq );
	}


	var createOnlineResDictFromResList = function( userOnlineResList , callback ){
		if (!userOnlineResList) return -1;
		let userOnlineResDict = {};
		for (let i = 0; i < userOnlineResList.length; i++ ){
			userOnlineResDict[ userOnlineResList[i].res_id ] = userOnlineResList[i];

			if ( i == userOnlineResList.length-1 ){
				console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback", i, userOnlineResList.length ); // Object.keys(userARResDict).length
				if (callback){
					callback( userOnlineResDict );
				}
			}
		}
		// window.userOnlineResDict = userOnlineResDict;
 	}

	window.getOneUserInfo = function(url , user_id, wanted_info_keys, callback){

		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			user_id: user_id,
			wanted_info_keys: wanted_info_keys
		}
		let specificUrl = url+"get_one_usr_info";
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			// console.log("networkAgentVR.js: _getOneUserInfo: xhr.r=" , xhr.response );
		
			if (xhr.response.error == ""){
				if (callback){
					callback( xhr.response );
				}	
			}else{
				if (callback){
					callback( xhr.response.error );
				}
			}
		}
		xhr.send(jsonReq);

	}


//[end---20200220-fei0090-add]//

//[start-20191113-thonsha-add]//
	function readTextFile(fileUrl, callback)
	{
		var rawFile = new XMLHttpRequest();
		var txtcontent;
		rawFile.open("GET", fileUrl, true);
		rawFile.onreadystatechange = function ()
		{
			if(rawFile.readyState === 4)
			{
				if(rawFile.status === 200 || rawFile.status == 0)
				{
					let allText = rawFile.responseText;
					
					txtcontent = allText;
					if (callback) callback( txtcontent );
				}
			}
		}
		rawFile.send(null);
		// return txtcontent;
	}
//[end---20191113-thonsha-add]//


	window.getViewerConfig = function(url, callback){
		if (!url ) return -1;
		let specificUrl = url + "get_viewer_config"; //set the url you want
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let request = {
			"ver":"3.1.1",
			"cid": 5,
			"data":{}
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			console.log("networkAgent.js: _getViewerConfig: xhr.response", xhr.response );
			if (callback){
				callback(xhr.response);
			}
		}
		xhr.send( jsonReq );
	}


	window.getARProjsByProjID = function(  projIDList , callback ){
		if (projIDList == undefined ) return;
		if (!Array.isArray(projIDList) ) return;
		if (projIDList.length < 1 ) return;
		
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"proj_id_list": projIDList
		}
		let specificUrl = window.serverUrl+"get_ar_projs_by_proj_id";
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			// console.log("networkAgentVR.js: _getARProjsByProjID: xhr.r=" , xhr.response );
		
			if (xhr.response.error == ""){
				if (callback){
					callback( xhr.response );
				}	
			}else{
				if (callback){
					callback( xhr.response.error );
				}
			}
			
		}
		xhr.send(jsonReq);
	}


////// GET the VR project from MAKAR
//[start-20190806-fei0071-add]//

	window.getVRSceneByUserID = function( url, user_id, callback ) {
		if (!url ) return -1;
		if (!user_id) user_id = "makarvr";
		
		let VRSceneResult = [];
		VRSceneResult.user_id = user_id;

		if (serverVersion == "3.0.0"){
			// console.log("networkAgent.js: getVRSceneByUserID 22: ");
			var main_type = "";
			var sub_type = "";

			var getUserPublishProjsCallback = function(userPublishProjs, userProjResDict , userOnlineResDict ){
				console.log("networkAgent.js: getVRSceneByUserID: _getUserPublishProjsByUserID: userPublishProjs=", userPublishProjs);
				if ( typeof(userPublishProjs) != "string" ){
					
					let projIDList = [];
					for (let i in userPublishProjs.proj_list){
						if (userPublishProjs.proj_list[i].proj_type == "vr"){
//[start-20200522-fei0095-add]//
							//// 判斷只有在 editor 勾選「開啟網頁展示」的專案會顯示。為了不造成顯示錯誤，統一由 interface 控管
							if (parent.useEditorWebTag){
								if ( !userPublishProjs.proj_list[i].proj_platform.find( item => item == "web") ){
									continue;
								}
							}
//[end---20200522-fei0095-add]//
							projIDList.push( userPublishProjs.proj_list[i].proj_id  );
						}
					}
					let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
					let data = {
						"proj_id_list": projIDList
					}
					let specificUrl = url+"get_vr_projs_by_proj_id";
					let request = {
						"ver":"3.0.0",
						"cid": 5,
						"data":data
					};
					let jsonReq = JSON.stringify(request);
					xhr.open( 'POST', specificUrl , true );
					xhr.setRequestHeader('Content-Type', 'application/json');
					xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
					xhr.onload = function(e) {
						// console.log("networkAgent.js: get_vr_projs_by_proj_id: onload, response=", xhr.response );
						let publishVRProjs = xhr.response.data;
						window.publishVRProjs = publishVRProjs;
						
						let count = 0;
						if ( publishVRProjs.result ){
							if ( publishVRProjs.result.length ){
								for (let j = 0; j < publishVRProjs.result.length; j++ ){
									
									let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
									let data = {
										"user_id": publishVRProjs.result[j].user_id,
										"proj_id": publishVRProjs.result[j].proj_id
									}
									let specificUrl = url+"get_vr_proj_scene"; // get_vr_proj_scene 
									let request = {
										"ver":"3.0.0",
										"cid": 5,
										"data":data
									};
									let getVRProjSceneJsonReq = JSON.stringify(request);
									// console.log("netWorkAgent.js: _getUserPublishProjs: POST open, specificUrl=", specificUrl);
									xhr.open( 'POST', specificUrl , true );
									xhr.setRequestHeader('Content-Type', 'application/json');
									xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"

									xhr.onload = function(e) {
										count++;
										// console.log("networkAgent.js: get_vr_proj_scene: onload, response=", xhr.response );
										VRSceneResult[j] = xhr.response.data;
										
										//////
										////// check the consistency between every objects inside sceneResult and userProjResDict 
										////// save the res_url into scene
										//////

										// for ( let k = 0; k < VRSceneResult[j].scenes.length; k++ ){
										// 	if ( VRSceneResult[j].scenes[k].scene_objs ){
										// 		for ( let m = 0; m < VRSceneResult[j].scenes[k].scene_objs.length; m++ ){
										// 			let res = VRSceneResult[j].scenes[k].scene_objs[m];
										// 			let res_id = res.res_id ;

										// 			if (  res.res_id == "" ){
										// 				if (res.main_type == "camera" && res.res_name == "VR Camera" && res.sub_type == "VRcamera" ){
										// 					// console.log("networkAgentVR.js: _getVRSceneByUserID: _getUSerPublishProjs: res camera");
										// 				}else{
										// 					console.log("networkAgentVR.js: _getVRSceneByUserID: _getUSerPublishProjs: res error: ", res, i, j, k ); 
										// 				}
										// 			} else {
										// 				if (userProjResDict[res_id]){
										// 					if ( userProjResDict[res_id].res_url == res.res_url ){
										// 						// console.log("networkAgentVR.js: _getVRSceneByUserID: _getUSerPublishProjs: publish.res_url is same as res.url "  );
										// 					} else {
										// 						console.log("%cnetworkAgentVR.js: _getVRSceneByUserID: _getUSerPublishProjs: publish.res_url different as res.url, replace it", "color:red" , i, j, k );
										// 					}

										// 					if (userProjResDict[res_id].main_type=="model"){
										// 						if (userProjResDict[res_id].res_url_fbx){
										// 							// console.log("networkAgentVR.js: _getVRSceneByUserID: _getUSerPublishProjs: res model: ", res, i, j, k ); 
										// 							res.res_url_fbx = userProjResDict[res_id].res_url_fbx;
										// 						}
										// 					}
										// 				}
										// 			}
										// 		}
										// 	}
										// }
										
										if ( count == publishVRProjs.result.length ){
											// console.log("%cnetworkAgent.js: get_vr_proj_scene: onload, save VRSceneResult ", "color:red", count );
											window.VRSceneResult = VRSceneResult;
											window.userProjResDict = userProjResDict;
											window.userOnlineResDict = userOnlineResDict;
											if (callback) callback(VRSceneResult);
										}

									}
									xhr.send(getVRProjSceneJsonReq);

								}
							}
						}
						
							
					}
					xhr.send(jsonReq);

				}
			// });
			};

			searchUserIDByUserID( url, user_id,  function(userIDs){
				for (let userID in userIDs.result ){
					if ( user_id.toLowerCase() === userIDs.result[userID].user_id.toLowerCase()  ){
						console.log("networkAgentVR.js: _searchUserIDByUserID: match, replace from [" , user_id , "] to [", userIDs.result[userID].user_id, "]"  );
						user_id = userIDs.result[userID].user_id;
					}
				}

				getPayInfoByUserID( url, user_id , function( userPayInfo ){
					let expire_date, expire_date_ymd, expire_date_ymd_arr, ISOexpire_date;
	//[start-20191113-thonsha-add]//
					let userIDWhiteListUrl = 'https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/web_white_list/webVR_UserID_WhiteList.txt';
					readTextFile( userIDWhiteListUrl , function( txtfile ){
	
						let jsonObj = JSON.parse(txtfile);
						let userIDList = jsonObj["customizedUserID"]["list"];
						let nameList = [];
						for (let i = 0; i < userIDList.length; i++){
							nameList.push(userIDList[i]["name"]);
						}
						let isInNameList = (nameList.indexOf(user_id.toLowerCase() ) > -1);
	//[end---20191113-thonsha-add]//
						if (userPayInfo.data){
							console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: userPayInfo =", userPayInfo.data );

							////// 改為使用 web_ar 這個 key 來判斷是否可以體驗，基本上 free 用戶 一定是 false, 而註冊送的一個月用戶也是 false, proA/B/C是true
							////// 假如在 白名單列表裡面，直接設定為可以使用
							////// 後續有一狀況，假如用戶本身為不可使用，但是透過 license 發出的專案卻需要判定可用，需要額外判斷。固在此無條件往下執行。
							window.allowedMakarIDUseWeb = userPayInfo.data.web_ar || isInNameList ;

							if ( userPayInfo.data.user_type == 'proA' || userPayInfo.data.user_type == 'proB' || userPayInfo.data.user_type == 'proC' || userPayInfo.data.user_type == 'custom' ){
								window.allowedMakarIDUseWeb = true;
							}

							// window.allowedMakarIDUseWeb = true;
							
							getUserPublishProjsByUserID(url, user_id, main_type, sub_type, getUserPublishProjsCallback );

						}else{
							console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: error, userPayInfo=", userPayInfo );	
							if(callback) callback("this ID <br> [" + user_id + "] <br> user data error, please contact MIFLY for more information. ");
						}
	
	
					} );
	
					
				});


			});
		}
		
	}


	window.getPayInfoByUserID = function( url, user_id, callback ){
		if (!url ) return -1;
		if (!user_id ) return -1;
		// if (!url ) url = "https://ssl-api-makar-v3-apps.miflyservice.com:8081/Makar/";
		// if (!user_id ) user_id = "fefe";

		let specificUrl = url + "get_pay_info"; //set the url you want
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"user_id": user_id , // user_id: miflytest
		}
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {

			if (callback){
				callback( xhr.response );
			}
		}
		xhr.send( jsonReq );
	}

	//// 取得 license 相關的訊息
	window.getELicenseInfo = function( url, license_key, callback ){
		if (!url ) return -1;
		if (!license_key ) return -1;
		
		let specificUrl = url + "get_e_lice_info"; //set the url you want
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"license_key": license_key , // user_id: miflytest
		}
		let request = {
			"ver":"3.1.1",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			// console.log("networkAgentVR.js: _getELicenseInfo: res = " , xhr.response );
			if (callback){
				callback( xhr.response );
			}
		}
		xhr.send( jsonReq );
	}

	////// 通用的 Post 格式 
	function sendPost(destination, dataObject, callback){
		let xhr = new XMLHttpRequest();
		let request = {
			ver: "3.1.1",
			cid: 5,
			data: dataObject
		};
		let jsonReq = JSON.stringify(request);
		xhr.open('POST', destination, true);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json';
		xhr.addEventListener("load", function() {
			if (callback){
				callback(xhr.response);
			}
		});
		xhr.send(jsonReq);
	}

	////// 檢查各專案是否帶有 lisence 
	window.checkLicenseInProjs = function( url , callback ){
		let specificUrl , arList=[], vrList=[], xrList=[], projList=[] ;
		////先收集一次各類別 proj_id 
		for (let i = 0, len = userPublishProjs.proj_list.length; i < len; i++ ){
			switch(userPublishProjs.proj_list[i].proj_type){
				case "ar":
					arList.push( userPublishProjs.proj_list[i].proj_id );
					projList.push({proj_id:userPublishProjs.proj_list[i].proj_id});
					break;
				case "vr":
					vrList.push( userPublishProjs.proj_list[i].proj_id );
					projList.push({proj_id:userPublishProjs.proj_list[i].proj_id});
					break;
				case "ar_slam":
					xrList.push( userPublishProjs.proj_list[i].proj_id );
					projList.push({proj_id:userPublishProjs.proj_list[i].proj_id});
					break;
				default:
					console.error("networkAgentVR.js: _checkLicenseInProjs: project type ERROR" , userPublishProjs.proj_list[i].proj_type );
					break;
			}
		}

		////// 處理各類別專案，非同步的處理
		let licenseInfos = [];
		function getProjs(res){
			for (let i = 0, len = projList.length; i < len; i++ ){
				for (let j = 0, len = res.data.result.length; j < len; j++ ){
					if (projList[i].proj_id == res.data.result[j].proj_id  ){
						if (res.data.result[j].editor_license_key != ""){
							getELicenseInfo(url , res.data.result[j].editor_license_key , function(res){
								if (res.error != ""){
									licenseInfos.push({proj_id: projList[i].proj_id, isLicense: false });
								}else{
									licenseInfos.push({proj_id: projList[i].proj_id, isLicense: true });
								}
								////// 檢查是否填入完成
								if (licenseInfos.length == projList.length){
									if (callback){
										callback(licenseInfos);
									}
								}

							});
						}else{
							licenseInfos.push({proj_id: projList[i].proj_id, isLicense: false });
						}
					}
				}	
			}
			////// 檢查是否填入完成
			if (licenseInfos.length == projList.length){
				if (callback){
					callback(licenseInfos);
				}
			}
		}
		//// 各類別分別查看 license 
		if (arList.length > 0) {
			sendPost(url + "get_ar_projs_by_proj_id", {proj_id_list: arList } , getProjs );
		}
		if (vrList.length > 0) {
			sendPost(url + "get_vr_projs_by_proj_id" , {proj_id_list: vrList }, getProjs );
		}
		if (xrList.length > 0) {
			sendPost(url + "get_arslam_projs_by_proj_id", {proj_id_list: xrList } , getProjs );
		}

	}

	//// 從server 取得模組專案資訊
	window.getRecordModule = function(url, playing_user_id , proj_id, callback){
		if (!url ) return -1;
		sendPost(url + "get_record_module", {playing_user_id: playing_user_id, proj_id: proj_id } , function(ret){
			console.log("networkAgentVR.js: _getRecordModule: ret" , ret );
			if (callback){
				callback(ret);
			}
		});
	}

	//// 上傳 quiz log資訊到server，給數據分析使用 
	window.quizLog = function(url, data, callback){
		sendPost(url + "quiz_log", data , function(ret){
			console.log("networkAgentVR.js: _quizLog: ret" , ret );
			if (callback){
				callback(ret);
			}
		});
	}

	//// 上傳 quiz record 資訊到server，給viewer端檢驗 
	window.updateRecordModule = function(url, data, callback){
		sendPost(url + "update_record_module", data , function(ret){
			console.log("networkAgentVR.js: _updateRecordModule: ret" , ret );
			if (callback){
				callback(ret);
			}
		});
	}



	window.getVRDataByUserID = function( url, user_id, callback ) {
		if (!url ) return -1;
		if (!user_id) user_id = "makarvr";
		let xhr = new XMLHttpRequest();
		let data = {
			"user_id": user_id,
			"cid": "20"
		}
		let strData = JSON.stringify(data);
		//// the formData
		let FD  = new FormData();
		FD.append("cmd", "get_vr_projs");	 
		FD.append("data", strData );

		xhr.open( 'POST', url , true );
		// xhr.setRequestHeader('Content-Type', 'text/plain' );		//// json
		xhr.responseType = 'json' // set reponse as arraybuffer or text or json

		xhr.onload = function(e) {
			// console.log("networkAgent.js:getVRDataByUserID:", xhr.response);
			let userVRData;

	//[start-20190214-fei0054-mod]//
			//// MAKAR "will" all use gzip compress the text as soon as We can(?)
			if (xhr.response.diaoyurar ){
				// console.log("networkAgent.js: getVRDataByUserID: xhr.response.diaoyurar ");

				let jsonData =  parseDiaoyurar(xhr.response.diaoyurar);
				if (!jsonData.error){
					if (jsonData.data){
						userVRData = jsonData.data;
						//// save the userVRData in window  
						if (!window.userVRData){
							console.log("networkAgent.js: getVRDataByUserID: save window.userARData ");
							window.userVRData = userVRData; 
						}else{
							console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it..");
							window.userVRData = userVRData; 
						}
						if (callback) callback(userVRData); 
					}else{
						if (callback) callback("networkAgent.js:getVRDataByUserID:error: no jsonData.data"); 
					}

				}else{
					if (callback) callback( jsonData.error ); 
					console.log("networkAgent.js: getVRDataByUserID: oops something wrong:", jsonData.error);
				}

				// console.log(jsonData);
			}else{
				// console.log("networkAgent.js: getVRDataByUserID: not xhr.response.diaoyurar ", xhr.response);

				if (!xhr.response.error){
					if (xhr.response.data){
						
						userVRData = xhr.response.data;

						// console.log("networkAgent.js:getVRDataByUserID: onload, response=", xhr.response );
						
						//// save the userVRData in window
						if (userVRData.proj_list) {

							if (!window.userVRData){
								console.log("networkAgent.js: getVRDataByUserID: save window.userARData =", userVRData);
								window.userVRData = userVRData; 
							}else{
								console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it..");
								window.userVRData = userVRData; 
							}
	
							if (callback) callback(userVRData);

						}else{
							console.log("%cnetworkAgent.js:getVRDataByUserID: onload, fail userVRData.proj_list is empty", "color:red" );
							if (callback) callback("the userVRData.proj_list is empty");
						}
					

					}else{
						if (callback) callback("networkAgent.js:getVRDataByUserID:error: no xhr.response.data"); 
					}
				}else{
					if (callback) callback( xhr.response.error ); 
					console.log("networkAgent.js: getVRDataByUserID: oops something wrong:",xhr.response.error);
				}
			}
	//[end---20190214-fei0054-mod]//
		}
		xhr.send( FD );
	}



//[end---20190806-fei0071-add]//


//[start-20190715-fei0070-add]//
	window.uploadDataToServer = function(url, index, callback){
		if (!url ) return -1;

		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"user_id": userARData.user_id,
			"target_id": userARData.proj_list[index].target_id // 1545795389.8544426.1988048228
		}
		// console.log("networkAgent: uploadDataToServer, data = ", data );

		if ( serverVersion == "3.0.0"){
			let specificUrl = url+"add_scan_times";
			let request = {
				"ver":"3.0.0",
				"cid": 5,
				"data":data
			};
			let jsonReq = JSON.stringify(request);

			xhr.open( 'POST', specificUrl , true );

			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
			
			xhr.onload = function(e) {
				// console.log("networkAgent: uploadDataToServer, xhr.response.data = ", xhr.response.data );
			}
			xhr.send( jsonReq );

		}

		if ( serverVersion == "2.0.0"){
			let strData = JSON.stringify(data);
			let FD  = new FormData();
			FD.append("cmd", "add_scan_times");	//get_ar_projs ,  get_ar_proj_scene	, get_ar_projs_by_proj_id
			FD.append("data", strData );

			xhr.open( 'POST', url , true );
			xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
			xhr.onload = function(e) {
				console.log("networkAgent: uploadDataToServer, xhr = ", xhr.response.data );
			}

			xhr.send( FD );
		}
	}

	window.searchUserIDByUserID = function( url, user_id, callback ){
		if (!url ) return -1;
		if (!user_id ) return -1;

		let specificUrl = url + "get_many_usr_info_keyword"; //set the url you want
		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			keyword: user_id,
			search_keys: ["user_id"]
		};
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data
		};
		let jsonReq = JSON.stringify(request);
		xhr.open( 'POST', specificUrl , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
		xhr.onload = function(e) {
			console.log("networkAgent.js: _searchUserIDByUserID: xhr.response", xhr.response.data );
			// console.log("networkAgent.js: getPayInfoByUserID: user_type", xhr.response.data.user_type );

			if (callback){
				callback( xhr.response.data );
			}
		}
		xhr.send( jsonReq );
	}


	////// POST test
	window.testPOST = function(url, callback){
		// if (!url ) return -1;

		var url2 = "http://60.250.125.146:8081/Makar/get_usr_publish_projs"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res
		// var url2 = "https://60.250.125.146:8888/Makar/get_usr_publish_projs"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res

		// var url2 = "https://192.168.0.119:8887/"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res

		// var url2 = "http://192.168.0.119:8887/generator/"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res
		// var url2 = "http://192.168.0.119:8887/"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res

		// var url2 = "https://192.168.0.119:8888/generator/"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res

		// var url2 = "https://192.168.0.135:8881/generator/"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res

		// var url2 = "http://192.168.0.135:8881/generator/"; // get_usr_publish_projs , get_vr_projs , get_ar_projs , get_res

		let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
		let data = {
			"user_id": "fefe", //miflytest
		}
		let request = {
			"ver":"3.0.0",
			"cid": 5,
			"data":data,
			"length":8,
		};
		let jsonReq = JSON.stringify(request);
		console.log(" jsonReq ", jsonReq);

		let FD  = new FormData();
		FD.append("cmd", "add_scan_times");	//get_ar_projs ,  get_ar_proj_scene	, get_ar_projs_by_proj_id
		FD.append("data", jsonReq );

		xhr.open( 'POST', url2 , true );
		xhr.setRequestHeader('Content-Type', 'application/json');
		// xhr.setRequestHeader('Content-type', 'application/json ; charset=UTF-8');
		// xhr.setRequestHeader('Accept', 'application/json');
		xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"

		xhr.onload = function(e) {
			console.log("networkAgent: testPOST,  onload xhr = ", xhr, xhr.response );
		}
		xhr.send( jsonReq );
		// xhr.send( FD );

	}

//[end---20190715-fei0070-add]//

	//[start-20230923-howardhsu-add]//
	//// 取得 projIDList 裡的每個 proj_id 對應的資料
	//// 以 promise 形式來寫
	//// 使用時改為呼叫函式後加上 .then((data) => { ////原本的callback函式要做的事 })  
	window.getVRProjsByProjId = function(url, projIDList){
		return new Promise((resolve, reject)=>{

			//get_usr_online_res
			let xhr = new XMLHttpRequest(); // dont use var!!! will override the previous one
			let data = {
				"proj_id_list": projIDList
			}
			let specificUrl = url+"get_vr_projs_by_proj_id";
			let request = {
				"ver":"3.0.0",
				"cid": 5,
				"data":data
			}
			let jsonReq = JSON.stringify(request);
			xhr.open( 'POST', specificUrl , true );
			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.responseType = 'json' // set reponse as "arraybuffer" or "text" or "json"
			xhr.onload = function(e) {
				// console.log("networkAgent.js: getVRProjsByProjId: onload, response=", xhr.response );
		
				if ( xhr.response.error ){
					console.log('networkAgent.js: _getUsrOnlineRes,  onload error ', xhr.response ); 
					reject( xhr.response.error );
				}else{
					console.log('networkAgent.js: _getUsrOnlineRes,  onload ' , xhr.response );  				
					resolve(  xhr.response.data )  
				}
		
			}
			
			xhr.onerror = function(err) {
				reject(err);
			};
	
			xhr.send( jsonReq );
			
		})
	}



	//[end-20230923-howardhsu-add]//


})();


/***/ }),

/***/ "./lib/chromaShader.js":
/*!*****************************!*\
  !*** ./lib/chromaShader.js ***!
  \*****************************/
/***/ (() => {

/* --------------------------------------------------------
THREE.ObjectControls
version: 1.1
author: Alberto Piras
email: a.piras.ict@gmail.com
github: https://github.com/albertopiras
license: MIT
----------------------------------------------------------*/

/**
 * THREE.ObjectControls
 * @constructor
 * @param camera - The camera.
 * @param domElement - the renderer's dom element
 * @param objectToMove - the object to control.
 */

var vertexShaderRGB = 
	`varying vec2 vUv;
	void main()
	{
		vUv = uv;
		vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
		gl_Position = projectionMatrix * mvPosition;
	}`;

var fragmentShaderRGB = `
	uniform sampler2D texture;
	uniform vec3 color;
	varying vec2 vUv;
	float _threshold = 1.0 ;
	float _slope = 0.3 ;
	float opacity = 1.0;
	void main()
	{
		vec3 tColor = texture2D( texture, vUv ).rgb;
		float a = texture2D( texture, vUv ).a;
		// float a = (length(tColor - color) - 0.5) * 7.0;

		// if (tColor.g > 0.7 && tColor.r < 0.7 && tColor.b < 0.7  ){
		// 	tColor = vec3(0.0, 0.0, 0.0);
		// 	tColor.g = 0.0;
		// 	a = 0.0 ;
		// }
		// gl_FragColor = vec4(tColor, a);

		///////// thonsha method ///////
		float d1, d2, d3, d4, d;
		d1 = abs(length(abs(color.rgb - tColor.rgb)));

		float c1 = abs(length( tColor.g - tColor.r) - length(color.g - color.r));
		float c2 = abs(length( tColor.r - tColor.b) - length(color.r - color.b));
		float c3 = abs(length( tColor.b - tColor.g) - length(color.b - color.g));

		d4 = c1 + c2 + c3;

		d = (d1*2.0 + d4) / 2.0 ;

		float edge0 = _threshold * (1.0 - _slope);
		float alpha = smoothstep(edge0, _threshold, d);
		gl_FragColor = vec4(tColor, alpha );
		if (alpha < opacity){
			gl_FragColor = vec4(tColor, alpha*a);
		} else{
			gl_FragColor = vec4(tColor, opacity*a);
		}

	}
	`;


THREE.ChromaKeyMaterial = function( parameters ) {
	// console.log("chromaShader.js: ChromaKeyMaterial: parameters=", parameters );
	if ( parameters === undefined ) return;
	if ( parameters.map === undefined || parameters.keyColor === undefined ) return;
	if ( parameters.side === undefined)  parameters.side = THREE.FrontSide;

	if ( parameters.slope === undefined)  parameters.slope = 0.3 ;
	if ( parameters.threshold === undefined)  parameters.threshold = 1.0 ;
	
	var fragmentShaderM = fragmentShaderRGB.replace("float _threshold = 1.0", "float _threshold = " + parameters.threshold.toFixed(3) );
	fragmentShaderM = fragmentShaderM.replace("float _slope = 0.3", "float _slope = " + parameters.slope.toFixed(3) );

	// console.log("chromaShader.js: ChromaKeyMaterial: slope / threshold =", parameters.slope, parameters.threshold  );
	// console.log("chromaShader.js: ChromaKeyMaterial: fragmentShaderM =", fragmentShaderM  );

	var self = this;
	THREE.ShaderMaterial.call(self);
	
	var keyColorObject;

	if ( Array.isArray( parameters.keyColor  ) ){ 
		keyColorObject = new THREE.Color( parameters.keyColor[0] , parameters.keyColor[1] , parameters.keyColor[2] );
	}else{
		keyColorObject = new THREE.Color( parameters.keyColor );
	}

	self.setValues({
		uniforms: {
			texture: {
				type: "t",
				value: parameters.map,
			},
			color: {
				type: "c",
				value: keyColorObject
			}
		},
		vertexShader: vertexShaderRGB,
		fragmentShader: fragmentShaderM,

		map: parameters.map, 
		transparent: true,
		side: parameters.side ,
		depthTest: false ,
		depthWrite: false ,
	});
	// console.log(" ************** chromaShader.js: self=", self );
};

THREE.ChromaKeyMaterial.prototype = Object.create( THREE.ShaderMaterial.prototype );
THREE.ChromaKeyMaterial.prototype.constructor = THREE.ChromaKeyMaterial;

var vertexShaderHSV = 
	`
	varying vec2 vUV;
	void main(void) {
		vUV = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
	`
	;

var fragmentShaderHSV = `
	uniform sampler2D src;
	float opacity=1.0;
	varying vec2 vUV;
	uniform float _keyingColorH;
	uniform float _keyingColorS;
	uniform float _keyingColorV;
	uniform float _deltaH;
	uniform float _deltaS;
	uniform float _deltaV;

	vec3 rgb2hsv(vec3 c){
		vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
		vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
		vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
		float d = q.x - min(q.w, q.y);
		float e = 1.0e-10;
		return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
	}

	void main(){
		vec3 tColor = texture2D( src, vUV ).rgb;
		float a = texture2D( src, vUV ).a;
		vec3 HSV = rgb2hsv(tColor);
		float h = abs(HSV.x - _keyingColorH);
		float s = abs(HSV.y - _keyingColorS);
		float v = abs(HSV.z - _keyingColorV);
		float alpha = opacity;
		if (h <= _deltaH * 0.5 && s <= _deltaS && v <= _deltaV){
			alpha = smoothstep((_deltaH * 0.5) * 0.8, _deltaH* 0.6 ,h);
		}

		gl_FragColor = vec4(tColor, alpha*a);
	}

	`;


THREE.HSVMattingMaterial = function( parameters ) {
	// console.log("chromaShader.js: HSVMattingMaterial: parameters=", parameters );
	if ( parameters === undefined ) return;
	if ( parameters.map === undefined ) return;
	if ( parameters.side === undefined)  parameters.side = THREE.FrontSide;

	if ( parameters._keyingColorH === undefined)  parameters._keyingColorH = 0.33 ;
	if ( parameters._keyingColorS === undefined)  parameters._keyingColorS = 1.0 ;
	if ( parameters._keyingColorV === undefined)  parameters._keyingColorV = 0.75 ;

	if ( parameters._deltaH === undefined)  parameters._deltaH = 0.2 ;
	if ( parameters._deltaS === undefined)  parameters._deltaS = 0.1 ;
	if ( parameters._deltaV === undefined)  parameters._deltaV = 0.1 ;
	
	console.log(" ***************************************** parameters = ", parameters );
	// console.log("chromaShader.js: HSVMattingMaterial: slope / threshold =", parameters.slope, parameters.threshold  );
	// console.log("chromaShader.js: HSVMattingMaterial: fragmentShaderM =", fragmentShaderM  );

	var self = this;
	THREE.ShaderMaterial.call(self);
	
	var keyColorObject;

	if ( Array.isArray( parameters.keyColor  ) ){ 
		keyColorObject = new THREE.Color( parameters.keyColor[0] , parameters.keyColor[1] , parameters.keyColor[2] );
	}else{
		keyColorObject = new THREE.Color( parameters.keyColor );
	}

	self.setValues({
		uniforms: {
			src: {
				type: "t",
				value: parameters.map,
			},
			color: {
				type: "c",
				value: keyColorObject
			},
			_keyingColorH: {
				type:"number",
				value:parameters._keyingColorH,
			},
			_keyingColorS: {
				type:"number",
				value:parameters._keyingColorS,
			},
			_keyingColorV: {
				type:"number",
				value:parameters._keyingColorV,
			},
			_deltaH: {
				type:"number",
				value:parameters._deltaH,
			},
			_deltaS: {
				type:"number",
				value:parameters._deltaS,
			},
			_deltaV: {
				type:"number",
				value:parameters._deltaV,
			},
		},
		vertexShader: vertexShaderHSV,
		fragmentShader: fragmentShaderHSV ,

		map: parameters.map, 
		transparent: true,
		side: parameters.side ,

		depthTest: false ,
		depthWrite: false ,
	});
	
};
THREE.HSVMattingMaterial.prototype = Object.create( THREE.ShaderMaterial.prototype );
THREE.HSVMattingMaterial.prototype.constructor = THREE.HSVMattingMaterial;

/***/ }),

/***/ "./lib/orbitControls_customize.js":
/*!****************************************!*\
  !*** ./lib/orbitControls_customize.js ***!
  \****************************************/
/***/ (() => {

/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __nested_webpack_require_175__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __nested_webpack_require_175__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__nested_webpack_require_175__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__nested_webpack_require_175__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__nested_webpack_require_175__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__nested_webpack_require_175__.d = function(exports, name, getter) {
/******/ 		if(!__nested_webpack_require_175__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__nested_webpack_require_175__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__nested_webpack_require_175__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__nested_webpack_require_175__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__nested_webpack_require_175__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __nested_webpack_require_175__(__nested_webpack_require_175__.s = 1);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

/**
 * @author qiao / https://github.com/qiao
 * @author mrdoob / http://mrdoob.com
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author erich666 / http://erichaines.com
 */

// This set of controls performs orbiting, dollying (zooming), and panning.
// Unlike TrackballControls, it maintains the "up" direction object.up (+Y by default).
//
//    Orbit - left mouse / touch: one finger move
//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish
//    Pan - right mouse, or arrow keys / touch: three finger swipe

THREE.OrbitControls = function ( object, domElement ) {

	this.object = object;

	this.domElement = ( domElement !== undefined ) ? domElement : document;

	// Set to false to disable this control
	this.enabled = true;

	// "target" sets the location of focus, where the object orbits around
	this.target = new THREE.Vector3();

	// How far you can dolly in and out ( PerspectiveCamera only )
	this.minDistance = 0;
	this.maxDistance = Infinity;

	// How far you can zoom in and out ( OrthographicCamera only )
	this.minZoom = 0;
	this.maxZoom = Infinity;

	// How far you can orbit vertically, upper and lower limits.
	// Range is 0 to Math.PI radians.
	this.minPolarAngle = 0; // radians
	this.maxPolarAngle = Math.PI; // radians

	// How far you can orbit horizontally, upper and lower limits.
	// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].
	this.minAzimuthAngle = - Infinity; // radians
	this.maxAzimuthAngle = Infinity; // radians

	// Set to true to enable damping (inertia)
	// If damping is enabled, you must call controls.update() in your animation loop
	this.enableDamping = false;
	this.dampingFactor = 0.25;

	// This option actually enables dollying in and out; left as "zoom" for backwards compatibility.
	// Set to false to disable zooming
	this.enableZoom = true;
	this.zoomSpeed = 1.0;

	// Set to false to disable rotating
	this.enableRotate = true;
	this.rotateSpeed = 1.0;

	// Set to false to disable panning
	this.enablePan = true;
	this.keyPanSpeed = 7.0;	// pixels moved per arrow key push

	// Set to true to automatically rotate around the target
	// If auto-rotate is enabled, you must call controls.update() in your animation loop
	this.autoRotate = false;
	this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60

	// Set to false to disable use of the keys
	this.enableKeys = true;

	// The four arrow keys
	this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };

	// Mouse buttons
	this.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };

	// for reset
	this.target0 = this.target.clone();
	this.position0 = this.object.position.clone();
	this.zoom0 = this.object.zoom;

	//
	// public methods
	//

	this.getPolarAngle = function () {

		return spherical.phi;

	};

	this.getAzimuthalAngle = function () {

		return spherical.theta;

	};

	this.saveState = function () {

		scope.target0.copy( scope.target );
		scope.position0.copy( scope.object.position );
		scope.zoom0 = scope.object.zoom;

	};

	this.reset = function () {

		scope.target.copy( scope.target0 );
		scope.object.position.copy( scope.position0 );
		scope.object.zoom = scope.zoom0;

		scope.object.updateProjectionMatrix();
		scope.dispatchEvent( changeEvent );

		scope.update();

		state = STATE.NONE;

	};

	// this method is exposed, but perhaps it would be better if we can make it private...
	this.update = function () {

		var offset = new THREE.Vector3();

		// so camera.up is the orbit axis
		var quat = new THREE.Quaternion().setFromUnitVectors( object.up, new THREE.Vector3( 0, 1, 0 ) );
		
		// var quatInverse = quat.clone().inverse();

		let quatInverse;
		if ( quat.inverse ){
			quatInverse = quat.clone().inverse();
		}else{
			quatInverse = quat.clone().invert();
		}
		
		
		var lastPosition = new THREE.Vector3();
		var lastQuaternion = new THREE.Quaternion();

		return function update() {

			var position = scope.object.position;

			offset.copy( position ).sub( scope.target );

			// rotate offset to "y-axis-is-up" space
			offset.applyQuaternion( quat );

			// angle from z-axis around y-axis
			spherical.setFromVector3( offset );

			if ( scope.autoRotate && state === STATE.NONE ) {

				rotateLeft( getAutoRotationAngle() );

			}

			spherical.theta += sphericalDelta.theta;
			spherical.phi += sphericalDelta.phi;

			// restrict theta to be between desired limits
			spherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );

			// console.log(' 1 ', spherical.phi  )

			// restrict phi to be between desired limits
			spherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );

			// console.log(' 2 ', spherical.phi  )

			spherical.makeSafe();


			spherical.radius *= scale;

			// restrict radius to be between desired limits
			spherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );

			// move target to panned location
			scope.target.add( panOffset );

			//// 客製化需求，要判定「 target 」的範圍。
			//// console.log(' *** ',  scope.target  );
			// if ( scope.target.y < 1.9 ){
			// 	scope.target.y = 1.9 ;
			// }


			offset.setFromSpherical( spherical );

			// rotate offset back to "camera-up-vector-is-up" space
			offset.applyQuaternion( quatInverse );

			position.copy( scope.target ).add( offset );

			scope.object.lookAt( scope.target );

			if ( scope.enableDamping === true ) {

				sphericalDelta.theta *= ( 1 - scope.dampingFactor );
				sphericalDelta.phi *= ( 1 - scope.dampingFactor );

			} else {

				sphericalDelta.set( 0, 0, 0 );

			}

			scale = 1;
			panOffset.set( 0, 0, 0 );

			// update condition is:
			// min(camera displacement, camera rotation in radians)^2 > EPS
			// using small-angle approximation cos(x/2) = 1 - x^2 / 8

			if ( zoomChanged ||
				lastPosition.distanceToSquared( scope.object.position ) > EPS ||
				8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {

				scope.dispatchEvent( changeEvent );

				lastPosition.copy( scope.object.position );
				lastQuaternion.copy( scope.object.quaternion );
				zoomChanged = false;

				return true;

			}

			return false;

		};

	}();

	this.dispose = function () {

		scope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );
		scope.domElement.removeEventListener( 'mousedown', onMouseDown, false );
		scope.domElement.removeEventListener( 'wheel', onMouseWheel, false );

		scope.domElement.removeEventListener( 'touchstart', onTouchStart, false );
		scope.domElement.removeEventListener( 'touchend', onTouchEnd, false );
		scope.domElement.removeEventListener( 'touchmove', onTouchMove, false );

		document.removeEventListener( 'mousemove', onMouseMove, false );
		document.removeEventListener( 'mouseup', onMouseUp, false );

		window.removeEventListener( 'keydown', onKeyDown, false );

		//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?

	};

	//
	// internals
	//

	var scope = this;

	var changeEvent = { type: 'change' };
	var startEvent = { type: 'start' };
	var endEvent = { type: 'end' };

	var STATE = { NONE: - 1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };

	var state = STATE.NONE;

	var EPS = 0.000001;

	// current position in spherical coordinates
	var spherical = new THREE.Spherical();
	var sphericalDelta = new THREE.Spherical();

	var scale = 1;
	var panOffset = new THREE.Vector3();
	var zoomChanged = false;

	var rotateStart = new THREE.Vector2();
	var rotateEnd = new THREE.Vector2();
	var rotateDelta = new THREE.Vector2();

	var panStart = new THREE.Vector2();
	var panEnd = new THREE.Vector2();
	var panDelta = new THREE.Vector2();

	var dollyStart = new THREE.Vector2();
	var dollyEnd = new THREE.Vector2();
	var dollyDelta = new THREE.Vector2();

	function getAutoRotationAngle() {

		return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;

	}

	function getZoomScale() {

		return Math.pow( 0.95, scope.zoomSpeed );

	}

	function rotateLeft( angle ) {

		sphericalDelta.theta -= angle;

	}

	function rotateUp( angle ) {

		sphericalDelta.phi -= angle;

	}

	var panLeft = function () {

		var v = new THREE.Vector3();

		return function panLeft( distance, objectMatrix ) {

			v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix
			v.multiplyScalar( - distance );

			panOffset.add( v );

		};

	}();

	var panUp = function () {

		var v = new THREE.Vector3();

		return function panUp( distance, objectMatrix ) {

			v.setFromMatrixColumn( objectMatrix, 1 ); // get Y column of objectMatrix
			v.multiplyScalar( distance );

			panOffset.add( v );

		};

	}();

	// deltaX and deltaY are in pixels; right and down are positive
	var pan = function () {

		var offset = new THREE.Vector3();

		return function pan( deltaX, deltaY ) {

			var element = scope.domElement === document ? scope.domElement.body : scope.domElement;

			if ( scope.object.isPerspectiveCamera ) {

				// perspective
				var position = scope.object.position;
				offset.copy( position ).sub( scope.target );
				var targetDistance = offset.length();

				// half of the fov is center to top of screen
				targetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );

				// we actually don't use screenWidth, since perspective camera is fixed to screen height
				panLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );
				panUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );

			} else if ( scope.object.isOrthographicCamera ) {

				// orthographic
				panLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );
				panUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );

			} else {

				// camera neither orthographic nor perspective
				console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );
				scope.enablePan = false;

			}

		};

	}();

	function dollyIn( dollyScale ) {

		if ( scope.object.isPerspectiveCamera ) {

			scale /= dollyScale;

		} else if ( scope.object.isOrthographicCamera ) {

			scope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );
			scope.object.updateProjectionMatrix();
			zoomChanged = true;

		} else {

			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );
			scope.enableZoom = false;

		}

	}

	function dollyOut( dollyScale ) {

		if ( scope.object.isPerspectiveCamera ) {

			scale *= dollyScale;

		} else if ( scope.object.isOrthographicCamera ) {

			scope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );
			scope.object.updateProjectionMatrix();
			zoomChanged = true;

		} else {

			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );
			scope.enableZoom = false;

		}

	}

	//
	// event callbacks - update the object state
	//

	function handleMouseDownRotate( event ) {

		//console.log( 'handleMouseDownRotate' );

		rotateStart.set( event.clientX, event.clientY );

	}

	function handleMouseDownDolly( event ) {

		//console.log( 'handleMouseDownDolly' );

		dollyStart.set( event.clientX, event.clientY );

	}

	function handleMouseDownPan( event ) {

		//console.log( 'handleMouseDownPan' );

		panStart.set( event.clientX, event.clientY );

	}

	function handleMouseMoveRotate( event ) {

		//console.log( 'handleMouseMoveRotate' );

		rotateEnd.set( event.clientX, event.clientY );
		rotateDelta.subVectors( rotateEnd, rotateStart );

		var element = scope.domElement === document ? scope.domElement.body : scope.domElement;

		// rotating across whole screen goes 360 degrees around
		rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );

		// rotating up and down along whole screen attempts to go 360, but limited to 180
		rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );

		rotateStart.copy( rotateEnd );

		scope.update();

	}

	function handleMouseMoveDolly( event ) {

		//console.log( 'handleMouseMoveDolly' );

		dollyEnd.set( event.clientX, event.clientY );

		dollyDelta.subVectors( dollyEnd, dollyStart );

		if ( dollyDelta.y > 0 ) {

			dollyIn( getZoomScale() );

		} else if ( dollyDelta.y < 0 ) {

			dollyOut( getZoomScale() );

		}

		dollyStart.copy( dollyEnd );

		scope.update();

	}

	function handleMouseMovePan( event ) {

		//console.log( 'handleMouseMovePan' );

		panEnd.set( event.clientX, event.clientY );

		panDelta.subVectors( panEnd, panStart );

		pan( panDelta.x, panDelta.y );

		panStart.copy( panEnd );

		scope.update();

	}

	function handleMouseUp( event ) {

		// console.log( 'handleMouseUp' );

	}

	function handleMouseWheel( event ) {

		// console.log( 'handleMouseWheel' );

		if ( event.deltaY < 0 ) {

			dollyOut( getZoomScale() );

		} else if ( event.deltaY > 0 ) {

			dollyIn( getZoomScale() );

		}

		scope.update();

	}

	function handleKeyDown( event ) {

		//console.log( 'handleKeyDown' );

		switch ( event.keyCode ) {

			case scope.keys.UP:
				pan( 0, scope.keyPanSpeed );
				scope.update();
				break;

			case scope.keys.BOTTOM:
				pan( 0, - scope.keyPanSpeed );
				scope.update();
				break;

			case scope.keys.LEFT:
				pan( scope.keyPanSpeed, 0 );
				scope.update();
				break;

			case scope.keys.RIGHT:
				pan( - scope.keyPanSpeed, 0 );
				scope.update();
				break;

		}

	}

	function handleTouchStartRotate( event ) {

		//console.log( 'handleTouchStartRotate' );

		rotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );

	}

	function handleTouchStartDolly( event ) {

		//console.log( 'handleTouchStartDolly' );

		var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;
		var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;

		var distance = Math.sqrt( dx * dx + dy * dy );

		dollyStart.set( 0, distance );

	}

	function handleTouchStartPan( event ) {

		//console.log( 'handleTouchStartPan' );

		panStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );

	}

	function handleTouchMoveRotate( event ) {

		//console.log( 'handleTouchMoveRotate' );

		rotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );
		rotateDelta.subVectors( rotateEnd, rotateStart );

		var element = scope.domElement === document ? scope.domElement.body : scope.domElement;

		// rotating across whole screen goes 360 degrees around
		rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );

		// rotating up and down along whole screen attempts to go 360, but limited to 180
		rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );

		rotateStart.copy( rotateEnd );

		scope.update();

	}

	function handleTouchMoveDolly( event ) {

		//console.log( 'handleTouchMoveDolly' );

		var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;
		var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;

		var distance = Math.sqrt( dx * dx + dy * dy );

		dollyEnd.set( 0, distance );

		dollyDelta.subVectors( dollyEnd, dollyStart );

		if ( dollyDelta.y > 0 ) {

			dollyOut( getZoomScale() );

		} else if ( dollyDelta.y < 0 ) {

			dollyIn( getZoomScale() );

		}

		dollyStart.copy( dollyEnd );

		scope.update();

	}

	function handleTouchMovePan( event ) {

		panEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );

		panDelta.subVectors( panEnd, panStart );

		pan( panDelta.x, panDelta.y );

		panStart.copy( panEnd );

		scope.update();

	}

	function handleTouchEnd( event ) {

		//console.log( 'handleTouchEnd' );

	}

	//
	// event handlers - FSM: listen for events and reset state
	//

	function onMouseDown( event ) {

		if ( scope.enabled === false ) return;

		event.preventDefault();

		switch ( event.button ) {

			case scope.mouseButtons.ORBIT:

				if ( scope.enableRotate === false ) return;

				handleMouseDownRotate( event );

				state = STATE.ROTATE;

				break;

			case scope.mouseButtons.ZOOM:

				if ( scope.enableZoom === false ) return;

				handleMouseDownDolly( event );

				state = STATE.DOLLY;

				break;

			case scope.mouseButtons.PAN:

				if ( scope.enablePan === false ) return;

				handleMouseDownPan( event );

				state = STATE.PAN;

				break;

		}

		if ( state !== STATE.NONE ) {

			document.addEventListener( 'mousemove', onMouseMove, false );
			document.addEventListener( 'mouseup', onMouseUp, false );

			scope.dispatchEvent( startEvent );

		}

	}

	function onMouseMove( event ) {

		if ( scope.enabled === false ) return;

		event.preventDefault();

		switch ( state ) {

			case STATE.ROTATE:

				if ( scope.enableRotate === false ) return;

				handleMouseMoveRotate( event );

				break;

			case STATE.DOLLY:

				if ( scope.enableZoom === false ) return;

				handleMouseMoveDolly( event );

				break;

			case STATE.PAN:

				if ( scope.enablePan === false ) return;

				handleMouseMovePan( event );

				break;

		}

	}

	function onMouseUp( event ) {

		if ( scope.enabled === false ) return;

		handleMouseUp( event );

		document.removeEventListener( 'mousemove', onMouseMove, false );
		document.removeEventListener( 'mouseup', onMouseUp, false );

		scope.dispatchEvent( endEvent );

		state = STATE.NONE;

	}

	function onMouseWheel( event ) {

		if ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;

		event.preventDefault();

		scope.dispatchEvent( startEvent );

		handleMouseWheel( event );

		scope.dispatchEvent( endEvent );

	}

	function onKeyDown( event ) {

		if ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;

		handleKeyDown( event );

	}

	function onTouchStart( event ) {

		if ( scope.enabled === false ) return;

		switch ( event.touches.length ) {

			case 1:	// one-fingered touch: rotate

				if ( scope.enableRotate === false ) return;

				handleTouchStartRotate( event );

				state = STATE.TOUCH_ROTATE;

				break;

			case 2:	// two-fingered touch: dolly

				if ( scope.enableZoom === false || scope.enablePan === false ) return;     // 20210916 Chris added 「|| scope.enablePan === false」

				handleTouchStartDolly( event );
				handleTouchStartPan( event );     // 20210916 Chris added

				state = STATE.TOUCH_DOLLY;

				break;

			case 3: // three-fingered touch: pan

				if ( scope.enablePan === false ) return;

				// handleTouchStartPan( event );     // 20210916 Chris commented

				state = STATE.TOUCH_PAN;

				break;

			default:

				state = STATE.NONE;

		}

		if ( state !== STATE.NONE ) {

			scope.dispatchEvent( startEvent );

		}

	}

	function onTouchMove( event ) {

		if ( scope.enabled === false ) return;

		event.preventDefault();

		switch ( event.touches.length ) {

			case 1: // one-fingered touch: rotate

				if ( scope.enableRotate === false ) return;
				if ( state !== STATE.TOUCH_ROTATE ) return; // is this needed?...

				handleTouchMoveRotate( event );

				break;

			case 2: // two-fingered touch: dolly

				if ( scope.enableZoom === false || scope.enablePan === false ) return;     // 20210916 Chris added 「|| scope.enablePan === false」
				if ( state !== STATE.TOUCH_DOLLY ) return; // is this needed?...

				handleTouchMoveDolly( event );
				handleTouchMovePan( event );     // 20210916 Chris added

				break;

			case 3: // three-fingered touch: pan

				if ( scope.enablePan === false ) return;
				if ( state !== STATE.TOUCH_PAN ) return; // is this needed?...

				// handleTouchMovePan( event );     // 20210916 Chris commented

				break;

			default:

				state = STATE.NONE;

		}

	}

	function onTouchEnd( event ) {

		if ( scope.enabled === false ) return;

		handleTouchEnd( event );

		scope.dispatchEvent( endEvent );

		state = STATE.NONE;

	}

	function onContextMenu( event ) {

		if ( scope.enabled === false ) return;

		event.preventDefault();

	}

	//

	scope.domElement.addEventListener( 'contextmenu', onContextMenu, false );

	scope.domElement.addEventListener( 'mousedown', onMouseDown, false );
	scope.domElement.addEventListener( 'wheel', onMouseWheel, false );

	scope.domElement.addEventListener( 'touchstart', onTouchStart, false );
	scope.domElement.addEventListener( 'touchend', onTouchEnd, false );
	scope.domElement.addEventListener( 'touchmove', onTouchMove, false );

	window.addEventListener( 'keydown', onKeyDown, false );

	// force an update at start

	this.update();

};

THREE.OrbitControls.prototype = Object.create( THREE.EventDispatcher.prototype );
THREE.OrbitControls.prototype.constructor = THREE.OrbitControls;

Object.defineProperties( THREE.OrbitControls.prototype, {

	center: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .center has been renamed to .target' );
			return this.target;

		}

	},

	// backward compatibility

	noZoom: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );
			return ! this.enableZoom;

		},

		set: function ( value ) {

			console.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );
			this.enableZoom = ! value;

		}

	},

	noRotate: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );
			return ! this.enableRotate;

		},

		set: function ( value ) {

			console.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );
			this.enableRotate = ! value;

		}

	},

	noPan: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );
			return ! this.enablePan;

		},

		set: function ( value ) {

			console.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );
			this.enablePan = ! value;

		}

	},

	noKeys: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );
			return ! this.enableKeys;

		},

		set: function ( value ) {

			console.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );
			this.enableKeys = ! value;

		}

	},

	staticMoving: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );
			return ! this.enableDamping;

		},

		set: function ( value ) {

			console.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );
			this.enableDamping = ! value;

		}

	},

	dynamicDampingFactor: {

		get: function () {

			console.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );
			return this.dampingFactor;

		},

		set: function ( value ) {

			console.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );
			this.dampingFactor = value;

		}

	}

} );


/***/ }),
/* 1 */
/***/ (function(module, exports, __nested_webpack_require_26999__) {

__nested_webpack_require_26999__(0);

var bind = AFRAME.utils.bind;

AFRAME.registerComponent('orbit-controls', {
  dependencies: ['camera'],

  schema: {
    autoRotate: {type: 'boolean'},
    autoRotateSpeed: {default: 2},
    dampingFactor: {default: 0.1},
    enabled: {default: true},
    enableDamping: {default: true},
    enableKeys: {default: true},
    enablePan: {default: true},
    enableRotate: {default: true},
    enableZoom: {default: true},
    initialPosition: {type: 'vec3'},
    keyPanSpeed: {default: 7},
    minAzimuthAngle: {type: 'number', default: - Infinity},
    maxAzimuthAngle: {type: 'number', default: Infinity},
    maxDistance: {default: 1000},
    maxPolarAngle: {default: AFRAME.utils.device.isMobile() ? 90 : 120},
    minDistance: {default: 1},
    minPolarAngle: {default: 0},
    minZoom: {default: 0},
    panSpeed: {default: 1},
    rotateSpeed: {default: 0.05},
    screenSpacePanning: {default: false},
    target: {type: 'vec3'},
    zoomSpeed: {default: 0.5}
  },

  init: function () {
    var el = this.el;
	var oldPosition;

	oldPosition = new THREE.Vector3();
	this.oldPosition = oldPosition;

    this.bindMethods();
    el.sceneEl.addEventListener('enter-vr', this.onEnterVR);
    el.sceneEl.addEventListener('exit-vr', this.onExitVR);

    document.body.style.cursor = 'grab';
    document.addEventListener('mousedown', () => {
      document.body.style.cursor = 'grabbing';
    });
    document.addEventListener('mouseup', () => {
      document.body.style.cursor = 'grab';
    });

    this.target = new THREE.Vector3();
    el.getObject3D('camera').position.copy(this.data.initialPosition);
  },

  pause: function () {
    this.controls.dispose();
  },

  play: function () {
    const el = this.el;
    this.controls = new THREE.OrbitControls(el.getObject3D('camera'), el.sceneEl.renderer.domElement);
    this.update();
  },

  onEnterVR: function() {
    var el = this.el;

    if (!AFRAME.utils.device.checkHeadsetConnected() &&
        !AFRAME.utils.device.isMobile()) { return; }
    this.controls.enabled = false;
    if (el.hasAttribute('look-controls')) {
	  el.setAttribute('look-controls', 'enabled', true);
      this.oldPosition.copy(el.getObject3D('camera').position);
      el.getObject3D('camera').position.set(0, 0, 0);
    }
  },

  onExitVR: function() {
    var el = this.el;

    if (!AFRAME.utils.device.checkHeadsetConnected() &&
        !AFRAME.utils.device.isMobile()) { return; }
	this.controls.enabled = true;
	if (this.oldPosition){
		el.getObject3D('camera').position.copy( this.oldPosition);
	}
    if (el.hasAttribute('look-controls')) {
      el.setAttribute('look-controls', 'enabled', false);
    }
  },

  bindMethods: function() {
    this.onEnterVR = bind(this.onEnterVR, this);
    this.onExitVR = bind(this.onExitVR, this);
  },

  update: function (oldData) {
    var controls = this.controls;
    var data = this.data;

    if (!controls) { return; }

    controls.target = this.target.copy(data.target);
    controls.autoRotate = data.autoRotate;
    controls.autoRotateSpeed = data.autoRotateSpeed;
    controls.dampingFactor = data.dampingFactor;
    controls.enabled = data.enabled;
    controls.enableDamping = data.enableDamping;
    controls.enableKeys = data.enableKeys;
    controls.enablePan = data.enablePan;
    controls.enableRotate = data.enableRotate;
    controls.enableZoom = data.enableZoom;
	controls.keyPanSpeed = data.keyPanSpeed;
	
	if ( THREE.Math ){
		controls.maxPolarAngle = THREE.Math.degToRad(data.maxPolarAngle);
		controls.maxAzimuthAngle = THREE.Math.degToRad(data.maxAzimuthAngle);
	}else{
		controls.maxPolarAngle = THREE.MathUtils.degToRad(data.maxPolarAngle);
		controls.maxAzimuthAngle = THREE.MathUtils.degToRad(data.maxAzimuthAngle);	
	}
    
	
	

    controls.maxDistance = data.maxDistance;
	controls.minDistance = data.minDistance;
	
	if ( THREE.Math ){
		controls.minPolarAngle = THREE.Math.degToRad(data.minPolarAngle);
		controls.minAzimuthAngle = THREE.Math.degToRad(data.minAzimuthAngle);
	}else{
		controls.minPolarAngle = THREE.MathUtils.degToRad(data.minPolarAngle);
		controls.minAzimuthAngle = THREE.MathUtils.degToRad(data.minAzimuthAngle);	
	}
    
	
	
    controls.minZoom = data.minZoom;
    controls.panSpeed = data.panSpeed;
    controls.rotateSpeed = data.rotateSpeed;
    controls.screenSpacePanning = data.screenSpacePanning;
    controls.zoomSpeed = data.zoomSpeed;
  },

  tick: function () {
    var controls = this.controls;
    var data = this.data;
    if (!data.enabled) { return; }
    if (controls.enabled && (controls.enableDamping || controls.autoRotate)) {
      this.controls.update();
    }
  },

  remove: function() {
    this.controls.reset();
    this.controls.dispose();

    this.el.sceneEl.removeEventListener('enter-vr', this.onEnterVR);
    this.el.sceneEl.removeEventListener('exit-vr', this.onExitVR);
  }
});


/***/ })
/******/ ]);

/***/ }),

/***/ "./lib/testWebpack/UI.min.js":
/*!***********************************!*\
  !*** ./lib/testWebpack/UI.min.js ***!
  \***********************************/
/***/ (() => {

(()=>{let e=new function(){this.setProjectModal=function(e){switch(projectPicture.innerHTML="",projectNameInfo.innerHTML=e.proj_name,projectUserName.innerHTML=e.name,projectLastUpdateDate.textContent=e.last_update_date.substring(0,10),Array.isArray(e.loc)&&(e.loc.length>1&&e.module_type.find((function(e){return"gps"==e}))?(console.log("vrUI.js: showProjectInfo: project with gps ",e,"\n",e.loc[0]+", "+e.loc[1]),projectGPSDiv.style.display="block",projectGPSDivEndLine.style.display="block",projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent="wait for GPS",projectGPSInfo.textContent=e.loc[0]+", "+e.loc[1],navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){console.log("vrUI.js: showProjectInfo: geoPosition = ",t.coords.latitude,t.coords.longitude);let o=function(e,t,o,n,s="M"){if(e==o&&t==n)return 0;{let r=Math.PI*e/180,l=Math.PI*o/180,a=r-l,i=Math.PI*t/180-Math.PI*n/180,c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(r)*Math.cos(l)*Math.pow(Math.sin(i/2),2)));return"M"==s&&(c*=6378137),console.log("vrUI.js: calculateGeosToDistanceHaversine dist=",c),c}}(t.coords.latitude,t.coords.longitude,e.loc[0],e.loc[1]);projectGPSInfo.textContent=e.loc[0]+", "+e.loc[1]+", dist="+Math.floor(o),getViewerConfig(serverUrl,(function(e){o<e.data.gps_range_distance?(projectStartButton.style.pointerEvents="auto",startBGImage.style.display="inline",startTitle.textContent=parent.htmlContent.modalButtonStart[parent.languageType]):(projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent=parent.htmlContent.modalButtonDisable[parent.languageType])}))}),(function(e){console.warn("vrUI.js: showProjectInfo: e=",e.code,e.message),projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent="GPS error"}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(console.log("vrUI.js: showProjectInfo: Geolocation is not supported by this browser."),console.warn("vrUI.js: showProjectInfo: not allow GPS "),projectStartButton.style.pointerEvents="none",startBGImage.style.display="none",startTitle.textContent="GPS not support")):(projectGPSDiv.style.display="none",projectGPSDivEndLine.style.display="none",projectStartButton.style.pointerEvents="auto",startBGImage.style.display="inline",startTitle.textContent=parent.htmlContent.modalButtonStart[parent.languageType])),e.proj_type){case"ar":projectTypeInfo.innerHTML="AR 圖像辨識",projectUsageInfo.innerHTML="掃描辨識圖即可觀賞AR",scanList.style.display="block",getARProjsByProjID([e.proj_id],(function(e){let t=e.data.result[0].targets_img_urls;if(Array.isArray(t)){scanList.style.display="block",scanListEndLine.style.display="block";for(let e=0;e<t.length;e++){let o=document.createElement("img");o.src=t[e],projectPicture.appendChild(o)}}else scanList.style.display="none",scanListEndLine.style.display="none"})),projectStartButton.onclick=function(){console.log("UI.js: vr to ar, click"),leavedSendLog(),parent.aUI.startCoreIframe(e,!0)};break;case"vr":projectTypeInfo.innerHTML="VR 虛擬實境",projectUsageInfo.innerHTML="開啟專案即可觀賞VR",projectPicture.style.display="none",scanList.style.display="none",scanListEndLine.style.display="none",projectStartButton.onclick=function(){console.log("UI.js: vr to vr, click"),document.getElementById("snapshot_"+parent.selectedProject.proj_id).className="circular--square",leavedSendLog(),parent.aUI.startCoreIframe(e,!1);for(let t=0;t<publishVRProjs.result.length;t++)if(publishVRProjs.result[t].proj_id==e.proj_id){console.log("UI.js: _setProjectModal: activeVRScenes: i=",t),document.getElementById("snapshot_"+e.proj_id).className="circular--square-marker",projectModal.style.display="none",activeVRScenes(t);break}};break;case"ar_slam":projectTypeInfo.innerHTML="AR 空間辨識",projectUsageInfo.innerHTML="開啟專案即可觀賞XR",projectPicture.style.display="none",scanList.style.display="none",scanListEndLine.style.display="none",projectStartButton.onclick=function(){console.log("UI.js: vr to xr, click"),leavedSendLog(),parent.aUI.startCoreIframe(e,!0)}}var t=projectStartButton.offsetTop-projectDescriptionDiv.offsetTop-projectDescriptionTitle.offsetHeight-10;projectDescription.style.height=t+"px",projectDescription.textContent=e.proj_descr},this.cleanProjectModal=function(){},this.setProjectTable=function(){let t=document.getElementById("projsTable"),o=t.rows.proj_snapshot,n=t.rows.proj_name,s=o.children.length,r=n.children.length;for(let e=0;e<s;e++)o.deleteCell(0);for(let e=0;e<r;e++)n.deleteCell(0);if(userPublishProjs){let t=0;for(let s=0;s<userPublishProjs.proj_list.length;s++){if(parent.useEditorWebTag&&!userPublishProjs.proj_list[s].proj_platform.find((e=>"web"==e)))continue;window.allowedMakarIDUseWeb;let r=n.insertCell(t);r.style.paddingLeft=0==t?"16px":"8px";let l=document.createElement("div");l.innerText=userPublishProjs.proj_list[s].proj_name,l.className="projNameOneRow",r.appendChild(l);let a=o.insertCell(t);a.className="snapShotCell",a.style.paddingLeft=0==t?"16px":"8px",1==window.allowedMakarIDUseWeb||1==userPublishProjs.proj_list[s].web_ar||(a.style.opacity=.5,a.style.pointerEvents="none",l.style.opacity=.5,l.style.pointerEvents="none");let i=document.createElement("img");i.src=userPublishProjs.proj_list[s].snapshot_url,i.width=50,i.height=50,i.className="circular--square",i.setAttribute("id","snapshot_"+userPublishProjs.proj_list[s].proj_id),userPublishProjs.proj_list[s].proj_id==parent.selectedProject.proj_id&&(i.className="circular--square-marker"),i.onclick=function(){1==window.allowedMakarIDUseWeb||1==userPublishProjs.proj_list[s].web_ar?(console.log("UI.js: _img click, switch project( allow ) ",window.allowedMakarIDUseWeb,userPublishProjs.proj_list[s].web_ar),projectModal.style.display="block",e.setProjectModal(userPublishProjs.proj_list[s])):console.log("UI.js: _img click, switch project( denied ) ",window.allowedMakarIDUseWeb,userPublishProjs.proj_list[s].web_ar)},a.appendChild(i),t++}let s=n.insertCell(0);s.style.paddingLeft="25px",s.style.paddingRight="15px",s.style.borderRight="1px solid white";let r=document.createElement("div");r.innerText="作者頁面",r.className="projNameOneRow",s.appendChild(r);let l=o.insertCell(0);l.style.paddingLeft="25px",l.style.paddingRight="15px",l.style.borderRight="1px solid white";let a=document.createElement("img");getOneUserInfo(window.serverUrl,userPublishProjs.proj_list[0].user_id,["head_pic"],(function(e){""!=e.data.head_pic?a.src=e.data.head_pic:a.src="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/icon/me2.png"})),a.style.borderRadius="50%",a.width=50,a.height=50,l.appendChild(a)}}}})();

/***/ }),

/***/ "./lib/testWebpack/aframe-v1.0.4.min.js":
/*!**********************************************!*\
  !*** ./lib/testWebpack/aframe-v1.0.4.min.js ***!
  \**********************************************/
/***/ (() => {

/*! For license information please see aframe-v1.0.4.min.js.LICENSE.txt */
(()=>{var t={858:()=>{THREE.TGALoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TGALoader.prototype={constructor:THREE.TGALoader,load:function(e,t,i,n){var r=this,o=new THREE.Texture,a=new THREE.FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,(function(e){o.image=r.parse(e),o.needsUpdate=!0,console.log(" tttttttttt ",o),void 0!==t&&t(o)}),i,n),o},checkHeader:function(e,t){var i=this,n=new THREE.FileLoader(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(e,(function(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var n=new Uint8Array(e),r=0,o={id_length:n[r++],colormap_type:n[r++],image_type:n[r++],colormap_index:n[r++]|n[r++]<<8,colormap_length:n[r++]|n[r++]<<8,colormap_size:n[r++],origin:[n[r++]|n[r++]<<8,n[r++]|n[r++]<<8],width:n[r++]|n[r++]<<8,height:n[r++]|n[r++]<<8,pixel_size:n[r++],flags:n[r++]};let a=i.tgaCheckHeader(o);t(a)}))},checkHeaderByBuffer:function(e){return offset=0,header={id_length:e[offset++],colormap_type:e[offset++],image_type:e[offset++],colormap_index:e[offset++]|e[offset++]<<8,colormap_length:e[offset++]|e[offset++]<<8,colormap_size:e[offset++],origin:[e[offset++]|e[offset++]<<8,e[offset++]|e[offset++]<<8],width:e[offset++]|e[offset++]<<8,height:e[offset++]|e[offset++]<<8,pixel_size:e[offset++],flags:e[offset++]},this.tgaCheckHeader(header)},tgaCheckHeader:function(e){let t=!0;switch(e.image_type){case 1:case 9:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&(t=!1);break;case 2:case 3:case 10:case 11:e.colormap_type&&(t=!1);break;case 0:console.error("THREE.TGALoader: No data."),t=!1;default:t=!1}return(e.width<=0||e.height<=0)&&(t=!1),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&(t=!1),t},parse:function(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var t=new Uint8Array(e),i=0,n={id_length:t[i++],colormap_type:t[i++],image_type:t[i++],colormap_index:t[i++]|t[i++]<<8,colormap_length:t[i++]|t[i++]<<8,colormap_size:t[i++],origin:[t[i++]|t[i++]<<8,t[i++]|t[i++]<<8],width:t[i++]|t[i++]<<8,height:t[i++]|t[i++]<<8,pixel_size:t[i++],flags:t[i++]};!function(e){switch(e.image_type){case 1:case 9:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(n),n.id_length+i>e.length&&console.error("THREE.TGALoader: No data."),i+=n.id_length;var r=!1,o=!1,a=!1;switch(n.image_type){case 9:r=!0,o=!0;break;case 1:o=!0;break;case 10:r=!0;break;case 2:break;case 11:r=!0,a=!0;break;case 3:a=!0}console.log(" TGALoader.js: _parse: ",n);var s=document.createElement("canvas");s.width=n.width,s.height=n.height;var l=s.getContext("2d"),c=l.createImageData(n.width,n.height),h=function(e,t,i,n,r){var o,a,s,l;if(s=i.width*i.height*(a=i.pixel_size>>3),t&&(l=r.subarray(n,n+=i.colormap_length*(i.colormap_size>>3))),e){var c,h,u;o=new Uint8Array(s);for(var d=0,p=new Uint8Array(a);d<s;)if(h=1+(127&(c=r[n++])),128&c){for(u=0;u<a;++u)p[u]=r[n++];for(u=0;u<h;++u)o.set(p,d+u*a);d+=a*h}else{for(h*=a,u=0;u<h;++u)o[d+u]=r[n++];d+=h}}else o=r.subarray(n,n+=t?i.width*i.height:s);return{pixel_data:o,palettes:l}}(r,o,n,i,t);return function(e,t,i,r,o){var s,l,c,h,u,d;switch((48&n.flags)>>4){default:case 2:s=0,c=1,u=t,l=0,h=1,d=i;break;case 0:s=0,c=1,u=t,l=i-1,h=-1,d=-1;break;case 3:s=t-1,c=-1,u=-1,l=0,h=1,d=i;break;case 1:s=t-1,c=-1,u=-1,l=i-1,h=-1,d=-1}if(a)switch(n.pixel_size){case 8:!function(e,t,i,r,o,a,s,l){var c,h,u,d=0,p=n.width;for(u=t;u!==r;u+=i)for(h=o;h!==s;h+=a,d++)c=l[d],e[4*(h+p*u)+0]=c,e[4*(h+p*u)+1]=c,e[4*(h+p*u)+2]=c,e[4*(h+p*u)+3]=255}(e,l,h,d,s,c,u,r);break;case 16:!function(e,t,i,r,o,a,s,l){var c,h,u=0,d=n.width;for(h=t;h!==r;h+=i)for(c=o;c!==s;c+=a,u+=2)e[4*(c+d*h)+0]=l[u+0],e[4*(c+d*h)+1]=l[u+0],e[4*(c+d*h)+2]=l[u+0],e[4*(c+d*h)+3]=l[u+1]}(e,l,h,d,s,c,u,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(n.pixel_size){case 8:!function(e,t,i,r,o,a,s,l,c){var h,u,d,p=c,f=0,m=n.width;for(d=t;d!==r;d+=i)for(u=o;u!==s;u+=a,f++)h=l[f],e[4*(u+m*d)+3]=255,e[4*(u+m*d)+2]=p[3*h+0],e[4*(u+m*d)+1]=p[3*h+1],e[4*(u+m*d)+0]=p[3*h+2]}(e,l,h,d,s,c,u,r,o);break;case 16:!function(e,t,i,r,o,a,s,l){var c,h,u,d=0,p=n.width;for(u=t;u!==r;u+=i)for(h=o;h!==s;h+=a,d+=2)c=l[d+0]+(l[d+1]<<8),e[4*(h+p*u)+0]=(31744&c)>>7,e[4*(h+p*u)+1]=(992&c)>>2,e[4*(h+p*u)+2]=(31&c)>>3,e[4*(h+p*u)+3]=32768&c?0:255}(e,l,h,d,s,c,u,r);break;case 24:!function(e,t,i,r,o,a,s,l){var c,h,u=0,d=n.width;for(h=t;h!==r;h+=i)for(c=o;c!==s;c+=a,u+=3)e[4*(c+d*h)+3]=255,e[4*(c+d*h)+2]=l[u+0],e[4*(c+d*h)+1]=l[u+1],e[4*(c+d*h)+0]=l[u+2]}(e,l,h,d,s,c,u,r);break;case 32:!function(e,t,i,r,o,a,s,l){var c,h,u=0,d=n.width;for(h=t;h!==r;h+=i)for(c=o;c!==s;c+=a,u+=4)e[4*(c+d*h)+2]=l[u+0],e[4*(c+d*h)+1]=l[u+1],e[4*(c+d*h)+0]=l[u+2],e[4*(c+d*h)+3]=l[u+3]}(e,l,h,d,s,c,u,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(c.data,n.width,n.height,h.pixel_data,h.palettes),l.putImageData(c,0,0),s},setPath:function(e){return this.path=e,this}}},989:()=>{!function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[a]={exports:{}};t[a][0].call(c.exports,(function(e){return r(t[a][1][e]||e)}),c,c.exports,e,t,i,n)}return i[a].exports}for(var o=void 0,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,i){"use strict";e("./")},{"./":2}],2:[function(e,t,i){"use strict";e("./src/controls"),e("./src/loaders"),e("./src/misc"),e("./src/pathfinding"),e("./src/primitives")},{"./src/controls":14,"./src/loaders":23,"./src/misc":28,"./src/pathfinding":34,"./src/primitives":42}],3:[function(e,t,i){"use strict";t.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,i,n){var r=this,o=void 0===r.path?THREE.LoaderUtils.extractUrlBase(e):r.path,a=new THREE.FileLoader(r.manager);a.setPath(r.path),a.load(e,(function(e){t(r.parse(e,o))}),i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(e,t){for(var i=[],n=e.childNodes,r=0,o=n.length;r<o;r++){var a=n[r];a.nodeName===t&&i.push(a)}return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,r=t.length;n<r;n++)i[n]=t[n];return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,r=t.length;n<r;n++)i[n]=parseFloat(t[n]);return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,r=t.length;n<r;n++)i[n]=parseInt(t[n]);return i}function a(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,n,r){var o=i(e,t)[0];if(void 0!==o)for(var a=i(o,n),s=0;s<a.length;s++)r(a[s])}function u(e,t){for(var i in e)e[i].build=t(e[i])}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType&&"input"===r.nodeName){var o=a(r.getAttribute("source")),s=r.getAttribute("semantic");t.inputs[s]=o}}return t}function f(e){var t={},i=e.getAttribute("target").split("/"),n=i.shift(),r=i.shift(),o=-1!==r.indexOf("("),s=-1!==r.indexOf(".");if(s)i=r.split("."),r=i.shift(),t.member=i.shift();else if(o){var l=r.split("(");r=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=r,t.arraySyntax=o,t.memberSyntax=s,t.sampler=a(e.getAttribute("source")),t}function m(e){var t=[],i=e.channels,n=e.samplers,r=e.sources;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],s=n[a.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;w(g(a,r[l],r[c]),t)}return t}function v(e){return d(Xe.animations[e],m)}function g(e,t,i){var n,r,o,a,s,l,c=Xe.nodes[e.id],h=ke(c.id),u=c.transforms[e.sid],d=c.matrix.clone().transpose(),p={};switch(u){case"matrix":for(o=0,a=t.array.length;o<a;o++)if(n=t.array[o],r=o*i.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=i.array[r],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(s=0,l=i.stride;s<l;s++)p[n][s]=i.array[r+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}var v=function(e,t){var i=[];for(var n in e)i.push({time:parseFloat(n),value:e[n]});i.sort((function(e,t){return e.time-t.time}));for(var r=0;r<16;r++)x(i,r,t.elements[r]);return i}(p,d);return{name:h.uuid,keyframes:v}}var y=new THREE.Vector3,b=new THREE.Vector3,A=new THREE.Quaternion;function w(e,t){for(var i=e.keyframes,n=e.name,r=[],o=[],a=[],s=[],l=0,c=i.length;l<c;l++){var h=i[l],u=h.time,d=h.value;_e.fromArray(d).transpose(),_e.decompose(y,A,b),r.push(u),o.push(y.x,y.y,y.z),a.push(A.x,A.y,A.z,A.w),s.push(b.x,b.y,b.z)}return o.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",r,o)),a.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",r,a)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",r,s)),t}function x(e,t,i){var n,r,o,a=!0;for(r=0,o=e.length;r<o;r++)void 0===(n=e[r]).value[t]?n.value[t]=null:a=!1;if(!0===a)for(r=0,o=e.length;r<o;r++)(n=e[r]).value[t]=i;else!function(e,t){for(var i,n,r=0,o=e.length;r<o;r++){var a=e[r];if(null===a.value[t]){if(i=E(e,r,t),n=_(e,r,t),null===i){a.value[t]=n.value[t];continue}if(null===n){a.value[t]=i.value[t];continue}M(a,i,n,t)}}}(e,t)}function E(e,t,i){for(;t>=0;){var n=e[t];if(null!==n.value[i])return n;t--}return null}function _(e,t,i){for(;t<e.length;){var n=e[t];if(null!==n.value[i])return n;t++}return null}function M(e,t,i,n){i.time-t.time!=0?e.value[n]=(e.time-t.time)*(i.value[n]-t.value[n])/(i.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function T(e){for(var t=[],i=e.name,n=e.end-e.start||-1,r=e.animations,o=0,a=r.length;o<a;o++)for(var s=v(r[o]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(i,n,t)}function S(e){return d(Xe.clips[e],T)}function C(e){for(var t={sources:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=r(o.textContent);break;case"source":var a=o.getAttribute("id");t.sources[a]=re(o);break;case"joints":t.joints=L(o);break;case"vertex_weights":t.vertexWeights=R(o)}}return t}function L(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType&&"input"===r.nodeName){var o=r.getAttribute("semantic"),s=a(r.getAttribute("source"));t.inputs[o]=s}}return t}function R(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var s=r.getAttribute("semantic"),l=a(r.getAttribute("source")),c=parseInt(r.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=o(r.textContent);break;case"v":t.v=o(r.textContent)}}return t}function D(e){var t={id:e.id},i=Xe.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,n,r={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,a=e.vertexWeights,s=a.vcount,l=a.v,c=a.inputs.JOINT.offset,h=a.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[a.inputs.WEIGHT.id].array,f=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(i=0;i<m;i++){var g=l[f+c],y=p[l[f+h]];v.push({index:g,weight:y}),f+=2}for(v.sort(x),i=0;i<4;i++){var b=v[i];void 0!==b?(r.indices.array.push(b.index),r.weights.array.push(b.weight)):(r.indices.array.push(0),r.weights.array.push(0))}}for(e.bindShapeMatrix?r.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():r.bindMatrix=(new THREE.Matrix4).identity(),t=0,n=u.array.length;t<n;t++){var A=u.array[t],w=(new THREE.Matrix4).fromArray(d.array,t*d.stride).transpose();r.joints.push({name:A,boneInverse:w})}return r;function x(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function P(e){return void 0!==e.build?e.build:e.init_from}function O(e){var t=Xe.images[e];return void 0!==t?d(t,P):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function I(e){for(var t={surfaces:{},samplers:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"newparam":k(r,t);break;case"technique":t.technique=F(r);break;case"extra":t.extra=V(r)}}return t}function k(e,t){for(var i=e.getAttribute("sid"),n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[i]=B(o);break;case"sampler2D":t.samplers[i]=N(o)}}}function B(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"init_from"===r.nodeName&&(t.init_from=r.textContent)}return t}function N(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"source"===r.nodeName&&(t.source=r.textContent)}return t}function F(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=H(r)}}return t}function H(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[r.nodeName]=U(r);break;case"transparent":t[r.nodeName]={opaque:r.getAttribute("opaque"),data:U(r)}}}return t}function U(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=r(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:j(o)}}}return t}function j(e){for(var t={technique:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"extra"===r.nodeName&&z(r,t)}return t}function z(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique"===r.nodeName&&G(r,t)}}function G(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent)}}}function V(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique"===r.nodeName&&(t.technique=W(r))}return t}function W(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"double_sided"===r.nodeName&&(t[r.nodeName]=parseInt(r.textContent))}return t}function q(e){return e}function X(e){var t,i,n=(t=e.url,d(Xe.effects[t],q)),r=n.profile.technique,o=n.profile.extra;switch(r.type){case"phong":case"blinn":i=new THREE.MeshPhongMaterial;break;case"lambert":i=new THREE.MeshLambertMaterial;break;default:i=new THREE.MeshBasicMaterial}function a(e){var t=n.profile.samplers[e.id],i=null;if(void 0!==t?i=O(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=O(e.id)),null!==i){var r=function(e){var t=e.slice(2+(e.lastIndexOf(".")-1>>>0));return"tga"===(t=t.toLowerCase())?Ue:Ge}(i);if(void 0!==r){var o=r.load(i),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===s(a.technique)){var l=a.technique;o.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.offset.set(l.offsetU||0,l.offsetV||0),o.repeat.set(l.repeatU||1,l.repeatV||1)}else o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}i.name=e.name;var l=r.parameters;for(var c in l){var h=l[c];switch(c){case"diffuse":h.color&&i.color.fromArray(h.color),h.texture&&(i.map=a(h.texture));break;case"specular":h.color&&i.specular&&i.specular.fromArray(h.color),h.texture&&(i.specularMap=a(h.texture));break;case"bump":h.texture&&(i.normalMap=a(h.texture));break;case"ambient":h.texture&&(i.lightMap=a(h.texture));break;case"shininess":h.float&&i.shininess&&(i.shininess=h.float);break;case"emission":h.color&&i.emissive&&i.emissive.fromArray(h.color),h.texture&&(i.emissiveMap=a(h.texture))}}var u=l.transparent,p=l.transparency;if(void 0===p&&u&&(p={float:1}),void 0===u&&p&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&p)if(u.data.texture)i.transparent=!0;else{var f=u.data.color;switch(u.opaque){case"A_ONE":i.opacity=f[3]*p.float;break;case"RGB_ZERO":i.opacity=1-f[0]*p.float;break;case"A_ZERO":i.opacity=1-f[3]*p.float;break;case"RGB_ONE":i.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}i.opacity<1&&(i.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(i.side=THREE.DoubleSide),i}function Y(e){return d(Xe.materials[e],X)}function K(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("technique_common"===i.nodeName)return Q(i)}return{}}function Q(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=Z(n)}}return t}function Z(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function J(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,n=e.optics.parameters.xmag,r=e.optics.parameters.aspect_ratio;n=void 0===n?i*r:n,i=void 0===i?n/r:i,n*=.5,i*=.5,t=new THREE.OrthographicCamera(-n,n,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function $(e){var t=Xe.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=r.nodeName,t.parameters=te(r)}}return t}function te(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var a=r(o.textContent);t.color=(new THREE.Color).fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function ie(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Xe.lights[e];return void 0!==t?d(t,ie):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function re(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=r(a.textContent);break;case"Name_array":t.array=n(a.textContent);break;case"technique_common":var s=i(a,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function oe(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&(t[n.getAttribute("semantic")]=a(n.getAttribute("source")))}return t}function ae(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var s=a(r.getAttribute("source")),l=r.getAttribute("semantic"),c=parseInt(r.getAttribute("offset")),h=parseInt(r.getAttribute("set")),u=h>0?l+h:l;t.inputs[u]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(r.textContent);break;case"p":t.p=o(r.textContent)}}return t}function se(e){for(var t=0,i=0,n=e.length;i<n;i++)!0===e[i].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},i=e.sources,n=e.vertices,r=e.primitives;if(0===r.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(r);for(var a in o){var s=o[a];se(s),t[a]=ce(s,i,n)}return t}function ce(e,t,i){for(var n={},r={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],h=[],u=new THREE.BufferGeometry,d=[],p=0,f=0;f<e.length;f++){var m=e[f],v=m.inputs,g=0;switch(m.type){case"lines":case"linestrips":g=2*m.count;break;case"triangles":g=3*m.count;break;case"polylist":for(var y=0;y<m.count;y++){var b=m.vcount[y];switch(b){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(b-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",m.type)}for(var A in u.addGroup(p,g,f),p+=g,m.material&&d.push(m.material),v){var w=v[A];switch(A){case"VERTEX":for(var x in i){var E=i[x];switch(x){case"POSITION":var _=r.array.length;if(he(m,t[E],w.offset,r.array),r.stride=t[E].stride,t.skinWeights&&t.skinIndices&&(he(m,t.skinIndices,w.offset,c),he(m,t.skinWeights,w.offset,h)),!1===m.hasUV&&!0===e.uvsNeedsFix){g=(r.array.length-_)/r.stride;for(var M=0;M<g;M++)a.array.push(0,0)}break;case"NORMAL":he(m,t[E],w.offset,o.array),o.stride=t[E].stride;break;case"COLOR":he(m,t[E],w.offset,l.array),l.stride=t[E].stride;break;case"TEXCOORD":he(m,t[E],w.offset,a.array),a.stride=t[E].stride;break;case"TEXCOORD1":he(m,t[E],w.offset,s.array),a.stride=t[E].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',x)}}break;case"NORMAL":he(m,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":he(m,t[w.id],w.offset,l.array),l.stride=t[w.id].stride;break;case"TEXCOORD":he(m,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"TEXCOORD1":he(m,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return r.array.length>0&&u.addAttribute("position",new THREE.Float32BufferAttribute(r.array,r.stride)),o.array.length>0&&u.addAttribute("normal",new THREE.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&u.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&u.addAttribute("uv",new THREE.Float32BufferAttribute(a.array,a.stride)),s.array.length>0&&u.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&u.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,4)),h.length>0&&u.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h,4)),n.data=u,n.type=e[0].type,n.materialKeys=d,n}function he(e,t,i,n){var r=e.p,o=e.stride,a=e.vcount;function s(e){for(var t=r[e+i]*c,o=t+c;t<o;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var h=0,u=0,d=a.length;u<d;u++){var p=a[u];if(4===p){var f=h+1*o,m=h+2*o,v=h+3*o;s(h+0*o),s(f),s(v),s(f),s(m),s(v)}else if(3===p)f=h+1*o,m=h+2*o,s(h+0*o),s(f),s(m);else if(p>4)for(var g=1,y=p-2;g<=y;g++)f=h+o*g,m=h+o*(g+1),s(h+0*o),s(f),s(m);h+=o*p}else for(u=0,d=r.length;u<d;u+=o)s(u)}function ue(e){return d(Xe.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function pe(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=fe(n);break;case"link":t.links.push(ve(n))}}}function fe(e){for(var t,i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=r(n.textContent);t.axis.fromArray(o);break;case"limits":var a=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(a.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},i=r(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(i),t.angle=THREE.Math.degToRad(i[3])}return t}function be(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"technique_common"===n.nodeName&&Ae(n,t)}}function Ae(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=r(n.textContent);break;case"mass":t.mass=r(n.textContent)[0]}}}function we(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType&&"axis"===n.nodeName){var r=n.getElementsByTagName("param")[0];t.axis=r.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function xe(e){return void 0!==e.build?e.build:e}function Ee(e){for(var t=[],i=Fe.querySelector('[id="'+e.id+'"]'),n=0;n<i.childNodes.length;n++){var o=i.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"matrix":var a=r(o.textContent),s=(new THREE.Matrix4).fromArray(a).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:s});break;case"translate":case"scale":a=r(o.textContent);var l=(new THREE.Vector3).fromArray(a);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":a=r(o.textContent),l=(new THREE.Vector3).fromArray(a);var c=THREE.Math.degToRad(a[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:c})}}return t}var _e=new THREE.Matrix4,Me=new THREE.Vector3;function Te(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Te(n);break;case"instance_camera":t.instanceCameras.push(a(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Se(n));break;case"instance_light":t.instanceLights.push(a(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Se(n));break;case"instance_node":t.instanceNodes.push(a(n.getAttribute("url")));break;case"matrix":var o=r(n.textContent);t.matrix.multiply(_e.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=r(n.textContent),Me.fromArray(o),t.matrix.multiply(_e.makeTranslation(Me.x,Me.y,Me.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=r(n.textContent);var s=THREE.Math.degToRad(o[3]);t.matrix.multiply(_e.makeRotationAxis(Me.fromArray(o),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=r(n.textContent),t.matrix.scale(Me.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Ie(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Xe.nodes[t.id]=t,t}function Se(e){for(var t={id:a(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"bind_material":for(var r=n.getElementsByTagName("instance_material"),o=0;o<r.length;o++){var s=r[o],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=a(c)}break;case"skeleton":t.skeletons.push(a(n.textContent))}}return t}function Ce(e,t){var i,n,r,o=[],a=[];for(i=0;i<e.length;i++){var s=e[i];if(Ie(s))Le(ke(s),t,o);else if(r=s,void 0!==Xe.visualScenes[r])for(var l=Xe.visualScenes[s].children,c=0;c<l.length;c++){var h=l[c];"JOINT"===h.type&&Le(ke(h.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(i=0;i<t.length;i++)for(c=0;c<o.length;c++)if((n=o[c]).bone.name===t[i].name){a[i]=n,n.processed=!0;break}for(i=0;i<o.length;i++)!1===(n=o[i]).processed&&(a.push(n),n.processed=!0);var u=[],d=[];for(i=0;i<a.length;i++)n=a[i],u.push(n.bone),d.push(n.boneInverse);return new THREE.Skeleton(u,d)}function Le(e,t,i){e.traverse((function(e){if(!0===e.isBone){for(var n,r=0;r<t.length;r++){var o=t[r];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),i.push({bone:e,boneInverse:n,processed:!1})}}))}function Re(e){for(var t,i=[],n=e.matrix,r=e.nodes,o=e.type,a=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,h=e.instanceNodes,u=0,p=r.length;u<p;u++)i.push(ke(r[u]));for(u=0,p=a.length;u<p;u++){var f=$(a[u]);null!==f&&i.push(f.clone())}for(u=0,p=s.length;u<p;u++)for(var m=s[u],v=(t=m.id,d(Xe.controllers[t],D)),g=Oe(ue(v.id),m.materials),y=Ce(m.skeletons,v.skin.joints),b=0,A=g.length;b<A;b++){var w;(w=g[b]).isSkinnedMesh&&(w.bind(y,v.skin.bindMatrix),w.normalizeSkinWeights()),i.push(w)}for(u=0,p=l.length;u<p;u++){var x=ne(l[u]);null!==x&&i.push(x.clone())}for(u=0,p=c.length;u<p;u++)for(b=0,A=(g=Oe(ue((m=c[u]).id),m.materials)).length;b<A;b++)i.push(g[b]);for(u=0,p=h.length;u<p;u++)i.push(ke(h[u]).clone());if(0===r.length&&1===i.length)w=i[0];else for(w="JOINT"===o?new THREE.Bone:new THREE.Group,u=0;u<i.length;u++)w.add(i[u]);return""===w.name&&(w.name="JOINT"===o?e.sid:e.name),w.matrix.copy(n),w.matrix.decompose(w.position,w.quaternion,w.scale),w}var De=new THREE.MeshBasicMaterial({color:16711935});function Pe(e,t){for(var i=[],n=0,r=e.length;n<r;n++){var o=t[e[n]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),i.push(De)):i.push(Y(o))}return i}function Oe(e,t){var i=[];for(var n in e){var r=e[n],o=Pe(r.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new THREE.LineBasicMaterial):o.push(new THREE.MeshPhongMaterial));var a=void 0!==r.data.attributes.skinIndex;if(a)for(var s=0,l=o.length;s<l;s++)o[s].skinning=!0;var c,h=1===o.length?o[0]:o;switch(n){case"lines":c=new THREE.LineSegments(r.data,h);break;case"linestrips":c=new THREE.Line(r.data,h);break;case"triangles":case"polylist":c=a?new THREE.SkinnedMesh(r.data,h):new THREE.Mesh(r.data,h)}i.push(c)}return i}function Ie(e){return void 0!==Xe.nodes[e]}function ke(e){return d(Xe.nodes[e],Re)}function Be(e){var t=new THREE.Group;t.name=e.name;for(var i=e.children,n=0;n<i.length;n++){var r=i[n];t.add(ke(r.id))}return t}function Ne(e){return d(Xe.visualScenes[e],Be)}if(0===e.length)return{scene:new THREE.Scene};var Fe=i((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],He=Fe.getAttribute("version");console.log("THREE.ColladaLoader: File version",He);var Ue,je,ze=(je=i(Fe,"asset")[0],{unit:l(i(je,"unit")[0]),upAxis:c(i(je,"up_axis")[0])}),Ge=new THREE.TextureLoader(this.manager);Ge.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ue=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ve=[],We={},qe=0,Xe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Fe,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,n=e.childNodes.length;i<n;i++){var r,o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"source":r=o.getAttribute("id"),t.sources[r]=re(o);break;case"sampler":r=o.getAttribute("id"),t.samplers[r]=p(o);break;case"channel":r=o.getAttribute("target"),t.channels[r]=f(o);break;default:console.log(o)}}Xe.animations[e.getAttribute("id")]=t})),h(Fe,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"instance_animation"===r.nodeName&&t.animations.push(a(r.getAttribute("url")))}Xe.clips[e.getAttribute("id")]=t})),h(Fe,"library_controllers","controller",(function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"skin":t.id=a(r.getAttribute("source")),t.skin=C(r);break;case"morph":t.id=a(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Xe.controllers[e.getAttribute("id")]=t})),h(Fe,"library_images","image",(function(e){var t={init_from:i(e,"init_from")[0].textContent};Xe.images[e.getAttribute("id")]=t})),h(Fe,"library_effects","effect",(function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"profile_COMMON"===r.nodeName&&(t.profile=I(r))}Xe.effects[e.getAttribute("id")]=t})),h(Fe,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"instance_effect"===r.nodeName&&(t.url=a(r.getAttribute("url")))}Xe.materials[e.getAttribute("id")]=t})),h(Fe,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"optics"===r.nodeName&&(t.optics=K(r))}Xe.cameras[e.getAttribute("id")]=t})),h(Fe,"library_lights","light",(function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique_common"===r.nodeName&&(t=ee(r))}Xe.lights[e.getAttribute("id")]=t})),h(Fe,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=i(e,"mesh")[0];if(void 0!==n){for(var r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[a]=re(o);break;case"vertices":t.vertices=oe(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ae(o));break;default:console.log(o)}}}Xe.geometries[e.getAttribute("id")]=t}})),h(Fe,"library_nodes","node",Te),h(Fe,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var n=t[i];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+qe++)}}(e);for(var n=i(e,"node"),r=0;r<n.length;r++)t.children.push(Te(n[r]));Xe.visualScenes[e.getAttribute("id")]=t})),h(Fe,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"technique_common"===n.nodeName&&pe(n,t)}Xe.kinematicsModels[e.getAttribute("id")]=t})),h(Fe,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"rigid_body"===n.nodeName&&(t.rigidBodies[n.getAttribute("name")]={},be(n,t.rigidBodies[n.getAttribute("name")]))}Xe.physicsModels[e.getAttribute("id")]=t})),h(Fe,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"bind_joint_axis"===n.nodeName&&t.bindJointAxis.push(we(n))}Xe.kinematicsScenes[a(e.getAttribute("url"))]=t})),u(Xe.animations,m),u(Xe.clips,T),u(Xe.controllers,D),u(Xe.images,P),u(Xe.effects,q),u(Xe.materials,X),u(Xe.cameras,J),u(Xe.lights,ie),u(Xe.geometries,le),u(Xe.visualScenes,Be),function(){var e=Xe.clips;if(!0===s(e)){if(!1===s(Xe.animations)){var t=[];for(var i in Xe.animations)for(var n=v(i),r=0,o=n.length;r<o;r++)t.push(n[r]);Ve.push(new THREE.AnimationClip("default",-1,t))}}else for(var i in e)Ve.push(S(i))}(),function(){var e=Object.keys(Xe.kinematicsModels)[0],t=Object.keys(Xe.kinematicsScenes)[0],i=Object.keys(Xe.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,r=(n=e,d(Xe.kinematicsModels[n],de)),o=function(e){return d(Xe.kinematicsScenes[e],xe)}(t),a=Ne(i),s=o.bindJointAxis,l={},c=0,h=s.length;c<h;c++){var u=s[c],p=Fe.querySelector('[sid="'+u.target+'"]');if(p){var f=p.parentElement;v(u.jointIndex,f)}}var m=new THREE.Matrix4;We={joints:r&&r.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=l[e];if(i){var n=i.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var r=i.object,o=n.axis,a=i.transforms;_e.identity();for(var s=0;s<a.length;s++){var c=a[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":_e.multiply(m.makeRotationAxis(o,THREE.Math.degToRad(t)));break;case"prismatic":_e.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":_e.multiply(c.obj);break;case"translate":_e.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":_e.scale(c.obj);break;case"rotate":_e.multiply(m.makeRotationAxis(c.obj,c.angle))}}r.matrix.copy(_e),r.matrix.decompose(r.position,r.quaternion,r.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var i=t.getAttribute("name"),n=r.joints[e];a.traverse((function(r){r.name===i&&(l[e]={object:r,transforms:Ee(t),joint:n,position:n.zeroPosition})}))}}();var Ye=function(e){return Ne(a(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Fe,"scene")[0]);return"Z_UP"===ze.upAxis&&Ye.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ye.scale.multiplyScalar(ze.unit),{animations:Ve,kinematics:We,library:Xe,scene:Ye}}}},{}],4:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"function"==typeof Symbol&&n(Symbol.iterator),t.exports=THREE.FBXLoader=function(){var e,t,i;function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function r(e){this.textureLoader=e}function o(){}function a(){}function s(){}function l(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function u(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}n.prototype={constructor:n,crossOrigin:"anonymous",load:function(e,t,i,n){var r=this,o=void 0===r.path?THREE.LoaderUtils.extractUrlBase(e):r.path,a=new THREE.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,(function(i){try{t(r.parse(i,o))}catch(t){setTimeout((function(){n&&n(t),r.manager.itemError(e)}),0)}}),i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,i){if(a="Kaydara FBX Binary  \0",(o=t).byteLength>=21&&a===A(o,0,21))e=(new l).parse(t);else{var n=A(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function n(t){var n=e[t-1];return e=e.slice(i+t),i++,n}for(var r=0;r<t.length;++r)if(n(1)===t[r])return!1;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(u(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+u(n));e=(new s).parse(n)}var o,a;return new r(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin)).parse(e)}},r.prototype={constructor:r,parse:function(){t=this.parseConnections();var n=this.parseImages(),r=this.parseTextures(n),a=this.parseMaterials(r),s=this.parseDeformers(),l=(new o).parse(s);return this.parseScene(s,l,a),e&&e.FBXHeaderExtension&&e.FBXHeaderExtension.SceneInfo&&e.FBXHeaderExtension.SceneInfo["LastSaved|ApplicationName"]&&(i["LastSaved|ApplicationName"]||(i["LastSaved|ApplicationName"]=e.FBXHeaderExtension.SceneInfo["LastSaved|ApplicationName"])),e&&e.GlobalSettings&&e.GlobalSettings.OriginalUnitScaleFactor&&e.GlobalSettings.OriginalUnitScaleFactor.value&&(i.OriginalUnitScaleFactor||(i.OriginalUnitScaleFactor=e.GlobalSettings.OriginalUnitScaleFactor.value)),i},parseConnections:function(){var t=new Map;return"Connections"in e&&e.Connections.connections.forEach((function(e){var i=e[0],n=e[1],r=e[2];t.has(i)||t.set(i,{parents:[],children:[]});var o={ID:n,relationship:r};t.get(i).parents.push(o),t.has(n)||t.set(n,{parents:[],children:[]});var a={ID:i,relationship:r};t.get(n).children.push(a)})),t},parseImages:function(){var t={},i={};if("Video"in e.Objects){var n=e.Objects.Video;for(var r in n){var o=n[r];if(t[c=parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){var a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,s="string"==typeof o.Content&&""!==o.Content;if(a||s){var l=this.parseImage(n[r]);i[o.RelativeFilename||o.Filename]=l}}}}for(var c in t){var h=t[c];void 0!==i[h]?t[c]=i[h]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,i=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");if(null===THREE.Loader.Handlers.get(".tga")){var o=new THREE.TGALoader;o.setPath(this.textureLoader.path),THREE.Loader.Handlers.add(/\.tga$/i,o)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var i=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var r in n){var o=this.parseTexture(n[r],t);i.set(parseInt(r),o)}}return i},parseTexture:function(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var n=e.WrapModeU,r=e.WrapModeV,o=void 0!==n?n.value:0,a=void 0!==r?r.value:0;if(i.wrapS=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,i.wrapT=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;i.repeat.x=s[0],i.repeat.y=s[1]}return i},loadTexture:function(e,i){var n,r,o=this.textureLoader.path,a=t.get(e.id).children;void 0!==a&&a.length>0&&void 0!==i[a[0].ID]&&(0!==(n=i[a[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=THREE.Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),r=new THREE.Texture):r=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),r=new THREE.Texture):r=this.textureLoader.load(n);return this.textureLoader.setPath(o),r},parseMaterials:function(t){var i=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var r in n){var o=this.parseMaterial(n[r],t);null!==o&&i.set(parseInt(r),o)}}return i},parseMaterial:function(e,i){var n=e.id,r=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(n))return null;var a,s=this.parseParameters(e,i,n);switch(o.toLowerCase()){case"phong":a=new THREE.MeshPhongMaterial;break;case"lambert":a=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new THREE.MeshPhongMaterial({color:3342591})}return a.setValues(s),a.name=r,a},parseParameters:function(e,i,n){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(r.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(r.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var o=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":r.bumpMap=o.getTexture(i,e.ID);break;case"DiffuseColor":r.map=o.getTexture(i,e.ID);break;case"DisplacementColor":r.displacementMap=o.getTexture(i,e.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(i,e.ID);break;case"NormalMap":r.normalMap=o.getTexture(i,e.ID);break;case"ReflectionColor":r.envMap=o.getTexture(i,e.ID),r.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":r.specularMap=o.getTexture(i,e.ID);break;case"TransparentColor":r.alphaMap=o.getTexture(i,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),r},getTexture:function(i,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),i.get(n)},parseDeformers:function(){var i={},n={};if("Deformer"in e.Objects){var r=e.Objects.Deformer;for(var o in r){var a=r[o],s=t.get(parseInt(o));if("Skin"===a.attrType){var l=this.parseSkeleton(s,r);l.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,i[o]=l}else if("BlendShape"===a.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(s,r),c.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[o]=c}}}return{skeletons:i,morphTargets:n}},parseSkeleton:function(e,t){var i=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var r={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(r.indices=n.Indexes.a,r.weights=n.Weights.a),i.push(r)}})),{rawBones:i,bones:[]}},parseMorphTargets:function(e,i){for(var n=[],r=0;r<e.children.length;r++){var o=e.children[r],a=i[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;t.get(parseInt(o.ID)).children.forEach((function(e){void 0===e.relationship&&(s.geoID=e.ID)})),n.push(s)}return n},parseScene:function(n,r,o){i=new THREE.Group;var s=this.parseModels(n.skeletons,r,o),l=e.Objects.Model,c=this;s.forEach((function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var i=s.get(t.ID);void 0!==i&&i.add(e)})),null===e.parent&&i.add(e)})),this.bindSkeleton(n.skeletons,r,s),this.createAmbientLight(),this.setupMorphMaterials(),i.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix(t)}}));var h=(new a).parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=h,i=i.children[0]),i.animations=h},parseModels:function(i,n,r){var o=new Map,a=e.Objects.Model;for(var s in a){var l=parseInt(s),c=a[s],h=t.get(l),u=this.buildSkeleton(h,i,l,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,n,r);break;case"NurbsCurve":u=this.createCurve(h,n);break;case"LimbNode":case"Root":u=new THREE.Bone;break;default:u=new THREE.Group}u.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),u.ID=l}this.getTransformData(u,c),o.set(l,u)}return o},buildSkeleton:function(e,t,i,n){var r=null;return e.parents.forEach((function(e){for(var o in t){var a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){var s=r;(r=new THREE.Bone).matrixWorld.copy(t.transformLink),r.name=THREE.PropertyBinding.sanitizeNodeName(n),r.ID=i,a.bones[o]=r,null!==s&&r.add(s)}}))}})),r},createCamera:function(t){var i,n;if(t.children.forEach((function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)})),void 0===n)i=new THREE.Object3D;else{var r=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(r=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var c=s/l,h=45;void 0!==n.FieldOfView&&(h=n.FieldOfView.value);var u=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:i=new THREE.PerspectiveCamera(h,c,o,a),null!==u&&i.setFocalLength(u);break;case 1:i=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),i=new THREE.Object3D}}return i},createLight:function(t){var i,n;if(t.children.forEach((function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)})),void 0===n)i=new THREE.Object3D;else{var r;r=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new THREE.Color).fromArray(n.Color.value));var a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);var s=0;switch(void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),r){case 0:i=new THREE.PointLight(o,a,s,1);break;case 1:i=new THREE.DirectionalLight(o,a);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),i=new THREE.SpotLight(o,a,s,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),i=new THREE.PointLight(o,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(i.castShadow=!0)}return i},createMesh:function(e,t,i){var n,r=null,o=null,a=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),i.has(e.ID)&&a.push(i.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new THREE.MeshPhongMaterial({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach((function(e){e.vertexColors=THREE.VertexColors})),r.FBX_Deformer?(a.forEach((function(e){e.skinning=!0})),n=new THREE.SkinnedMesh(r,o)):n=new THREE.Mesh(r,o),n},createCurve:function(e,t){var i=e.children.reduce((function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e}),null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(i,n)},getTransformData:function(e,t){var i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder="RotationOrder"in t?y(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i},setLookAtProperties:function(n,r){"LookAtProperty"in r&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var r=e.Objects.Model[t.ID];if("Lcl_Translation"in r){var o=r.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(o),i.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(o))}}}))},bindSkeleton:function(e,i,n){var r=this.parsePoseNodes();for(var o in e){var a=e[o];t.get(parseInt(a.ID)).parents.forEach((function(e){if(i.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(a.bones),r[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var i=e.Objects.Pose;for(var n in i)if("BindPose"===i[n].attrType){var r=i[n].PoseNode;Array.isArray(r)?r.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[r.Node]=(new THREE.Matrix4).fromArray(r.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,i=t[0],n=t[1],r=t[2];0===i&&0===n&&0===r||new THREE.Color(i,n,r)}},setupMorphMaterials:function(){var e=this;i.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(i,n){e.setupMorphMaterial(t,i,n)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var r=e.uuid,o=t.uuid,a=!1;if(i.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===o&&e.uuid!==r&&(a=!0)})):e.material.uuid===o&&e.uuid!==r&&(a=!0))})),!0===a){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(i){var n=new Map;if("Geometry"in e.Objects){var r=e.Objects.Geometry;for(var o in r){var a=t.get(parseInt(o)),s=this.parseGeometry(a,r[o],i);n.set(parseInt(o),s)}}return n},parseGeometry:function(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,i,n){var r=n.skeletons,o=n.morphTargets,a=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==a.length){var s=t.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null),l=t.children.reduce((function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e}),null),c=a[0],h={};"RotationOrder"in c&&(h.eulerOrder=y(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);var u=g(h);return this.genGeometry(i,s,l,u)}},genGeometry:function(e,t,i,n){var r=new THREE.BufferGeometry;e.attrName&&(r.name=e.attrName);var o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new THREE.Float32BufferAttribute(a.vertex,3);if(n.applyToBufferAttribute(s),r.addAttribute("position",s),a.colors.length>0&&r.addAttribute("color",new THREE.Float32BufferAttribute(a.colors,3)),t&&(r.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(a.weightsIndices,4)),r.addAttribute("skinWeight",new THREE.Float32BufferAttribute(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){var l=new THREE.Float32BufferAttribute(a.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(l),r.addAttribute("normal",l)}if(a.uvs.forEach((function(e,t){var i="uv"+(t+1).toString();0===t&&(i="uv"),r.addAttribute(i,new THREE.Float32BufferAttribute(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var c=a.materialIndex[0],h=0;if(a.materialIndex.forEach((function(e,t){e!==c&&(r.addGroup(h,t-h,c),c=e,h=t)})),r.groups.length>0){var u=r.groups[r.groups.length-1],d=u.start+u.count;d!==a.materialIndex.length&&r.addGroup(d,a.materialIndex.length-d,c)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,i,n),r},parseGeoNode:function(e,t){var i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];for(var n=0;e.LayerElementUV[n];)i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,r){void 0===i.weightTable[n]&&(i.weightTable[n]=[]),i.weightTable[n].push({id:t,weight:e.weights[r]})}))}))),i},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,n=0,r=!1,o=[],a=[],s=[],l=[],c=[],h=[],u=this;return e.vertexIndices.forEach((function(d,p){var m=!1;d<0&&(d=~d,m=!0);var v=[],g=[];if(o.push(3*d,3*d+1,3*d+2),e.color){var y=f(p,i,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);var b=[0,0,0,0],A=[0,0,0,0];g.forEach((function(e,t){var i=e,n=v[t];A.forEach((function(e,t,r){if(i>e){r[t]=i,i=e;var o=b[t];b[t]=n,n=o}}))})),v=b,g=A}for(;g.length<4;)g.push(0),v.push(0);for(var w=0;w<4;++w)c.push(g[w]),h.push(v[w])}if(e.normal&&(y=f(p,i,d,e.normal),a.push(y[0],y[1],y[2])),e.material&&"AllSame"!==e.material.mappingType)var x=f(p,i,d,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=f(p,i,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(u.genFace(t,e,o,x,a,s,l,c,h,n),i++,n=0,o=[],a=[],s=[],l=[],c=[],h=[])})),t},genFace:function(e,t,i,n,r,o,a,s,l,c){for(var h=2;h<c;h++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[3*(h-1)]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+1]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+2]]),e.vertex.push(t.vertexPositions[i[3*h]]),e.vertex.push(t.vertexPositions[i[3*h+1]]),e.vertex.push(t.vertexPositions[i[3*h+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(h-1)]),e.vertexWeights.push(s[4*(h-1)+1]),e.vertexWeights.push(s[4*(h-1)+2]),e.vertexWeights.push(s[4*(h-1)+3]),e.vertexWeights.push(s[4*h]),e.vertexWeights.push(s[4*h+1]),e.vertexWeights.push(s[4*h+2]),e.vertexWeights.push(s[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(h-1)]),e.weightsIndices.push(l[4*(h-1)+1]),e.weightsIndices.push(l[4*(h-1)+2]),e.weightsIndices.push(l[4*(h-1)+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(h-1)]),e.colors.push(o[3*(h-1)+1]),e.colors.push(o[3*(h-1)+2]),e.colors.push(o[3*h]),e.colors.push(o[3*h+1]),e.colors.push(o[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(h-1)]),e.normal.push(r[3*(h-1)+1]),e.normal.push(r[3*(h-1)+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2])),t.uv&&t.uv.forEach((function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(a[i][0]),e.uvs[i].push(a[i][1]),e.uvs[i].push(a[i][2*(h-1)]),e.uvs[i].push(a[i][2*(h-1)+1]),e.uvs[i].push(a[i][2*h]),e.uvs[i].push(a[i][2*h+1])}))},addMorphTargets:function(t,i,n,r){if(null!==n){t.morphAttributes.position=[];var o=this;n.rawTargets.forEach((function(n){var a=e.Objects.Geometry[n.geoID];void 0!==a&&o.genMorphGeometry(t,i,a,r,n.name)}))}},genMorphGeometry:function(e,t,i,n,r){var o=new THREE.BufferGeometry;i.attrName&&(o.name=i.attrName);for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],l=void 0!==i.Vertices?i.Vertices.a:[],c=void 0!==i.Indexes?i.Indexes.a:[],h=0;h<c.length;h++){var u=3*c[h];s[u]+=l[3*h],s[u+1]+=l[3*h+1],s[u+2]+=l[3*h+2]}var d={vertexIndices:a,vertexPositions:s},p=this.genBuffers(d),f=new THREE.Float32BufferAttribute(p.vertex,3);f.name=r||i.attrName,n.applyToBufferAttribute(f),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a,r=[];return"IndexToDirect"===i&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:r,mappingType:t,referenceType:i}},parseUVs:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a,r=[];return"IndexToDirect"===i&&(r=e.UVIndex.a),{dataSize:2,buffer:n,indices:r,mappingType:t,referenceType:i}},parseVertexColors:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a,r=[];return"IndexToDirect"===i&&(r=e.ColorIndex.a),{dataSize:4,buffer:n,indices:r,mappingType:t,referenceType:i}},parseMaterialIndices:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var n=e.Materials.a,r=[],o=0;o<n.length;++o)r.push(o);return{dataSize:1,buffer:n,indices:r,mappingType:t,referenceType:i}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var i,n,r=t-1,o=e.KnotVector.a,a=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)a.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form)for(i=r,n=o.length-1-i,l=0;l<r;++l)a.push(a[l]);var h=new THREE.NURBSCurve(r,o,a,i,n).getPoints(7*a.length),u=new Float32Array(3*h.length);h.forEach((function(e,t){e.toArray(u,3*t)}));var d=new THREE.BufferGeometry;return d.addAttribute("position",new THREE.BufferAttribute(u,3)),d}},a.prototype={constructor:a,parse:function(){var e=[],t=this.parseClips();if(void 0!==t){for(var i in t){var n=t[i],r=this.addClip(n);e.push(r)}return e}},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var i=this.parseAnimationLayers(t);return this.parseAnimStacks(i)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,i=new Map;for(var n in t){var r=t[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var o={id:r.id,attr:r.attrName,curves:{}};i.set(o.id,o)}}return i},parseAnimationCurves:function(i){var n=e.Objects.AnimationCurve;for(var r in n){var o={id:n[r].id,times:n[r].KeyTime.a.map(d),values:n[r].KeyValueFloat.a},a=t.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship;l.match(/X/)?i.get(s).curves.x=o:l.match(/Y/)?i.get(s).curves.y=o:l.match(/Z/)?i.get(s).curves.z=o:l.match(/d|DeformPercent/)&&i.has(s)&&(i.get(s).curves.morph=o)}}},parseAnimationLayers:function(n){var r=e.Objects.AnimationLayer,o=new Map;for(var a in r){var s=[],l=t.get(parseInt(a));void 0!==l&&(l.children.forEach((function(r,o){if(n.has(r.ID)){var a=n.get(r.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===s[o]){t.get(r.ID).parents.forEach((function(e){void 0!==e.relationship&&(p=e.ID)}));var l=e.Objects.Model[p.toString()],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};i.traverse((function(e){(e.ID=l.id)&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))})),c.transform||(c.transform=new THREE.Matrix4),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),s[o]=c}s[o][a.attr]=a}else if(void 0!==a.curves.morph){if(void 0===s[o]){var h;t.get(r.ID).parents.forEach((function(e){void 0!==e.relationship&&(h=e.ID)}));var u=t.get(h).parents[0].ID,d=t.get(u).parents[0].ID,p=t.get(d).parents[0].ID;l=e.Objects.Model[p],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),morphName:e.Objects.Deformer[h].attrName},s[o]=c}s[o][a.attr]=a}}})),o.set(parseInt(a),s))}return o},parseAnimStacks:function(i){var n=e.Objects.AnimationStack,r={};for(var o in n){var a=t.get(parseInt(o)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=i.get(a[0].ID);r[o]={name:n[o].attrName,layer:s}}return r},addClip:function(e){var t=[],i=this;return e.layer.forEach((function(e){t=t.concat(i.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],i=new THREE.Vector3,n=new THREE.Quaternion,r=new THREE.Vector3;if(e.transform&&e.transform.decompose(i,n,r),i=i.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,i,n){var r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new THREE.VectorKeyframeTrack(e+"."+n,r,o)},generateRotationTrack:function(e,t,i,n,r,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,i);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push(o),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==r&&((r=r.map(THREE.Math.degToRad)).push(o),r=(new THREE.Euler).fromArray(r),r=(new THREE.Quaternion).setFromEuler(r).inverse());for(var l=new THREE.Quaternion,c=new THREE.Euler,h=[],u=0;u<s.length;u+=3)c.set(s[u],s[u+1],s[u+2],o),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==r&&l.multiply(r),l.toArray(h,u/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",a,h)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=i.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t.sort((function(e,t){return e-t})).filter((function(e,t,i){return i.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,i){var n=i,r=[],o=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){var i=t.x.values[o];r.push(i),n[0]=i}else r.push(n[0]);if(-1!==a){var l=t.y.values[a];r.push(l),n[1]=l}else r.push(n[1]);if(-1!==s){var c=t.z.values[s];r.push(c),n[2]=c}else r.push(n[2])})),r},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var i=e.values[t-1],n=e.values[t]-i,r=Math.abs(n);if(r>=180){for(var o=r/180,a=n/o,s=i+a,l=e.times[t-1],c=(e.times[t]-l)/o,h=l+c,u=[],d=[];h<e.times[t];)u.push(h),h+=c,d.push(s),s+=a;e.times=w(e.times,t,u),e.values=w(e.values,t,d)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,i=e.split(/[\r\n]+/);return i.forEach((function(e,n){var r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!r&&!o){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,i[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:i},o=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,r):i in a?("PoseNode"===i?a.PoseNode.push(r):void 0!==a[i].id&&(a[i]={},a[i][a[i].id]=a[i]),""!==o.id&&(a[i][o.id]=r)):"number"==typeof o.id?(a[i]={},a[i][o.id]=r):"Properties70"!==i&&(a[i]="PoseNode"===i?[r]:r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}},parseNodeProperty:function(e,t,i){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===r&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){var a=r.split(",").slice(1),s=parseInt(a[0]),l=parseInt(a[1]),c=r.split(",").slice(3);n="connections",function(e,t){for(var i=0,n=e.length,r=t.length;i<r;i++,n++)e[n]=t[i]}(r=[s,l],c=c.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=r),n in o&&Array.isArray(o[n])?o[n].push(r):"a"!==n?o[n]=r:o.a=r,this.setCurrentProp(o,n),"a"===n&&","!==r.slice(-1)&&(o.a=b(r))}else this.parseNodeSpecialProperty(e,n,r)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,i){var n=i.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=n[0],o=n[1],a=n[2],s=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[r]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),r)}},l.prototype={constructor:l,parse:function(e){var t=new c(e);t.skip(23);for(var i=t.getUint32(),n=new h;!this.endOfContent(t);){var r=this.parseNode(t,i);null!==r&&n.add(r.name,r)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i={},n=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(o);if(0===n)return null;for(var s=[],l=0;l<r;l++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",h=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(i.singleProperty=1===r&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(a,i,d)}return i.propertyList=s,"number"==typeof c&&(i.id=c),""!==h&&(i.attrName=h),""!==u&&(i.attrType=u),""!==a&&(i.name=a),i},parseSubNode:function(e,t,i){if(!0===i.singleProperty){var n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if("Connections"===e&&"C"===i.name){var r=[];i.propertyList.forEach((function(e,t){0!==t&&r.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(r)}else if("Properties70"===i.name)Object.keys(i).forEach((function(e){t[e]=i[e]}));else if("Properties70"===e&&"P"===i.name){var o,a=i.propertyList[0],s=i.propertyList[1],l=i.propertyList[2],c=i.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[a]={type:s,type2:l,flag:c,value:o}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"==typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new c(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return!(1&~this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],i=0;i<e;i++)t[i]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var p=[];function f(e,t,i,n){var r;switch(n.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=i;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(r=n.indices[r]);var o=r*n.dataSize,a=o+n.dataSize;return function(e,t,i,n){for(var r=i,o=0;r<n;r++,o++)e[o]=t[r];return e}(p,n.buffer,o,a)}var m=new THREE.Euler,v=new THREE.Vector3;function g(e){var t,i=new THREE.Matrix4,n=new THREE.Matrix4,r=new THREE.Matrix4,o=new THREE.Matrix4,a=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=new THREE.Matrix4,h=new THREE.Matrix4,u=new THREE.Matrix4,d=new THREE.Matrix4,p=new THREE.Matrix4,f=new THREE.Matrix4,g=e.inheritType?e.inheritType:0;e.translation&&i.setPosition(v.fromArray(e.translation)),e.preRotation&&((t=e.preRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(m.fromArray(t))),e.rotation&&((t=e.rotation.map(THREE.Math.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(m.fromArray(t))),e.postRotation&&((t=e.postRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(m.fromArray(t))),e.scale&&s.scale(v.fromArray(e.scale)),e.scalingOffset&&c.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&l.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&h.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d=e.parentMatrixWorld);var y=n.multiply(r).multiply(o),b=new THREE.Matrix4;d.extractRotation(b);var A=new THREE.Matrix4,w=new THREE.Matrix4,x=new THREE.Matrix4,E=new THREE.Matrix4;if(E.copyPosition(d),x=E.getInverse(E).multiply(d),w=b.getInverse(b).multiply(x),A=s,0===g)f=b.multiply(y).multiply(w).multiply(A);else if(1===g)f=b.multiply(w).multiply(y).multiply(A);else{var _=(new THREE.Matrix4).copy(s),M=w.multiply(_.getInverse(_));f=b.multiply(y).multiply(M).multiply(A)}a=i.multiply(h).multiply(u).multiply(n).multiply(r).multiply(o).multiply(u.getInverse(u)).multiply(c).multiply(l).multiply(s).multiply(l.getInverse(l));var T=(new THREE.Matrix4).copyPosition(a),S=d.multiply(T);return p.copyPosition(S),p.multiply(f)}function y(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function A(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,i))}function w(e,t,i){return e.slice(0,t).concat(i).concat(e.slice(t))}return n}()},{}],5:[function(e,t,i){"use strict";t.exports=Object.assign((function(){}),{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},{}],6:[function(e,t,i){"use strict";t.exports=function(e,t,i){this.type=e,this.index=t,this.pressed=i.pressed,this.value=i.value}},{}],7:[function(e,t,i){"use strict";t.exports={size:5,cellSize:10,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5},autogenerated:!0,cells:[{q:-1,r:0,s:1,h:1,walkable:!0,userData:{}},{q:0,r:-1,s:1,h:1,walkable:!0,userData:{}},{q:0,r:0,s:0,h:1,walkable:!0,userData:{}},{q:1,r:-1,s:0,h:1,walkable:!0,userData:{}},{q:-1,r:1,s:0,h:0,walkable:!0,userData:{}},{q:0,r:1,s:-1,h:0,walkable:!0,userData:{}},{q:1,r:0,s:-1,h:0,walkable:!0,userData:{}}]}},{}],8:[function(e,t,i){"use strict";function n(e){var t=document.getElementById(e),i=t.parentNode;try{i&&i.removeChild(t)}catch(e){}}t.exports=function(e){return e=e||{},function(t,i){return function(e,t,i){return new i((function(i,r){var o=t.timeout||5e3,a="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),s=function(e,t){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=t,i.src=e,i}(e,a),l=setTimeout((function(){r(new Error("Script request to "+e+" timed out")),n(a)}),o),c=function(e){clearTimeout(e)};s.addEventListener("load",(function(e){i({ok:!0}),c(l),n(a)})),s.addEventListener("error",(function(t){r(new Error("Script request to "+e+" failed "+t)),c(l),n(a)})),function(e){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(s)}))}(t,i=i||{},e.Promise||Promise)}}},{}],9:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},o=t.exports={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};o.Board=function(e,t){if(!e)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new o.AStarFinder(t),o.Loader.init(),this.setGrid(e)},o.Board.prototype={setEntityOnTile:function(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e},addTile:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)},removeTile:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])},getTileAtCell:function(e){var t=this.grid.cellToHash(e);return e.tile||(void 0!==this.grid.cells[t]?this.grid.cells[t].tile:null)},snapToGrid:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))},snapTileToGrid:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e},getRandomTile:function(){var e=o.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]},findPath:function(e,t,i){return this.finder.findPath(e.cell,t.cell,i,this.grid)},setGrid:function(e){this.group.remove(this.tileGroup),this.grid&&e!==this.grid&&(this.removeAllTiles(),this.tiles.forEach((function(e){this.grid.remove(e.cell),e.dispose()})),this.grid.dispose()),this.grid=e,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(e){var t=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)},generateTilemap:function(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new THREE.Object3D;for(var i=0;i<t.length;i++)this.tileGroup.add(t[i].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},o.Board.prototype.constructor=o.Board,o.Cell=function(e,t,i,n){this.q=e||0,this.r=t||0,this.s=i||0,this.h=n||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=o.LinkedList.generateID()},o.Cell.prototype={set:function(e,t,i){return this.q=e,this.r=t,this.s=i,this},copy:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this},add:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this},equals:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},o.Cell.prototype.constructor=o.Cell,o.HexGrid=function(e){e=e||{},this.type=o.HEX,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t,i=[];for(t=0;6>t;t++)i.push(this._createVertex(t));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(i[0].x,i[0].y),t=1;6>t;t++)this.cellShape.lineTo(i[t].x,i[t].y);this.cellShape.lineTo(i[0].x,i[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*o.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new o.Cell(1,-1,0),new o.Cell(1,0,-1),new o.Cell(0,1,-1),new o.Cell(-1,1,0),new o.Cell(-1,0,1),new o.Cell(0,-1,1)],this._diagonals=[new o.Cell(2,-1,-1),new o.Cell(1,1,-2),new o.Cell(-1,2,-1),new o.Cell(-2,1,1),new o.Cell(-1,-1,2),new o.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new o.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},o.HexGrid.TWO_THIRDS=2/3,o.HexGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3},pixelToCell:function(e){var t=e.x*(o.HexGrid.TWO_THIRDS/this.cellSize),i=(-e.x/3+o.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel)},getCellAt:function(e){var t=e.x*(o.HexGrid.TWO_THIRDS/this.cellSize),i=(-e.x/3+o.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,i){var n,r,o=this._directions.length;for(this._list.length=0,n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);if(t)for(n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);return this._list},getRandomCell:function(){var e,t=0,i=o.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,i){var n=Math.abs(e.h);1>n&&(n=1);var r=this._geoCache[n];r||(this.extrudeSettings.amount=n,r=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=r);var a=new o.Tile({size:this.cellSize,scale:t,cell:e,geometry:r,material:i});return e.tile=a,a},generateTiles:function(e){e=e||{};var t,i,n,r=[],a={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in a=o.Tools.merge(a,e),this.cellSize=a.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*o.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=a.extrudeSettings,this.cells)n=this.cells[t],(i=this.generateTile(n,a.tileScale,a.material)).position.copy(this.cellToPixel(n)),i.position.y=0,r.push(i);return r},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,o.PI/2),t},generate:function(e){var t,i,n,r;for(e=e||{},this.size=void 0===e.size?this.size:e.size,t=-this.size;t<this.size+1;t++)for(i=-this.size;i<this.size+1;i++)n=-t-i,Math.abs(t)<=this.size&&Math.abs(i)<=this.size&&Math.abs(n)<=this.size&&(r=new o.Cell(t,i,n),this.add(r))},generateOverlay:function(e,t,i){var n,r,a,s=this.cellShape.createPointsGeometry();for(n=-e;e+1>n;n++)for(r=-e;e+1>r;r++)if(a=-n-r,Math.abs(n)<=e&&Math.abs(r)<=e&&Math.abs(a)<=e){this._cel.set(n,r,a);var l=new THREE.Line(s,i);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*o.DEG_TO_RAD,t.add(l)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,i){var n=this;o.Tools.getJSON({url:e,callback:function(e){n.fromJSON(e),t.call(i||null,e)},cache:!1,scope:n})},fromJSON:function(e){var t,i,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*o.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(i=new o.Cell).copy(n[t]),this.add(i)},toJSON:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i},_createVertex:function(e){var t=o.TAU/6*e;return new THREE.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)},_cubeRound:function(e){var t=Math.round(e.q),i=Math.round(e.r),n=Math.round(e.s),r=Math.abs(t-e.q),o=Math.abs(i-e.r),a=Math.abs(n-e.s);return r>o&&r>a?t=-i-n:o>a?i=-t-n:n=-t-i,this._cel.set(t,i,n)}},o.HexGrid.prototype.constructor=o.HexGrid,o.SqrGrid=function(e){e=e||{},this.type=o.SQR,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t=[];t.push(new THREE.Vector3),t.push(new THREE.Vector3(-this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new THREE.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=t,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new o.Cell(1,0,0),new o.Cell(0,-1,0),new o.Cell(-1,0,0),new o.Cell(0,1,0)],this._diagonals=[new o.Cell(-1,-1,0),new o.Cell(-1,1,0),new o.Cell(1,1,0),new o.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new o.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},o.SqrGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3},pixelToCell:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)},getCellAt:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,i){var n,r,o=this._directions.length;for(this._list.length=0,n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);if(t)for(n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);return this._list},getRandomCell:function(){var e,t=0,i=o.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,i){var n=Math.abs(e.h);1>n&&(n=1);var r=this._geoCache[n];r||(this.extrudeSettings.amount=n,r=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=r);var a=new o.Tile({size:this.cellSize,scale:t,cell:e,geometry:r,material:i});return e.tile=a,a},generateTiles:function(e){e=e||{};var t,i,n,r=[],a={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in a=o.Tools.merge(a,e),this.cellSize=a.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=a.extrudeSettings,this.cells)n=this.cells[t],(i=this.generateTile(n,a.tileScale,a.material)).position.copy(this.cellToPixel(n)),i.position.y=0,r.push(i);return r},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,o.PI/2),t},generate:function(e){e=e||{},this.size=void 0===e.size?this.size:e.size;var t,i,n,r=Math.ceil(this.size/2);for(t=-r;r>t;t++)for(i=-r;r>i;i++)n=new o.Cell(t,i+1),this.add(n)},generateOverlay:function(e,t,i){var n,r,a=Math.ceil(e/2);for(n=-a;a>n;n++)for(r=-a;a>r;r++){this._cel.set(n,r);var s=new THREE.Line(this.cellGeo,i);s.position.copy(this.cellToPixel(this._cel)),s.rotation.x=90*o.DEG_TO_RAD,t.add(s)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,i){o.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(i||null,e)},cache:!1,scope:this})},fromJSON:function(e){var t,i,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(i=new o.Cell).copy(n[t]),this.add(i)},toJSON:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i}},o.SqrGrid.prototype.constructor=o.SqrGrid,o.Tile=function(e){e=e||{};var t={cell:null,geometry:null,material:null};if(!(t=o.Tools.merge(t,e)).cell||!t.geometry)throw new Error("Missing vg.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=o.Tools.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:o.Tools.randomizeRGB("30, 30, 30",13)})),this.objectType=o.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*o.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},o.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},o.Tile.prototype.constructor=o.Tile,function(){var e=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},t=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]};t.generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},(t.prototype={getNode:function(e){return this.objToNodeMap[e.uniqueID]},addNode:function(i){var n=new e;if(!i.uniqueID)try{i.uniqueID=t.generateID()}catch(e){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return n.obj=i,n.free=!1,this.objToNodeMap[i.uniqueID]=n,n},swapObjects:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t},add:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(e){return!!this.objToNodeMap[e.uniqueID]},moveUp:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prev){var i=t.prev,n=i.prev;t==this.last&&(this.last=i);var r=t.next;n&&(n.next=t),t.next=i,t.prev=i.prev,i.next=r,i.prev=t,this.first==i&&(this.first=t)}},moveDown:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var i=t.next;this.moveUp(i.obj),this.last==i&&(this.last=t)}},sort:function(e){var t,i,n=this.sortArray,r=this.first;for(n.length=0;r;)n.push(r.obj),r=r.next;for(this.clear(),n.sort(e),i=n.length,t=0;i>t;t++)this.add(n[t])},remove:function(e){var t=this.getNode(e);return!(!t||t.free||(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,0))},shift:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},pop:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},concat:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next},clear:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0},dispose:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null},dump:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}).constructor=t,o.LinkedList=t}(),function(){var e=function(e,t,i,n,r){this._listener=t,this.isOnce=i,this.context=n,this.signal=e,this._priority=r||0};e.prototype={active:!0,params:null,execute:function(e){var t,i;return this.active&&this._listener&&(i=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,i),this.isOnce&&this.detach()),t},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},e.prototype.constructor=e;var t=function e(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){e.prototype.dispatch.apply(t,arguments)}};t.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(e,t){if("function"!=typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(t,i,n,r){var o,a=this._indexOfListener(t,n);if(-1!==a){if((o=this._bindings[a]).isOnce!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else o=new e(this,t,i,n,r),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===e&&i.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,i){return this.validateListener(e,"add"),this._registerListener(e,!1,t,i)},addOnce:function(e,t,i){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,i)},remove:function(e,t){this.validateListener(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(e){void 0===e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var e,t=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=t),i){e=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(e[i]&&this._shouldPropagate&&!1!==e[i].execute(t))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},t.prototype.constructor=t,o.Signal=t}(),o.AStarFinder=function(e){e=e||{};var t={allowDiagonal:!1,heuristicFilter:null};t=o.Tools.merge(t,e),this.allowDiagonal=t.allowDiagonal,this.heuristicFilter=t.heuristicFilter,this.list=new o.LinkedList},o.AStarFinder.prototype={findPath:function(e,t,i,n){var r,a,s,l,c,h;for(i=i||this.heuristicFilter,n.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(r=this.list.shift())._visited=!0,r===t)return o.PathUtil.backtrace(t);for(c=0,h=(s=n.getNeighbors(r,this.allowDiagonal,i)).length;h>c;c++)if((l=s[c]).walkable&&(a=r._calcCost+n.distance(r,l),!l._visited||a<l._calcCost)){if(l._visited=!0,l._parent=r,l._calcCost=a,l._priority=a+n.distance(t,l),l===t)return o.PathUtil.backtrace(t);this.list.add(l)}}return null},compare:function(e,t){return e._priority-t._priority}},o.AStarFinder.prototype.constructor=o.AStarFinder,o.PathUtil={backtrace:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()},biBacktrace:function(e,t){var i=this.backtrace(e),n=this.backtrace(t);return i.concat(n.reverse())},pathLength:function(e){var t,i,n,r,o,a=0;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],r=i[0]-n[0],o=i[1]-n[1],a+=Math.sqrt(r*r+o*o);return a},interpolate:function(e,t,i,n){var r,o,a,s,l,c,h=Math.abs,u=[];for(r=i>e?1:-1,o=n>t?1:-1,l=(a=h(i-e))-(s=h(n-t));e!==i||t!==n;)u.push([e,t]),(c=2*l)>-s&&(l-=s,e+=r),a>c&&(l+=a,t+=o);return u},expandPath:function(e){var t,i,n,r,o,a,s=[],l=e.length;if(2>l)return s;for(o=0;l-1>o;++o)for(t=e[o],i=e[o+1],r=(n=this.interpolate(t[0],t[1],i[0],i[1])).length,a=0;r-1>a;++a)s.push(n[a]);return s.push(e[l-1]),s},smoothenPath:function(e,t){var i,n,r,o,a,s,l,c,h,u,d,p,f=t.length,m=t[0][0],v=t[0][1],g=t[f-1][0],y=t[f-1][1];for(a=[[i=m,n=v]],l=2;f>l;++l){for(r=(h=t[l])[0],o=h[1],u=this.interpolate(i,n,r,o),p=!1,c=1;c<u.length;++c)if(d=u[c],!e.isWalkableAt(d[0],d[1])){p=!0;break}p&&(s=t[l-1],a.push(s),i=s[0],n=s[1])}return a.push([g,y]),a},compressPath:function(e){if(e.length<3)return e;var t,i,n,r,o,a,s=[],l=e[0][0],c=e[0][1],h=e[1][0],u=e[1][1],d=h-l,p=u-c;for(d/=o=Math.sqrt(d*d+p*p),p/=o,s.push([l,c]),a=2;a<e.length;a++)t=h,i=u,n=d,r=p,d=(h=e[a][0])-t,p=(u=e[a][1])-i,p/=o=Math.sqrt(d*d+p*p),((d/=o)!==n||p!==r)&&s.push([t,i]);return s.push([h,u]),s}},o.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new THREE.LoadingManager((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,n){var r=new THREE.Texture(null,t);return this.imageLoader.load(e,(function(e){r.image=e,r.needsUpdate=!0,i&&i(r)}),null,(function(e){n&&n(e)})),r.sourceFile=e,r}},o.MouseCaster=function(e,t,i){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new o.Signal,this.group=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,(i=i||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),i.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),i.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),i.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),i.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},o.MouseCaster.OVER="over",o.MouseCaster.OUT="out",o.MouseCaster.DOWN="down",o.MouseCaster.UP="up",o.MouseCaster.CLICK="click",o.MouseCaster.WHEEL="wheel",o.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(t=(e=i[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch(o.MouseCaster.OUT,this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch(o.MouseCaster.OVER,this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch(o.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(e){return(e=e||window.event).preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,void this.signal.dispatch(o.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(e){return e.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch(o.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(o.MouseCaster.CLICK,this.pickedObject),this.down=1!==e.which&&this.down,void(this.rightDown=3!==e.which&&this.rightDown))},_onDocumentMouseMove:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1},_onMouseWheel:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch(o.MouseCaster.WHEEL,this.wheel)}}},o.MouseCaster.prototype.constructor=o.MouseCaster,o.Scene=function(e,t){var i={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},n={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(i=o.Tools.merge(i,e),"boolean"!=typeof t&&(n=o.Tools.merge(n,t)),this.renderer=new THREE.WebGLRenderer({alpha:i.alpha,antialias:i.antialias}),this.renderer.setClearColor(i.clearColor,0),this.renderer.sortObjects=i.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=i.orthoZoom,this.container=new THREE.Scene,this.container.fog=i.fog,this.container.add(new THREE.AmbientLight(14540253)),i.lightPosition||i.light.position.set(-1,1,-1).normalize(),this.container.add(i.light),"OrthographicCamera"===i.cameraType){var r=window.innerWidth/this.orthoZoom,a=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(r/-2,r/2,a/2,a/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=n.minDistance,this.controls.maxDistance=n.maxDistance,this.controls.zoomSpeed=n.zoomSpeed,this.controls.noZoom=n.noZoom),i.cameraPosition&&this.camera.position.copy(i.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(i.element)},o.Scene.prototype={attachTo:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)},add:function(e){this.container.add(e)},remove:function(e){this.container.remove(e)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()}},focusOn:function(e){this.camera.lookAt(e.position)}},o.Scene.prototype.constructor=o.Scene,o.SelectionManager=function(e){this.mouse=e,this.onSelect=new o.Signal,this.onDeselect=new o.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},o.SelectionManager.prototype={select:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))},clearSelection:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(e,t){switch(e){case o.MouseCaster.DOWN:t||this.clearSelection();break;case o.MouseCaster.CLICK:this.select(t)}}},o.SelectionManager.prototype.constructor=o.SelectionManager,o.Tools={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!=(void 0===e?"undefined":r(e))||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(e,t){var i=this,n=Array.isArray(t),r=n&&[]||{};return n?(e=e||[],r=r.concat(e),t.forEach((function(t,n){void 0===r[n]?r[n]=t:i.isPlainObject(t)?r[n]=i.merge(e[n],t):-1===e.indexOf(t)&&r.push(t)})),r):(e&&i.isPlainObject(e)&&Object.keys(e).forEach((function(t){r[t]=e[t]})),Object.keys(t).forEach((function(n){t[n]&&i.isPlainObject(t[n])&&e[n]?r[n]=i.merge(e[n],t[n]):r[n]=t[n]})),r)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,n){if(n=n||31,!((t=t||0)>=(i=i||e.length)-1||0>n)){for(var r=t,o=i,a=1<<n;o>r;)if(e[r]&a){--o;var s=e[r];e[r]=e[o],e[o]=s}else++r;this.radixSort(e,t,o,n-1),this.radixSort(e,o,i,n-1)}},randomizeRGB:function(e,t){var i,n,r=e.split(","),o="rgb(";for(t=this.randomInt(t),i=0;3>i;i++)0>(n=parseInt(r[i])+t)?n=0:n>255&&(n=255),o+=n+",";return(o=o.substring(0,o.length-1))+")"},getJSON:function(e){var t=new XMLHttpRequest,i=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(e){return}e.callback.call(e.scope||null,t)}},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}}},{}],10:[function(e,t,i){"use strict";!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,r=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function a(e,t){return-1!==String(e).indexOf(t)}var s=a(navigator.platform,"Win")?"win":a(navigator.platform,"Mac")?"mac":a(navigator.platform,"CrOS")?"cros":a(navigator.platform,"Linux")?"linux":a(navigator.userAgent,"iPad")||a(navigator.platform,"iPod")||a(navigator.platform,"iPhone")?"ios":"",l=a(navigator.userAgent,"Chrome/")?"chrome":a(navigator.vendor,"Apple")?"safari":a(navigator.userAgent,"MSIE")?"ie":a(navigator.userAgent,"Gecko/")?"moz":a(navigator.userAgent,"Opera/")?"opera":"",c=l+"-"+s;function h(e,t,i){c!==t&&l!==t&&s!==t||Object.keys(i).forEach((function(t){e[t]=i[t]}))}var u={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:r},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:r},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:r},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:r},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};h(u,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),h(u,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),h(u,"moz-win",{173:{code:"Minus",keyCap:"-"}}),h(u,"chrome-mac",{93:{code:"OSRight",location:r}}),h(u,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),h(u,"ios",{10:{code:"Enter",location:i}}),h(u,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:r},229:{code:"KeyQ",keyCap:"Q"}});var d={};"cros"===s&&(d["U+00A0"]={code:"ShiftLeft",location:n},d["U+00A1"]={code:"ShiftRight",location:r},d["U+00A2"]={code:"ControlLeft",location:n},d["U+00A3"]={code:"ControlRight",location:r},d["U+00A4"]={code:"AltLeft",location:n},d["U+00A5"]={code:"AltRight",location:r}),"chrome-mac"===c&&(d["U+0010"]={code:"ContextMenu"}),"safari-mac"===c&&(d["U+0010"]={code:"ContextMenu"}),"ios"===s&&(d["U+0010"]={code:"Function"},d["U+001C"]={code:"ArrowLeft"},d["U+001D"]={code:"ArrowRight"},d["U+001E"]={code:"ArrowUp"},d["U+001F"]={code:"ArrowDown"},d["U+0001"]={code:"Home"},d["U+0004"]={code:"End"},d["U+000B"]={code:"PageUp"},d["U+000C"]={code:"PageDown"});var p=[];p[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},p[r]={16:{code:"ShiftRight",location:r},17:{code:"ControlRight",location:r},18:{code:"AltRight",location:r}},p[o]={13:{code:"NumpadEnter",location:o}},h(p[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),h(p[n],"moz-mac",{224:{code:"OSLeft",location:n}}),h(p[r],"moz-mac",{224:{code:"OSRight",location:r}}),h(p[r],"moz-win",{91:{code:"OSRight",location:r}}),h(p[r],"mac",{93:{code:"OSRight",location:r}}),h(p[o],"chrome-mac",{12:{code:"NumLock",location:o}}),h(p[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};h(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m,v,g,y={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},b=(m=u,v="code",g={},Object.keys(m).forEach((function(e){var t=m[e];v in t&&(g[t[v]]=t)})),g);try{var A=t&&"location"in new KeyboardEvent("")}catch(e){}function w(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,i=function(){if(A||"keyLocation"in e){var i=A?e.location:e.keyLocation;if(i&&t in p[i])return p[i][t]}return"keyIdentifier"in e&&e.keyIdentifier in d?d[e.keyIdentifier]:t in u?u[t]:null}();if(!i)return null;var n,r=(n=f[i.code])?e.shiftKey&&"shiftKey"in n?n.shiftKey:n.key:i.code;return{code:i.code,key:r,location:i.location,keyCap:i.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,i){t in e||Object.defineProperty(e,t,i)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=w(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return y.hasOwnProperty(e)?y[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=w(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=w(this);return e&&"location"in e?e.location:i}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!b.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var i=b[e];return i.keyCap||i.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=w(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:i,e.locale=""}}}(window)},{}],11:[function(e,t,i){var n=function(){};n.computeCentroids=function(e){var t,i,n;for(t=0,i=e.faces.length;t<i;t++)(n=e.faces[t]).centroid=new THREE.Vector3(0,0,0),n.centroid.add(e.vertices[n.a]),n.centroid.add(e.vertices[n.b]),n.centroid.add(e.vertices[n.c]),n.centroid.divideScalar(3)},n.roundNumber=function(e,t){return Number(e.toFixed(t))},n.sample=function(e){return e[Math.floor(Math.random()*e.length)]},n.mergeVertexIds=function(e,t){var i=[];if(e.forEach((function(e){t.indexOf(e)>=0&&i.push(e)})),i.length<2)return[];i.includes(e[0])&&i.includes(e[e.length-1])&&e.push(e.shift()),i.includes(t[0])&&i.includes(t[t.length-1])&&t.push(t.shift()),i=[],e.forEach((function(e){t.includes(e)&&i.push(e)}));for(var n=i[1],r=i[0],o=e.slice();o[0]!==n;)o.push(o.shift());for(var a=0,s=t.slice();s[0]!==r;)if(s.push(s.shift()),a++>10)throw new Error("Unexpected state");return s.shift(),s.pop(),o.concat(s)},n.setPolygonCentroid=function(e,t){var i=new THREE.Vector3,n=t.vertices;e.vertexIds.forEach((function(e){i.add(n[e])})),i.divideScalar(e.vertexIds.length),e.centroid.copy(i)},n.cleanPolygon=function(e,t){for(var i=[],n=t.vertices,r=0;r<e.vertexIds.length;r++){var o,a,s,l=n[e.vertexIds[r]];0===r?(o=e.vertexIds[1],a=e.vertexIds[e.vertexIds.length-1]):r===e.vertexIds.length-1?(o=e.vertexIds[0],a=e.vertexIds[e.vertexIds.length-2]):(o=e.vertexIds[r+1],a=e.vertexIds[r-1]),s=n[a];var c=n[o].clone().sub(l),h=s.clone().sub(l),u=c.angleTo(h);if(u>Math.PI-.01&&u<Math.PI+.01){var d=[];e.neighbours.forEach((function(t){t.vertexIds.includes(e.vertexIds[r])||d.push(t)})),e.neighbours=d}else i.push(e.vertexIds[r])}e.vertexIds=i,this.setPolygonCentroid(e,t)},n.isConvex=function(e,t){var i=t.vertices;if(e.vertexIds.length<3)return!1;for(var n=!0,r=[],o=0;o<e.vertexIds.length;o++){var a,s,l=i[e.vertexIds[o]];0===o?(a=i[e.vertexIds[1]],s=i[e.vertexIds[e.vertexIds.length-1]]):o===e.vertexIds.length-1?(a=i[e.vertexIds[0]],s=i[e.vertexIds[e.vertexIds.length-2]]):(a=i[e.vertexIds[o+1]],s=i[e.vertexIds[o-1]]);var c=a.clone().sub(l),h=s.clone().sub(l),u=c.angleTo(h);if(u===Math.PI||0===u)return!1;var d=c.cross(h).y;r.push(d)}return r.forEach((function(e){0===e&&(n=!1)})),r.forEach(r[0]>0?function(e){e<0&&(n=!1)}:function(e){e>0&&(n=!1)}),n},n.distanceToSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return i*i+n*n+r*r},n.isPointInPoly=function(e,t){for(var i=!1,n=-1,r=e.length,o=r-1;++n<r;o=n)(e[n].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[n].z)&&t.x<(e[o].x-e[n].x)*(t.z-e[n].z)/(e[o].z-e[n].z)+e[n].x&&(i=!i);return i},n.isVectorInPolygon=function(e,t,i){var n=1e5,r=-1e5,o=[];return t.vertexIds.forEach((function(e){n=Math.min(i[e].y,n),r=Math.max(i[e].y,r),o.push(i[e])})),!!(e.y<r+.5&&e.y>n-.5&&this.isPointInPoly(o,e))},n.triarea2=function(e,t,i){return(i.x-e.x)*(t.z-e.z)-(t.x-e.x)*(i.z-e.z)},n.vequal=function(e,t){return this.distanceToSquared(e,t)<1e-5};var r=function(e){this.content=[],this.scoreFunction=e};r.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},r.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},r.prototype.remove=function(e){var t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},r.prototype.size=function(){return this.content.length},r.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},r.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var i=(e+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[i]=t,this.content[e]=n,e=i}},r.prototype.bubbleUp=function(e){for(var t=this.content.length,i=this.content[e],n=this.scoreFunction(i);;){var r=e+1<<1,o=r-1,a=null,s=void 0;if(o<t&&(s=this.scoreFunction(this.content[o]))<n&&(a=o),r<t&&this.scoreFunction(this.content[r])<(null===a?n:s)&&(a=r),null===a)break;this.content[e]=this.content[a],this.content[a]=i,e=a}};var o=function(){};o.init=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.f=0,i.g=0,i.h=0,i.cost=1,i.visited=!1,i.closed=!1,i.parent=null}},o.cleanUp=function(e){for(var t=0;t<e.length;t++){var i=e[t];delete i.f,delete i.g,delete i.h,delete i.cost,delete i.visited,delete i.closed,delete i.parent}},o.heap=function(){return new r((function(e){return e.f}))},o.search=function(e,t,i){this.init(e);var n=this.heap();for(n.push(t);n.size()>0;){var r=n.pop();if(r===i){for(var o=r,a=[];o.parent;)a.push(o),o=o.parent;return this.cleanUp(a),a.reverse()}r.closed=!0;for(var s=this.neighbours(e,r),l=0,c=s.length;l<c;l++){var h=s[l];if(!h.closed){var u=r.g+h.cost,d=h.visited;if(!d||u<h.g){if(h.visited=!0,h.parent=r,!h.centroid||!i.centroid)throw new Error("Unexpected state");h.h=h.h||this.heuristic(h.centroid,i.centroid),h.g=u,h.f=h.g+h.h,d?n.rescoreElement(h):n.push(h)}}}}return[]},o.heuristic=function(e,t){return n.distanceToSquared(e,t)},o.neighbours=function(e,t){for(var i=[],n=0;n<t.neighbours.length;n++)i.push(e[t.neighbours[n]]);return i};var a=1,s=function(){};s.buildZone=function(e){var t=this,i=this._buildNavigationMesh(e),r={};i.vertices.forEach((function(e){e.x=n.roundNumber(e.x,2),e.y=n.roundNumber(e.y,2),e.z=n.roundNumber(e.z,2)})),r.vertices=i.vertices;var o=this._buildPolygonGroups(i);r.groups=[];var a=function(e,t){for(var i=0;i<e.length;i++)if(t===e[i])return i};return o.forEach((function(e){var i=[];e.forEach((function(r){var o=r.neighbours.map((function(t){return a(e,t)})),s=r.neighbours.map((function(e){return t._getSharedVerticesInOrder(r,e)}));r.centroid.x=n.roundNumber(r.centroid.x,2),r.centroid.y=n.roundNumber(r.centroid.y,2),r.centroid.z=n.roundNumber(r.centroid.z,2),i.push({id:a(e,r),neighbours:o,vertexIds:r.vertexIds,centroid:r.centroid,portals:s})})),r.groups.push(i)})),r},s._buildNavigationMesh=function(e){return n.computeCentroids(e),e.mergeVertices(),this._buildPolygonsFromGeometry(e)},s._buildPolygonGroups=function(e){var t=[],i=0,n=function(e){e.neighbours.forEach((function(t){void 0===t.group&&(t.group=e.group,n(t))}))};return e.polygons.forEach((function(e){void 0===e.group&&(e.group=i++,n(e)),t[e.group]||(t[e.group]=[]),t[e.group].push(e)})),t},s._buildPolygonNeighbours=function(e,t,i){var n=new Set,r=i.get(e.vertexIds[0]),o=i.get(e.vertexIds[1]),a=i.get(e.vertexIds[2]);r.forEach((function(e){(o.has(e)||a.has(e))&&n.add(t.polygons[e])})),o.forEach((function(e){a.has(e)&&n.add(t.polygons[e])})),e.neighbours=Array.from(n)},s._buildPolygonsFromGeometry=function(e){for(var t=this,i=[],n=e.vertices,r=e.faceVertexUvs,o=new Map,s=0;s<n.length;s++)o.set(s,new Set);e.faces.forEach((function(e){i.push({id:a++,vertexIds:[e.a,e.b,e.c],centroid:e.centroid,normal:e.normal,neighbours:[]}),o.get(e.a).add(i.length-1),o.get(e.b).add(i.length-1),o.get(e.c).add(i.length-1)}));var l={polygons:i,vertices:n,faceVertexUvs:r};return i.forEach((function(e){t._buildPolygonNeighbours(e,l,o)})),l},s._getSharedVerticesInOrder=function(e,t){var i=e.vertexIds,n=t.vertexIds,r=new Set;if(i.forEach((function(e){n.includes(e)&&r.add(e)})),r.size<2)return[];r.has(i[0])&&r.has(i[i.length-1])&&i.push(i.shift()),r.has(n[0])&&r.has(n[n.length-1])&&n.push(n.shift());var o=[];return i.forEach((function(e){n.includes(e)&&o.push(e)})),o};var l=function(){this.portals=[]};l.prototype.push=function(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})},l.prototype.stringPull=function(){var e,t,i,r=this.portals,o=[],a=0,s=0,l=0;t=r[0].left,i=r[0].right,o.push(e=r[0].left);for(var c=1;c<r.length;c++){var h=r[c].left,u=r[c].right;if(n.triarea2(e,i,u)<=0){if(!(n.vequal(e,i)||n.triarea2(e,t,u)>0)){o.push(t),t=e=t,i=e,s=a=s,l=a,c=a;continue}i=u,l=c}if(n.triarea2(e,t,h)>=0){if(!(n.vequal(e,t)||n.triarea2(e,i,h)<0)){o.push(i),t=e=i,i=e,s=a=l,l=a,c=a;continue}t=h,s=c}}return 0!==o.length&&n.vequal(o[o.length-1],r[r.length-1].left)||o.push(r[r.length-1].left),this.path=o,o};var c,h,u,d,p,f,m=function(){this.zones={}};m.createZone=function(e){return s.buildZone(e)},m.prototype.setZoneData=function(e,t){this.zones[e]=t},m.prototype.getGroup=function(e,t){if(!this.zones[e])return null;var i=null,r=Math.pow(50,2);return this.zones[e].groups.forEach((function(e,o){e.forEach((function(e){var a=n.distanceToSquared(e.centroid,t);a<r&&(i=o,r=a)}))})),i},m.prototype.getRandomNode=function(e,t,i,r){if(!this.zones[e])return new THREE.Vector3;i=i||null,r=r||0;var o=[];return this.zones[e].groups[t].forEach((function(e){i&&r?n.distanceToSquared(i,e.centroid)<r*r&&o.push(e.centroid):o.push(e.centroid)})),n.sample(o)||new THREE.Vector3},m.prototype.getClosestNode=function(e,t,i,r){void 0===r&&(r=!1);var o=this.zones[t].vertices,a=null,s=1/0;return this.zones[t].groups[i].forEach((function(t){var i=n.distanceToSquared(t.centroid,e);i<s&&(!r||n.isVectorInPolygon(e,t,o))&&(a=t,s=i)})),a},m.prototype.findPath=function(e,t,i,n){var r=this.zones[i].groups[n],a=this.zones[i].vertices,s=this.getClosestNode(e,i,n),c=this.getClosestNode(t,i,n,!0);if(!s||!c)return null;var h=o.search(r,s,c),u=function(e,t){for(var i=0;i<e.neighbours.length;i++)if(e.neighbours[i]===t.id)return e.portals[i]},d=new l;d.push(e);for(var p=0;p<h.length;p++){var f=h[p+1];if(f){var m=u(h[p],f);d.push(a[m[0]],a[m[1]])}}d.push(t),d.stringPull();var v=d.path.map((function(e){return new THREE.Vector3(e.x,e.y,e.z)}));return v.shift(),v},m.prototype.clampStep=(u=new THREE.Vector3,d=new THREE.Plane,p=new THREE.Triangle,f=new THREE.Vector3,function(e,t,i,n,r,o){var a=this.zones[n].vertices,s=this.zones[n].groups[r],l=[i],m={};m[i.id]=0,c=void 0,f.set(0,0,0),h=1/0,d.setFromCoplanarPoints(a[i.vertexIds[0]],a[i.vertexIds[1]],a[i.vertexIds[2]]),d.projectPoint(t,u),t.copy(u);for(var v=l.pop();v;v=l.pop()){p.set(a[v.vertexIds[0]],a[v.vertexIds[1]],a[v.vertexIds[2]]),p.closestPointToPoint(t,u),u.distanceToSquared(t)<h&&(c=v,f.copy(u),h=u.distanceToSquared(t));var g=m[v];if(!(g>2))for(var y=0;y<v.neighbours.length;y++){var b=s[v.neighbours[y]];b.id in m||(l.push(b),m[b.id]=g+1)}}return o.copy(f),c}),i.Pathfinding=m},{}],12:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){var t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(this.active){var e=this.data,t=this.offset,i=this.position,n=this.targetPosition,r=this.checkpoint;return this.sync(),i.distanceTo(n)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:r}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)}},sync:function(){var e=this.offset,t=this.position,i=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(i).sub(t)}})},{}],13:[function(e,t,i){"use strict";var n=e("../../lib/GamepadButton"),r=e("../../lib/GamepadButtonEvent"),o=.2;t.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:n,schema:{controller:{default:0,oneOf:[0,1,2,3]},enabled:{default:!0},debug:{default:!1},camera:{default:"[camera]",type:"selector"},rotationSensitivity:{default:2}},init:function(){var e=this.el.sceneEl;this.prevTime=window.performance.now(),this.buttons={};var t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=THREE.Math.degToRad(t.x),this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=THREE.Math.degToRad(t.y),this.yaw.add(this.pitch),e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this.getDpad(),t=this.getJoystick(0),i=e.x||t.x,n=e.y||t.y;return Math.abs(i)>o||Math.abs(n)>o},getVelocityDelta:function(){var e=this.getDpad(),t=this.getJoystick(0),i=e.x||t.x,n=e.y||t.y,r=new THREE.Vector3;return Math.abs(i)>o&&(r.x+=i),Math.abs(n)>o&&(r.z+=n),r},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this.getJoystick(1);return Math.abs(e.x)>o||Math.abs(e.y)>o},updateRotation:function(e){if(this.isRotationActive()){var t=this.data,i=this.yaw,n=this.pitch,r=t.camera.components["look-controls"],a=r&&r.pitchObject&&r.yawObject;a&&(n.rotation.copy(r.pitchObject.rotation),i.rotation.copy(r.yawObject.rotation));var s=this.getJoystick(1);Math.abs(s.x)<=o&&(s.x=0),Math.abs(s.y)<=o&&(s.y=0),s.multiplyScalar(t.rotationSensitivity*e/1e3),i.rotation.y-=s.x,n.rotation.x-=s.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),t.camera.object3D.rotation.set(n.rotation.x,i.rotation.y,0),a&&(r.pitchObject.rotation.copy(n.rotation),r.yawObject.rotation.copy(i.rotation))}},updateButtonState:function(){var e=this.getGamepad();if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new r("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new r("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new r(e.type,e.index,e))},getGamepad:function(){var e=navigator.getGamepads&&navigator.getGamepads()[this.data.controller],t=this.el.sceneEl.components["proxy-controls"];return t&&t.isConnected()&&t.getGamepad(this.data.controller)||e},getButton:function(e){return this.getGamepad().buttons[e]},getAxis:function(e){return this.getGamepad().axes[e]},getJoystick:function(e){var t=this.getGamepad();switch(e){case 0:return new THREE.Vector2(t.axes[0],t.axes[1]);case 1:return new THREE.Vector2(t.axes[2],t.axes[3]);default:throw new Error('Unexpected joystick index "%d".',e)}},getDpad:function(){var e=this.getGamepad();return e.buttons[n.DPAD_RIGHT]?new THREE.Vector2((e.buttons[n.DPAD_RIGHT].pressed?1:0)+(e.buttons[n.DPAD_LEFT].pressed?-1:0),(e.buttons[n.DPAD_UP].pressed?-1:0)+(e.buttons[n.DPAD_DOWN].pressed?1:0)):new THREE.Vector2},isConnected:function(){var e=this.getGamepad();return!(!e||!e.connected)},getID:function(){return this.getGamepad().id}})},{"../../lib/GamepadButton":5,"../../lib/GamepadButtonEvent":6}],14:[function(e,t,i){"use strict";e("./checkpoint-controls"),e("./gamepad-controls"),e("./keyboard-controls"),e("./touch-controls"),e("./movement-controls"),e("./trackpad-controls")},{"./checkpoint-controls":12,"./gamepad-controls":13,"./keyboard-controls":15,"./movement-controls":16,"./touch-controls":17,"./trackpad-controls":18}],15:[function(e,t,i){"use strict";e("../../lib/keyboard.polyfill");var n=window.KeyboardEvent;t.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this)},this.attachEventListeners()},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){var e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},attachEventListeners:function(){window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(var e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new n(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){var e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},{"../../lib/keyboard.polyfill":10}],16:[function(e,t,i){"use strict";var n,r,o,a,s,l="-controls";t.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){var e=this.el;this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){var t=this.el,i=this.data,n=t.sceneEl.systems.nav;t.sceneEl.hasLoaded&&this.injectControls(),n&&i.constrainToNavMesh!==e.constrainToNavMesh&&(i.constrainToNavMesh?n.addAgent(this):n.removeAgent(this))},injectControls:function(){for(var e,t=this.data,i=0;i<t.controls.length;i++)e=t.controls[i]+l,this.el.components[e]||this.el.setAttribute(e,"")},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:(o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,function(e,t){if(t){var i=this.el,n=this.data;if(n.enabled){this.updateVelocityCtrl();var r=this.velocityCtrl,l=this.velocity;if(r)if(t/1e3>.2?l.set(0,0,0):this.updateVelocity(t),n.constrainToNavMesh&&!1!==r.isNavMeshConstrained){if(l.lengthSq()<1e-5)return;o.copy(i.object3D.position),a.copy(l).multiplyScalar(t/1e3).add(o);var c=i.sceneEl.systems.nav;this.navGroup=null===this.navGroup?c.getGroup(o):this.navGroup,this.navNode=this.navNode||c.getNode(o,this.navGroup),this.navNode=c.clampStep(o,a,this.navGroup,this.navNode,s),i.object3D.position.copy(s)}else i.hasAttribute("velocity")?i.setAttribute("velocity",l):(i.object3D.position.x+=l.x*t/1e3,i.object3D.position.y+=l.y*t/1e3,i.object3D.position.z+=l.z*t/1e3)}}}),updateVelocityCtrl:function(){var e=this.data;if(e.enabled){for(var t=0,i=e.controls.length;t<i;t++){var n=this.el.components[e.controls[t]+l];if(n&&n.isVelocityActive())return void(this.velocityCtrl=n)}this.velocityCtrl=null}},updateVelocity:(n=new THREE.Vector2,r=new THREE.Quaternion,function(e){var t=void 0,i=this.el,o=this.velocityCtrl,a=this.velocity,s=this.data;if(o){if(!o.getVelocityDelta){if(o.getVelocity)return void a.copy(o.getVelocity());if(o.getPositionDelta)return void a.copy(o.getPositionDelta(e).multiplyScalar(1e3/e));throw new Error("Incompatible movement controls: ",o)}t=o.getVelocityDelta(e)}if(i.hasAttribute("velocity")&&!s.constrainToNavMesh&&a.copy(this.el.getAttribute("velocity")),t&&s.enabled){var l=s.camera;r.copy(l.object3D.quaternion),r.premultiply(i.object3D.quaternion),t.applyQuaternion(r);var c=t.length();s.fly?(a.copy(t),a.multiplyScalar(16.66667*this.data.speed)):(n.set(t.x,t.z),n.setLength(c*this.data.speed*16.66667),a.x=n.x,a.z=n.y)}})})},{}],17:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd)):e.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()}})},{}],18:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){var e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){var t=this.data,i=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){var n=0,r=0;t.enableNegX&&i[0]<this.startingAxisData[0]&&(n=-1),t.enablePosX&&i[0]>this.startingAxisData[0]&&(n=1),t.enablePosZ&&i[1]>this.startingAxisData[1]&&(r=-1),t.enableNegZ&&i[1]<this.startingAxisData[1]&&(r=1);var o=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>o?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=r,this.isMoving=!0)}},handleTouchAxis:function(e){var t=this.data,i=e.detail.axis,n=0,r=0;t.enableNegX&&i[0]<0&&(n=-1),t.enablePosX&&i[0]>0&&(n=1),t.enablePosZ&&i[1]>0&&(r=-1),t.enableNegZ&&i[1]<0&&(r=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=r)}})},{}],19:[function(e,t,i){"use strict";var n={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function r(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}t.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(n)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){var e=this;this.model=null,this.mixer=null,this.activeActions=[];var t=this.el.getObject3D("mesh");t?this.load(t):this.el.addEventListener("model-loaded",(function(t){e.load(t.detail.model)}))},load:function(e){if(this.el==e.el){var t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",(function(e){t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})})),this.mixer.addEventListener("finished",(function(e){t.emit("animation-finished",{action:e.action,direction:e.direction})})),this.data.clip&&this.update({})}},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(e){var t=this.data,i=AFRAME.utils.diff(t,e);if("clip"in i)return this.stopAction(),void(t.clip&&this.playAction());this.activeActions.forEach((function(e){"duration"in i&&t.duration&&e.setDuration(t.duration),"clampWhenFinished"in i&&(e.clampWhenFinished=t.clampWhenFinished),("loop"in i||"repetitions"in i)&&e.setLoop(n[t.loop],t.repetitions),"timeScale"in i&&e.setEffectiveTimeScale(t.timeScale)}))}},stopAction:function(){for(var e=this.data,t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(this.mixer){var e=this.model,t=this.data,i=e.animations||(e.geometry||{}).animations||[];if(i.length)for(var o,a,s=(o=t.clip,new RegExp("^"+o.split(/\*+/).map(r).join(".*")+"$")),l=0;a=i[l];l++)if(a.name.match(s)){var c=this.mixer.clipAction(a,e);c.enabled=!0,c.clampWhenFinished=t.clampWhenFinished,t.duration&&c.setDuration(t.duration),1!==t.timeScale&&c.setEffectiveTimeScale(t.timeScale),c.setLoop(n[t.loop],t.repetitions).fadeIn(t.crossFadeDuration).play(),this.activeActions.push(c)}}},tick:function(e,t){if(this.mixer&&!isNaN(t)&&Array.isArray(this.model.animationSlices)&&this.model.animationSlices[0]&&-1!=this.model.animationSlices[0].uid){if(this.mixer.update(t/1e3),!this.mixer._actions[0])return;if(this.model.animationSlices&&this.model.animationSlices[0].uid){for(let e=1;e<this.model.animationSlices.length;e++)if(this.model.animationSlices[0].uid==this.model.animationSlices[e].uid)var i=e;if(this.model.animationSlices[i]&&(this.model.animationSlices[0].changed&&(this.mixer._actions[0].time=this.model.animationSlices[i].startTime,this.model.animationSlices[0].changed=!1,this.model.animationSlices[0].count=0),this.model.animationSlices[0].reset||1!=this.model.animationSlices[0].count||(this.mixer._actions[0].time=this.model.animationSlices[i].endTime),this.mixer._actions[0].time<this.model.animationSlices[i].startTime&&(this.mixer._actions[0].time=this.model.animationSlices[i].startTime),this.mixer._actions[0].time>this.model.animationSlices[i].endTime)){if(this.model.animationSlices[0].uid==this.model.animationSlices[0].loop)this.mixer._actions[0].time=this.model.animationSlices[i].startTime;else if(this.model.animationSlices[0].reset){this.model.animationSlices[0].uid=this.model.animationSlices[0].idle,this.model.animationSlices[0].loop=this.model.animationSlices[0].idle;for(let e=1;e<this.model.animationSlices.length;e++)this.model.animationSlices[0].uid==this.model.animationSlices[e].uid&&(i=e,this.model.el.setAttribute("animation-mixer","clip: "+this.model.animationSlices[e].animationName));this.mixer._actions[0].time=this.model.animationSlices[i].startTime}this.model.animationSlices[0].count=1}}}}})},{}],20:[function(e,t,i){"use strict";THREE.ColladaLoader=e("../../lib/ColladaLoader"),t.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,(function(i){e.model=i.scene,e.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}})),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/ColladaLoader":3}],21:[function(e,t,i){"use strict";THREE.FBXLoader=e("../../lib/FBXLoader"),t.exports=AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this.data;if(e.src){this.remove();var t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))}},load:function(e){let t=new THREE.Vector3(1,1,1);!function(e,t){if(e["LastSaved|ApplicationName"])switch(e["LastSaved|ApplicationName"].value){case"3ds Max":e.OriginalUnitScaleFactor?t.multiplyScalar(e.OriginalUnitScaleFactor):t.multiplyScalar(100);break;case"Maya":e.OriginalUnitScaleFactor&&t.multiplyScalar(e.OriginalUnitScaleFactor)}}(e,t),e.scale.copy(t.multiplyScalar(.01)),this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/FBXLoader":4}],22:[function(e,t,i){"use strict";var n,r=e("../../lib/fetch-script")(),o=(n=void 0,function(){return n=n||r("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")});t.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){var e=this;this.model=null,this.loader=null,this.loaderPromise=o().then((function(){e.loader=new THREE.GLTFLoader,e.loader.setCrossOrigin("Anonymous")}))},update:function(){var e=this,t=this,i=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then((function(){e.loader.load(n,(function(e){t.model=e.scene,t.model.animations=e.animations,i.setObject3D("mesh",t.model),i.emit("model-loaded",{format:"gltf",model:t.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/fetch-script":8}],23:[function(e,t,i){"use strict";e("./animation-mixer"),e("./collada-model-legacy"),e("./fbx-model"),e("./gltf-model-legacy"),e("./object-model")},{"./animation-mixer":19,"./collada-model-legacy":20,"./fbx-model":21,"./gltf-model-legacy":22,"./object-model":24}],24:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this,t=void 0,i=this.data;i.src&&(this.remove(),t=new THREE.ObjectLoader,i.crossorigin&&t.setCrossOrigin(i.crossorigin),t.load(i.src,(function(t){t.traverse((function(e){e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)})),e.load(t)})))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{}],25:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){var e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},{}],26:[function(e,t,i){"use strict";function n(e,t,i,n){e&&(t=t||[],e.traverse((function(e){var r;e.isMesh&&((r=e.material)?Array.isArray(r)?r:r.materials?r.materials:[r]:[]).forEach((function(e){e&&!("envMap"in e)||t.length&&-1===t.indexOf(e.name)||(e.envMap=i,e.reflectivity=n,e.needsUpdate=!0)}))})))}t.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},format:{default:"RGBFormat",oneOf:["RGBFormat","RGBAFormat"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){var e=this,t=this.data;this.texture=(new THREE.CubeTextureLoader).load([t.path+"posx."+t.extension,t.path+"negx."+t.extension,t.path+"posy."+t.extension,t.path+"negy."+t.extension,t.path+"posz."+t.extension,t.path+"negz."+t.extension]),this.texture.format=THREE[t.format],this.object3dsetHandler=function(){var t=e.el.getObject3D("mesh"),i=e.data;n(t,i.materials,e.texture,i.reflectivity)},this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){var t=this.data,i=this.el.getObject3D("mesh"),r=[],o=[];if(t.materials.length&&(e.materials?(r=t.materials.filter((function(t){return!e.materials.includes(t)})),o=e.materials.filter((function(e){return!t.materials.includes(e)}))):r=t.materials),r.length&&n(i,r,this.texture,t.reflectivity),o.length&&n(i,o,null,1),e.materials&&t.reflectivity!==e.reflectivity){var a=t.materials.filter((function(t){return e.materials.includes(t)}));a.length&&n(i,a,this.texture,t.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);var e=this.el.getObject3D("mesh"),t=this.data;n(e,t.materials,null,1),t.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},{}],27:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){var e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){var e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){var e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){var t=e.detail.el;t&&!t.is(this.GRABBED_STATE)&&this.grabbing&&!this.hitEl&&(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},{}],28:[function(e,t,i){"use strict";e("./checkpoint"),e("./cube-env-map"),e("./grab"),e("./jump-ability"),e("./kinematic-body"),e("./mesh-smooth"),e("./normal-material"),e("./sphere-collider")},{"./checkpoint":25,"./cube-env-map":26,"./grab":27,"./jump-ability":29,"./kinematic-body":30,"./mesh-smooth":31,"./normal-material":32,"./sphere-collider":33}],29:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("jump-ability",{dependencies:["velocity"],schema:{on:{default:"keydown:Space gamepadbuttondown:0"},playerHeight:{default:1.764},maxJumps:{default:1},distance:{default:5},debug:{default:!1}},init:function(){this.velocity=0,this.numJumps=0;var e=this.beginJump.bind(this),t=this.data.on.split(" ");this.bindings={};for(var i=0;i<t.length;i++)this.bindings[t[i]]=e,this.el.addEventListener(t[i],e);this.bindings.collide=this.onCollide.bind(this),this.el.addEventListener("collide",this.bindings.collide)},remove:function(){for(var e in this.bindings)this.bindings.hasOwnProperty(e)&&(this.el.removeEventListener(e,this.bindings[e]),delete this.bindings[e]);this.el.removeEventListener("collide",this.bindings.collide),delete this.bindings.collide},beginJump:function(){if(this.numJumps<this.data.maxJumps){var e=this.data,t=Math.sqrt(-2*e.distance*-24.8),i=this.el.getAttribute("velocity");this.el.setAttribute("velocity",{x:i.x,y:t,z:i.z}),this.numJumps++,this.el.emit("jumpstart")}},onCollide:function(){this.numJumps>0&&this.el.emit("jumpend"),this.numJumps=0}})},{}],30:[function(e,t,i){"use strict";var n,r,o,a,s=1e-6;t.exports=AFRAME.registerComponent("kinematic-body",{dependencies:["velocity"],schema:{mass:{default:5},radius:{default:1.3},linearDamping:{default:.05},enableSlopes:{default:!0},enableJumps:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this);var e=this.el,t=this.data,i=(new CANNON.Vec3).copy(e.object3D.getWorldPosition(new THREE.Vector3));this.body=new CANNON.Body({material:this.system.getMaterial("staticMaterial"),position:i,mass:t.mass,linearDamping:t.linearDamping,fixedRotation:!0}),this.body.addShape(new CANNON.Sphere(t.radius),new CANNON.Vec3(0,t.radius,0)),this.body.el=this.el,this.el.body=this.body,this.system.addBody(this.body),e.hasAttribute("wasd-controls")&&console.warn("[kinematic-body] Not compatible with wasd-controls, use movement-controls.")},remove:function(){this.system.removeBody(this.body),this.system.removeComponent(this),delete this.el.body},beforeStep:function(e,t){if(t){var i=this.el,n=this.data,r=this.body;n.enableJumps||r.velocity.set(0,0,0),r.position.copy(i.getAttribute("position"))}},step:(n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,function(e,t){if(t){var i=this.body,l=this.data,c=void 0,h=-1/0,u=void 0,d=this.system.getContacts();t=Math.min(t,1e3*this.system.data.maxInterval),a.set(0,0,0),n.copy(this.el.getAttribute("velocity")),i.velocity.copy(n);for(var p,f=0;p=d[f];f++)if(p.enabled){if(i.id===p.bi.id)p.ni.negate(o);else{if(i.id!==p.bj.id)continue;o.copy(p.ni)}i.velocity.dot(o)<-s&&o.y<=.5?n.projectOnPlane(o):o.y>.5&&(c=i.id===p.bi.id?Math.abs(p.rj.y+p.bj.position.y):Math.abs(p.ri.y+p.bi.position.y))>h&&(h=c,a.copy(o),u=i.id===p.bi.id?p.bj:p.bi)}r.copy(n).normalize(),u&&(!l.enableJumps||r.y<.5)?(l.enableSlopes?a.y<1-s&&a.copy(this.raycastToGround(u,a)):a.set(0,1,0),n.projectOnPlane(a)):this.system.driver.world&&n.add(this.system.driver.world.gravity.scale(4*t/1e3)),i.velocity.copy(n),this.el.setAttribute("velocity",i.velocity),this.el.setAttribute("position",i.position)}}),raycastToGround:function(e,t){var i,n=void 0,r=this.body.position,o=this.body.position.clone();return(n=new CANNON.Ray(r,o))._updateDirection(),n.intersectBody(e),n.hasHit?(i=n.result.hitNormalWorld,Math.abs(i.y)>Math.abs(t.y)?i:t):t}})},{}],31:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("mesh-smooth",{init:function(){this.el.addEventListener("model-loaded",(function(e){e.detail.model.traverse((function(e){e.isMesh&&e.geometry.computeVertexNormals()}))}))}})},{}],32:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial)},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){var e=this;this.el.object3D.traverse((function(t){t.isMesh&&(t.material=e.material)}))}})},{}],33:[function(e,t,i){"use strict";var n,r,o,a,s,l;t.exports=AFRAME.registerComponent("sphere-collider",{schema:{objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},remove:function(){this.pause()},play:function(){var e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){var e,t=this.data;e=t.objects?this.el.sceneEl.querySelectorAll(t.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:(n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Box3,l=new Map,function(){var e,t,i=this.el,c=this.data,h=i.getObject3D("mesh"),u=[];h&&(l.clear(),i.object3D.getWorldPosition(n),i.object3D.getWorldScale(o),e=c.radius*(t=o,Math.max.apply(null,t.toArray())),this.els.forEach((function(t){var i,o,c,h;t.isEntity&&(o=t.getObject3D("mesh"))&&(s.setFromObject(o).getSize(a),h=Math.max(a.x,a.y,a.z)/2,i=Math.sqrt(2*h*h),s.getCenter(r),i&&(c=n.distanceTo(r))<i+e&&(u.push(t),l.set(t,c)))})),u.sort((function(e,t){return l.get(e)>l.get(t)?1:-1})).forEach(this.handleHit),0===u.length&&i.emit("hit",{el:null}),this.collisions.filter((function(e){return!l.has(e)})).forEach(this.handleHitEnd),this.collisions=u)}),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.el.emit("hit",{el:e})},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.el.emit("hitend",{el:e})}})},{}],34:[function(e,t,i){"use strict";e("./nav-mesh"),e("./nav-agent"),e("./system")},{"./nav-agent":35,"./nav-mesh":36,"./system":37}],35:[function(e,t,i){"use strict";var n,r,o;t.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:(n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,function(e,t){var i=this.el,a=this.data,s=this.raycaster,l=a.speed*t/1e3;if(a.active){if(!this.path.length){var c=this.el.object3D.position;this.group=this.group||this.system.getGroup(c),this.path=this.system.getPath(c,n.copy(a.destination),this.group)||[],i.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",a.destination),this.el.setAttribute("nav-agent",{active:!1}),void i.emit("navigation-end");var h=i.object3D.position,u=this.path[0];r.subVectors(u,h);var d=void 0;if(r.length()<l){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void i.emit("navigation-end");o.copy(h),d=this.path[0]}else o.copy(r.setLength(l)).add(h),d=u;d.y=h.y,i.object3D.lookAt(d),s.ray.origin.copy(o),s.ray.origin.y+=1.5,s.ray.direction.y=-1;var p=s.intersectObject(this.system.getNavMesh());p.length?(r.subVectors(p[0].point,h),h.add(r.setLength(l))):h.copy(o)}})})},{}],36:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("nav-mesh",{init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this.el.getObject3D("mesh"),t=this.el.sceneEl.object3D;if(e){var i=void 0;if(e.traverse((function(e){e.isMesh&&(i=e)})),i){var n=i.geometry.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(i.geometry):i.geometry.clone();t.updateMatrixWorld(),n.applyMatrix(i.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}}})},{}],37:[function(e,t,i){"use strict";var n=e("three-pathfinding").Pathfinding,r=new n,o="level";t.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),r.setZoneData(o,n.createZone(e)),Array.from(this.agents).forEach((function(e){return e.updateNavLocation()}))},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,i){return this.navMesh?r.findPath(e,t,o,i):null},getGroup:function(e){return this.navMesh?r.getGroup(o,e):null},getNode:function(e,t){return this.navMesh?r.getClosestNode(e,o,t,!0):null},clampStep:function(e,t,i,n,a){return this.navMesh?n?r.clampStep(e,t,n,o,i,a):(a.copy(t),this.getNode(t,i)):(a.copy(t),null)}})},{"three-pathfinding":11}],38:[function(e,t,i){"use strict";t.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},{}],39:[function(e,t,i){"use strict";var n=e("../../lib/hex-grid.min.js"),r=e("../../lib/default-hex-grid");t.exports.Primitive=AFRAME.registerPrimitive("a-hexgrid",{defaultComponents:{hexgrid:{}},mappings:{src:"hexgrid.src"}}),t.exports.Component=AFRAME.registerComponent("hexgrid",{dependencies:["material"],schema:{src:{type:"asset"}},init:function(){var e=this,t=this.data;t.src?fetch(t.src).then((function(e){return e.json()})).then((function(t){return e.addMesh(t)})):this.addMesh(r)},addMesh:function(e){var t=new n.HexGrid;t.fromJSON(e);var i=new n.Board(t);i.generateTilemap(),this.el.setObject3D("mesh",i.group),this.addMaterial()},addMaterial:function(){var e=(this.el.components.material||{}).material;e&&this.el.object3D.traverse((function(t){t.isMesh&&(t.material=e)}))},remove:function(){this.el.removeObject3D("mesh")}})},{"../../lib/default-hex-grid":7,"../../lib/hex-grid.min.js":9}],40:[function(e,t,i){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),t.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){var e=this.el,t=this.data,i=e.components.material,n=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);n.mergeVertices(),this.waves=[];for(var r,o=0,a=n.vertices.length;o<a;o++)r=n.vertices[o],this.waves.push({z:r.z,ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});i||((i={}).material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,shading:THREE.FlatShading})),this.mesh=new THREE.Mesh(n,i.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(t){for(var i,n,r=this.mesh.geometry.vertices,o=0;i=r[o];o++)n=this.waves[o],i.z=n.z+Math.sin(n.ang)*n.amp,n.ang+=n.speed*t;this.mesh.geometry.verticesNeedUpdate=!0}}})},{}],41:[function(e,t,i){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),t.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){var e=this.el,t=this.data,i=e.components.material;if(t.path.length){var n=new THREE.CatmullRomCurve3(t.path.map((function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))}))),r=new THREE.TubeGeometry(n,t.segments,t.radius,t.radialSegments,t.closed);i||((i={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(r,i.material),this.el.setObject3D("mesh",this.mesh)}else console.error("[a-tube] `path` property expected but not found.")},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},{}],42:[function(e,t,i){"use strict";e("./a-grid"),e("./a-hexgrid"),e("./a-ocean"),e("./a-tube")},{"./a-grid":38,"./a-hexgrid":39,"./a-ocean":40,"./a-tube":41}]},{},[1])},986:()=>{!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=i(1);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";var o=AFRAME.utils.srcLoader.parseUrl,a=AFRAME.utils.debug;a.enable("shader:gif:warn");var s=a("shader:gif:warn"),l=(a("shader:gif:debug"),{});function c(e,t){return{status:"error",src:t,message:e,timestamp:Date.now()}}AFRAME.registerShader("gif",{schema:{color:{type:"color"},fog:{default:!0},src:{default:null},autoplay:{default:!0}},init:function(e){return this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var i=this.__getMaterialData(e);Object.keys(i).forEach((function(e){t[e]=i[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,i=e.autoplay;"boolean"==typeof i?this.__autoplay=i:void 0===i&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var i=o(e);if(i)this.__getImageSrc(i,t);else{var r=void 0,a=this.__validateAndGetQuerySelector(e);if(a&&"object"===(void 0===a?"undefined":n(a))){if(a.error)r=a.error;else{var s=a.tagName.toLowerCase();if("video"===s)e=a.src,r="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(a.src,t);r="For <"+s+"> element, please use `aframe-html-shader`"}}var h,u;r&&(h=l[e],u=c(r,e),h&&h.callbacks?h.callbacks.forEach((function(e){return e(u)})):t(u),l[e]=u)}}},__getImageSrc:function(e,t){var i=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(t){i.__getUnit8Array(e,(function(t){t?(0,r.parseGIF)(t,(function(t,i,r){var o={status:"success",src:e,times:t,cnt:i,frames:r,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(o)})),l[e]=o)}),(function(e){return a(e)})):a("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(e){return a("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=e}function a(t){var i=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(i)})),l[e]=i)}},__getUnit8Array:function(e,t){if("function"==typeof t){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.addEventListener("load",(function(e){for(var i=new Uint8Array(e.target.response),n=i.subarray(0,4),r="",o=0;o<n.length;o++)r+=n[o].toString(16);"47494638"===r?t(i):t()})),i.addEventListener("error",(function(e){t()})),i.send()}},__validateAndGetQuerySelector:function(e){try{return document.querySelector(e)||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={self:this,play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,i=e.times,n=e.cnt,r=e.frames;this.__textureSrc=t,this.__delayTimes=i,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=r,this.__frameCnt=i.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(r[0].width),this.__height=THREE.Math.floorPowerOfTwo(r[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}}),AFRAME.registerShader("gif_RGB",{schema:{color:{type:"color",is:"uniform",default:0},fog:{default:!0},texture:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_threshold:{type:"number",is:"uniform",default:.8},_slope:{type:"number",is:"uniform",default:.2},src:{default:null},autoplay:{default:!0}},init:function(e){this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset();var t={vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform vec3 color;","uniform float opacity;","varying vec2 vUV;","uniform float _threshold;","uniform float _slope;","void main(){"," vec3 tColor = texture2D( texture, vUV ).rgb;"," float a = texture2D( texture, vUV ).a;"," float d1, d2, d3, d4, d;"," d1 = abs(length(abs(color.rgb - tColor.rgb)));"," float c1 = abs(length( tColor.g - tColor.r) - length(color.g - color.r));"," float c2 = abs(length( tColor.r - tColor.b) - length(color.r - color.b));"," float c3 = abs(length( tColor.b - tColor.g) - length(color.b - color.g));"," d4 = c1 + c2 + c3;"," d = (d1*2.0 + d4) / 2.0 ;"," float edge0 = _threshold * (1.0 - _slope);"," float alpha = smoothstep(edge0, _threshold, d);"," if (alpha < opacity){","   gl_FragColor = vec4(tColor, alpha*a);"," }"," else{","   gl_FragColor = vec4(tColor, opacity*a);"," }","}"].join("\n")};return this.material=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(e.color)},texture:{value:this.__texture},opacity:{value:e.opacity},_threshold:{value:e._threshold},_slope:{value:e._slope}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var i=this.__getMaterialData(e);Object.keys(i).forEach((function(e){t[e]=i[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,i=e.autoplay;"boolean"==typeof i?this.__autoplay=i:void 0===i&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var i=o(e);if(i)this.__getImageSrc(i,t);else{var r=void 0,a=this.__validateAndGetQuerySelector(e);if(a&&"object"===(void 0===a?"undefined":n(a))){if(a.error)r=a.error;else{var s=a.tagName.toLowerCase();if("video"===s)e=a.src,r="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(a.src,t);r="For <"+s+"> element, please use `aframe-html-shader`"}}var h,u;r&&(h=l[e],u=c(r,e),h&&h.callbacks?h.callbacks.forEach((function(e){return e(u)})):t(u),l[e]=u)}}},__getImageSrc:function(e,t){var i=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(t){i.__getUnit8Array(e,(function(t){t?(0,r.parseGIF)(t,(function(t,i,r){var o={status:"success",src:e,times:t,cnt:i,frames:r,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(o)})),l[e]=o)}),(function(e){return a(e)})):a("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(e){return a("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=e}function a(t){var i=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(i)})),l[e]=i)}},__getUnit8Array:function(e,t){if("function"==typeof t){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.addEventListener("load",(function(e){for(var i=new Uint8Array(e.target.response),n=i.subarray(0,4),r="",o=0;o<n.length;o++)r+=n[o].toString(16);"47494638"===r?t(i):t()})),i.addEventListener("error",(function(e){t()})),i.send()}},__validateAndGetQuerySelector:function(e){try{return document.querySelector(e)||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={self:this,play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,i=e.times,n=e.cnt,r=e.frames;this.__textureSrc=t,this.__delayTimes=i,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=r,this.__frameCnt=i.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(r[0].width),this.__height=THREE.Math.floorPowerOfTwo(r[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}}),AFRAME.registerShader("gif_HSV",{schema:{color:{type:"color"},fog:{default:!0},texture:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_keyingColorH:{type:"number",is:"uniform",default:.33},_keyingColorS:{type:"number",is:"uniform",default:1},_keyingColorV:{type:"number",is:"uniform",default:.75},_deltaH:{type:"number",is:"uniform",default:.2},_deltaS:{type:"number",is:"uniform",default:.1},_deltaV:{type:"number",is:"uniform",default:.1},src:{default:null},autoplay:{default:!0}},init:function(e){this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset();var t={vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform float opacity;","varying vec2 vUV;","uniform float _keyingColorH;","uniform float _keyingColorS;","uniform float _keyingColorV;","uniform float _deltaH;","uniform float _deltaS;","uniform float _deltaV;","vec3 rgb2hsv(vec3 c){"," vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);"," vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));"," vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));"," float d = q.x - min(q.w, q.y);"," float e = 1.0e-10;"," return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","void main(){"," vec3 tColor = texture2D( texture, vUV ).rgb;"," float a = texture2D( texture, vUV ).a;"," vec3 HSV = rgb2hsv(tColor);"," float h = abs(HSV.x - _keyingColorH);"," float s = abs(HSV.y - _keyingColorS);"," float v = abs(HSV.z - _keyingColorV);"," float alpha = opacity;"," if (h <= _deltaH * 0.5 && s <= _deltaS && v <= _deltaV){","   alpha = smoothstep((_deltaH * 0.5) * 0.8, _deltaH* 0.6 ,h);"," }","gl_FragColor = vec4(tColor, alpha*a);","}"].join("\n")};return this.material=new THREE.ShaderMaterial({uniforms:{texture:{value:this.__texture},opacity:{value:e.opacity},_keyingColorH:{value:e._keyingColorH},_keyingColorS:{value:e._keyingColorS},_keyingColorV:{value:e._keyingColorV},_deltaH:{value:e._deltaH},_deltaS:{value:e._deltaS},_deltaV:{value:e._deltaV}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var i=this.__getMaterialData(e);Object.keys(i).forEach((function(e){t[e]=i[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,i=e.autoplay;"boolean"==typeof i?this.__autoplay=i:void 0===i&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var i=o(e);if(i)this.__getImageSrc(i,t);else{var r=void 0,a=this.__validateAndGetQuerySelector(e);if(a&&"object"===(void 0===a?"undefined":n(a))){if(a.error)r=a.error;else{var s=a.tagName.toLowerCase();if("video"===s)e=a.src,r="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(a.src,t);r="For <"+s+"> element, please use `aframe-html-shader`"}}var h,u;r&&(h=l[e],u=c(r,e),h&&h.callbacks?h.callbacks.forEach((function(e){return e(u)})):t(u),l[e]=u)}}},__getImageSrc:function(e,t){var i=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(t){i.__getUnit8Array(e,(function(t){t?(0,r.parseGIF)(t,(function(t,i,r){var o={status:"success",src:e,times:t,cnt:i,frames:r,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(o)})),l[e]=o)}),(function(e){return a(e)})):a("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(e){return a("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=e}function a(t){var i=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(i)})),l[e]=i)}},__getUnit8Array:function(e,t){if("function"==typeof t){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.addEventListener("load",(function(e){for(var i=new Uint8Array(e.target.response),n=i.subarray(0,4),r="",o=0;o<n.length;o++)r+=n[o].toString(16);"47494638"===r?t(i):t()})),i.addEventListener("error",(function(e){t()})),i.send()}},__validateAndGetQuerySelector:function(e){try{return document.querySelector(e)||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={self:this,play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,i=e.times,n=e.cnt,r=e.frames;this.__textureSrc=t,this.__delayTimes=i,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=r,this.__frameCnt=i.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(r[0].width),this.__height=THREE.Math.floorPowerOfTwo(r[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}})},function(e,t){"use strict";t.parseGIF=function(e,t,i){var n=0,r=[],o=0,a=null,s=null,l=[],c=0;if(71!==e[0]||73!==e[1]||70!==e[2]||56!==e[3]||57!==e[4]&&55!==e[4]||97!==e[5])i&&i("parseGIF: no GIF89a");else{n+=13+ +!!(128&e[10])*Math.pow(2,1+(7&e[10]))*3;for(var h=e.subarray(0,n);e[n]&&59!==e[n];){var u=n,d=e[n];if(33===d){var p=e[++n];if(-1===[1,254,249,255].indexOf(p)){i&&i("parseGIF: unknown label");break}for(249===p&&r.push(10*(e[n+3]+(e[n+4]<<8))),255===p&&(c=e[n+15]+(e[n+16]<<8));e[++n];)n+=e[n];249===p&&(a=e.subarray(u,n+1))}else{if(44!==d){i&&i("parseGIF: unknown blockId");break}for(n+=9,n+=1+ +!!(128&e[n])*(3*Math.pow(2,1+(7&e[n])));e[++n];)n+=e[n];s=e.subarray(u,n+1);var f={disposalMethod:a[3],blob:URL.createObjectURL(new Blob([h,a,s]))};l.push(f)}n++}}if(l.length){var m=document.createElement("canvas"),v=function e(i){var n=new Image;n.onload=function(i,n){o++,l[n]=this,o===l.length?(m=null,t&&t(r,c,l)):e(++n)}.bind(n),n.src=m.toDataURL("image/gif")};l.forEach((function(e,t){var i=new Image;i.onload=function(e,t){0===t&&(m.width=i.width,m.height=i.height),o++,l[t]=this,o===l.length&&(o=0,v())}.bind(i,null,t),i.src=e.blob,i.disposalMethod=e.disposalMethod}))}}}])},143:(t,i,n)=>{t.exports=function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[a]={exports:{}};t[a][0].call(c.exports,(function(e){return r(t[a][1][e]||e)}),c,c.exports,e,t,i,n)}return i[a].exports}for(var o=void 0,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,i){var n=Object.prototype.toString;t.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===n.call(e.buffer)||Array.isArray(e)}},{}],2:[function(e,t,i){t.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},{}],3:[function(e,t,i){"use strict";i.byteLength=function(e){var t=l(e),i=t[0],n=t[1];return 3*(i+n)/4-n},i.toByteArray=function(e){for(var t,i=l(e),n=i[0],a=i[1],s=new o(function(e,t,i){return 3*(t+i)/4-i}(0,n,a)),c=0,h=a>0?n-4:n,u=0;u<h;u+=4)t=r[e.charCodeAt(u)]<<18|r[e.charCodeAt(u+1)]<<12|r[e.charCodeAt(u+2)]<<6|r[e.charCodeAt(u+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;return 2===a&&(t=r[e.charCodeAt(u)]<<2|r[e.charCodeAt(u+1)]>>4,s[c++]=255&t),1===a&&(t=r[e.charCodeAt(u)]<<10|r[e.charCodeAt(u+1)]<<4|r[e.charCodeAt(u+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t),s},i.fromByteArray=function(e){for(var t,i=e.length,r=i%3,o=[],a=16383,s=0,l=i-r;s<l;s+=a)o.push(c(e,s,s+a>l?l:s+a));return 1===r?(t=e[i-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=a[s],r[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function c(e,t,i){for(var r,o=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(s=r)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);var s;return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],4:[function(e,t,i){"use strict";t.exports={createLink:function(e,t){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("link");for(var r in n.href=e,n.rel="stylesheet",t)if(t.hasOwnProperty(r)){var o=t[r];n.setAttribute("data-"+r,o)}i.appendChild(n)},createStyle:function(e,t){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");for(var r in n.type="text/css",t)if(t.hasOwnProperty(r)){var o=t[r];n.setAttribute("data-"+r,o)}n.sheet?(n.innerHTML=e,n.sheet.cssText=e,i.appendChild(n)):n.styleSheet?(i.appendChild(n),n.styleSheet.cssText=e):(n.appendChild(document.createTextNode(e)),i.appendChild(n))}}},{}],5:[function(e,t,i){var n,r,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,h=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?h=c.concat(h):d=-1,h.length&&f())}function f(){if(!u){var e=l(p);u=!0;for(var t=h.length;t;){for(c=h,h=[];++d<t;)c&&c[d].run();d=-1,t=h.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];h.push(new m(e,t)),1!==h.length||u||l(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],6:[function(e,t,i){var n=e("buffer").Buffer;t.exports=function(e,t){if(n.isBuffer(e)&&n.isBuffer(t)){if("function"==typeof e.equals)return e.equals(t);if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}}},{buffer:7}],7:[function(e,t,i){(function(t){"use strict";var n=e("base64-js"),r=e("ieee754"),o=e("isarray");function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,i){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return c(this,e,t,i)}function c(e,t,i,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,n){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,i):new Uint8Array(t,i,n),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t),e}(e,t,i,n):"string"==typeof t?function(e,t,i){if("string"==typeof i&&""!==i||(i="utf8"),!l.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(t,i),r=(e=s(e,n)).write(t,i);return r!==n&&(e=e.slice(0,r)),e}(e,t,i):function(e,t){if(l.isBuffer(t)){var i=0|p(t.length);return 0===(e=s(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&o(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(h(t),e=s(e,t<0?0:0|p(t)),!l.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function d(e,t){var i=t.length<0?0:0|p(t.length);e=s(e,i);for(var n=0;n<i;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function f(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return j(e).length;default:if(n)return U(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,i);case"utf8":case"utf-8":return T(this,t,i);case"ascii":return C(this,t,i);case"latin1":case"binary":return L(this,t,i);case"base64":return M(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function g(e,t,i,n,r){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(r)return-1;i=e.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:y(e,t,i,n,r);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):y(e,[t],i,n,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,i,n,r){var o,a=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,i/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var h=-1;for(o=i;o<s;o++)if(c(e,o)===c(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===l)return h*a}else-1!==h&&(o-=o-h),h=-1}else for(i+l>s&&(i=s-l),o=i;o>=0;o--){for(var u=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){u=!1;break}if(u)return o}return-1}function b(e,t,i,n){i=Number(i)||0;var r=e.length-i;n?(n=Number(n))>r&&(n=r):n=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[i+a]=s}return a}function A(e,t,i,n){return z(U(t,e.length-i),e,i,n)}function w(e,t,i,n){return z(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function x(e,t,i,n){return w(e,t,i,n)}function E(e,t,i,n){return z(j(t),e,i,n)}function _(e,t,i,n){return z(function(e,t){for(var i,n,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(i=e.charCodeAt(a))>>8,r=i%256,o.push(r),o.push(n);return o}(t,e.length-i),e,i,n)}function M(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function T(e,t,i){i=Math.min(e.length,i);for(var n=[],r=t;r<i;){var o,a,s,l,c=e[r],h=null,u=c>239?4:c>223?3:c>191?2:1;if(r+u<=i)switch(u){case 1:c<128&&(h=c);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&c)<<6|63&o)>127&&(h=l);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&(l=(15&c)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(h=l)}null===h?(h=65533,u=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),r+=u}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);for(var i="",n=0;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=S));return i}(n)}i.Buffer=l,i.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},i.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),i.kMaxLength=a(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,i){return c(null,e,t,i)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,i){return function(e,t,i,n){return h(t),t<=0?s(e,t):void 0!==i?"string"==typeof n?s(e,t).fill(i,n):s(e,t).fill(i):s(e,t)}(null,e,t,i)},l.allocUnsafe=function(e){return u(null,e)},l.allocUnsafeSlow=function(e){return u(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,r=0,o=Math.min(i,n);r<o;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=l.allocUnsafe(t),r=0;for(i=0;i<e.length;++i){var a=e[i];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,r),r+=a.length}return n},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",t=i.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,i,n,r){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),t<0||i>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&t>=i)return 0;if(n>=r)return-1;if(t>=i)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(n>>>=0),a=(i>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(n,r),h=e.slice(t,i),u=0;u<s;++u)if(c[u]!==h[u]){o=c[u],a=h[u];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},l.prototype.indexOf=function(e,t,i){return g(this,e,t,i,!0)},l.prototype.lastIndexOf=function(e,t,i){return g(this,e,t,i,!1)},l.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-t;if((void 0===i||i>r)&&(i=r),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return b(this,e,t,i);case"utf8":case"utf-8":return A(this,e,t,i);case"ascii":return w(this,e,t,i);case"latin1":case"binary":return x(this,e,t,i);case"base64":return E(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function C(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(127&e[r]);return n}function L(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(e[r]);return n}function R(e,t,i){var n,r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var o="",a=t;a<i;++a)o+=(n=e[a])<16?"0"+n.toString(16):n.toString(16);return o}function D(e,t,i){for(var n=e.slice(t,i),r="",o=0;o<n.length;o+=2)r+=String.fromCharCode(n[o]+256*n[o+1]);return r}function P(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,i,n,r,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function I(e,t,i,n){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-i,2);r<o;++r)e[i+r]=(t&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function k(e,t,i,n){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-i,4);r<o;++r)e[i+r]=t>>>8*(n?r:3-r)&255}function B(e,t,i,n,r,o){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function N(e,t,i,n,o){return o||B(e,0,i,4),r.write(e,t,i,n,23,4),i+4}function F(e,t,i,n,o){return o||B(e,0,i,8),r.write(e,t,i,n,52,8),i+8}l.prototype.slice=function(e,t){var i,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=l.prototype;else{var r=t-e;i=new l(r,void 0);for(var o=0;o<r;++o)i[o]=this[o+e]}return i},l.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n},l.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var n=this[e+--t],r=1;t>0&&(r*=256);)n+=this[e+--t]*r;return n},l.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var n=t,r=1,o=this[e+--n];n>0&&(r*=256);)o+=this[e+--n]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,i,n){e=+e,t|=0,i|=0,n||O(this,e,t,i,Math.pow(2,8*i)-1,0);var r=1,o=0;for(this[t]=255&e;++o<i&&(r*=256);)this[t+o]=e/r&255;return t+i},l.prototype.writeUIntBE=function(e,t,i,n){e=+e,t|=0,i|=0,n||O(this,e,t,i,Math.pow(2,8*i)-1,0);var r=i-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+i},l.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):k(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t|=0,!n){var r=Math.pow(2,8*i-1);O(this,e,t,i,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<i&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+i},l.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t|=0,!n){var r=Math.pow(2,8*i-1);O(this,e,t,i,r-1,-r)}var o=i-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+i},l.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):k(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,i){return N(this,e,t,!0,i)},l.prototype.writeFloatBE=function(e,t,i){return N(this,e,t,!1,i)},l.prototype.writeDoubleLE=function(e,t,i){return F(this,e,t,!0,i)},l.prototype.writeDoubleBE=function(e,t,i){return F(this,e,t,!1,i)},l.prototype.copy=function(e,t,i,n){if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var r,o=n-i;if(this===e&&i<t&&t<n)for(r=o-1;r>=0;--r)e[r+t]=this[r+i];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+o),t);return o},l.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var a=l.isBuffer(e)?e:U(new l(e,n).toString()),s=a.length;for(o=0;o<i-t;++o)this[o+t]=a[o%s]}return this};var H=/[^+\/0-9A-Za-z-_]/g;function U(e,t){var i;t=t||1/0;for(var n=e.length,r=null,o=[],a=0;a<n;++a){if((i=e.charCodeAt(a))>55295&&i<57344){if(!r){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}r=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function j(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":3,ieee754:18,isarray:8}],8:[function(e,t,i){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],9:[function(e,t,i){!function(){if("undefined"!=typeof window)try{var e=new window.CustomEvent("test",{cancelable:!0});if(e.preventDefault(),!0!==e.defaultPrevented)throw new Error("Could not prevent default")}catch(e){var t=function(e,t){var i,n;return(t=t||{}).bubbles=!!t.bubbles,t.cancelable=!!t.cancelable,(i=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n=i.preventDefault,i.preventDefault=function(){n.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(e){this.defaultPrevented=!0}},i};t.prototype=window.Event.prototype,window.CustomEvent=t}}()},{}],10:[function(e,t,i){function n(){var e;try{e=i.storage.debug}catch(e){}return e}(i=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" "),!t)return e;var i="color: "+this.color;e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1));var n=0,r=0;return e[0].replace(/%[a-z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,i),e},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=n,i.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],i.formatters.j=function(e){return JSON.stringify(e)},i.enable(n())},{"./debug":11}],11:[function(e,t,i){(i=t.exports=function(e){function t(){}function r(){var e=r;null==e.useColors&&(e.useColors=i.useColors()),null==e.color&&e.useColors&&(e.color=i.colors[n++%i.colors.length]);var t=Array.prototype.slice.call(arguments);t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&(t=["%o"].concat(t));var o=0;t[0]=t[0].replace(/%([a-z%])/g,(function(n,r){if("%%"===n)return n;o++;var a=i.formatters[r];if("function"==typeof a){var s=t[o];n=a.call(e,s),t.splice(o,1),o--}return n})),"function"==typeof i.formatArgs&&(t=i.formatArgs.apply(e,t)),(r.log||i.log||console.log.bind(console)).apply(e,t)}t.enabled=!1,r.enabled=!0;var o=i.enabled(e)?r:t;return o.namespace=e,o}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},i.disable=function(){i.enable("")},i.enable=function(e){i.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,r=0;r<n;r++)t[r]&&("-"===(e=t[r].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")))},i.enabled=function(e){var t,n;for(t=0,n=i.skips.length;t<n;t++)if(i.skips[t].test(e))return!1;for(t=0,n=i.names.length;t<n;t++)if(i.names[t].test(e))return!0;return!1},i.names=[],i.skips=[],i.formatters={};var n=0},{}],12:[function(e,t,i){"use strict";var n=e("is-obj"),r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(e,t,i){var o=t[i];if(null!=o){if(r.call(e,i)&&(void 0===e[i]||null===e[i]))throw new TypeError("Cannot convert undefined or null to object ("+i+")");r.call(e,i)&&n(o)?e[i]=s(Object(e[i]),t[i]):e[i]=o}}function s(e,t){if(e===t)return e;for(var i in t=Object(t))r.call(t,i)&&a(e,t,i);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(t),s=0;s<n.length;s++)o.call(t,n[s])&&a(e,t,n[s]);return e}t.exports=function(e){e=function(e){if(null==e)throw new TypeError("Sources cannot be null or undefined");return Object(e)}(e);for(var t=1;t<arguments.length;t++)s(e,arguments[t]);return e}},{"is-obj":23}],13:[function(t,i,n){!function(t,i,n,r){"use strict";function o(e,t){for(var i=0,n=e.length;i<n;i++)m(e[i],t)}function a(e){return function(t){ie(t)&&(m(t,e),o(t.querySelectorAll(H),e))}}function s(e){var t=oe.call(e,"is"),i=e.nodeName.toUpperCase(),n=j.call(N,t?I+t.toUpperCase():O+i);return t&&-1<n&&!l(i,t)?-1:n}function l(e,t){return-1<H.indexOf(e+'[is="'+t+'"]')}function c(e){var t=e.currentTarget,i=e.attrChange,n=e.attrName,r=e.target;me&&(!r||r===t)&&t.attributeChangedCallback&&"style"!==n&&e.prevValue!==e.newValue&&t.attributeChangedCallback(n,i===e[S]?null:e.prevValue,i===e[L]?null:e.newValue)}function h(e){var t=a(e);return function(e){v.push(t,e.target)}}function u(e){fe&&(fe=!1,e.currentTarget.removeEventListener(D,u)),o((e.target||i).querySelectorAll(H),e.detail===M?M:_),te&&function(){for(var e,t=0,i=ne.length;t<i;t++)e=ne[t],U.contains(e)||(i--,ne.splice(t--,1),m(e,M))}()}function d(e,t){var i=this;ae.call(i,e,t),g.call(i,{target:i})}function p(e,t){J(e,t),A?A.observe(e,ce):(pe&&(e.setAttribute=d,e[E]=b(e),e.addEventListener(P,g)),e.addEventListener(R,c)),e.createdCallback&&me&&(e.created=!0,e.createdCallback(),e.created=!1)}function f(e){throw new Error("A "+e+" type is already registered")}function m(e,t){var i,n=s(e);-1<n&&(w(e,F[n]),n=0,t!==_||e[_]?t===M&&!e[M]&&(e[_]=!1,e[M]=!0,n=1):(e[M]=!1,e[_]=!0,n=1,te&&j.call(ne,e)<0&&ne.push(e)),n&&(i=e[t+"Callback"])&&i.call(e))}if(!(r in i)){var v,g,y,b,A,w,x,E="__"+r+(1e5*Math.random()|0),_="attached",M="detached",T="extends",S="ADDITION",C="MODIFICATION",L="REMOVAL",R="DOMAttrModified",D="DOMContentLoaded",P="DOMSubtreeModified",O="<",I="=",k=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,B=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"],N=[],F=[],H="",U=i.documentElement,j=N.indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},z=n.prototype,G=z.hasOwnProperty,V=z.isPrototypeOf,W=n.defineProperty,q=n.getOwnPropertyDescriptor,X=n.getOwnPropertyNames,Y=n.getPrototypeOf,K=n.setPrototypeOf,Q=!!n.__proto__,Z=n.create||function e(t){return t?(e.prototype=t,new e):this},J=K||(Q?function(e,t){return e.__proto__=t,e}:X&&q?function(){function e(e,t){for(var i,n=X(t),r=0,o=n.length;r<o;r++)i=n[r],G.call(e,i)||W(e,i,q(t,i))}return function(t,i){do{e(t,i)}while((i=Y(i))&&!V.call(i,t));return t}}():function(e,t){for(var i in t)e[i]=t[i];return e}),$=t.MutationObserver||t.WebKitMutationObserver,ee=(t.HTMLElement||t.Element||t.Node).prototype,te=!V.call(ee,U),ie=te?function(e){return 1===e.nodeType}:function(e){return V.call(ee,e)},ne=te&&[],re=ee.cloneNode,oe=ee.getAttribute,ae=ee.setAttribute,se=ee.removeAttribute,le=i.createElement,ce=$&&{attributes:!0,characterData:!0,attributeOldValue:!0},he=$||function(e){pe=!1,U.removeEventListener(R,he)},ue=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,10)},de=!1,pe=!0,fe=!0,me=!0;K||Q?(w=function(e,t){V.call(t,e)||p(e,t)},x=p):(w=function(e,t){e[E]||(e[E]=n(!0),p(e,t))},x=w),te?(pe=!1,function(){var t=q(ee,"addEventListener"),i=t.value,n=function(e){var t=new CustomEvent(R,{bubbles:!0});t.attrName=e,t.prevValue=oe.call(this,e),t.newValue=null,t[L]=t.attrChange=2,se.call(this,e),this.dispatchEvent(t)},r=function(t,i){var n=this.hasAttribute(t),r=n&&oe.call(this,t);e=new CustomEvent(R,{bubbles:!0}),ae.call(this,t,i),e.attrName=t,e.prevValue=n?r:null,e.newValue=i,n?e[C]=e.attrChange=1:e[S]=e.attrChange=0,this.dispatchEvent(e)},o=function(e){var t,i=e.currentTarget,n=i[E],r=e.propertyName;n.hasOwnProperty(r)&&(n=n[r],(t=new CustomEvent(R,{bubbles:!0})).attrName=n.name,t.prevValue=n.value||null,t.newValue=n.value=i[r]||null,null==t.prevValue?t[S]=t.attrChange=0:t[C]=t.attrChange=1,i.dispatchEvent(t))};t.value=function(e,t,a){e===R&&this.attributeChangedCallback&&this.setAttribute!==r&&(this[E]={className:{name:"class",value:this.className}},this.setAttribute=r,this.removeAttribute=n,i.call(this,"propertychange",o)),i.call(this,e,t,a)},W(ee,"addEventListener",t)}()):$||(U.addEventListener(R,he),U.setAttribute(E,1),U.removeAttribute(E),pe&&(g=function(e){var t,i,n,r=this;if(r===e.target){for(n in t=r[E],r[E]=i=b(r),i){if(!(n in t))return y(0,r,n,t[n],i[n],S);if(i[n]!==t[n])return y(1,r,n,t[n],i[n],C)}for(n in t)if(!(n in i))return y(2,r,n,t[n],i[n],L)}},y=function(e,t,i,n,r,o){var a={attrChange:e,currentTarget:t,attrName:i,prevValue:n,newValue:r};a[o]=e,c(a)},b=function(e){for(var t,i,n={},r=e.attributes,o=0,a=r.length;o<a;o++)"setAttribute"!==(i=(t=r[o]).name)&&(n[i]=t.value);return n})),i[r]=function(e,t){if(n=e.toUpperCase(),de||(de=!0,$?(A=function(e,t){function i(e,t){for(var i=0,n=e.length;i<n;t(e[i++]));}return new $((function(n){for(var r,o,a,s=0,l=n.length;s<l;s++)"childList"===(r=n[s]).type?(i(r.addedNodes,e),i(r.removedNodes,t)):(o=r.target,me&&o.attributeChangedCallback&&"style"!==r.attributeName&&(a=oe.call(o,r.attributeName))!==r.oldValue&&o.attributeChangedCallback(r.attributeName,r.oldValue,a))}))}(a(_),a(M)),A.observe(i,{childList:!0,subtree:!0})):(v=[],ue((function e(){for(;v.length;)v.shift().call(null,v.shift());ue(e)})),i.addEventListener("DOMNodeInserted",h(_)),i.addEventListener("DOMNodeRemoved",h(M))),i.addEventListener(D,u),i.addEventListener("readystatechange",u),i.createElement=function(e,t){var n=le.apply(i,arguments),r=""+e,o=j.call(N,(t?I:O)+(t||r).toUpperCase()),a=-1<o;return t&&(n.setAttribute("is",t=t.toLowerCase()),a&&(a=l(r.toUpperCase(),t))),me=!i.createElement.innerHTMLHelper,a&&x(n,F[o]),n},ee.cloneNode=function(e){var t=re.call(this,!!e),i=s(t);return-1<i&&x(t,F[i]),e&&function(e){for(var t,i=0,n=e.length;i<n;i++)t=e[i],x(t,F[s(t)])}(t.querySelectorAll(H)),t}),-2<j.call(N,I+n)+j.call(N,O+n)&&f(e),!k.test(n)||-1<j.call(B,n))throw new Error("The type "+e+" is invalid");var n,r,c=function(){return p?i.createElement(m,n):i.createElement(m)},d=t||z,p=G.call(d,T),m=p?t[T].toUpperCase():n;return p&&-1<j.call(N,O+m)&&f(m),r=N.push((p?I:O)+n)-1,H=H.concat(H.length?",":"",p?m+'[is="'+e.toLowerCase()+'"]':m),c.prototype=F[r]=G.call(d,"prototype")?d.prototype:Z(ee),o(i.querySelectorAll(H),_),c}}}(window,document,Object,"registerElement")},{}],14:[function(e,t,i){t.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],15:[function(e,t,i){var n=e("dtype");t.exports=function(e,t,i){if(!e)throw new TypeError("must specify data as first parameter");if(i=0|+(i||0),Array.isArray(e)&&e[0]&&"number"==typeof e[0][0]){var r,o,a,s,l=e[0].length,c=e.length*l;t&&"string"!=typeof t||(t=new(n(t||"float32"))(c+i));var h=t.length-i;if(c!==h)throw new Error("source length "+c+" ("+l+"x"+e.length+") does not match destination length "+h);for(r=0,a=i;r<e.length;r++)for(o=0;o<l;o++)t[a++]=null===e[r][o]?NaN:e[r][o]}else if(t&&"string"!=typeof t)t.set(e,i);else{var u=n(t||"float32");if(Array.isArray(e)||"array"===t)for(r=0,a=i,s=(t=new u(e.length+i)).length;a<s;a++,r++)t[a]=null===e[r]?NaN:e[r];else 0===i?t=new u(e):(t=new u(e.length+i)).set(e,i)}return t}},{dtype:14}],16:[function(e,t,i){"use strict";var n=e("is-callable"),r=Object.prototype.toString,o=Object.prototype.hasOwnProperty;t.exports=function(e,t,i){if(!n(t))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=i),"[object Array]"===r.call(e)?function(e,t,i){for(var n=0,r=e.length;n<r;n++)o.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))}(e,t,a):"string"==typeof e?function(e,t,i){for(var n=0,r=e.length;n<r;n++)null==i?t(e.charAt(n),n,e):t.call(i,e.charAt(n),n,e)}(e,t,a):function(e,t,i){for(var n in e)o.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))}(e,t,a)}},{"is-callable":21}],17:[function(e,t,i){(function(e){var i;i="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=i}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(e,t,i){i.read=function(e,t,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,c=l>>1,h=-7,u=i?r-1:0,d=i?-1:1,p=e[t+u];for(u+=d,o=p&(1<<-h)-1,p>>=-h,h+=s;h>0;o=256*o+e[t+u],u+=d,h-=8);for(a=o&(1<<-h)-1,o>>=-h,h+=n;h>0;a=256*a+e[t+u],u+=d,h-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=c}return(p?-1:1)*a*Math.pow(2,o-n)},i.write=function(e,t,i,n,r,o){var a,s,l,c=8*o-r-1,h=(1<<c)-1,u=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(a++,l/=2),a+u>=h?(s=0,a=h):a+u>=1?(s=(t*l-1)*Math.pow(2,r),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,r),a=0));r>=8;e[i+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;e[i+p]=255&a,p+=f,a/=256,c-=8);e[i+p-f]|=128*m}},{}],19:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],20:[function(e,t,i){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],21:[function(e,t,i){"use strict";var n=Function.prototype.toString,r=/^\s*class\b/,o=function(e){try{var t=n.call(e);return r.test(t)}catch(e){return!1}},a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(s)return function(e){try{return!o(e)&&(n.call(e),!0)}catch(e){return!1}}(e);if(o(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},{}],22:[function(e,t,i){t.exports=function(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString},{}],23:[function(e,t,i){"use strict";t.exports=function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}},{}],24:[function(e,t,i){var n=e("word-wrapper"),r=e("xtend"),o=e("as-number"),a=["x","e","a","o","n","s","r","c","u","m","v","w","z"],s=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),h=" ".charCodeAt(0);function u(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function d(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function p(e,t){if(!e.chars||0===e.chars.length)return null;var i=m(e.chars,t);return i>=0?e.chars[i]:null}function f(e,t,i){if(!e.kernings||0===e.kernings.length)return 0;for(var n=e.kernings,r=0;r<n.length;r++){var o=n[r];if(o.first===t&&o.second===i)return o.amount}return 0}function m(e,t,i){for(var n=i=i||0;n<e.length;n++)if(e[n].id===t)return n;return-1}t.exports=function(e){return new u(e)},u.prototype.update=function(e){if(e=r({measure:this._measure},e),this._opt=e,this._opt.tabSize=o(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,i=e.text||"",s=e.font;this._setupSpaceGlyphs(s);var u=n.lines(i,e),d=e.width||0;t.length=0;var p=u.reduce((function(e,t){return Math.max(e,t.width,d)}),0),v=0,g=0,y=o(e.lineHeight,s.common.lineHeight),b=s.common.base,A=y-b,w=e.letterSpacing||0,x=y*u.length-A,E=function(e){return"center"===e?1:"right"===e?2:0}(this._opt.align);g-=x,this._width=p,this._height=x,this._descender=y-b,this._baseline=b,this._xHeight=function(e){for(var t=0;t<a.length;t++){var i=a[t].charCodeAt(0),n=m(e.chars,i);if(n>=0)return e.chars[n].height}return 0}(s),this._capHeight=function(e){for(var t=0;t<l.length;t++){var i=l[t].charCodeAt(0),n=m(e.chars,i);if(n>=0)return e.chars[n].height}return 0}(s),this._lineHeight=y,this._ascender=y-A-this._xHeight;var _=this;u.forEach((function(e,n){for(var r,o=e.start,a=e.end,l=e.width,u=o;u<a;u++){var d=i.charCodeAt(u),m=_.getGlyph(s,d);if(m){if((d==c||d==h)&&" "!=m.char)continue;r&&(v+=f(s,r.id,m.id));var b=v;1===E?b+=(p-l)/2:2===E&&(b+=p-l),t.push({position:[b,g],data:m,index:u,line:n}),v+=m.xadvance+w,r=m}}g+=y,v=0})),this._linesTotal=u.length},u.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,h)||function(e){for(var t=0;t<s.length;t++){var i=s[t].charCodeAt(0),n=m(e.chars,i);if(n>=0)return e.chars[n]}return 0}(e)||e.chars[0],i=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=r(t,{x:0,y:0,xadvance:i,id:c,xoffset:0,yoffset:0,width:0,height:0})}},u.prototype.getGlyph=function(e,t){return p(e,t)||(t===c?this._fallbackTabGlyph:t===h?this._fallbackSpaceGlyph:null)},u.prototype.computeMetrics=function(e,t,i,n){var r,o=this._opt.letterSpacing||0,a=this._opt.font,s=0,l=0,c=0;if(!a.chars||0===a.chars.length)return{start:t,end:t,width:0};i=Math.min(e.length,i);for(var h=t;h<i;h++){var u,d=e.charCodeAt(h);if(u=this.getGlyph(a,d)){u.xoffset;var p=(s+=r?f(a,r.id,u.id):0)+u.xadvance+o,m=s+u.width;if(m>=n||p>=n)break;s=p,l=m,r=u}c++}return r&&(l+=r.xoffset),{start:t,end:t+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(u.prototype,e,{get:d(e),configurable:!0})}))},{"as-number":2,"word-wrapper":50,xtend:53}],25:[function(e,t,i){(function(i){var n=e("xhr"),r=function(){},o=e("parse-bmfont-ascii"),a=e("parse-bmfont-xml"),s=e("parse-bmfont-binary"),l=e("./lib/is-binary"),c=e("xtend"),h=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;t.exports=function(e,t){t="function"==typeof t?t:r,"string"==typeof e?e={uri:e}:e||(e={}),e.binary&&(e=function(e){if(h)return c(e,{responseType:"arraybuffer"});if(void 0===self.XMLHttpRequest)throw new Error("your browser does not support XHR loading");var t=new self.XMLHttpRequest;return t.overrideMimeType("text/plain; charset=x-user-defined"),c({xhr:t},e)}(e)),n(e,(function(n,c,h){if(n)return t(n);if(!/^2/.test(c.statusCode))return t(new Error("http status code: "+c.statusCode));if(!h)return t(new Error("no body result"));var u,d,p=!1;if(d=h,"[object ArrayBuffer]"===Object.prototype.toString.call(d)){var f=new Uint8Array(h);h=new i(f,"binary")}l(h)&&(p=!0,"string"==typeof h&&(h=new i(h,"binary"))),p||(i.isBuffer(h)&&(h=h.toString(e.encoding)),h=h.trim());try{var m=c.headers["content-type"];u=p?s(h):/json/.test(m)||"{"===h.charAt(0)?JSON.parse(h):/xml/.test(m)||"<"===h.charAt(0)?a(h):o(h)}catch(e){t(new Error("error parsing font "+e.message)),t=r}t(null,u)}))}}).call(this,e("buffer").Buffer)},{"./lib/is-binary":26,buffer:7,"parse-bmfont-ascii":28,"parse-bmfont-binary":29,"parse-bmfont-xml":30,xhr:51,xtend:53}],26:[function(e,t,i){(function(i){var n=e("buffer-equal"),r=new i([66,77,70,3]);t.exports=function(e){return"string"==typeof e?"BMF"===e.substring(0,3):e.length>4&&n(e.slice(0,4),r)}}).call(this,e("buffer").Buffer)},{buffer:7,"buffer-equal":6}],27:[function(e,t,i){"use strict";var n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var c in i=Object(arguments[l]))r.call(i,c)&&(s[c]=i[c]);if(n){a=n(i);for(var h=0;h<a.length;h++)o.call(i,a[h])&&(s[a[h]]=i[a[h]])}}return s}},{}],28:[function(e,t,i){function n(e,t){if(!(e=e.replace(/\t+/g," ").trim()))return null;var i=e.indexOf(" ");if(-1===i)throw new Error("no named row at line "+t);var n=e.substring(0,i);e=(e=(e=(e=e.substring(i+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map((function(e){return e.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)}));for(var o=[],a=0;a<e.length;a++){var s=e[a];0===a?o.push({key:s[0],data:""}):a===e.length-1?o[o.length-1].data=r(s[0]):(o[o.length-1].data=r(s[0]),o.push({key:s[1],data:""}))}var l={key:n,data:{}};return o.forEach((function(e){l.data[e.key]=e.data})),l}function r(e){return e&&0!==e.length?0===e.indexOf('"')||0===e.indexOf("'")?e.substring(1,e.length-1):-1!==e.indexOf(",")?function(e){return e.split(",").map((function(e){return parseInt(e,10)}))}(e):parseInt(e,10):""}t.exports=function(e){if(!e)throw new Error("no data provided");var t={pages:[],chars:[],kernings:[]},i=(e=e.toString().trim()).split(/\r\n?|\n/g);if(0===i.length)throw new Error("no data in BMFont file");for(var r=0;r<i.length;r++){var o=n(i[r],r);if(o)if("page"===o.key){if("number"!=typeof o.data.id)throw new Error("malformed file at line "+r+" -- needs page id=N");if("string"!=typeof o.data.file)throw new Error("malformed file at line "+r+' -- needs page file="path"');t.pages[o.data.id]=o.data.file}else"chars"===o.key||"kernings"===o.key||("char"===o.key?t.chars.push(o.data):"kerning"===o.key?t.kernings.push(o.data):t[o.key]=o.data)}return t}},{}],29:[function(e,t,i){var n=[66,77,70];function r(e,t,i){if(i>t.length-1)return 0;var n=t.readUInt8(i++),r=t.readInt32LE(i);switch(i+=4,n){case 1:e.info=function(e,t){var i={};i.size=e.readInt16LE(t);var n=e.readUInt8(t+2);return i.smooth=n>>7&1,i.unicode=n>>6&1,i.italic=n>>5&1,i.bold=n>>4&1,n>>3&1&&(i.fixedHeight=1),i.charset=e.readUInt8(t+3)||"",i.stretchH=e.readUInt16LE(t+4),i.aa=e.readUInt8(t+6),i.padding=[e.readInt8(t+7),e.readInt8(t+8),e.readInt8(t+9),e.readInt8(t+10)],i.spacing=[e.readInt8(t+11),e.readInt8(t+12)],i.outline=e.readUInt8(t+13),i.face=function(e,t){return o(e,t).toString("utf8")}(e,t+14),i}(t,i);break;case 2:e.common=function(e,t){var i={};return i.lineHeight=e.readUInt16LE(t),i.base=e.readUInt16LE(t+2),i.scaleW=e.readUInt16LE(t+4),i.scaleH=e.readUInt16LE(t+6),i.pages=e.readUInt16LE(t+8),e.readUInt8(t+10),i.packed=0,i.alphaChnl=e.readUInt8(t+11),i.redChnl=e.readUInt8(t+12),i.greenChnl=e.readUInt8(t+13),i.blueChnl=e.readUInt8(t+14),i}(t,i);break;case 3:e.pages=function(e,t,i){for(var n=[],r=o(e,t),a=r.length+1,s=i/a,l=0;l<s;l++)n[l]=e.slice(t,t+r.length).toString("utf8"),t+=a;return n}(t,i,r);break;case 4:e.chars=function(e,t,i){for(var n=[],r=i/20,o=0;o<r;o++){var a={},s=20*o;a.id=e.readUInt32LE(t+0+s),a.x=e.readUInt16LE(t+4+s),a.y=e.readUInt16LE(t+6+s),a.width=e.readUInt16LE(t+8+s),a.height=e.readUInt16LE(t+10+s),a.xoffset=e.readInt16LE(t+12+s),a.yoffset=e.readInt16LE(t+14+s),a.xadvance=e.readInt16LE(t+16+s),a.page=e.readUInt8(t+18+s),a.chnl=e.readUInt8(t+19+s),n[o]=a}return n}(t,i,r);break;case 5:e.kernings=function(e,t,i){for(var n=[],r=i/10,o=0;o<r;o++){var a={},s=10*o;a.first=e.readUInt32LE(t+0+s),a.second=e.readUInt32LE(t+4+s),a.amount=e.readInt16LE(t+8+s),n[o]=a}return n}(t,i,r)}return 5+r}function o(e,t){for(var i=t;i<e.length&&0!==e[i];i++);return e.slice(t,i)}t.exports=function(e){if(e.length<6)throw new Error("invalid buffer length for BMFont");var t=n.every((function(t,i){return e.readUInt8(i)===t}));if(!t)throw new Error("BMFont missing BMF byte header");var i=3;if(e.readUInt8(i++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var o={kernings:[],chars:[]},a=0;a<5;a++)i+=r(o,e,i);return o}},{}],30:[function(e,t,i){var n=e("./parse-attribs"),r=e("xml-parse-from-string"),o={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function a(e){return function(e){for(var t=[],i=0;i<e.attributes.length;i++)t.push(e.attributes[i]);return t}(e).reduce((function(e,t){return e[(i=t.nodeName,o[i.toLowerCase()]||i)]=t.nodeValue,e;var i}),{})}t.exports=function(e){e=e.toString();var t=r(e),i={pages:[],chars:[],kernings:[]};["info","common"].forEach((function(e){var r=t.getElementsByTagName(e)[0];r&&(i[e]=n(a(r)))}));var o=t.getElementsByTagName("pages")[0];if(!o)throw new Error("malformed file -- no <pages> element");for(var s=o.getElementsByTagName("page"),l=0;l<s.length;l++){var c=s[l],h=parseInt(c.getAttribute("id"),10),u=c.getAttribute("file");if(isNaN(h))throw new Error('malformed file -- page "id" attribute is NaN');if(!u)throw new Error('malformed file -- needs page "file" attribute');i.pages[parseInt(h,10)]=u}return["chars","kernings"].forEach((function(e){var r=t.getElementsByTagName(e)[0];if(r)for(var o=e.substring(0,e.length-1),s=r.getElementsByTagName(o),l=0;l<s.length;l++){var c=s[l];i[e].push(n(a(c)))}})),i}},{"./parse-attribs":31,"xml-parse-from-string":52}],31:[function(e,t,i){var n="chasrset";t.exports=function(e){for(var t in n in e&&(e.charset=e[n],delete e[n]),e)"face"!==t&&"charset"!==t&&(e[t]="padding"===t||"spacing"===t?e[t].split(",").map((function(e){return parseInt(e,10)})):parseInt(e[t],10));return e}},{}],32:[function(e,t,i){var n=e("trim"),r=e("for-each");t.exports=function(e){if(!e)return{};var t={};return r(n(e).split("\n"),(function(e){var i,r=e.indexOf(":"),o=n(e.slice(0,r)).toLowerCase(),a=n(e.slice(r+1));void 0===t[o]?t[o]=a:(i=t[o],"[object Array]"===Object.prototype.toString.call(i)?t[o].push(a):t[o]=[t[o],a])})),t}},{"for-each":16,trim:48}],33:[function(e,t,i){(function(e){var i=e.performance||{},n=function(){for(var e=["now","webkitNow","msNow","mozNow","oNow"];e.length;){var t=e.shift();if(t in i)return i[t].bind(i)}var n=Date.now||function(){return(new Date).getTime()},r=(i.timing||{}).navigationStart||n();return function(){return n()-r}}();n.performanceNow=i.now,n.noConflict=function(){i.now=n.performanceNow},n.conflict=function(){i.now=n},n.conflict(),t.exports=n}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,t,i){(function(e){!function(i){var n=setTimeout,r="function"==typeof e&&e||function(e){n(e,1)};function o(e,t){return function(){e.apply(t,arguments)}}var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],p(e,o(c,this),o(h,this))}function l(e){var t=this;null!==this._state?r((function(){var i=t._state?e.onFulfilled:e.onRejected;if(null!==i){var n;try{n=i(t._value)}catch(t){return void e.reject(t)}e.resolve(n)}else(t._state?e.resolve:e.reject)(t._value)})):this._deferreds.push(e)}function c(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void p(o(t,e),o(c,this),o(h,this))}this._state=!0,this._value=e,u.call(this)}catch(e){h.call(this,e)}}function h(e){this._state=!1,this._value=e,u.call(this)}function u(){for(var e=0,t=this._deferreds.length;e<t;e++)l.call(this,this._deferreds[e]);this._deferreds=null}function d(e,t,i,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=i,this.reject=n}function p(e,t,i){var n=!1;try{e((function(e){n||(n=!0,t(e))}),(function(e){n||(n=!0,i(e))}))}catch(e){if(n)return;n=!0,i(e)}}s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var i=this;return new s((function(n,r){l.call(i,new d(e,t,n,r))}))},s.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&a(arguments[0])?arguments[0]:arguments);return new s((function(t,i){if(0===e.length)return t([]);var n=e.length;function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,(function(e){r(o,e)}),i)}e[o]=a,0==--n&&t(e)}catch(e){i(e)}}for(var o=0;o<e.length;o++)r(o,e[o])}))},s.resolve=function(e){return e&&"object"==typeof e&&e.constructor===s?e:new s((function(t){t(e)}))},s.reject=function(e){return new s((function(t,i){i(e)}))},s.race=function(e){return new s((function(t,i){for(var n=0,r=e.length;n<r;n++)e[n].then(t,i)}))},s._setImmediateFn=function(e){r=e},void 0!==t&&t.exports?t.exports=s:i.Promise||(i.Promise=s)}(this)}).call(this,e("timers").setImmediate)},{timers:46}],35:[function(e,t,i){var n=e("dtype"),r=e("an-array"),o=e("is-buffer"),a=[0,2,3],s=[2,1,3];t.exports=function(e,t){e&&(r(e)||o(e))||(t=e||{},e=null);for(var i="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",l="number"==typeof t.count?t.count:1,c=t.start||0,h=!1!==t.clockwise?a:s,u=h[0],d=h[1],p=h[2],f=6*l,m=e||new(n(i))(f),v=0,g=0;v<f;v+=6,g+=4){var y=v+c;m[y+0]=g+0,m[y+1]=g+1,m[y+2]=g+2,m[y+3]=g+u,m[y+4]=g+d,m[y+5]=g+p}return m}},{"an-array":1,dtype:14,"is-buffer":20}],36:[function(e,t,i){"use strict";var n={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},r={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},o=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],a={CSS:{},springs:{}};function s(e,t,i){return Math.min(Math.max(e,t),i)}function l(e,t){return e.indexOf(t)>-1}function c(e,t){return e.apply(null,t)}var h=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,u=/^rgb/,d=/^hsl/,p={arr:function(e){return Array.isArray(e)},obj:function(e){return l(Object.prototype.toString.call(e),"Object")},pth:function(e){return p.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||p.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},hex:function(e){return h.test(e)},rgb:function(e){return u.test(e)},hsl:function(e){return d.test(e)},col:function(e){return p.hex(e)||p.rgb(e)||p.hsl(e)},key:function(e){return!n.hasOwnProperty(e)&&!r.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}},f=/\(([^)]+)\)/;function m(e){var t=f.exec(e);return t?t[1].split(",").map((function(e){return parseFloat(e)})):[]}function v(e,t){var i=m(e),n=s(p.und(i[0])?1:i[0],.1,100),r=s(p.und(i[1])?100:i[1],.1,100),o=s(p.und(i[2])?10:i[2],.1,100),l=s(p.und(i[3])?0:i[3],.1,100),c=Math.sqrt(r/n),h=o/(2*Math.sqrt(r*n)),u=h<1?c*Math.sqrt(1-h*h):0,d=1,f=h<1?(h*c-l)/u:-l+c;function v(e){var i=t?t*e/1e3:e;return i=h<1?Math.exp(-i*h*c)*(d*Math.cos(u*i)+f*Math.sin(u*i)):(d+f*i)*Math.exp(-i*c),0===e||1===e?e:1-i}return t?v:function(){var t=a.springs[e];if(t)return t;for(var i=1/6,n=0,r=0;;)if(1===v(n+=i)){if(++r>=16)break}else r=0;var o=n*i*1e3;return a.springs[e]=o,o}}function g(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var i=s(e,1,10),n=s(t,.1,2);return function(e){return 0===e||1===e?e:-i*Math.pow(2,10*(e-1))*Math.sin((e-1-n/(2*Math.PI)*Math.asin(1/i))*(2*Math.PI)/n)}}function y(e){return void 0===e&&(e=10),function(t){return Math.round(t*e)*(1/e)}}var b=function(){var e=.1;function t(e,t){return 1-3*t+3*e}function i(e,t){return 3*t-6*e}function n(e){return 3*e}function r(e,r,o){return((t(r,o)*e+i(r,o))*e+n(r))*e}function o(e,r,o){return 3*t(r,o)*e*e+2*i(r,o)*e+n(r)}return function(t,i,n,a){if(0<=t&&t<=1&&0<=n&&n<=1){var s=new Float32Array(11);if(t!==i||n!==a)for(var l=0;l<11;++l)s[l]=r(l*e,t,n);return function(l){return t===i&&n===a||0===l||1===l?l:r(function(i){for(var a=0,l=1,c=10;l!==c&&s[l]<=i;++l)a+=e;--l;var h=a+(i-s[l])/(s[l+1]-s[l])*e,u=o(h,t,n);return u>=.001?function(e,t,i,n){for(var a=0;a<4;++a){var s=o(t,i,n);if(0===s)return t;t-=(r(t,i,n)-e)/s}return t}(i,h,t,n):0===u?h:function(e,t,i,n,o){var a,s,l=0;do{(a=r(s=t+(i-t)/2,n,o)-e)>0?i=s:t=s}while(Math.abs(a)>1e-7&&++l<10);return s}(i,a,a+e,t,n)}(l),i,a)}}}}(),A=function(){var e=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],t={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],g],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(e,t){return function(i){return 1-g(e,t)(1-i)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(e,t){return function(i){return i<.5?g(e,t)(2*i)/2:1-g(e,t)(-2*i+2)/2}}]},i={linear:[.25,.25,.75,.75]};for(var n in t)for(var r=0,o=t[n].length;r<o;r++)i["ease"+n+e[r]]=t[n][r];return i}();function w(e,t){if(p.fnc(e))return e;var i=e.split("(")[0],n=A[i],r=m(e);switch(i){case"spring":return v(e,t);case"cubicBezier":return c(b,r);case"steps":return c(y,r);default:return p.fnc(n)?c(n,r):c(b,n)}}function x(e){try{return document.querySelectorAll(e)}catch(e){return}}var E=[];function _(e,t){for(var i=E,n=e.length,r=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)if(o in e){var a=e[o];t.call(r,a,o,e)&&i.push(a)}return(E=e).length=0,i}function M(e,t){t||(t=[]);for(var i=0,n=e.length;i<n;i++){var r=e[i];Array.isArray(r)?M(r,t):t.push(r)}return t}function T(e){return p.arr(e)?e:(p.str(e)&&(e=x(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function S(e,t){return e.some((function(e){return e===t}))}function C(e){var t={};for(var i in e)t[i]=e[i];return t}function L(e,t){var i=C(e);for(var n in e)i[n]=t.hasOwnProperty(n)?t[n]:e[n];return i}function R(e,t){var i=C(e);for(var n in t)i[n]=p.und(e[n])?t[n]:e[n];return i}var D=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;var P=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,O=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;var I=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,k=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function B(e){return p.rgb(e)?(t=e,(i=D.exec(t))?"rgba("+i[1]+",1)":t):p.hex(e)?function(e){var t=e.replace(P,(function(e,t,i,n){return t+t+i+i+n+n})),i=O.exec(t);return"rgba("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+",1)"}(e):p.hsl(e)?function(e){var t,i,n,r=I.exec(e)||k.exec(e),o=parseInt(r[1],10)/360,a=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100,l=r[4]||1;function c(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(0==a)t=i=n=s;else{var h=s<.5?s*(1+a):s+a-s*a,u=2*s-h;t=c(u,h,o+1/3),i=c(u,h,o),n=c(u,h,o-1/3)}return"rgba("+255*t+","+255*i+","+255*n+","+l+")"}(e):void 0;var t,i}var N=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function F(e){var t=N.exec(e);if(t)return t[2]}function H(e,t){return p.fnc(e)?e(t.target,t.id,t.total):e}function U(e,t){return e.getAttribute(t)}function j(e,t,i){if(S([i,"deg","rad","turn"],F(t)))return t;var n=a.CSS[t+i];if(!p.und(n))return n;var r=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(r),r.style.position="absolute",r.style.width=100+i;var s=100/r.offsetWidth;o.removeChild(r);var l=s*parseFloat(t);return a.CSS[t+i]=l,l}function z(e,t,i){if(t in e.style){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(n)||"0";return i?j(e,r,i):r}}function G(e,t){return p.dom(e)&&!p.inp(e)&&(U(e,t)||p.svg(e)&&e[t])?"attribute":p.dom(e)&&S(o,t)?"transform":p.dom(e)&&"transform"!==t&&z(e,t)?"css":null!=e[t]?"object":void 0}var V=/(\w+)\(([^)]*)\)/g;function W(e){if(p.dom(e)){for(var t,i=e.style.transform||"",n=new Map;t=V.exec(i);)n.set(t[1],t[2]);return n}}function q(e,t,i,n){var r=l(t,"scale")?1:0+function(e){return l(e,"translate")||"perspective"===e?"px":l(e,"rotate")||l(e,"skew")?"deg":void 0}(t),o=W(e).get(t)||r;return i&&(i.transforms.list.set(t,o),i.transforms.last=t),n?j(e,o,n):o}function X(e,t,i,n){switch(G(e,t)){case"transform":return q(e,t,n,i);case"css":return z(e,t,i);case"attribute":return U(e,t);default:return e[t]||0}}var Y=/^(\*=|\+=|-=)/;function K(e,t){var i=Y.exec(e);if(!i)return e;var n=F(e)||0,r=parseFloat(t),o=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return r+o+n;case"-":return r-o+n;case"*":return r*o+n}}var Q=/\s/g;function Z(e,t){if(p.col(e))return B(e);var i=F(e),n=i?e.substr(0,e.length-i.length):e;return t&&!Q.test(e)?n+t:n}function J(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function $(e){for(var t,i=e.points,n=0,r=0;r<i.numberOfItems;r++){var o=i.getItem(r);r>0&&(n+=J(t,o)),t=o}return n}function ee(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*U(e,"r")}(e);case"rect":return function(e){return 2*U(e,"width")+2*U(e,"height")}(e);case"line":return function(e){return J({x:U(e,"x1"),y:U(e,"y1")},{x:U(e,"x2"),y:U(e,"y2")})}(e);case"polyline":return $(e);case"polygon":return function(e){var t=e.points;return $(e)+J(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function te(e,t){var i=t||{},n=i.el||function(e){for(var t=e.parentNode;p.svg(t)&&(t=t.parentNode,p.svg(t.parentNode)););return t}(e),r=n.getBoundingClientRect(),o=U(n,"viewBox"),a=r.width,s=r.height,l=i.viewBox||(o?o.split(" "):[0,0,a,s]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:s/l[3]}}function ie(e,t){function i(i){void 0===i&&(i=0);var n=t+i>=1?t+i:0;return e.el.getPointAtLength(n)}var n=te(e.el,e.svg),r=i(),o=i(-1),a=i(1);switch(e.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return 180*Math.atan2(a.y-o.y,a.x-o.x)/Math.PI}}var ne=/-?\d*\.?\d+/g;function re(e,t){var i=Z(p.pth(e)?e.totalLength:e,t)+"";return{original:i,numbers:i.match(ne)?i.match(ne).map(Number):[0],strings:p.str(e)||t?i.split(ne):[]}}function oe(e){return _(e?M(p.arr(e)?e.map(T):T(e)):[],(function(e,t,i){return i.indexOf(e)===t}))}function ae(e){var t=oe(e);return t.map((function(e,i){return{target:e,id:i,total:t.length,transforms:{list:W(e)}}}))}var se=/^spring/;function le(e,t){var i=C(t);if(se.test(i.easing)&&(i.duration=v(i.easing)),p.arr(e)){var n=e.length;2!==n||p.obj(e[0])?p.fnc(t.duration)||(i.duration=t.duration/n):e={value:e}}var r=p.arr(e)?e:[e];return r.map((function(e,i){var n=p.obj(e)&&!p.pth(e)?e:{value:e};return p.und(n.delay)&&(n.delay=i?0:t.delay),p.und(n.endDelay)&&(n.endDelay=i===r.length-1?t.endDelay:0),n})).map((function(e){return R(e,i)}))}function ce(e,t){var i=[],n=t.keyframes;for(var r in n&&(t=R(function(e){for(var t=_(M(e.map((function(e){return Object.keys(e)}))),(function(e){return p.key(e)})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),i={},n=function(n){var r=t[n];i[r]=e.map((function(e){var t={};for(var i in e)p.key(i)?i==r&&(t.value=e[i]):t[i]=e[i];return t}))},r=0;r<t.length;r++)n(r);return i}(n),t)),t)p.key(r)&&i.push({name:r,tweens:le(t[r],e)});return i}function he(e,t){var i;return e.tweens.map((function(n){var r=function(e,t){var i={};for(var n in e){var r=H(e[n],t);p.arr(r)&&1===(r=r.map((function(e){return H(e,t)}))).length&&(r=r[0]),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}(n,t),o=r.value,a=p.arr(o)?o[1]:o,s=F(a),l=X(t.target,e.name,s,t),c=i?i.to.original:l,h=p.arr(o)?o[0]:c,u=F(h)||F(l),d=s||u;return p.und(a)&&(a=c),r.from=re(h,d),r.to=re(K(a,h),d),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=w(r.easing,r.duration),r.isPath=p.pth(o),r.isColor=p.col(r.from.original),r.isColor&&(r.round=1),i=r,r}))}var ue={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,n,r){if(n.list.set(t,i),t===n.last||r){var o="";n.list.forEach((function(e,t){o+=t+"("+e+") "})),e.style.transform=o}}};function de(e,t){for(var i=ae(e),n=0,r=i.length;n<r;n++){var o=i[n];for(var a in t){var s=H(t[a],o),l=o.target,c=F(s),h=X(l,a,c,o),u=K(Z(s,c||F(h)),h),d=G(l,a);ue[d](l,a,u,o.transforms,!0)}}}function pe(e,t){return _(M(e.map((function(e){return t.map((function(t){return function(e,t){var i=G(e.target,t.name);if(i){var n=he(t,e),r=n[n.length-1];return{type:i,property:t.name,animatable:e,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}(e,t)}))}))),(function(e){return!p.und(e)}))}function fe(e,t){var i=e.length,n=function(e){return e.timelineOffset?e.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,e.map((function(e){return n(e)+e.duration}))):t.duration,r.delay=i?Math.min.apply(Math,e.map((function(e){return n(e)+e.delay}))):t.delay,r.endDelay=i?r.duration-Math.max.apply(Math,e.map((function(e){return n(e)+e.duration-e.endDelay}))):t.endDelay,r}var me=0;var ve,ge=[],ye=[],be=function(){function e(){ve=requestAnimationFrame(t)}function t(t){var i=ge.length;if(i){for(var n=0;n<i;){var r=ge[n];if(r.paused){var o=ge.indexOf(r);o>-1&&(ge.splice(o,1),i=ge.length)}else r.tick(t);n++}e()}else ve=cancelAnimationFrame(ve)}return e}();function Ae(e){void 0===e&&(e={});var t,i=0,o=0,a=0,l=0,c=null;function h(){return window.Promise&&new Promise((function(e){return c=e}))}var u=h(),d=function(e){var t=L(n,e),i=L(r,e),o=ce(i,e),a=ae(e.targets),s=pe(a,o),l=fe(s,i),c=me;return me++,R(t,{id:c,children:[],animatables:a,animations:s,duration:l.duration,delay:l.delay,endDelay:l.endDelay})}(e);function p(){d.reversed=!d.reversed;for(var e=0,i=t.length;e<i;e++)t[e].reversed=d.reversed}function f(e){return d.reversed?d.duration-e:e}function m(){i=0,o=f(d.currentTime)*(1/Ae.speed)}function v(e,t){t&&t.seek(e-t.timelineOffset)}function g(e){for(var t=0,i=d.animations,n=i.length;t<n;){var r=i[t],o=r.animatable,a=r.tweens,l=a.length-1,c=a[l];l&&(c=_(a,(function(t){return e<t.end}))[0]||c);for(var h=s(e-c.start-c.delay,0,c.duration)/c.duration,u=isNaN(h)?1:c.easing(h),p=c.to.strings,f=c.round,m=[],v=c.to.numbers.length,g=void 0,y=0;y<v;y++){var b=void 0,A=c.to.numbers[y],w=c.from.numbers[y]||0;b=c.isPath?ie(c.value,u*A):w+u*(A-w),f&&(c.isColor&&y>2||(b=Math.round(b*f)/f)),m.push(b)}var x=p.length;if(x){g=p[0];for(var E=0;E<x;E++){p[E];var M=p[E+1],T=m[E];isNaN(T)||(g+=M?T+M:T+" ")}}else g=m[0];ue[r.type](o.target,r.property,g,o.transforms),r.currentValue=g,t++}}function y(e){d[e]&&!d.passThrough&&d[e](d)}function b(e){var n=d.duration,r=d.delay,m=n-d.endDelay,b=f(e);d.progress=s(b/n*100,0,100),d.reversePlayback=b<d.currentTime,t&&function(e){if(d.reversePlayback)for(var i=l;i--;)v(e,t[i]);else for(var n=0;n<l;n++)v(e,t[n])}(b),!d.began&&d.currentTime>0&&(d.began=!0,y("begin"),y("loopBegin")),b<=r&&0!==d.currentTime&&g(0),(b>=m&&d.currentTime!==n||!n)&&g(n),b>r&&b<m?(d.changeBegan||(d.changeBegan=!0,d.changeCompleted=!1,y("changeBegin")),y("change"),g(b)):d.changeBegan&&(d.changeCompleted=!0,d.changeBegan=!1,y("changeComplete")),d.currentTime=s(b,0,n),d.began&&y("update"),e>=n&&(o=0,d.remaining&&!0!==d.remaining&&d.remaining--,d.remaining?(i=a,y("loopComplete"),y("loopBegin"),"alternate"===d.direction&&p()):(d.paused=!0,d.completed||(d.completed=!0,y("loopComplete"),y("complete"),"Promise"in window&&(c(),u=h()))))}return d.reset=function(){var e=d.direction;d.passThrough=!1,d.currentTime=0,d.progress=0,d.paused=!0,d.began=!1,d.changeBegan=!1,d.completed=!1,d.changeCompleted=!1,d.reversePlayback=!1,d.reversed="reverse"===e,d.remaining=d.loop,t=d.children;for(var i=l=t.length;i--;)d.children[i].reset();(d.reversed&&!0!==d.loop||"alternate"===e&&1===d.loop)&&d.remaining++,g(0)},d.set=function(e,t){return de(e,t),d},d.tick=function(e){a=e,i||(i=a),b((a+(o-i))*Ae.speed)},d.seek=function(e){b(f(e))},d.pause=function(){d.paused=!0,m()},d.play=function(){d.paused&&(d.paused=!1,ge.push(d),m(),ve||be())},d.reverse=function(){p(),m()},d.restart=function(){d.reset(),d.play()},d.finished=u,d.reset(),d.autoplay&&d.play(),d}function we(e,t){for(var i=t.length;i--;)S(e,t[i].animatable.target)&&t.splice(i,1)}document.addEventListener("visibilitychange",(function(){if(document.hidden){for(var e=0,t=ge.length;e<t;e++)activeInstance[e].pause();ye=ge.slice(0),ge=[]}else for(var i=0,n=ye.length;i<n;i++)ye[i].play()})),Ae.version="3.0.0",Ae.speed=1,Ae.running=ge,Ae.remove=function(e){for(var t=oe(e),i=ge.length;i--;){var n=ge[i],r=n.animations,o=n.children;we(t,r);for(var a=o.length;a--;){var s=o[a],l=s.animations;we(t,l),l.length||s.children.length||o.splice(a,1)}r.length||o.length||n.pause()}},Ae.get=X,Ae.set=de,Ae.convertPx=j,Ae.path=function(e,t){var i=p.str(e)?x(e)[0]:e,n=t||100;return function(e){return{property:e,el:i,svg:te(i),totalLength:ee(i)*(n/100)}}},Ae.setDashoffset=function(e){var t=ee(e);return e.setAttribute("stroke-dasharray",t),t},Ae.stagger=function(e,t){void 0===t&&(t={});var i=t.direction||"normal",n=t.easing?w(t.easing):null,r=t.grid,o=t.axis,a=t.from||0,s="first"===a,l="center"===a,c="last"===a,h=p.arr(e),u=h?parseFloat(e[0]):parseFloat(e),d=h?parseFloat(e[1]):0,f=F(h?e[1]:e)||0,m=t.start||0+(h?u:0),v=[],g=0;return function(e,t,p){if(s&&(a=0),l&&(a=(p-1)/2),c&&(a=p-1),!v.length){for(var y=0;y<p;y++){if(r){var b=l?(r[0]-1)/2:a%r[0],A=l?(r[1]-1)/2:Math.floor(a/r[0]),w=b-y%r[0],x=A-Math.floor(y/r[0]),E=Math.sqrt(w*w+x*x);"x"===o&&(E=-w),"y"===o&&(E=-x),v.push(E)}else v.push(Math.abs(a-y));g=Math.max.apply(Math,v)}n&&(v=v.map((function(e){return n(e/g)*g}))),"reverse"===i&&(v=v.map((function(e){return o?e<0?-1*e:-e:Math.abs(g-e)})))}return m+(h?(d-u)/g:u)*(Math.round(100*v[t])/100)+f}},Ae.timeline=function(e){void 0===e&&(e={});var t=Ae(e);return t.duration=0,t.add=function(i,n){var o=ge.indexOf(t),a=t.children;function s(e){e.passThrough=!0}o>-1&&ge.splice(o,1);for(var l=0;l<a.length;l++)s(a[l]);var c=R(i,L(r,e));c.targets=c.targets||e.targets;var h=t.duration;c.autoplay=!1,c.direction=t.direction,c.timelineOffset=p.und(n)?h:K(n,h),s(t),t.seek(c.timelineOffset);var u=Ae(c);s(u),a.push(u);var d=fe(a,e);return t.delay=d.delay,t.endDelay=d.endDelay,t.duration=d.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},Ae.easing=w,Ae.penner=A,Ae.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},t.exports=Ae},{}],37:[function(e,t,i){var n,r;n=this,r=function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t});var t="111dev",i=0,n=1,r=2,o=1,a=2,s=3,l=0,c=1,h=2,u=0,d=2,p=0,f=1,m=2,v=3,g=4,y=5,b=100,A=101,w=102,x=103,E=104,_=200,M=201,T=202,S=203,C=204,L=205,R=206,D=207,P=208,O=209,I=210,k=0,B=1,N=2,F=3,H=4,U=5,j=6,z=7,G=0,V=1,W=2,q=0,X=1,Y=2,K=3,Q=4,Z=5,J=300,$=301,ee=302,te=303,ie=304,ne=305,re=306,oe=307,ae=1e3,se=1001,le=1002,ce=1003,he=1004,ue=1005,de=1006,pe=1007,fe=1008,me=1009,ve=1010,ge=1011,ye=1012,be=1013,Ae=1014,we=1015,xe=1016,Ee=1017,_e=1018,Me=1019,Te=1020,Se=1021,Ce=1022,Le=1023,Re=1024,De=1025,Pe=Le,Oe=1026,Ie=1027,ke=1028,Be=33776,Ne=33777,Fe=33778,He=33779,Ue=35840,je=35841,ze=35842,Ge=35843,Ve=36196,We=37808,qe=37809,Xe=37810,Ye=37811,Ke=37812,Qe=37813,Ze=37814,Je=37815,$e=37816,et=37817,tt=37818,it=37819,nt=37820,rt=37821,ot=2300,at=2301,st=2302,lt=2400,ct=2401,ht=2402,ut=3e3,dt=3001,pt=3007,ft=3002,mt=3003,vt=3004,gt=3005,yt=3006,bt=3200,At=3201,wt=0,xt=1,Et=7680,_t=519,Mt=35044,Tt=35048;function St(){}Object.assign(St.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),n=0,r=i.length;n<r;n++)i[n].call(this,e)}}}});for(var Ct=[],Lt=0;Lt<256;Lt++)Ct[Lt]=(Lt<16?"0":"")+Lt.toString(16);var Rt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ct[255&e]+Ct[e>>8&255]+Ct[e>>16&255]+Ct[e>>24&255]+"-"+Ct[255&t]+Ct[t>>8&255]+"-"+Ct[t>>16&15|64]+Ct[t>>24&255]+"-"+Ct[63&i|128]+Ct[i>>8&255]+"-"+Ct[i>>16&255]+Ct[i>>24&255]+Ct[255&n]+Ct[n>>8&255]+Ct[n>>16&255]+Ct[n>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Rt.DEG2RAD},radToDeg:function(e){return e*Rt.RAD2DEG},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Dt(e,t){this.x=e||0,this.y=t||0}function Pt(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1}Object.defineProperties(Dt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Dt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}}),Object.assign(Pt,{slerp:function(e,t,i,n){return i.copy(e).slerp(t,n)},slerpFlat:function(e,t,i,n,r,o,a){var s=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(h!==f||s!==u||l!==d||c!==p){var m=1-a,v=s*u+l*d+c*p+h*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var b=Math.sqrt(y),A=Math.atan2(b,v*g);m=Math.sin(m*A)/b,a=Math.sin(a*A)/b}var w=a*g;if(s=s*m+u*w,l=l*m+d*w,c=c*m+p*w,h=h*m+f*w,m===1-a){var x=1/Math.sqrt(s*s+l*l+c*c+h*h);s*=x,l*=x,c*=x,h*=x}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=h}}),Object.defineProperties(Pt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Pt.prototype,{isQuaternion:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,n=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),u=s(i/2),d=s(n/2),p=s(r/2);return"XYZ"===o?(this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p):"YXZ"===o?(this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p):"ZXY"===o?(this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p):"ZYX"===o?(this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p):"YZX"===o?(this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p):"XZY"===o&&(this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],l=i[9],c=i[2],h=i[6],u=i[10],d=n+s+u;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(h-l)*t,this._y=(o-c)*t,this._z=(a-r)*t):n>s&&n>u?(t=2*Math.sqrt(1+n-s-u),this._w=(h-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+c)/t):s>u?(t=2*Math.sqrt(1+s-n-u),this._w=(o-c)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+u-n-s),this._w=(a-r)/t,this._x=(o+c)/t,this._y=(l+h)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Rt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(0===i)return this;var n=Math.min(1,t/i);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+o*a+n*l-r*s,this._y=n*c+o*s+r*a-i*l,this._z=r*c+o*l+i*s-n*a,this._w=o*c-i*a-n*s-r*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*i+t*this._x,this._y=l*n+t*this._y,this._z=l*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),h=Math.atan2(c,a),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=n*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Ot=new kt,It=new Pt;function kt(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}Object.assign(kt.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(It.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(It.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*i,c=s*i+a*t-r*n,h=s*n+r*i-o*t,u=-r*t-o*i-a*n;return this.x=l*s+u*-r+c*-a-h*-o,this.y=c*s+u*-o+h*-r-l*-a,this.z=h*s+u*-a+l*-o-c*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return Ot.copy(this).projectOnVector(e),this.sub(Ot)},reflect:function(e){return this.sub(Ot.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var i=this.dot(e)/t;return Math.acos(Rt.clamp(i,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Bt,Nt=new kt;function Ft(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Ft.prototype,{isMatrix3:!0,set:function(e,t,i,n,r,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=r,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,i=e.count;t<i;t++)Nt.x=e.getX(t),Nt.y=e.getY(t),Nt.z=e.getZ(t),Nt.applyMatrix3(this),e.setXYZ(t,Nt.x,Nt.y,Nt.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],b=n[7],A=n[2],w=n[5],x=n[8];return r[0]=o*f+a*g+s*A,r[3]=o*m+a*y+s*w,r[6]=o*v+a*b+s*x,r[1]=l*f+c*g+h*A,r[4]=l*m+c*y+h*w,r[7]=l*v+c*b+h*x,r[2]=u*f+d*g+p*A,r[5]=u*m+d*y+p*w,r[8]=u*v+d*b+p*x,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-i*r*c+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,n=this.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=d*l-c*u,f=c*h-d*s,m=u*s-l*h,v=r*p+o*f+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(a*u-d*o)*y,n[2]=(c*o-a*l)*y,n[3]=f*y,n[4]=(d*r-a*h)*y,n[5]=(a*s-c*r)*y,n[6]=m*y,n[7]=(o*h-u*r)*y,n[8]=(l*r-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,n,r,o,a){var s=Math.cos(r),l=Math.sin(r);this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-n*l,n*s,-n*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],o=n[3],a=n[6],s=n[1],l=n[4],c=n[7];return n[0]=t*r+i*s,n[3]=t*o+i*l,n[6]=t*a+i*c,n[1]=-i*r+t*s,n[4]=-i*o+t*l,n[7]=-i*a+t*c,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var Ht={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Bt&&(Bt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Bt.width=e.width,Bt.height=e.height;var i=Bt.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Bt}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Ut=0;function jt(e,t,i,n,r,o,a,s,l,c){Object.defineProperty(this,"id",{value:Ut++}),this.uuid=Rt.generateUUID(),this.name="",this.image=void 0!==e?e:jt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:jt.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:se,this.wrapT=void 0!==n?n:se,this.magFilter=void 0!==r?r:de,this.minFilter=void 0!==o?o:fe,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Le,this.type=void 0!==s?s:me,this.offset=new Dt(0,0),this.repeat=new Dt(1,1),this.center=new Dt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ft,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:ut,this.version=0,this.onUpdate=null}function zt(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1}function Gt(e,t,i){this.width=e,this.height=t,this.scissor=new zt(0,0,e,t),this.scissorTest=!1,this.viewport=new zt(0,0,e,t),i=i||{},this.texture=new jt(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:de,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function Vt(e,t,i){Gt.call(this,e,t,i),this.samples=4}jt.DEFAULT_IMAGE=void 0,jt.DEFAULT_MAPPING=J,jt.prototype=Object.assign(Object.create(St.prototype),{constructor:jt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=Rt.generateUUID()),!t&&void 0===e.images[n.uuid]){var r;if(Array.isArray(n)){r=[];for(var o=0,a=n.length;o<a;o++)r.push(Ht.getDataURL(n[o]))}else r=Ht.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:r}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==J)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ae:e.x=e.x-Math.floor(e.x);break;case se:e.x=e.x<0?0:1;break;case le:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ae:e.y=e.y-Math.floor(e.y);break;case se:e.y=e.y<0?0:1;break;case le:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(jt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(zt.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(zt.prototype,{isVector4:!0,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,r,o=.01,a=.1,s=e.elements,l=s[0],c=s[4],h=s[8],u=s[1],d=s[5],p=s[9],f=s[2],m=s[6],v=s[10];if(Math.abs(c-u)<o&&Math.abs(h-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+u)<a&&Math.abs(h+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+v-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var g=(l+1)/2,y=(d+1)/2,b=(v+1)/2,A=(c+u)/4,w=(h+f)/4,x=(p+m)/4;return g>y&&g>b?g<o?(i=0,n=.707106781,r=.707106781):(n=A/(i=Math.sqrt(g)),r=w/i):y>b?y<o?(i=.707106781,n=0,r=.707106781):(i=A/(n=Math.sqrt(y)),r=x/n):b<o?(i=.707106781,n=.707106781,r=0):(i=w/(r=Math.sqrt(b)),n=x/r),this.set(i,n,r,t),this}var E=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(E)<.001&&(E=1),this.x=(m-p)/E,this.y=(h-f)/E,this.z=(u-c)/E,this.w=Math.acos((l+d+v-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Gt.prototype=Object.assign(Object.create(St.prototype),{constructor:Gt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Vt.prototype=Object.assign(Object.create(Gt.prototype),{constructor:Vt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Gt.prototype.copy.call(this,e),this.samples=e.samples,this}});var Wt=new kt,qt=new Jt,Xt=new kt(0,0,0),Yt=new kt(1,1,1),Kt=new kt,Qt=new kt,Zt=new kt;function Jt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Jt.prototype,{isMatrix4:!0,set:function(e,t,i,n,r,o,a,s,l,c,h,u,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=n,v[1]=r,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=h,v[14]=u,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Jt).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,i=e.elements,n=1/Wt.setFromMatrixColumn(e,0).length(),r=1/Wt.setFromMatrixColumn(e,1).length(),o=1/Wt.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){var u=o*c,d=o*h,p=a*c,f=a*h;t[0]=s*c,t[4]=-s*h,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-a*s,t[2]=f-u*l,t[6]=p+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,v=s*h,g=l*c,y=l*h;t[0]=m+y*a,t[4]=g*a-v,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=v*a-g,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order)m=s*c,v=s*h,g=l*c,y=l*h,t[0]=m-y*a,t[4]=-o*h,t[8]=g+v*a,t[1]=v+g*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s;else if("ZYX"===e.order)u=o*c,d=o*h,p=a*c,f=a*h,t[0]=s*c,t[4]=p*l-d,t[8]=u*l+f,t[1]=s*h,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=a*s,t[10]=o*s;else if("YZX"===e.order){var b=o*s,A=o*l,w=a*s,x=a*l;t[0]=s*c,t[4]=x-b*h,t[8]=w*h+A,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=A*h+w,t[10]=b-x*h}else"XZY"===e.order&&(b=o*s,A=o*l,w=a*s,x=a*l,t[0]=s*c,t[4]=-h,t[8]=l*c,t[1]=b*h+x,t[5]=o*c,t[9]=A*h-w,t[2]=w*h-A,t[6]=a*c,t[10]=x*h+b);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(Xt,e,Yt)},lookAt:function(e,t,i){var n=this.elements;return Zt.subVectors(e,t),0===Zt.lengthSq()&&(Zt.z=1),Zt.normalize(),Kt.crossVectors(i,Zt),0===Kt.lengthSq()&&(1===Math.abs(i.z)?Zt.x+=1e-4:Zt.z+=1e-4,Zt.normalize(),Kt.crossVectors(i,Zt)),Kt.normalize(),Qt.crossVectors(Zt,Kt),n[0]=Kt.x,n[4]=Qt.x,n[8]=Zt.x,n[1]=Kt.y,n[5]=Qt.y,n[9]=Zt.y,n[2]=Kt.z,n[6]=Qt.z,n[10]=Zt.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],v=i[14],g=i[3],y=i[7],b=i[11],A=i[15],w=n[0],x=n[4],E=n[8],_=n[12],M=n[1],T=n[5],S=n[9],C=n[13],L=n[2],R=n[6],D=n[10],P=n[14],O=n[3],I=n[7],k=n[11],B=n[15];return r[0]=o*w+a*M+s*L+l*O,r[4]=o*x+a*T+s*R+l*I,r[8]=o*E+a*S+s*D+l*k,r[12]=o*_+a*C+s*P+l*B,r[1]=c*w+h*M+u*L+d*O,r[5]=c*x+h*T+u*R+d*I,r[9]=c*E+h*S+u*D+d*k,r[13]=c*_+h*C+u*P+d*B,r[2]=p*w+f*M+m*L+v*O,r[6]=p*x+f*T+m*R+v*I,r[10]=p*E+f*S+m*D+v*k,r[14]=p*_+f*C+m*P+v*B,r[3]=g*w+y*M+b*L+A*O,r[7]=g*x+y*T+b*R+A*I,r[11]=g*E+y*S+b*D+A*k,r[15]=g*_+y*C+b*P+A*B,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,i=e.count;t<i;t++)Wt.x=e.getX(t),Wt.y=e.getY(t),Wt.z=e.getZ(t),Wt.applyMatrix4(this),e.setXYZ(t,Wt.x,Wt.y,Wt.z);return e},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*s*h-n*l*h-r*a*u+i*l*u+n*a*d-i*s*d)+e[7]*(+t*s*d-t*l*u+r*o*u-n*o*d+n*l*c-r*s*c)+e[11]*(+t*l*h-t*a*d-r*o*h+i*o*d+r*a*c-i*l*c)+e[15]*(-n*a*c-t*s*h+t*a*u+n*o*h-i*o*u+i*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,i){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],h=n[6],u=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],b=n[15],A=p*y*u-g*f*u+g*h*m-c*y*m-p*h*b+c*f*b,w=v*f*u-d*y*u-v*h*m+l*y*m+d*h*b-l*f*b,x=d*g*u-v*p*u+v*c*m-l*g*m-d*c*b+l*p*b,E=v*p*h-d*g*h-v*c*f+l*g*f+d*c*y-l*p*y,_=r*A+o*w+a*x+s*E;if(0===_){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var T=1/_;return i[0]=A*T,i[1]=(g*f*s-p*y*s-g*a*m+o*y*m+p*a*b-o*f*b)*T,i[2]=(c*y*s-g*h*s+g*a*u-o*y*u-c*a*b+o*h*b)*T,i[3]=(p*h*s-c*f*s-p*a*u+o*f*u+c*a*m-o*h*m)*T,i[4]=w*T,i[5]=(d*y*s-v*f*s+v*a*m-r*y*m-d*a*b+r*f*b)*T,i[6]=(v*h*s-l*y*s-v*a*u+r*y*u+l*a*b-r*h*b)*T,i[7]=(l*f*s-d*h*s+d*a*u-r*f*u-l*a*m+r*h*m)*T,i[8]=x*T,i[9]=(v*p*s-d*g*s-v*o*m+r*g*m+d*o*b-r*p*b)*T,i[10]=(l*g*s-v*c*s+v*o*u-r*g*u-l*o*b+r*c*b)*T,i[11]=(d*c*s-l*p*s-d*o*u+r*p*u+l*o*m-r*c*m)*T,i[12]=E*T,i[13]=(d*g*a-v*p*a+v*o*f-r*g*f-d*o*y+r*p*y)*T,i[14]=(v*c*a-l*g*a-v*o*h+r*g*h+l*o*y-r*c*y)*T,i[15]=(l*p*a-d*c*a+d*o*h-r*p*h-l*o*f+r*c*f)*T,this},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+i,c*s-n*o,0,l*s-n*a,c*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var n=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,c=o+o,h=a+a,u=r*l,d=r*c,p=r*h,f=o*c,m=o*h,v=a*h,g=s*l,y=s*c,b=s*h,A=i.x,w=i.y,x=i.z;return n[0]=(1-(f+v))*A,n[1]=(d+b)*A,n[2]=(p-y)*A,n[3]=0,n[4]=(d-b)*w,n[5]=(1-(u+v))*w,n[6]=(m+g)*w,n[7]=0,n[8]=(p+y)*x,n[9]=(m-g)*x,n[10]=(1-(u+f))*x,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(e,t,i){var n=this.elements,r=Wt.set(n[0],n[1],n[2]).length(),o=Wt.set(n[4],n[5],n[6]).length(),a=Wt.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],qt.copy(this);var s=1/r,l=1/o,c=1/a;return qt.elements[0]*=s,qt.elements[1]*=s,qt.elements[2]*=s,qt.elements[4]*=l,qt.elements[5]*=l,qt.elements[6]*=l,qt.elements[8]*=c,qt.elements[9]*=c,qt.elements[10]*=c,t.setFromRotationMatrix(qt),i.x=r,i.y=o,i.z=a,this},makePerspective:function(e,t,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=1/(t-e),l=1/(i-n),c=1/(o-r),h=(t+e)*s,u=(i+n)*l,d=(o+r)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});var $t=new Jt,ei=new Pt;function ti(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||ti.DefaultOrder}function ii(){this.mask=1}ti.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ti.DefaultOrder="XYZ",Object.defineProperties(ti.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(ti.prototype,{isEuler:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var n=Rt.clamp,r=e.elements,o=r[0],a=r[4],s=r[8],l=r[1],c=r[5],h=r[9],u=r[2],d=r[6],p=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-h,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,i){return $t.makeRotationFromQuaternion(e),this.setFromRotationMatrix($t,t,i)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return ei.setFromEuler(this),this.setFromQuaternion(ei,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new kt(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(ii.prototype,{set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},disableAll:function(){this.mask=0},test:function(e){return!!(this.mask&e.mask)}});var ni=0,ri=new kt,oi=new Pt,ai=new Jt,si=new kt,li=new kt,ci=new kt,hi=new Pt,ui=new kt(1,0,0),di=new kt(0,1,0),pi=new kt(0,0,1),fi={type:"added"},mi={type:"removed"};function vi(){Object.defineProperty(this,"id",{value:ni++}),this.uuid=Rt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=vi.DefaultUp.clone();var e=new kt,t=new ti,i=new Pt,n=new kt(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Jt},normalMatrix:{value:new Ft}}),this.matrix=new Jt,this.matrixWorld=new Jt,this.matrixAutoUpdate=vi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ii,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function gi(){vi.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}vi.DefaultUp=new kt(0,1,0),vi.DefaultMatrixAutoUpdate=!0,vi.prototype=Object.assign(Object.create(St.prototype),{constructor:vi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return oi.setFromAxisAngle(e,t),this.quaternion.multiply(oi),this},rotateOnWorldAxis:function(e,t){return oi.setFromAxisAngle(e,t),this.quaternion.premultiply(oi),this},rotateX:function(e){return this.rotateOnAxis(ui,e)},rotateY:function(e){return this.rotateOnAxis(di,e)},rotateZ:function(e){return this.rotateOnAxis(pi,e)},translateOnAxis:function(e,t){return ri.copy(e).applyQuaternion(this.quaternion),this.position.add(ri.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(ui,e)},translateY:function(e){return this.translateOnAxis(di,e)},translateZ:function(e){return this.translateOnAxis(pi,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(ai.getInverse(this.matrixWorld))},lookAt:function(e,t,i){e.isVector3?si.copy(e):si.set(e,t,i);var n=this.parent;this.updateWorldMatrix(!0,!1),li.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ai.lookAt(li,si,this.up):ai.lookAt(si,li,this.up),this.quaternion.setFromRotationMatrix(ai),n&&(ai.extractRotation(n.matrixWorld),oi.setFromRotationMatrix(ai),this.quaternion.premultiply(oi.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(fi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(mi)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),ai.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ai.multiply(e.parent.matrixWorld)),e.applyMatrix(ai),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new kt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Pt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(li,e,ci),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new kt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(li,hi,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new kt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,r=0,o=n.length;r<o;r++)n[r].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var c=a[s];r(e.shapes,c)}else r(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(s=0,l=this.material.length;s<l;s++)h.push(r(e.materials,this.material[s]));n.material=h}else n.material=r(e.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object);if(t){var u=m(e.geometries),d=m(e.materials),p=m(e.textures),f=m(e.images);a=m(e.shapes),u.length>0&&(i.geometries=u),d.length>0&&(i.materials=d),p.length>0&&(i.textures=p),f.length>0&&(i.images=f),a.length>0&&(i.shapes=a)}return i.object=n,i;function m(e){var t=[];for(var i in e){var n=e[i];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.meshIdx=e.meshIdx,this.skeleton=e.skeleton,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var n=e.children[i];this.add(n.clone())}return this}}),gi.prototype=Object.assign(Object.create(vi.prototype),{constructor:gi,isScene:!0,copy:function(e,t){return vi.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=vi.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var yi=[new kt,new kt,new kt,new kt,new kt,new kt,new kt,new kt],bi=new kt,Ai=new Di,wi=new kt,xi=new kt,Ei=new kt,_i=new kt,Mi=new kt,Ti=new kt,Si=new kt,Ci=new kt,Li=new kt,Ri=new kt;function Di(e,t){this.min=void 0!==e?e:new kt(1/0,1/0,1/0),this.max=void 0!==t?t:new kt(-1/0,-1/0,-1/0)}function Pi(e,t,i,n,r){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){Ri.fromArray(e,o);var s=r.x*Math.abs(Ri.x)+r.y*Math.abs(Ri.y)+r.z*Math.abs(Ri.z),l=t.dot(Ri),c=i.dot(Ri),h=n.dot(Ri);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>s)return!1}return!0}Object.assign(Di.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],h=e[s+1],u=e[s+2];c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(t,i,n),this.max.set(r,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),h=e.getY(s),u=e.getZ(s);c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(t,i,n),this.max.set(r,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var i=bi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new kt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new kt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Ai.copy(t.boundingBox),Ai.applyMatrix4(e.matrixWorld),this.expandByPoint(Ai.min),this.expandByPoint(Ai.max));for(var i=e.children,n=0,r=i.length;n<r;n++)this.expandByObject(i[n]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new kt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,bi),bi.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Si),Ci.subVectors(this.max,Si),wi.subVectors(e.a,Si),xi.subVectors(e.b,Si),Ei.subVectors(e.c,Si),_i.subVectors(xi,wi),Mi.subVectors(Ei,xi),Ti.subVectors(wi,Ei);var t=[0,-_i.z,_i.y,0,-Mi.z,Mi.y,0,-Ti.z,Ti.y,_i.z,0,-_i.x,Mi.z,0,-Mi.x,Ti.z,0,-Ti.x,-_i.y,_i.x,0,-Mi.y,Mi.x,0,-Ti.y,Ti.x,0];return!!Pi(t,wi,xi,Ei,Ci)&&!!Pi(t=[1,0,0,0,1,0,0,0,1],wi,xi,Ei,Ci)&&(Li.crossVectors(_i,Mi),Pi(t=[Li.x,Li.y,Li.z],wi,xi,Ei,Ci))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new kt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return bi.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(bi).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(yi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),yi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),yi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),yi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),yi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),yi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),yi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),yi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(yi)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Oi=new Di;function Ii(e,t){this.center=void 0!==e?e:new kt,this.radius=void 0!==t?t:0}Object.assign(Ii.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var i=this.center;void 0!==t?i.copy(t):Oi.setFromPoints(e).getCenter(i);for(var n=0,r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new kt),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Di),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var ki=new kt,Bi=new kt,Ni=new kt,Fi=new kt,Hi=new kt,Ui=new kt,ji=new kt;function zi(e,t){this.origin=void 0!==e?e:new kt,this.direction=void 0!==t?t:new kt(0,0,-1)}Object.assign(zi.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new kt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,ki)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new kt),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=ki.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ki.copy(this.direction).multiplyScalar(t).add(this.origin),ki.distanceToSquared(e))},distanceSqToSegment:function(e,t,i,n){Bi.copy(e).add(t).multiplyScalar(.5),Ni.copy(t).sub(e).normalize(),Fi.copy(this.origin).sub(Bi);var r,o,a,s,l=.5*e.distanceTo(t),c=-this.direction.dot(Ni),h=Fi.dot(this.direction),u=-Fi.dot(Ni),d=Fi.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(o=c*h-u,s=l*p,(r=c*u-h)>=0)if(o>=-s)if(o<=s){var f=1/p;a=(r*=f)*(r+c*(o*=f)+2*h)+o*(c*r+o+2*u)+d}else o=l,a=-(r=Math.max(0,-(c*o+h)))*r+o*(o+2*u)+d;else o=-l,a=-(r=Math.max(0,-(c*o+h)))*r+o*(o+2*u)+d;else o<=-s?a=-(r=Math.max(0,-(-c*l+h)))*r+(o=r>0?-l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d:o<=s?(r=0,a=(o=Math.min(Math.max(-l,-u),l))*(o+2*u)+d):a=-(r=Math.max(0,-(c*l+h)))*r+(o=r>0?l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d;else o=c>0?-l:l,a=-(r=Math.max(0,-(c*o+h)))*r+o*(o+2*u)+d;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(Ni).multiplyScalar(o).add(Bi),a},intersectSphere:function(e,t){ki.subVectors(e.center,this.origin);var i=ki.dot(this.direction),n=ki.dot(ki)-i*i,r=e.radius*e.radius;if(n>r)return null;var o=Math.sqrt(r-n),a=i-o,s=i+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,n,r,o,a,s,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,o=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,o=(e.min.y-u.y)*c),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),h>=0?(a=(e.min.z-u.z)*h,s=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,s=(e.min.z-u.z)*h),i>s||a>n?null:((a>i||i!=i)&&(i=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(i>=0?i:n,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,ki)},intersectTriangle:function(e,t,i,n,r){Hi.subVectors(t,e),Ui.subVectors(i,e),ji.crossVectors(Hi,Ui);var o,a=this.direction.dot(ji);if(a>0){if(n)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Fi.subVectors(this.origin,e);var s=o*this.direction.dot(Ui.crossVectors(Fi,Ui));if(s<0)return null;var l=o*this.direction.dot(Hi.cross(Fi));if(l<0)return null;if(s+l>a)return null;var c=-o*Fi.dot(ji);return c<0?null:this.at(c/a,r)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Gi=new kt,Vi=new kt,Wi=new Ft;function qi(e,t){this.normal=void 0!==e?e:new kt(1,0,0),this.constant=void 0!==t?t:0}Object.assign(qi.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var n=Gi.subVectors(i,t).cross(Vi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new kt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new kt);var i=e.delta(Gi),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?void 0:t.copy(i).multiplyScalar(r).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new kt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var i=t||Wi.getNormalMatrix(e),n=this.coplanarPoint(Gi).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Xi=new kt,Yi=new kt,Ki=new kt,Qi=new kt,Zi=new kt,Ji=new kt,$i=new kt,en=new kt,tn=new kt,nn=new kt;function rn(e,t,i){this.a=void 0!==e?e:new kt,this.b=void 0!==t?t:new kt,this.c=void 0!==i?i:new kt}Object.assign(rn,{getNormal:function(e,t,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new kt),n.subVectors(i,t),Xi.subVectors(e,t),n.cross(Xi);var r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)},getBarycoord:function(e,t,i,n,r){Xi.subVectors(n,t),Yi.subVectors(i,t),Ki.subVectors(e,t);var o=Xi.dot(Xi),a=Xi.dot(Yi),s=Xi.dot(Ki),l=Yi.dot(Yi),c=Yi.dot(Ki),h=o*l-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new kt),0===h)return r.set(-2,-1,-1);var u=1/h,d=(l*s-a*c)*u,p=(o*c-a*s)*u;return r.set(1-d-p,p,d)},containsPoint:function(e,t,i,n){return rn.getBarycoord(e,t,i,n,Qi),Qi.x>=0&&Qi.y>=0&&Qi.x+Qi.y<=1},getUV:function(e,t,i,n,r,o,a,s){return this.getBarycoord(e,t,i,n,Qi),s.set(0,0),s.addScaledVector(r,Qi.x),s.addScaledVector(o,Qi.y),s.addScaledVector(a,Qi.z),s},isFrontFacing:function(e,t,i,n){return Xi.subVectors(i,t),Yi.subVectors(e,t),Xi.cross(Yi).dot(n)<0}}),Object.assign(rn.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Xi.subVectors(this.c,this.b),Yi.subVectors(this.a,this.b),.5*Xi.cross(Yi).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new kt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return rn.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new qi),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return rn.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,i,n,r){return rn.getUV(e,this.a,this.b,this.c,t,i,n,r)},containsPoint:function(e){return rn.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return rn.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new kt);var i,n,r=this.a,o=this.b,a=this.c;Zi.subVectors(o,r),Ji.subVectors(a,r),en.subVectors(e,r);var s=Zi.dot(en),l=Ji.dot(en);if(s<=0&&l<=0)return t.copy(r);tn.subVectors(e,o);var c=Zi.dot(tn),h=Ji.dot(tn);if(c>=0&&h<=c)return t.copy(o);var u=s*h-c*l;if(u<=0&&s>=0&&c<=0)return i=s/(s-c),t.copy(r).addScaledVector(Zi,i);nn.subVectors(e,a);var d=Zi.dot(nn),p=Ji.dot(nn);if(p>=0&&d<=p)return t.copy(a);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(r).addScaledVector(Ji,n);var m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return $i.subVectors(a,o),n=(h-c)/(h-c+(d-p)),t.copy(o).addScaledVector($i,n);var v=1/(m+f+u);return i=f*v,n=u*v,t.copy(r).addScaledVector(Zi,i).addScaledVector(Ji,n)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var on={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},an={h:0,s:0,l:0},sn={h:0,s:0,l:0};function ln(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function cn(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function hn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function un(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function dn(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new kt,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new ln,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}Object.assign(ln.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(e=Rt.euclideanModulo(e,1),t=Rt.clamp(t,0,1),i=Rt.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{var n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=cn(r,n,e+1/3),this.g=cn(r,n,e),this.b=cn(r,n,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(a,s,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=i[1],h=c.length;if(3===h)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=on[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=hn(e.r),this.g=hn(e.g),this.b=hn(e.b),this},copyLinearToSRGB:function(e){return this.r=un(e.r),this.g=un(e.g),this.b=un(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i,n=this.r,r=this.g,o=this.b,a=Math.max(n,r,o),s=Math.min(n,r,o),l=(s+a)/2;if(s===a)t=0,i=0;else{var c=a-s;switch(i=l<=.5?c/(a+s):c/(2-a-s),a){case n:t=(r-o)/c+(r<o?6:0);break;case r:t=(o-n)/c+2;break;case o:t=(n-r)/c+4}t/=6}return e.h=t,e.s=i,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){return this.getHSL(an),an.h+=e,an.s+=t,an.l+=i,this.setHSL(an.h,an.s,an.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(an),e.getHSL(sn);var i=Rt.lerp(an.h,sn.h,t),n=Rt.lerp(an.s,sn.s,t),r=Rt.lerp(an.l,sn.l,t);return this.setHSL(i,n,r),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),ln.NAMES=on,Object.assign(dn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var pn=0;function fn(){Object.defineProperty(this,"id",{value:pn++}),this.uuid=Rt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=f,this.side=l,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=u,this.opacity=1,this.transparent=!1,this.blendSrc=C,this.blendDst=L,this.blendEquation=b,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=F,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=_t,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Et,this.stencilZFail=Et,this.stencilZPass=Et,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function mn(e){fn.call(this),this.type="MeshBasicMaterial",this.color=new ln(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=G,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}fn.prototype=Object.assign(Object.create(St.prototype),{constructor:fn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var i in e){var n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==f&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==l&&(i.side=this.side),this.vertexColors!==u&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,i=null;if(null!==t){var n=t.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(fn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),mn.prototype=Object.create(fn.prototype),mn.prototype.constructor=mn,mn.prototype.isMeshBasicMaterial=!0,mn.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var vn=new kt;function gn(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=Mt,this.updateRange={offset:0,count:-1},this.version=0}function yn(e,t,i){gn.call(this,new Int8Array(e),t,i)}function bn(e,t,i){gn.call(this,new Uint8Array(e),t,i)}function An(e,t,i){gn.call(this,new Uint8ClampedArray(e),t,i)}function wn(e,t,i){gn.call(this,new Int16Array(e),t,i)}function xn(e,t,i){gn.call(this,new Uint16Array(e),t,i)}function En(e,t,i){gn.call(this,new Int32Array(e),t,i)}function _n(e,t,i){gn.call(this,new Uint32Array(e),t,i)}function Mn(e,t,i){gn.call(this,new Float32Array(e),t,i)}function Tn(e,t,i){gn.call(this,new Float64Array(e),t,i)}function Sn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Cn(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}Object.defineProperty(gn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(gn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new ln),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Dt),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new kt),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new zt),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},applyMatrix3:function(e){for(var t=0,i=this.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyMatrix3(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this},applyMatrix4:function(e){for(var t=0,i=this.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyMatrix4(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this},applyNormalMatrix:function(e){for(var t=0,i=this.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyNormalMatrix(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this},transformDirection:function(e){for(var t=0,i=this.count;t<i;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.transformDirection(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),yn.prototype=Object.create(gn.prototype),yn.prototype.constructor=yn,bn.prototype=Object.create(gn.prototype),bn.prototype.constructor=bn,An.prototype=Object.create(gn.prototype),An.prototype.constructor=An,wn.prototype=Object.create(gn.prototype),wn.prototype.constructor=wn,xn.prototype=Object.create(gn.prototype),xn.prototype.constructor=xn,En.prototype=Object.create(gn.prototype),En.prototype.constructor=En,_n.prototype=Object.create(gn.prototype),_n.prototype.constructor=_n,Mn.prototype=Object.create(gn.prototype),Mn.prototype.constructor=Mn,Tn.prototype=Object.create(gn.prototype),Tn.prototype.constructor=Tn,Object.assign(Sn.prototype,{computeGroups:function(e){for(var t,i=[],n=void 0,r=e.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:n})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,i=e.faces,n=e.vertices,r=e.faceVertexUvs,o=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var h,u=e.morphNormals,d=u.length;if(d>0){for(h=[],c=0;c<d;c++)h[c]={name:u[c].name,data:[]};this.morphTargets.normal=h}var p=e.skinIndices,f=e.skinWeights,m=p.length===n.length,v=f.length===n.length;for(n.length>0&&i.length,c=0;c<i.length;c++){var g=i[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=g.normal;this.normals.push(b,b,b)}var A,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var x=g.color;this.colors.push(x,x,x)}!0===o&&(void 0!==(A=r[0][c])?this.uvs.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Dt,new Dt,new Dt))),!0===a&&(void 0!==(A=r[1][c])?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Dt,new Dt,new Dt)));for(var E=0;E<l;E++){var _=s[E].vertices;t[E].data.push(_[g.a],_[g.b],_[g.c])}for(E=0;E<d;E++){var M=u[E].vertexNormals[c];h[E].data.push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Ln=1,Rn=new Jt,Dn=new vi,Pn=new kt,On=new Di,In=new Di,kn=new kt;function Bn(){Object.defineProperty(this,"id",{value:Ln+=2}),this.uuid=Rt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Bn.prototype=Object.assign(Object.create(St.prototype),{constructor:Bn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Cn(e)>65535?_n:xn)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){var n=(new Ft).getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Rn.makeRotationX(e),this.applyMatrix(Rn),this},rotateY:function(e){return Rn.makeRotationY(e),this.applyMatrix(Rn),this},rotateZ:function(e){return Rn.makeRotationZ(e),this.applyMatrix(Rn),this},translate:function(e,t,i){return Rn.makeTranslation(e,t,i),this.applyMatrix(Rn),this},scale:function(e,t,i){return Rn.makeScale(e,t,i),this.applyMatrix(Rn),this},lookAt:function(e){return Dn.lookAt(e),Dn.updateMatrix(),this.applyMatrix(Dn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pn).negate(),this.translate(Pn.x,Pn.y,Pn.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Mn(3*t.vertices.length,3),n=new Mn(3*t.colors.length,3);if(this.setAttribute("position",i.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new Mn(t.lineDistances.length,1);this.setAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Mn(t,3)),this},updateFromObject:function(e){var t,i=e.geometry;if(e.isMesh){var n=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(n=void 0,i.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(i);n.verticesNeedUpdate=i.verticesNeedUpdate,n.normalsNeedUpdate=i.normalsNeedUpdate,n.colorsNeedUpdate=i.colorsNeedUpdate,n.uvsNeedUpdate=i.uvsNeedUpdate,n.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=n}return!0===i.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(i.vertices),t.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(i.normals),t.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(i.colors),t.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(i.uvs),t.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(i.lineDistances),t.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(e.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Sn).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new gn(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.setAttribute("normal",new gn(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.setAttribute("color",new gn(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new gn(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new gn(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],c=0,h=l.length;c<h;c++){var u=l[c],d=new Mn(3*u.data.length,3);d.name=u.name,s.push(d.copyVector3sArray(u.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var p=new Mn(4*e.skinIndices.length,4);this.setAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Mn(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Di);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var i=0,n=t.length;i<n;i++){var r=t[i];On.setFromBufferAttribute(r),this.morphTargetsRelative?(kn.addVectors(this.boundingBox.min,On.min),this.boundingBox.expandByPoint(kn),kn.addVectors(this.boundingBox.max,On.max),this.boundingBox.expandByPoint(kn)):(this.boundingBox.expandByPoint(On.min),this.boundingBox.expandByPoint(On.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ii);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var i=this.boundingSphere.center;if(On.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var o=t[n];In.setFromBufferAttribute(o),this.morphTargetsRelative?(kn.addVectors(On.min,In.min),On.expandByPoint(kn),kn.addVectors(On.max,In.max),On.expandByPoint(kn)):(On.expandByPoint(In.min),On.expandByPoint(In.max))}On.getCenter(i);var a=0;for(n=0,r=e.count;n<r;n++)kn.fromBufferAttribute(e,n),a=Math.max(a,i.distanceToSquared(kn));if(t)for(n=0,r=t.length;n<r;n++){o=t[n];for(var s=this.morphTargetsRelative,l=0,c=o.count;l<c;l++)kn.fromBufferAttribute(o,l),s&&(Pn.fromBufferAttribute(e,l),kn.add(Pn)),a=Math.max(a,i.distanceToSquared(kn))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new gn(new Float32Array(i.length),3));else for(var n=t.normal.array,r=0,o=n.length;r<o;r++)n[r]=0;var a,s,l,c=t.normal.array,h=new kt,u=new kt,d=new kt,p=new kt,f=new kt;if(e){var m=e.array;for(r=0,o=e.count;r<o;r+=3)a=3*m[r+0],s=3*m[r+1],l=3*m[r+2],h.fromArray(i,a),u.fromArray(i,s),d.fromArray(i,l),p.subVectors(d,u),f.subVectors(h,u),p.cross(f),c[a]+=p.x,c[a+1]+=p.y,c[a+2]+=p.z,c[s]+=p.x,c[s+1]+=p.y,c[s+2]+=p.z,c[l]+=p.x,c[l+1]+=p.y,c[l+2]+=p.z}else for(r=0,o=i.length;r<o;r+=9)h.fromArray(i,r),u.fromArray(i,r+3),d.fromArray(i,r+6),p.subVectors(d,u),f.subVectors(h,u),p.cross(f),c[r]=p.x,c[r+1]=p.y,c[r+2]=p.z,c[r+3]=p.x,c[r+4]=p.y,c[r+5]=p.z,c[r+6]=p.x,c[r+7]=p.y,c[r+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var n in i)if(void 0!==e.attributes[n])for(var r=i[n].array,o=e.attributes[n],a=o.array,s=o.itemSize*t,l=Math.min(a.length,r.length-s),c=0,h=s;c<l;c++,h++)r[h]=a[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,i=e.count;t<i;t++)kn.x=e.getX(t),kn.y=e.getY(t),kn.z=e.getZ(t),kn.normalize(),e.setXYZ(t,kn.x,kn.y,kn.z)},toNonIndexed:function(){function e(e,t){for(var i=e.array,n=e.itemSize,r=new i.constructor(t.length*n),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*n;for(var c=0;c<n;c++)r[a++]=i[o++]}return new gn(r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Bn,i=this.index.array,n=this.attributes;for(var r in n){var o=e(n[r],i);t.setAttribute(r,o)}var a=this.morphAttributes;for(r in a){for(var s=[],l=a[r],c=0,h=l.length;c<h;c++)o=e(l[c],i),s.push(o);t.morphAttributes[r]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var u=this.groups,d=(c=0,u.length);c<d;c++){var p=u[c];t.addGroup(p.start,p.count,p.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var r=this.attributes;for(var i in r){var o=(d=r[i]).toJSON();""!==d.name&&(o.name=d.name),e.data.attributes[i]=o}var a={},s=!1;for(var i in this.morphAttributes){for(var l=this.morphAttributes[i],c=[],h=0,u=l.length;h<u;h++){var d;o=(d=l[h]).toJSON(),""!==d.name&&(o.name=d.name),c.push(o)}c.length>0&&(a[i]=c,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new Bn).copy(this)},copy:function(e){var t,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var o=e.attributes;for(t in o){var a=o[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(i=0,n=c.length;i<n;i++)l.push(c[i].clone());this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var h=e.groups;for(i=0,n=h.length;i<n;i++){var u=h[i];this.addGroup(u.start,u.count,u.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Nn=new Jt,Fn=new zi,Hn=new Ii,Un=new kt,jn=new kt,zn=new kt,Gn=new kt,Vn=new kt,Wn=new kt,qn=new kt,Xn=new kt,Yn=new kt,Kn=new Dt,Qn=new Dt,Zn=new Dt,Jn=new kt,$n=new kt;function er(e,t){vi.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Bn,this.material=void 0!==t?t:new mn({color:16777215*Math.random()}),this.updateMorphTargets()}function tr(e,t,i,n,r,o,a,s){if(null===(t.side===c?n.intersectTriangle(a,o,r,!0,s):n.intersectTriangle(r,o,a,t.side!==h,s)))return null;$n.copy(s),$n.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo($n);return l<i.near||l>i.far?null:{distance:l,point:$n.clone(),object:e}}function ir(e,t,i,n,r,o,a,s,l,c,h,u){Un.fromBufferAttribute(r,c),jn.fromBufferAttribute(r,h),zn.fromBufferAttribute(r,u);var d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){qn.set(0,0,0),Xn.set(0,0,0),Yn.set(0,0,0);for(var p=0,f=o.length;p<f;p++){var m=d[p],v=o[p];0!==m&&(Gn.fromBufferAttribute(v,c),Vn.fromBufferAttribute(v,h),Wn.fromBufferAttribute(v,u),a?(qn.addScaledVector(Gn,m),Xn.addScaledVector(Vn,m),Yn.addScaledVector(Wn,m)):(qn.addScaledVector(Gn.sub(Un),m),Xn.addScaledVector(Vn.sub(jn),m),Yn.addScaledVector(Wn.sub(zn),m)))}Un.add(qn),jn.add(Xn),zn.add(Yn)}var g=tr(e,t,i,n,Un,jn,zn,Jn);if(g){s&&(Kn.fromBufferAttribute(s,c),Qn.fromBufferAttribute(s,h),Zn.fromBufferAttribute(s,u),g.uv=rn.getUV(Jn,Un,jn,zn,Kn,Qn,Zn,new Dt)),l&&(Kn.fromBufferAttribute(l,c),Qn.fromBufferAttribute(l,h),Zn.fromBufferAttribute(l,u),g.uv2=rn.getUV(Jn,Un,jn,zn,Kn,Qn,Zn,new Dt));var y=new dn(c,h,u);rn.getNormal(Un,jn,zn,y.normal),g.face=y}return g}er.prototype=Object.assign(Object.create(vi.prototype),{constructor:er,isMesh:!0,copy:function(e){return vi.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,i,n=this.geometry;if(n.isBufferGeometry){var r=n.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var i,n=this.geometry,r=this.material,o=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),Hn.copy(n.boundingSphere),Hn.applyMatrix4(o),!1!==e.ray.intersectsSphere(Hn)&&(Nn.getInverse(o),Fn.copy(e.ray).applyMatrix4(Nn),null===n.boundingBox||!1!==Fn.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var a,s,l,c,h,u,d,p,f,m=n.index,v=n.attributes.position,g=n.morphAttributes.position,y=n.morphTargetsRelative,b=n.attributes.uv,A=n.attributes.uv2,w=n.groups,x=n.drawRange;if(null!==m)if(Array.isArray(r))for(c=0,u=w.length;c<u;c++)for(f=r[(p=w[c]).materialIndex],h=Math.max(p.start,x.start),d=Math.min(p.start+p.count,x.start+x.count);h<d;h+=3)a=m.getX(h),s=m.getX(h+1),l=m.getX(h+2),(i=ir(this,f,e,Fn,v,g,y,b,A,a,s,l))&&(i.faceIndex=Math.floor(h/3),i.face.materialIndex=p.materialIndex,t.push(i));else for(c=Math.max(0,x.start),u=Math.min(m.count,x.start+x.count);c<u;c+=3)a=m.getX(c),s=m.getX(c+1),l=m.getX(c+2),(i=ir(this,r,e,Fn,v,g,y,b,A,a,s,l))&&(i.faceIndex=Math.floor(c/3),t.push(i));else if(void 0!==v)if(Array.isArray(r))for(c=0,u=w.length;c<u;c++)for(f=r[(p=w[c]).materialIndex],h=Math.max(p.start,x.start),d=Math.min(p.start+p.count,x.start+x.count);h<d;h+=3)(i=ir(this,f,e,Fn,v,g,y,b,A,a=h,s=h+1,l=h+2))&&(i.faceIndex=Math.floor(h/3),i.face.materialIndex=p.materialIndex,t.push(i));else for(c=Math.max(0,x.start),u=Math.min(v.count,x.start+x.count);c<u;c+=3)(i=ir(this,r,e,Fn,v,g,y,b,A,a=c,s=c+1,l=c+2))&&(i.faceIndex=Math.floor(c/3),t.push(i))}else if(n.isGeometry){var E,_,M,T,S=Array.isArray(r),C=n.vertices,L=n.faces,R=n.faceVertexUvs[0];R.length>0&&(T=R);for(var D=0,P=L.length;D<P;D++){var O=L[D],I=S?r[O.materialIndex]:r;if(void 0!==I&&(E=C[O.a],_=C[O.b],M=C[O.c],i=tr(this,I,e,Fn,E,_,M,Jn))){if(T&&T[D]){var k=T[D];Kn.copy(k[0]),Qn.copy(k[1]),Zn.copy(k[2]),i.uv=rn.getUV(Jn,E,_,M,Kn,Qn,Zn,new Dt)}i.face=O,i.faceIndex=D,t.push(i)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var nr=0,rr=new Jt,or=new vi,ar=new kt;function sr(){Object.defineProperty(this,"id",{value:nr+=2}),this.uuid=Rt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}sr.prototype=Object.assign(Object.create(St.prototype),{constructor:sr,isGeometry:!0,applyMatrix:function(e){for(var t=(new Ft).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(var o=0,a=r.vertexNormals.length;o<a;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return rr.makeRotationX(e),this.applyMatrix(rr),this},rotateY:function(e){return rr.makeRotationY(e),this.applyMatrix(rr),this},rotateZ:function(e){return rr.makeRotationZ(e),this.applyMatrix(rr),this},translate:function(e,t,i){return rr.makeTranslation(e,t,i),this.applyMatrix(rr),this},scale:function(e,t,i){return rr.makeScale(e,t,i),this.applyMatrix(rr),this},lookAt:function(e){return or.lookAt(e),or.updateMatrix(),this.applyMatrix(or.matrix),this},fromBufferGeometry:function(e){var t=this,i=null!==e.index?e.index.array:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var r=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<r.length;c+=3)t.vertices.push((new kt).fromArray(r,c)),void 0!==a&&t.colors.push((new ln).fromArray(a,c));function h(e,i,n,r){var c=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()],h=new dn(e,i,n,void 0===o?[]:[(new kt).fromArray(o,3*e),(new kt).fromArray(o,3*i),(new kt).fromArray(o,3*n)],c,r);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Dt).fromArray(s,2*e),(new Dt).fromArray(s,2*i),(new Dt).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new Dt).fromArray(l,2*e),(new Dt).fromArray(l,2*i),(new Dt).fromArray(l,2*n)])}var u=e.groups;if(u.length>0)for(c=0;c<u.length;c++)for(var d=u[c],p=d.start,f=p,m=p+d.count;f<m;f+=3)void 0!==i?h(i[f],i[f+1],i[f+2],d.materialIndex):h(f,f+1,f+2,d.materialIndex);else if(void 0!==i)for(c=0;c<i.length;c+=3)h(i[c],i[c+1],i[c+2]);else for(c=0;c<r.length/3;c+=3)h(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ar).negate(),this.translate(ar.x,ar.y,ar.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new Jt;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new kt,t=new kt,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,i,n,r,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)a[t]=new kt;if(e){var s,l,c,h=new kt,u=new kt;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],h.subVectors(c,l),u.subVectors(s,l),h.cross(u),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(n=0,r=this.faces.length;n<r;n++){var d=(o=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(i=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new sr;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)l=new kt,c={a:new kt,b:new kt,c:new kt},a.push(l),s.push(c)}var l,c,h=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],l=h.faceNormals[i],c=h.vertexNormals[i],l.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Di),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ii),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var n,r=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new Ft).getNormalMatrix(t));for(var u=0,d=a.length;u<d;u++){var p=a[u].clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(u=0,d=h.length;u<d;u++)c.push(h[u].clone());for(u=0,d=l.length;u<d;u++){var f,m,v,g=l[u],y=g.vertexNormals,b=g.vertexColors;(f=new dn(g.a+r,g.b+r,g.c+r)).normal.copy(g.normal),void 0!==n&&f.normal.applyMatrix3(n).normalize();for(var A=0,w=y.length;A<w;A++)m=y[A].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),f.vertexNormals.push(m);for(f.color.copy(g.color),A=0,w=b.length;A<w;A++)v=b[A],f.vertexColors.push(v.clone());f.materialIndex=g.materialIndex+i,s.push(f)}for(u=0,d=e.faceVertexUvs.length;u<d;u++){var x=e.faceVertexUvs[u];for(void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]),A=0,w=x.length;A<w;A++){for(var E=x[A],_=[],M=0,T=E.length;M<T;M++)_.push(E[M].clone());this.faceVertexUvs[u].push(_)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,n,r,o,a,s,l={},c=[],h=[],u=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(l[t]=i,c.push(this.vertices[i]),h[i]=c.length-1):h[i]=h[l[t]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=h[r.a],r.b=h[r.b],r.c=h[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(i);break}}for(i=d.length-1;i>=0;i--){var f=d[i];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var n=e[t];this.vertices.push(new kt(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var n,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===t&&(n=[]),a&&a.length===t&&(r=[]),i=0;i<t;i++){var s=e[i]._id;n&&n.push(o[s]),r&&r.push(a[s])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var n=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];n.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],h={},u=[],d={};for(r=0;r<this.faces.length;r++){var p=this.faces[r],f=void 0!==this.faceVertexUvs[0][r],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=E(b,0,0),b=E(b,1,!0),b=E(b,2,!1),b=E(b,3,f),b=E(b,4,m),b=E(b,5,v),b=E(b,6,g),b=E(b,7,y),a.push(b),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var A=this.faceVertexUvs[0][r];a.push(T(A[0]),T(A[1]),T(A[2]))}if(m&&a.push(_(p.normal)),v){var w=p.vertexNormals;a.push(_(w[0]),_(w[1]),_(w[2]))}if(g&&a.push(M(p.color)),y){var x=p.vertexColors;a.push(M(x[0]),M(x[1]),M(x[2]))}}function E(e,t,i){return i?e|1<<t:e&~(1<<t)}function _(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]||(h[t]=c.length,c.push(e.getHex())),h[t]}function T(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=u.length/2,u.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=n,e.data.normals=s,c.length>0&&(e.data.colors=c),u.length>0&&(e.data.uvs=[u]),e.data.faces=a,e},clone:function(){return(new sr).copy(this)},copy:function(e){var t,i,n,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,i=s.length;t<i;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,i=l.length;t<i;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,i=c.length;t<i;t++)this.faces.push(c[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var h=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,r=h.length;n<r;n++){var u=h[n],d=[];for(o=0,a=u.length;o<a;o++){var p=u[o];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,i=f.length;t<i;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],n=0,r=f[t].vertices.length;n<r;n++)m.vertices.push(f[t].vertices[n].clone());if(void 0!==f[t].normals)for(m.normals=[],n=0,r=f[t].normals.length;n<r;n++)m.normals.push(f[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,i=v.length;t<i;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,r=v[t].vertexNormals.length;n<r;n++){var y=v[t].vertexNormals[n],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),g.vertexNormals.push(b)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,r=v[t].faceNormals.length;n<r;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var A=e.skinWeights;for(t=0,i=A.length;t<i;t++)this.skinWeights.push(A[t].clone());var w=e.skinIndices;for(t=0,i=w.length;t<i;t++)this.skinIndices.push(w[t].clone());var x=e.lineDistances;for(t=0,i=x.length;t<i;t++)this.lineDistances.push(x[t]);var E=e.boundingBox;null!==E&&(this.boundingBox=E.clone());var _=e.boundingSphere;return null!==_&&(this.boundingSphere=_.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var lr=function(e){function t(t,i,n,r,o,a){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:n,widthSegments:r,heightSegments:o,depthSegments:a},this.fromBufferGeometry(new cr(t,i,n,r,o,a)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(sr),cr=function(e){function t(t,i,n,r,o,a){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:i,depth:n,widthSegments:r,heightSegments:o,depthSegments:a};var s=this;t=t||1,i=i||1,n=n||1,r=Math.floor(r)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var l=[],c=[],h=[],u=[],d=0,p=0;function f(e,t,i,n,r,o,a,f,m,v,g){var y,b,A=o/m,w=a/v,x=o/2,E=a/2,_=f/2,M=m+1,T=v+1,S=0,C=0,L=new kt;for(b=0;b<T;b++){var R=b*w-E;for(y=0;y<M;y++){var D=y*A-x;L[e]=D*n,L[t]=R*r,L[i]=_,c.push(L.x,L.y,L.z),L[e]=0,L[t]=0,L[i]=f>0?1:-1,h.push(L.x,L.y,L.z),u.push(y/m),u.push(1-b/v),S+=1}}for(b=0;b<v;b++)for(y=0;y<m;y++){var P=d+y+M*b,O=d+y+M*(b+1),I=d+(y+1)+M*(b+1),k=d+(y+1)+M*b;l.push(P,O,k),l.push(O,I,k),C+=6}s.addGroup(p,C,g),p+=C,d+=S}f("z","y","x",-1,-1,n,i,t,a,o,0),f("z","y","x",1,-1,n,i,-t,a,o,1),f("x","z","y",1,1,t,n,i,r,a,2),f("x","z","y",1,-1,t,n,-i,r,a,3),f("x","y","z",1,-1,t,i,n,r,o,4),f("x","y","z",-1,-1,t,i,-n,r,o,5),this.setIndex(l),this.setAttribute("position",new Mn(c,3)),this.setAttribute("normal",new Mn(h,3)),this.setAttribute("uv",new Mn(u,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Bn);function hr(e){var t={};for(var i in e)for(var n in t[i]={},e[i]){var r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}return t}function ur(e){for(var t={},i=0;i<e.length;i++){var n=hr(e[i]);for(var r in n)t[r]=n[r]}return t}var dr={clone:hr,merge:ur},pr="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fr="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function mr(e){fn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=pr,this.fragmentShader=fr,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function vr(){vi.call(this),this.type="Camera",this.matrixWorldInverse=new Jt,this.projectionMatrix=new Jt,this.projectionMatrixInverse=new Jt}function gr(e,t,i,n){vr.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}mr.prototype=Object.create(fn.prototype),mr.prototype.constructor=mr,mr.prototype.isShaderMaterial=!0,mr.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=hr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},mr.prototype.toJSON=function(e){var t=fn.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var r={};for(var o in this.extensions)!0===this.extensions[o]&&(r[o]=!0);return Object.keys(r).length>0&&(t.extensions=r),t},vr.prototype=Object.assign(Object.create(vi.prototype),{constructor:vr,isCamera:!0,copy:function(e,t){return vi.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new kt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){vi.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),gr.prototype=Object.assign(Object.create(vr.prototype),{constructor:gr,isPerspectiveCamera:!0,copy:function(e,t){return vr.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Rt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Rt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Rt.RAD2DEG*Math.atan(Math.tan(.5*Rt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Rt.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*n/a,t-=o.offsetY*i/s,n*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=vi.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var yr=90;function br(e,t,i,n){vi.call(this),this.type="CubeCamera";var r=new gr(yr,1,e,t);r.up.set(0,-1,0),r.lookAt(new kt(1,0,0)),this.add(r);var o=new gr(yr,1,e,t);o.up.set(0,-1,0),o.lookAt(new kt(-1,0,0)),this.add(o);var a=new gr(yr,1,e,t);a.up.set(0,0,1),a.lookAt(new kt(0,1,0)),this.add(a);var s=new gr(yr,1,e,t);s.up.set(0,0,-1),s.lookAt(new kt(0,-1,0)),this.add(s);var l=new gr(yr,1,e,t);l.up.set(0,-1,0),l.lookAt(new kt(0,0,1)),this.add(l);var c=new gr(yr,1,e,t);c.up.set(0,-1,0),c.lookAt(new kt(0,0,-1)),this.add(c),n=n||{format:Ce,magFilter:de,minFilter:de},this.renderTarget=new Ar(i,i,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=e.getRenderTarget(),n=this.renderTarget,h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(i)},this.clear=function(e,t,i,n){for(var r=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,i,n);e.setRenderTarget(r)}}function Ar(e,t,i){Gt.call(this,e,t,i)}function wr(e,t,i,n,r,o,a,s,l,c,h,u){jt.call(this,null,o,a,s,l,c,n,r,h,u),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:ce,this.minFilter=void 0!==c?c:ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}br.prototype=Object.create(vi.prototype),br.prototype.constructor=br,Ar.prototype=Object.create(Gt.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isWebGLRenderTargetCube=!0,Ar.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var i=new gi,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( -direction.z, -direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new mr({type:"CubemapFromEquirect",uniforms:hr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:c,blending:p});r.uniforms.tEquirect.value=t;var o=new er(new cr(5,5,5),r);i.add(o);var a=new br(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,i),o.geometry.dispose(),o.material.dispose(),this},wr.prototype=Object.create(jt.prototype),wr.prototype.constructor=wr,wr.prototype.isDataTexture=!0;var xr=new Ii,Er=new kt;function _r(e,t,i,n,r,o){this.planes=[void 0!==e?e:new qi,void 0!==t?t:new qi,void 0!==i?i:new qi,void 0!==n?n:new qi,void 0!==r?r:new qi,void 0!==o?o:new qi]}Object.assign(_r.prototype,{set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],v=i[13],g=i[14],y=i[15];return t[0].setComponents(a-n,h-s,f-u,y-m).normalize(),t[1].setComponents(a+n,h+s,f+u,y+m).normalize(),t[2].setComponents(a+r,h+l,f+d,y+v).normalize(),t[3].setComponents(a-r,h-l,f-d,y-v).normalize(),t[4].setComponents(a-o,h-c,f-p,y-g).normalize(),t[5].setComponents(a+o,h+c,f+p,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),xr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(xr)},intersectsSprite:function(e){return xr.center.set(0,0,0),xr.radius=.7071067811865476,xr.applyMatrix4(e.matrixWorld),this.intersectsSphere(xr)},intersectsSphere:function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,i=0;i<6;i++){var n=t[i];if(Er.x=n.normal.x>0?e.max.x:e.min.x,Er.y=n.normal.y>0?e.max.y:e.min.y,Er.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Er)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}});var Mr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToVariance(float roughness) {\n  float variance = 0.0;\n  if (roughness >= r1) {\n    variance = (r0 - roughness) * (v1 - v0) / (r0 - r1) + v0;\n  } else if (roughness >= r4) {\n    variance = (r1 - roughness) * (v4 - v1) / (r1 - r4) + v1;\n  } else if (roughness >= r5) {\n    variance = (r4 - roughness) * (v5 - v4) / (r4 - r5) + v4;\n  } else {\n    float roughness2 = roughness * roughness;\n    variance = 1.79 * roughness2 * roughness2;\n  }\n  return variance;\n}\nfloat varianceToRoughness(float variance) {\n  float roughness = 0.0;\n  if (variance >= v1) {\n    roughness = (v0 - variance) * (r1 - r0) / (v0 - v1) + r0;\n  } else if (variance >= v4) {\n    roughness = (v1 - variance) * (r4 - r1) / (v1 - v4) + r1;\n  } else if (variance >= v5) {\n    roughness = (v4 - variance) * (r5 - r4) / (v4 - v5) + r4;\n  } else {\n    roughness = pow(0.559 * variance, 0.25);  }\n  return roughness;\n}\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ), 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\n  \n  void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\n  \n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n  \n  }\n\n  void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    \n\t\n    #ifdef CLEARCOAT\n\t\t\n    float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\t\n    reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\t\n    float ccDotNL = ccDotNV;\n\t\t\n    float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\n    #else\n\t\t\n    float clearcoatDHR = 0.0;\n\t\n    #endif\n\t\n    float clearcoatInv = 1.0 - clearcoatDHR;\n\t\n    vec3 singleScattering = vec3( 0.0 );\n\t\n    vec3 multiScattering = vec3( 0.0 );\n\t\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\n    BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\n    vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\n    \n    \n    reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\t\n    \n    //// 實際測試在 標準-淡出 的 情況下，底下兩個不會有作用\n    // reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\t\n    // reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n\n  }\n\n  #define RE_Direct\t\t\t\tRE_Direct_Physical\n\n  #define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n\n  #define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n\n  #define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n  float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\t\n    return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n  }",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpack2HalfToRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpack2HalfToRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Tr={common:{diffuse:{value:new ln(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ft},uv2Transform:{value:new Ft},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Dt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ln(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ln(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ft}},sprite:{diffuse:{value:new ln(15658734)},opacity:{value:1},center:{value:new Dt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ft}}},Sr={basic:{uniforms:ur([Tr.common,Tr.specularmap,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.fog]),vertexShader:Mr.meshbasic_vert,fragmentShader:Mr.meshbasic_frag},lambert:{uniforms:ur([Tr.common,Tr.specularmap,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.fog,Tr.lights,{emissive:{value:new ln(0)}}]),vertexShader:Mr.meshlambert_vert,fragmentShader:Mr.meshlambert_frag},phong:{uniforms:ur([Tr.common,Tr.specularmap,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.fog,Tr.lights,{emissive:{value:new ln(0)},specular:{value:new ln(1118481)},shininess:{value:30}}]),vertexShader:Mr.meshphong_vert,fragmentShader:Mr.meshphong_frag},standard:{uniforms:ur([Tr.common,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.roughnessmap,Tr.metalnessmap,Tr.fog,Tr.lights,{emissive:{value:new ln(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Mr.meshphysical_vert,fragmentShader:Mr.meshphysical_frag},toon:{uniforms:ur([Tr.common,Tr.specularmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.gradientmap,Tr.fog,Tr.lights,{emissive:{value:new ln(0)},specular:{value:new ln(1118481)},shininess:{value:30}}]),vertexShader:Mr.meshtoon_vert,fragmentShader:Mr.meshtoon_frag},matcap:{uniforms:ur([Tr.common,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.fog,{matcap:{value:null}}]),vertexShader:Mr.meshmatcap_vert,fragmentShader:Mr.meshmatcap_frag},points:{uniforms:ur([Tr.points,Tr.fog]),vertexShader:Mr.points_vert,fragmentShader:Mr.points_frag},dashed:{uniforms:ur([Tr.common,Tr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mr.linedashed_vert,fragmentShader:Mr.linedashed_frag},depth:{uniforms:ur([Tr.common,Tr.displacementmap]),vertexShader:Mr.depth_vert,fragmentShader:Mr.depth_frag},normal:{uniforms:ur([Tr.common,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,{opacity:{value:1}}]),vertexShader:Mr.normal_vert,fragmentShader:Mr.normal_frag},sprite:{uniforms:ur([Tr.sprite,Tr.fog]),vertexShader:Mr.sprite_vert,fragmentShader:Mr.sprite_frag},background:{uniforms:{uvTransform:{value:new Ft},t2D:{value:null}},vertexShader:Mr.background_vert,fragmentShader:Mr.background_frag},cube:{uniforms:ur([Tr.envmap,{opacity:{value:1}}]),vertexShader:Mr.cube_vert,fragmentShader:Mr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mr.equirect_vert,fragmentShader:Mr.equirect_frag},distanceRGBA:{uniforms:ur([Tr.common,Tr.displacementmap,{referencePosition:{value:new kt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mr.distanceRGBA_vert,fragmentShader:Mr.distanceRGBA_frag},shadow:{uniforms:ur([Tr.lights,Tr.fog,{color:{value:new ln(0)},opacity:{value:1}}]),vertexShader:Mr.shadow_vert,fragmentShader:Mr.shadow_frag}};function Cr(){var e=null,t=!1,i=null;function n(r,o){!1!==t&&(i(r,o),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==i&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function Lr(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var n=t.get(i);n&&(e.deleteBuffer(n.buffer),t.delete(i))},update:function(i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r=t.get(i);void 0===r?t.set(i,function(t,i){var n=t.array,r=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,n,r),t.onUploadCallback();var a=5126;return n instanceof Float32Array?a=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a=5123:n instanceof Int16Array?a=5122:n instanceof Uint32Array?a=5125:n instanceof Int32Array?a=5124:n instanceof Int8Array?a=5120:n instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(i,n)):r.version<i.version&&(function(t,i,n){var r=i.array,o=i.updateRange;e.bindBuffer(n,t),-1===o.count?e.bufferSubData(n,0,r):(e.bufferSubData(n,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,i,n),r.version=i.version)}}}function Rr(e,t,i,n){sr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new Dr(e,t,i,n)),this.mergeVertices()}function Dr(e,t,i,n){Bn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};var r,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(i)||1,c=Math.floor(n)||1,h=l+1,u=c+1,d=e/l,p=t/c,f=[],m=[],v=[],g=[];for(o=0;o<u;o++){var y=o*p-s;for(r=0;r<h;r++){var b=r*d-a;m.push(b,-y,0),v.push(0,0,1),g.push(r/l),g.push(1-o/c)}}for(o=0;o<c;o++)for(r=0;r<l;r++){var A=r+h*o,w=r+h*(o+1),x=r+1+h*(o+1),E=r+1+h*o;f.push(A,w,E),f.push(w,x,E)}this.setIndex(f),this.setAttribute("position",new Mn(m,3)),this.setAttribute("normal",new Mn(v,3)),this.setAttribute("uv",new Mn(g,2))}function Pr(e,t,i,n){var r,o,a=new ln(0),s=0,h=null,u=0;function d(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,n)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),d(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){d(a,s=e)},render:function(t,n,p,f){var m=n.background,v=e.xr,g=v.getSession&&v.getSession();if(g&&"additive"===g.environmentBlendMode&&(m=null),null===m?(d(a,s),h=null,u=0):m&&m.isColor&&(d(m,1),f=!0,h=null,u=0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLRenderTargetCube||m.mapping===re)){void 0===o&&((o=new er(new cr(1,1,1),new mr({type:"BackgroundCubeMaterial",uniforms:hr(Sr.cube.uniforms),vertexShader:Sr.cube.vertexShader,fragmentShader:Sr.cube.fragmentShader,side:c,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.envMap.value}}),i.update(o));var y=m.isWebGLRenderTargetCube?m.texture:m;o.material.envMap=y,h===m&&u===y.version||(o.material.needsUpdate=!0,h=m,u=y.version),t.unshift(o,o.geometry,o.material,0,0,null)}else m&&m.isTexture&&(void 0===r&&((r=new er(new Dr(2,2),new mr({type:"BackgroundMaterial",uniforms:hr(Sr.background.uniforms),vertexShader:Sr.background.vertexShader,fragmentShader:Sr.background.fragmentShader,side:l,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(r)),r.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),r.material.uniforms.uvTransform.value.copy(m.matrix),h===m&&u===m.version||(r.material.needsUpdate=!0,h=m,u=m.version),t.unshift(r,r.geometry,r.material,0,0,null))}}}function Or(e,t,i,n){var r,o=n.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r)},this.renderInstances=function(n,a,s,l){if(0!==l){var c,h;if(o)c=e,h="drawArraysInstanced";else if(h="drawArraysInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,a,s,l),i.update(s,r,l)}}}function Ir(e,t,i){var n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==i.precision?i.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),u=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=h>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==n)return n;var i=t.get("EXT_texture_filter_anisotropic");return n=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:o?e.getParameter(36183):0}}function kr(){var e=this,t=null,i=0,n=!1,r=!1,o=new qi,a=new Ft,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(t,i,n,r){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==r||null===c){var h=n+4*l,u=i.matrixWorldInverse;a.getNormalMatrix(u),(null===c||c.length<h)&&(c=new Float32Array(h));for(var d=0,p=n;d!==l;++d,p+=4)o.copy(t[d]).applyMatrix4(u,a),o.normal.toArray(c,p),c[p+3]=o.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,o){var a=0!==e.length||r||0!==i||n;return n=r,t=c(e,o,0),i=e.length,a},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(e,o,a,h,u,d){if(!n||null===e||0===e.length||r&&!a)r?c(null):l();else{var p=r?0:i,f=4*p,m=u.clippingState||null;s.value=m,m=c(e,h,f,d);for(var v=0;v!==f;++v)m[v]=t[v];u.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}}function Br(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=n,n}}}function Nr(e,t,i){var n=new WeakMap,r=new WeakMap;function o(e){var a=e.target,s=n.get(a);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",o),n.delete(a);var c=r.get(s);c&&(t.remove(c),r.delete(s)),i.memory.geometries--}function a(e){var i=[],n=e.index,o=e.attributes.position,a=0;if(null!==n){var s=n.array;a=n.version;for(var l=0,c=s.length;l<c;l+=3){var h=s[l+0],u=s[l+1],d=s[l+2];i.push(h,u,u,d,d,h)}}else for(s=o.array,a=o.version,l=0,c=s.length/3-1;l<c;l+=3)h=l+0,u=l+1,d=l+2,i.push(h,u,u,d,d,h);var p=new(Cn(i)>65535?_n:xn)(i,1);p.version=a,t.update(p,34963);var f=r.get(e);f&&t.remove(f),r.set(e,p)}return{get:function(e,t){var r=n.get(t);return r||(t.addEventListener("dispose",o),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Bn).setFromObject(e)),r=t._bufferGeometry),n.set(t,r),i.memory.geometries++,r)},update:function(e){var i=e.index,n=e.attributes;for(var r in null!==i&&t.update(i,34963),n)t.update(n[r],34962);var o=e.morphAttributes;for(var r in o)for(var a=o[r],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=r.get(e);if(t){var i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return r.get(e)}}}function Fr(e,t,i,n){var r,o,a,s=n.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,o,t*a),i.update(n,r)},this.renderInstances=function(n,l,c,h){if(0!==h){var u,d;if(s)u=e,d="drawElementsInstanced";else if(d="drawElementsInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](r,c,o,l*a,h),i.update(c,r,h)}}}function Hr(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(n=n||1,t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Ur(e,t){return Math.abs(t[1])-Math.abs(e[1])}function jr(e){var t={},i=new Float32Array(8);return{update:function(n,r,o,a){var s=n.morphTargetInfluences,l=void 0===s?0:s.length,c=t[r.id];if(void 0===c){c=[];for(var h=0;h<l;h++)c[h]=[h,0];t[r.id]=c}var u=o.morphTargets&&r.morphAttributes.position,d=o.morphNormals&&r.morphAttributes.normal;for(h=0;h<l;h++)0!==(f=c[h])[1]&&(u&&r.deleteAttribute("morphTarget"+h),d&&r.deleteAttribute("morphNormal"+h));for(h=0;h<l;h++)(f=c[h])[0]=h,f[1]=s[h];c.sort(Ur);var p=0;for(h=0;h<8;h++){var f;if(f=c[h]){var m=f[0],v=f[1];if(v){u&&r.setAttribute("morphTarget"+h,u[m]),d&&r.setAttribute("morphNormal"+h,d[m]),i[h]=v,p+=v;continue}}i[h]=0}var g=r.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",g),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function zr(e,t,i,n){var r={};return{update:function(e){var o=n.render.frame,a=e.geometry,s=t.get(e,a);return r[s.id]!==o&&(a.isGeometry&&s.updateFromObject(e),t.update(s),r[s.id]=o),e.isInstancedMesh&&i.update(e.instanceMatrix,34962),s},dispose:function(){r={}}}}function Gr(e,t,i,n,r,o,a,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:$,a=void 0!==a?a:Ce,jt.call(this,e,t,i,n,r,o,a,s,l,c),this.flipY=!1}function Vr(e,t,i,n){jt.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:n||1},this.magFilter=ce,this.minFilter=ce,this.wrapR=se,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Wr(e,t,i,n){jt.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:n||1},this.magFilter=ce,this.minFilter=ce,this.wrapR=se,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Sr.physical={uniforms:ur([Sr.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new ln(0)},clearcoatNormalScale:{value:new Dt(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Mr.meshphysical_vert,fragmentShader:Mr.meshphysical_frag},Rr.prototype=Object.create(sr.prototype),Rr.prototype.constructor=Rr,Dr.prototype=Object.create(Bn.prototype),Dr.prototype.constructor=Dr,Gr.prototype=Object.create(jt.prototype),Gr.prototype.constructor=Gr,Gr.prototype.isCubeTexture=!0,Object.defineProperty(Gr.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Vr.prototype=Object.create(jt.prototype),Vr.prototype.constructor=Vr,Vr.prototype.isDataTexture2DArray=!0,Wr.prototype=Object.create(jt.prototype),Wr.prototype.constructor=Wr,Wr.prototype.isDataTexture3D=!0;var qr=new jt,Xr=new Vr,Yr=new Wr,Kr=new Gr,Qr=[],Zr=[],Jr=new Float32Array(16),$r=new Float32Array(9),eo=new Float32Array(4);function to(e,t,i){var n=e[0];if(n<=0||n>0)return e;var r=t*i,o=Qr[r];if(void 0===o&&(o=new Float32Array(r),Qr[r]=o),0!==t){n.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=i,e[a].toArray(o,s)}return o}function io(e,t){if(e.length!==t.length)return!1;for(var i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function no(e,t){for(var i=0,n=t.length;i<n;i++)e[i]=t[i]}function ro(e,t){var i=Zr[t];void 0===i&&(i=new Int32Array(t),Zr[t]=i);for(var n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function oo(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function ao(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(io(i,t))return;e.uniform2fv(this.addr,t),no(i,t)}}function so(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(io(i,t))return;e.uniform3fv(this.addr,t),no(i,t)}}function lo(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(io(i,t))return;e.uniform4fv(this.addr,t),no(i,t)}}function co(e,t){var i=this.cache,n=t.elements;if(void 0===n){if(io(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),no(i,t)}else{if(io(i,n))return;eo.set(n),e.uniformMatrix2fv(this.addr,!1,eo),no(i,n)}}function ho(e,t){var i=this.cache,n=t.elements;if(void 0===n){if(io(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),no(i,t)}else{if(io(i,n))return;$r.set(n),e.uniformMatrix3fv(this.addr,!1,$r),no(i,n)}}function uo(e,t){var i=this.cache,n=t.elements;if(void 0===n){if(io(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),no(i,t)}else{if(io(i,n))return;Jr.set(n),e.uniformMatrix4fv(this.addr,!1,Jr),no(i,n)}}function po(e,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(t||qr,r)}function fo(e,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||Xr,r)}function mo(e,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||Yr,r)}function vo(e,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(t||Kr,r)}function go(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function yo(e,t){var i=this.cache;io(i,t)||(e.uniform2iv(this.addr,t),no(i,t))}function bo(e,t){var i=this.cache;io(i,t)||(e.uniform3iv(this.addr,t),no(i,t))}function Ao(e,t){var i=this.cache;io(i,t)||(e.uniform4iv(this.addr,t),no(i,t))}function wo(e,t){e.uniform1fv(this.addr,t)}function xo(e,t){e.uniform1iv(this.addr,t)}function Eo(e,t){e.uniform2iv(this.addr,t)}function _o(e,t){e.uniform3iv(this.addr,t)}function Mo(e,t){e.uniform4iv(this.addr,t)}function To(e,t){var i=to(t,this.size,2);e.uniform2fv(this.addr,i)}function So(e,t){var i=to(t,this.size,3);e.uniform3fv(this.addr,i)}function Co(e,t){var i=to(t,this.size,4);e.uniform4fv(this.addr,i)}function Lo(e,t){var i=to(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Ro(e,t){var i=to(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Do(e,t){var i=to(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Po(e,t,i){var n=t.length,r=ro(i,n);e.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.safeSetTexture2D(t[o]||qr,r[o])}function Oo(e,t,i){var n=t.length,r=ro(i,n);e.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.safeSetTextureCube(t[o]||Kr,r[o])}function Io(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return oo;case 35664:return ao;case 35665:return so;case 35666:return lo;case 35674:return co;case 35675:return ho;case 35676:return uo;case 35678:case 36198:return po;case 35679:return mo;case 35680:return vo;case 36289:return fo;case 5124:case 35670:return go;case 35667:case 35671:return yo;case 35668:case 35672:return bo;case 35669:case 35673:return Ao}}(t.type)}function ko(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return wo;case 35664:return To;case 35665:return So;case 35666:return Co;case 35674:return Lo;case 35675:return Ro;case 35676:return Do;case 35678:return Po;case 35680:return Oo;case 5124:case 35670:return xo;case 35667:case 35671:return Eo;case 35668:case 35672:return _o;case 35669:case 35673:return Mo}}(t.type)}function Bo(e){this.id=e,this.seq=[],this.map={}}ko.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),no(t,e)},Bo.prototype.setValue=function(e,t,i){for(var n=this.seq,r=0,o=n.length;r!==o;++r){var a=n[r];a.setValue(e,t[a.id],i)}};var No=/([\w\d_]+)(\])?(\[|\.)?/g;function Fo(e,t){e.seq.push(t),e.map[t.id]=t}function Ho(e,t,i){var n=e.name,r=n.length;for(No.lastIndex=0;;){var o=No.exec(n),a=No.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===r){Fo(i,void 0===c?new Io(s,e,t):new ko(s,e,t));break}var h=i.map[s];void 0===h&&Fo(i,h=new Bo(s)),i=h}}function Uo(e,t){this.seq=[],this.map={};for(var i=e.getProgramParameter(t,35718),n=0;n<i;++n){var r=e.getActiveUniform(t,n);Ho(r,e.getUniformLocation(t,r.name),this)}}function jo(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}Uo.prototype.setValue=function(e,t,i,n){var r=this.map[t];void 0!==r&&r.setValue(e,i,n)},Uo.prototype.setOptional=function(e,t,i){var n=t[i];void 0!==n&&this.setValue(e,i,n)},Uo.upload=function(e,t,i,n){for(var r=0,o=t.length;r!==o;++r){var a=t[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}},Uo.seqWithValue=function(e,t){for(var i=[],n=0,r=e.length;n!==r;++n){var o=e[n];o.id in t&&i.push(o)}return i};var zo=0;function Go(e){switch(e){case ut:return["Linear","( value )"];case dt:return["sRGB","( value )"];case ft:return["RGBE","( value )"];case vt:return["RGBM","( value, 7.0 )"];case gt:return["RGBM","( value, 16.0 )"];case yt:return["RGBD","( value, 256.0 )"];case pt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case mt:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Vo(e,t,i){var n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return n&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(e.getShaderSource(t))}function Wo(e,t){var i=Go(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function qo(e,t){var i;switch(t){case X:i="Linear";break;case Y:i="Reinhard";break;case K:i="Uncharted2";break;case Q:i="OptimizedCineon";break;case Z:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Xo(e){return""!==e}function Yo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ko(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Qo=/^[ \t]*#include +<([\w\d./]+)>/gm;function Zo(e){return e.replace(Qo,Jo)}function Jo(e,t){var i=Mr[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Zo(i)}var $o=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function ea(e){return e.replace($o,ta)}function ta(e,t,i,n){for(var r="",o=parseInt(t);o<parseInt(i);o++)r+=n.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function ia(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function na(e,t,i,n,r,l){var c,h,u,d,p,f=e.getContext(),m=n.defines,v=r.vertexShader,g=r.fragmentShader,y=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===o?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===a?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===s&&(t="SHADOWMAP_TYPE_VSM"),t}(l),b=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case $:case ee:t="ENVMAP_TYPE_CUBE";break;case re:case oe:t="ENVMAP_TYPE_CUBE_UV";break;case te:case ie:t="ENVMAP_TYPE_EQUIREC";break;case ne:t="ENVMAP_TYPE_SPHERE"}return t}(l),A=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ee:case ie:t="ENVMAP_MODE_REFRACTION"}return t}(l),w=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case G:t="ENVMAP_BLENDING_MULTIPLY";break;case V:t="ENVMAP_BLENDING_MIX";break;case W:t="ENVMAP_BLENDING_ADD"}return t}(l),x=e.gammaFactor>0?e.gammaFactor:1,E=l.isWebGL2?"":function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Xo).join("\n")}(n.extensions,l,t),_=function(e){var t=[];for(var i in e){var n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(m),M=f.createProgram(),T=l.numMultiviewViews;if(n.isRawShaderMaterial?((c=[_].filter(Xo).join("\n")).length>0&&(c+="\n"),(h=[E,_].filter(Xo).join("\n")).length>0&&(h+="\n")):(c=[ia(l),"#define SHADER_NAME "+r.name,_,l.instancing?"#define USE_INSTANCING":"",l.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+l.maxBones,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+A:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&!1===l.flatShading?"#define USE_MORPHNORMALS":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+y:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&(l.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Xo).join("\n"),h=[E,ia(l),"#define SHADER_NAME "+r.name,_,l.alphaTest?"#define ALPHATEST "+l.alphaTest+(l.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+x,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+b:"",l.envMap?"#define "+A:"",l.envMap?"#define "+w:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.sheen?"#define USE_SHEEN":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+y:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&(l.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensions&&n.extensions.shaderTextureLOD||l.envMap)&&(l.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==q?"#define TONE_MAPPING":"",l.toneMapping!==q?Mr.tonemapping_pars_fragment:"",l.toneMapping!==q?qo("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.outputEncoding||l.mapEncoding||l.matcapEncoding||l.envMapEncoding||l.emissiveMapEncoding||l.lightMapEncoding?Mr.encodings_pars_fragment:"",l.mapEncoding?Wo("mapTexelToLinear",l.mapEncoding):"",l.matcapEncoding?Wo("matcapTexelToLinear",l.matcapEncoding):"",l.envMapEncoding?Wo("envMapTexelToLinear",l.envMapEncoding):"",l.emissiveMapEncoding?Wo("emissiveMapTexelToLinear",l.emissiveMapEncoding):"",l.lightMapEncoding?Wo("lightMapTexelToLinear",l.lightMapEncoding):"",l.outputEncoding?(u="linearToOutputTexel",d=l.outputEncoding,p=Go(d),"vec4 "+u+"( vec4 value ) { return LinearTo"+p[0]+p[1]+"; }"):"",l.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Xo).join("\n")),v=Ko(v=Yo(v=Zo(v),l),l),g=Ko(g=Yo(g=Zo(g),l),l),v=ea(v),g=ea(g),l.isWebGL2&&!n.isRawShaderMaterial){var S=!1,C=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==v.match(C)&&null!==g.match(C)&&(S=!0,v=v.replace(C,""),g=g.replace(C,"")),c=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+c,h=["#version 300 es\n","#define varying in",S?"":"out highp vec4 pc_fragColor;",S?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+h,T>0&&(c=(c=c.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+T+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+T+"];","uniform mat4 projectionMatrices["+T+"];","uniform mat4 viewMatrices["+T+"];","uniform mat3 normalMatrices["+T+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),h=(h=h.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+T+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var L,R,D=h+g,P=jo(f,35633,c+v),O=jo(f,35632,D);if(f.attachShader(M,P),f.attachShader(M,O),void 0!==n.index0AttributeName?f.bindAttribLocation(M,0,n.index0AttributeName):!0===l.morphTargets&&f.bindAttribLocation(M,0,"position"),f.linkProgram(M),e.debug.checkShaderErrors){var I=f.getProgramInfoLog(M).trim(),k=f.getShaderInfoLog(P).trim(),B=f.getShaderInfoLog(O).trim(),N=!0,F=!0;if(!1===f.getProgramParameter(M,35714)){N=!1;var H=Vo(f,P,"vertex"),U=Vo(f,O,"fragment");console.error("THREE.WebGLProgram: shader error: ",f.getError(),"35715",f.getProgramParameter(M,35715),"gl.getProgramInfoLog",I,H,U)}else""!==I?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",I):""!==k&&""!==B||(F=!1);F&&(this.diagnostics={runnable:N,material:n,programLog:I,vertexShader:{log:k,prefix:c},fragmentShader:{log:B,prefix:h}})}return f.deleteShader(P),f.deleteShader(O),this.getUniforms=function(){return void 0===L&&(L=new Uo(f,M)),L},this.getAttributes=function(){return void 0===R&&(R=function(e,t){for(var i={},n=e.getProgramParameter(t,35721),r=0;r<n;r++){var o=e.getActiveAttrib(t,r).name;i[o]=e.getAttribLocation(t,o)}return i}(f,M)),R},this.destroy=function(){f.deleteProgram(M),this.program=void 0},this.name=r.name,this.id=zo++,this.cacheKey=i,this.usedTimes=1,this.program=M,this.vertexShader=P,this.fragmentShader=O,this.numMultiviewViews=T,this}function ra(e,t,i){var n=[],r=i.isWebGL2,o=i.logarithmicDepthBuffer,a=i.floatVertexTextures,s=i.precision,l=i.maxVertexUniforms,u=i.vertexTextures,d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function f(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=ut,i===ut&&t&&(i=pt),i}this.getParameters=function(t,n,p,m,v,g,y){var b=d[t.type],A=y.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(a)return 1024;var i=l,n=Math.floor((i-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}(y):0;null!==t.precision&&(s=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",s,"instead.");var w=e.getRenderTarget(),x=w&&w.isWebGLMultiviewRenderTarget?w.numViews:0;return{isWebGL2:r,shaderID:b,precision:s,instancing:!0===y.isInstancedMesh,supportsVertexTextures:u,numMultiviewViews:x,outputEncoding:f(w?w.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:f(t.map),matcap:!!t.matcap,matcapEncoding:f(t.matcap),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:f(t.envMap),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===re||t.envMap.mapping===oe),lightMap:!!t.lightMap,lightMapEncoding:f(t.lightMap),aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:f(t.emissiveMap),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===xt,tangentSpaceNormalMap:t.normalMapType===wt,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!m,useFog:t.fog,fogExp2:m&&m.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:o,skinning:t.skinning&&A>0,maxBones:A,useVertexTexture:a,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numDirLightShadows:n.directionalShadowMap.length,numPointLightShadows:n.pointShadowMap.length,numSpotLightShadows:n.spotShadowMap.length,numClippingPlanes:v,numClipIntersection:g,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:t.toneMapped?e.toneMapping:q,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===h,flipSided:t.side===c,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCacheKey=function(t,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);for(var o=0;o<p.length;o++)n.push(i[p[o]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.push(e.gammaFactor),n.join()},this.acquireProgram=function(i,r,o,a){for(var s,l=0,c=n.length;l<c;l++){var h=n[l];if(h.cacheKey===a){++(s=h).usedTimes;break}}return void 0===s&&(s=new na(e,t,a,i,r,o),n.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function oa(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function aa(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function sa(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function la(){var e=[],t=0,i=[],n=[],r={id:-1};function o(i,n,o,a,s,l){var c=e[t];return void 0===c?(c={id:i.id,object:i,geometry:n,material:o,program:o.program||r,groupOrder:a,renderOrder:i.renderOrder,z:s,group:l},e[t]=c):(c.id=i.id,c.object=i,c.geometry=n,c.material=o,c.program=o.program||r,c.groupOrder=a,c.renderOrder=i.renderOrder,c.z=s,c.group=l),t++,c}return{opaque:i,transparent:n,init:function(){t=0,i.length=0,n.length=0},push:function(e,t,r,a,s,l){var c=o(e,t,r,a,s,l);(!0===r.transparent?n:i).push(c)},unshift:function(e,t,r,a,s,l){var c=o(e,t,r,a,s,l);(!0===r.transparent?n:i).unshift(c)},sort:function(){i.length>1&&i.sort(aa),n.length>1&&n.sort(sa)}}}function ca(){var e=new WeakMap;function t(i){var n=i.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(i,n){var r,o=e.get(i);return void 0===o?(r=new la,e.set(i,new WeakMap),e.get(i).set(n,r),i.addEventListener("dispose",t)):void 0===(r=o.get(n))&&(r=new la,o.set(n,r)),r},dispose:function(){e=new WeakMap}}}function ha(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new kt,color:new ln,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Dt};break;case"SpotLight":i={position:new kt,direction:new kt,color:new ln,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Dt};break;case"PointLight":i={position:new kt,color:new ln,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Dt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new kt,skyColor:new ln,groundColor:new ln};break;case"RectAreaLight":i={color:new ln,position:new kt,halfWidth:new kt,halfHeight:new kt}}return e[t.id]=i,i}}}var ua=0;function da(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function pa(){for(var e=new ha,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},i=0;i<9;i++)t.probe.push(new kt);var n=new kt,r=new Jt,o=new Jt;return{setup:function(i,a,s){for(var l=0,c=0,h=0,u=0;u<9;u++)t.probe[u].set(0,0,0);var d=0,p=0,f=0,m=0,v=0,g=0,y=0,b=0,A=s.matrixWorldInverse;i.sort(da),u=0;for(var w=i.length;u<w;u++){var x=i[u],E=x.color,_=x.intensity,M=x.distance,T=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)l+=E.r*_,c+=E.g*_,h+=E.b*_;else if(x.isLightProbe)for(var S=0;S<9;S++)t.probe[S].addScaledVector(x.sh.coefficients[S],_);else if(x.isDirectionalLight){if((L=e.get(x)).color.copy(x.color).multiplyScalar(x.intensity),L.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),L.direction.sub(n),L.direction.transformDirection(A),L.shadow=x.castShadow,x.castShadow){var C=x.shadow;L.shadowBias=C.bias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize,t.directionalShadowMap[d]=T,t.directionalShadowMatrix[d]=x.shadow.matrix,g++}t.directional[d]=L,d++}else if(x.isSpotLight)(L=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),L.position.applyMatrix4(A),L.color.copy(E).multiplyScalar(_),L.distance=M,L.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),L.direction.sub(n),L.direction.transformDirection(A),L.coneCos=Math.cos(x.angle),L.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),L.decay=x.decay,L.shadow=x.castShadow,x.castShadow&&(C=x.shadow,L.shadowBias=C.bias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize,t.spotShadowMap[f]=T,t.spotShadowMatrix[f]=x.shadow.matrix,b++),t.spot[f]=L,f++;else if(x.isRectAreaLight)(L=e.get(x)).color.copy(E).multiplyScalar(_),L.position.setFromMatrixPosition(x.matrixWorld),L.position.applyMatrix4(A),o.identity(),r.copy(x.matrixWorld),r.premultiply(A),o.extractRotation(r),L.halfWidth.set(.5*x.width,0,0),L.halfHeight.set(0,.5*x.height,0),L.halfWidth.applyMatrix4(o),L.halfHeight.applyMatrix4(o),t.rectArea[m]=L,m++;else if(x.isPointLight)(L=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),L.position.applyMatrix4(A),L.color.copy(x.color).multiplyScalar(x.intensity),L.distance=x.distance,L.decay=x.decay,L.shadow=x.castShadow,x.castShadow&&(C=x.shadow,L.shadowBias=C.bias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize,L.shadowCameraNear=C.camera.near,L.shadowCameraFar=C.camera.far,t.pointShadowMap[p]=T,t.pointShadowMatrix[p]=x.shadow.matrix,y++),t.point[p]=L,p++;else if(x.isHemisphereLight){var L;(L=e.get(x)).direction.setFromMatrixPosition(x.matrixWorld),L.direction.transformDirection(A),L.direction.normalize(),L.skyColor.copy(x.color).multiplyScalar(_),L.groundColor.copy(x.groundColor).multiplyScalar(_),t.hemi[v]=L,v++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=h;var R=t.hash;R.directionalLength===d&&R.pointLength===p&&R.spotLength===f&&R.rectAreaLength===m&&R.hemiLength===v&&R.numDirectionalShadows===g&&R.numPointShadows===y&&R.numSpotShadows===b||(t.directional.length=d,t.spot.length=f,t.rectArea.length=m,t.point.length=p,t.hemi.length=v,t.directionalShadowMap.length=g,t.pointShadowMap.length=y,t.spotShadowMap.length=b,t.directionalShadowMatrix.length=g,t.pointShadowMatrix.length=y,t.spotShadowMatrix.length=b,R.directionalLength=d,R.pointLength=p,R.spotLength=f,R.rectAreaLength=m,R.hemiLength=v,R.numDirectionalShadows=g,R.numPointShadows=y,R.numSpotShadows=b,t.version=ua++)},state:t}}function fa(){var e=new pa,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(n){e.setup(t,i,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function ma(){var e=new WeakMap;function t(i){var n=i.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(i,n){var r;return!1===e.has(i)?(r=new fa,e.set(i,new WeakMap),e.get(i).set(n,r),i.addEventListener("dispose",t)):!1===e.get(i).has(n)?(r=new fa,e.get(i).set(n,r)):r=e.get(i).get(n),r},dispose:function(){e=new WeakMap}}}function va(e){fn.call(this),this.type="MeshDepthMaterial",this.depthPacking=bt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function ga(e){fn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new kt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}va.prototype=Object.create(fn.prototype),va.prototype.constructor=va,va.prototype.isMeshDepthMaterial=!0,va.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ga.prototype=Object.create(fn.prototype),ga.prototype.constructor=ga,ga.prototype.isMeshDistanceMaterial=!0,ga.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var ya="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpack2HalfToRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",ba="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Aa(e,t,i){var n=new _r,r=new Dt,a=new Dt,u=new zt,d=[],f=[],m={},v={0:c,1:l,2:h},g=new mr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Dt},radius:{value:4}},vertexShader:ba,fragmentShader:ya}),y=g.clone();y.defines.HORIZONAL_PASS=1;var b=new Bn;b.setAttribute("position",new gn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var A=new er(b,g),w=this;function x(i,n){var r=t.update(A);g.uniforms.shadow_pass.value=i.map.texture,g.uniforms.resolution.value=i.mapSize,g.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,r,g,A,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,r,y,A,null)}function E(e,t,i){var n=e|t<<1|i<<2,r=d[n];return void 0===r&&(r=new va({depthPacking:At,morphTargets:e,skinning:t}),d[n]=r),r}function _(e,t,i){var n=e|t<<1|i<<2,r=f[n];return void 0===r&&(r=new ga({morphTargets:e,skinning:t}),f[n]=r),r}function M(t,i,n,r,o,a){var l=t.geometry,c=null,h=E,u=t.customDepthMaterial;if(!0===n.isPointLight&&(h=_,u=t.customDistanceMaterial),void 0===u){var d=!1;!0===i.morphTargets&&(!0===l.isBufferGeometry?d=l.morphAttributes&&l.morphAttributes.position&&l.morphAttributes.position.length>0:!0===l.isGeometry&&(d=l.morphTargets&&l.morphTargets.length>0));var p=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c=h(d,p,!0===t.isInstancedMesh)}else c=u;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var f=c.uuid,g=i.uuid,y=m[f];void 0===y&&(y={},m[f]=y);var b=y[g];void 0===b&&(b=c.clone(),y[g]=b),c=b}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=a===s?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:v[i.side],c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===n.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(n.matrixWorld),c.nearDistance=r,c.farDistance=o),c}function T(i,r,o,a,l){if(!1!==i.visible){if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&l===s)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var c=t.update(i),h=i.material;if(Array.isArray(h))for(var u=c.groups,d=0,p=u.length;d<p;d++){var f=u[d],m=h[f.materialIndex];if(m&&m.visible){var v=M(i,m,a,o.near,o.far,l);e.renderBufferDirect(o,null,c,v,i,f)}}else h.visible&&(v=M(i,h,a,o.near,o.far,l),e.renderBufferDirect(o,null,c,v,i,null))}for(var g=i.children,y=0,b=g.length;y<b;y++)T(g[y],r,o,a,l)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=o,this.render=function(t,o,l){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==t.length){var c=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.state;f.setBlending(p),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var m=0,v=t.length;m<v;m++){var g=t[m],y=g.shadow;if(void 0!==y){r.copy(y.mapSize);var b=y.getFrameExtents();if(r.multiply(b),a.copy(y.mapSize),(r.x>i||r.y>i)&&(console.warn("THREE.WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),r.x>i&&(a.x=Math.floor(i/b.x),r.x=a.x*b.x,y.mapSize.x=a.x),r.y>i&&(a.y=Math.floor(i/b.y),r.y=a.y*b.y,y.mapSize.y=a.y)),null===y.map&&!y.isPointLightShadow&&this.type===s){var A={minFilter:de,magFilter:de,format:Le};y.map=new Gt(r.x,r.y,A),y.map.texture.name=g.name+".shadowMap",y.mapPass=new Gt(r.x,r.y,A),y.camera.updateProjectionMatrix()}null===y.map&&(A={minFilter:ce,magFilter:ce,format:Le},y.map=new Gt(r.x,r.y,A),y.map.texture.name=g.name+".shadowMap",y.camera.updateProjectionMatrix()),e.setRenderTarget(y.map),e.clear();for(var E=y.getViewportCount(),_=0;_<E;_++){var M=y.getViewport(_);u.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),f.viewport(u),y.updateMatrices(g,_),n=y.getFrustum(),T(o,l,y.camera,g,this.type)}y.isPointLightShadow||this.type!==s||x(y,l)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}w.needsUpdate=!1,e.setRenderTarget(c,h,d)}}}function wa(e,t,o){var a=o.isWebGL2;var s=new function(){var t=!1,i=new zt,n=null,r=new zt(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,o,a,s){!0===s&&(t*=a,n*=a,o*=a),i.set(t,n,o,a),!1===r.equals(i)&&(e.clearColor(t,n,o,a),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},l=new function(){var t=!1,i=null,n=null,r=null;return{setTest:function(e){e?be(2929):Ae(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case k:e.depthFunc(512);break;case B:e.depthFunc(519);break;case N:e.depthFunc(513);break;case F:e.depthFunc(515);break;case H:e.depthFunc(514);break;case U:e.depthFunc(518);break;case j:e.depthFunc(516);break;case z:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},u=new function(){var t=!1,i=null,n=null,r=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?be(2960):Ae(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,a){n===t&&r===i&&o===a||(e.stencilFunc(t,i,a),n=t,r=i,o=a)},setOp:function(t,i,n){a===t&&s===i&&l===n||(e.stencilOp(t,i,n),a=t,s=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,o=null,a=null,s=null,l=null,c=null}}},d=e.getParameter(34921),G=new Uint8Array(d),V=new Uint8Array(d),W=new Uint8Array(d),q={},X=null,Y=null,K=null,Q=null,Z=null,J=null,$=null,ee=null,te=null,ie=!1,ne=null,re=null,oe=null,ae=null,se=null,le=e.getParameter(35661),ce=!1,he=0,ue=e.getParameter(7938);-1!==ue.indexOf("WebGL")?(he=parseFloat(/^WebGL\ ([0-9])/.exec(ue)[1]),ce=he>=1):-1!==ue.indexOf("OpenGL ES")&&(he=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ue)[1]),ce=he>=2);var de=null,pe={},fe=new zt,me=new zt;function ve(t,i,n){var r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<n;a++)e.texImage2D(i+a,0,6408,1,1,0,6408,5121,r);return o}var ge={};function ye(i,n){G[i]=1,0===V[i]&&(e.enableVertexAttribArray(i),V[i]=1),W[i]!==n&&((a?e:t.get("ANGLE_instanced_arrays"))[a?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),W[i]=n)}function be(t){!0!==q[t]&&(e.enable(t),q[t]=!0)}function Ae(t){!1!==q[t]&&(e.disable(t),q[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),s.setClear(0,0,0,1),l.setClear(1),u.setClear(0),be(2929),l.setFunc(F),Me(!1),Te(n),be(2884),_e(p);var we={};if(we[b]=32774,we[A]=32778,we[w]=32779,a)we[x]=32775,we[E]=32776;else{var xe=t.get("EXT_blend_minmax");null!==xe&&(we[x]=xe.MIN_EXT,we[E]=xe.MAX_EXT)}var Ee={};function _e(t,i,n,r,o,a,s,l){if(t!==p){if(Y||(be(3042),Y=!0),t===y)o=o||i,a=a||n,s=s||r,i===Q&&o===$||(e.blendEquationSeparate(we[i],we[o]),Q=i,$=o),n===Z&&r===J&&a===ee&&s===te||(e.blendFuncSeparate(Ee[n],Ee[r],Ee[a],Ee[s]),Z=n,J=r,ee=a,te=s),K=t,ie=null;else if(t!==K||l!==ie){if(Q===b&&$===b||(e.blendEquation(32774),Q=b,$=b),l)switch(t){case f:e.blendFuncSeparate(1,771,1,771);break;case m:e.blendFunc(1,1);break;case v:e.blendFuncSeparate(0,0,769,771);break;case g:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case f:e.blendFuncSeparate(770,771,1,771);break;case m:e.blendFunc(770,1);break;case v:e.blendFunc(0,769);break;case g:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,J=null,ee=null,te=null,K=t,ie=l}}else Y&&(Ae(3042),Y=!1)}function Me(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function Te(t){t!==i?(be(2884),t!==re&&(t===n?e.cullFace(1029):t===r?e.cullFace(1028):e.cullFace(1032))):Ae(2884),re=t}function Se(t,i,n){t?(be(32823),ae===i&&se===n||(e.polygonOffset(i,n),ae=i,se=n)):Ae(32823)}function Ce(t){void 0===t&&(t=33984+le-1),de!==t&&(e.activeTexture(t),de=t)}return Ee[_]=0,Ee[M]=1,Ee[T]=768,Ee[C]=770,Ee[I]=776,Ee[P]=774,Ee[R]=772,Ee[S]=769,Ee[L]=771,Ee[O]=775,Ee[D]=773,{buffers:{color:s,depth:l,stencil:u},initAttributes:function(){for(var e=0,t=G.length;e<t;e++)G[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,i=V.length;t!==i;++t)V[t]!==G[t]&&(e.disableVertexAttribArray(t),V[t]=0)},enable:be,disable:Ae,useProgram:function(t){return X!==t&&(e.useProgram(t),X=t,!0)},setBlending:_e,setMaterial:function(e,t){e.side===h?Ae(2884):be(2884);var i=e.side===c;t&&(i=!i),Me(i),e.blending===f&&!1===e.transparent?_e(p):_e(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),l.setFunc(e.depthFunc),l.setTest(e.depthTest),l.setMask(e.depthWrite),s.setMask(e.colorWrite);var n=e.stencilWrite;u.setTest(n),n&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Se(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Me,setCullFace:Te,setLineWidth:function(t){t!==oe&&(ce&&e.lineWidth(t),oe=t)},setPolygonOffset:Se,setScissorTest:function(e){e?be(3089):Ae(3089)},activeTexture:Ce,bindTexture:function(t,i){null===de&&Ce();var n=pe[de];void 0===n&&(n={type:void 0,texture:void 0},pe[de]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||ge[t]),n.type=t,n.texture=i)},unbindTexture:function(){var t=pe[de];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<V.length;t++)1===V[t]&&(e.disableVertexAttribArray(t),V[t]=0);q={},de=null,pe={},X=null,K=null,ne=null,re=null,s.reset(),l.reset(),u.reset()}}}function xa(e,t,i,n,r,o,a){var s,l=r.isWebGL2,c=r.maxTextures,h=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,p=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,i,n){var r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?Rt.floorPowerOfTwo:Math.floor,a=o(r*e.width),l=o(r*e.height);void 0===s&&(s=m(a,l));var c=i?m(a,l):s;return c.width=a,c.height=l,c.getContext("2d").drawImage(e,0,0,a,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+l+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return Rt.isPowerOfTwo(e.width)&&Rt.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==ce&&e.minFilter!==de}function b(t,i,r,o){e.generateMipmap(t),n.get(i).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function A(e,i){if(!1===l)return e;var n=e;return 6403===e&&(5126===i&&(n=33326),5131===i&&(n=33325),5121===i&&(n=33321)),6407===e&&(5126===i&&(n=34837),5131===i&&(n=34843),5121===i&&(n=32849)),6408===e&&(5126===i&&(n=34836),5131===i&&(n=34842),5121===i&&(n=32856)),33325===n||33326===n||34842===n||34836===n?t.get("EXT_color_buffer_float"):34843!==n&&34837!==n||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),n}function w(e){return e===ce||e===he||e===ue?9728:9729}function x(t){var i=t.target;i.removeEventListener("dispose",x),function(t){var i=n.get(t);void 0!==i.__webglInit&&(e.deleteTexture(i.__webglTexture),n.remove(t))}(i),i.isVideoTexture&&p.delete(i),a.memory.textures--}function E(t){var i=t.target;i.removeEventListener("dispose",E),function(t){var i=n.get(t),r=n.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(i.__webglColorTexture),e.deleteTexture(i.__webglDepthStencilTexture),a.memory.textures-=2,o=0;for(var s=i.__webglViewFramebuffers.length;o<s;o++)e.deleteFramebuffer(i.__webglViewFramebuffers[o])}n.remove(t.texture),n.remove(t)}}(i),a.memory.textures--}var _=0;function M(e,t){var r=n.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){var o=e.image;if(void 0===o);else{if(!1!==o.complete)return void P(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function T(t,r){if(6===t.image.length){var a=n.get(t);if(t.version>0&&a.__version!==t.version){D(a,t),i.activeTexture(33984+r),i.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&t.isCompressedTexture,c=t.image[0]&&t.image[0].isDataTexture,u=[],d=0;d<6;d++)u[d]=s||c?c?t.image[d].image:t.image[d]:v(t.image[d],!1,!0,h);var p,f=u[0],m=g(f)||l,w=o.convert(t.format),x=o.convert(t.type),E=A(w,x);if(R(34067,t,m),s){for(d=0;d<6;d++){p=u[d].mipmaps;for(var _=0;_<p.length;_++){var M=p[_];t.format!==Le&&t.format!==Ce?null!==w?i.compressedTexImage2D(34069+d,_,E,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+d,_,E,M.width,M.height,0,w,x,M.data)}}a.__maxMipLevel=p.length-1}else{for(p=t.mipmaps,d=0;d<6;d++)if(c)for(i.texImage2D(34069+d,0,E,u[d].width,u[d].height,0,w,x,u[d].data),_=0;_<p.length;_++){var T=(M=p[_]).image[d].image;i.texImage2D(34069+d,_+1,E,T.width,T.height,0,w,x,T.data)}else for(i.texImage2D(34069+d,0,E,w,x,u[d]),_=0;_<p.length;_++)M=p[_],i.texImage2D(34069+d,_+1,E,w,x,M.image[d]);a.__maxMipLevel=p.length}y(t,m)&&b(34067,t,f.width,f.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+r),i.bindTexture(34067,a.__webglTexture)}}function S(e,t){i.activeTexture(33984+t),i.bindTexture(34067,n.get(e).__webglTexture)}var C={};C[ae]=10497,C[se]=33071,C[le]=33648;var L={};function R(i,o,a){a?(e.texParameteri(i,10242,C[o.wrapS]),e.texParameteri(i,10243,C[o.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,C[o.wrapR]),e.texParameteri(i,10240,L[o.magFilter]),e.texParameteri(i,10241,L[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),o.wrapS===se&&o.wrapT===se||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,w(o.magFilter)),e.texParameteri(i,10241,w(o.minFilter)),o.minFilter!==ce&&o.minFilter!==de&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(o.type===we&&null===t.get("OES_texture_float_linear"))return;if(o.type===xe&&null===(l||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(e.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function D(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",x),t.__webglTexture=e.createTexture(),a.memory.textures++)}function P(t,n,r){var a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),D(t,n),i.activeTexture(33984+r),i.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);var s=function(e){return!l&&(e.wrapS!==se||e.wrapT!==se||e.minFilter!==ce&&e.minFilter!==de)}(n)&&!1===g(n.image);s=!function(){let e=!1,t=navigator.userAgent;if("object"==typeof Browser)if("iphone"==Browser.platform&&("webkit"==Browser.name||"safari"==Browser.name)&&t.includes("like Mac OS X")&&t.includes("CPU iPhone OS")){let i=t.indexOf("CPU iPhone OS"),n=t.indexOf("like Mac OS X"),r=t.slice(i+13,n).split("_");if(2==r.length){if(Number.isInteger(Number(r[0]))&&Number.isInteger(Number(r[1]))){let t=Number(r[0]),i=Number(r[1]);(t>=17||t>=16&&i>=4)&&(e=!0)}}else if(3==r.length){if(Number.isInteger(Number(r[0]))&&Number.isInteger(Number(r[1]))&&Number.isInteger(Number(r[2]))){let t=Number(r[0]),i=Number(r[1]);Number(r[2]),(t>=17||t>=16&&i>=4)&&(e=!0)}}else 1==r.length&&Number.isInteger(Number(r[0]))&&Number(r[0])>=16&&(e=!0)}else if("ipad"==Browser.platform&&("webkit"==Browser.name||"safari"==Browser.name)&&t.includes("like Mac OS X")&&t.includes("CPU OS")){let i=t.indexOf("CPU OS"),n=t.indexOf("like Mac OS X"),r=t.slice(i+6,n).split("_");if(2==r.length){if(Number.isInteger(Number(r[0]))&&Number.isInteger(Number(r[1]))){let t=Number(r[0]),i=Number(r[1]);(t>=17||t>=16&&i>=4)&&(e=!0)}}else if(3==r.length){if(Number.isInteger(Number(r[0]))&&Number.isInteger(Number(r[1]))&&Number.isInteger(Number(r[2]))){let t=Number(r[0]),i=Number(r[1]);Number(r[2]),(t>=17||t>=16&&i>=4)&&(e=!0)}}else 1==r.length&&Number.isInteger(Number(r[0]))&&Number(r[0])>=16&&(e=!0)}else if("mac"==Browser.platform&&("chrome"==Browser.name||"safari"==Browser.name)&&t.includes("Mac OS X")){let i=t.indexOf("Mac OS X"),n=t.slice(i+8)[0].split("_");if(2==n.length){if(Number.isInteger(Number(n[0]))&&Number.isInteger(Number(n[1]))){let t=Number(n[0]),i=Number(n[1]);(t>=17||t>=16&&i>=4)&&(e=!0)}}else if(3==n.length){if(Number.isInteger(Number(n[0]))&&Number.isInteger(Number(n[1]))&&Number.isInteger(Number(n[2]))){let t=Number(n[0]),i=Number(n[1]);Number(n[2]),(t>=17||t>=16&&i>=4)&&(e=!0)}}else 1==n.length&&Number.isInteger(Number(n[0]))&&Number(n[0])>=16&&(e=!0)}return e}()&&s;var c=v(n.image,s,!1,u),h=g(c)||l,d=o.convert(n.format),p=o.convert(n.type),f=A(d,p);R(a,n,h);var m,w=n.mipmaps;if(n.isDepthTexture){if(f=6402,n.type===we){if(!1===l)throw new Error("Float Depth Texture only supported in WebGL2.0");f=36012}else l&&(f=33189);n.format===Oe&&6402===f&&n.type!==ye&&n.type!==Ae&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=ye,p=o.convert(n.type)),n.format===Ie&&(f=34041,n.type!==Te&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Te,p=o.convert(n.type))),i.texImage2D(3553,0,f,c.width,c.height,0,d,p,null)}else if(n.isDataTexture)if(w.length>0&&h){for(var x=0,E=w.length;x<E;x++)m=w[x],i.texImage2D(3553,x,f,m.width,m.height,0,d,p,m.data);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,f,c.width,c.height,0,d,p,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(x=0,E=w.length;x<E;x++)m=w[x],n.format!==Le&&n.format!==Ce?null!==d?i.compressedTexImage2D(3553,x,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,x,f,m.width,m.height,0,d,p,m.data);t.__maxMipLevel=w.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(w.length>0&&h){for(x=0,E=w.length;x<E;x++)m=w[x],i.texImage2D(3553,x,f,d,p,m);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,f,d,p,c),t.__maxMipLevel=0;y(n,h)&&b(3553,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function O(t,r,a,s){var l=o.convert(r.texture.format),c=o.convert(r.texture.type),h=A(l,c);i.texImage2D(s,0,h,r.width,r.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,n.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function I(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){if(n){var r=B(i);e.renderbufferStorageMultisample(36161,r,33189,i.width,i.height)}else e.renderbufferStorage(36161,33189,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer)n?(r=B(i),e.renderbufferStorageMultisample(36161,r,35056,i.width,i.height)):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t);else{var a=A(o.convert(i.texture.format),o.convert(i.texture.type));n?(r=B(i),e.renderbufferStorageMultisample(36161,r,a,i.width,i.height)):e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function k(t){var i=n.get(t),r=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),M(i.depthTexture,0);var r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Oe)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(i.depthTexture.format!==Ie)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(i.__webglFramebuffer,t)}else if(r){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),I(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),I(i.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function B(e){return l&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}L[ce]=9728,L[he]=9984,L[ue]=9986,L[de]=9729,L[pe]=9985,L[fe]=9987;var N=!1,F=!1;this.allocateTextureUnit=function(){var e=_;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=M,this.setTexture2DArray=function(e,t){var r=n.get(e);e.version>0&&r.__version!==e.version?P(r,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=n.get(e);e.version>0&&r.__version!==e.version?P(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=T,this.setTextureCubeDynamic=S,this.setupRenderTarget=function(r){var s=n.get(r),c=n.get(r.texture);r.addEventListener("dispose",E),c.__webglTexture=e.createTexture(),a.memory.textures++;var h=!0===r.isWebGLRenderTargetCube,u=!0===r.isWebGLMultisampleRenderTarget,d=!0===r.isWebGLMultiviewRenderTarget,p=g(r)||l;if(h){s.__webglFramebuffer=[];for(var f=0;f<6;f++)s.__webglFramebuffer[f]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),u)if(l){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=A(o.convert(r.texture.format),o.convert(r.texture.type)),v=B(r);e.renderbufferStorageMultisample(36161,v,m,r.width,r.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),r.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),I(s.__webglDepthRenderbuffer,r,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(d){var w=r.width,x=r.height,_=r.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var M=t.get("OVR_multiview2");a.memory.textures+=2;var T=e.createTexture();e.bindTexture(35866,T),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,w,x,_,0,6408,5121,null),M.framebufferTextureMultiviewOVR(36160,36064,T,0,0,_);var S=e.createTexture();e.bindTexture(35866,S),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,w,x,_,0,34041,34042,null),M.framebufferTextureMultiviewOVR(36160,33306,S,0,0,_);var C=new Array(_);for(f=0;f<_;++f)C[f]=e.createFramebuffer(),e.bindFramebuffer(36160,C[f]),e.framebufferTextureLayer(36160,36064,T,0,f);s.__webglColorTexture=T,s.__webglDepthStencilTexture=S,s.__webglViewFramebuffers=C,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(h){for(i.bindTexture(34067,c.__webglTexture),R(34067,r.texture,p),f=0;f<6;f++)O(s.__webglFramebuffer[f],r,36064,34069+f);y(r.texture,p)&&b(34067,r.texture,r.width,r.height),i.bindTexture(34067,null)}else d||(i.bindTexture(3553,c.__webglTexture),R(3553,r.texture,p),O(s.__webglFramebuffer,r,36064,3553),y(r.texture,p)&&b(3553,r.texture,r.width,r.height),i.bindTexture(3553,null));r.depthBuffer&&k(r)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(y(t,g(e)||l)){var r=e.isWebGLRenderTargetCube?34067:3553,o=n.get(t).__webglTexture;i.bindTexture(r,o),b(r,t,e.width,e.height),i.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(l){var i=n.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);var r=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,r,o,0,0,r,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),M(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?T(e,t):S(e,t)}}function Ea(e,t,i){var n=i.isWebGL2;return{convert:function(e){var i;if(e===me)return 5121;if(e===Ee)return 32819;if(e===_e)return 32820;if(e===Me)return 33635;if(e===ve)return 5120;if(e===ge)return 5122;if(e===ye)return 5123;if(e===be)return 5124;if(e===Ae)return 5125;if(e===we)return 5126;if(e===xe)return n?5131:null!==(i=t.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(e===Se)return 6406;if(e===Ce)return 6407;if(e===Le)return 6408;if(e===Re)return 6409;if(e===De)return 6410;if(e===Oe)return 6402;if(e===Ie)return 34041;if(e===ke)return 6403;if(e===Be||e===Ne||e===Fe||e===He){if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===Be)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ne)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Fe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===He)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Ue||e===je||e===ze||e===Ge){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===Ue)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===je)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===ze)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ge)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===Ve?null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null:e===We||e===qe||e===Xe||e===Ye||e===Ke||e===Qe||e===Ze||e===Je||e===$e||e===et||e===tt||e===it||e===nt||e===rt?null!==(i=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Te?n?34042:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function _a(e,t,i,n){Gt.call(this,e,t,n),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=i}function Ma(e,t){var i,n,r,o,a,s,l,c=2,h=e.extensions,u=e.properties,d=0;function p(e){return e.isArrayCamera?e.cameras:(a[0]=e,a)}this.isAvailable=function(){if(void 0===l){var e=h.get("OVR_multiview2");if(l=null!==e&&!1===t.getContextAttributes().antialias){d=t.getParameter(e.MAX_VIEWS_OVR),i=new _a(0,0,c),s=new Dt,o=[],r=[],a=[];for(var n=0;n<d;n++)o[n]=new Jt,r[n]=new Ft}}return l},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>d)return!1;for(var i=1,n=t.length;i<n;i++)if(t[0].viewport.z!==t[i].viewport.z||t[0].viewport.w!==t[i].viewport.w)return!1;return!0}(t)&&(n=e.getRenderTarget(),function(t){if(n?s.set(n.width,n.height):e.getDrawingBufferSize(s),t.isArrayCamera){var r=t.cameras[0].viewport;i.setSize(r.z,r.w),i.setNumViews(t.cameras.length)}else i.setSize(s.x,s.y),i.setNumViews(c)}(t),e.setRenderTarget(i))},this.detachCamera=function(r){i===e.getRenderTarget()&&(e.setRenderTarget(n),function(e){var n=i,r=n.numViews,o=u.get(n).__webglViewFramebuffers,a=n.width,l=n.height;if(e.isArrayCamera)for(var c=0;c<r;c++){var h=e.cameras[c].viewport,d=h.x,p=h.y,f=d+h.z,m=p+h.w;t.bindFramebuffer(36008,o[c]),t.blitFramebuffer(0,0,a,l,d,p,f,m,16384,9728)}else t.bindFramebuffer(36008,o[0]),t.blitFramebuffer(0,0,a,l,0,0,s.x,s.y,16384,9728)}(r))},this.updateCameraProjectionMatricesUniform=function(e,i){for(var n=p(e),r=0;r<n.length;r++)o[r].copy(n[r].projectionMatrix);i.setValue(t,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(e,i){for(var n=p(e),r=0;r<n.length;r++)o[r].copy(n[r].matrixWorldInverse);i.setValue(t,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(e,i,n){for(var a=p(i),s=0;s<a.length;s++)o[s].multiplyMatrices(a[s].matrixWorldInverse,e.matrixWorld),r[s].getNormalMatrix(o[s]);n.setValue(t,"modelViewMatrices",o),n.setValue(t,"normalMatrices",r)}}function Ta(){vi.call(this),this.type="Group"}function Sa(e){gr.call(this),this.cameras=e||[]}_a.prototype=Object.assign(Object.create(Gt.prototype),{constructor:_a,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Gt.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),Ta.prototype=Object.assign(Object.create(vi.prototype),{constructor:Ta,isGroup:!0}),Sa.prototype=Object.assign(Object.create(gr.prototype),{constructor:Sa,isArrayCamera:!0});var Ca,La=new kt,Ra=new kt;function Da(e,t,i){La.setFromMatrixPosition(t.matrixWorld),Ra.setFromMatrixPosition(i.matrixWorld);var n=La.distanceTo(Ra),r=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(o[8]+1)/o[0],d=a*h,p=a*u,f=n/(-h+u),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=a+f,g=s+f,y=d-m,b=p+(n-m),A=l*s/g*v,w=c*s/g*v;e.projectionMatrix.makePerspective(y,b,A,w,v,g)}function Pa(e){var t,i,n=this,r=null,o=null,a=null,s=[],l=new Jt,c=new Jt,h=1,u="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(o=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",w,!1));var d=new Jt,p=new Pt,f=new kt,m=new gr;m.viewport=new zt,m.layers.enable(1);var v=new gr;v.viewport=new zt,v.layers.enable(2);var g=new Sa([m,v]);function y(){return null!==r&&!0===r.isPresenting}g.layers.enable(1),g.layers.enable(2);var b,A=new Dt;function w(){if(y()){var o=r.getEyeParameters("left");t=2*o.renderWidth*h,i=o.renderHeight*h,b=e.getPixelRatio(),e.getSize(A),e.setDrawingBufferSize(t,i,1),m.viewport.set(0,0,t/2,i),v.viewport.set(t/2,0,t/2,i),T.start(),n.dispatchEvent({type:"sessionstart"})}else n.enabled&&e.setDrawingBufferSize(A.width,A.height,b),T.stop(),n.dispatchEvent({type:"sessionend"})}var x=[],E=[];function _(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),i=0,n=t.length;i<n;i++){var r=t[i];if(r&&("Daydream Controller"===r.id||"Gear VR Controller"===r.id||"Oculus Go Controller"===r.id||"OpenVR Gamepad"===r.id||r.id.startsWith("Oculus Touch")||r.id.startsWith("HTC Vive Focus")||r.id.startsWith("Spatial Controller"))){var o=r.hand;if(0===e&&(""===o||"right"===o))return r;if(1===e&&"left"===o)return r}}}function M(e,n){null!==n&&4===n.length&&e.set(n[0]*t,n[1]*i,n[2]*t,n[3]*i)}this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new Ta).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),T.setContext(e)},this.setFramebufferScaleFactor=function(e){h=e},this.setReferenceSpaceType=function(e){u=e},this.setPoseTarget=function(e){void 0!==e&&(a=e)},this.getCamera=function(e){var t="local-floor"===u?1.6:0;if(r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(o),"local-floor"===u){var i=r.stageParameters;i?l.fromArray(i.sittingToStandingTransform):l.makeTranslation(0,t,0)}var n=o.pose,h=null!==a?a:e;h.matrix.copy(l),h.matrix.decompose(h.position,h.quaternion,h.scale),null!==n.orientation&&(p.fromArray(n.orientation),h.quaternion.multiply(p)),null!==n.position&&(p.setFromRotationMatrix(l),f.fromArray(n.position),f.applyQuaternion(p),h.position.add(f)),h.updateMatrixWorld();for(var y=h.children,b=0,A=y.length;b<A;b++)y[b].updateMatrixWorld(!0);m.near=e.near,v.near=e.near,m.far=e.far,v.far=e.far,m.matrixWorldInverse.fromArray(o.leftViewMatrix),v.matrixWorldInverse.fromArray(o.rightViewMatrix),c.getInverse(l),"local-floor"===u&&(m.matrixWorldInverse.multiply(c),v.matrixWorldInverse.multiply(c));var w=h.parent;null!==w&&(d.getInverse(w.matrixWorld),m.matrixWorldInverse.multiply(d),v.matrixWorldInverse.multiply(d)),m.matrixWorld.getInverse(m.matrixWorldInverse),v.matrixWorld.getInverse(v.matrixWorldInverse),m.projectionMatrix.fromArray(o.leftProjectionMatrix),v.projectionMatrix.fromArray(o.rightProjectionMatrix),Da(g,m,v);var T=r.getLayers();if(T.length){var S=T[0];M(m.viewport,S.leftBounds),M(v.viewport,S.rightBounds)}return function(){for(var e=0;e<s.length;e++){var t=s[e],i=_(e);if(void 0!==i&&void 0!==i.pose){if(null===i.pose)return;var n=i.pose;!1===n.hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(l),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var r="Daydream Controller"===i.id?0:1;void 0===x[e]&&(x[e]=!1),x[e]!==i.buttons[r].pressed&&(x[e]=i.buttons[r].pressed,!0===x[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"}))),r=2,void 0===E[e]&&(E[e]=!1),void 0!==i.buttons[r]&&E[e]!==i.buttons[r].pressed&&(E[e]=i.buttons[r].pressed,!0===E[e]?t.dispatchEvent({type:"squeezestart"}):(t.dispatchEvent({type:"squeezeend"}),t.dispatchEvent({type:"squeeze"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return l},this.isPresenting=y;var T=new Cr;this.setAnimationLoop=function(e){T.setAnimationLoop(e),y()&&T.start()},this.submitFrame=function(){y()&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",w)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Oa(e,t){var i=this,n=null,r=null,o="local-floor",a=null,s=null,l=[],c=[];var h=new gr;h.layers.enable(1),h.viewport=new zt;var u=new gr;u.layers.enable(2),u.viewport=new zt;var d=new Sa([h,u]);d.layers.enable(1),d.layers.enable(2);var p=null,f=null;function m(e){for(var t=0;t<l.length;t++)c[t]===e.inputSource&&l[t].dispatchEvent({type:e.type})}function v(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),x.stop(),i.dispatchEvent({type:"sessionend"})}function g(e){r=e,x.setContext(n),x.start(),i.dispatchEvent({type:"sessionstart"})}function y(){for(var e=0;e<l.length;e++)c[e]=b(e)}function b(e){for(var t=n.inputSources,i=0;i<t.length;i++){var r=t[i],o=r.handedness;if(0===e&&("none"===o||"right"===o))return r;if(1===e&&"left"===o)return r}}function A(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.enabled=!1,this.getController=function(e){var t=l[e];return void 0===t&&((t=new Ta).matrixAutoUpdate=!1,t.visible=!1,l[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){o=e},this.getSession=function(){return n},this.setSession=function(e){null!==(n=e)&&(n.addEventListener("select",m),n.addEventListener("selectstart",m),n.addEventListener("selectend",m),n.addEventListener("squeeze",m),n.addEventListener("squeezestart",m),n.addEventListener("squeezeend",m),n.addEventListener("end",v),n.updateRenderState({baseLayer:new XRWebGLLayer(n,t,{antialias:t.getContextAttributes().antialias,alpha:t.getContextAttributes().alpha,depth:t.getContextAttributes().depth,stencil:t.getContextAttributes().stencil})}),n.requestReferenceSpace(o).then(g),n.addEventListener("inputsourceschange",y),y())},this.setPoseTarget=function(e){void 0!==e&&(s=e)},this.getCamera=function(e){d.near=u.near=h.near=e.near,d.far=u.far=h.far=e.far,p===d.near&&f===d.far||(n.updateRenderState({depthNear:d.near,depthFar:d.far}),p=d.near,f=d.far);var t=e.parent,i=d.cameras,r=s||e;A(d,t);for(var o=0;o<i.length;o++)A(i[o],t);r.matrixWorld.copy(d.matrixWorld);for(var a=r.children,l=(o=0,a.length);o<l;o++)a[o].updateMatrixWorld(!0);return Da(d,h,u),d},this.getCameraPose=function(){return a},this.isPresenting=function(){return null!==n&&null!==r};var w=null;var x=new Cr;x.setAnimationLoop((function(t,i){if(null!==(a=i.getViewerPose(r))){var o=a.views,s=n.renderState.baseLayer;e.setFramebuffer(s.framebuffer);for(var h=0;h<o.length;h++){var u=o[h],p=s.getViewport(u),f=u.transform.inverse.matrix,m=d.cameras[h];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(u.projectionMatrix),m.viewport.set(p.x,p.y,p.width,p.height),0===h&&d.matrix.copy(m.matrix)}}for(h=0;h<l.length;h++){var v=l[h],g=c[h];if(g){var y=i.getPose(g.targetRaySpace,r);if(null!==y){v.matrix.fromArray(y.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.visible=!0;continue}}v.visible=!1}w&&w(t,i)})),this.setAnimationLoop=function(e){w=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new Jt},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Ia(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,d=null,p=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=X,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,m,v,g,y,b,A,w,x,E,_,M,T,S,C,L,R,D,P=this,O=!1,I=null,k=0,B=0,N=null,F=null,H=-1,U={geometry:null,program:null,wireframe:!1},j=null,z=null,G=new zt,V=new zt,W=null,q=t.width,Y=t.height,K=1,Q=new zt(0,0,q,Y),Z=new zt(0,0,q,Y),J=!1,$=new _r,ee=new kr,te=!1,ie=!1,ne=new Jt,re=new kt;function oe(){return null===N?K:1}try{var ae={alpha:n,depth:r,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u,xrCompatible:!0};if(t.addEventListener("webglcontextlost",ue,!1),t.addEventListener("webglcontextrestored",de,!1),null===(f=i||t.getContext("webgl",ae)||t.getContext("experimental-webgl",ae)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function se(){m=new Br(f),!1===(v=new Ir(f,m,e)).isWebGL2&&(m.get("WEBGL_depth_texture"),m.get("OES_texture_float"),m.get("OES_texture_half_float"),m.get("OES_texture_half_float_linear"),m.get("OES_standard_derivatives"),m.get("OES_element_index_uint"),m.get("ANGLE_instanced_arrays")),m.get("OES_texture_float_linear"),D=new Ea(f,m,v),(g=new wa(f,m,v)).scissor(V.copy(Z).multiplyScalar(K).floor()),g.viewport(G.copy(Q).multiplyScalar(K).floor()),y=new Hr(f),b=new oa,A=new xa(f,m,g,b,v,D,y),w=new Lr(f),x=new Nr(f,w,y),E=new zr(f,x,w,y),C=new jr(f),_=new ra(P,m,v),M=new ca,T=new ma,S=new Pr(P,g,E,s),L=new Or(f,m,y,v),R=new Fr(f,m,y,v),y.programs=_.programs,P.capabilities=v,P.extensions=m,P.properties=b,P.renderLists=M,P.state=g,P.info=y}se();var le="undefined"!=typeof navigator&&"xr"in navigator?new Oa(P,f):new Pa(P);this.xr=le;var ce=new Ma(P,f),he=new Aa(P,E,v.maxTextureSize);function ue(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1,se()}function pe(e){var t=e.target;t.removeEventListener("dispose",pe),function(e){fe(e),b.remove(e)}(t)}function fe(e){var t=b.get(e).program;e.program=void 0,void 0!==t&&_.releaseProgram(t)}this.shadowMap=he,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var e=m.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=m.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(e){void 0!==e&&(K=e,this.setSize(q,Y,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Dt),e.set(q,Y)},this.setSize=function(e,i,n){le.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(q=e,Y=i,t.width=Math.floor(e*K),t.height=Math.floor(i*K),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Dt),e.set(q*K,Y*K).floor()},this.setDrawingBufferSize=function(e,i,n){q=e,Y=i,K=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new zt),e.copy(G)},this.getViewport=function(e){return e.copy(Q)},this.setViewport=function(e,t,i,n){e.isVector4?Q.set(e.x,e.y,e.z,e.w):Q.set(e,t,i,n),g.viewport(G.copy(Q).multiplyScalar(K).floor())},this.getScissor=function(e){return e.copy(Z)},this.setScissor=function(e,t,i,n){e.isVector4?Z.set(e.x,e.y,e.z,e.w):Z.set(e,t,i,n),g.scissor(V.copy(Z).multiplyScalar(K).floor())},this.getScissorTest=function(){return J},this.setScissorTest=function(e){g.setScissorTest(J=e)},this.getClearColor=function(){return S.getClearColor()},this.setClearColor=function(){S.setClearColor.apply(S,arguments)},this.getClearAlpha=function(){return S.getClearAlpha()},this.setClearAlpha=function(){S.setClearAlpha.apply(S,arguments)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),f.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ue,!1),t.removeEventListener("webglcontextrestored",de,!1),M.dispose(),T.dispose(),b.dispose(),E.dispose(),le.dispose(),ye.stop()},this.renderBufferImmediate=function(e,t){g.initAttributes();var i=b.get(e);e.hasPositions&&!i.position&&(i.position=f.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=f.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=f.createBuffer()),e.hasColors&&!i.color&&(i.color=f.createBuffer());var n=t.getAttributes();e.hasPositions&&(f.bindBuffer(34962,i.position),f.bufferData(34962,e.positionArray,35048),g.enableAttribute(n.position),f.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(f.bindBuffer(34962,i.normal),f.bufferData(34962,e.normalArray,35048),g.enableAttribute(n.normal),f.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(f.bindBuffer(34962,i.uv),f.bufferData(34962,e.uvArray,35048),g.enableAttribute(n.uv),f.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(f.bindBuffer(34962,i.color),f.bufferData(34962,e.colorArray,35048),g.enableAttribute(n.color),f.vertexAttribPointer(n.color,3,5126,!1,0,0)),g.disableUnusedAttributes(),f.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,o){var a=r.isMesh&&r.matrixWorld.determinant()<0,s=Me(e,t,n,r);g.setMaterial(n,a);var l=!1;U.geometry===i.id&&U.program===s.id&&U.wireframe===(!0===n.wireframe)||(U.geometry=i.id,U.program=s.id,U.wireframe=!0===n.wireframe,l=!0),(n.morphTargets||n.morphNormals)&&(C.update(r,i,n,s),l=!0);var c=i.index,h=i.attributes.position;if((null===c||0!==c.count)&&void 0!==h&&0!==h.count){var u,d=1;!0===n.wireframe&&(c=x.getWireframeAttribute(i),d=2);var p=L;null!==c&&(u=w.get(c),(p=R).setIndex(u)),l&&(function(e,t,i,n){if(!1!==v.isWebGL2||!e.isInstancedMesh&&!t.isInstancedBufferGeometry||null!==m.get("ANGLE_instanced_arrays")){g.initAttributes();var r=t.attributes,o=n.getAttributes(),a=i.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var c=r[s];if(void 0!==c){var h=c.normalized,u=c.itemSize;if(void 0===(E=w.get(c)))continue;var d=E.buffer,p=E.type,y=E.bytesPerElement;if(c.isInterleavedBufferAttribute){var b=c.data,A=b.stride,x=c.offset;b&&b.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(l,b.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=b.meshPerAttribute*b.count)):g.enableAttribute(l),f.bindBuffer(34962,d),f.vertexAttribPointer(l,u,p,h,A*y,x*y)}else c.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=c.meshPerAttribute*c.count)):g.enableAttribute(l),f.bindBuffer(34962,d),f.vertexAttribPointer(l,u,p,h,0,0)}else if("instanceMatrix"===s){var E;if(void 0===(E=w.get(e.instanceMatrix)))continue;d=E.buffer,p=E.type,g.enableAttributeAndDivisor(l+0,1),g.enableAttributeAndDivisor(l+1,1),g.enableAttributeAndDivisor(l+2,1),g.enableAttributeAndDivisor(l+3,1),f.bindBuffer(34962,d),f.vertexAttribPointer(l+0,4,p,!1,64,0),f.vertexAttribPointer(l+1,4,p,!1,64,16),f.vertexAttribPointer(l+2,4,p,!1,64,32),f.vertexAttribPointer(l+3,4,p,!1,64,48)}else if(void 0!==a){var _=a[s];if(void 0!==_)switch(_.length){case 2:f.vertexAttrib2fv(l,_);break;case 3:f.vertexAttrib3fv(l,_);break;case 4:f.vertexAttrib4fv(l,_);break;default:f.vertexAttrib1fv(l,_)}}}}g.disableUnusedAttributes()}}(r,i,n,s),null!==c&&f.bindBuffer(34963,u.buffer));var y=null!==c?c.count:h.count,b=i.drawRange.start*d,A=i.drawRange.count*d,E=null!==o?o.start*d:0,_=null!==o?o.count*d:1/0,M=Math.max(b,E),T=Math.min(y,b+A,E+_)-1,S=Math.max(0,T-M+1);if(0!==S){if(r.isMesh)!0===n.wireframe?(g.setLineWidth(n.wireframeLinewidth*oe()),p.setMode(1)):p.setMode(4);else if(r.isLine){var D=n.linewidth;void 0===D&&(D=1),g.setLineWidth(D*oe()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);r.isInstancedMesh?p.renderInstances(i,M,S,r.count):i.isInstancedBufferGeometry?p.renderInstances(i,M,S,i.maxInstancedCount):p.render(M,S)}}},this.compile=function(e,t){(p=T.get(e,t)).init(),e.traverse((function(e){e.isLight&&(p.pushLight(e),e.castShadow&&p.pushShadow(e))})),p.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)_e(t.material[i],e.fog,t);else _e(t.material,e.fog,t)}))};var ve=null;var ge,ye=new Cr;function be(e,t,i,n){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||$.intersectsSprite(e)){n&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne);var r=E.update(e);(o=e.material).visible&&d.push(e,r,o,i,re.z,null)}}else if(e.isImmediateRenderObject)n&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne),d.push(e,null,e.material,i,re.z,null);else if(e.isMesh||e.isLine||e.isPoints){if(e.isSkinnedMesh&&e.skeleton.frame!==y.render.frame&&(e.skeleton.update(),e.skeleton.frame=y.render.frame,e.parent&&e.skeleton.bonePositionCenter)){let t=e.parent.worldToLocal(e.skeleton.bonePositionCenter);e.position.copy(t)}if(!e.frustumCulled||$.intersectsObject(e)){n&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne),r=E.update(e);var o=e.material;if(Array.isArray(o))for(var a=r.groups,s=0,l=a.length;s<l;s++){var c=a[s],h=o[c.materialIndex];h&&h.visible&&d.push(e,r,h,i,re.z,c)}else o.visible&&d.push(e,r,o,i,re.z,null)}}var u=e.children;for(s=0,l=u.length;s<l;s++)be(u[s],t,i,n)}}function Ae(e,t,i,n){for(var r=0,o=e.length;r<o;r++){var a=e[r],s=a.object,l=a.geometry,c=void 0===n?a.material:n,h=a.group;if(i.isArrayCamera)if(z=i,le.enabled&&ce.isAvailable())Ee(s,t,i,l,c,h);else for(var u=i.cameras,d=0,f=u.length;d<f;d++){var m=u[d];s.layers.test(m.layers)&&(g.viewport(G.copy(m.viewport)),p.setupLights(m),Ee(s,t,m,l,c,h))}else z=null,Ee(s,t,i,l,c,h)}}function Ee(e,t,i,n,r,o){if(e.onBeforeRender(P,t,i,n,r,o),p=T.get(t,z||i),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=Me(i,t.fog,r,e);g.setMaterial(r),U.geometry=null,U.program=null,U.wireframe=!1,function(e,t){e.render((function(e){P.renderBufferImmediate(e,t)}))}(e,a)}else P.renderBufferDirect(i,t.fog,n,r,e,o);e.onAfterRender(P,t,i,n,r,o),p=T.get(t,z||i)}function _e(e,t,i){var n=b.get(e),r=p.state.lights,o=p.state.shadowsArray,a=r.state.version,s=_.getParameters(e,r.state,o,t,ee.numPlanes,ee.numIntersection,i),l=_.getProgramCacheKey(e,s),c=n.program,h=!0;if(void 0===c)e.addEventListener("dispose",pe);else if(c.cacheKey!==l)fe(e);else if(n.lightsStateVersion!==a)n.lightsStateVersion=a,h=!1;else{if(void 0!==s.shaderID)return;h=!1}if(h){if(s.shaderID){var u=Sr[s.shaderID];n.shader={name:e.type,uniforms:hr(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,P),l=_.getProgramCacheKey(e,s),c=_.acquireProgram(e,n.shader,s,l),n.program=c,e.program=c}var d=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<P.maxMorphTargets;f++)d["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,f=0;f<P.maxMorphNormals;f++)d["morphNormal"+f]>=0&&e.numSupportedMorphNormals++;var m=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=ee.numPlanes,n.numIntersection=ee.numIntersection,m.clippingPlanes=ee.uniform),n.fog=t,n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=a,n.needsLights&&(m.ambientLightColor.value=r.state.ambient,m.lightProbe.value=r.state.probe,m.directionalLights.value=r.state.directional,m.spotLights.value=r.state.spot,m.rectAreaLights.value=r.state.rectArea,m.pointLights.value=r.state.point,m.hemisphereLights.value=r.state.hemi,m.directionalShadowMap.value=r.state.directionalShadowMap,m.directionalShadowMatrix.value=r.state.directionalShadowMatrix,m.spotShadowMap.value=r.state.spotShadowMap,m.spotShadowMatrix.value=r.state.spotShadowMatrix,m.pointShadowMap.value=r.state.pointShadowMap,m.pointShadowMatrix.value=r.state.pointShadowMatrix);var v=n.program.getUniforms(),g=Uo.seqWithValue(v.seq,m);n.uniformsList=g}function Me(e,t,i,n){A.resetTextureUnits();var r=b.get(i),o=p.state.lights;if(te&&(ie||e!==j)){var a=e===j&&i.id===H;ee.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,r,a)}i.version===r.__version&&(void 0===r.program||i.fog&&r.fog!==t||r.needsLights&&r.lightsStateVersion!==o.state.version?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===ee.numPlanes&&r.numIntersection===ee.numIntersection||(i.needsUpdate=!0)),i.version!==r.__version&&(_e(i,t,n),r.__version=i.version);var s,l,h=!1,u=!1,d=!1,m=r.program,y=m.getUniforms(),w=r.shader.uniforms;if(g.useProgram(m.program)&&(h=!0,u=!0,d=!0),i.id!==H&&(H=i.id,u=!0),h||j!==e){if(m.numMultiviewViews>0?ce.updateCameraProjectionMatricesUniform(e,y):y.setValue(f,"projectionMatrix",e.projectionMatrix),v.logarithmicDepthBuffer&&y.setValue(f,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),j!==e&&(j=e,u=!0,d=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var x=y.map.cameraPosition;void 0!==x&&x.setValue(f,re.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&y.setValue(f,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&(m.numMultiviewViews>0?ce.updateCameraViewMatricesUniform(e,y):y.setValue(f,"viewMatrix",e.matrixWorldInverse))}if(i.skinning){y.setOptional(f,n,"bindMatrix"),y.setOptional(f,n,"bindMatrixInverse");var E=n.skeleton;if(E){var _=E.bones;if(v.floatVertexTextures){if(void 0===E.boneTexture){var M=Math.sqrt(4*_.length);M=Rt.ceilPowerOfTwo(M),M=Math.max(M,4);var T=new Float32Array(M*M*4);T.set(E.boneMatrices);var S=new wr(T,M,M,Le,we);E.boneMatrices=T,E.boneTexture=S,E.boneTextureSize=M}y.setValue(f,"boneTexture",E.boneTexture,A),y.setValue(f,"boneTextureSize",E.boneTextureSize)}else y.setOptional(f,E,"boneMatrices")}}return(u||r.receiveShadow!==n.receiveShadow)&&(r.receiveShadow=n.receiveShadow,y.setValue(f,"receiveShadow",n.receiveShadow)),u&&(y.setValue(f,"toneMappingExposure",P.toneMappingExposure),y.setValue(f,"toneMappingWhitePoint",P.toneMappingWhitePoint),r.needsLights&&(l=d,(s=w).ambientLightColor.needsUpdate=l,s.lightProbe.needsUpdate=l,s.directionalLights.needsUpdate=l,s.pointLights.needsUpdate=l,s.spotLights.needsUpdate=l,s.rectAreaLights.needsUpdate=l,s.hemisphereLights.needsUpdate=l),t&&i.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(w,t),i.isMeshBasicMaterial?Te(w,i):i.isMeshLambertMaterial?(Te(w,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(w,i)):i.isMeshToonMaterial?(Te(w,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===c&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===c&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,i)):i.isMeshPhongMaterial?(Te(w,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===c&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===c&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,i)):i.isMeshStandardMaterial?(Te(w,i),i.isMeshPhysicalMaterial?function(e,t){Se(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===c&&e.clearcoatNormalScale.value.negate()),e.transparency.value=t.transparency}(w,i):Se(w,i)):i.isMeshMatcapMaterial?(Te(w,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===c&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===c&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,i)):i.isMeshDepthMaterial?(Te(w,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,i)):i.isMeshDistanceMaterial?(Te(w,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(w,i)):i.isMeshNormalMaterial?(Te(w,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===c&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===c&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(w,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(w,i)):i.isPointsMaterial?function(e,t){var i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*K,e.scale.value=.5*Y,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(w,i):i.isSpriteMaterial?function(e,t){var i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(w,i):i.isShadowMaterial?(w.color.value.copy(i.color),w.opacity.value=i.opacity):i.envMap&&Te(w,i),void 0!==w.ltc_1&&(w.ltc_1.value=Tr.LTC_1),void 0!==w.ltc_2&&(w.ltc_2.value=Tr.LTC_2),Uo.upload(f,r.uniformsList,w,A),i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Uo.upload(f,r.uniformsList,w,A),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&y.setValue(f,"center",n.center),m.numMultiviewViews>0?ce.updateObjectMatricesUniforms(n,e,y):(y.setValue(f,"modelViewMatrix",n.modelViewMatrix),y.setValue(f,"normalMatrix",n.normalMatrix)),y.setValue(f,"modelMatrix",n.matrixWorld),m}function Te(e,t){var i,n;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=b.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),t.aoMap?n=t.aoMap:t.lightMap&&(n=t.lightMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uv2Transform.value.copy(n.matrix))}function Se(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===c&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===c&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}ye.setAnimationLoop((function(e){le.isPresenting()||ve&&ve(e)})),"undefined"!=typeof window&&ye.setContext(window),this.setAnimationLoop=function(e){ve=e,le.setAnimationLoop(e),ye.start()},this.render=function(e,t){var i,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!O){U.geometry=null,U.program=null,U.wireframe=!1,H=-1,j=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),le.enabled&&le.isPresenting()&&(t=le.getCamera(t)),(p=T.get(e,t)).init(),e.onBeforeRender(P,e,t,i||N),ne.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),$.setFromMatrix(ne),ie=this.localClippingEnabled,te=ee.init(this.clippingPlanes,ie,t),(d=M.get(e,t)).init(),be(e,t,0,P.sortObjects),!0===P.sortObjects&&d.sort(),te&&ee.beginShadows();var r=p.state.shadowsArray;he.render(r,e,t),p.setupLights(t),te&&ee.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),le.enabled&&ce.isAvailable()&&ce.attachCamera(t),S.render(d,e,t,n);var o=d.opaque,a=d.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&Ae(o,e,t,s),a.length&&Ae(a,e,t,s)}else o.length&&Ae(o,e,t),a.length&&Ae(a,e,t);e.onAfterRender(P,e,t),null!==N&&(A.updateRenderTargetMipmap(N),A.updateMultisampleRenderTarget(N)),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),le.enabled&&(ce.isAvailable()&&ce.detachCamera(t),le.submitFrame()),d=null,p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setTexture2D=(ge=!1,function(e,t){e&&e.isWebGLRenderTarget&&(ge||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),ge=!0),e=e.texture),A.setTexture2D(e,t)}),this.setFramebuffer=function(e){I!==e&&null===N&&f.bindFramebuffer(36160,e),I=e},this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return N},this.setRenderTarget=function(e,t,i){N=e,k=t,B=i,e&&void 0===b.get(e).__webglFramebuffer&&A.setupRenderTarget(e);var n=I,r=!1;if(e){var o=b.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(n=o[t||0],r=!0):n=e.isWebGLMultisampleRenderTarget?b.get(e).__webglMultisampledFramebuffer:o,G.copy(e.viewport),V.copy(e.scissor),W=e.scissorTest}else G.copy(Q).multiplyScalar(K).floor(),V.copy(Z).multiplyScalar(K).floor(),W=J;if(F!==n&&(f.bindFramebuffer(36160,n),F=n),g.viewport(G),g.scissor(V),g.setScissorTest(W),r){var a=b.get(e.texture);f.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,i||0)}},this.readRenderTargetPixels=function(e,t,i,n,r,o,a){if(e&&e.isWebGLRenderTarget){var s=b.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var l=!1;s!==F&&(f.bindFramebuffer(36160,s),l=!0);try{var c=e.texture,h=c.format,u=c.type;if(h!==Le&&D.convert(h)!==f.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===me||D.convert(u)===f.getParameter(35738)||u===we&&(v.isWebGL2||m.get("OES_texture_float")||m.get("WEBGL_color_buffer_float"))||u===xe&&(v.isWebGL2?m.get("EXT_color_buffer_float"):m.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===f.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&f.readPixels(t,i,n,r,D.convert(h),D.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&f.bindFramebuffer(36160,F)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){void 0===i&&(i=0);var n=Math.pow(2,-i),r=Math.floor(t.image.width*n),o=Math.floor(t.image.height*n),a=D.convert(t.format);A.setTexture2D(t,0),f.copyTexImage2D(3553,i,a,e.x,e.y,r,o,0),g.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n){var r=t.image.width,o=t.image.height,a=D.convert(i.format),s=D.convert(i.type);A.setTexture2D(i,0),t.isDataTexture?f.texSubImage2D(3553,n||0,e.x,e.y,r,o,a,s,t.image.data):f.texSubImage2D(3553,n||0,e.x,e.y,a,s,t.image),g.unbindTexture()},this.initTexture=function(e){A.setTexture2D(e,0),g.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ka(e,t){this.name="",this.color=new ln(e),this.density=void 0!==t?t:25e-5}function Ba(e,t,i){this.name="",this.color=new ln(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function Na(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Mt,this.updateRange={offset:0,count:-1},this.version=0}function Fa(e,t,i,n){this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}function Ha(e){fn.call(this),this.type="SpriteMaterial",this.color=new ln(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.assign(Pa.prototype,St.prototype),Object.assign(Oa.prototype,St.prototype),Object.assign(ka.prototype,{isFogExp2:!0,clone:function(){return new ka(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Ba.prototype,{isFog:!0,clone:function(){return new Ba(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Na.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Na.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Fa.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Fa.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}}),Ha.prototype=Object.create(fn.prototype),Ha.prototype.constructor=Ha,Ha.prototype.isSpriteMaterial=!0,Ha.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Ua=new kt,ja=new kt,za=new kt,Ga=new Dt,Va=new Dt,Wa=new Jt,qa=new kt,Xa=new kt,Ya=new kt,Ka=new Dt,Qa=new Dt,Za=new Dt;function Ja(e){if(vi.call(this),this.type="Sprite",void 0===Ca){Ca=new Bn;var t=new Na(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Ca.setIndex([0,1,2,0,2,3]),Ca.setAttribute("position",new Fa(t,3,0,!1)),Ca.setAttribute("uv",new Fa(t,2,3,!1))}this.geometry=Ca,this.material=void 0!==e?e:new Ha,this.center=new Dt(.5,.5)}function $a(e,t,i,n,r,o){Ga.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(Va.x=o*Ga.x-r*Ga.y,Va.y=r*Ga.x+o*Ga.y):Va.copy(Ga),e.copy(t),e.x+=Va.x,e.y+=Va.y,e.applyMatrix4(Wa)}Ja.prototype=Object.assign(Object.create(vi.prototype),{constructor:Ja,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ja.setFromMatrixScale(this.matrixWorld),Wa.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),za.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ja.multiplyScalar(-za.z);var i,n,r=this.material.rotation;0!==r&&(n=Math.cos(r),i=Math.sin(r));var o=this.center;$a(qa.set(-.5,-.5,0),za,o,ja,i,n),$a(Xa.set(.5,-.5,0),za,o,ja,i,n),$a(Ya.set(.5,.5,0),za,o,ja,i,n),Ka.set(0,0),Qa.set(1,0),Za.set(1,1);var a=e.ray.intersectTriangle(qa,Xa,Ya,!1,Ua);if(null!==a||($a(Xa.set(-.5,.5,0),za,o,ja,i,n),Qa.set(0,1),null!==(a=e.ray.intersectTriangle(qa,Ya,Xa,!1,Ua)))){var s=e.ray.origin.distanceTo(Ua);s<e.near||s>e.far||t.push({distance:s,point:Ua.clone(),uv:rn.getUV(Ua,qa,Xa,Ya,Ka,Qa,Za,new Dt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return vi.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var es=new kt,ts=new kt;function is(){vi.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function ns(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),er.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Jt,this.bindMatrixInverse=new Jt}is.prototype=Object.assign(Object.create(vi.prototype),{constructor:is,isLOD:!0,copy:function(e){vi.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,n=t.length;i<n;i++){var r=t[i];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){es.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(es);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){es.setFromMatrixPosition(e.matrixWorld),ts.setFromMatrixPosition(this.matrixWorld);var i=es.distanceTo(ts);t[0].object.visible=!0;for(var n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(;n<r;n++)t[n].object.visible=!1}},toJSON:function(e){var t=vi.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var o=i[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),ns.prototype=Object.assign(Object.create(er.prototype),{constructor:ns,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new zt,t=this.geometry.attributes.skinWeight,i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){er.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var rs=new Jt,os=new Jt,as=new kt;function ss(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,this.bonePositionCenter=new kt,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new Jt)}}function ls(){vi.call(this),this.type="Bone"}Object.assign(ss.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Jt;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;as.set(0,0,0);for(var r=0,o=e.length;r<o;r++){var a=e[r]?e[r].matrixWorld:os;rs.multiplyMatrices(a,t[r]),rs.toArray(i,16*r),as.x+=rs.elements[12]/o,as.y+=rs.elements[13]/o,as.z+=rs.elements[14]/o}this.bonePositionCenter.copy(as),void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new ss(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var n=this.bones[t];if(n.name===e)return n}}}),ls.prototype=Object.assign(Object.create(vi.prototype),{constructor:ls,isBone:!0});var cs=new Jt,hs=new Jt,us=[],ds=new er;function ps(e,t,i){er.call(this,e,t),this.instanceMatrix=new gn(new Float32Array(16*i),16),this.count=i}function fs(e){fn.call(this),this.type="LineBasicMaterial",this.color=new ln(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}ps.prototype=Object.assign(Object.create(er.prototype),{constructor:ps,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var i=this.matrixWorld,n=this.count;if(ds.geometry=this.geometry,ds.material=this.material,void 0!==ds.material)for(var r=0;r<n;r++)this.getMatrixAt(r,cs),hs.multiplyMatrices(i,cs),ds.matrixWorld=hs,ds.raycast(e,us),us.length>0&&(us[0].instanceId=r,us[0].object=this,t.push(us[0]),us.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),fs.prototype=Object.create(fn.prototype),fs.prototype.constructor=fs,fs.prototype.isLineBasicMaterial=!0,fs.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var ms=new kt,vs=new kt,gs=new Jt,ys=new zi,bs=new Ii;function As(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),vi.call(this),this.type="Line",this.geometry=void 0!==e?e:new Bn,this.material=void 0!==t?t:new fs({color:16777215*Math.random()})}As.prototype=Object.assign(Object.create(vi.prototype),{constructor:As,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],n=1,r=t.count;n<r;n++)ms.fromBufferAttribute(t,n-1),vs.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=ms.distanceTo(vs);e.setAttribute("lineDistance",new Mn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((i=e.lineDistances)[0]=0,n=1,r=o.length;n<r;n++)i[n]=i[n-1],i[n]+=o[n-1].distanceTo(o[n])}return this},raycast:function(e,t){var i=e.linePrecision,n=this.geometry,r=this.matrixWorld;if(null===n.boundingSphere&&n.computeBoundingSphere(),bs.copy(n.boundingSphere),bs.applyMatrix4(r),bs.radius+=i,!1!==e.ray.intersectsSphere(bs)){gs.getInverse(r),ys.copy(e.ray).applyMatrix4(gs);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new kt,l=new kt,c=new kt,h=new kt,u=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var d=n.index,p=n.attributes.position.array;if(null!==d)for(var f=d.array,m=0,v=f.length-1;m<v;m+=u){var g=f[m],y=f[m+1];s.fromArray(p,3*g),l.fromArray(p,3*y),ys.distanceSqToSegment(s,l,h,c)>a||(h.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(h))<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,v=p.length/3-1;m<v;m+=u)s.fromArray(p,3*m),l.fromArray(p,3*m+3),ys.distanceSqToSegment(s,l,h,c)>a||(h.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(h))<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(n.isGeometry){var b=n.vertices,A=b.length;for(m=0;m<A-1;m+=u){var w;ys.distanceSqToSegment(b[m],b[m+1],h,c)>a||(h.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(h))<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ws=new kt,xs=new kt;function Es(e,t){As.call(this,e,t),this.type="LineSegments"}function _s(e,t){As.call(this,e,t),this.type="LineLoop"}function Ms(e){fn.call(this),this.type="PointsMaterial",this.color=new ln(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Es.prototype=Object.assign(Object.create(As.prototype),{constructor:Es,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[],n=0,r=t.count;n<r;n+=2)ws.fromBufferAttribute(t,n),xs.fromBufferAttribute(t,n+1),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+ws.distanceTo(xs);e.setAttribute("lineDistance",new Mn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(i=e.lineDistances,n=0,r=o.length;n<r;n+=2)ws.copy(o[n]),xs.copy(o[n+1]),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+ws.distanceTo(xs)}return this}}),_s.prototype=Object.assign(Object.create(As.prototype),{constructor:_s,isLineLoop:!0}),Ms.prototype=Object.create(fn.prototype),Ms.prototype.constructor=Ms,Ms.prototype.isPointsMaterial=!0,Ms.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var Ts=new Jt,Ss=new zi,Cs=new Ii,Ls=new kt;function Rs(e,t){vi.call(this),this.type="Points",this.geometry=void 0!==e?e:new Bn,this.material=void 0!==t?t:new Ms({color:16777215*Math.random()}),this.updateMorphTargets()}function Ds(e,t,i,n,r,o,a){var s=Ss.distanceSqToPoint(e);if(s<i){var l=new kt;Ss.closestPointToPoint(e,l),l.applyMatrix4(n);var c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;o.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:a})}}function Ps(e,t,i,n,r,o,a,s,l){jt.call(this,e,t,i,n,r,o,a,s,l),this.format=void 0!==a?a:Ce,this.minFilter=void 0!==o?o:de,this.magFilter=void 0!==r?r:de,this.generateMipmaps=!1}function Os(e,t,i,n,r,o,a,s,l,c,h,u){jt.call(this,null,o,a,s,l,c,n,r,h,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Is(e,t,i,n,r,o,a,s,l){jt.call(this,e,t,i,n,r,o,a,s,l),this.needsUpdate=!0}function ks(e,t,i,n,r,o,a,s,l,c){if((c=void 0!==c?c:Oe)!==Oe&&c!==Ie)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Oe&&(i=ye),void 0===i&&c===Ie&&(i=Te),jt.call(this,null,n,r,o,a,s,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:ce,this.minFilter=void 0!==s?s:ce,this.flipY=!1,this.generateMipmaps=!1}function Bs(e){Bn.call(this),this.type="WireframeGeometry";var t,i,n,r,o,a,s,l,c,h,u=[],d=[0,0],p={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(i=0;i<3;i++)s=v[f[i]],l=v[f[(i+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)a=p[c],h=e.vertices[a.index1],u.push(h.x,h.y,h.z),h=e.vertices[a.index2],u.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var g,y,b,A,w,x,E;if(h=new kt,null!==e.index){for(g=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),r=0,o=b.length;r<o;++r)for(t=w=(A=b[r]).start,n=w+A.count;t<n;t+=3)for(i=0;i<3;i++)s=y.getX(t+i),l=y.getX(t+(i+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)a=p[c],h.fromBufferAttribute(g,a.index1),u.push(h.x,h.y,h.z),h.fromBufferAttribute(g,a.index2),u.push(h.x,h.y,h.z)}else for(t=0,n=(g=e.attributes.position).count/3;t<n;t++)for(i=0;i<3;i++)x=3*t+i,h.fromBufferAttribute(g,x),u.push(h.x,h.y,h.z),E=3*t+(i+1)%3,h.fromBufferAttribute(g,E),u.push(h.x,h.y,h.z)}this.setAttribute("position",new Mn(u,3))}function Ns(e,t,i){sr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Fs(e,t,i)),this.mergeVertices()}function Fs(e,t,i){Bn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var n,r,o=[],a=[],s=[],l=[],c=1e-5,h=new kt,u=new kt,d=new kt,p=new kt,f=new kt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=t+1;for(n=0;n<=i;n++){var v=n/i;for(r=0;r<=t;r++){var g=r/t;e(g,v,u),a.push(u.x,u.y,u.z),g-c>=0?(e(g-c,v,d),p.subVectors(u,d)):(e(g+c,v,d),p.subVectors(d,u)),v-c>=0?(e(g,v-c,d),f.subVectors(u,d)):(e(g,v+c,d),f.subVectors(d,u)),h.crossVectors(p,f).normalize(),s.push(h.x,h.y,h.z),l.push(g,v)}}for(n=0;n<i;n++)for(r=0;r<t;r++){var y=n*m+r,b=n*m+r+1,A=(n+1)*m+r+1,w=(n+1)*m+r;o.push(y,b,w),o.push(b,A,w)}this.setIndex(o),this.setAttribute("position",new Mn(a,3)),this.setAttribute("normal",new Mn(s,3)),this.setAttribute("uv",new Mn(l,2))}function Hs(e,t,i,n){sr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},this.fromBufferGeometry(new Us(e,t,i,n)),this.mergeVertices()}function Us(e,t,i,n){Bn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1;var r=[],o=[];function a(e,t,i,n){var r,o,a=Math.pow(2,n),l=[];for(r=0;r<=a;r++){l[r]=[];var c=e.clone().lerp(i,r/a),h=t.clone().lerp(i,r/a),u=a-r;for(o=0;o<=u;o++)l[r][o]=0===o&&r===a?c:c.clone().lerp(h,o/u)}for(r=0;r<a;r++)for(o=0;o<2*(a-r)-1;o++){var d=Math.floor(o/2);o%2==0?(s(l[r][d+1]),s(l[r+1][d]),s(l[r][d])):(s(l[r][d+1]),s(l[r+1][d+1]),s(l[r+1][d]))}}function s(e){r.push(e.x,e.y,e.z)}function l(t,i){var n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}(function(e){for(var i=new kt,n=new kt,r=new kt,o=0;o<t.length;o+=3)l(t[o+0],i),l(t[o+1],n),l(t[o+2],r),a(i,n,r,e)})(n=n||0),function(e){for(var t=new kt,i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){for(var e=new kt,t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];var i=h(e)/2/Math.PI+.5,n=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(i,1-n)}var a;(function(){for(var e=new kt,t=new kt,i=new kt,n=new kt,a=new Dt,s=new Dt,l=new Dt,u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(e).add(t).add(i).divideScalar(3);var p=h(n);c(a,d+0,e,p),c(s,d+2,t,p),c(l,d+4,i,p)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],i=o[e+2],n=o[e+4],r=Math.max(t,i,n),a=Math.min(t,i,n);r>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),n<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new Mn(r,3)),this.setAttribute("normal",new Mn(r.slice(),3)),this.setAttribute("uv",new Mn(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function js(e,t){sr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new zs(e,t)),this.mergeVertices()}function zs(e,t){Us.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Gs(e,t){sr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Vs(e,t)),this.mergeVertices()}function Vs(e,t){Us.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ws(e,t){sr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qs(e,t)),this.mergeVertices()}function qs(e,t){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];Us.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Xs(e,t){sr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ys(e,t)),this.mergeVertices()}function Ys(e,t){var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n];Us.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ks(e,t,i,n,r,o){sr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Qs(e,t,i,n,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Qs(e,t,i,n,r){Bn.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r},t=t||64,i=i||1,n=n||8,r=r||!1;var o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new kt,c=new kt,h=new Dt,u=new kt,d=[],p=[],f=[],m=[];function v(r){u=e.getPointAt(r/t,u);var a=o.normals[r],h=o.binormals[r];for(s=0;s<=n;s++){var f=s/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*a.x+m*h.x,c.y=v*a.y+m*h.y,c.z=v*a.z+m*h.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=u.x+i*c.x,l.y=u.y+i*c.y,l.z=u.z+i*c.z,d.push(l.x,l.y,l.z)}}(function(){for(a=0;a<t;a++)v(a);v(!1===r?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=n;s++)h.x=a/t,h.y=s/n,f.push(h.x,h.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=n;a++){var e=(n+1)*(s-1)+(a-1),i=(n+1)*s+(a-1),r=(n+1)*s+a,o=(n+1)*(s-1)+a;m.push(e,i,o),m.push(i,r,o)}}()})(),this.setIndex(m),this.setAttribute("position",new Mn(d,3)),this.setAttribute("normal",new Mn(p,3)),this.setAttribute("uv",new Mn(f,2))}function Zs(e,t,i,n,r,o,a){sr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Js(e,t,i,n,r,o)),this.mergeVertices()}function Js(e,t,i,n,r,o){Bn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},e=e||1,t=t||.4,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,o=o||3;var a,s,l=[],c=[],h=[],u=[],d=new kt,p=new kt,f=new kt,m=new kt,v=new kt,g=new kt,y=new kt;for(a=0;a<=i;++a){var b=a/i*r*Math.PI*2;for(S(b,r,o,e,f),S(b+.01,r,o,e,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var A=s/n*Math.PI*2,w=-t*Math.cos(A),x=t*Math.sin(A);d.x=f.x+(w*y.x+x*v.x),d.y=f.y+(w*y.y+x*v.y),d.z=f.z+(w*y.z+x*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),h.push(p.x,p.y,p.z),u.push(a/i),u.push(s/n)}}for(s=1;s<=i;s++)for(a=1;a<=n;a++){var E=(n+1)*(s-1)+(a-1),_=(n+1)*s+(a-1),M=(n+1)*s+a,T=(n+1)*(s-1)+a;l.push(E,_,T),l.push(_,M,T)}function S(e,t,i,n,r){var o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);r.x=n*(2+l)*.5*o,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new Mn(c,3)),this.setAttribute("normal",new Mn(h,3)),this.setAttribute("uv",new Mn(u,2))}function $s(e,t,i,n,r){sr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new el(e,t,i,n,r)),this.mergeVertices()}function el(e,t,i,n,r){Bn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},e=e||1,t=t||.4,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var o,a,s=[],l=[],c=[],h=[],u=new kt,d=new kt,p=new kt;for(o=0;o<=i;o++)for(a=0;a<=n;a++){var f=a/n*r,m=o/i*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),p.subVectors(d,u).normalize(),c.push(p.x,p.y,p.z),h.push(a/n),h.push(o/i)}for(o=1;o<=i;o++)for(a=1;a<=n;a++){var v=(n+1)*o+a-1,g=(n+1)*(o-1)+a-1,y=(n+1)*(o-1)+a,b=(n+1)*o+a;s.push(v,g,b),s.push(g,y,b)}this.setIndex(s),this.setAttribute("position",new Mn(l,3)),this.setAttribute("normal",new Mn(c,3)),this.setAttribute("uv",new Mn(h,2))}Rs.prototype=Object.assign(Object.create(vi.prototype),{constructor:Rs,isPoints:!0,raycast:function(e,t){var i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Cs.copy(i.boundingSphere),Cs.applyMatrix4(n),Cs.radius+=r,!1!==e.ray.intersectsSphere(Cs)){Ts.getInverse(n),Ss.copy(e.ray).applyMatrix4(Ts);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){var s=i.index,l=i.attributes.position.array;if(null!==s)for(var c=s.array,h=0,u=c.length;h<u;h++){var d=c[h];Ls.fromArray(l,3*d),Ds(Ls,d,a,n,e,t,this)}else{h=0;for(var p=l.length/3;h<p;h++)Ls.fromArray(l,3*h),Ds(Ls,h,a,n,e,t,this)}}else{var f=i.vertices;for(h=0,p=f.length;h<p;h++)Ds(f[h],h,a,n,e,t,this)}}},updateMorphTargets:function(){var e,t,i,n=this.geometry;if(n.isBufferGeometry){var r=n.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ps.prototype=Object.assign(Object.create(jt.prototype),{constructor:Ps,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Os.prototype=Object.create(jt.prototype),Os.prototype.constructor=Os,Os.prototype.isCompressedTexture=!0,Is.prototype=Object.create(jt.prototype),Is.prototype.constructor=Is,Is.prototype.isCanvasTexture=!0,ks.prototype=Object.create(jt.prototype),ks.prototype.constructor=ks,ks.prototype.isDepthTexture=!0,Bs.prototype=Object.create(Bn.prototype),Bs.prototype.constructor=Bs,Ns.prototype=Object.create(sr.prototype),Ns.prototype.constructor=Ns,Fs.prototype=Object.create(Bn.prototype),Fs.prototype.constructor=Fs,Hs.prototype=Object.create(sr.prototype),Hs.prototype.constructor=Hs,Us.prototype=Object.create(Bn.prototype),Us.prototype.constructor=Us,js.prototype=Object.create(sr.prototype),js.prototype.constructor=js,zs.prototype=Object.create(Us.prototype),zs.prototype.constructor=zs,Gs.prototype=Object.create(sr.prototype),Gs.prototype.constructor=Gs,Vs.prototype=Object.create(Us.prototype),Vs.prototype.constructor=Vs,Ws.prototype=Object.create(sr.prototype),Ws.prototype.constructor=Ws,qs.prototype=Object.create(Us.prototype),qs.prototype.constructor=qs,Xs.prototype=Object.create(sr.prototype),Xs.prototype.constructor=Xs,Ys.prototype=Object.create(Us.prototype),Ys.prototype.constructor=Ys,Ks.prototype=Object.create(sr.prototype),Ks.prototype.constructor=Ks,Qs.prototype=Object.create(Bn.prototype),Qs.prototype.constructor=Qs,Qs.prototype.toJSON=function(){var e=Bn.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},Zs.prototype=Object.create(sr.prototype),Zs.prototype.constructor=Zs,Js.prototype=Object.create(Bn.prototype),Js.prototype.constructor=Js,$s.prototype=Object.create(sr.prototype),$s.prototype.constructor=$s,el.prototype=Object.create(Bn.prototype),el.prototype.constructor=el;var tl=function(e,t,i){i=i||2;var n,r,o,a,s,l,c,h=t&&t.length,u=h?t[0]*i:e.length,d=il(e,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,i,n){var r,o,a,s=[];for(r=0,o=t.length;r<o;r++)(a=il(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(dl(a));for(s.sort(cl),r=0;r<s.length;r++)hl(s[r],i),i=nl(i,i.next);return i}(e,t,d,i)),e.length>80*i){n=o=e[0],r=a=e[1];for(var f=i;f<u;f+=i)(s=e[f])<n&&(n=s),(l=e[f+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-n,a-r))?1/c:0}return rl(d,p,i,n,r,c),p};function il(e,t,i,n,r){var o,a;if(r===function(e,t,i,n){for(var r=0,o=t,a=i-n;o<i;o+=n)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}(e,t,i,n)>0)for(o=t;o<i;o+=n)a=Al(o,e[o],e[o+1],a);else for(o=i-n;o>=t;o-=n)a=Al(o,e[o],e[o+1],a);return a&&vl(a,a.next)&&(wl(a),a=a.next),a}function nl(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!vl(n,n.next)&&0!==ml(n.prev,n,n.next))n=n.next;else{if(wl(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function rl(e,t,i,n,r,o,a){if(e){!a&&o&&function(e,t,i,n){var r=e;do{null===r.z&&(r.z=ul(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,n=i,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(a>1)}(r)}(e,n,r,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?al(e,n,r,o):ol(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),wl(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?rl(e=sl(e,t,i),t,i,n,r,o,2):2===a&&ll(e,t,i,n,r,o):rl(nl(e),t,i,n,r,o,1);break}}}function ol(e){var t=e.prev,i=e,n=e.next;if(ml(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(pl(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&ml(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function al(e,t,i,n){var r=e.prev,o=e,a=e.next;if(ml(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,c=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,h=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,u=ul(s,l,t,i,n),d=ul(c,h,t,i,n),p=e.prevZ,f=e.nextZ;p&&p.z>=u&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&pl(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ml(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&pl(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&ml(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&pl(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ml(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&pl(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&ml(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function sl(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!vl(r,o)&&gl(r,n,n.next,o)&&yl(r,o)&&yl(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),wl(n),wl(n.next),n=e=o),n=n.next}while(n!==e);return n}function ll(e,t,i,n,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&fl(a,s)){var l=bl(a,s);return a=nl(a,a.next),l=nl(l,l.next),rl(a,t,i,n,r,o),void rl(l,t,i,n,r,o)}s=s.next}a=a.next}while(a!==e)}function cl(e,t){return e.x-t.x}function hl(e,t){if(t=function(e,t){var i,n=t,r=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a){if(a=s,s===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===a)return i.prev;var l,c=i,h=i.x,u=i.y,d=1/0;for(n=i.next;n!==c;)r>=n.x&&n.x>=h&&r!==n.x&&pl(o<u?r:a,o,h,u,o<u?a:r,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(r-n.x))<d||l===d&&n.x>i.x)&&yl(n,e)&&(i=n,d=l),n=n.next;return i}(e,t)){var i=bl(t,e);nl(i,i.next)}}function ul(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function dl(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function pl(e,t,i,n,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function fl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&gl(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&yl(e,t)&&yl(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)}function ml(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function vl(e,t){return e.x===t.x&&e.y===t.y}function gl(e,t,i,n){return!!(vl(e,i)&&vl(t,n)||vl(e,n)&&vl(i,t))||ml(e,t,i)>0!=ml(e,t,n)>0&&ml(i,n,e)>0!=ml(i,n,t)>0}function yl(e,t){return ml(e.prev,e,e.next)<0?ml(e,t,e.next)>=0&&ml(e,e.prev,t)>=0:ml(e,t,e.prev)<0||ml(e,e.next,t)<0}function bl(e,t){var i=new xl(e.i,e.x,e.y),n=new xl(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Al(e,t,i,n){var r=new xl(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function wl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function xl(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var El={area:function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},isClockWise:function(e){return El.area(e)<0},triangulateShape:function(e,t){var i=[],n=[],r=[];_l(e),Ml(i,e);var o=e.length;t.forEach(_l);for(var a=0;a<t.length;a++)n.push(o),o+=t[a].length,Ml(i,t[a]);var s=tl(i,n);for(a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};function _l(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ml(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function Tl(e,t){sr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Sl(e,t)),this.mergeVertices()}function Sl(e,t){Bn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var i=this,n=[],r=[],o=0,a=e.length;o<a;o++)s(e[o]);function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,u=void 0!==t.bevelSize?t.bevelSize:h-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3,f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Cl;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var v,g,y,b,A,w,x,E,_=!1;f&&(v=f.getSpacedPoints(s),_=!0,c=!1,g=f.computeFrenetFrames(s,!1),y=new kt,b=new kt,A=new kt),c||(p=0,h=0,u=0,d=0);var M=e.extractPoints(a),T=M.shape,S=M.holes;if(!El.isClockWise(T))for(T=T.reverse(),x=0,E=S.length;x<E;x++)w=S[x],El.isClockWise(w)&&(S[x]=w.reverse());var C=El.triangulateShape(T,S),L=T;for(x=0,E=S.length;x<E;x++)w=S[x],T=T.concat(w);function R(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var D,P,O,I,k,B,N=T.length,F=C.length;function H(e,t,i){var n,r,o,a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=a*a+s*s,u=a*c-s*l;if(Math.abs(u)>Number.EPSILON){var d=Math.sqrt(h),p=Math.sqrt(l*l+c*c),f=t.x-s/d,m=t.y+a/d,v=((i.x-c/p-f)*c-(i.y+l/p-m)*l)/(a*c-s*l),g=(n=f+a*v-e.x)*n+(r=m+s*v-e.y)*r;if(g<=2)return new Dt(n,r);o=Math.sqrt(g/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(n=-s,r=a,o=Math.sqrt(h)):(n=a,r=s,o=Math.sqrt(h/2))}return new Dt(n/o,r/o)}for(var U=[],j=0,z=L.length,G=z-1,V=j+1;j<z;j++,G++,V++)G===z&&(G=0),V===z&&(V=0),U[j]=H(L[j],L[G],L[V]);var W,q,X=[],Y=U.concat();for(x=0,E=S.length;x<E;x++){for(w=S[x],W=[],j=0,G=(z=w.length)-1,V=j+1;j<z;j++,G++,V++)G===z&&(G=0),V===z&&(V=0),W[j]=H(w[j],w[G],w[V]);X.push(W),Y=Y.concat(W)}for(D=0;D<p;D++){for(O=D/p,I=h*Math.cos(O*Math.PI/2),P=u*Math.sin(O*Math.PI/2)+d,j=0,z=L.length;j<z;j++)Q((k=R(L[j],U[j],P)).x,k.y,-I);for(x=0,E=S.length;x<E;x++)for(w=S[x],W=X[x],j=0,z=w.length;j<z;j++)Q((k=R(w[j],W[j],P)).x,k.y,-I)}for(P=u+d,j=0;j<N;j++)k=c?R(T[j],Y[j],P):T[j],_?(b.copy(g.normals[0]).multiplyScalar(k.x),y.copy(g.binormals[0]).multiplyScalar(k.y),A.copy(v[0]).add(b).add(y),Q(A.x,A.y,A.z)):Q(k.x,k.y,0);for(q=1;q<=s;q++)for(j=0;j<N;j++)k=c?R(T[j],Y[j],P):T[j],_?(b.copy(g.normals[q]).multiplyScalar(k.x),y.copy(g.binormals[q]).multiplyScalar(k.y),A.copy(v[q]).add(b).add(y),Q(A.x,A.y,A.z)):Q(k.x,k.y,l/s*q);for(D=p-1;D>=0;D--){for(O=D/p,I=h*Math.cos(O*Math.PI/2),P=u*Math.sin(O*Math.PI/2)+d,j=0,z=L.length;j<z;j++)Q((k=R(L[j],U[j],P)).x,k.y,l+I);for(x=0,E=S.length;x<E;x++)for(w=S[x],W=X[x],j=0,z=w.length;j<z;j++)k=R(w[j],W[j],P),_?Q(k.x,k.y+v[s-1].y,v[s-1].x+I):Q(k.x,k.y,l+I)}function K(e,t){var i,n;for(j=e.length;--j>=0;){i=j,(n=j-1)<0&&(n=e.length-1);var r=0,o=s+2*p;for(r=0;r<o;r++){var a=N*r,l=N*(r+1);J(t+i+a,t+n+a,t+n+l,t+i+l)}}}function Q(e,t,i){o.push(e),o.push(t),o.push(i)}function Z(e,t,r){$(e),$(t),$(r);var o=n.length/3,a=m.generateTopUV(i,n,o-3,o-2,o-1);ee(a[0]),ee(a[1]),ee(a[2])}function J(e,t,r,o){$(e),$(t),$(o),$(t),$(r),$(o);var a=n.length/3,s=m.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){n.push(o[3*e+0]),n.push(o[3*e+1]),n.push(o[3*e+2])}function ee(e){r.push(e.x),r.push(e.y)}(function(){var e=n.length/3;if(c){var t=0,r=N*t;for(j=0;j<F;j++)Z((B=C[j])[2]+r,B[1]+r,B[0]+r);for(r=N*(t=s+2*p),j=0;j<F;j++)Z((B=C[j])[0]+r,B[1]+r,B[2]+r)}else{for(j=0;j<F;j++)Z((B=C[j])[2],B[1],B[0]);for(j=0;j<F;j++)Z((B=C[j])[0]+N*s,B[1]+N*s,B[2]+N*s)}i.addGroup(e,n.length/3-e,0)})(),function(){var e=n.length/3,t=0;for(K(L,t),t+=L.length,x=0,E=S.length;x<E;x++)K(w=S[x],t),t+=w.length;i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new Mn(n,3)),this.setAttribute("uv",new Mn(r,2)),this.computeVertexNormals()}Tl.prototype=Object.create(sr.prototype),Tl.prototype.constructor=Tl,Tl.prototype.toJSON=function(){var e=sr.prototype.toJSON.call(this);return Ll(this.parameters.shapes,this.parameters.options,e)},Sl.prototype=Object.create(Bn.prototype),Sl.prototype.constructor=Sl,Sl.prototype.toJSON=function(){var e=Bn.prototype.toJSON.call(this);return Ll(this.parameters.shapes,this.parameters.options,e)};var Cl={generateTopUV:function(e,t,i,n,r){var o=t[3*i],a=t[3*i+1],s=t[3*n],l=t[3*n+1],c=t[3*r],h=t[3*r+1];return[new Dt(o,a),new Dt(s,l),new Dt(c,h)]},generateSideWallUV:function(e,t,i,n,r,o){var a=t[3*i],s=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(s-h)<.01?[new Dt(a,1-l),new Dt(c,1-u),new Dt(d,1-f),new Dt(m,1-g)]:[new Dt(s,1-l),new Dt(h,1-u),new Dt(p,1-f),new Dt(v,1-g)]}};function Ll(e,t,i){if(i.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var o=e[n];i.shapes.push(o.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Rl(e,t){sr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Dl(e,t)),this.mergeVertices()}function Dl(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new sr;var n=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Sl.call(this,n,t),this.type="TextBufferGeometry"}function Pl(e,t,i,n,r,o,a){sr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Ol(e,t,i,n,r,o,a)),this.mergeVertices()}function Ol(e,t,i,n,r,o,a){Bn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,c=Math.min(o+a,Math.PI),h=0,u=[],d=new kt,p=new kt,f=[],m=[],v=[],g=[];for(l=0;l<=i;l++){var y=[],b=l/i,A=0;for(0==l&&0==o?A=.5/t:l==i&&c==Math.PI&&(A=-.5/t),s=0;s<=t;s++){var w=s/t;d.x=-e*Math.cos(n+w*r)*Math.sin(o+b*a),d.y=e*Math.cos(o+b*a),d.z=e*Math.sin(n+w*r)*Math.sin(o+b*a),m.push(d.x,d.y,d.z),p.copy(d).normalize(),v.push(p.x,p.y,p.z),g.push(w+A,1-b),y.push(h++)}u.push(y)}for(l=0;l<i;l++)for(s=0;s<t;s++){var x=u[l][s+1],E=u[l][s],_=u[l+1][s],M=u[l+1][s+1];(0!==l||o>0)&&f.push(x,E,M),(l!==i-1||c<Math.PI)&&f.push(E,_,M)}this.setIndex(f),this.setAttribute("position",new Mn(m,3)),this.setAttribute("normal",new Mn(v,3)),this.setAttribute("uv",new Mn(g,2))}function Il(e,t,i,n,r,o){sr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new kl(e,t,i,n,r,o)),this.mergeVertices()}function kl(e,t,i,n,r,o){Bn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},e=e||.5,t=t||1,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,s,l,c=[],h=[],u=[],d=[],p=e,f=(t-e)/(n=void 0!==n?Math.max(1,n):1),m=new kt,v=new Dt;for(s=0;s<=n;s++){for(l=0;l<=i;l++)a=r+l/i*o,m.x=p*Math.cos(a),m.y=p*Math.sin(a),h.push(m.x,m.y,m.z),u.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<n;s++){var g=s*(i+1);for(l=0;l<i;l++){var y=a=l+g,b=a+i+1,A=a+i+2,w=a+1;c.push(y,b,w),c.push(b,A,w)}}this.setIndex(c),this.setAttribute("position",new Mn(h,3)),this.setAttribute("normal",new Mn(u,3)),this.setAttribute("uv",new Mn(d,2))}function Bl(e,t,i,n){sr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},this.fromBufferGeometry(new Nl(e,t,i,n)),this.mergeVertices()}function Nl(e,t,i,n){Bn.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t)||12,i=i||0,n=n||2*Math.PI,n=Rt.clamp(n,0,2*Math.PI);var r,o,a,s=[],l=[],c=[],h=1/t,u=new kt,d=new Dt;for(o=0;o<=t;o++){var p=i+o*h*n,f=Math.sin(p),m=Math.cos(p);for(a=0;a<=e.length-1;a++)u.x=e[a].x*f,u.y=e[a].y,u.z=e[a].x*m,l.push(u.x,u.y,u.z),d.x=o/t,d.y=a/(e.length-1),c.push(d.x,d.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var v=r=a+o*e.length,g=r+e.length,y=r+e.length+1,b=r+1;s.push(v,g,b),s.push(g,y,b)}if(this.setIndex(s),this.setAttribute("position",new Mn(l,3)),this.setAttribute("uv",new Mn(c,2)),this.computeVertexNormals(),n===2*Math.PI){var A=this.attributes.normal.array,w=new kt,x=new kt,E=new kt;for(r=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)w.x=A[a+0],w.y=A[a+1],w.z=A[a+2],x.x=A[r+a+0],x.y=A[r+a+1],x.z=A[r+a+2],E.addVectors(w,x).normalize(),A[a+0]=A[r+a+0]=E.x,A[a+1]=A[r+a+1]=E.y,A[a+2]=A[r+a+2]=E.z}}function Fl(e,t){sr.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Hl(e,t)),this.mergeVertices()}function Hl(e,t){Bn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],n=[],r=[],o=[],a=0,s=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(a,s,l),a+=s,s=0;function c(e){var a,l,c,h=n.length/3,u=e.extractPoints(t),d=u.shape,p=u.holes;for(!1===El.isClockWise(d)&&(d=d.reverse()),a=0,l=p.length;a<l;a++)c=p[a],!0===El.isClockWise(c)&&(p[a]=c.reverse());var f=El.triangulateShape(d,p);for(a=0,l=p.length;a<l;a++)c=p[a],d=d.concat(c);for(a=0,l=d.length;a<l;a++){var m=d[a];n.push(m.x,m.y,0),r.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var v=f[a],g=v[0]+h,y=v[1]+h,b=v[2]+h;i.push(g,y,b),s+=3}}this.setIndex(i),this.setAttribute("position",new Mn(n,3)),this.setAttribute("normal",new Mn(r,3)),this.setAttribute("uv",new Mn(o,2))}function Ul(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++){var r=e[i];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}function jl(e,t){Bn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var i,n,r,o,a=[],s=Math.cos(Rt.DEG2RAD*t),l=[0,0],c={},h=["a","b","c"];e.isBufferGeometry?(o=new sr).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var u=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)i=m[h[v]],n=m[h[(v+1)%3]],l[0]=Math.min(i,n),l[1]=Math.max(i,n),void 0===c[r=l[0]+","+l[1]]?c[r]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[r].face2=p;for(r in c){var g=c[r];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=u[g.index1];a.push(y.x,y.y,y.z),y=u[g.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new Mn(a,3))}function zl(e,t,i,n,r,o,a,s){sr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Gl(e,t,i,n,r,o,a,s)),this.mergeVertices()}function Gl(e,t,i,n,r,o,a,s){Bn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=[],h=[],u=[],d=[],p=0,f=[],m=i/2,v=0;function g(i){var r,o,f,g=new Dt,y=new kt,b=0,A=!0===i?e:t,w=!0===i?1:-1;for(o=p,r=1;r<=n;r++)h.push(0,m*w,0),u.push(0,w,0),d.push(.5,.5),p++;for(f=p,r=0;r<=n;r++){var x=r/n*s+a,E=Math.cos(x),_=Math.sin(x);y.x=A*_,y.y=m*w,y.z=A*E,h.push(y.x,y.y,y.z),u.push(0,w,0),g.x=.5*E+.5,g.y=.5*_*w+.5,d.push(g.x,g.y),p++}for(r=0;r<n;r++){var M=o+r,T=f+r;!0===i?c.push(T,T+1,M):c.push(T+1,T,M),b+=3}l.addGroup(v,b,!0===i?1:2),v+=b}(function(){var o,g,y=new kt,b=new kt,A=0,w=(t-e)/i;for(g=0;g<=r;g++){var x=[],E=g/r,_=E*(t-e)+e;for(o=0;o<=n;o++){var M=o/n,T=M*s+a,S=Math.sin(T),C=Math.cos(T);b.x=_*S,b.y=-E*i+m,b.z=_*C,h.push(b.x,b.y,b.z),y.set(S,w,C).normalize(),u.push(y.x,y.y,y.z),d.push(M,1-E),x.push(p++)}f.push(x)}for(o=0;o<n;o++)for(g=0;g<r;g++){var L=f[g][o],R=f[g+1][o],D=f[g+1][o+1],P=f[g][o+1];c.push(L,R,P),c.push(R,D,P),A+=6}l.addGroup(v,A,0),v+=A})(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new Mn(h,3)),this.setAttribute("normal",new Mn(u,3)),this.setAttribute("uv",new Mn(d,2))}function Vl(e,t,i,n,r,o,a){zl.call(this,0,e,t,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function Wl(e,t,i,n,r,o,a){Gl.call(this,0,e,t,i,n,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function ql(e,t,i,n){sr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new Xl(e,t,i,n)),this.mergeVertices()}function Xl(e,t,i,n){Bn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var r,o,a=[],s=[],l=[],c=[],h=new kt,u=new Dt;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,r=3;o<=t;o++,r+=3){var d=i+o/t*n;h.x=e*Math.cos(d),h.y=e*Math.sin(d),s.push(h.x,h.y,h.z),l.push(0,0,1),u.x=(s[r]/e+1)/2,u.y=(s[r+1]/e+1)/2,c.push(u.x,u.y)}for(r=1;r<=t;r++)a.push(r,r+1,0);this.setIndex(a),this.setAttribute("position",new Mn(s,3)),this.setAttribute("normal",new Mn(l,3)),this.setAttribute("uv",new Mn(c,2))}Rl.prototype=Object.create(sr.prototype),Rl.prototype.constructor=Rl,Dl.prototype=Object.create(Sl.prototype),Dl.prototype.constructor=Dl,Pl.prototype=Object.create(sr.prototype),Pl.prototype.constructor=Pl,Ol.prototype=Object.create(Bn.prototype),Ol.prototype.constructor=Ol,Il.prototype=Object.create(sr.prototype),Il.prototype.constructor=Il,kl.prototype=Object.create(Bn.prototype),kl.prototype.constructor=kl,Bl.prototype=Object.create(sr.prototype),Bl.prototype.constructor=Bl,Nl.prototype=Object.create(Bn.prototype),Nl.prototype.constructor=Nl,Fl.prototype=Object.create(sr.prototype),Fl.prototype.constructor=Fl,Fl.prototype.toJSON=function(){var e=sr.prototype.toJSON.call(this);return Ul(this.parameters.shapes,e)},Hl.prototype=Object.create(Bn.prototype),Hl.prototype.constructor=Hl,Hl.prototype.toJSON=function(){var e=Bn.prototype.toJSON.call(this);return Ul(this.parameters.shapes,e)},jl.prototype=Object.create(Bn.prototype),jl.prototype.constructor=jl,zl.prototype=Object.create(sr.prototype),zl.prototype.constructor=zl,Gl.prototype=Object.create(Bn.prototype),Gl.prototype.constructor=Gl,Vl.prototype=Object.create(zl.prototype),Vl.prototype.constructor=Vl,Wl.prototype=Object.create(Gl.prototype),Wl.prototype.constructor=Wl,ql.prototype=Object.create(sr.prototype),ql.prototype.constructor=ql,Xl.prototype=Object.create(Bn.prototype),Xl.prototype.constructor=Xl;var Yl=Object.freeze({__proto__:null,WireframeGeometry:Bs,ParametricGeometry:Ns,ParametricBufferGeometry:Fs,TetrahedronGeometry:js,TetrahedronBufferGeometry:zs,OctahedronGeometry:Gs,OctahedronBufferGeometry:Vs,IcosahedronGeometry:Ws,IcosahedronBufferGeometry:qs,DodecahedronGeometry:Xs,DodecahedronBufferGeometry:Ys,PolyhedronGeometry:Hs,PolyhedronBufferGeometry:Us,TubeGeometry:Ks,TubeBufferGeometry:Qs,TorusKnotGeometry:Zs,TorusKnotBufferGeometry:Js,TorusGeometry:$s,TorusBufferGeometry:el,TextGeometry:Rl,TextBufferGeometry:Dl,SphereGeometry:Pl,SphereBufferGeometry:Ol,RingGeometry:Il,RingBufferGeometry:kl,PlaneGeometry:Rr,PlaneBufferGeometry:Dr,LatheGeometry:Bl,LatheBufferGeometry:Nl,ShapeGeometry:Fl,ShapeBufferGeometry:Hl,ExtrudeGeometry:Tl,ExtrudeBufferGeometry:Sl,EdgesGeometry:jl,ConeGeometry:Vl,ConeBufferGeometry:Wl,CylinderGeometry:zl,CylinderBufferGeometry:Gl,CircleGeometry:ql,CircleBufferGeometry:Xl,BoxGeometry:lr,BoxBufferGeometry:cr});function Kl(e){fn.call(this),this.type="ShadowMaterial",this.color=new ln(0),this.transparent=!0,this.setValues(e)}function Ql(e){mr.call(this,e),this.type="RawShaderMaterial"}function Zl(e){fn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ln(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new Dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Jl(e){Zl.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Dt(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function $l(e){fn.call(this),this.type="MeshPhongMaterial",this.color=new ln(16777215),this.specular=new ln(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new Dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=G,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ec(e){fn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ln(16777215),this.specular=new ln(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new Dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function tc(e){fn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new Dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ic(e){fn.call(this),this.type="MeshLambertMaterial",this.color=new ln(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=G,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function nc(e){fn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ln(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new Dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function rc(e){fs.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Kl.prototype=Object.create(fn.prototype),Kl.prototype.constructor=Kl,Kl.prototype.isShadowMaterial=!0,Kl.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this},Ql.prototype=Object.create(mr.prototype),Ql.prototype.constructor=Ql,Ql.prototype.isRawShaderMaterial=!0,Zl.prototype=Object.create(fn.prototype),Zl.prototype.constructor=Zl,Zl.prototype.isMeshStandardMaterial=!0,Zl.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Jl.prototype=Object.create(Zl.prototype),Jl.prototype.constructor=Jl,Jl.prototype.isMeshPhysicalMaterial=!0,Jl.prototype.copy=function(e){return Zl.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new ln).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},$l.prototype=Object.create(fn.prototype),$l.prototype.constructor=$l,$l.prototype.isMeshPhongMaterial=!0,$l.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ec.prototype=Object.create(fn.prototype),ec.prototype.constructor=ec,ec.prototype.isMeshToonMaterial=!0,ec.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},tc.prototype=Object.create(fn.prototype),tc.prototype.constructor=tc,tc.prototype.isMeshNormalMaterial=!0,tc.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ic.prototype=Object.create(fn.prototype),ic.prototype.constructor=ic,ic.prototype.isMeshLambertMaterial=!0,ic.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},nc.prototype=Object.create(fn.prototype),nc.prototype.constructor=nc,nc.prototype.isMeshMatcapMaterial=!0,nc.prototype.copy=function(e){return fn.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},rc.prototype=Object.create(fs.prototype),rc.prototype.constructor=rc,rc.prototype.isLineDashedMaterial=!0,rc.prototype.copy=function(e){return fs.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var oc=Object.freeze({__proto__:null,ShadowMaterial:Kl,SpriteMaterial:Ha,RawShaderMaterial:Ql,ShaderMaterial:mr,PointsMaterial:Ms,MeshPhysicalMaterial:Jl,MeshStandardMaterial:Zl,MeshPhongMaterial:$l,MeshToonMaterial:ec,MeshNormalMaterial:tc,MeshLambertMaterial:ic,MeshDepthMaterial:va,MeshDistanceMaterial:ga,MeshBasicMaterial:mn,MeshMatcapMaterial:nc,LineDashedMaterial:rc,LineBasicMaterial:fs,Material:fn}),ac={arraySlice:function(e,t,i){return ac.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),n=0;n!==t;++n)i[n]=n;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){for(var n=e.length,r=new e.constructor(n),o=0,a=0;a!==n;++o)for(var s=i[o]*t,l=0;l!==t;++l)r[a++]=e[s+l];return r},flattenJSON:function(e,t,i,n){for(var r=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[r++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(t.push(o.time),i.push.apply(i,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(t.push(o.time),a.toArray(i,i.length)),o=e[r++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(t.push(o.time),i.push(a)),o=e[r++]}while(void 0!==o)}},subclip:function(e,t,i,n,r){r=r||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],c=l.getValueSize(),h=[],u=[],d=0;d<l.times.length;++d){var p=l.times[d]*r;if(!(p<i||p>=n)){h.push(l.times[d]);for(var f=0;f<c;++f)u.push(l.values[d*c+f])}}0!==h.length&&(l.times=ac.convertArray(h,l.times.constructor),l.values=ac.convertArray(u,l.values.constructor),a.push(l))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function sc(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function lc(e,t,i,n){sc.call(this,e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function cc(e,t,i,n){sc.call(this,e,t,i,n)}function hc(e,t,i,n){sc.call(this,e,t,i,n)}function uc(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ac.convertArray(t,this.TimeBufferType),this.values=ac.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function dc(e,t,i){uc.call(this,e,t,i)}function pc(e,t,i,n){uc.call(this,e,t,i,n)}function fc(e,t,i,n){uc.call(this,e,t,i,n)}function mc(e,t,i,n){sc.call(this,e,t,i,n)}function vc(e,t,i,n){uc.call(this,e,t,i,n)}function gc(e,t,i,n){uc.call(this,e,t,i,n)}function yc(e,t,i,n){uc.call(this,e,t,i,n)}function bc(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=Rt.generateUUID(),this.duration<0&&this.resetDuration()}function Ac(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return fc;case"vector":case"vector2":case"vector3":case"vector4":return yc;case"color":return pc;case"quaternion":return vc;case"bool":case"boolean":return dc;case"string":return gc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var i=[],n=[];ac.flattenJSON(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(sc.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{var o;i:{n:if(!(e<n)){for(var a=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===a)break;if(r=n,e<(n=t[++i]))break t}o=t.length;break i}if(e>=r)break e;var s=t[1];for(e<s&&(i=2,r=s),a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===a)break;if(n=r,e>=(r=t[--i-1]))break t}o=i,i=0}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(n=t[i],void 0===(r=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n,o=0;o!==n;++o)t[o]=i[r+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(sc.prototype,{beforeStart_:sc.prototype.copySampleValue_,afterEnd_:sc.prototype.copySampleValue_}),lc.prototype=Object.assign(Object.create(sc.prototype),{constructor:lc,DefaultSettings_:{endingStart:lt,endingEnd:lt},intervalChanged_:function(e,t,i){var n=this.parameterPositions,r=e-2,o=e+1,a=n[r],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case ct:r=e,a=2*t-i;break;case ht:a=t+n[r=n.length-2]-n[r+1];break;default:r=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case ct:o=e,s=2*i-t;break;case ht:o=1,s=i+n[1]-n[0];break;default:o=e-1,s=t}var l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=r*c,this._offsetNext=o*c},interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,v=-u*m+2*u*f-u*p,g=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,A=0;A!==a;++A)r[A]=v*o[c+A]+g*o[l+A]+y*o[s+A]+b*o[h+A];return r}}),cc.prototype=Object.assign(Object.create(sc.prototype),{constructor:cc,interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(i-t)/(n-t),h=1-c,u=0;u!==a;++u)r[u]=o[l+u]*h+o[s+u]*c;return r}}),hc.prototype=Object.assign(Object.create(sc.prototype),{constructor:hc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(uc,{toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:ac.convertArray(e.times,Array),values:ac.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(uc.prototype,{constructor:uc,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:at,InterpolantFactoryMethodDiscrete:function(e){return new hc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new cc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new lc(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case ot:t=this.InterpolantFactoryMethodDiscrete;break;case at:t=this.InterpolantFactoryMethodLinear;break;case st:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ot;case this.InterpolantFactoryMethodLinear:return at;case this.InterpolantFactoryMethodSmooth:return st}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<e;)++r;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==r||o!==n){r>=o&&(r=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=ac.arraySlice(i,r,o),this.values=ac.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==r;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==n&&ac.isTypedArray(n)){a=0;for(var l=n.length;a!==l;++a){var c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),n=this.getInterpolation()===st,r=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else for(var c=a*i,h=c-i,u=c+i,d=0;d!==i;++d){var p=t[c+d];if(p!==t[h+d]||p!==t[u+d]){s=!0;break}}if(s){if(a!==r){e[r]=e[a];var f=a*i,m=r*i;for(d=0;d!==i;++d)t[m+d]=t[f+d]}++r}}if(o>0){for(e[r]=e[o],f=o*i,m=r*i,d=0;d!==i;++d)t[m+d]=t[f+d];++r}return r!==e.length&&(this.times=ac.arraySlice(e,0,r),this.values=ac.arraySlice(t,0,r*i)),this},clone:function(){var e=ac.arraySlice(this.times,0),t=ac.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),dc.prototype=Object.assign(Object.create(uc.prototype),{constructor:dc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ot,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),pc.prototype=Object.assign(Object.create(uc.prototype),{constructor:pc,ValueTypeName:"color"}),fc.prototype=Object.assign(Object.create(uc.prototype),{constructor:fc,ValueTypeName:"number"}),mc.prototype=Object.assign(Object.create(sc.prototype),{constructor:mc,interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(i-t)/(n-t),c=s+a;s!==c;s+=4)Pt.slerpFlat(r,0,o,s-a,o,s,l);return r}}),vc.prototype=Object.assign(Object.create(uc.prototype),{constructor:vc,ValueTypeName:"quaternion",DefaultInterpolation:at,InterpolantFactoryMethodLinear:function(e){return new mc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),gc.prototype=Object.assign(Object.create(uc.prototype),{constructor:gc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ot,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),yc.prototype=Object.assign(Object.create(uc.prototype),{constructor:yc,ValueTypeName:"vector"}),Object.assign(bc,{parse:function(e){for(var t=[],i=e.tracks,n=1/(e.fps||1),r=0,o=i.length;r!==o;++r)t.push(Ac(i[r]).scale(n));return new bc(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},r=0,o=i.length;r!==o;++r)t.push(uc.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(e,t,i,n){for(var r=t.length,o=[],a=0;a<r;a++){var s=[],l=[];s.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var c=ac.getKeyframeOrder(s);s=ac.sortedArray(s,1,c),l=ac.sortedArray(l,1,c),n||0!==s[0]||(s.push(r),l.push(l[0])),o.push(new fc(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/i))}return new bc(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var n=e;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(r);if(l&&l.length>1){var c=n[u=l[1]];c||(n[u]=c=[]),c.push(s)}}var h=[];for(var u in n)h.push(bc.CreateFromMorphTargetSequence(u,n[u],t,i));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,n,r){if(0!==i.length){var o=[],a=[];ac.flattenJSON(i,o,a,n),0!==o.length&&r.push(new e(t,o,a))}},n=[],r=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var h={},u=0;u<c.length;u++)if(c[u].morphTargets)for(var d=0;d<c[u].morphTargets.length;d++)h[c[u].morphTargets[d]]=-1;for(var p in h){var f=[],m=[];for(d=0;d!==c[u].morphTargets.length;++d){var v=c[u];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new fc(".morphTargetInfluence["+p+"]",f,m))}o=h.length*(a||1)}else{var g=".bones["+t[l].name+"]";i(yc,g+".position",c,"pos",n),i(vc,g+".quaternion",c,"rot",n),i(yc,g+".scale",c,"scl",n)}}return 0===n.length?null:new bc(r,o,n)}}),Object.assign(bc.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new bc(this.name,this.duration,e)}});var wc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function xc(e,t,i){var n=this,r=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===r&&void 0!==n.onStart&&n.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,i=l.length;t<i;t+=2){var n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}var Ec=new xc;function _c(e){this.manager=void 0!==e?e:Ec,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(_c.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var Mc={};function Tc(e){_c.call(this,e)}function Sc(e){_c.call(this,e)}function Cc(e){_c.call(this,e)}function Lc(e){_c.call(this,e)}function Rc(e){_c.call(this,e)}function Dc(e){_c.call(this,e)}function Pc(e){_c.call(this,e)}function Oc(){this.type="Curve",this.arcLengthDivisions=200}function Ic(e,t,i,n,r,o,a,s){Oc.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function kc(e,t,i,n,r,o){Ic.call(this,e,t,i,i,n,r,o),this.type="ArcCurve"}function Bc(){var e=0,t=0,i=0,n=0;function r(r,o,a,s){e=r,t=a,i=-3*r+3*o-2*a-s,n=2*r-2*o+a+s}return{initCatmullRom:function(e,t,i,n,o){r(t,i,o*(i-e),o*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,o,a,s){var l=(t-e)/o-(i-e)/(o+a)+(i-t)/a,c=(i-t)/a-(n-t)/(a+s)+(n-i)/s;r(t,i,l*=a,c*=a)},calc:function(r){var o=r*r;return e+t*r+i*o+n*(o*r)}}}Tc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Tc,load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=wc.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;if(void 0===Mc[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var h,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);h="blob"===u?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;h=f.parseFromString(c,s);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout((function(){t&&t(h),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{Mc[e]=[],Mc[e].push({onLoad:t,onProgress:i,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.timeout=0,m.addEventListener("load",(function(t){var i=this.response,n=Mc[e];if(delete Mc[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),wc.add(e,i);for(var o=0,a=n.length;o<a;o++)(s=n[o]).onLoad&&s.onLoad(i);r.manager.itemEnd(e)}else{for(o=0,a=n.length;o<a;o++){var s;(s=n[o]).onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var i=Mc[e],n=0,r=i.length;n<r;n++){var o=i[n];o.onProgress&&o.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var i=Mc[e];delete Mc[e];for(var n=0,o=i.length;n<o;n++){var a=i[n];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var i=Mc[e];delete Mc[e];for(var n=0,o=i.length;n<o;n++){var a=i[n];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return r.manager.itemStart(e),m}Mc[e].push({onLoad:t,onProgress:i,onError:n})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Sc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Sc,load:function(e,t,i,n){var r=this,o=new Tc(r.manager);o.setPath(r.path),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var n=bc.parse(e[i]);t.push(n)}return t}}),Cc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Cc,load:function(e,t,i,n){var r=this,o=[],a=new Os;a.image=o;var s=new Tc(this.manager);function l(l){s.load(e[l],(function(e){var i=r.parse(e,!0);o[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(c+=1)&&(1===i.mipmapCount&&(a.minFilter=de),a.format=i.format,a.needsUpdate=!0,t&&t(a))}),i,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,h=0,u=e.length;h<u;++h)l(h);else s.load(e,(function(e){var i=r.parse(e,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,s=0;s<n;s++){o[s]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)o[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+l]),o[s].format=i.format,o[s].width=i.width,o[s].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=de),a.format=i.format,a.needsUpdate=!0,t&&t(a)}),i,n);return a}}),Lc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Lc,load:function(e,t,i,n){var r=this,o=new wr,a=new Tc(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,(function(e){var i=r.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:se,o.wrapT=void 0!==i.wrapT?i.wrapT:se,o.magFilter=void 0!==i.magFilter?i.magFilter:de,o.minFilter=void 0!==i.minFilter?i.minFilter:de,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=fe),1===i.mipmapCount&&(o.minFilter=de),o.needsUpdate=!0,t&&t(o,i))}),i,n),o}}),Rc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Rc,load:function(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=wc.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),wc.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}),Dc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Dc,load:function(e,t,i,n){var r=new Gr,o=new Rc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(i){o.load(e[i],(function(e){r.images[i]=e,6==++a&&(r.needsUpdate=!0,t&&t(r))}),void 0,n)}for(var l=0;l<e.length;++l)s(l);return r}}),Pc.prototype=Object.assign(Object.create(_c.prototype),{constructor:Pc,load:function(e,t,i,n){var r=new jt,o=new Rc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){r.image=i;var n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=n?Ce:Le,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}}),Object.assign(Oc.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t||e*n[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=n[r=Math.floor(s+(l-s)/2)]-i)<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(n[r=l]===i)return r/(o-1);var c=n[r];return(r+(i-c)/(n[r+1]-c))/(o-1)},getTangent:function(e){var t=1e-4,i=e-t,n=e+t;i<0&&(i=0),n>1&&(n=1);var r=this.getPoint(i);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,n,r,o=new kt,a=[],s=[],l=[],c=new kt,h=new Jt;for(i=0;i<=e;i++)n=i/e,a[i]=this.getTangentAt(n),a[i].normalize();s[0]=new kt,l[0]=new kt;var u=Number.MAX_VALUE,d=Math.abs(a[0].x),p=Math.abs(a[0].y),f=Math.abs(a[0].z);for(d<=u&&(u=d,o.set(1,0,0)),p<=u&&(u=p,o.set(0,1,0)),f<=u&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),i=1;i<=e;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),c.crossVectors(a[i-1],a[i]),c.length()>Number.EPSILON&&(c.normalize(),r=Math.acos(Rt.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(h.makeRotationAxis(c,r))),l[i].crossVectors(a[i],s[i]);if(!0===t)for(r=Math.acos(Rt.clamp(s[0].dot(s[e]),-1,1)),r/=e,a[0].dot(c.crossVectors(s[0],s[e]))>0&&(r=-r),i=1;i<=e;i++)s[i].applyMatrix4(h.makeRotationAxis(a[i],r*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Ic.prototype=Object.create(Oc.prototype),Ic.prototype.constructor=Ic,Ic.prototype.isEllipseCurve=!0,Ic.prototype.getPoint=function(e,t){for(var i=t||new Dt,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=o?0:n),!0!==this.aClockwise||o||(r===n?r=-n:r-=n);var a=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=s-this.aX,d=l-this.aY;s=u*c-d*h+this.aX,l=u*h+d*c+this.aY}return i.set(s,l)},Ic.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ic.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Ic.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},kc.prototype=Object.create(Ic.prototype),kc.prototype.constructor=kc,kc.prototype.isArcCurve=!0;var Nc=new kt,Fc=new Bc,Hc=new Bc,Uc=new Bc;function jc(e,t,i,n){Oc.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=n||.5}function zc(e,t,i,n,r){var o=.5*(n-t),a=.5*(r-i),s=e*e;return(2*i-2*n+o+a)*(e*s)+(-3*i+3*n-2*o-a)*s+o*e+i}function Gc(e,t,i,n){return function(e,t){var i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function Vc(e,t,i,n,r){return function(e,t){var i=1-e;return i*i*i*t}(e,t)+function(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}function Wc(e,t,i,n){Oc.call(this),this.type="CubicBezierCurve",this.v0=e||new Dt,this.v1=t||new Dt,this.v2=i||new Dt,this.v3=n||new Dt}function qc(e,t,i,n){Oc.call(this),this.type="CubicBezierCurve3",this.v0=e||new kt,this.v1=t||new kt,this.v2=i||new kt,this.v3=n||new kt}function Xc(e,t){Oc.call(this),this.type="LineCurve",this.v1=e||new Dt,this.v2=t||new Dt}function Yc(e,t){Oc.call(this),this.type="LineCurve3",this.v1=e||new kt,this.v2=t||new kt}function Kc(e,t,i){Oc.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Dt,this.v1=t||new Dt,this.v2=i||new Dt}function Qc(e,t,i){Oc.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new kt,this.v1=t||new kt,this.v2=i||new kt}function Zc(e){Oc.call(this),this.type="SplineCurve",this.points=e||[]}jc.prototype=Object.create(Oc.prototype),jc.prototype.constructor=jc,jc.prototype.isCatmullRomCurve3=!0,jc.prototype.getPoint=function(e,t){var i,n,r,o,a=t||new kt,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,h=Math.floor(c),u=c-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/l)+1)*l:0===u&&h===l-1&&(h=l-2,u=1),this.closed||h>0?i=s[(h-1)%l]:(Nc.subVectors(s[0],s[1]).add(s[0]),i=Nc),n=s[h%l],r=s[(h+1)%l],this.closed||h+2<l?o=s[(h+2)%l]:(Nc.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=Nc),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(i.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(r),d),m=Math.pow(r.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Fc.initNonuniformCatmullRom(i.x,n.x,r.x,o.x,p,f,m),Hc.initNonuniformCatmullRom(i.y,n.y,r.y,o.y,p,f,m),Uc.initNonuniformCatmullRom(i.z,n.z,r.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(Fc.initCatmullRom(i.x,n.x,r.x,o.x,this.tension),Hc.initCatmullRom(i.y,n.y,r.y,o.y,this.tension),Uc.initCatmullRom(i.z,n.z,r.z,o.z,this.tension));return a.set(Fc.calc(u),Hc.calc(u),Uc.calc(u)),a},jc.prototype.copy=function(e){Oc.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},jc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},jc.prototype.fromJSON=function(e){Oc.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push((new kt).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Wc.prototype=Object.create(Oc.prototype),Wc.prototype.constructor=Wc,Wc.prototype.isCubicBezierCurve=!0,Wc.prototype.getPoint=function(e,t){var i=t||new Dt,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(Vc(e,n.x,r.x,o.x,a.x),Vc(e,n.y,r.y,o.y,a.y)),i},Wc.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Wc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Wc.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},qc.prototype=Object.create(Oc.prototype),qc.prototype.constructor=qc,qc.prototype.isCubicBezierCurve3=!0,qc.prototype.getPoint=function(e,t){var i=t||new kt,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(Vc(e,n.x,r.x,o.x,a.x),Vc(e,n.y,r.y,o.y,a.y),Vc(e,n.z,r.z,o.z,a.z)),i},qc.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},qc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},qc.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Xc.prototype=Object.create(Oc.prototype),Xc.prototype.constructor=Xc,Xc.prototype.isLineCurve=!0,Xc.prototype.getPoint=function(e,t){var i=t||new Dt;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Xc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Xc.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Xc.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Xc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Xc.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Yc.prototype=Object.create(Oc.prototype),Yc.prototype.constructor=Yc,Yc.prototype.isLineCurve3=!0,Yc.prototype.getPoint=function(e,t){var i=t||new kt;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Yc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Yc.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Yc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Yc.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Kc.prototype=Object.create(Oc.prototype),Kc.prototype.constructor=Kc,Kc.prototype.isQuadraticBezierCurve=!0,Kc.prototype.getPoint=function(e,t){var i=t||new Dt,n=this.v0,r=this.v1,o=this.v2;return i.set(Gc(e,n.x,r.x,o.x),Gc(e,n.y,r.y,o.y)),i},Kc.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Kc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Kc.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Qc.prototype=Object.create(Oc.prototype),Qc.prototype.constructor=Qc,Qc.prototype.isQuadraticBezierCurve3=!0,Qc.prototype.getPoint=function(e,t){var i=t||new kt,n=this.v0,r=this.v1,o=this.v2;return i.set(Gc(e,n.x,r.x,o.x),Gc(e,n.y,r.y,o.y),Gc(e,n.z,r.z,o.z)),i},Qc.prototype.copy=function(e){return Oc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Qc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Qc.prototype.fromJSON=function(e){return Oc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Zc.prototype=Object.create(Oc.prototype),Zc.prototype.constructor=Zc,Zc.prototype.isSplineCurve=!0,Zc.prototype.getPoint=function(e,t){var i=t||new Dt,n=this.points,r=(n.length-1)*e,o=Math.floor(r),a=r-o,s=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],h=n[o>n.length-3?n.length-1:o+2];return i.set(zc(a,s.x,l.x,c.x,h.x),zc(a,s.y,l.y,c.y,h.y)),i},Zc.prototype.copy=function(e){Oc.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push(n.clone())}return this},Zc.prototype.toJSON=function(){var e=Oc.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var n=this.points[t];e.points.push(n.toArray())}return e},Zc.prototype.fromJSON=function(e){Oc.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push((new Dt).fromArray(n))}return this};var Jc=Object.freeze({__proto__:null,ArcCurve:kc,CatmullRomCurve3:jc,CubicBezierCurve:Wc,CubicBezierCurve3:qc,EllipseCurve:Ic,LineCurve:Xc,LineCurve3:Yc,QuadraticBezierCurve:Kc,QuadraticBezierCurve3:Qc,SplineCurve:Zc});function $c(){Oc.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function eh(e){$c.call(this),this.type="Path",this.currentPoint=new Dt,e&&this.setFromPoints(e)}function th(e){eh.call(this,e),this.uuid=Rt.generateUUID(),this.type="Shape",this.holes=[]}function ih(e,t){vi.call(this),this.type="Light",this.color=new ln(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function nh(e,t,i){ih.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(vi.DefaultUp),this.updateMatrix(),this.groundColor=new ln(t)}function rh(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Dt(512,512),this.map=null,this.mapPass=null,this.matrix=new Jt,this._frustum=new _r,this._frameExtents=new Dt(1,1),this._viewportCount=1,this._viewports=[new zt(0,0,1,1)]}function oh(){rh.call(this,new gr(50,1,.5,500))}function ah(e,t,i,n,r,o){ih.call(this,e,t),this.type="SpotLight",this.position.copy(vi.DefaultUp),this.updateMatrix(),this.target=new vi,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new oh}function sh(){rh.call(this,new gr(90,1,.5,500)),this._frameExtents=new Dt(4,2),this._viewportCount=6,this._viewports=[new zt(2,1,1,1),new zt(0,1,1,1),new zt(3,1,1,1),new zt(1,1,1,1),new zt(3,0,1,1),new zt(1,0,1,1)],this._cubeDirections=[new kt(1,0,0),new kt(-1,0,0),new kt(0,0,1),new kt(0,0,-1),new kt(0,1,0),new kt(0,-1,0)],this._cubeUps=[new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,0,1),new kt(0,0,-1)]}function lh(e,t,i,n){ih.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new sh}function ch(e,t,i,n,r,o){vr.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function hh(){rh.call(this,new ch(-5,5,5,-5,.5,500))}function uh(e,t){ih.call(this,e,t),this.type="DirectionalLight",this.position.copy(vi.DefaultUp),this.updateMatrix(),this.target=new vi,this.shadow=new hh}function dh(e,t){ih.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function ph(e,t,i,n){ih.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function fh(e){_c.call(this,e),this.textures={}}$c.prototype=Object.assign(Object.create(Oc.prototype),{constructor:$c,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Xc(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=t){var r=i[n]-t,o=this.curves[n],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],n=0,r=this.curves;n<r.length;n++)for(var o=r[n],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(i.push(c),t=c)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Oc.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Oc.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Oc.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var n=e.curves[t];this.curves.push((new Jc[n.type]).fromJSON(n))}return this}}),eh.prototype=Object.assign(Object.create($c.prototype),{constructor:eh,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var i=new Xc(this.currentPoint.clone(),new Dt(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,n){var r=new Kc(this.currentPoint.clone(),new Dt(e,t),new Dt(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this},bezierCurveTo:function(e,t,i,n,r,o){var a=new Wc(this.currentPoint.clone(),new Dt(e,t),new Dt(i,n),new Dt(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this},splineThru:function(e){var t=new Zc([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,n,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,i,n,r,o),this},absarc:function(e,t,i,n,r,o){return this.absellipse(e,t,i,i,n,r,o),this},ellipse:function(e,t,i,n,r,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,o,a,s),this},absellipse:function(e,t,i,n,r,o,a,s){var l=new Ic(e,t,i,n,r,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var h=l.getPoint(1);return this.currentPoint.copy(h),this},copy:function(e){return $c.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=$c.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return $c.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),th.prototype=Object.assign(Object.create(eh.prototype),{constructor:th,getPointsHoles:function(e){for(var t=[],i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){eh.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=eh.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){eh.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var n=e.holes[t];this.holes.push((new eh).fromJSON(n))}return this}}),ih.prototype=Object.assign(Object.create(vi.prototype),{constructor:ih,isLight:!0,copy:function(e){return vi.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=vi.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),nh.prototype=Object.assign(Object.create(ih.prototype),{constructor:nh,isHemisphereLight:!0,copy:function(e){return ih.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(rh.prototype,{_projScreenMatrix:new Jt,_lightPositionWorld:new kt,_lookTarget:new kt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,n=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),r.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(n),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),oh.prototype=Object.assign(Object.create(rh.prototype),{constructor:oh,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,i=2*Rt.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),rh.prototype.updateMatrices.call(this,e)}}),ah.prototype=Object.assign(Object.create(ih.prototype),{constructor:ah,isSpotLight:!0,copy:function(e){return ih.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),sh.prototype=Object.assign(Object.create(rh.prototype),{constructor:sh,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var i=this.camera,n=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;r.setFromMatrixPosition(e.matrixWorld),i.position.copy(r),o.copy(i.position),o.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(o),i.updateMatrixWorld(),n.makeTranslation(-r.x,-r.y,-r.z),a.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromMatrix(a)}}),lh.prototype=Object.assign(Object.create(ih.prototype),{constructor:lh,isPointLight:!0,copy:function(e){return ih.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),ch.prototype=Object.assign(Object.create(vr.prototype),{constructor:ch,isOrthographicCamera:!0,copy:function(e,t){return vr.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,n,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,o=i+e,a=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;o=(r+=h*(this.view.offsetX/l))+h*(this.view.width/l),s=(a-=u*(this.view.offsetY/c))-u*(this.view.height/c)}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=vi.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),hh.prototype=Object.assign(Object.create(rh.prototype),{constructor:hh,isDirectionalLightShadow:!0,updateMatrices:function(e){rh.prototype.updateMatrices.call(this,e)}}),uh.prototype=Object.assign(Object.create(ih.prototype),{constructor:uh,isDirectionalLight:!0,copy:function(e){return ih.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),dh.prototype=Object.assign(Object.create(ih.prototype),{constructor:dh,isAmbientLight:!0}),ph.prototype=Object.assign(Object.create(ih.prototype),{constructor:ph,isRectAreaLight:!0,copy:function(e){return ih.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ih.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),fh.prototype=Object.assign(Object.create(_c.prototype),{constructor:fh,load:function(e,t,i,n){var r=this,o=new Tc(r.manager);o.setPath(r.path),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new oc[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new ln).setHex(e.sheen)),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var r in e.uniforms){var o=e.uniforms[r];switch(n.uniforms[r]={},o.type){case"t":n.uniforms[r].value=i(o.value);break;case"c":n.uniforms[r].value=(new ln).setHex(o.value);break;case"v2":n.uniforms[r].value=(new Dt).fromArray(o.value);break;case"v3":n.uniforms[r].value=(new kt).fromArray(o.value);break;case"v4":n.uniforms[r].value=(new zt).fromArray(o.value);break;case"m3":n.uniforms[r].value=(new Ft).fromArray(o.value);case"m4":n.uniforms[r].value=(new Jt).fromArray(o.value);break;default:n.uniforms[r].value=o.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)n.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new Dt).fromArray(s)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Dt).fromArray(e.clearcoatNormalScale)),n},setTextures:function(e){return this.textures=e,this}});var mh={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function vh(){Bn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function gh(e,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),gn.call(this,e,t,i),this.meshPerAttribute=n||1}function yh(e){_c.call(this,e)}vh.prototype=Object.assign(Object.create(Bn.prototype),{constructor:vh,isInstancedBufferGeometry:!0,copy:function(e){return Bn.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Bn.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),gh.prototype=Object.assign(Object.create(gn.prototype),{constructor:gh,isInstancedBufferAttribute:!0,copy:function(e){return gn.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=gn.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),yh.prototype=Object.assign(Object.create(_c.prototype),{constructor:yh,load:function(e,t,i,n){var r=this,o=new Tc(r.manager);o.setPath(r.path),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new vh:new Bn,i=e.data.index;if(void 0!==i){var n=new bh[i.type](i.array);t.setIndex(new gn(n,1))}var r=e.data.attributes;for(var o in r){var a=r[o],s=(n=new bh[a.type](a.array),new(a.isInstancedBufferAttribute?gh:gn)(n,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.setAttribute(o,s)}var l=e.data.morphAttributes;if(l)for(var o in l){for(var c=l[o],h=[],u=0,d=c.length;u<d;u++)a=c[u],s=new gn(n=new bh[a.type](a.array),a.itemSize,a.normalized),void 0!==a.name&&(s.name=a.name),h.push(s);t.morphAttributes[o]=h}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var p=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==p){u=0;for(var f=p.length;u!==f;++u){var m=p[u];t.addGroup(m.start,m.count,m.materialIndex)}}var v=e.data.boundingSphere;if(void 0!==v){var g=new kt;void 0!==v.center&&g.fromArray(v.center),t.boundingSphere=new Ii(g,v.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var bh={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ah(e){_c.call(this,e)}Ah.prototype=Object.assign(Object.create(_c.prototype),{constructor:Ah,load:function(e,t,i,n){var r=this,o=""===this.path?mh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new Tc(r.manager);a.setPath(this.path),a.load(e,(function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)},parse:function(e,t){var i=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,i),r=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,n,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var r=(new th).fromJSON(e[i]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var n=new yh,r=0,o=e.length;r<o;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Yl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Yl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Yl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Yl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Yl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Yl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Yl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Yl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Yl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Yl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Yl[s.type]((new Jc[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Yl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Yl[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,h=s.shapes.length;c<h;c++){var u=t[s.shapes[c]];l.push(u)}a=new Yl[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],c=0,h=s.shapes.length;c<h;c++)u=t[s.shapes[c]],l.push(u);var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new Jc[d.type]).fromJSON(d)),a=new Yl[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i},parseMaterials:function(e,t){var i={},n={};if(void 0!==e){var r=new fh;r.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var h=s.materials[c];void 0===i[h.uuid]&&(i[h.uuid]=r.parse(h)),l.push(i[h.uuid])}n[s.uuid]=l}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],r=bc.parse(n);void 0!==n.uuid&&(r.uuid=n.uuid),t.push(r)}return t},parseImages:function(e,t){var i=this,n={};function r(e){return i.manager.itemStart(e),o.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var o=new Rc(new xc(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],c=l.url;if(Array.isArray(c)){n[l.uuid]=[];for(var h=0,u=c.length;h<u;h++){var d=c[h],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:i.resourcePath+d;n[l.uuid].push(r(p))}}else p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.resourcePath+l.url,n[l.uuid]=r(p)}}return n},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var a,s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Gr(t[s.image]):new jt(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,xh)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],Eh),a.wrapT=i(s.wrap[1],Eh)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,_h)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,_h)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),n[s.uuid]=a}return n},parseObject:function(e,t,i){var n;function r(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];void 0===i[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":n=new gi,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new ln(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Ba(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new ka(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new gr(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new ch(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new dh(e.color,e.intensity);break;case"DirectionalLight":n=new uh(e.color,e.intensity);break;case"PointLight":n=new lh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new ph(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new ah(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new nh(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=r(e.geometry),s=o(e.material);n=a.bones&&a.bones.length>0?new ns(a,s):new er(a,s);break;case"InstancedMesh":a=r(e.geometry),s=o(e.material);var l=e.count,c=e.instanceMatrix;(n=new ps(a,s,l)).instanceMatrix=new gn(new Float32Array(c.array),16);break;case"LOD":n=new is;break;case"Line":n=new As(r(e.geometry),o(e.material),e.mode);break;case"LineLoop":n=new _s(r(e.geometry),o(e.material));break;case"LineSegments":n=new Es(r(e.geometry),o(e.material));break;case"PointCloud":case"Points":n=new Rs(r(e.geometry),o(e.material));break;case"Sprite":n=new Ja(o(e.material));break;case"Group":n=new Ta;break;default:n=new vi}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children)for(var h=e.children,u=0;u<h.length;u++)n.add(this.parseObject(h[u],t,i));if("LOD"===e.type){void 0!==e.autoUpdate&&(n.autoUpdate=e.autoUpdate);for(var d=e.levels,p=0;p<d.length;p++){var f=d[p],m=n.getObjectByProperty("uuid",f.object);void 0!==m&&n.addLevel(m,f.distance)}}return n}});var wh,xh={UVMapping:J,CubeReflectionMapping:$,CubeRefractionMapping:ee,EquirectangularReflectionMapping:te,EquirectangularRefractionMapping:ie,SphericalReflectionMapping:ne,CubeUVReflectionMapping:re,CubeUVRefractionMapping:oe},Eh={RepeatWrapping:ae,ClampToEdgeWrapping:se,MirroredRepeatWrapping:le},_h={NearestFilter:ce,NearestMipmapNearestFilter:he,NearestMipmapLinearFilter:ue,LinearFilter:de,LinearMipmapNearestFilter:pe,LinearMipmapLinearFilter:fe};function Mh(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),_c.call(this,e),this.options=void 0}function Th(){this.type="ShapePath",this.color=new ln,this.subPaths=[],this.currentPath=null}function Sh(e){this.type="Font",this.data=e}function Ch(e,t,i,n,r){var o=r.glyphs[e]||r.glyphs["?"];if(o){var a,s,l,c,h,u,d,p,f=new Th;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;)switch(m[v++]){case"m":a=m[v++]*t+i,s=m[v++]*t+n,f.moveTo(a,s);break;case"l":a=m[v++]*t+i,s=m[v++]*t+n,f.lineTo(a,s);break;case"q":l=m[v++]*t+i,c=m[v++]*t+n,h=m[v++]*t+i,u=m[v++]*t+n,f.quadraticCurveTo(h,u,l,c);break;case"b":l=m[v++]*t+i,c=m[v++]*t+n,h=m[v++]*t+i,u=m[v++]*t+n,d=m[v++]*t+i,p=m[v++]*t+n,f.bezierCurveTo(h,u,d,p,l,c)}return{offsetX:o.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".")}function Lh(e){_c.call(this,e)}Mh.prototype=Object.assign(Object.create(_c.prototype),{constructor:Mh,setOptions:function(e){return this.options=e,this},load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=wc.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===r.options?createImageBitmap(e):createImageBitmap(e,r.options)})).then((function(i){wc.add(e,i),t&&t(i),r.manager.itemEnd(e)})).catch((function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}),Object.assign(Th.prototype,{moveTo:function(e,t){return this.currentPath=new eh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this},bezierCurveTo:function(e,t,i,n,r,o){return this.currentPath.bezierCurveTo(e,t,i,n,r,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=new th;o.curves=r.curves,t.push(o)}return t}function n(e,t){for(var i=t.length,n=!1,r=i-1,o=0;o<i;r=o++){var a=t[r],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[r],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var h=c*(e.x-a.x)-l*(e.y-a.y);if(0===h)return!0;if(h<0)continue;n=!n}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return n}var r=El.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new th).curves=s.curves,c.push(l),c;var h=!r(o[0].getPoints());h=e?!h:h;var u,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=r(u=(s=o[g]).getPoints()),(a=e?!a:a)?(!h&&f[v]&&v++,f[v]={s:new th,p:u},f[v].s.curves=s.curves,h&&v++,m[v]=[]):m[v].push({h:s,p:u[0]});if(!f[0])return i(o);if(f.length>1){for(var b=!1,A=[],w=0,x=f.length;w<x;w++)p[w]=[];for(w=0,x=f.length;w<x;w++)for(var E=m[w],_=0;_<E.length;_++){for(var M=E[_],T=!0,S=0;S<f.length;S++)n(M.p,f[S].p)&&(w!==S&&A.push({froms:w,tos:S,hole:_}),T?(T=!1,p[S].push(M)):b=!0);T&&p[w].push(M)}A.length>0&&(b||(m=p))}g=0;for(var C=f.length;g<C;g++){l=f[g].s,c.push(l);for(var L=0,R=(d=m[g]).length;L<R;L++)l.holes.push(d[L].h)}return c}}),Object.assign(Sh.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var i=[],n=function(e,t,i){for(var n=Array.from?Array.from(e):String(e).split(""),r=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[],s=0,l=0,c=0;c<n.length;c++){var h=n[c];if("\n"===h)s=0,l-=o;else{var u=Ch(h,r,s,l,i);s+=u.offsetX,a.push(u.path)}}return a}(e,t,this.data),r=0,o=n.length;r<o;r++)Array.prototype.push.apply(i,n[r].toShapes());return i}}),Lh.prototype=Object.assign(Object.create(_c.prototype),{constructor:Lh,load:function(e,t,i,n){var r=this,o=new Tc(this.manager);o.setPath(this.path),o.load(e,(function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var n=r.parse(i);t&&t(n)}),i,n)},parse:function(e){return new Sh(e)}});var Rh={getContext:function(){return void 0===wh&&(wh=new(window.AudioContext||window.webkitAudioContext)),wh},setContext:function(e){wh=e}};function Dh(e){_c.call(this,e)}function Ph(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new kt)}function Oh(e,t){ih.call(this,void 0,t),this.sh=void 0!==e?e:new Ph}function Ih(e,t,i){Oh.call(this,void 0,i);var n=(new ln).set(e),r=(new ln).set(t),o=new kt(n.r,n.g,n.b),a=new kt(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function kh(e,t){Oh.call(this,void 0,t);var i=(new ln).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}Dh.prototype=Object.assign(Object.create(_c.prototype),{constructor:Dh,load:function(e,t,i,n){var r=new Tc(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(e,(function(e){var i=e.slice(0);Rh.getContext().decodeAudioData(i,(function(e){t(e)}))}),i,n)}}),Object.assign(Ph.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*n),t.addScale(o[2],.488603*r),t.addScale(o[3],.488603*i),t.addScale(o[4],i*n*1.092548),t.addScale(o[5],n*r*1.092548),t.addScale(o[6],.315392*(3*r*r-1)),t.addScale(o[7],i*r*1.092548),t.addScale(o[8],.546274*(i*i-n*n)),t},getIrradianceAt:function(e,t){var i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*n),t.addScale(o[2],1.023328*r),t.addScale(o[3],1.023328*i),t.addScale(o[4],.858086*i*n),t.addScale(o[5],.858086*n*r),t.addScale(o[6],.743125*r*r-.247708),t.addScale(o[7],.858086*i*r),t.addScale(o[8],.429043*(i*i-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var i=this.coefficients,n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var i=this.coefficients,n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}}),Object.assign(Ph,{getBasisAt:function(e,t){var i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}),Oh.prototype=Object.assign(Object.create(ih.prototype),{constructor:Oh,isLightProbe:!0,copy:function(e){return ih.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return ih.prototype.toJSON.call(this,e)}}),Ih.prototype=Object.assign(Object.create(Oh.prototype),{constructor:Ih,isHemisphereLightProbe:!0,copy:function(e){return Oh.prototype.copy.call(this,e),this},toJSON:function(e){return Oh.prototype.toJSON.call(this,e)}}),kh.prototype=Object.assign(Object.create(Oh.prototype),{constructor:kh,isAmbientLightProbe:!0,copy:function(e){return Oh.prototype.copy.call(this,e),this},toJSON:function(e){return Oh.prototype.toJSON.call(this,e)}});var Bh=new Jt,Nh=new Jt;function Fh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new gr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new gr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Hh(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Fh.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var i,n,r=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(Rt.DEG2RAD*t.fov*.5)/t.zoom;Nh.elements[12]=-o,Bh.elements[12]=o,i=-s*t.aspect+a,n=s*t.aspect+a,r.elements[0]=2*t.near/(n-i),r.elements[8]=(n+i)/(n-i),this.cameraL.projectionMatrix.copy(r),i=-s*t.aspect-a,n=s*t.aspect-a,r.elements[0]=2*t.near/(n-i),r.elements[8]=(n+i)/(n-i),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Nh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Bh)}}),Object.assign(Hh.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Uh=new kt,jh=new Pt,zh=new kt,Gh=new kt;function Vh(){vi.call(this),this.type="AudioListener",this.context=Rh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Hh}function Wh(e){vi.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Vh.prototype=Object.assign(Object.create(vi.prototype),{constructor:Vh,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){vi.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Uh,jh,zh),Gh.set(0,0,-1).applyQuaternion(jh),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Uh.x,n),t.positionY.linearRampToValueAtTime(Uh.y,n),t.positionZ.linearRampToValueAtTime(Uh.z,n),t.forwardX.linearRampToValueAtTime(Gh.x,n),t.forwardY.linearRampToValueAtTime(Gh.y,n),t.forwardZ.linearRampToValueAtTime(Gh.z,n),t.upX.linearRampToValueAtTime(i.x,n),t.upY.linearRampToValueAtTime(i.y,n),t.upZ.linearRampToValueAtTime(i.z,n)}else t.setPosition(Uh.x,Uh.y,Uh.z),t.setOrientation(Gh.x,Gh.y,Gh.z,i.x,i.y,i.z)}}),Wh.prototype=Object.assign(Object.create(vi.prototype),{constructor:Wh,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var qh=new kt,Xh=new Pt,Yh=new kt,Kh=new kt;function Qh(e){Wh.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Zh(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Jh(e,t,i){this.binding=e,this.valueSize=i;var n,r=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Qh.prototype=Object.assign(Object.create(Wh.prototype),{constructor:Qh,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(e){if(vi.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(qh,Xh,Yh),Kh.set(0,0,1).applyQuaternion(Xh);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(qh.x,i),t.positionY.linearRampToValueAtTime(qh.y,i),t.positionZ.linearRampToValueAtTime(qh.z,i),t.orientationX.linearRampToValueAtTime(Kh.x,i),t.orientationY.linearRampToValueAtTime(Kh.y,i),t.orientationZ.linearRampToValueAtTime(Kh.z,i)}else t.setPosition(qh.x,qh.y,qh.z),t.setOrientation(Kh.x,Kh.y,Kh.z)}}}),Object.assign(Zh.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(Jh.prototype,{accumulate:function(e,t){var i=this.buffer,n=this.valueSize,r=e*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)i[r+a]=i[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(i,r,0,s,n)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var a=3*t;this._mixBufferRegion(i,n,a,1-r,t)}for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,n=3*i;e.getValue(t,n);for(var r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,n,r){if(n>=.5)for(var o=0;o!==r;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,n){Pt.slerpFlat(e,t,e,t,e,i,n)},_lerp:function(e,t,i,n,r){for(var o=1-n,a=0;a!==r;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*n}}});var $h="\\[\\]\\.:\\/",eu=new RegExp("["+$h+"]","g"),tu="[^"+$h+"]",iu="[^"+$h.replace("\\.","")+"]",nu=/((?:WC+[\/:])*)/.source.replace("WC",tu),ru=/(WCOD+)?/.source.replace("WCOD",iu),ou=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",tu),au=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",tu),su=new RegExp("^"+nu+ru+ou+au+"$"),lu=["material","materials","bones"];function cu(e,t,i){var n=i||hu.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function hu(e,t,i){this.path=t,this.parsedPath=i||hu.parseTrackName(t),this.node=hu.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function uu(){this.uuid=Rt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function du(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var n=t.tracks,r=n.length,o=new Array(r),a={endingStart:lt,endingEnd:lt},s=0;s!==r;++s){var l=n[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function pu(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function fu(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function mu(e,t,i){Na.call(this,e,t),this.meshPerAttribute=i||1}function vu(e,t,i,n){this.ray=new zi(e,t),this.near=i||0,this.far=n||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function gu(e,t){return e.distance-t.distance}function yu(e,t,i,n){if(!1!==e.visible&&(e.raycast(t,i),!0===n))for(var r=e.children,o=0,a=r.length;o<a;o++)yu(r[o],t,i,!0)}function bu(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function Au(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}Object.assign(cu.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(hu,{Composite:cu,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new hu.Composite(e,t,i):new hu(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(eu,"")},parseTrackName:function(e){var t=su.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var r=i.nodeName.substring(n+1);-1!==lu.indexOf(r)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var n=function(e){for(var i=0;i<e.length;i++){var r=e[i];if(r.name===t||r.uuid===t)return r;var o=n(r.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}}),Object.assign(hu.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=hu.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===r){r=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===r){r=a;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var h=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(hu.prototype,{_getValue_unbound:hu.prototype.getValue,_setValue_unbound:hu.prototype.setValue}),Object.assign(uu.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,h=arguments.length;c!==h;++c){var u=arguments[c],d=u.uuid,p=n[d];if(void 0===p){p=t++,n[d]=p,e.push(u);for(var f=0,m=s;f!==m;++f)a[f].push(new hu(u,r[f],o[f]))}else if(p<i){l=e[p];var v=--i,g=e[v];for(n[g.uuid]=p,e[p]=g,n[d]=v,e[v]=u,f=0,m=s;f!==m;++f){var y=a[f],b=y[v],A=y[p];y[p]=b,void 0===A&&(A=new hu(u,r[f],o[f])),y[v]=A}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,r=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=i[l];if(void 0!==c&&c>=t){var h=t++,u=e[h];i[u.uuid]=c,e[c]=u,i[l]=h,e[h]=s;for(var d=0,p=r;d!==p;++d){var f=n[d],m=f[h],v=f[c];f[c]=m,f[h]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<i){var h=--i,u=e[h],d=e[g=--t];n[u.uuid]=c,e[c]=u,n[d.uuid]=h,e[h]=d,e.pop();for(var p=0,f=o;p!==f;++p){var m=(y=r[p])[h],v=y[g];y[c]=m,y[h]=v,y.pop()}}else{var g;for(n[(d=e[g=--t]).uuid]=c,e[c]=d,e.pop(),p=0,f=o;p!==f;++p){var y;(y=r[p])[c]=y[g],y.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,n=i[e],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[e]=n,o.push(e),a.push(t),r.push(h);for(var u=c,d=s.length;u!==d;++u){var p=s[u];h[u]=new hu(p,e,t)}return h},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}),Object.assign(du.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var n=this._clip.duration,r=e._clip.duration,o=r/n,a=n/r;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+i,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,n){if(this.enabled){var r=this._startTime;if(null!==r){var o=(e-r)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,h=0,u=l.length;h!==u;++h)l[h].evaluate(a),c[h].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,n=this.loop,r=this._loopCount,o=2202===n;if(0===e)return-1===r||!o||1&~r?t:i-t;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var a=Math.floor(t/i);r+=Math.abs(a);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&!(1&~r))return i-t}return t},_setEndings:function(e,t,i){var n=this._interpolantSettings;i?(n.endingStart=ct,n.endingEnd=ct):(n.endingStart=e?this.zeroSlopeAtStart?ct:lt:ht,n.endingEnd=t?this.zeroSlopeAtEnd?ct:lt:ht)},_scheduleFading:function(e,t,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=t,a[1]=r+e,s[1]=i,this}}),pu.prototype=Object.assign(Object.create(St.prototype),{constructor:pu,_bindAction:function(e,t){var i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var h=0;h!==r;++h){var u=n[h],d=u.name,p=c[d];if(void 0!==p)o[h]=p;else{if(void 0!==(p=o[h])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[h].binding.parsedPath;++(p=new Jh(hu.create(i,d,f),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[h]=p}a[h].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}for(var r=e._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var n=this._actions,r=this._actionsByClip,o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_addInactiveBinding:function(e,t,i){var n=this._bindingsByRootAndName,r=n[t],o=this._bindings;void 0===r&&(r={},n[t]=r),r[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[r],0===Object.keys(a).length&&delete o[n]},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new cc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,n=i.uuid,r="string"==typeof e?bc.findByName(i,e):e,o=null!==r?r.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[n];if(void 0!==l)return l;s=a.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var c=new du(this,r,t);return this._bindAction(c,s),this._addInactiveAction(c,o,n),c},existingAction:function(e,t){var i=t||this._root,n=i.uuid,r="string"==typeof e?bc.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==t;++r)e[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a)t[a]._update(n,e,r,o);var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,t[c]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),fu.prototype.clone=function(){return new fu(void 0===this.value.clone?this.value:this.value.clone())},mu.prototype=Object.assign(Object.create(Na.prototype),{constructor:mu,isInstancedInterleavedBuffer:!0,copy:function(e){return Na.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(vu.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var n=i||[];return yu(e,this,n,t),n.sort(gu),n},intersectObjects:function(e,t,i){var n=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var r=0,o=e.length;r<o;r++)yu(e[r],this,n,t);return n.sort(gu),n}}),Object.assign(bu.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Rt.clamp(t/this.radius,-1,1))),this}}),Object.assign(Au.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}});var wu=new Dt;function xu(e,t){this.min=void 0!==e?e:new Dt(1/0,1/0),this.max=void 0!==t?t:new Dt(-1/0,-1/0)}Object.assign(xu.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var i=wu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Dt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Dt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Dt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Dt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return wu.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Eu=new kt,_u=new kt;function Mu(e,t){this.start=void 0!==e?e:new kt,this.end=void 0!==t?t:new kt}function Tu(e){vi.call(this),this.material=e,this.render=function(){}}Object.assign(Mu.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new kt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new kt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new kt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Eu.subVectors(e,this.start),_u.subVectors(this.end,this.start);var i=_u.dot(_u),n=_u.dot(Eu)/i;return t&&(n=Rt.clamp(n,0,1)),n},closestPointToPoint:function(e,t,i){var n=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new kt),this.delta(i).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Tu.prototype=Object.create(vi.prototype),Tu.prototype.constructor=Tu,Tu.prototype.isImmediateRenderObject=!0;var Su=new kt,Cu=new kt,Lu=new Ft,Ru=["a","b","c"];function Du(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Bn,c=new Mn(2*a*3,3);l.setAttribute("position",c),Es.call(this,l,new fs({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}Du.prototype=Object.create(Es.prototype),Du.prototype.constructor=Du,Du.prototype.update=function(){this.object.updateMatrixWorld(!0),Lu.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry;if(i&&i.isGeometry)for(var n=i.vertices,r=i.faces,o=0,a=0,s=r.length;a<s;a++)for(var l=r[a],c=0,h=l.vertexNormals.length;c<h;c++){var u=n[l[Ru[c]]],d=l.vertexNormals[c];Su.copy(u).applyMatrix4(e),Cu.copy(d).applyMatrix3(Lu).normalize().multiplyScalar(this.size).add(Su),t.setXYZ(o,Su.x,Su.y,Su.z),o+=1,t.setXYZ(o,Cu.x,Cu.y,Cu.z),o+=1}else if(i&&i.isBufferGeometry){var p=i.attributes.position,f=i.attributes.normal;for(o=0,c=0,h=p.count;c<h;c++)Su.set(p.getX(c),p.getY(c),p.getZ(c)).applyMatrix4(e),Cu.set(f.getX(c),f.getY(c),f.getZ(c)),Cu.applyMatrix3(Lu).normalize().multiplyScalar(this.size).add(Su),t.setXYZ(o,Su.x,Su.y,Su.z),o+=1,t.setXYZ(o,Cu.x,Cu.y,Cu.z),o+=1}t.needsUpdate=!0};var Pu=new kt,Ou=new kt;function Iu(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:65535,o=void 0!==n?n:1,a=this.object.geometry;if(a&&a.isBufferGeometry){var s=a.attributes.tangent.count,l=new Bn,c=new Mn(2*s*3,3);l.setAttribute("position",c),Es.call(this,l,new fs({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}else console.error("THREE.VertexTangentsHelper: geometry not an instance of THREE.BufferGeometry.",a)}Iu.prototype=Object.create(Es.prototype),Iu.prototype.constructor=Iu,Iu.prototype.update=function(){this.object.updateMatrixWorld(!0);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry,n=i.attributes.position,r=i.attributes.tangent,o=0,a=0,s=n.count;a<s;a++)Pu.set(n.getX(a),n.getY(a),n.getZ(a)).applyMatrix4(e),Ou.set(r.getX(a),r.getY(a),r.getZ(a)),Ou.transformDirection(e).multiplyScalar(this.size).add(Pu),t.setXYZ(o,Pu.x,Pu.y,Pu.z),o+=1,t.setXYZ(o,Ou.x,Ou.y,Ou.z),o+=1;t.needsUpdate=!0};var ku=new kt;function Bu(e,t){vi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new Bn,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,o=1;r<32;r++,o++){var a=r/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Mn(n,3));var l=new fs({fog:!1});this.cone=new Es(i,l),this.add(this.cone),this.update()}Bu.prototype=Object.create(vi.prototype),Bu.prototype.constructor=Bu,Bu.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Bu.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ku.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ku),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Nu=new kt,Fu=new Jt,Hu=new Jt;function Uu(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,Uu(e.children[i]));return t}function ju(e){for(var t=Uu(e),i=new Bn,n=[],r=[],o=new ln(0,0,1),a=new ln(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Mn(n,3)),i.setAttribute("color",new Mn(r,3));var c=new fs({vertexColors:d,depthTest:!1,depthWrite:!1,transparent:!0});Es.call(this,i,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function zu(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var n=new Ol(t,4,2),r=new mn({wireframe:!0,fog:!1});er.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Gu(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var i=new Bn;i.setAttribute("position",new Mn([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere();var n=new fs({fog:!1});As.call(this,i,n);var r=new Bn;r.setAttribute("position",new Mn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new er(r,new mn({side:c,fog:!1}))),this.update()}ju.prototype=Object.create(Es.prototype),ju.prototype.constructor=ju,ju.prototype.updateMatrixWorld=function(e){var t=this.bones,i=this.geometry,n=i.getAttribute("position");Hu.getInverse(this.root.matrixWorld);for(var r=0,o=0;r<t.length;r++){var a=t[r];a.parent&&a.parent.isBone&&(Fu.multiplyMatrices(Hu,a.matrixWorld),Nu.setFromMatrixPosition(Fu),n.setXYZ(o,Nu.x,Nu.y,Nu.z),Fu.multiplyMatrices(Hu,a.parent.matrixWorld),Nu.setFromMatrixPosition(Fu),n.setXYZ(o+1,Nu.x,Nu.y,Nu.z),o+=2)}i.getAttribute("position").needsUpdate=!0,vi.prototype.updateMatrixWorld.call(this,e)},zu.prototype=Object.create(er.prototype),zu.prototype.constructor=zu,zu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},zu.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Gu.prototype=Object.create(As.prototype),Gu.prototype.constructor=Gu,Gu.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},Gu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var Vu=new kt,Wu=new ln,qu=new ln;function Xu(e,t,i){vi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var n=new Vs(t);n.rotateY(.5*Math.PI),this.material=new mn({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=d);var r=n.getAttribute("position"),o=new Float32Array(3*r.count);n.setAttribute("color",new gn(o,3)),this.add(new er(n,this.material)),this.update()}function Yu(e,t){this.lightProbe=e,this.size=t;var i=new mr({defines:{GAMMA_OUTPUT:""},uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),n=new Ol(1,32,16);er.call(this,n,i),this.onBeforeRender()}function Ku(e,t,i,n){e=e||10,t=t||10,i=new ln(void 0!==i?i:4473924),n=new ln(void 0!==n?n:8947848);for(var r=t/2,o=e/t,a=e/2,s=[],l=[],c=0,h=0,u=-a;c<=t;c++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);var p=c===r?i:n;p.toArray(l,h),h+=3,p.toArray(l,h),h+=3,p.toArray(l,h),h+=3,p.toArray(l,h),h+=3}var f=new Bn;f.setAttribute("position",new Mn(s,3)),f.setAttribute("color",new Mn(l,3));var m=new fs({vertexColors:d});Es.call(this,f,m)}function Qu(e,t,i,n,r,o){e=e||10,t=t||16,i=i||8,n=n||64,r=new ln(void 0!==r?r:4473924),o=new ln(void 0!==o?o:8947848);var a,s,l,c,h,u,p,f=[],m=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(a,0,s),p=1&c?r:o,m.push(p.r,p.g,p.b),m.push(p.r,p.g,p.b);for(c=0;c<=i;c++)for(p=1&c?r:o,u=e-e/i*c,h=0;h<n;h++)l=h/n*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,f.push(a,0,s),m.push(p.r,p.g,p.b),l=(h+1)/n*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,f.push(a,0,s),m.push(p.r,p.g,p.b);var v=new Bn;v.setAttribute("position",new Mn(f,3)),v.setAttribute("color",new Mn(m,3));var g=new fs({vertexColors:d});Es.call(this,v,g)}function Zu(e,t,i,n){this.audio=e,this.range=t||1,this.divisionsInnerAngle=i||16,this.divisionsOuterAngle=n||2;var r=new Bn,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*o+3));r.setAttribute("position",new gn(a,3));var s=new fs({color:65280}),l=new fs({color:16776960});As.call(this,r,[l,s]),this.update()}Xu.prototype=Object.create(vi.prototype),Xu.prototype.constructor=Xu,Xu.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Xu.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Wu.copy(this.light.color),qu.copy(this.light.groundColor);for(var i=0,n=t.count;i<n;i++){var r=i<n/2?Wu:qu;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Vu.setFromMatrixPosition(this.light.matrixWorld).negate())},Yu.prototype=Object.create(er.prototype),Yu.prototype.constructor=Yu,Yu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Yu.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Ku.prototype=Object.assign(Object.create(Es.prototype),{constructor:Ku,copy:function(e){return Es.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Qu.prototype=Object.create(Es.prototype),Qu.prototype.constructor=Qu,Zu.prototype=Object.create(As.prototype),Zu.prototype.constructor=Zu,Zu.prototype.update=function(){var e,t,i=this.audio,n=this.range,r=this.divisionsInnerAngle,o=this.divisionsOuterAngle,a=Rt.degToRad(i.panner.coneInnerAngle),s=Rt.degToRad(i.panner.coneOuterAngle),l=a/2,c=s/2,h=0,u=0,d=this.geometry,p=d.attributes.position;function f(i,r,o,a){var s=(r-i)/o;for(p.setXYZ(h,0,0,0),u++,e=i;e<r;e+=s)t=h+u,p.setXYZ(t,Math.sin(e)*n,0,Math.cos(e)*n),p.setXYZ(t+1,Math.sin(Math.min(e+s,r))*n,0,Math.cos(Math.min(e+s,r))*n),p.setXYZ(t+2,0,0,0),u+=3;d.addGroup(h,u,a),h+=u,u=0}d.clearGroups(),f(-c,-l,o,0),f(-l,l,r,1),f(l,c,o,0),p.needsUpdate=!0,a===s&&(this.material[0].visible=!1)},Zu.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var Ju=new kt,$u=new kt,ed=new Ft;function td(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Bn,c=new Mn(2*a*3,3);l.setAttribute("position",c),Es.call(this,l,new fs({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}td.prototype=Object.create(Es.prototype),td.prototype.constructor=td,td.prototype.update=function(){this.object.updateMatrixWorld(!0),ed.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry,n=i.vertices,r=i.faces,o=0,a=0,s=r.length;a<s;a++){var l=r[a],c=l.normal;Ju.copy(n[l.a]).add(n[l.b]).add(n[l.c]).divideScalar(3).applyMatrix4(e),$u.copy(c).applyMatrix3(ed).normalize().multiplyScalar(this.size).add(Ju),t.setXYZ(o,Ju.x,Ju.y,Ju.z),o+=1,t.setXYZ(o,$u.x,$u.y,$u.z),o+=1}t.needsUpdate=!0};var id=new kt,nd=new kt,rd=new kt;function od(e,t,i){vi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);var n=new Bn;n.setAttribute("position",new Mn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var r=new fs({fog:!1});this.lightPlane=new As(n,r),this.add(this.lightPlane),(n=new Bn).setAttribute("position",new Mn([0,0,0,0,0,1],3)),this.targetLine=new As(n,r),this.add(this.targetLine),this.update()}od.prototype=Object.create(vi.prototype),od.prototype.constructor=od,od.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},od.prototype.update=function(){id.setFromMatrixPosition(this.light.matrixWorld),nd.setFromMatrixPosition(this.light.target.matrixWorld),rd.subVectors(nd,id),this.lightPlane.lookAt(nd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(nd),this.targetLine.scale.z=rd.length()};var ad=new kt,sd=new vr;function ld(e){var t=new Bn,i=new fs({color:16777215,vertexColors:1}),n=[],r=[],o={},a=new ln(16755200),s=new ln(16711680),l=new ln(43775),c=new ln(16777215),h=new ln(3355443);function u(e,t,i){d(e,i),d(t,i)}function d(e,t){n.push(0,0,0),r.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",s),u("p","n2",s),u("p","n3",s),u("p","n4",s),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),t.setAttribute("position",new Mn(n,3)),t.setAttribute("color",new Mn(r,3)),Es.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function cd(e,t,i,n,r,o,a){ad.set(r,o,a).unproject(n);var s=t[e];if(void 0!==s)for(var l=i.getAttribute("position"),c=0,h=s.length;c<h;c++)l.setXYZ(s[c],ad.x,ad.y,ad.z)}ld.prototype=Object.create(Es.prototype),ld.prototype.constructor=ld,ld.prototype.update=function(){var e=this.geometry,t=this.pointMap;sd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cd("c",t,e,sd,0,0,-1),cd("t",t,e,sd,0,0,1),cd("n1",t,e,sd,-1,-1,-1),cd("n2",t,e,sd,1,-1,-1),cd("n3",t,e,sd,-1,1,-1),cd("n4",t,e,sd,1,1,-1),cd("f1",t,e,sd,-1,-1,1),cd("f2",t,e,sd,1,-1,1),cd("f3",t,e,sd,-1,1,1),cd("f4",t,e,sd,1,1,1),cd("u1",t,e,sd,.7,1.1,-1),cd("u2",t,e,sd,-.7,1.1,-1),cd("u3",t,e,sd,0,2,-1),cd("cf1",t,e,sd,-1,0,1),cd("cf2",t,e,sd,1,0,1),cd("cf3",t,e,sd,0,-1,1),cd("cf4",t,e,sd,0,1,1),cd("cn1",t,e,sd,-1,0,-1),cd("cn2",t,e,sd,1,0,-1),cd("cn3",t,e,sd,0,-1,-1),cd("cn4",t,e,sd,0,1,-1),e.getAttribute("position").needsUpdate=!0};var hd=new Di;function ud(e,t){this.object=e,void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Bn;r.setIndex(new gn(i,1)),r.setAttribute("position",new gn(n,3)),Es.call(this,r,new fs({color:t})),this.matrixAutoUpdate=!1,this.update()}function dd(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Bn;n.setIndex(new gn(i,1)),n.setAttribute("position",new Mn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Es.call(this,n,new fs({color:t})),this.geometry.computeBoundingSphere()}function pd(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==i?i:16776960,r=new Bn;r.setAttribute("position",new Mn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),As.call(this,r,new fs({color:n}));var o=new Bn;o.setAttribute("position",new Mn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new er(o,new mn({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}ud.prototype=Object.create(Es.prototype),ud.prototype.constructor=ud,ud.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&hd.setFromObject(this.object),!hd.isEmpty()){var t=hd.min,i=hd.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},ud.prototype.setFromObject=function(e){return this.object=e,this.update(),this},ud.prototype.copy=function(e){return Es.prototype.copy.call(this,e),this.object=e.object,this},ud.prototype.clone=function(){return(new this.constructor).copy(this)},dd.prototype=Object.create(Es.prototype),dd.prototype.constructor=dd,dd.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),vi.prototype.updateMatrixWorld.call(this,e))},pd.prototype=Object.create(As.prototype),pd.prototype.constructor=pd,pd.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?c:l,this.lookAt(this.plane.normal),vi.prototype.updateMatrixWorld.call(this,e)};var fd,md,vd=new kt;function gd(e,t,i,n,r,o){vi.call(this),void 0===e&&(e=new kt(0,0,1)),void 0===t&&(t=new kt(0,0,0)),void 0===i&&(i=1),void 0===n&&(n=16776960),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===fd&&((fd=new Bn).setAttribute("position",new Mn([0,0,0,0,1,0],3)),(md=new Gl(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new As(fd,new fs({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new er(md,new mn({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}function yd(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Bn;i.setAttribute("position",new Mn(t,3)),i.setAttribute("color",new Mn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new fs({vertexColors:d});Es.call(this,i,n)}gd.prototype=Object.create(vi.prototype),gd.prototype.constructor=gd,gd.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{vd.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(vd,t)}},gd.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},gd.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},gd.prototype.copy=function(e){return vi.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},gd.prototype.clone=function(){return(new this.constructor).copy(this)},yd.prototype=Object.create(Es.prototype),yd.prototype.constructor=yd;function bd(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),jc.call(this,e),this.type="catmullrom",this.closed=!0}function Ad(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),jc.call(this,e),this.type="catmullrom"}function wd(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),jc.call(this,e),this.type="catmullrom"}Oc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Oc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign($c.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new sr,i=0,n=e.length;i<n;i++){var r=e[i];t.vertices.push(new kt(r.x,r.y,r.z||0))}return t}}),Object.assign(eh.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),bd.prototype=Object.create(jc.prototype),Ad.prototype=Object.create(jc.prototype),wd.prototype=Object.create(jc.prototype),Object.assign(wd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ku.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ju.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(_c.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),mh.extractUrlBase(e)}}),_c.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Ah.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(xu.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Di.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Mu.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Rt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Rt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Rt.ceilPowerOfTwo(e)}}),Object.assign(Ft.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Jt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new kt).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,r,o)}}),qi.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Pt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(zi.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(rn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(rn,{barycoordFromPoint:function(e,t,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),rn.getBarycoord(e,t,i,n,r)},normal:function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),rn.getNormal(e,t,i,n)}}),Object.assign(th.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Tl(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Fl(this,e)}}),Object.assign(Dt.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(zt.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(sr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(vi.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(vi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(er.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(er.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(is.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ss.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ns.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Oc.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),gr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ih.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(gn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tt)}}}),Object.assign(gn.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tt:Mt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Bn.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new gn(arguments[1],arguments[2])))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)}}),Object.defineProperties(Bn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Na.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Tt},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Na.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tt:Mt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Sl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(fu.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(fn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ln}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties($l.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(mr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ia.prototype,{clearTarget:function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Ia.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been removed. Use .xr instead."),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Please define the correct color spaces for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Please define the correct color spaces for textures via Texture.encoding instead.")}}}),Object.defineProperties(Aa.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ar.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Gt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Pa.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Object.defineProperties(Wh.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Dh).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Zh.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},br.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var xd={merge:function(e,t,i){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Ht.crossOrigin=void 0,Ht.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Pc;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,i,void 0,n);return t&&(o.mapping=t),o},Ht.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Dc;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,i,void 0,n);return t&&(o.mapping=t),o},Ht.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ht.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Ed={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),e.ACESFilmicToneMapping=Z,e.AddEquation=b,e.AddOperation=W,e.AdditiveBlending=m,e.AlphaFormat=Se,e.AlwaysDepth=B,e.AlwaysStencilFunc=_t,e.AmbientLight=dh,e.AmbientLightProbe=kh,e.AnimationClip=bc,e.AnimationLoader=Sc,e.AnimationMixer=pu,e.AnimationObjectGroup=uu,e.AnimationUtils=ac,e.ArcCurve=kc,e.ArrayCamera=Sa,e.ArrowHelper=gd,e.Audio=Wh,e.AudioAnalyser=Zh,e.AudioContext=Rh,e.AudioListener=Vh,e.AudioLoader=Dh,e.AxesHelper=yd,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new yd(e)},e.BackSide=c,e.BasicDepthPacking=bt,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Lc(e)},e.Bone=ls,e.BooleanKeyframeTrack=dc,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ud(e,t)},e.Box2=xu,e.Box3=Di,e.Box3Helper=dd,e.BoxBufferGeometry=cr,e.BoxGeometry=lr,e.BoxHelper=ud,e.BufferAttribute=gn,e.BufferGeometry=Bn,e.BufferGeometryLoader=yh,e.ByteType=ve,e.Cache=wc,e.Camera=vr,e.CameraHelper=ld,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Is,e.CatmullRomCurve3=jc,e.CineonToneMapping=Q,e.CircleBufferGeometry=Xl,e.CircleGeometry=ql,e.ClampToEdgeWrapping=se,e.Clock=Hh,e.ClosedSplineCurve3=bd,e.Color=ln,e.ColorKeyframeTrack=pc,e.CompressedTexture=Os,e.CompressedTextureLoader=Cc,e.ConeBufferGeometry=Wl,e.ConeGeometry=Vl,e.CubeCamera=br,e.CubeGeometry=lr,e.CubeReflectionMapping=$,e.CubeRefractionMapping=ee,e.CubeTexture=Gr,e.CubeTextureLoader=Dc,e.CubeUVReflectionMapping=re,e.CubeUVRefractionMapping=oe,e.CubicBezierCurve=Wc,e.CubicBezierCurve3=qc,e.CubicInterpolant=lc,e.CullFaceBack=n,e.CullFaceFront=r,e.CullFaceFrontBack=3,e.CullFaceNone=i,e.Curve=Oc,e.CurvePath=$c,e.CustomBlending=y,e.CylinderBufferGeometry=Gl,e.CylinderGeometry=zl,e.Cylindrical=Au,e.DataTexture=wr,e.DataTexture2DArray=Vr,e.DataTexture3D=Wr,e.DataTextureLoader=Lc,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=Ec,e.DepthFormat=Oe,e.DepthStencilFormat=Ie,e.DepthTexture=ks,e.DirectionalLight=uh,e.DirectionalLightHelper=od,e.DirectionalLightShadow=hh,e.DiscreteInterpolant=hc,e.DodecahedronBufferGeometry=Ys,e.DodecahedronGeometry=Xs,e.DoubleSide=h,e.DstAlphaFactor=R,e.DstColorFactor=P,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new gn(e,t).setDynamic(!0)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=Tt,e.DynamicReadUsage=35049,e.EdgesGeometry=jl,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Es(new jl(e.geometry),new fs({color:void 0!==t?t:16777215}))},e.EllipseCurve=Ic,e.EqualDepth=H,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=te,e.EquirectangularRefractionMapping=ie,e.Euler=ti,e.EventDispatcher=St,e.ExtrudeBufferGeometry=Sl,e.ExtrudeGeometry=Tl,e.Face3=dn,e.Face4=function(e,t,i,n,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new dn(e,t,i,r,o,a)},e.FaceColors=1,e.FaceNormalsHelper=td,e.FileLoader=Tc,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Mn(e,t)},e.Float32BufferAttribute=Mn,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Tn(e,t)},e.Float64BufferAttribute=Tn,e.FloatType=we,e.Fog=Ba,e.FogExp2=ka,e.Font=Sh,e.FontLoader=Lh,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=l,e.Frustum=_r,e.GammaEncoding=pt,e.Geometry=sr,e.GeometryUtils=xd,e.GreaterDepth=j,e.GreaterEqualDepth=U,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Ku,e.Group=Ta,e.HalfFloatType=xe,e.HemisphereLight=nh,e.HemisphereLightHelper=Xu,e.HemisphereLightProbe=Ih,e.IcosahedronBufferGeometry=qs,e.IcosahedronGeometry=Ws,e.ImageBitmapLoader=Mh,e.ImageLoader=Rc,e.ImageUtils=Ht,e.ImmediateRenderObject=Tu,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=gh,e.InstancedBufferGeometry=vh,e.InstancedInterleavedBuffer=mu,e.InstancedMesh=ps,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new wn(e,t)},e.Int16BufferAttribute=wn,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new En(e,t)},e.Int32BufferAttribute=En,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new yn(e,t)},e.Int8BufferAttribute=yn,e.IntType=be,e.InterleavedBuffer=Na,e.InterleavedBufferAttribute=Fa,e.Interpolant=sc,e.InterpolateDiscrete=ot,e.InterpolateLinear=at,e.InterpolateSmooth=st,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=Et,e.KeyframeTrack=uc,e.LOD=is,e.LatheBufferGeometry=Nl,e.LatheGeometry=Bl,e.Layers=ii,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=N,e.LessEqualDepth=F,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=ih,e.LightProbe=Oh,e.LightProbeHelper=Yu,e.LightShadow=rh,e.Line=As,e.Line3=Mu,e.LineBasicMaterial=fs,e.LineCurve=Xc,e.LineCurve3=Yc,e.LineDashedMaterial=rc,e.LineLoop=_s,e.LinePieces=1,e.LineSegments=Es,e.LineStrip=0,e.LinearEncoding=ut,e.LinearFilter=de,e.LinearInterpolant=cc,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=fe,e.LinearMipmapNearestFilter=pe,e.LinearToneMapping=X,e.Loader=_c,e.LoaderUtils=mh,e.LoadingManager=xc,e.LogLuvEncoding=mt,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=De,e.LuminanceFormat=Re,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=fn,e.MaterialLoader=fh,e.Math=Rt,e.Matrix3=Ft,e.Matrix4=Jt,e.MaxEquation=E,e.Mesh=er,e.MeshBasicMaterial=mn,e.MeshDepthMaterial=va,e.MeshDistanceMaterial=ga,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=ic,e.MeshMatcapMaterial=nc,e.MeshNormalMaterial=tc,e.MeshPhongMaterial=$l,e.MeshPhysicalMaterial=Jl,e.MeshStandardMaterial=Zl,e.MeshToonMaterial=ec,e.MinEquation=x,e.MirroredRepeatWrapping=le,e.MixOperation=V,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=g,e.MultiplyOperation=G,e.NearestFilter=ce,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=ue,e.NearestMipmapNearestFilter=he,e.NeverDepth=k,e.NeverStencilFunc=512,e.NoBlending=p,e.NoColors=u,e.NoToneMapping=q,e.NormalBlending=f,e.NotEqualDepth=z,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=fc,e.Object3D=vi,e.ObjectLoader=Ah,e.ObjectSpaceNormalMap=xt,e.OctahedronBufferGeometry=Vs,e.OctahedronGeometry=Gs,e.OneFactor=M,e.OneMinusDstAlphaFactor=D,e.OneMinusDstColorFactor=O,e.OneMinusSrcAlphaFactor=L,e.OneMinusSrcColorFactor=S,e.OrthographicCamera=ch,e.PCFShadowMap=o,e.PCFSoftShadowMap=a,e.ParametricBufferGeometry=Fs,e.ParametricGeometry=Ns,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ja(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ms(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Rs(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ms(e)},e.Path=eh,e.PerspectiveCamera=gr,e.Plane=qi,e.PlaneBufferGeometry=Dr,e.PlaneGeometry=Rr,e.PlaneHelper=pd,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Rs(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ms(e)},e.PointLight=lh,e.PointLightHelper=zu,e.Points=Rs,e.PointsMaterial=Ms,e.PolarGridHelper=Qu,e.PolyhedronBufferGeometry=Us,e.PolyhedronGeometry=Hs,e.PositionalAudio=Qh,e.PositionalAudioHelper=Zu,e.PropertyBinding=hu,e.PropertyMixer=Jh,e.QuadraticBezierCurve=Kc,e.QuadraticBezierCurve3=Qc,e.Quaternion=Pt,e.QuaternionKeyframeTrack=vc,e.QuaternionLinearInterpolant=mc,e.REVISION=t,e.RGBADepthPacking=At,e.RGBAFormat=Le,e.RGBA_ASTC_10x10_Format=it,e.RGBA_ASTC_10x5_Format=$e,e.RGBA_ASTC_10x6_Format=et,e.RGBA_ASTC_10x8_Format=tt,e.RGBA_ASTC_12x10_Format=nt,e.RGBA_ASTC_12x12_Format=rt,e.RGBA_ASTC_4x4_Format=We,e.RGBA_ASTC_5x4_Format=qe,e.RGBA_ASTC_5x5_Format=Xe,e.RGBA_ASTC_6x5_Format=Ye,e.RGBA_ASTC_6x6_Format=Ke,e.RGBA_ASTC_8x5_Format=Qe,e.RGBA_ASTC_8x6_Format=Ze,e.RGBA_ASTC_8x8_Format=Je,e.RGBA_PVRTC_2BPPV1_Format=Ge,e.RGBA_PVRTC_4BPPV1_Format=ze,e.RGBA_S3TC_DXT1_Format=Ne,e.RGBA_S3TC_DXT3_Format=Fe,e.RGBA_S3TC_DXT5_Format=He,e.RGBDEncoding=yt,e.RGBEEncoding=ft,e.RGBEFormat=Pe,e.RGBFormat=Ce,e.RGBM16Encoding=gt,e.RGBM7Encoding=vt,e.RGB_ETC1_Format=Ve,e.RGB_PVRTC_2BPPV1_Format=je,e.RGB_PVRTC_4BPPV1_Format=Ue,e.RGB_S3TC_DXT1_Format=Be,e.RawShaderMaterial=Ql,e.Ray=zi,e.Raycaster=vu,e.RectAreaLight=ph,e.RectAreaLightHelper=Gu,e.RedFormat=ke,e.ReinhardToneMapping=Y,e.RepeatWrapping=ae,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=w,e.RingBufferGeometry=kl,e.RingGeometry=Il,e.Scene=gi,e.SceneUtils=Ed,e.ShaderChunk=Mr,e.ShaderLib=Sr,e.ShaderMaterial=mr,e.ShadowMaterial=Kl,e.Shape=th,e.ShapeBufferGeometry=Hl,e.ShapeGeometry=Fl,e.ShapePath=Th,e.ShapeUtils=El,e.ShortType=ge,e.Skeleton=ss,e.SkeletonHelper=ju,e.SkinnedMesh=ns,e.SmoothShading=2,e.Sphere=Ii,e.SphereBufferGeometry=Ol,e.SphereGeometry=Pl,e.Spherical=bu,e.SphericalHarmonics3=Ph,e.SphericalReflectionMapping=ne,e.Spline=wd,e.SplineCurve=Zc,e.SplineCurve3=Ad,e.SpotLight=ah,e.SpotLightHelper=Bu,e.SpotLightShadow=oh,e.Sprite=Ja,e.SpriteMaterial=Ha,e.SrcAlphaFactor=C,e.SrcAlphaSaturateFactor=I,e.SrcColorFactor=T,e.StaticCopyUsage=35046,e.StaticDrawUsage=Mt,e.StaticReadUsage=35045,e.StereoCamera=Fh,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=gc,e.SubtractEquation=A,e.SubtractiveBlending=v,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=wt,e.TetrahedronBufferGeometry=zs,e.TetrahedronGeometry=js,e.TextBufferGeometry=Dl,e.TextGeometry=Rl,e.Texture=jt,e.TextureLoader=Pc,e.TorusBufferGeometry=el,e.TorusGeometry=$s,e.TorusKnotBufferGeometry=Js,e.TorusKnotGeometry=Zs,e.Triangle=rn,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Qs,e.TubeGeometry=Ks,e.UVMapping=J,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xn(e,t)},e.Uint16BufferAttribute=xn,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new _n(e,t)},e.Uint32BufferAttribute=_n,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new bn(e,t)},e.Uint8BufferAttribute=bn,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new An(e,t)},e.Uint8ClampedBufferAttribute=An,e.Uncharted2ToneMapping=K,e.Uniform=fu,e.UniformsLib=Tr,e.UniformsUtils=dr,e.UnsignedByteType=me,e.UnsignedInt248Type=Te,e.UnsignedIntType=Ae,e.UnsignedShort4444Type=Ee,e.UnsignedShort5551Type=_e,e.UnsignedShort565Type=Me,e.UnsignedShortType=ye,e.VSMShadowMap=s,e.Vector2=Dt,e.Vector3=kt,e.Vector4=zt,e.VectorKeyframeTrack=yc,e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new kt(e,t,i)},e.VertexColors=d,e.VertexNormalsHelper=Du,e.VertexTangentsHelper=Iu,e.VideoTexture=Ps,e.WebGLMultisampleRenderTarget=Vt,e.WebGLRenderTarget=Gt,e.WebGLRenderTargetCube=Ar,e.WebGLRenderer=Ia,e.WebGLUtils=Ea,e.WireframeGeometry=Bs,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Es(new Bs(e.geometry),new fs({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=ht,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Tc(e)},e.ZeroCurvatureEnding=lt,e.ZeroFactor=_,e.ZeroSlopeEnding=ct,e.ZeroStencilOp=0,e.sRGBEncoding=dt,Object.defineProperty(e,"__esModule",{value:!0})},r("object"==typeof i&&void 0!==t?i:(n=n||self).THREE={})},{}],38:[function(e,t,i){THREE.DRACOLoader=function(e){THREE.Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}},THREE.DRACOLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,i,n){var r=new THREE.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&r.setWithCredentials(!0),r.load(e,(e=>{var i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,i).then(t).catch(n)}),i,n)},decodeDracoFile:function(e,t,i,n){var r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,r).then(t)},decodeGeometry:function(e,t){var i,n=this.workerNextTaskID++,r=e.byteLength;for(var o in t.attributeTypes){var a=t.attributeTypes[o];void 0!==a.BYTES_PER_ELEMENT&&(t.attributeTypes[o]=a.name)}var s=this._getWorker(n,r).then((r=>(i=r,new Promise(((r,o)=>{i._callbacks[n]={resolve:r,reject:o},i.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.finally((()=>{i&&n&&this._releaseTask(i,n)})),s},_createGeometry:function(e){var t=new THREE.BufferGeometry;e.index&&t.setIndex(new THREE.BufferAttribute(e.index.array,1));for(var i=0;i<e.attributes.length;i++){var n=e.attributes[i],r=n.name,o=n.array,a=n.itemSize;t.setAttribute(r,new THREE.BufferAttribute(o,a))}return t},_loadLibrary:function(e,t){var i=new THREE.FileLoader(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),new Promise(((t,n)=>{i.load(e,t,void 0,n)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{var i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var n=THREE.DRACOLoader.DRACOWorker.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then((()=>{var i;return this.workerPool.length<this.workerLimit?((i=new Worker(this.workerSourceURL))._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(i)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1})),(i=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,i._taskLoad+=t,i}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),THREE.DRACOLoader.DRACOWorker=function(){var e,t;function i(e,t,i,n,r,o){var a,s,l=o.num_components(),c=i.num_points()*l;switch(r){case Float32Array:a=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(i,o,a),s=new Float32Array(c);break;case Int8Array:a=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(i,o,a),s=new Int8Array(c);break;case Int16Array:a=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(i,o,a),s=new Int16Array(c);break;case Int32Array:a=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(i,o,a),s=new Int32Array(c);break;case Uint8Array:a=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(i,o,a),s=new Uint8Array(c);break;case Uint16Array:a=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(i,o,a),s=new Uint16Array(c);break;case Uint32Array:a=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(i,o,a),s=new Uint32Array(c);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var h=0;h<c;h++)s[h]=a.GetValue(h);return e.destroy(a),{name:n,array:s,itemSize:l}}onmessage=function(n){var r=n.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=r.buffer,a=r.taskConfig;t.then((e=>{var t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(o),o.byteLength);try{var l=function(e,t,n,r){var o,a,s=r.attributeIDs,l=r.attributeTypes,c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,a=t.DecodeBufferToMesh(n,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,a=t.DecodeBufferToPointCloud(n,o)}if(!a.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var h={index:null,attributes:[]};for(var u in s){var d,p,f=self[l[u]];if(r.useUniqueIDs)p=s[u],d=t.GetAttributeByUniqueId(o,p);else{if(-1===(p=t.GetAttributeId(o,e[s[u]])))continue;d=t.GetAttribute(o,p)}h.attributes.push(i(e,t,o,u,f,d))}if(c===e.TRIANGULAR_MESH){for(var m=o.num_faces(),v=new Uint32Array(3*m),g=new e.DracoInt32Array,y=0;y<m;++y){t.GetFaceFromMesh(o,y,g);for(var b=0;b<3;++b)v[3*y+b]=g.GetValue(b)}h.index={array:v,itemSize:1},e.destroy(g)}return e.destroy(o),h}(t,n,s,a),c=l.attributes.map((e=>e.array.buffer));l.index&&c.push(l.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:l},c)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(s),t.destroy(n)}}))}}},THREE.DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},THREE.DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},THREE.DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},THREE.DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},{}],39:[function(e,t,i){THREE.GLTFLoader=function(){function e(e){THREE.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,load:function(e,t,i,n){var r,o=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===o.crossOrigin&&s.setWithCredentials(!0),s.load(e,(function(i){try{o.parse(i,r,(function(i){t(i),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),i,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,s,l){var f,m={};if("string"==typeof e)f=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===a){try{m[i.KHR_BINARY_GLTF]=new c(e)}catch(e){return void(l&&l(e))}f=m[i.KHR_BINARY_GLTF].content}else f=THREE.LoaderUtils.decodeText(new Uint8Array(e));var v=JSON.parse(f);if(void 0===v.asset||v.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(v.extensionsUsed)for(var g=0;g<v.extensionsUsed.length;++g){var y=v.extensionsUsed[g],b=v.extensionsRequired||[];switch(y){case i.KHR_LIGHTS_PUNCTUAL:m[y]=new r(v);break;case i.KHR_MATERIALS_UNLIT:m[y]=new o;break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new d;break;case i.KHR_DRACO_MESH_COMPRESSION:m[y]=new h(v,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:m[y]=new n(this.ddsLoader);break;case i.KHR_TEXTURE_TRANSFORM:m[y]=new u;break;case i.KHR_MESH_QUANTIZATION:m[y]=new p;break;default:b.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new F(v,m,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(s,l)}}});var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=e}function r(e){this.name=i.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[i.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(){this.name=i.KHR_MATERIALS_UNLIT}r.prototype.loadLight=function(e){var t,i=this.lightDefs[e],n=new THREE.Color(16777215);void 0!==i.color&&n.fromArray(i.color);var r=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new THREE.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(n)).distance=r;break;case"spot":(t=new THREE.SpotLight(n)).distance=r,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},o.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},o.prototype.extendParams=function(e,t,i){var n=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==r.baseColorTexture&&n.push(i.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(n)};var a="glTF",s=12,l={JSON:1313821514,BIN:5130562};function c(e){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==a)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(e,s),r=0;r<n.byteLength;){var o=n.getUint32(r,!0);r+=4;var c=n.getUint32(r,!0);if(r+=4,c===l.JSON){var h=new Uint8Array(e,s+r,o);this.content=THREE.LoaderUtils.decodeText(h)}else if(c===l.BIN){var u=s+r;this.body=e.slice(u,u+o)}r+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function h(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function u(){this.name=i.KHR_TEXTURE_TRANSFORM}function d(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,i){var n=t.extensions[this.name],r=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(r.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),h=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),u=r.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",h);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=r.vertexShader,e.fragmentShader=u,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==n.diffuseTexture&&d.push(i.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var f=n.specularGlossinessTexture;d.push(i.assignTexture(e,"glossinessMap",f)),d.push(i.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,n=0,r=i.length;n<r;n++){var o=e[i[n]];t[i[n]]=o&&o.isColor?o.clone():o}return t},refreshUniforms:function(e,t,i,n,r){if(!0===r.isGLTFSpecularGlossinessMaterial){var o,a=r.uniforms,s=r.defines;a.opacity.value=r.opacity,a.diffuse.value.copy(r.color),a.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),a.map.value=r.map,a.specularMap.value=r.specularMap,a.alphaMap.value=r.alphaMap,a.lightMap.value=r.lightMap,a.lightMapIntensity.value=r.lightMapIntensity,a.aoMap.value=r.aoMap,a.aoMapIntensity.value=r.aoMapIntensity,r.map?o=r.map:r.specularMap?o=r.specularMap:r.displacementMap?o=r.displacementMap:r.normalMap?o=r.normalMap:r.bumpMap?o=r.bumpMap:r.glossinessMap?o=r.glossinessMap:r.alphaMap?o=r.alphaMap:r.emissiveMap&&(o=r.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),a.uvTransform.value.copy(o.matrix)),r.envMap&&(a.envMap.value=r.envMap,a.envMapIntensity.value=r.envMapIntensity,a.flipEnvMap.value=r.envMap.isCubeTexture?-1:1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.maxMipLevel.value=e.properties.get(r.envMap).__maxMipLevel),a.specular.value.copy(r.specular),a.glossiness.value=r.glossiness,a.glossinessMap.value=r.glossinessMap,a.emissiveMap.value=r.emissiveMap,a.bumpMap.value=r.bumpMap,a.normalMap.value=r.normalMap,a.displacementMap.value=r.displacementMap,a.displacementScale.value=r.displacementScale,a.displacementBias.value=r.displacementBias,null!==a.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function p(){this.name=i.KHR_MESH_QUANTIZATION}function f(e,t,i,n){THREE.Interpolant.call(this,e,t,i,n)}h.prototype.decodePrimitive=function(e,t){var i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o){var h=T[c]||c.toLowerCase();a[h]=o[c]}for(c in e.attributes)if(h=T[c]||c.toLowerCase(),void 0!==o[c]){var u=i.accessors[e.attributes[c]],d=x[u.componentType];l[h]=d,s[h]=!0===u.normalized}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var i in e.attributes){var n=e.attributes[i],r=s[i];void 0!==r&&(n.normalized=r)}t(e)}),a,l)}))}))},u.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},f.prototype=Object.create(THREE.Interpolant.prototype),f.prototype.constructor=f,f.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n,o=0;o!==n;o++)t[o]=i[r+o];return t},f.prototype.beforeStart_=f.prototype.copySampleValue_,f.prototype.afterEnd_=f.prototype.copySampleValue_,f.prototype.interpolate_=function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=n-t,h=(i-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,m=-2*d+3*u,v=d-u,g=1-m,y=v-u+h,b=0;b!==a;b++){var A=o[f+b+a],w=o[f+b+s]*c,x=o[p+b+a],E=o[p+b]*c;r[b]=g*A+y*w+m*x+v*E}return r};var m=0,v=1,g=2,y=3,b=4,A=5,w=6,x={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},E={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},_={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},M={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},T={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},S={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},C={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},L="OPAQUE",R="MASK",D="BLEND",P={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function O(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function I(e,t,i){for(var n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function k(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function B(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length)for(e.morphTargetDictionary={},i=0,n=r.length;i<n;i++)e.morphTargetDictionary[r[i]]=i;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function N(e){for(var t="",i=Object.keys(e).sort(),n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function F(e,i,n){this.json=e||{},this.extensions=i||{},this.options=n||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function H(e,t,i){var n=t.attributes,r=[];function o(t,n){return i.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(var a in n){var s=T[a]||a.toLowerCase();s in e.attributes||r.push(o(n[a],s))}if(void 0!==t.indices&&!e.index){var l=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(l)}return k(e,t),function(e,t,i){var n=t.attributes,r=new THREE.Box3;if(void 0!==n.POSITION){var o=(u=i.json.accessors[n.POSITION]).min,a=u.max;r.set(new THREE.Vector3(o[0],o[1],o[2]),new THREE.Vector3(a[0],a[1],a[2]));var s=t.targets;if(void 0!==s)for(var l=new THREE.Vector3,c=0,h=s.length;c<h;c++){var u,d=s[c];void 0!==d.POSITION&&(o=(u=i.json.accessors[d.POSITION]).min,a=u.max,l.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),r.expandByVector(l))}e.boundingBox=r;var p=new THREE.Sphere;r.getCenter(p.center),p.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=p}}(e,t,i),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,i){for(var n=!1,r=!1,o=0,a=t.length;o<a&&(void 0!==(c=t[o]).POSITION&&(n=!0),void 0!==c.NORMAL&&(r=!0),!n||!r);o++);if(!n&&!r)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var c=t[o];if(n){var h=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;s.push(h)}r&&(h=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(h))}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var i=t[0],o=t[1];return n&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}function U(e,t){var i=e.getIndex();if(null===i){var n=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<r.count;o++)n.push(o);e.setIndex(n),i=e.getIndex()}var a=i.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(o=1;o<=a;o++)s.push(i.getX(0)),s.push(i.getX(o)),s.push(i.getX(o+1));else for(o=0;o<a;o++)o%2==0?(s.push(i.getX(o)),s.push(i.getX(o+1)),s.push(i.getX(o+2))):(s.push(i.getX(o+2)),s.push(i.getX(o+1)),s.push(i.getX(o)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}return F.prototype.parse=function(e,t){var i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var o={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};I(r,o,n),k(o,n);for(let e in n)if("meshes"!=e&&"materials"!=e&&"nodes"!=e)delete n[e];else if("meshes"==e){for(let t=0;t<n[e].length;t++)if(n[e][t].primitives)for(let i=0;i<n[e][t].primitives.length;i++)n[e][t].primitives[i].attributes&&delete n[e][t].primitives[i].attributes}else if("materials"==e);else if("nodes"==e)for(let t=0;t<n[e].length;t++)for(let i in n[e][t])"mesh"!=i&&"name"!=i&&delete n[e][t][i];o.scene.ModelJson=n,o.scenes.ModelJson=n,e(o)})).catch(t)},F.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],n={},r={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var h=0,u=e.length;h<u;h++){var d=e[h];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=r[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(i[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=r},F.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this.loadMesh(t);break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this.loadBufferView(t);break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this.loadMaterial(t);break;case"texture":r=this.loadTexture(t);break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[i.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},F.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return i.getDependency(e,n)}))),this.cache.add(e,t)}return t},F.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,i){n.load(O(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},F.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)}))},F.prototype.loadAccessor=function(e){var t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then((function(e){var r,o,a=e[0],s=M[n.type],l=x[n.componentType],c=l.BYTES_PER_ELEMENT,h=c*s,u=n.byteOffset||0,d=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,p=!0===n.normalized;if(d&&d!==h){var f=Math.floor(u/d),m="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+f+":"+n.count,v=t.cache.get(m);v||(r=new l(a,f*d,n.count*d/c),v=new THREE.InterleavedBuffer(r,d/c),t.cache.add(m,v)),o=new THREE.InterleavedBufferAttribute(v,s,u%d/c,p)}else r=null===a?new l(n.count*s):new l(a,u,n.count*s),o=new THREE.BufferAttribute(r,s,p);if(void 0!==n.sparse){var g=M.SCALAR,y=x[n.sparse.indices.componentType],b=n.sparse.indices.byteOffset||0,A=n.sparse.values.byteOffset||0,w=new y(e[1],b,n.sparse.count*g),E=new l(e[2],A,n.sparse.count*s);null!==a&&(o=new THREE.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var _=0,T=w.length;_<T;_++){var S=w[_];if(o.setX(S,E[_*s]),s>=2&&o.setY(S,E[_*s+1]),s>=3&&o.setZ(S,E[_*s+2]),s>=4&&o.setW(S,E[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},F.prototype.loadTexture=function(e){var t,n=this,r=this.json,o=this.options,a=this.textureLoader,s=window.URL||window.webkitURL,l=r.textures[e],c=l.extensions||{},h=(t=c[i.MSFT_TEXTURE_DDS]?r.images[c[i.MSFT_TEXTURE_DDS].source]:r.images[l.source]).uri,u=!1;return void 0!==t.bufferView&&(h=n.getDependency("bufferView",t.bufferView).then((function(e){u=!0;var i=new Blob([e],{type:t.mimeType});return{suri:h=s.createObjectURL(i),bufferView:e}}))),Promise.resolve(h).then((function(e){let r=e.suri;var s=o.manager.getHandler(r);s||(s=c[i.MSFT_TEXTURE_DDS]?n.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:a);let l=!1,h="";switch(t.mimeType){case"image/jpeg":case"image/jpg":case"jpg":case"jpeg":console.log("GLTFParser: _loadTexture: _mimeType jpg: ",t),h="jpg";break;case"image/png":case"png":console.log("GLTFParser: _loadTexture: _mimeType png: ",t),h="png";break;case"image/tga":case"tga":console.log("GLTFParser: _loadTexture: _mimeType tga: ",t),h="tga";break;case"image/bmp":case"bmp":console.log("GLTFParser: _loadTexture: _mimeType bmp: ",t),h="bmp";break;default:console.log("GLTFParser: _loadTexture: _mimeType default: ",t),l=!0}return new Promise((function(t,i){let n=new THREE.TGALoader(o.manager),a=function(e,t,i,n){let r=new Image;r.onload=function(){let e=new THREE.Texture;e.image=r,t(e)},r.onerror=n,r.src=e,window.blobUrl=e};if(1==l){let l=e.bufferView;let c=new Uint8Array(l),h=O(r,o.path);console.log(" aaaaaaaa ",c,r,o,h),c.length<10||255!=c[0]||246!=c[1]?function(e){return!(e.length<10)&&137==e[0]&&80==e[1]&&78==e[1]&&71==e[1]}(c)?(console.log(" ****** detect PNG "),s.load(O(r,o.path),t,void 0,i)):n.checkHeaderByBuffer(c)?(console.log(" ****** detect TGA "),n.load(O(r,o.path),t,void 0,i)):function(e){return!(e.length<10)&&66==e[0]&&77==e[1]}(c)?(console.log(" ****** detect BMP "),a(O(r,o.path),t,0,i)):(console.log(" ****** detect nothing "),n.load(O(r,o.path),t,void 0,i)):(console.log(" ****** detect JPG "),s.load(O(r,o.path),t,void 0,i))}else switch(h){case"png":case"jpg":s.load(O(r,o.path),t,void 0,i);break;case"tga":default:n.load(O(r,o.path),t,void 0,i);break;case"bmp":a(O(r,o.path),t,0,i)}}))})).then((function(e){!0===u&&s.revokeObjectURL(h),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in P&&(e.format=P[t.mimeType]);var i=(r.samplers||{})[l.sampler]||{};return e.magFilter=E[i.magFilter]||THREE.LinearFilter,e.minFilter=E[i.minFilter]||THREE.LinearMipmapLinearFilter,e.wrapS=_[i.wrapS]||THREE.RepeatWrapping,e.wrapT=_[i.wrapT]||THREE.RepeatWrapping,e})).catch((function(){return console.error("GLTFLoader: Couldn't load texture",h),null}))},F.prototype.assignTexture=function(e,t,n){var r=this;return this.getDependency("texture",n.index).then((function(o){if(o&&!o.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":o.format=THREE.RGBFormat}if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[i.KHR_TEXTURE_TRANSFORM]){var a=void 0!==n.extensions?n.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;a&&(o=r.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(o,a))}e[t]=o}))},F.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=this.extensions,o=void 0!==t.attributes.tangent,a=void 0!==t.attributes.color,s=void 0===t.attributes.normal,l=!0===e.isSkinnedMesh,c=Object.keys(t.morphAttributes).length>0,h=c&&void 0!==t.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+n.uuid,d=this.cache.get(u);d||(d=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(d,n),d.color.copy(n.color),d.map=n.map,d.sizeAttenuation=!1,this.cache.add(u,d)),n=d}else if(e.isLine){u="LineBasicMaterial:"+n.uuid;var p=this.cache.get(u);p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(u,p)),n=p}if(o||a||s||l||c){u="ClonedMaterial:"+n.uuid+":",n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),l&&(u+="skinning:"),o&&(u+="vertex-tangents:"),a&&(u+="vertex-colors:"),s&&(u+="flat-shading:"),c&&(u+="morph-targets:"),h&&(u+="morph-normals:");var f=this.cache.get(u);f||(f=n.isGLTFSpecularGlossinessMaterial?r[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(n):n.clone(),l&&(f.skinning=!0),o&&(f.vertexTangents=!0),a&&(f.vertexColors=THREE.VertexColors),s&&(f.flatShading=!0),c&&(f.morphTargets=!0),h&&(f.morphNormals=!0),this.cache.add(u,f)),n=f}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2)),n.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=r[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=n},F.prototype.loadMaterial=function(e){var t,n=this,r=this.json,o=this.extensions,a=r.materials[e],s={},l=a.extensions||{},c=[];if(l[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=o[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(s,a,n))}else if(l[i.KHR_MATERIALS_UNLIT]){var u=o[i.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),c.push(u.extendParams(s,a,n))}else{t=THREE.MeshStandardMaterial;var d=a.pbrMetallicRoughness||{};if(s.color=new THREE.Color(1,1,1),s.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;s.color.fromArray(p),s.opacity=p[3]}void 0!==d.baseColorTexture&&c.push(n.assignTexture(s,"map",d.baseColorTexture)),s.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,s.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(n.assignTexture(s,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(s,"roughnessMap",d.metallicRoughnessTexture)))}!0===a.doubleSided&&(s.side=THREE.DoubleSide);var f=a.alphaMode||L;return f===D?s.transparent=!0:(s.transparent=!1,f===R&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==THREE.MeshBasicMaterial&&(c.push(n.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new THREE.Vector2(1,1),void 0!==a.normalTexture.scale&&s.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(c.push(n.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(s.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==THREE.MeshBasicMaterial&&c.push(n.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(c).then((function(){var n;return n=t===THREE.ShaderMaterial?o[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),void 0!==a.name&&(n.name=a.name),n.name+="_"+e,n.map&&(n.map.encoding=THREE.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=THREE.sRGBEncoding),n.specularMap&&(n.specularMap.encoding=THREE.sRGBEncoding),k(n,a),a.extensions&&I(o,n,a),n}))},F.prototype.loadGeometries=function(e){var t,n,r=this,o=this.extensions,a=this.primitiveCache;function s(e){return o[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then((function(t){return H(t,e,r)}))}for(var l=[],c=0,h=e.length;c<h;c++){var u,d=e[c],p=(n=void 0,(n=(t=d).extensions&&t.extensions[i.KHR_DRACO_MESH_COMPRESSION])?"draco:"+n.bufferView+":"+n.indices+":"+N(n.attributes):t.indices+":"+N(t.attributes)+":"+t.mode),f=a[p];f?l.push(f.promise):(u=d.extensions&&d.extensions[i.KHR_DRACO_MESH_COMPRESSION]?s(d):H(new THREE.BufferGeometry,d,r),a[p]={primitive:d,promise:u},l.push(u))}return Promise.all(l)},F.prototype.loadMesh=function(e){for(var t=this,i=this.json.meshes[e],n=i.primitives,r=[],o=0,a=n.length;o<a;o++){var s=void 0===n[o].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),l.DefaultMaterial):this.getDependency("material",n[o].material);r.push(s)}var l;return Promise.all(r).then((function(r){return t.loadGeometries(n).then((function(o){for(var a=[],s=0,l=o.length;s<l;s++){var c,h=o[s],u=n[s],d=r[s];if(u.mode===b||u.mode===A||u.mode===w||void 0===u.mode)!0!==(c=!0===i.isSkinnedMesh?new THREE.SkinnedMesh(h,d):new THREE.Mesh(h,d)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),u.mode===A?c.geometry=U(c.geometry,THREE.TriangleStripDrawMode):u.mode===w&&(c.geometry=U(c.geometry,THREE.TriangleFanDrawMode));else if(u.mode===v)c=new THREE.LineSegments(h,d);else if(u.mode===y)c=new THREE.Line(h,d);else if(u.mode===g)c=new THREE.LineLoop(h,d);else{if(u.mode!==m)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);c=new THREE.Points(h,d)}Object.keys(c.geometry.morphAttributes).length>0&&B(c,i),c.name=i.name||"mesh_"+e,c.meshIdx=e,o.length>1&&(c.name+="_"+s),k(c,i),t.assignFinalMaterial(c),a.push(c)}if(1===a.length)return a[0];var p=new THREE.Group;for(s=0,l=a.length;s<l;s++)p.add(a[s]);return p}))}))},F.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new THREE.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==i.name&&(t.name=i.name),k(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},F.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))},F.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],n=[],r=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var c=t.channels[s],h=t.samplers[c.sampler],u=c.target,d=void 0!==u.node?u.node:u.id,p=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;i.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",p)),r.push(this.getDependency("accessor",m)),o.push(h),a.push(u)}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(a)]).then((function(i){for(var n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=[],c=0,h=n.length;c<h;c++){var u=n[c],d=r[c],p=o[c],m=a[c],v=s[c];if(void 0!==u){var g;switch(u.updateMatrix(),u.matrixAutoUpdate=!0,S[v.path]){case S.weights:g=THREE.NumberKeyframeTrack;break;case S.rotation:g=THREE.QuaternionKeyframeTrack;break;default:g=THREE.VectorKeyframeTrack}var y=u.name?u.name:u.uuid,b=void 0!==m.interpolation?C[m.interpolation]:THREE.InterpolateLinear,A=[];S[v.path]===S.weights?u.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&A.push(e.name?e.name:e.uuid)})):A.push(y);var w=p.array;if(p.normalized){var x;if(w.constructor===Int8Array)x=1/127;else if(w.constructor===Uint8Array)x=1/255;else if(w.constructor==Int16Array)x=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");x=1/65535}for(var E=new Float32Array(w.length),_=0,M=w.length;_<M;_++)E[_]=w[_]*x;w=E}for(_=0,M=A.length;_<M;_++){var T=new g(A[_]+"."+S[v.path],d.array,w,b);"CUBICSPLINE"===m.interpolation&&(T.createInterpolant=function(e){return new f(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(T)}}}var L=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(L,void 0,l)}))},F.prototype.loadNode=function(e){var t,n=this.json,r=this.extensions,o=this,a=n.meshReferences,s=n.meshUses,l=n.nodes[e];return(t=[],void 0!==l.mesh&&t.push(o.getDependency("mesh",l.mesh).then((function(e){var t;if(a[l.mesh]>1){var i=s[l.mesh]++;(t=e.clone()).name+="_instance_"+i,t.onBeforeRender=e.onBeforeRender;for(var n=0,r=t.children.length;n<r;n++)t.children[n].name+="_instance_"+i,t.children[n].onBeforeRender=e.children[n].onBeforeRender}else t=e;return void 0!==l.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,i=l.weights.length;t<i;t++)e.morphTargetInfluences[t]=l.weights[t]})),t}))),void 0!==l.camera&&t.push(o.getDependency("camera",l.camera)),l.extensions&&l.extensions[i.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[i.KHR_LIGHTS_PUNCTUAL].light&&t.push(o.getDependency("light",l.extensions[i.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(e){var t;if((t=!0===l.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(var i=0,n=e.length;i<n;i++)t.add(e[i]);if(void 0!==l.name&&(t.userData.name=l.name,t.name=THREE.PropertyBinding.sanitizeNodeName(l.name)),k(t,l),l.extensions&&I(r,t,l),void 0!==l.matrix){var o=new THREE.Matrix4;o.fromArray(l.matrix),t.applyMatrix(o)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return t}))},F.prototype.loadScene=function(){function e(t,i,n,r){var o=n.nodes[t];return r.getDependency("node",t).then((function(e){return void 0===o.skin?e:r.getDependency("skin",o.skin).then((function(e){for(var i=[],n=0,o=(t=e).joints.length;n<o;n++)i.push(r.getDependency("node",t.joints[n]));return Promise.all(i)})).then((function(i){return e.traverse((function(e){if(e.isMesh){for(var n=[],r=[],o=0,a=i.length;o<a;o++){var s=i[o];if(s){n.push(s);var l=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*o),r.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new THREE.Skeleton(n,r),e.matrixWorld)}})),e}));var t})).then((function(t){i.add(t);var a=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var h=s[l];a.push(e(h,t,n,r))}return Promise.all(a)}))}return function(t){var i=this.json,n=this.extensions,r=this.json.scenes[t],o=new THREE.Scene;void 0!==r.name&&(o.name=r.name),k(o,r),r.extensions&&I(n,o,r);for(var a=r.nodes||[],s=[],l=0,c=a.length;l<c;l++)s.push(e(a[l],o,i,this));return Promise.all(s).then((function(){return o}))}}(),e}()},{}],40:[function(e,t,i){THREE.MTLLoader=function(e){THREE.Loader.call(this,e)},THREE.MTLLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.MTLLoader,load:function(e,t,i,n){var r=this,o=""===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.load(e,(function(e){t(r.parse(e,o))}),i,n)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var i=e.split("\n"),n={},r=/\s+/,o={},a=0;a<i.length;a++){var s=i[a];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),c=l>=0?s.substring(0,l):s;c=c.toLowerCase();var h=l>=0?s.substring(l+1):"";if(h=h.trim(),"newmtl"===c)n={name:h},o[h]=n;else if("ka"===c||"kd"===c||"ks"===c||"ke"===c){var u=h.split(r,3);n[c]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else n[c]=h}}var d=new THREE.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(o),d}}),THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var n=e[i],r={};for(var o in t[i]=r,n){var a=!0,s=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1)}a&&(r[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],n={name:e,side:this.side};function r(e,i){if(!n[e]){var r=t.getTextureParams(i,n),o=t.loadTexture((a=t.baseUrl,"string"!=typeof(s=r.url)||""===s?"":/^https?:\/\//i.test(s)?s:a+s));o.repeat.copy(r.scale),o.offset.copy(r.offset),o.wrapS=t.wrap,o.wrapT=t.wrap,n[e]=o}var a,s}for(var o in i){var a,s=i[o];if(""!==s)switch(o.toLowerCase()){case"kd":n.color=(new THREE.Color).fromArray(s);break;case"ks":n.specular=(new THREE.Color).fromArray(s);break;case"ke":n.emissive=(new THREE.Color).fromArray(s);break;case"map_kd":r("map",s);break;case"map_ks":r("specularMap",s);break;case"map_ke":r("emissiveMap",s);break;case"norm":r("normalMap",s);break;case"map_bump":case"bump":r("bumpMap",s);break;case"map_d":r("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(a=parseFloat(s))<1&&(n.opacity=a,n.transparent=!0);break;case"tr":a=parseFloat(s),this.options&&this.options.invertTrProperty&&(a=1-a),a>0&&(n.opacity=1-a,n.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var i,n={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},r=e.split(/\s+/);return(i=r.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),(i=r.indexOf("-s"))>=0&&(n.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),(i=r.indexOf("-o"))>=0&&(n.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),n.url=r.join(" ").trim(),n},loadTexture:function(e,t,i,n,r){var o,a=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager,s=a.getHandler(e);return null===s&&(s=new THREE.TextureLoader(a)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),o=s.load(e,i,n,r),void 0!==t&&(o.mapping=t),o}}},{}],41:[function(e,t,i){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /,n=/^usemap /;function r(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var n=this.vertices,r=this.object.geometry.vertices;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var n=this.normals,r=this.object.geometry.normals;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addColor:function(e,t,i){var n=this.colors,r=this.object.geometry.colors;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){var n=this.uvs,r=this.object.geometry.uvs;r.push(n[e+0],n[e+1]),r.push(n[t+0],n[t+1]),r.push(n[i+0],n[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,r,o,a,s,l){var c=this.vertices.length,h=this.parseVertexIndex(e,c),u=this.parseVertexIndex(t,c),d=this.parseVertexIndex(i,c);if(this.addVertex(h,u,d),this.colors.length>0&&this.addColor(h,u,d),void 0!==n&&""!==n){var p=this.uvs.length;h=this.parseUVIndex(n,p),u=this.parseUVIndex(r,p),d=this.parseUVIndex(o,p),this.addUV(h,u,d)}if(void 0!==a&&""!==a){var f=this.normals.length;h=this.parseNormalIndex(a,f),u=a===s?h:this.parseNormalIndex(s,f),d=a===l?h:this.parseNormalIndex(l,f),this.addNormal(h,u,d)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,n=e.length;i<n;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,n=this.uvs.length,r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],n))}};return e.startObject("",!1),e}function o(e){THREE.Loader.call(this,e),this.materials=null}return o.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:o,load:function(e,t,i,n){var r=this,o=new THREE.FileLoader(r.manager);o.setPath(this.path),o.load(e,(function(e){t(r.parse(e))}),i,n)},setMaterials:function(e){return this.materials=e,this},parse:function(o){console.time("OBJLoader");var a=new r;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var s=o.split("\n"),l="",c="",h=[],u="function"==typeof"".trimLeft,d=0,p=s.length;d<p;d++)if(l=s[d],0!==(l=u?l.trimLeft():l.trim()).length&&"#"!==(c=l.charAt(0)))if("v"===c){var f=l.split(/\s+/);switch(f[0]){case"v":a.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7&&a.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]));break;case"vn":a.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":a.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===c){for(var m=l.substr(1).trim().split(/\s+/),v=[],g=0,y=m.length;g<y;g++){var b=m[g];if(b.length>0){var A=b.split("/");v.push(A)}}var w=v[0];for(g=1,y=v.length-1;g<y;g++){var x=v[g],E=v[g+1];a.addFace(w[0],x[0],E[0],w[1],x[1],E[1],w[2],x[2],E[2])}}else if("l"===c){var _=l.substring(1).trim().split(" "),M=[],T=[];if(-1===l.indexOf("/"))M=_;else for(var S=0,C=_.length;S<C;S++){var L=_[S].split("/");""!==L[0]&&M.push(L[0]),""!==L[1]&&T.push(L[1])}a.addLineGeometry(M,T)}else if("p"===c){var R=l.substr(1).trim().split(" ");a.addPointGeometry(R)}else if(null!==(h=e.exec(l))){var D=(" "+h[0].substr(1).trim()).substr(1);a.startObject(D)}else if(i.test(l))a.object.startMaterial(l.substring(7).trim(),a.materialLibraries);else if(t.test(l))a.materialLibraries.push(l.substring(7).trim());else if(n.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else{if("s"!==c){if("\0"===l)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+l+'"')}if((h=l.split(" ")).length>1){var P=h[1].trim().toLowerCase();a.object.smooth="0"!==P&&"off"!==P}else a.object.smooth=!0;(q=a.object.currentMaterial())&&(q.smooth=a.object.smooth)}a.finalize();var O=new THREE.Group;for(O.materialLibraries=[].concat(a.materialLibraries),d=0,p=a.objects.length;d<p;d++){var I=a.objects[d],k=I.geometry,B=I.materials,N="Line"===k.type,F="Points"===k.type,H=!1;if(0!==k.vertices.length){var U=new THREE.BufferGeometry;U.setAttribute("position",new THREE.Float32BufferAttribute(k.vertices,3)),k.normals.length>0?U.setAttribute("normal",new THREE.Float32BufferAttribute(k.normals,3)):U.computeVertexNormals(),k.colors.length>0&&(H=!0,U.setAttribute("color",new THREE.Float32BufferAttribute(k.colors,3))),k.uvs.length>0&&U.setAttribute("uv",new THREE.Float32BufferAttribute(k.uvs,2));for(var j,z=[],G=0,V=B.length;G<V;G++){var W=B[G],q=void 0;if(null!==this.materials)if(q=this.materials.create(W.name),!N||!q||q instanceof THREE.LineBasicMaterial){if(F&&q&&!(q instanceof THREE.PointsMaterial)){var X=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(X,q),X.color.copy(q.color),X.map=q.map,q=X}}else{var Y=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(Y,q),Y.color.copy(q.color),q=Y}q||((q=N?new THREE.LineBasicMaterial:F?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=W.name),q.flatShading=!W.smooth,q.vertexColors=H?THREE.VertexColors:THREE.NoColors,z.push(q)}if(z.length>1){for(G=0,V=B.length;G<V;G++)W=B[G],U.addGroup(W.groupStart,W.groupCount,G);j=N?new THREE.LineSegments(U,z):F?new THREE.Points(U,z):new THREE.Mesh(U,z)}else j=N?new THREE.LineSegments(U,z[0]):F?new THREE.Points(U,z[0]):new THREE.Mesh(U,z[0]);j.name=I.name,O.add(j)}}return console.timeEnd("OBJLoader"),O}}),o}()},{}],42:[function(e,t,i){var n=e("layout-bmfont-text"),r=e("inherits"),o=e("quad-indices"),a=e("three-buffer-vertex-data"),s=e("object-assign"),l=e("./lib/vertices"),c=e("./lib/utils"),h=THREE.BufferGeometry;function u(e){h.call(this),"string"==typeof e&&(e={text:e}),this._opt=s({},e),e&&this.update(e)}t.exports=function(e){return new u(e)},r(u,h),u.prototype.genLayout=function(e){return n(e)},u.prototype.updateForSpace=function(e){var t=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0})),i=!1!==this.layout._opt.flipY,n=this.layout._opt.font.common.scaleW,r=this.layout._opt.font.common.scaleH,s=l.positions(t),c=l.uvs(t,n,r,i),h=o({clockwise:!0,type:"uint16",count:t.length});console.log(" *** 1 _TextGeometry: _updateForSpace: positions=",s,t,e);for(let i=0,n=t.length;i<n;i++){let n=e[t[i].index];n&&t[i]&&t[i].data&&Number.isFinite(t[i].data.xoffset)&&Number.isFinite(t[i].data.width)&&(s[8*i+0]=n+t[i].data.xoffset,s[8*i+2]=n+t[i].data.xoffset,s[8*i+4]=n+t[i].data.xoffset+t[i].data.width,s[8*i+6]=n+t[i].data.xoffset+t[i].data.width)}console.log(" *** 2 _TextGeometry: _updateForSpace: positions=",s),a.index(this,h,1,"uint16"),a.attr(this,"position",s,2),a.attr(this,"uv",c,2)},u.prototype.update=function(e){if("string"==typeof e&&(e={text:e}),!(e=s({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=n(e);var t=!1!==e.flipY,i=e.font,r=i.common.scaleW,c=i.common.scaleH,h=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0}));this.visibleGlyphs=h;var u=l.positions(h);console.log("1. _TextGeometry.prototype.update_: ",u);var d=l.uvs(h,r,c,t),p=o({clockwise:!0,type:"uint16",count:h.length});if(a.index(this,p,1,"uint16"),a.attr(this,"position",u,2),a.attr(this,"uv",d,2),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var f=l.pages(h);a.attr(this,"page",f,1)}e.offsetWidths&&this.updateForSpace(e.offsetWidths)},u.prototype.computeBoundingSphere=function(){if(null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),!this.attributes.position)return this.boundingSphere.radius=1,void this.boundingSphere.center.set(0,0,0);var e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);c.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')},u.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.boundingBox,t=this.attributes.position.array,i=this.attributes.position.itemSize;!t||!i||t.length<2?e.makeEmpty():c.computeBox(t,e)}},{"./lib/utils":43,"./lib/vertices":44,inherits:19,"layout-bmfont-text":24,"object-assign":27,"quad-indices":35,"three-buffer-vertex-data":45}],43:[function(e,t,i){var n={min:[0,0],max:[0,0]};function r(e){var t=e.length/2;n.min[0]=e[0],n.min[1]=e[1],n.max[0]=e[0],n.max[1]=e[1];for(var i=0;i<t;i++){var r=e[2*i+0],o=e[2*i+1];n.min[0]=Math.min(r,n.min[0]),n.min[1]=Math.min(o,n.min[1]),n.max[0]=Math.max(r,n.max[0]),n.max[1]=Math.max(o,n.max[1])}}t.exports.computeBox=function(e,t){r(e),t.min.set(n.min[0],n.min[1],0),t.max.set(n.max[0],n.max[1],0)},t.exports.computeSphere=function(e,t){r(e);var i=n.min[0],o=n.min[1],a=n.max[0]-i,s=n.max[1]-o,l=Math.sqrt(a*a+s*s);t.center.set(i+a/2,o+s/2,0),t.radius=l/2}},{}],44:[function(e,t,i){t.exports.pages=function(e){var t=new Float32Array(4*e.length*1),i=0;return e.forEach((function(e){var n=e.data.page||0;t[i++]=n,t[i++]=n,t[i++]=n,t[i++]=n})),t},t.exports.uvs=function(e,t,i,n){var r=new Float32Array(4*e.length*2),o=0;return e.forEach((function(e){var a=e.data,s=a.x+a.width,l=a.y+a.height,c=a.x/t,h=a.y/i,u=s/t,d=l/i;n&&(h=(i-a.y)/i,d=(i-l)/i),r[o++]=c,r[o++]=h,r[o++]=c,r[o++]=d,r[o++]=u,r[o++]=d,r[o++]=u,r[o++]=h})),r},t.exports.positions=function(e){var t=new Float32Array(4*e.length*2),i=0;return e.forEach((function(e){var n=e.data,r=e.position[0]+n.xoffset,o=e.position[1]+n.yoffset,a=n.width,s=n.height;t[i++]=r,t[i++]=o,t[i++]=r,t[i++]=o+s,t[i++]=r+a,t[i++]=o+s,t[i++]=r+a,t[i++]=o})),t}},{}],45:[function(e,t,i){var n=e("flatten-vertex-data");function r(e,t,i,r){return t=n(t=t||[],r),(e=new THREE.BufferAttribute(t,i)).itemSize=i,e.needsUpdate=!0,e}t.exports.attr=function(e,t,i,n,o){if("number"!=typeof n&&(n=3),"string"!=typeof o&&(o="float32"),Array.isArray(i)&&Array.isArray(i[0])&&i[0].length!==n)throw new Error("Nested vertex array has unexpected size; expected "+n+" but found "+i[0].length);var a=r(e.getAttribute(t),i,n,o);e.setAttribute(t,a)},t.exports.index=function(e,t,i,n){"number"!=typeof i&&(i=1),"string"!=typeof n&&(n="uint16");var o=!e.index&&"function"!=typeof e.setIndex,a=r(o?e.getAttribute("index"):e.index,t,i,n);a&&(o?e.addAttribute("index",a):e.index=a)}},{"flatten-vertex-data":15}],46:[function(e,t,i){(function(t,n){var r=e("process/browser.js").nextTick,o=Function.prototype.apply,a=Array.prototype.slice,s={},l=0;function c(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new c(o.call(setTimeout,window,arguments),clearTimeout)},i.setInterval=function(){return new c(o.call(setInterval,window,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},i.setImmediate="function"==typeof t?t:function(e){var t=l++,n=!(arguments.length<2)&&a.call(arguments,1);return s[t]=!0,r((function(){s[t]&&(n?e.apply(null,n):e.call(null),i.clearImmediate(t))})),t},i.clearImmediate="function"==typeof n?n:function(e){delete s[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":47,timers:46}],47:[function(e,t,i){arguments[4][5][0].apply(i,arguments)},{dup:5}],48:[function(e,t,i){(i=t.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},i.right=function(e){return e.replace(/\s*$/,"")}},{}],49:[function(e,t,i){(function(e){!function(e,n){"object"==typeof i&&void 0!==t?t.exports=n():e.WebVRPolyfill=n()}(this,(function(){"use strict";var t="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};var i,n=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)||navigator.maxTouchPoints>1},r=function(e,t){for(var i=0,n=e.length;i<n;i++)t[i]=e[i]},o=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},a=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,i){var n;n=function(){var e,i,n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(e,t,i){return e+(t-e)*i},s=function(){var e=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),l=function(){var e=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return e}}(),c=(/^((?!chrome|android).)*safari/i.test(navigator.userAgent),function(){var e=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return e}}()),h=(e=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),i=e?parseInt(e[1],10):null,function(){return i}),u=function(){var e=!1;if(65===h()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var i=t[1].split("."),n=o(i,4),r=(n[0],n[1],n[2]),a=n[3];e=3325===parseInt(r,10)&&parseInt(a,10)<148}}return function(){return e}}(),d=function(){var e=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return e}}(),p=function(){var e=90==window.orientation||-90==window.orientation;return d()?!e:e},f=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},m=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},v=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},g=function(e,t,i,n){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t),e.compileShader(r);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,i),e.compileShader(o);var a=e.createProgram();for(var s in e.attachShader(a,r),e.attachShader(a,o),n)e.bindAttribLocation(a,n[s],s);return e.linkProgram(a),e.deleteShader(r),e.deleteShader(o),a},y=function(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r="",o=0;o<n;o++)i[r=e.getActiveUniform(t,o).name.replace("[0]","")]=e.getUniformLocation(t,r);return i},b=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),navigator.maxTouchPoints>1&&(t=!0),t},A=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},w=function(e){if(s()){var t=e.style.width,i=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(i)+"px",setTimeout((function(){e.style.width=t,e.style.height=i}),100)}window.canvas=e},x=function(){var e=Math.PI/180,t=.25*Math.PI;var i=new Float32Array([0,0,0,1]),n=new Float32Array([0,0,0]);function r(r,o,a,s,l,c){var h,u,d,p,f,m,v,g,y,b,A,w,x,E,_,M,T,S,C;(function(i,n,r,o){var a=Math.tan(n?n.upDegrees*e:t),s=Math.tan(n?n.downDegrees*e:t),l=Math.tan(n?n.leftDegrees*e:t),c=Math.tan(n?n.rightDegrees*e:t),h=2/(l+c),u=2/(a+s);i[0]=h,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=-(l-c)*h*.5,i[9]=(a-s)*u*.5,i[10]=o/(r-o),i[11]=-1,i[12]=0,i[13]=0,i[14]=o*r/(r-o),i[15]=0})(r,s||null,c.depthNear,c.depthFar),h=o,u=a.orientation||i,d=a.position||n,p=u[0],f=u[1],m=u[2],v=u[3],A=p*(g=p+p),w=p*(y=f+f),x=p*(b=m+m),E=f*y,_=f*b,M=m*b,T=v*g,S=v*y,C=v*b,h[0]=1-(E+M),h[1]=w+C,h[2]=x-S,h[3]=0,h[4]=w-C,h[5]=1-(A+M),h[6]=_+T,h[7]=0,h[8]=x+S,h[9]=_-T,h[10]=1-(A+E),h[11]=0,h[12]=d[0],h[13]=d[1],h[14]=d[2],h[15]=1,l&&function(e,t,i){var n,r,o,a,s,l,c,h,u,d,p,f,m=i[0],v=i[1],g=i[2];t===e?(e[12]=t[0]*m+t[4]*v+t[8]*g+t[12],e[13]=t[1]*m+t[5]*v+t[9]*g+t[13],e[14]=t[2]*m+t[6]*v+t[10]*g+t[14],e[15]=t[3]*m+t[7]*v+t[11]*g+t[15]):(n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=n,e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+s*v+u*g+t[12],e[13]=r*m+l*v+d*g+t[13],e[14]=o*m+c*v+p*g+t[14],e[15]=a*m+h*v+f*g+t[15])}(o,o,l),function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],v=t[14],g=t[15],y=i*s-n*a,b=i*l-r*a,A=i*c-o*a,w=n*l-r*s,x=n*c-o*s,E=r*c-o*l,_=h*m-u*f,M=h*v-d*f,T=h*g-p*f,S=u*v-d*m,C=u*g-p*m,L=d*g-p*v,R=y*L-b*C+A*S+w*T-x*M+E*_;R&&(R=1/R,e[0]=(s*L-l*C+c*S)*R,e[1]=(r*C-n*L-o*S)*R,e[2]=(m*E-v*x+g*w)*R,e[3]=(d*x-u*E-p*w)*R,e[4]=(l*T-a*L-c*M)*R,e[5]=(i*L-r*T+o*M)*R,e[6]=(v*A-f*E-g*b)*R,e[7]=(h*E-d*A+p*b)*R,e[8]=(a*C-s*T+c*_)*R,e[9]=(n*T-i*C-o*_)*R,e[10]=(f*x-m*A+g*y)*R,e[11]=(u*A-h*x-p*y)*R,e[12]=(s*M-a*S-l*_)*R,e[13]=(i*S-n*M+r*_)*R,e[14]=(m*b-f*w-v*y)*R,e[15]=(h*w-u*b+d*y)*R)}(o,o)}return function(e,t,i){return!(!e||!t||(e.pose=t,e.timestamp=t.timestamp,r(e.leftProjectionMatrix,e.leftViewMatrix,t,i._getFieldOfView("left"),i._getEyeOffset("left"),i),r(e.rightProjectionMatrix,e.rightViewMatrix,t,i._getFieldOfView("right"),i._getEyeOffset("right"),i),0))}}(),E=function(e){var t,i=e.indexOf("://");t=-1!==i?i+3:0;var n=e.indexOf("/",t);return-1===n&&(n=e.length),e.substring(0,n)},_=(n={},function(e,t){void 0===n[e]&&(console.warn("webvr-polyfill: "+t),n[e]=!0)}),M=function(e,t){_(e,e+" has been deprecated. This may not work on native WebVR displays. "+(t?"Please use "+t+" instead.":""))};var T=function(e,t,i){if(t){for(var n=[],r=null,o=0;o<t.length;++o)switch(a=t[o]){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:if((l=t[++o])<e.TEXTURE0||l>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),n.push(null,null);break}r||(r=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(l),n.push(e.getParameter(a),null);break;case e.ACTIVE_TEXTURE:r=e.getParameter(e.ACTIVE_TEXTURE),n.push(null);break;default:n.push(e.getParameter(a))}for(i(e),o=0;o<t.length;++o){var a=t[o],s=n[o];switch(a){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,s);break;case e.COLOR_CLEAR_VALUE:e.clearColor(s[0],s[1],s[2],s[3]);break;case e.COLOR_WRITEMASK:e.colorMask(s[0],s[1],s[2],s[3]);break;case e.CURRENT_PROGRAM:e.useProgram(s);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,s);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,s);break;case e.TEXTURE_BINDING_2D:if((l=t[++o])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_2D,s);break;case e.TEXTURE_BINDING_CUBE_MAP:var l;if((l=t[++o])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_CUBE_MAP,s);break;case e.VIEWPORT:e.viewport(s[0],s[1],s[2],s[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:s?e.enable(a):e.disable(a);break;default:console.log("No GL restore behavior for 0x"+a.toString(16))}r&&e.activeTexture(r)}}else i(e)},S=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),C=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function L(e,t,i,n){this.gl=e,this.cardboardUI=t,this.bufferScale=i,this.dirtySubmitFrameBindings=n,this.ctxAttribs=e.getContextAttributes(),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,s()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=g(e,S,C,this.attribs),this.uniforms=y(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}L.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},L.prototype.onResize=function(){var e=this.gl,t=this,i=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];T(e,i,(function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)})),this.cardboardUI&&this.cardboardUI.onResize()},L.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,i=this.gl;s()||(t.width=f()*this.bufferScale,t.height=m()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(i){e.bufferWidth=i,e.realCanvasWidth.set.call(t,i),e.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(i){e.bufferHeight=i,e.realCanvasHeight.set.call(t,i),e.onResize()}})),this.lastBoundFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,n){e.lastBoundFramebuffer=n||e.framebuffer,e.realBindFramebuffer.call(i,t,e.lastBoundFramebuffer)},this.cullFace=i.getParameter(i.CULL_FACE),this.depthTest=i.getParameter(i.DEPTH_TEST),this.blend=i.getParameter(i.BLEND),this.scissorTest=i.getParameter(i.SCISSOR_TEST),this.stencilTest=i.getParameter(i.STENCIL_TEST),i.enable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!0;break;case i.DEPTH_TEST:e.depthTest=!0;break;case i.BLEND:e.blend=!0;break;case i.SCISSOR_TEST:e.scissorTest=!0;break;case i.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(i,t)},i.disable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!1;break;case i.DEPTH_TEST:e.depthTest=!1;break;case i.BLEND:e.blend=!1;break;case i.SCISSOR_TEST:e.scissorTest=!1;break;case i.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(i,t)},this.colorMask=i.getParameter(i.COLOR_WRITEMASK),i.colorMask=function(t,n,r,o){e.colorMask[0]=t,e.colorMask[1]=n,e.colorMask[2]=r,e.colorMask[3]=o,e.realColorMask.call(i,t,n,r,o)},this.clearColor=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor=function(t,n,r,o){e.clearColor[0]=t,e.clearColor[1]=n,e.clearColor[2]=r,e.clearColor[3]=o,e.realClearColor.call(i,t,n,r,o)},this.viewport=i.getParameter(i.VIEWPORT),i.viewport=function(t,n,r,o){e.viewport[0]=t,e.viewport[1]=n,e.viewport[2]=r,e.viewport[3]=o,e.realViewport.call(i,t,n,r,o)},this.isPatched=!0,w(t)}},L.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;s()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout((function(){w(t)}),1)}},L.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},L.prototype.submitFrame=function(){var e=this.gl,t=this,i=[];if(this.dirtySubmitFrameBindings||i.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),T(e,i,(function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||s())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),!t.ctxAttribs.alpha&&t.ctxAttribs.preserveDrawingBuffer||t.realClearColor.apply(e,t.clearColor)})),s()){var n=e.canvas;n.width==t.bufferWidth&&n.height==t.bufferHeight||(t.bufferWidth=n.width,t.bufferHeight=n.height,t.onResize())}},L.prototype.updateDeviceInfo=function(e){var t=this.gl,i=this,n=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];T(t,n,(function(t){var n=i.computeMeshVertices_(i.meshWidth,i.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),!i.indexCount){var r=i.computeMeshIndices_(i.meshWidth,i.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),i.indexCount=r.length}}))},L.prototype.computeMeshVertices_=function(e,t,i){for(var n=new Float32Array(2*e*t*5),r=i.getLeftEyeVisibleTanAngles(),o=i.getLeftEyeNoLensTanAngles(),s=i.getLeftEyeVisibleScreenRect(o),l=0,c=0;c<2;c++){for(var h=0;h<t;h++)for(var u=0;u<e;u++,l++){var d=u/(e-1),p=h/(t-1),f=d,m=p,v=a(r[0],r[2],d),g=a(r[3],r[1],p),y=Math.sqrt(v*v+g*g),b=i.distortion.distortInverse(y),A=g*b/y;d=(v*b/y-o[0])/(o[2]-o[0]),p=(A-o[3])/(o[1]-o[3]),d=2*(s.x+d*s.width-.5),p=2*(s.y+p*s.height-.5),n[5*l+0]=d,n[5*l+1]=p,n[5*l+2]=f,n[5*l+3]=m,n[5*l+4]=c}var w=r[2]-r[0];r[0]=-(w+r[0]),r[2]=w-r[2],w=o[2]-o[0],o[0]=-(w+o[0]),o[2]=w-o[2],s.x=1-(s.x+s.width)}return n},L.prototype.computeMeshIndices_=function(e,t){for(var i=new Uint16Array(2*(e-1)*(t-1)*6),n=e/2,r=t/2,o=0,a=0,s=0;s<2;s++)for(var l=0;l<t;l++)for(var c=0;c<e;c++,o++)0!=c&&0!=l&&(c<=n==l<=r?(i[a++]=o,i[a++]=o-e-1,i[a++]=o-e,i[a++]=o-e-1,i[a++]=o,i[a++]=o-1):(i[a++]=o-1,i[a++]=o-e,i[a++]=o,i[a++]=o-e,i[a++]=o-1,i[a++]=o-e-1));return i},L.prototype.getOwnPropertyDescriptor_=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);return void 0!==i.get&&void 0!==i.set||(i.configurable=!0,i.enumerable=!0,i.get=function(){return this.getAttribute(t)},i.set=function(e){this.setAttribute(t,e)}),i};var R=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),D=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),P=Math.PI/180,O=.3125,I=28;function k(e){this.gl=e,this.attribs={position:0},this.program=g(e,R,D,this.attribs),this.uniforms=y(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function B(e){this.coefficients=e}k.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},k.prototype.listen=function(e,t){var i=this.gl.canvas;this.listener=function(n){var r=i.clientWidth/2;n.clientX>r-42&&n.clientX<r+42&&n.clientY>i.clientHeight-42?e(n):n.clientX<42&&n.clientY<42&&t(n)},i.addEventListener("click",this.listener,!1)},k.prototype.onResize=function(){var e=this.gl,t=this,i=[e.ARRAY_BUFFER_BINDING];T(e,i,(function(e){var i=[],n=e.drawingBufferWidth/2,r=Math.max(screen.width,screen.height)*window.devicePixelRatio,o=e.drawingBufferWidth/r*window.devicePixelRatio,a=4*o/2,s=42*o,l=I*o/2,c=14*o;function h(e,t){var r=(90-e)*P,o=Math.cos(r),a=Math.sin(r);i.push(O*o*l+n,O*a*l+l),i.push(t*o*l+n,t*a*l+l)}i.push(n-a,s),i.push(n-a,e.drawingBufferHeight),i.push(n+a,s),i.push(n+a,e.drawingBufferHeight),t.gearOffset=i.length/2;for(var u=0;u<=6;u++){var d=60*u;h(d,1),h(d+12,1),h(d+20,.75),h(d+40,.75),h(d+48,1)}function p(t,n){i.push(c+t,e.drawingBufferHeight-c-n)}t.gearVertexCount=i.length/2-t.gearOffset,t.arrowOffset=i.length/2;var f=a/Math.sin(45*P);p(0,l),p(l,0),p(l+f,f),p(f,l+f),p(f,l-f),p(0,l),p(l,2*l),p(l+f,2*l-f),p(f,l-f),p(0,l),p(f,l-a),p(I*o,l-a),p(f,l+a),p(I*o,l+a),t.arrowVertexCount=i.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW)}))},k.prototype.render=function(){var e=this.gl,t=this,i=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];T(e,i,(function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()}))},k.prototype.renderNoState=function(){var e,t,i,n,r,o,a,s,l,c,h=this.gl;h.useProgram(this.program),h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer),h.enableVertexAttribArray(this.attribs.position),h.vertexAttribPointer(this.attribs.position,2,h.FLOAT,!1,8,0),h.uniform4f(this.uniforms.color,1,1,1,1),e=this.projMat,t=0,i=h.drawingBufferWidth,n=0,r=h.drawingBufferHeight,s=1/(t-i),l=1/(n-r),c=1/((o=.1)-(a=1024)),e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(r+n)*l,e[14]=(a+o)*c,e[15]=1,h.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),h.drawArrays(h.TRIANGLE_STRIP,0,4),h.drawArrays(h.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),h.drawArrays(h.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},B.prototype.distortInverse=function(e){for(var t=0,i=1,n=e-this.distort(t);Math.abs(i-t)>1e-4;){var r=e-this.distort(i),o=i-r*((i-t)/(r-n));t=i,i=o,n=r}return i},B.prototype.distort=function(e){for(var t=e*e,i=0,n=0;n<this.coefficients.length;n++)i=t*(i+this.coefficients[n]);return(i+1)*e};var N=Math.PI/180,F=180/Math.PI,H=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};H.prototype={constructor:H,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*i,c=s*i+a*t-r*n,h=s*n+r*i-o*t,u=-r*t-o*i-a*n;return this.x=l*s+u*-r+c*-a-h*-o,this.y=c*s+u*-o+h*-r-l*-a,this.z=h*s+u*-a+l*-o-c*-r,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this}};var U,j,z=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};function G(e){this.width=e.width||f(),this.height=e.height||m(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}z.prototype={constructor:z,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,i){var n=Math.cos(e/2),r=Math.cos(t/2),o=Math.cos(i/2),a=Math.sin(e/2),s=Math.sin(t/2),l=Math.sin(i/2);return this.x=a*r*o+n*s*l,this.y=n*s*o-a*r*l,this.z=n*r*l+a*s*o,this.w=n*r*o-a*s*l,this},setFromEulerYXZ:function(e,t,i){var n=Math.cos(e/2),r=Math.cos(t/2),o=Math.cos(i/2),a=Math.sin(e/2),s=Math.sin(t/2),l=Math.sin(i/2);return this.x=a*r*o+n*s*l,this.y=n*s*o-a*r*l,this.z=n*r*l-a*s*o,this.w=n*r*o+a*s*l,this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,n=e.y,r=e.z,o=e.w,a=t.x,s=t.y,l=t.z,c=t.w;return this.x=i*c+o*a+n*l-r*s,this.y=n*c+o*s+r*a-i*l,this.z=r*c+o*l+i*s-n*a,this.w=o*c-i*a-n*s-r*l,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this.x,n=this.y,r=this.z,o=this.w,a=o*e.w+i*e.x+n*e.y+r*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=i,this.y=n,this.z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this;var c=Math.sin((1-t)*s)/l,h=Math.sin(t*s)/l;return this.w=o*c+this.w*h,this.x=i*c+this.x*h,this.y=n*c+this.y*h,this.z=r*c+this.z*h,this},setFromUnitVectors:(1e-6,function(e,t){return void 0===U&&(U=new H),(j=e.dot(t)+1)<1e-6?(j=0,Math.abs(e.x)>Math.abs(e.z)?U.set(-e.y,e.x,0):U.set(0,-e.z,e.y)):U.crossVectors(e,t),this.x=U.x,this.y=U.y,this.z=U.z,this.w=j,this.normalize(),this})};var V=new G({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),W=new G({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),q={CardboardV1:new Y({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Y({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function X(e,t){this.viewer=q.CardboardV2,this.updateDeviceParams(e),this.distortion=new B(this.viewer.distortionCoefficients);for(var i=0;i<t.length;i++){var n=t[i];q[n.id]=new Y(n)}}function Y(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}X.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},X.prototype.getDevice=function(){return this.device},X.prototype.setViewer=function(e){this.viewer=e,this.distortion=new B(this.viewer.distortionCoefficients)},X.prototype.determineDevice_=function(e){if(!e)return s()?(console.warn("Using fallback iOS device measurements."),W):(console.warn("Using fallback Android device measurements."),V);var t=.0254,i=t/e.xdpi,n=t/e.ydpi;return new G({widthMeters:i*f(),heightMeters:n*m(),bevelMeters:.001*e.bevelMm})},X.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=this.distortion,n=e.screenLensDistance,r=(t.widthMeters-e.interLensDistance)/2,o=e.interLensDistance/2,a=e.baselineLensDistance-t.bevelMeters,s=t.heightMeters-a,l=F*Math.atan(i.distort(r/n)),c=F*Math.atan(i.distort(o/n)),h=F*Math.atan(i.distort(a/n)),u=F*Math.atan(i.distort(s/n));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(c,e.fov),downDegrees:Math.min(h,e.fov),upDegrees:Math.min(u,e.fov)}},X.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,n=Math.tan(-N*e.fov),r=Math.tan(N*e.fov),o=Math.tan(N*e.fov),a=Math.tan(-N*e.fov),s=t.widthMeters/4,l=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-l,h=e.interLensDistance/2-s,u=-c,d=e.screenLensDistance,p=i.distort((h-s)/d),f=i.distort((u+l)/d),m=i.distort((h+s)/d),v=i.distort((u-l)/d),g=new Float32Array(4);return g[0]=Math.max(n,p),g[1]=Math.min(r,f),g[2]=Math.min(o,m),g[3]=Math.max(a,v),g},X.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,n=new Float32Array(4),r=i.distortInverse(Math.tan(-N*e.fov)),o=i.distortInverse(Math.tan(N*e.fov)),a=i.distortInverse(Math.tan(N*e.fov)),s=i.distortInverse(Math.tan(-N*e.fov)),l=t.widthMeters/4,c=t.heightMeters/2,h=e.baselineLensDistance-t.bevelMeters-c,u=e.interLensDistance/2-l,d=-h,p=e.screenLensDistance,f=(u-l)/p,m=(d+c)/p,v=(u+l)/p,g=(d-c)/p;return n[0]=Math.max(r,f),n[1]=Math.min(o,m),n[2]=Math.min(a,v),n[3]=Math.max(s,g),n},X.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,i=this.device,n=t.screenLensDistance,r=(i.widthMeters-t.interLensDistance)/2,o=t.baselineLensDistance-i.bevelMeters,a=(e[0]*n+r)/i.widthMeters,s=(e[1]*n+o)/i.heightMeters,l=(e[2]*n+r)/i.widthMeters,c=(e[3]*n+o)/i.heightMeters;return{x:a,y:c,width:l-a,height:s-c}},X.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},X.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},X.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:F*Math.atan(e.outerDist),rightDegrees:F*Math.atan(e.innerDist),downDegrees:F*Math.atan(e.bottomDist),upDegrees:F*Math.atan(e.topDist)}},X.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,i=this.device,n=t.screenLensDistance,r=i.widthMeters/n,o=i.heightMeters/n,a=i.width/r,s=i.height/o,l=Math.round((e.eyePosX-e.outerDist)*a),c=Math.round((e.eyePosY-e.bottomDist)*s);return{x:l,y:c,width:Math.round((e.eyePosX+e.innerDist)*a)-l,height:Math.round((e.eyePosY+e.topDist)*s)-c}},X.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=this.distortion,n=e.screenLensDistance,r=e.interLensDistance/2/n,o=t.widthMeters/n,a=t.heightMeters/n,s=o/2-r,l=(e.baselineLensDistance-t.bevelMeters)/n,c=e.fov,h=i.distortInverse(Math.tan(N*c)),u=Math.min(s,h),d=Math.min(r,h),p=Math.min(l,h);return{outerDist:u,innerDist:d,topDist:Math.min(a-l,h),bottomDist:p,eyePosX:s,eyePosY:l}},X.Viewers=q;var K={format:1,last_updated:"2018-12-10T17:01:42Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3}]};function Q(e,t){if(this.dpdb=K,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var i=new XMLHttpRequest,n=this;i.open("GET",e,!0),i.addEventListener("load",(function(){n.loading=!1,i.status>=200&&i.status<=299?(n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_()):console.error("Error loading online DPDB!")})),i.send()}}function Z(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function J(e,t){this.set(e,t)}function $(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new J,this.currentGyroMeasurement=new J,this.previousGyroMeasurement=new J,s()?this.filterQ=new z(-1,0,0,1):this.filterQ=new z(1,0,0,1),this.previousFilterQ=new z,this.previousFilterQ.copy(this.filterQ),this.accelQ=new z,this.isOrientationInitialized=!1,this.estimatedGravity=new H,this.measuredGravity=new H,this.gyroIntegralQ=new z}function ee(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new z,this.previousTimestampS=null,this.deltaQ=new z,this.outQ=new z}function te(e,t,i,n){this.yawOnly=i,this.accelerometer=new H,this.gyroscope=new H,this.filter=new $(e,n),this.posePredictor=new ee(t,n),this.isFirefoxAndroid=c(),this.isIOS=s();var r=h();this.isDeviceMotionInRadians=!this.isIOS&&r&&r<66,this.isWithoutDeviceMotion=u(),this.filterToWorldQ=new z,s()?this.filterToWorldQ.setFromAxisAngle(new H(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new H(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new z,this.worldToScreenQ=new z,this.originalPoseAdjustQ=new z,this.originalPoseAdjustQ.setFromAxisAngle(new H(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),p()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new z,this.orientationOut_=new Float32Array(4),this.start()}Q.prototype.getDeviceParams=function(){return this.deviceParams},Q.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Q.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var t=navigator.userAgent||navigator.vendor||window.opera,i=f(),n=m();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var r=0;r<e.devices.length;r++){var o=e.devices[r];if(o.rules)if("ios"==o.type||"android"==o.type){if(s()==("ios"==o.type)){for(var a=!1,l=0;l<o.rules.length;l++){var c=o.rules[l];if(this.ruleMatches_(c,t,i,n)){a=!0;break}}if(a)return new Z({xdpi:o.dpi[0]||o.dpi,ydpi:o.dpi[1]||o.dpi,bevelMm:o.bw})}}else console.warn("Device["+r+"] has invalid type.");else console.warn("Device["+r+"] has no rules section.")}return console.warn("No DPDB device match."),null},Q.prototype.ruleMatches_=function(e,t,i,n){if(!e.ua&&!e.res)return!1;if(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var r=e.res[0],o=e.res[1];if(Math.min(i,n)!=Math.min(r,o)||Math.max(i,n)!=Math.max(r,o))return!1}return!0},J.prototype.set=function(e,t){this.sample=e,this.timestampS=t},J.prototype.copy=function(e){this.set(e.sample,e.timestampS)},$.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},$.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var i,n=t-this.previousGyroMeasurement.timestampS;i=n,!(isNaN(i)||i<=.001||i>1)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},$.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var i=new z;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n,r=new z;r.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),r.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",F*((n=r).w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(n.w)),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var o=new z;o.copy(this.filterQ),o.multiply(r),this.filterQ.slerp(o,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},$.prototype.getOrientation=function(){return this.filterQ},$.prototype.accelToQuaternion_=function(e){var t=new H;t.copy(e),t.normalize();var i=new z;return i.setFromUnitVectors(new H(0,0,-1),t),i.inverse(),i},$.prototype.gyroToQuaternionDelta_=function(e,t){var i=new z,n=new H;return n.copy(e),n.normalize(),i.setFromAxisAngle(n,e.length()*t),i},ee.prototype.getPrediction=function(e,t,i){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=i,e;var n=new H;n.copy(t),n.normalize();var r=t.length();if(r<20*N)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(F*r).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var o=r*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,o),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=i,this.outQ},te.prototype.getPosition=function(){return null},te.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||(i=(new z).setFromAxisAngle(new H(0,0,-1),0),n=new z,-90===window.orientation?n.setFromAxisAngle(new H(0,1,0),Math.PI/-2):n.setFromAxisAngle(new H(0,1,0),Math.PI/2),i.multiply(n)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((t=new z).setFromAxisAngle(new H(1,0,0),-Math.PI/2),t),e=this._deviceOrientationQ,(r=new z).copy(e),r.multiply(this.deviceOrientationFilterToWorldQ),r.multiply(this.resetQ),r.multiply(this.worldToScreenQ),r.multiplyQuaternions(this.deviceOrientationFixQ,r),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_;var t,i,n,r,o=this.filter.getOrientation();return e=this.posePredictor.getPrediction(o,this.gyroscope,this.previousTimestampS),(r=new z).copy(this.filterToWorldQ),r.multiply(this.resetQ),r.multiply(e),r.multiply(this.worldToScreenQ),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_},te.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),p()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},te.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new z;var t=e.alpha,i=e.beta,n=e.gamma;t=(t||0)*Math.PI/180,i=(i||0)*Math.PI/180,n=(n||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(i,t,-n)},te.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},te.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,i=e.rotationRate,n=e.timeStamp/1e3,r=n-this.previousTimestampS;return r<0?(_("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=n)):r<=.001||r>1?(_("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=n)):(this.accelerometer.set(-t.x,-t.y,-t.z),i&&(d()?this.gyroscope.set(-i.beta,i.alpha,i.gamma):this.gyroscope.set(i.alpha,i.beta,i.gamma)),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,n),this.filter.addGyroMeasurement(this.gyroscope,n),void(this.previousTimestampS=n))},te.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},te.prototype.onMessage_=function(e){var t=e.data;t&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)},te.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new H(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new H(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},te.prototype.start=function(){var e,t,i;this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),s()&&(e=window.self!==window.top,t=E(document.referrer),i=E(window.location.href),e&&t!==i)&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},te.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var ie=new H(1,0,0),ne=new H(0,0,1),re=new z;re.setFromAxisAngle(ie,-Math.PI/2),re.multiply((new z).setFromAxisAngle(ne,Math.PI/2));var oe=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new z,this._outQ=new z,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return r(e,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new te(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy(re),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),e}();function ae(){this.loadIcon_();var e=document.createElement("div");(o=e.style).position="fixed",o.top=0,o.right=0,o.bottom=0,o.left=0,o.backgroundColor="gray",o.fontFamily="sans-serif",o.zIndex=1e6;var t=document.createElement("img");t.src=this.icon,(o=t.style).marginLeft="25%",o.marginTop="25%",o.width="50%",e.appendChild(t);var i=document.createElement("div");(o=i.style).textAlign="center",o.fontSize="16px",o.lineHeight="24px",o.margin="24px 25%",o.width="50%",i.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(i);var n=document.createElement("div");(o=n.style).backgroundColor="#CFD8DC",o.position="fixed",o.bottom=0,o.width="100%",o.height="48px",o.padding="14px 24px",o.boxSizing="border-box",o.color="#656A6B",e.appendChild(n);var r=document.createElement("div");r.style.float="left",r.innerHTML="No Cardboard viewer?";var o,a=document.createElement("a");a.href="https://www.google.com/get/cardboard/get-cardboard/",a.innerHTML="get one",a.target="_blank",(o=a.style).float="right",o.fontWeight=600,o.textTransform="uppercase",o.borderLeft="1px solid gray",o.paddingLeft="24px",o.textDecoration="none",o.color="#656A6B",n.appendChild(r),n.appendChild(a),this.overlay=e,this.text=i,this.hide()}ae.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img").style;p()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")},ae.prototype.hide=function(){this.overlay.style.display="none"},ae.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},ae.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},ae.prototype.update=function(){this.disableShowTemporarily(),!p()&&b()?this.show():this.hide()},ae.prototype.loadIcon_=function(){this.icon="data:"+"image/svg+xml"+","+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var se="CardboardV1",le="WEBVR_CARDBOARD_VIEWER";function ce(e){try{this.selectedKey=localStorage.getItem(le)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||se),this.dialog=this.createDialog_(X.Viewers),this.root=null,this.onChangeCallbacks_=[]}ce.prototype.show=function(e){this.root=e,e.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},ce.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ce.prototype.getCurrentViewer=function(){return X.Viewers[this.selectedKey]},ce.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},ce.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},ce.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},ce.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&X.Viewers[this.selectedKey]){this.fireOnChange_(X.Viewers[this.selectedKey]);try{localStorage.setItem(le,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},ce.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add("webvr-polyfill-viewer-selector"),t.style.display="none";var i=document.createElement("div");(r=i.style).position="fixed",r.left=0,r.top=0,r.width="100%",r.height="100%",r.background="rgba(0, 0, 0, 0.3)",i.addEventListener("click",this.hide.bind(this));var n=document.createElement("div"),r=n.style;for(var o in r.boxSizing="border-box",r.position="fixed",r.top="24px",r.left="50%",r.marginLeft="-140px",r.width="280px",r.padding="24px",r.overflow="hidden",r.background="#fafafa",r.fontFamily="'Roboto', sans-serif",r.boxShadow="0px 5px 20px #666",n.appendChild(this.createH1_("Select your viewer")),e)n.appendChild(this.createChoice_(o,e[o].label));return n.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(i),t.appendChild(n),t},ce.prototype.createH1_=function(e){var t=document.createElement("h1"),i=t.style;return i.color="black",i.fontSize="20px",i.fontWeight="bold",i.marginTop=0,i.marginBottom="24px",t.innerHTML=e,t},ce.prototype.createChoice_=function(e,t){var i=document.createElement("div");i.style.marginTop="8px",i.style.color="black";var n=document.createElement("input");n.style.fontSize="30px",n.setAttribute("id",e),n.setAttribute("type","radio"),n.setAttribute("value",e),n.setAttribute("name","field");var r=document.createElement("label");return r.style.marginLeft="4px",r.setAttribute("for",e),r.innerHTML=t,i.appendChild(n),i.appendChild(r),i},ce.prototype.createButton_=function(e,t){var i=document.createElement("button");i.innerHTML=e;var n=i.style;return n.float="right",n.textTransform="uppercase",n.color="#1094f7",n.fontSize="14px",n.letterSpacing=0,n.border=0,n.background="none",n.marginTop="16px",i.addEventListener("click",t),i},"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var he,ue=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){var i;i=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=i(1),o="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),o?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",r),this.noSleepVideo.addEventListener("timeupdate",function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return n(e,[{key:"enable",value:function(){o?(this.disable(),this.noSleepTimer=window.setInterval((function(){window.location.href="/",window.setTimeout(window.stop,0)}),15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){o?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=a},function(e,t,i){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])},e.exports=i()})),de=(he=ue)&&he.__esModule&&Object.prototype.hasOwnProperty.call(he,"default")?he.default:he,pe=1e3,fe=[0,0,.5,1],me=[.5,0,.5,1],ve=window.requestAnimationFrame,ge=window.cancelAnimationFrame;function ye(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return M("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function be(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=pe++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return M("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new ye({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&b()&&(this.wakelock_=new de)}be.prototype.getFrameData=function(e){return x(e,this._getPose(),this)},be.prototype.getPose=function(){return M("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},be.prototype.resetPose=function(){return M("VRDisplay.prototype.resetPose"),this._resetPose()},be.prototype.getImmediatePose=function(){return M("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},be.prototype.requestAnimationFrame=function(e){return ve(e)},be.prototype.cancelAnimationFrame=function(e){return ge(e)},be.prototype.wrapForFullscreen=function(e){if(s())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var i=this.fullscreenElement_.parentElement;i.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),i.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var n=this;return function(){if(n.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];n.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}(),this.fullscreenWrapper_},be.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},be.prototype.requestPresent=function(e){var t=this.isPresenting,i=this;return e instanceof Array||(M("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise((function(n,r){if(i.capabilities.canPresent)if(0==e.length||e.length>i.capabilities.maxLayers)r(new Error("Invalid number of layers."));else{var o=e[0];if(o.source){var a=o.leftBounds||fe,c=o.rightBounds||me;if(t){var h=i.layer_;h.source!==o.source&&(h.source=o.source);for(var u=0;u<4;u++)h.leftBounds[u]=a[u],h.rightBounds[u]=c[u];return i.wrapForFullscreen(i.layer_.source),i.updatePresent_(),void n()}if(i.layer_={predistorted:o.predistorted,source:o.source,leftBounds:a.slice(0),rightBounds:c.slice(0)},i.waitingForPresent_=!1,i.layer_&&i.layer_.source){var d=i.wrapForFullscreen(i.layer_.source);i.addFullscreenListeners_(d,(function(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i.isPresenting=d===e,i.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch((function(e){console.error("screen.orientation.lock() failed due to",e.message)})),i.waitingForPresent_=!1,i.beginPresent_(),n()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),i.removeFullscreenWrapper(),i.disableWakeLock(),i.endPresent_(),i.removeFullscreenListeners_()),i.fireVRDisplayPresentChange_()}),(function(){i.waitingForPresent_&&(i.removeFullscreenWrapper(),i.removeFullscreenListeners_(),i.disableWakeLock(),i.waitingForPresent_=!1,i.isPresenting=!1,r(new Error("Unable to present.")))})),function(e){if(l())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0}(d)?(i.enableWakeLock(),i.waitingForPresent_=!0):(s()||l())&&(i.enableWakeLock(),i.isPresenting=!0,i.beginPresent_(),i.fireVRDisplayPresentChange_(),n())}i.waitingForPresent_||s()||(v(),r(new Error("Unable to present.")))}else n()}else r(new Error("VRDisplay is not capable of presenting."))}))},be.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise((function(i,n){e?(!v()&&s()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),l()&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.endPresent_(),t.fireVRDisplayPresentChange_()),i()):n(new Error("Was not presenting to VRDisplay."))}))},be.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},be.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},be.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},be.prototype.addFullscreenListeners_=function(e,t,i){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=i,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),i&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",i,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",i,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",i,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",i,!1))},be.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var i=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",i,!1),e.removeEventListener("webkitfullscreenerror",i,!1),document.removeEventListener("mozfullscreenerror",i,!1),e.removeEventListener("msfullscreenerror",i,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},be.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},be.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},be.prototype.beginPresent_=function(){},be.prototype.endPresent_=function(){},be.prototype.submitFrame=function(e){},be.prototype.getEyeParameters=function(e){return null};var Ae={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},we="left",xe="right";function Ee(e){var t=A({},Ae);e=A(t,e||{}),be.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new ye({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new oe(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Q(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new X(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new ce(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new ae),s()&&window.addEventListener("resize",this.onResize_.bind(this))}return Ee.prototype=Object.create(be.prototype),Ee.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Ee.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Ee.prototype._getFieldOfView=function(e){var t;if(e==we)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=xe)return console.error("Invalid eye provided: %s",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},Ee.prototype._getEyeOffset=function(e){var t;if(e==we)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(e!=xe)return console.error("Invalid eye provided: %s",e),null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},Ee.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),i=this._getFieldOfView(e),n={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(n,"fieldOfView",{enumerable:!0,get:function(){return M("VRFieldOfView","VRFrameData's projection matrices"),i}}),n},Ee.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Ee.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Ee.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=f()*this.bufferScale_,e.canvas.height=m()*this.bufferScale_,this.cardboardUI_=new k(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new k(e)),this.distorter_=new L(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}.bind(this),function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}.bind(this)),this.rotateInstructions_&&(p()&&b()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Ee.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Ee.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Ee.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl").canvas;t.width==this.lastWidth&&t.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=t.width,this.lastHeight=t.height,this.cardboardUI_.render()}},Ee.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Ee.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");t.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),w(t.canvas)}},Ee.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Ee.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},Ee.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},Ee.VRDisplay=be,Ee},e.exports=n()})),s=(i=a)&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,l={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function c(e){this.config=o(o({},l),e),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&n())&&(this.enable(),this.getVRDisplays().then((function(e){e&&e[0]&&e[0].fireVRDisplayConnect_&&e[0].fireVRDisplayConnect_()})))}c.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(n()){var e=new s({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(e)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},c.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var e=this.native.VRFrameData,t=new this.native.VRFrameData,i=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(n){n instanceof e?i.call(this,n):(i.call(this,t),n.pose=t.pose,r(t.leftProjectionMatrix,n.leftProjectionMatrix),r(t.rightProjectionMatrix,n.rightProjectionMatrix),r(t.leftViewMatrix,n.leftViewMatrix),r(t.rightViewMatrix,n.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=s.VRDisplay,window.VRFrameData=s.VRFrameData},c.prototype.getVRDisplays=function(){var e=this;return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then((function(t){return t.length>0?t:e.getPolyfillDisplays()})):Promise.resolve(this.getPolyfillDisplays())},c.version="0.10.10",c.VRFrameData=s.VRFrameData,c.VRDisplay=s.VRDisplay;var h=Object.freeze({default:c}),u=h&&c||h;return void 0!==t&&t.window&&(t.document||(t.document=t.window.document),t.navigator||(t.navigator=t.window.navigator)),u}))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(e,t,i){var n=/\n/,r="\n",o=/\s/;function a(e,t,i,n){var r=e.indexOf(t,i);return-1===r||r>n?n:r}function s(e){return o.test(e)}function l(e,t,i,n){return{start:t,end:t+Math.min(n,i-t)}}t.exports=function(e,i){return t.exports.lines(e,i).map((function(t){return e.substring(t.start,t.end)})).join("\n")},t.exports.lines=function(e,t){if(0===(t=t||{}).width&&"nowrap"!==t.mode)return[];e=e||"";var i="number"==typeof t.width?t.width:Number.MAX_VALUE,o=Math.max(0,t.start||0),c="number"==typeof t.end?t.end:e.length,h=t.mode,u=t.measure||l;return"pre"===h?function(e,t,i,r,o){for(var a=[],s=i,l=i;l<r&&l<t.length;l++){var c=t.charAt(l),h=n.test(c);if(h||l===r-1){var u=e(t,s,h?l:l+1,o);a.push(u),s=l+1}}return a}(u,e,o,c,i):function(e,t,i,n,o,l){var c=[],h=o;for("nowrap"===l&&(h=Number.MAX_VALUE);i<n&&i<t.length;){for(var u=a(t,r,i,n);i<u&&s(t.charAt(i));)i++;var d=e(t,i,u,h),p=i+(d.end-d.start),f=p+1;if(p<u){for(;p>i&&!s(t.charAt(p));)p--;if(p===i)f>i+1&&f--,p=f;else for(f=p;p>i&&s(t.charAt(p-1));)p--}if(p>=i){var m=e(t,i,p,h);c.push(m)}i=f}return c}(u,e,o,c,i,h)}},{}],51:[function(e,t,i){"use strict";var n=e("global/window"),r=e("is-function"),o=e("parse-headers"),a=e("xtend");function s(e,t,i){var n=e;return r(t)?(i=t,"string"==typeof e&&(n={uri:e})):n=a(t,{uri:e}),n.callback=i,n}function l(e,t,i){return c(t=s(e,t,i))}function c(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,i=function(i,n,r){t||(t=!0,e.callback(i,n,r))};function n(){var e=void 0;if(e=h.response?h.response:h.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(h),g)try{e=JSON.parse(e)}catch(e){}return e}function r(e){return clearTimeout(u),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,i(e,y)}function a(){if(!c){var t;clearTimeout(u),t=e.useXDR&&void 0===h.status?200:1223===h.status?204:h.status;var r=y,a=null;return 0!==t?(r={body:n(),statusCode:t,method:p,headers:{},url:d,rawRequest:h},h.getAllResponseHeaders&&(r.headers=o(h.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),i(a,r,r.body)}}var s,c,h=e.xhr||null;h||(h=e.cors||e.useXDR?new l.XDomainRequest:new l.XMLHttpRequest);var u,d=h.url=e.uri||e.url,p=h.method=e.method||"GET",f=e.body||e.data,m=h.headers=e.headers||{},v=!!e.sync,g=!1,y={body:void 0,headers:{},statusCode:0,method:p,url:d,rawRequest:h};if("json"in e&&!1!==e.json&&(g=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),h.onreadystatechange=function(){4===h.readyState&&setTimeout(a,0)},h.onload=a,h.onerror=r,h.onprogress=function(){},h.onabort=function(){c=!0},h.ontimeout=r,h.open(p,d,!v,e.username,e.password),v||(h.withCredentials=!!e.withCredentials),!v&&e.timeout>0&&(u=setTimeout((function(){if(!c){c=!0,h.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}}),e.timeout)),h.setRequestHeader)for(s in m)m.hasOwnProperty(s)&&h.setRequestHeader(s,m[s]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(h.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(h),h.send(f||null),h}t.exports=l,t.exports.default=l,l.XMLHttpRequest=n.XMLHttpRequest||function(){},l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}(["get","put","post","patch","head","delete"],(function(e){l["delete"===e?"del":e]=function(t,i,n){return(i=s(t,i,n)).method=e.toUpperCase(),c(i)}}))},{"global/window":17,"is-function":22,"parse-headers":32,xtend:53}],52:[function(e,t,i){t.exports=void 0!==self.DOMParser?function(e){return(new self.DOMParser).parseFromString(e,"application/xml")}:void 0!==self.ActiveXObject&&new self.ActiveXObject("Microsoft.XMLDOM")?function(e){var t=new self.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}:function(e){var t=document.createElement("div");return t.innerHTML=e,t}},{}],53:[function(e,t,i){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)n.call(i,r)&&(e[r]=i[r])}return e};var n=Object.prototype.hasOwnProperty},{}],54:[function(e,t,i){t.exports={name:"aframe",version:"1.0.4",description:"A web framework for building virtual reality experiences.",homepage:"https://aframe.io/",main:"dist/aframe-master.js",scripts:{browserify:"browserify src/index.js -s 'AFRAME' -p browserify-derequire",build:"shx mkdir -p build/ && npm run browserify -- --debug -t [envify --INSPECTOR_VERSION dev] -o build/aframe.js",codecov:"codecov",dev:"npm run build && cross-env INSPECTOR_VERSION=dev node ./scripts/budo -t envify",dist:"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"npm run browserify -s -- --debug | exorcist dist/aframe-master.js.map > dist/aframe-master.js","dist:min":"npm run browserify -s -- --debug -p [minifyify --map aframe-master.min.js.map --output dist/aframe-master.min.js.map] -o dist/aframe-master.min.js",docs:"markserv --dir docs --port 9001",preghpages:"node ./scripts/preghpages.js",ghpages:"ghpages -p gh-pages/",lint:"semistandard -v | snazzy","lint:fix":"semistandard --fix",precommit:"npm run lint",prepush:"node scripts/testOnlyCheck.js",prerelease:"node scripts/release.js 1.0.3 1.0.4",start:"npm run dev","start:https":"cross-env SSL=true npm run dev",test:"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"mocha --ui tdd tests/node"},repository:"aframevr/aframe",license:"MIT",files:["dist/*","docs/**/*","src/**/*","vendor/**/*"],dependencies:{"custom-event-polyfill":"^1.0.6",debug:"ngokevin/debug#noTimestamp","deep-assign":"^2.0.0","document-register-element":"dmarcos/document-register-element#8ccc532b7f3744be954574caf3072a5fd260ca90","load-bmfont":"^1.2.3","object-assign":"^4.0.1",present:"0.0.6","promise-polyfill":"^3.1.0","super-animejs":"^3.1.0","super-three":"^0.111.6","three-bmfont-text":"dmarcos/three-bmfont-text#1babdf8507c731a18f8af3b807292e2b9740955e","webvr-polyfill":"^0.10.10"},devDependencies:{browserify:"^13.1.0","browserify-css":"^0.8.4","browserify-derequire":"^0.9.4","browserify-istanbul":"^2.0.0",budo:"^9.2.0",chai:"^3.5.0","chai-shallow-deep-equal":"^1.4.0",chalk:"^1.1.3",codecov:"^1.0.1","cross-env":"^5.0.1",envify:"^3.4.1",exorcist:"^0.4.0",ghpages:"0.0.8","git-rev":"^0.2.1",glob:"^7.1.1",husky:"^0.11.7",istanbul:"^0.4.5",jsdom:"^9.11.0",karma:"1.4.1","karma-browserify":"^5.1.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^1.2.0","karma-mocha":"^1.1.1","karma-mocha-reporter":"^2.1.0","karma-sinon-chai":"1.2.4",lolex:"^1.5.1",markserv:"github:sukima/markserv#feature/fix-broken-websoketio-link",minifyify:"^7.3.3",mocha:"^3.0.2","mozilla-download":"^1.1.1","replace-in-file":"^2.5.3",semistandard:"^9.0.0",shelljs:"^0.7.7",shx:"^0.2.2",sinon:"^1.17.5","sinon-chai":"2.8.0",snazzy:"^5.0.0","too-wordy":"ngokevin/too-wordy",uglifyjs:"^2.4.10","write-good":"^0.9.1"},link:!0,browserify:{transform:["browserify-css","envify"]},semistandard:{ignore:["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},keywords:["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","web-components","webvr"],"browserify-css":{minify:!0},engines:{node:">= 4.6.0",npm:"^2.15.9"}}},{}],55:[function(e,t,i){var n=e("super-animejs"),r=e("../core/component").components,o=e("../core/component").registerComponent,a=e("../lib/three"),s=e("../utils"),l=new a.Color,c=new a.Color,h=s.entity.getComponentProperty,u=s.entity.setComponentProperty,d={},p="color",f="rotation",m="scale",v="components";function g(e){e.x=a.Math.degToRad(e.x),e.y=a.Math.degToRad(e.y),e.z=a.Math.degToRad(e.z)}function y(e,t,i){var n;for(n=0;n<t.length;n++)e.addEventListener(t[n],i)}function b(e,t,i){var n;for(n=0;n<t.length;n++)e.removeEventListener(t[n],i)}function A(e,t){var i,n,r;for(n=x(t),r=e,i=0;i<n.length;i++)r=r[n[i]];if(void 0===r)throw console.log(e),new Error("[animation] property ("+t+") could not be found");return r}function w(e,t,i,n){var r,o,s,l;for(t.startsWith("object3D.rotation")&&(i=a.Math.degToRad(i)),o=x(t),l=e,r=0;r<o.length-1;r++)l=l[o[r]];s=o[o.length-1],n!==p?l[s]=i:"r"in l[s]?(l[s].r=i.r,l[s].g=i.g,l[s].b=i.b):(l[s].x=i.r,l[s].y=i.g,l[s].z=i.b)}function x(e){return e in d||(d[e]=e.split(".")),d[e]}function E(e){return e.isRawProperty||e.property.startsWith(v)||e.property.startsWith("object3D")}t.exports.Component=o("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&parseInt(e,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var e=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){e.animationIsPlaying=!1,e.el.emit("animationcomplete",e.eventDetail,!1),e.id&&e.el.emit("animationcomplete__"+e.id,e.eventDetail,!1)}}},update:function(e){var t=this.config,i=this.data;this.animationIsPlaying=!1,this.data.enabled&&i.property&&(t.autoplay=!1,t.direction=i.dir,t.duration=i.dur,t.easing=i.easing,t.elasticity=i.elasticity,t.loop=i.loop,t.round=i.round,this.createAndStartAnimation())},tick:function(e,t){this.animationIsPlaying&&(this.time+=t,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var e=this.data;this.updateConfig(),this.animationIsPlaying=!1,this.animation=n(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!e.autoplay||e.startEvents&&e.startEvents.length||(e.delay?setTimeout(this.beginAnimation,e.delay):this.beginAnimation())},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){this.data.enabled&&(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=n(this.config),this.data.delay?setTimeout(this.beginAnimation,this.data.delay):this.beginAnimation())},updateConfigForRawColor:function(){var e,t,i,n=this.config,r=this.data,o=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(t in e=""===r.from?A(o,r.property):r.from,i=r.to,this.setColorConfig(e,i),e=this.fromColor,i=this.toColor,this.targetsArray.length=0,this.targetsArray.push(e),n.targets=this.targetsArray,i)n[t]=i[t];var a;n.update=(a={},function(e){var t;(t=e.animatables[0].target).r===a.r&&t.g===a.g&&t.b===a.b||w(o,r.property,t,r.type)})}},updateConfigForDefault:function(){var e,t,i,n,r=this.config,o=this.data,a=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(e=""===o.from?E(o)?A(a,o.property):h(a,o.property):o.from,i=o.to,isNaN(e||i)?(e=e?e.toString():e,i=i?i.toString():i):(e=parseFloat(e),i=parseFloat(i)),(t="true"===o.to||"false"===o.to||!0===o.to||!1===o.to)&&(e="true"===o.from||!0===o.from?1:0,i="true"===o.to||!0===o.to?1:0),this.targets.aframeProperty=e,r.targets=this.targets,r.aframeProperty=i,r.update=function(e){var i;(i=e.animatables[0].target.aframeProperty)!==n&&(n=i,t&&(i=i>=1),E(o)?w(a,o.property,i,o.type):u(a,o.property,i))})},updateConfigForVector:function(){var e,t,i,n,r=this.config,o=this.data,a=this.el;for(e in t=""!==o.from?s.coordinates.parse(o.from):h(a,o.property),i=s.coordinates.parse(o.to),o.property===f&&(g(t),g(i)),this.targetsArray.length=0,this.targetsArray.push(t),r.targets=this.targetsArray,i)r[e]=i[e];"position"!==o.property&&o.property!==f&&o.property!==m?r.update=function(){var e={};return function(t){var i=t.animatables[0].target;i.x===e.x&&i.y===e.y&&i.z===e.z||(e.x=i.x,e.y=i.y,e.z=i.z,u(a,o.property,i))}}():r.update=(n={},function(e){var t=e.animatables[0].target;o.property===m&&(t.x=Math.max(1e-4,t.x),t.y=Math.max(1e-4,t.y),t.z=Math.max(1e-4,t.z)),t.x===n.x&&t.y===n.y&&t.z===n.z||(n.x=t.x,n.y=t.y,n.z=t.z,a.object3D[o.property].set(t.x,t.y,t.z))})},updateConfig:function(){var e,t,i,n,o,a,s;t=this.el,i=this.data.property,o=(a=i.split("."))[0],s=a[1],e=(n=t.components[o]||r[o])?s&&!n.schema[s]?null:s?n.schema[s].type:n.schema.type:null,E(this.data)&&this.data.type===p?this.updateConfigForRawColor():"vec2"===e||"vec3"===e||"vec4"===e?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(e){var t,i=this.data,r=this.el,o=this;return""===i.from&&!!i.property.startsWith(v)&&(t=x(i.property)[1],!r.components[t]&&(r.addEventListener("componentinitialized",(function i(a){a.detail.name===t&&(e(),o.animation=n(o.config),r.removeEventListener("componentinitialized",i))})),!0))},stopRelatedAnimations:function(){var e,t;for(t in this.el.components)e=this.el.components[t],t!==this.attrName&&"animation"===e.name&&e.animationIsPlaying&&e.data.property===this.data.property&&(e.animationIsPlaying=!1)},addEventListeners:function(){var e=this.data,t=this.el;y(t,e.startEvents,this.onStartEvent),y(t,e.pauseEvents,this.pauseAnimation),y(t,e.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var e=this.data,t=this.el;b(t,e.startEvents,this.onStartEvent),b(t,e.pauseEvents,this.pauseAnimation),b(t,e.resumeEvents,this.resumeAnimation)},setColorConfig:function(e,t){l.set(e),c.set(t),e=this.fromColor,t=this.toColor,e.r=l.r,e.g=l.g,e.b=l.b,t.r=c.r,t.g=c.g,t.b=c.b}})},{"../core/component":109,"../lib/three":157,"../utils":182,"super-animejs":36}],56:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../lib/three");t.exports.Component=n("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var e,t=this.el;e=this.camera=new r.PerspectiveCamera,t.setObject3D("camera",e)},update:function(e){var t=this.data,i=this.camera;i.aspect=t.aspect||window.innerWidth/window.innerHeight,i.far=t.far,i.fov=t.fov,i.near=t.near,i.zoom=t.zoom,i.updateProjectionMatrix(),this.updateActiveCamera(e),this.updateSpectatorCamera(e)},updateActiveCamera:function(e){var t=this.data,i=this.el,n=this.system;e&&e.active===t.active||t.spectator||(t.active&&n.activeCameraEl!==i?n.setActiveCamera(i):t.active||n.activeCameraEl!==i||n.disableActiveCamera())},updateSpectatorCamera:function(e){var t=this.data,i=this.el,n=this.system;e&&e.spectator===t.spectator||(t.spectator&&n.spectatorCameraEl!==i?n.setSpectatorCamera(i):t.spectator||n.spectatorCameraEl!==i||n.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},{"../core/component":109,"../lib/three":157}],57:[function(e,t,i){var n,r,o,a,s=e("../core/component").registerComponent,l=e("../utils/"),c=l.bind,h="click",u="fusing",d="mouseenter",p="mousedown",f="mouseleave",m="mouseup",v="cursor-fusing",g="cursor-hovering",y="cursor-hovered",b={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},A={DOWN:["selectstart"],UP:["selectend"]},w="a-mouse-cursor-hover";t.exports.Component=s("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:l.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var e=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.updateCanvasBounds=l.debounce((function(){e.canvasBounds=e.el.sceneEl.canvas.getBoundingClientRect()}),500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=c(this.onCursorDown,this),this.onCursorUp=c(this.onCursorUp,this),this.onIntersection=c(this.onIntersection,this),this.onIntersectionCleared=c(this.onIntersectionCleared,this),this.onMouseMove=c(this.onMouseMove,this),this.onEnterVR=c(this.onEnterVR,this)},update:function(e){this.data.rayOrigin!==e.rayOrigin&&this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var e=this.el;e.removeState(g),e.removeState(v),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(y),this.removeEventListeners()},addEventListeners:function(){var e,t=this.data,i=this.el,n=this;function r(){e=i.sceneEl.canvas,t.downEvents.length||t.upEvents.length||(b.DOWN.forEach((function(t){e.addEventListener(t,n.onCursorDown)})),b.UP.forEach((function(t){e.addEventListener(t,n.onCursorUp)})))}(e=i.sceneEl.canvas)?r():i.sceneEl.addEventListener("render-target-loaded",r),t.downEvents.forEach((function(e){i.addEventListener(e,n.onCursorDown)})),t.upEvents.forEach((function(e){i.addEventListener(e,n.onCursorUp)})),i.addEventListener("raycaster-intersection",this.onIntersection),i.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),i.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),i.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var e,t=this.data,i=this.el,n=this;!(e=i.sceneEl.canvas)||t.downEvents.length||t.upEvents.length||(b.DOWN.forEach((function(t){e.removeEventListener(t,n.onCursorDown)})),b.UP.forEach((function(t){e.removeEventListener(t,n.onCursorUp)}))),t.downEvents.forEach((function(e){i.removeEventListener(e,n.onCursorDown)})),t.upEvents.forEach((function(e){i.removeEventListener(e,n.onCursorUp)})),i.removeEventListener("raycaster-intersection",this.onIntersection),i.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("touchstart",this.onMouseMove),e.removeEventListener("touchmove",this.onMouseMove),i.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),i.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var e,t=this.el;(e=t.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("touchmove",this.onMouseMove),t.setAttribute("raycaster","useWorldCoordinates",!1),"mouse"===this.data.rayOrigin&&(e.addEventListener("mousemove",this.onMouseMove,!1),e.addEventListener("touchmove",this.onMouseMove,!1),t.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:(n=new THREE.Vector3,r=new THREE.Vector2,o=new THREE.Vector3,a={origin:o,direction:n},function(e){var t,i,s,l=this.canvasBounds,c=this.el.sceneEl.camera;c.parent.updateMatrixWorld(),t=(i="touchmove"===e.type||"touchstart"===e.type?e.touches.item(0):e).clientX-l.left,s=i.clientY-l.top,r.x=t/l.width*2-1,r.y=-s/l.height*2+1,o.setFromMatrixPosition(c.matrixWorld),n.set(r.x,r.y,.5).unproject(c).sub(o).normalize(),this.el.setAttribute("raycaster",a),"touchmove"===e.type&&e.preventDefault()}),onCursorDown:function(e){this.isCursorDown=!0,"mouse"===this.data.rayOrigin&&"touchstart"===e.type&&(this.onMouseMove(e),this.el.components.raycaster.checkIntersections(),e.preventDefault()),this.twoWayEmit(p),this.cursorDownEl=this.intersectedEl},onCursorUp:function(e){if(this.isCursorDown){this.isCursorDown=!1;var t=this.data;this.twoWayEmit(m),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(m,this.intersectedEventDetail)),t.fuse&&"mouse"!==t.rayOrigin||!this.intersectedEl||this.cursorDownEl!==this.intersectedEl||this.twoWayEmit(h),this.cursorDownEl=null,"touchend"===e.type&&e.preventDefault()}},onIntersection:function(e){var t,i,n,r,o=this.el;i=e.detail.els[0]===o?1:0,r=e.detail.intersections[i],(n=e.detail.els[i])&&this.intersectedEl!==n&&(this.intersectedEl&&(t=this.el.components.raycaster.getIntersection(this.intersectedEl))&&t.distance<=r.distance||(this.clearCurrentIntersection(!0),this.setIntersection(n,r)))},onIntersectionCleared:function(e){-1!==e.detail.clearedEls.indexOf(this.intersectedEl)&&this.clearCurrentIntersection()},onEnterVR:function(){var e=this.el.xrSession,t=this;e&&(A.DOWN.forEach((function(i){e.addEventListener(i,t.onCursorDown)})),A.UP.forEach((function(i){e.addEventListener(i,t.onCursorUp)})))},setIntersection:function(e,t){var i=this.el,n=this.data,r=this;this.intersectedEl!==e&&(this.intersectedEl=e,i.addState(g),e.addState(y),this.twoWayEmit(d),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.add(w),0!==n.fuseTimeout&&n.fuse&&(i.addState(v),this.twoWayEmit(u),this.fuseTimeout=setTimeout((function(){i.removeState(v),r.twoWayEmit(h)}),n.fuseTimeout)))},clearCurrentIntersection:function(e){var t,i,n=this.el;this.intersectedEl&&(this.intersectedEl.removeState(y),n.removeState(g),n.removeState(v),this.twoWayEmit(f),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.remove(w),this.intersectedEl=null,clearTimeout(this.fuseTimeout),!0!==e&&0!==(i=this.el.components.raycaster.intersections).length&&(t=i[i[0].object.el===n?1:0])&&this.setIntersection(t.object.el,t))},twoWayEmit:function(e){var t,i=this.el,n=this.intersectedEl;t=this.el.components.raycaster.getIntersection(n),this.eventDetail.intersectedEl=n,this.eventDetail.intersection=t,i.emit(e,this.eventDetail),n&&(this.intersectedEventDetail.intersection=t,n.emit(e,this.intersectedEventDetail))}})},{"../core/component":109,"../utils/":182}],58:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/bind"),o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c="https://cdn.aframe.io/controllers/google/",h=c+"vr_controller_daydream.obj",u=c+"vr_controller_daydream.mtl",d=e("../utils/").device.isWebXRAvailable?"google-daydream":"Daydream Controller";t.exports.Component=n("daydream-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","menu","system"]},bindMethods:function(){this.onModelLoaded=r(this.onModelLoaded,this),this.onControllersUpdate=r(this.onControllersUpdate,this),this.checkIfControllerPresent=r(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=r(this.removeControllersUpdateListener,this),this.onAxisMoved=r(this.onAxisMoved,this)},init:function(){var e=this;this.onButtonChanged=r(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){a(this,d,{hand:this.data.hand})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{armModel:t.armModel,hand:t.hand,idPrefix:d,orientationOffset:t.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:h,mtl:u})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var t,i=e.detail.model;this.data.model&&((t=this.buttonMeshes={}).menu=i.getObjectByName("AppButton_AppButton_Cylinder.004"),t.system=i.getObjectByName("HomeButton_HomeButton_Cylinder.005"),t.trackpad=i.getObjectByName("TouchPad_TouchPad_Cylinder.003"),i.position.set(0,0,-.04))},onAxisMoved:function(e){s(this,this.mapping.axes,e)},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var i=this.buttonMeshes;if(i&&i[e]){var n;switch(t){case"down":n=this.data.buttonHighlightColor;break;case"touchstart":n=this.data.buttonTouchedColor;break;default:n=this.data.buttonColor}i[e].material.color.set(n)}}})},{"../core/component":109,"../utils/":182,"../utils/bind":176,"../utils/tracked-controls":190}],59:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/bind"),o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c=e("../utils/").device.isWebXRAvailable,h="https://cdn.aframe.io/controllers/samsung/",u=h+"gear_vr_controller.obj",d=h+"gear_vr_controller.mtl",p=c?"samsung-gearvr":"Gear VR",f=c?{left:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","menu"]},right:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","menu"]}}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]};t.exports.Component=n("gearvr-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:f,bindMethods:function(){this.onModelLoaded=r(this.onModelLoaded,this),this.onControllersUpdate=r(this.onControllersUpdate,this),this.checkIfControllerPresent=r(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=r(this.removeControllersUpdateListener,this),this.onAxisMoved=r(this.onAxisMoved,this)},init:function(){var e=this;this.onButtonChanged=r(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){a(this,p,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{armModel:t.armModel,hand:t.hand,idPrefix:p,id:p,orientationOffset:t.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:u,mtl:d})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var t,i=e.detail.model;this.data.model&&((t=this.buttonMeshes={}).trigger=i.children[2],t.trackpad=i.children[1])},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){s(this,this.mapping.axes,e)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var i=this.buttonMeshes;if(i&&i[e]){var n;switch(t){case"down":n=this.data.buttonHighlightColor;break;case"touchstart":n=this.data.buttonTouchedColor;break;default:n=this.data.buttonColor}i[e].material.color.set(n)}}})},{"../core/component":109,"../utils/":182,"../utils/bind":176,"../utils/tracked-controls":190}],60:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/bind"),o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c="generic";t.exports.Component=n("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"}},mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=r(this.onControllersUpdate,this),this.checkIfControllerPresent=r(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=r(this.removeControllersUpdateListener,this),this.onAxisMoved=r(this.onAxisMoved,this)},init:function(){var e=this;this.onButtonChanged=r(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data,t=e.hand?e.hand:void 0;a(this,c,{hand:t,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;this.el.components["tracked-controls"]||(e.setAttribute("tracked-controls",{hand:t.hand,idPrefix:c,orientationOffset:t.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel())},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){s(this,this.mapping.axes,e)},initDefaultModel:function(){var e=this.modelEl=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"sphere",radius:.03}),e.setAttribute("material",{color:this.data.color}),this.el.appendChild(e)}})},{"../core/component":109,"../utils/bind":176,"../utils/tracked-controls":190}],61:[function(e,t,i){var n=e("../core/geometry").geometries,r=e("../core/geometry").geometryNames,o=e("../core/component").registerComponent,a=e("../lib/three"),s=new a.Geometry;t.exports.Component=o("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:r,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(e){var t,i=this.data,n=this.el,r=this.system;this.geometry&&(r.unuseGeometry(e),this.geometry=null),this.geometry=r.getOrCreateGeometry(i),(t=n.getObject3D("mesh"))?t.geometry=this.geometry:((t=new a.Mesh).geometry=this.geometry,n.setObject3D("mesh",t))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=s,this.geometry=null},updateSchema:function(e){var t=this.oldData&&this.oldData.primitive,i=e.primitive,r=n[i]&&n[i].schema;if(!r)throw new Error("Unknown geometry schema `"+i+"`");t&&t===i||this.extendSchema(r)}})},{"../core/component":109,"../core/geometry":110,"../lib/three":157}],62:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../lib/three"),o=e("../utils/").debug("components:gltf-model:warn");t.exports.Component=n("gltf-model",{schema:{type:"model"},init:function(){var e=this.system.getDRACOLoader();this.model=null,this.loader=new r.GLTFLoader,e&&this.loader.setDRACOLoader(e)},update:function(){var e=this,t=this.el,i=this.data;i&&(this.remove(),this.loader.load(i,(function(i){e.model=i.scene||i.scenes[0],e.model.animations=i.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})}),void 0,(function(e){var n=e&&e.message?e.message:"Failed to load glTF model";o(n),t.emit("model-error",{format:"gltf",src:i})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../core/component":109,"../lib/three":157,"../utils/":182}],63:[function(e,t,i){var n=e("../core/component").registerComponent,r={toonLeft:"https://cdn.aframe.io/controllers/hands/leftHand.glb",toonRight:"https://cdn.aframe.io/controllers/hands/rightHand.glb",lowPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandLow.glb",lowPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandLow.glb",highPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandHigh.glb",highPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandHigh.glb"},o="Open",a="Point",s="Point + Thumb",l="Fist",c="Hold",h="Thumb Up",u={};function d(e,t){var i;if(e)return"grip"===(i=u[e])?i+(t?"close":"open"):"point"===i?i+(t?"up":"down"):"pointing"===i||"pistol"===i?i+(t?"start":"end"):void 0}u[l]="grip",u[h]="pistol",u[a]="pointing",t.exports.Component=n("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},init:function(){var e=this,t=this.el;this.gesture=o,this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){e.handleButton("grip","down")},this.onGripUp=function(){e.handleButton("grip","up")},this.onTrackpadDown=function(){e.handleButton("trackpad","down")},this.onTrackpadUp=function(){e.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){e.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){e.handleButton("trackpad","touchend")},this.onTriggerDown=function(){e.handleButton("trigger","down")},this.onTriggerUp=function(){e.handleButton("trigger","up")},this.onTriggerTouchStart=function(){e.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){e.handleButton("trigger","touchend")},this.onGripTouchStart=function(){e.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){e.handleButton("grip","touchend")},this.onThumbstickDown=function(){e.handleButton("thumbstick","down")},this.onThumbstickUp=function(){e.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){e.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){e.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){e.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){e.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){e.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){e.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),t.addEventListener("controllerconnected",this.onControllerConnected),t.addEventListener("controllerdisconnected",this.onControllerDisconnected),t.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(e,t){var i=this.el.getObject3D("mesh");i&&i.mixer&&i.mixer.update(t/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var e=this.el;e.addEventListener("gripdown",this.onGripDown),e.addEventListener("gripup",this.onGripUp),e.addEventListener("trackpaddown",this.onTrackpadDown),e.addEventListener("trackpadup",this.onTrackpadUp),e.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),e.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),e.addEventListener("triggerdown",this.onTriggerDown),e.addEventListener("triggerup",this.onTriggerUp),e.addEventListener("triggertouchstart",this.onTriggerTouchStart),e.addEventListener("triggertouchend",this.onTriggerTouchEnd),e.addEventListener("griptouchstart",this.onGripTouchStart),e.addEventListener("griptouchend",this.onGripTouchEnd),e.addEventListener("thumbstickdown",this.onThumbstickDown),e.addEventListener("thumbstickup",this.onThumbstickUp),e.addEventListener("abuttontouchstart",this.onAorXTouchStart),e.addEventListener("abuttontouchend",this.onAorXTouchEnd),e.addEventListener("bbuttontouchstart",this.onBorYTouchStart),e.addEventListener("bbuttontouchend",this.onBorYTouchEnd),e.addEventListener("xbuttontouchstart",this.onAorXTouchStart),e.addEventListener("xbuttontouchend",this.onAorXTouchEnd),e.addEventListener("ybuttontouchstart",this.onBorYTouchStart),e.addEventListener("ybuttontouchend",this.onBorYTouchEnd),e.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),e.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var e=this.el;e.removeEventListener("gripdown",this.onGripDown),e.removeEventListener("gripup",this.onGripUp),e.removeEventListener("trackpaddown",this.onTrackpadDown),e.removeEventListener("trackpadup",this.onTrackpadUp),e.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),e.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),e.removeEventListener("triggerdown",this.onTriggerDown),e.removeEventListener("triggerup",this.onTriggerUp),e.removeEventListener("triggertouchstart",this.onTriggerTouchStart),e.removeEventListener("triggertouchend",this.onTriggerTouchEnd),e.removeEventListener("griptouchstart",this.onGripTouchStart),e.removeEventListener("griptouchend",this.onGripTouchEnd),e.removeEventListener("thumbstickdown",this.onThumbstickDown),e.removeEventListener("thumbstickup",this.onThumbstickUp),e.removeEventListener("abuttontouchstart",this.onAorXTouchStart),e.removeEventListener("abuttontouchend",this.onAorXTouchEnd),e.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),e.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),e.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),e.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),e.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),e.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),e.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),e.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(e){var t,i=this.el,n=this.data.hand,o=this.data.handModelStyle,a=this.data.color,s=this;if(t={hand:n,model:!1},n!==e){var l=r[o+n.charAt(0).toUpperCase()+n.slice(1)];this.loader.load(l,(function(e){var r=e.scene.children[0],o="left"===n?Math.PI/2:-Math.PI/2;r.mixer=new THREE.AnimationMixer(r),s.clips=e.animations,i.setObject3D("mesh",r),r.children[1].material.color=new THREE.Color(a),r.position.set(0,0,0),r.rotation.set(0,0,o),i.setAttribute("magicleap-controls",t),i.setAttribute("vive-controls",t),i.setAttribute("oculus-touch-controls",t),i.setAttribute("windows-motion-controls",t)}))}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(e,t){var i,n="down"===t,r="touchstart"===t;if(0===t.indexOf("touch")){if(r===this.touchedButtons[e])return;this.touchedButtons[e]=r}else{if(n===this.pressedButtons[e])return;this.pressedButtons[e]=n}i=this.gesture,this.gesture=this.determineGesture(),this.gesture!==i&&(this.animateGesture(this.gesture,i),this.emitGestureEvents(this.gesture,i))},determineGesture:function(){var e,t,i,n=this.pressedButtons.grip,r=this.pressedButtons.surface||this.touchedButtons.surface,o=this.pressedButtons.trackpad||this.touchedButtons.trackpad,u=this.pressedButtons.trigger||this.touchedButtons.trigger,d=this.touchedButtons.AorX||this.touchedButtons.BorY;return t=this.el.components["tracked-controls"],(i=t&&t.controller)&&(i.id&&0===i.id.indexOf("OpenVR ")||i.profiles&&i.profiles[0]&&"htc-vive-controller-mv"===i.profiles[0])?n||u?e=l:o&&(e=a):n?e=r||d||o?u?l:a:u?h:s:u&&(e=c),e},getClip:function(e){var t,i;for(i=0;i<this.clips.length;i++)if((t=this.clips[i]).name===e)return t},animateGesture:function(e,t){e?this.playAnimation(e||o,t,!1):this.playAnimation(t,t,!0)},emitGestureEvents:function(e,t){var i,n=this.el;t!==e&&((i=d(t,!1))&&n.emit(i),(i=d(e,!0))&&n.emit(i))},playAnimation:function(e,t,i){var n,r,o,a=this.el.getObject3D("mesh");if(a){if(a.mixer.stopAllAction(),n=this.getClip(e),(o=a.mixer.clipAction(n)).clampWhenFinished=!0,o.loop=THREE.LoopRepeat,o.repetitions=0,o.timeScale=i?-1:1,o.time=i?n.duration:0,o.weight=1,!t||e===t)return a.mixer.stopAllAction(),void o.play();n=this.getClip(t),(r=a.mixer.clipAction(n)).weight=.15,r.play(),o.play(),r.crossFadeTo(o,.15,!0)}}})},{"../core/component":109}],64:[function(e,t,i){e("./animation"),e("./camera"),e("./cursor"),e("./daydream-controls"),e("./gearvr-controls"),e("./geometry"),e("./generic-tracked-controller-controls"),e("./gltf-model"),e("./hand-controls"),e("./laser-controls"),e("./light"),e("./line"),e("./link"),e("./look-controls"),e("./magicleap-controls"),e("./material"),e("./obj-model"),e("./oculus-go-controls"),e("./oculus-touch-controls"),e("./position"),e("./raycaster"),e("./rotation"),e("./scale"),e("./shadow"),e("./sound"),e("./text"),e("./tracked-controls"),e("./tracked-controls-webvr"),e("./tracked-controls-webxr"),e("./visible"),e("./vive-controls"),e("./vive-focus-controls"),e("./wasd-controls"),e("./windows-motion-controls"),e("./scene/background"),e("./scene/debug"),e("./scene/device-orientation-permission-ui"),e("./scene/embedded"),e("./scene/inspector"),e("./scene/fog"),e("./scene/keyboard-shortcuts"),e("./scene/pool"),e("./scene/screenshot"),e("./scene/stats"),e("./scene/vr-mode-ui")},{"./animation":55,"./camera":56,"./cursor":57,"./daydream-controls":58,"./gearvr-controls":59,"./generic-tracked-controller-controls":60,"./geometry":61,"./gltf-model":62,"./hand-controls":63,"./laser-controls":65,"./light":66,"./line":67,"./link":68,"./look-controls":69,"./magicleap-controls":70,"./material":71,"./obj-model":72,"./oculus-go-controls":73,"./oculus-touch-controls":74,"./position":75,"./raycaster":76,"./rotation":77,"./scale":78,"./scene/background":79,"./scene/debug":80,"./scene/device-orientation-permission-ui":81,"./scene/embedded":82,"./scene/fog":83,"./scene/inspector":84,"./scene/keyboard-shortcuts":85,"./scene/pool":86,"./scene/screenshot":87,"./scene/stats":88,"./scene/vr-mode-ui":89,"./shadow":90,"./sound":91,"./text":92,"./tracked-controls":95,"./tracked-controls-webvr":93,"./tracked-controls-webxr":94,"./visible":96,"./vive-controls":97,"./vive-focus-controls":98,"./wasd-controls":99,"./windows-motion-controls":100}],65:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/");n("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var e=this.config,t=this.data,i=this.el,n=this,o={hand:t.hand,model:t.model};function a(t){var o=e[t.detail.name];if(o){var a=r.extend({showLine:!0},o.raycaster||{});t.detail.rayOrigin&&(a.origin=t.detail.rayOrigin.origin,a.direction=t.detail.rayOrigin.direction,a.showLine=!0),t.detail.rayOrigin||!n.modelReady?i.setAttribute("raycaster",a):i.setAttribute("raycaster","showLine",!0),i.setAttribute("cursor",r.extend({fuse:!1},o.cursor))}}i.setAttribute("daydream-controls",o),i.setAttribute("gearvr-controls",o),i.setAttribute("magicleap-controls",o),i.setAttribute("oculus-go-controls",o),i.setAttribute("oculus-touch-controls",o),i.setAttribute("vive-controls",o),i.setAttribute("vive-focus-controls",o),i.setAttribute("windows-motion-controls",o),i.setAttribute("generic-tracked-controller-controls",o),i.addEventListener("controllerconnected",a),i.addEventListener("controllerdisconnected",(function(){i.setAttribute("raycaster","showLine",!1)})),i.addEventListener("controllermodelready",(function(e){a(e),n.modelReady=!0}))},config:{"daydream-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"gearvr-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:.001,z:0}}},"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},{"../core/component":109,"../utils/":182}],66:[function(e,t,i){var n=e("../utils/bind"),r=e("../utils").diff,o=e("../utils/debug"),a=e("../core/component").registerComponent,s=e("../lib/three"),l=s.Math.degToRad,c=o("components:light:warn");t.exports.Component=a("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color"},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var e=this.el;this.light=null,this.defaultTarget=null,this.rendererSystem=this.el.sceneEl.systems.renderer,this.system.registerLight(e)},update:function(e){var t=this.data,i=r(t,e),o=this.light,a=this.rendererSystem,s=this;if(!o||"type"in i)this.setLight(this.data),this.updateShadow();else{var c=!1;Object.keys(i).forEach((function(e){var i=t[e];switch(e){case"color":o.color.set(i),a.applyColorCorrection(o.color);break;case"groundColor":o.groundColor.set(i),a.applyColorCorrection(o.groundColor);break;case"angle":o.angle=l(i);break;case"target":null===i?"spot"!==t.type&&"directional"!==t.type||(o.target=s.defaultTarget):i.hasLoaded?s.onSetTarget(i,o):i.addEventListener("loaded",n(s.onSetTarget,s,i,o));break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":c||(s.updateShadow(),c=!0);break;default:o[e]=i}}))}},setLight:function(e){var t=this.el,i=this.getLight(e);i&&(this.light&&t.removeObject3D("light"),this.light=i,this.light.el=t,t.setObject3D("light",this.light),"spot"!==e.type&&"directional"!==e.type&&"hemisphere"!==e.type||t.getObject3D("light").translateY(-1),"spot"===e.type&&(t.setObject3D("light-target",this.defaultTarget),t.getObject3D("light-target").position.set(0,0,-1)))},updateShadow:function(){var e=this.el,t=this.data,i=this.light;i.castShadow=t.castShadow;var n=e.getObject3D("cameraHelper");if(t.shadowCameraVisible&&!n?e.setObject3D("cameraHelper",new s.CameraHelper(i.shadow.camera)):!t.shadowCameraVisible&&n&&e.removeObject3D("cameraHelper"),!t.castShadow)return i;i.shadow.bias=t.shadowBias,i.shadow.radius=t.shadowRadius,i.shadow.mapSize.height=t.shadowMapHeight,i.shadow.mapSize.width=t.shadowMapWidth,i.shadow.camera.near=t.shadowCameraNear,i.shadow.camera.far=t.shadowCameraFar,i.shadow.camera instanceof s.OrthographicCamera?(i.shadow.camera.top=t.shadowCameraTop,i.shadow.camera.right=t.shadowCameraRight,i.shadow.camera.bottom=t.shadowCameraBottom,i.shadow.camera.left=t.shadowCameraLeft):i.shadow.camera.fov=t.shadowCameraFov,i.shadow.camera.updateProjectionMatrix(),n&&n.update()},getLight:function(e){var t=e.angle,i=new s.Color(e.color);this.rendererSystem.applyColorCorrection(i),i=i.getHex();var r=e.decay,o=e.distance,a=new s.Color(e.groundColor);this.rendererSystem.applyColorCorrection(a),a=a.getHex();var h=e.intensity,u=e.type,d=e.target,p=null;switch(u.toLowerCase()){case"ambient":return new s.AmbientLight(i,h);case"directional":return p=new s.DirectionalLight(i,h),this.defaultTarget=p.target,d&&(d.hasLoaded?this.onSetTarget(d,p):d.addEventListener("loaded",n(this.onSetTarget,this,d,p))),p;case"hemisphere":return new s.HemisphereLight(i,a,h);case"point":return new s.PointLight(i,h,o,r);case"spot":return p=new s.SpotLight(i,h,o,l(t),e.penumbra,r),this.defaultTarget=p.target,d&&(d.hasLoaded?this.onSetTarget(d,p):d.addEventListener("loaded",n(this.onSetTarget,this,d,p))),p;default:c("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",u)}},onSetTarget:function(e,t){t.target=e.object3D},remove:function(){var e=this.el;e.removeObject3D("light"),e.getObject3D("cameraHelper")&&e.removeObject3D("cameraHelper")}})},{"../core/component":109,"../lib/three":157,"../utils":182,"../utils/bind":176,"../utils/debug":178}],67:[function(e,t,i){var n=e("../core/component").registerComponent;function r(e,t){return!(!e||!t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}t.exports.Component=n("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var e,t,i=this.data;this.rendererSystem=this.el.sceneEl.systems.renderer,t=this.material=new THREE.LineBasicMaterial({color:i.color,opacity:i.opacity,transparent:i.opacity<1,visible:i.visible}),(e=this.geometry=new THREE.BufferGeometry).addAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.rendererSystem.applyColorCorrection(t.color),this.line=new THREE.Line(e,t),this.el.setObject3D(this.attrName,this.line)},update:function(e){var t=this.data,i=this.geometry,n=!1,o=this.material,a=i.attributes.position.array;r(t.start,e.start)||(a[0]=t.start.x,a[1]=t.start.y,a[2]=t.start.z,n=!0),r(t.end,e.end)||(a[3]=t.end.x,a[4]=t.end.y,a[5]=t.end.z,n=!0),n&&(i.attributes.position.needsUpdate=!0,i.computeBoundingSphere()),o.color.setStyle(t.color),this.rendererSystem.applyColorCorrection(o.color),o.opacity=t.opacity,o.transparent=t.opacity<1,o.visible=t.visible},remove:function(){this.el.removeObject3D("line",this.line)}})},{"../core/component":109}],68:[function(e,t,i){var n,r,o,a,s,l,c,h,u=e("../core/component").registerComponent,d=e("../core/shader").registerShader,p=e("../lib/three");t.exports.Component=u("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new p.Quaternion,this.hiddenEls=[]},update:function(e){var t,i,n=this.data,r=this.el;n.visualAspectEnabled&&(this.initVisualAspect(),t=n.highlighted?n.highlightedColor:n.backgroundColor,i=n.highlighted?n.highlightedColor:n.borderColor,r.setAttribute("material","backgroundColor",t),r.setAttribute("material","strokeColor",i),n.on!==e.on&&this.updateEventListener(),void 0!==e.peekMode&&n.peekMode!==e.peekMode&&this.updatePeekMode(),n.image&&e.image!==n.image&&r.setAttribute("material","pano","string"==typeof n.image?n.image:n.image.src))},updatePeekMode:function(){var e=this.el,t=this.sphereEl;this.data.peekMode?(this.hideAll(),e.getObject3D("mesh").visible=!1,t.setAttribute("visible",!0)):(this.showAll(),e.getObject3D("mesh").visible=!0,t.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var e=this.el;e.isPlaying&&(this.removeEventListener(),e.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var e=this.data.on;e&&this.el.removeEventListener(e,this.navigate)},initVisualAspect:function(){var e,t,i,n=this.el;this.data.visualAspectEnabled&&!this.visualAspectInitialized&&(i=this.textEl=this.textEl||document.createElement("a-entity"),t=this.sphereEl=this.sphereEl||document.createElement("a-entity"),e=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),n.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),n.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),i.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),i.setAttribute("position","0 1.5 0"),n.appendChild(i),e.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),e.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),e.setAttribute("rotation","0 180 0"),e.setAttribute("position","0 0 0"),e.setAttribute("visible",!1),n.appendChild(e),t.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),t.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),t.setAttribute("visible",!1),n.appendChild(t),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:(s=new p.Vector3,l=new p.Vector3,c=new p.Quaternion,h=new p.Vector3,function(){var e,t,i=this.el,n=i.object3D,r=i.sceneEl.camera,o=this.textEl;if(this.data.visualAspectEnabled)if(n.updateMatrixWorld(),r.parent.updateMatrixWorld(),r.updateMatrixWorld(),n.matrix.decompose(l,c,h),l.setFromMatrixPosition(n.matrixWorld),s.setFromMatrixPosition(r.matrixWorld),(t=l.distanceTo(s))>20)this.previousQuaternion||(this.quaternionClone.copy(c),this.previousQuaternion=this.quaternionClone),n.lookAt(s);else{if(e=this.calculateCameraPortalOrientation(),t<.5){if(!0===this.semiSphereEl.getAttribute("visible"))return;o.setAttribute("text","width",1.5),e<=0?(o.setAttribute("position","0 0 0.75"),o.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(o.setAttribute("position","0 0 -0.75"),o.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),i.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=e}else e<=0?o.setAttribute("rotation","0 180 0"):o.setAttribute("rotation","0 0 0"),o.setAttribute("text","width",5),o.setAttribute("position","0 1.5 0"),i.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(n.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}),hideAll:function(){var e=this.el,t=this.hiddenEls,i=this;t.length>0||e.sceneEl.object3D.traverse((function(n){n&&n.el&&n.el.hasAttribute("link-controls")||n.el&&n!==e.sceneEl.object3D&&n.el!==e&&n.el!==i.sphereEl&&n.el!==e.sceneEl.cameraEl&&!1!==n.el.getAttribute("visible")&&n.el!==i.textEl&&n.el!==i.semiSphereEl&&(n.el.setAttribute("visible",!1),t.push(n.el))}))},showAll:function(){this.hiddenEls.forEach((function(e){e.setAttribute("visible",!0)})),this.hiddenEls=[]},calculateCameraPortalOrientation:(n=new p.Matrix4,r=new p.Vector3,o=new p.Vector3(0,0,1),a=new p.Vector3(0,0,0),function(){var e=this.el,t=e.sceneEl.camera;return r.set(0,0,0),o.set(0,0,1),a.set(0,0,0),e.object3D.matrixWorld.extractRotation(n),o.applyMatrix4(n),e.object3D.updateMatrixWorld(),e.object3D.localToWorld(a),t.parent.parent.updateMatrixWorld(),t.parent.updateMatrixWorld(),t.updateMatrixWorld(),t.localToWorld(r),r.sub(a).normalize(),o.normalize(),Math.sign(o.dot(r))}),remove:function(){this.removeEventListener()}}),d("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = saturate(direction.y * 0.5  + 0.5);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join("\n")})},{"../core/component":109,"../core/shader":119,"../lib/three":157}],69:[function(e,t,i){var n,r=e("../core/component").registerComponent,o=e("../lib/three"),a=e("../utils/"),s=a.bind;Math.PI,t.exports.Component=r("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},hmdEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new o.Vector3,this.hmdQuaternion=new o.Quaternion,this.magicWindowAbsoluteEuler=new o.Euler,this.magicWindowDeltaEuler=new o.Euler,this.position=new o.Vector3,this.savedRotation=new o.Vector3,this.savedPosition=new o.Vector3,this.magicWindowObject=new o.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.setupMagicWindowControls(),this.savedPose={position:new o.Vector3,rotation:new o.Euler},this.el.emit("look-controls-loaded",{"look-controls":this}),this.el.sceneEl.is("vr-mode")&&this.onEnterVR()},setupMagicWindowControls:function(){var e;a.device.isMobile()&&(e=this.magicWindowControls=new o.DeviceOrientationControls(this.magicWindowObject),"undefined"!=typeof DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission&&(e.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?e.enabled=!0:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",(function(){e.enabled=!0}))))},update:function(e){var t=this.data;t.enabled!==e.enabled&&this.updateGrabCursor(t.enabled),!e||t.hmdEnabled||e.hmdEnabled||(this.pitchObject.rotation.set(0,0,0),this.yawObject.rotation.set(0,0,0)),e&&!t.pointerLockEnabled!==e.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(e){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=s(this.onMouseDown,this),this.onMouseMove=s(this.onMouseMove,this),this.onMouseUp=s(this.onMouseUp,this),this.onTouchStart=s(this.onTouchStart,this),this.onTouchMove=s(this.onTouchMove,this),this.onTouchEnd=s(this.onTouchEnd,this),this.onEnterVR=s(this.onEnterVR,this),this.onExitVR=s(this.onExitVR,this),this.onPointerLockChange=s(this.onPointerLockChange,this),this.onPointerLockError=s(this.onPointerLockError,this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new o.Object3D,this.yawObject=new o.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),t.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),e.addEventListener("enter-vr",this.onEnterVR),e.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):e.addEventListener("render-target-loaded",s(this.addEventListeners,this))},removeEventListeners:function(){var e=this.el.sceneEl,t=e&&e.canvas;t&&(t.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("enter-vr",this.onEnterVR),e.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:(n=new o.Matrix4,function(){var e,t=this.el.object3D,i=this.pitchObject,r=this.yawObject,o=this.el.sceneEl;o.is("vr-mode")&&o.checkHeadsetConnected()?o.hasWebXR&&(e=o.renderer.xr.getCameraPose())&&(n.elements=e.transform.matrix,n.decompose(t.position,t.rotation,t.scale)):(this.updateMagicWindowOrientation(),t.rotation.x=this.magicWindowDeltaEuler.x+i.rotation.x,t.rotation.y=this.magicWindowDeltaEuler.y+r.rotation.y,t.rotation.z=this.magicWindowDeltaEuler.z)}),updateMagicWindowOrientation:function(){var e=this.magicWindowAbsoluteEuler,t=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),e.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),this.previousMagicWindowYaw||0===e.y||(this.previousMagicWindowYaw=e.y),this.previousMagicWindowYaw&&(t.x=e.x,t.y+=e.y-this.previousMagicWindowYaw,t.z=e.z,this.previousMagicWindowYaw=e.y))},onMouseMove:function(e){var t,i,n,r=this.pitchObject,o=this.previousMouseEvent,a=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(i=e.movementX||e.mozMovementX||0,n=e.movementY||e.mozMovementY||0):(i=e.screenX-o.screenX,n=e.screenY-o.screenY),this.previousMouseEvent=e,t=this.data.reverseMouseDrag?1:-1,a.rotation.y+=.002*i*t,r.rotation.x+=.002*n*t)},onMouseDown:function(e){var t=this.el.sceneEl;if(!(!this.data.enabled||t.is("vr-mode")&&t.checkHeadsetConnected())&&0===e.button){var i=t&&t.canvas;this.mouseDown=!0,this.previousMouseEvent=e,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(i.requestPointerLock?i.requestPointerLock():i.mozRequestPointerLock&&i.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(e){1===e.touches.length&&this.data.touchEnabled&&!this.el.sceneEl.is("vr-mode")&&(this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(e){var t,i,n=this.el.sceneEl.canvas,r=this.yawObject;if(this.touchStarted&&this.data.touchEnabled){i=2*Math.PI*(e.touches[0].pageX-this.touchStart.x)/n.clientWidth,t=this.data.reverseTouchDrag?1:-1,r.rotation.y-=.5*i*t;var o=2*Math.PI*(e.touches[0].pageY-this.touchStart.y)/n.clientHeight;this.pitchObject.rotation.x-=.5*o*t,this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY}}},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var e=this.el.sceneEl;e.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),e.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(e){var t=this.el.sceneEl;function i(){t.canvas.classList.add("a-grab-cursor")}function n(){t.canvas.classList.remove("a-grab-cursor")}t.canvas?e?i():n():e?t.addEventListener("render-target-loaded",i):t.addEventListener("render-target-loaded",n)},saveCameraPose:function(){var e=this.el;this.savedPose.position.copy(e.object3D.position),this.savedPose.rotation.copy(e.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var e=this.el,t=this.savedPose;this.hasSavedPose&&(e.object3D.position.copy(t.position),e.object3D.rotation.copy(t.rotation),this.hasSavedPose=!1)}})},{"../core/component":109,"../lib/three":157,"../utils/":182}],70:[function(e,t,i){var n=e("../utils/bind"),r=e("../core/component").registerComponent,o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c="magicleap-one";t.exports.Component=r("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var e=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=n(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=n(this.onModelLoaded,this),this.onControllersUpdate=n(this.onControllersUpdate,this),this.checkIfControllerPresent=n(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=n(this.removeControllersUpdateListener,this),this.onAxisMoved=n(this.onAxisMoved,this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;a(this,c,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:c,hand:t.hand,controller:this.controllerIndex,orientationOffset:t.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/magicleap/magicleap-one-controller.glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,i=this.mapping.buttons[e.detail.id];i&&("trigger"===i&&(t=e.detail.state.value,console.log("analog value of trigger press: "+t)),this.el.emit(i+"changed",e.detail.state))},onModelLoaded:function(e){e.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(e){s(this,this.mapping.axes,e)},updateModel:function(e,t){},setButtonColor:function(e,t){}})},{"../core/component":109,"../utils/bind":176,"../utils/tracked-controls":190}],71:[function(e,t,i){var n=e("../utils/"),r=e("../core/component"),o=e("../lib/three"),a=e("../core/shader"),s=n.debug("components:material:error"),l=r.registerComponent,c=a.shaders,h=a.shaderNames;function u(e,t){e.dispose(),t.unregisterMaterial(e)}t.exports.Component=l("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:h,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColors:{type:"string",default:"none",oneOf:["face","vertex"]},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0}},init:function(){this.material=null},update:function(e){var t=this.data;this.shader&&t.shader===e.shader||this.updateShader(t.shader),this.shader.update(this.data),this.updateMaterial(e)},updateSchema:function(e){var t,i,n,r;i=e&&e.shader,t=this.oldData&&this.oldData.shader,(n=c[r=i||t]&&c[r].schema)||s("Unknown shader schema "+r),t&&i===t||(this.extendSchema(n),this.updateBehavior())},updateBehavior:function(){var e,t,i=this.el.sceneEl,n=this.schema,r=this;function o(e,i){var n;for(n in t)t[n]=e;r.shader.update(t)}for(e in this.tick=void 0,t={},n)"time"===n[e].type&&(this.tick=o,t[e]=!0);i&&(this.tick?i.addBehavior(this):i.removeBehavior(this))},updateShader:function(e){var t,i=this.data,n=c[e]&&c[e].Shader;if(!n)throw new Error("Unknown shader "+e);(t=this.shader=new n).el=this.el,t.init(i),this.setMaterial(t.material),this.updateSchema(i)},updateMaterial:function(e){var t,i=this.data,n=this.material;for(t in n.alphaTest=i.alphaTest,n.depthTest=!1!==i.depthTest,n.depthWrite=!1!==i.depthWrite,n.opacity=i.opacity,n.flatShading=i.flatShading,n.side=function(e){switch(e){case"back":return o.BackSide;case"double":return o.DoubleSide;default:return o.FrontSide}}(i.side),n.transparent=!1!==i.transparent||i.opacity<1,n.vertexColors=function(e){switch(e){case"face":return o.FaceColors;case"vertex":return o.VertexColors;default:return o.NoColors}}(i.vertexColors),n.visible=i.visible,n.blending=function(e){switch(e){case"none":return o.NoBlending;case"additive":return o.AdditiveBlending;case"subtractive":return o.SubtractiveBlending;case"multiply":return o.MultiplyBlending;default:return o.NormalBlending}}(i.blending),n.dithering=i.dithering,e)break;!t||e.alphaTest===i.alphaTest&&e.side===i.side&&e.vertexColors===i.vertexColors||(n.needsUpdate=!0)},remove:function(){var e=new o.MeshBasicMaterial,t=this.material,i=this.el.getObject3D("mesh");i&&(i.material=e),u(t,this.system)},setMaterial:function(e){var t,i=this.el,n=this.system;this.material&&u(this.material,n),this.material=e,n.registerMaterial(e),(t=i.getObject3D("mesh"))?t.material=e:i.addEventListener("object3dset",(function t(n){"mesh"===n.detail.type&&n.target===i&&(i.getObject3D("mesh").material=e,i.removeEventListener("object3dset",t))}))}})},{"../core/component":109,"../core/shader":119,"../lib/three":157,"../utils/":182}],72:[function(e,t,i){var n=e("../utils/debug"),r=e("../core/component").registerComponent,o=e("../lib/three"),a=n("components:obj-model:warn");t.exports.Component=r("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var e=this;this.model=null,this.objLoader=new o.OBJLoader,this.mtlLoader=new o.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",(function(t){e.model&&"material"===t.detail.name&&e.applyMaterial()}))},update:function(){var e=this.data;e.obj&&(this.resetMesh(),this.loadObj(e.obj,e.mtl))},remove:function(){this.model&&this.resetMesh()},resetMesh:function(){this.el.removeObject3D("mesh")},loadObj:function(e,t){var i=this,n=this.el,r=this.mtlLoader,o=this.objLoader,s=this.el.sceneEl.systems.renderer,l=t.substr(0,t.lastIndexOf("/")+1);if(t)return n.hasAttribute("material")&&a("Material component properties are ignored when a .MTL is provided"),r.setResourcePath(l),void r.load(t,(function(t){t.preload(),o.setMaterials(t),o.load(e,(function(e){i.model=e,i.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&s.applyColorCorrection(t.color),t.map&&s.applyColorCorrection(t.map),t.emissive&&s.applyColorCorrection(t.emissive),t.emissiveMap&&s.applyColorCorrection(t.emissiveMap)}})),n.setObject3D("mesh",e),n.emit("model-loaded",{format:"obj",model:e})}))}));o.load(e,(function(e){i.model=e,i.applyMaterial(),n.setObject3D("mesh",e),n.emit("model-loaded",{format:"obj",model:e})}))},applyMaterial:function(){var e=this.el.components.material;e&&this.model.traverse((function(t){t instanceof o.Mesh&&(t.material=e.material)}))}})},{"../core/component":109,"../lib/three":157,"../utils/debug":178}],73:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/bind"),o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c=e("../utils/").device.isWebXRAvailable,h=c?"oculus-go":"Oculus Go",u=c?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]};t.exports.Component=n("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:u,bindMethods:function(){this.onModelLoaded=r(this.onModelLoaded,this),this.onControllersUpdate=r(this.onControllersUpdate,this),this.checkIfControllerPresent=r(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=r(this.removeControllersUpdateListener,this),this.onAxisMoved=r(this.onAxisMoved,this)},init:function(){var e=this;this.onButtonChanged=r(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){a(this,h,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{armModel:t.armModel,hand:t.hand,idPrefix:h,orientationOffset:t.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var t,i=e.detail.model;this.data.model&&((t=this.buttonMeshes={}).trigger=i.getObjectByName("oculus_go_button_trigger"),t.trackpad=i.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){s(this,this.mapping.axes,e)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var i=this.buttonMeshes;if(i&&i[e]){var n,r;switch(t){case"down":n=this.data.buttonHighlightColor;break;case"touchstart":n=this.data.buttonTouchedColor;break;default:n=this.data.buttonColor}(r=i[e]).material.color.set(n),this.rendererSystem.applyColorCorrection(r.material.color)}}})},{"../core/component":109,"../utils/":182,"../utils/bind":176,"../utils/tracked-controls":190}],74:[function(e,t,i){var n=e("../utils/bind"),r=e("../core/component").registerComponent,o=e("../lib/three"),a=e("../utils/tracked-controls"),s=a.checkControllerPresentAndSetup,l=a.emitIfAxesChanged,c=a.onButtonEvent,h=e("../utils/").device.isOculusBrowser(),u=e("../utils/").device.isWebXRAvailable,d="oculus-touch",p=u?d:"Oculus Touch",f="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-",m=f,v={left:{modelUrl:f+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new o.Vector3(-.005,.003,-.055),modelPivotRotation:new o.Euler(0,0,0)},right:{modelUrl:f+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new o.Vector3(.005,.003,-.055),modelPivotRotation:new o.Euler(0,0,0)}},g={left:{modelUrl:f+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new o.Vector3(-.005,.036,-.037),modelPivotRotation:new o.Euler(Math.PI/4.5,0,0)},right:{modelUrl:f+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new o.Vector3(.005,.036,-.037),modelPivotRotation:new o.Euler(Math.PI/4.5,0,0)}},y={"oculus-touch":u?g:v,"oculus-touch-v2":{left:{modelUrl:m+"gen2-left.gltf",rayOrigin:{origin:{x:-.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new o.Vector3(0,0,0),modelPivotRotation:new o.Euler(0,0,0)},right:{modelUrl:m+"gen2-right.gltf",rayOrigin:{origin:{x:.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new o.Vector3(0,0,0),modelPivotRotation:new o.Euler(0,0,0)}}},b=u?{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}}:{left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}};t.exports.Component=r("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},mapping:b,bindMethods:function(){this.onModelLoaded=n(this.onModelLoaded,this),this.onControllersUpdate=n(this.onControllersUpdate,this),this.checkIfControllerPresent=n(this.checkIfControllerPresent,this),this.onAxisMoved=n(this.onAxisMoved,this)},init:function(){var e=this;this.onButtonChanged=n(this.onButtonChanged,this),this.onButtonDown=function(t){c(t.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(t){c(t.detail.id,"up",e,e.data.hand)},this.onButtonTouchStart=function(t){c(t.detail.id,"touchstart",e,e.data.hand)},this.onButtonTouchEnd=function(t){c(t.detail.id,"touchend",e,e.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){s(this,p,{hand:this.data.hand})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(){var e=this.data;if(e.model){if(this.displayModel=y[e.controllerType]||y["oculus-touch"],"auto"===e.controllerType){var t=this.el.sceneEl.systems["tracked-controls-webvr"];if(t&&t.vrDisplay){var i=t.vrDisplay.displayName;/^Oculus Quest$/.test(i)&&(this.displayModel=y["oculus-touch-v2"])}h&&(this.displayModel=y["oculus-touch-v2"])}var n=this.displayModel[e.hand].modelUrl;this.el.setAttribute("gltf-model",n)}},injectTrackedControls:function(){var e=this.data,t=d,i="right"===e.hand?"Oculus Touch (Right)":"Oculus Touch (Left)",n=u?t:i;this.el.setAttribute("tracked-controls",{id:n,hand:e.hand,orientationOffset:e.orientationOffset}),this.loadModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,i=this.mapping[this.data.hand].buttons[e.detail.id],n=this.buttonMeshes;i&&("trigger"!==i&&"grip"!==i||(t=e.detail.state.value),n&&("trigger"===i&&n.trigger&&(n.trigger.rotation.x=this.originalXRotationTrigger-t*(Math.PI/26)),"grip"===i&&n.grip&&(n.grip.position.x=this.originalXPositionGrip+("left"===this.data.hand?-1:1)*t*.004)),this.el.emit(i+"changed",e.detail.state))},onModelLoaded:function(e){var t,i=e.detail.model;this.data.model&&((t=this.buttonMeshes={}).grip=i.getObjectByName("buttonHand"),this.originalXPositionGrip=t.grip.position.x,t.thumbstick=i.getObjectByName("stick"),t.trigger=i.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=t.trigger.rotation.x,t.xbutton=i.getObjectByName("buttonX"),t.abutton=i.getObjectByName("buttonA"),t.ybutton=i.getObjectByName("buttonY"),t.bbutton=i.getObjectByName("buttonB"),i.position.copy(this.displayModel[this.data.hand].modelPivotOffset),i.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin}))},onAxisMoved:function(e){l(this,this.mapping[this.data.hand].axes,e)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var i,n="up"===t||"touchend"===t?this.data.buttonColor:"touchstart"===t?this.data.buttonTouchColor:this.data.buttonHighlightColor,r=this.buttonMeshes;this.data.model&&r&&r[e]&&((i=r[e]).material.color.set(n),this.rendererSystem.applyColorCorrection(i.material.color))}})},{"../core/component":109,"../lib/three":157,"../utils/":182,"../utils/bind":176,"../utils/tracked-controls":190}],75:[function(e,t,i){var n=e("../core/component").registerComponent;t.exports.Component=n("position",{schema:{type:"vec3"},update:function(){var e=this.el.object3D,t=this.data;e.position.set(t.x,t.y,t.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},{"../core/component":109}],76:[function(e,t,i){var n,r,o=e("../core/component").registerComponent,a=e("../lib/three"),s=e("../utils/").debug("components:raycaster:warn"),l=/^[\w\s-.,[\]#]*$/,c={childList:!0,attributes:!0,subtree:!0},h="raycaster-intersected",u="raycaster-intersection",d="raycaster-intersected-cleared",p="raycaster-intersection-cleared";function f(e,t){var i;for(e.length=t.length,i=0;i<t.length;i++)e[i]=t[i]}t.exports.Component=o("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new a.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new a.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new a.Vector3,this.otherLineEndVec3=new a.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(e){var t=this.data,i=this.el,n=this.raycaster;n.far=t.far,n.near=t.near,!t.showLine||t.far===e.far&&t.origin===e.origin&&t.direction===e.direction&&e.showLine||(this.unitLineEndVec3.copy(t.origin).add(t.direction).normalize(),this.drawLine()),!t.showLine&&e.showLine&&i.removeAttribute("line"),t.objects===e.objects||l.test(t.objects)||s('[raycaster] Selector "'+t.objects+'" may not update automatically with DOM changes.'),t.objects||s('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),t.autoRefresh!==e.autoRefresh&&i.isPlaying&&(t.autoRefresh?this.addEventListeners():this.removeEventListeners()),e.enabled&&!t.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,c),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var e,t=this.data;e=t.objects?this.el.sceneEl.querySelectorAll(t.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(e),this.dirty=!1},tick:function(e){var t=this.data,i=this.prevCheckTime;t.enabled&&(i&&e-i<t.interval||(this.prevCheckTime=e,this.checkIntersections()))},checkIntersections:function(){var e,t,i=this.clearedIntersectedEls,n=this.el,r=this.data,o=this.intersectedEls,a=this.intersections,s=this.newIntersectedEls,l=this.newIntersections,c=this.prevIntersectedEls,m=this.rawIntersections;for(this.dirty&&this.refreshObjects(),f(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),m.length=0,this.raycaster.intersectObjects(this.objects,!0,m),a.length=0,o.length=0,e=0;e<m.length;e++)t=m[e],r.showLine&&t.object===n.getObject3D("line")||t.object.el&&(a.push(t),o.push(t.object.el));for(l.length=0,s.length=0,e=0;e<a.length;e++)-1===c.indexOf(a[e].object.el)&&(l.push(a[e]),s.push(a[e].object.el));for(i.length=0,e=0;e<c.length;e++)-1===o.indexOf(c[e])&&(c[e].emit(d,this.intersectedClearedDetail),i.push(c[e]));for(i.length&&n.emit(p,this.intersectionClearedDetail),e=0;e<s.length;e++)s[e].emit(h,this.intersectedDetail);l.length&&(this.intersectionDetail.els=s,this.intersectionDetail.intersections=l,n.emit(u,this.intersectionDetail)),r.showLine&&setTimeout(this.updateLine)},updateLine:function(){var e,t=this.el,i=this.intersections;i.length&&(e=i[0].object.el===t&&i[1]?i[1].distance:i[0].distance),this.drawLine(e)},getIntersection:function(e){var t,i;for(t=0;t<this.intersections.length;t++)if((i=this.intersections[t]).object.el===e)return i;return null},updateOriginDirection:(n=new a.Vector3,r=new a.Vector3,function(){var e=this.el,t=this.data;t.useWorldCoordinates?this.raycaster.set(t.origin,t.direction):(e.object3D.getWorldPosition(r),0===t.origin.x&&0===t.origin.y&&0===t.origin.z||(r=e.object3D.localToWorld(r.copy(t.origin))),n.copy(t.direction).transformDirection(e.object3D.matrixWorld).normalize(),this.raycaster.set(r,n))}),drawLine:function(e){var t,i=this.data,n=this.el;t=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,void 0===e&&(e=i.far===1/0?1e3:i.far),this.lineData.start=i.origin,this.lineData.end=t.copy(this.unitLineEndVec3).multiplyScalar(e),n.setAttribute("line",this.lineData)},flattenObject3DMaps:function(e){var t,i,n=this.objects;for(n.length=0,i=0;i<e.length;i++)if(e[i].isEntity&&e[i].object3D)for(t in e[i].object3DMap)n.push(e[i].getObject3D(t));return n},clearAllIntersections:function(){var e;for(e=0;e<this.intersectedEls.length;e++)this.intersectedEls[e].emit(d,this.intersectedClearedDetail);f(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(p,this.intersectionClearedDetail)}})},{"../core/component":109,"../lib/three":157,"../utils/":182}],77:[function(e,t,i){var n=e("../lib/three").Math.degToRad,r=e("../core/component").registerComponent;t.exports.Component=r("rotation",{schema:{type:"vec3"},update:function(){var e=this.data,t=this.el.object3D;t.rotation.set(n(e.x),n(e.y),n(e.z)),t.rotation.order="YXZ"},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},{"../core/component":109,"../lib/three":157}],78:[function(e,t,i){var n=e("../core/component").registerComponent,r=1e-5;t.exports.Component=n("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var e=this.data,t=this.el.object3D,i=0===e.x?r:e.x,n=0===e.y?r:e.y,o=0===e.z?r:e.z;t.scale.set(i,n,o)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},{"../core/component":109}],79:[function(e,t,i){var n=e("../../core/component").registerComponent;t.exports.Component=n("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},update:function(){var e=this.data,t=this.el.object3D;e.transparent?t.background=null:t.background=new THREE.Color(e.color)}})},{"../../core/component":109}],80:[function(e,t,i){var n=e("../../core/component").registerComponent;t.exports.Component=n("debug",{schema:{default:!0}})},{"../../core/component":109}],81:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../utils/").bind,o=e("../../constants/"),a="a-modal",s="a-dialog",l="a-dialog-text",c="a-dialog-text-container",h="a-dialog-buttons-container",u="a-dialog-button";function d(e,t){var i,n;return(i=document.createElement("div")).classList.add(h),(n=document.createElement("button")).classList.add(u,"a-dialog-ok-button"),n.setAttribute(o.AFRAME_INJECTED,""),n.innerHTML="Close",i.appendChild(n),n.addEventListener("click",(function(e){e.stopPropagation(),t()})),p(e,i)}function p(e,t){var i,n,r,h;return(i=document.createElement("div")).classList.add(a),i.setAttribute(o.AFRAME_INJECTED,""),(n=document.createElement("div")).className=s,n.setAttribute(o.AFRAME_INJECTED,""),i.appendChild(n),n.style.borderRadius="15px",(r=document.createElement("div")).classList.add(c),n.appendChild(r),(h=document.createElement("div")).classList.add(l),h.innerHTML=e,r.appendChild(h),n.appendChild(t),i}t.exports.Component=n("device-orientation-permission-ui",{schema:{enabled:{default:!0}},init:function(){var e=this;this.data.enabled&&("localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&"http:"===location.protocol&&this.showHTTPAlert(),"undefined"!=typeof DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission?(this.onDeviceMotionDialogAllowClicked=r(this.onDeviceMotionDialogAllowClicked,this),this.onDeviceMotionDialogDenyClicked=r(this.onDeviceMotionDialogDenyClicked,this),DeviceOrientationEvent.requestPermission().catch((function(){var t,i,n,r,a,s;e.devicePermissionDialogEl=(t="MAKAR Web XR requires access to your device motion sensors",i=e.onDeviceMotionDialogAllowClicked,n=e.onDeviceMotionDialogDenyClicked,(r=document.createElement("div")).classList.add(h),(a=document.createElement("button")).classList.add(u,"a-dialog-deny-button"),a.setAttribute(o.AFRAME_INJECTED,""),a.innerHTML="Deny",(s=document.createElement("button")).classList.add(u,"a-dialog-allow-button"),s.setAttribute(o.AFRAME_INJECTED,""),s.style.position="absolute",s.style.width="50%",s.style.height="30%",s.style.left="25%",s.style.bottom="16px",s.style.borderRadius="8px",s.style.backgroundColor="#3973ED",s.style.color="#ffffff",s.innerHTML="同意",r.appendChild(s),s.addEventListener("click",(function(e){e.stopPropagation(),i()})),a.addEventListener("click",(function(e){e.stopPropagation(),n()})),p(t,r)),e.el.appendChild(e.devicePermissionDialogEl)})).then((function(){e.el.emit("deviceorientationpermissiongranted"),e.permissionGranted=!0}))):this.permissionGranted=!0)},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showMobileDesktopModeAlert:function(){var e=this,t=d("Set your browser to request the mobile version of the site and reload the page to enjoy immersive mode.",(function(){e.el.removeChild(t)}));this.el.appendChild(t)},showHTTPAlert:function(){var e=this,t=d("Access this site over HTTPS to enter VR mode and grant access to the device sensors.",(function(){e.el.removeChild(t)}));this.el.appendChild(t)},onDeviceMotionDialogAllowClicked:function(){var e=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t?(e.el.emit("deviceorientationpermissiongranted"),e.permissionGranted=!0):e.el.emit("deviceorientationpermissionrejected"),e.remove()})).catch(console.error)}})},{"../../constants/":101,"../../core/component":109,"../../utils/":182}],82:[function(e,t,i){var n=e("../../core/component").registerComponent;t.exports.Component=n("embedded",{dependencies:["vr-mode-ui"],schema:{default:!0},update:function(){var e=this.el,t=e.querySelector(".a-enter-vr");!0===this.data?(t&&t.classList.add("embedded"),e.removeFullScreenStyles()):(t&&t.classList.remove("embedded"),e.addFullScreenStyles())}})},{"../../core/component":109}],83:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../lib/three"),o=e("../../utils/debug")("components:fog:warn");t.exports.Component=n("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},update:function(){var e=this.data,t=this.el,i=this.el.object3D.fog;if(t.isScene)return i&&e.type===i.name?void Object.keys(this.schema).forEach((function(t){var n=e[t];"color"===t&&(n=new r.Color(n)),i[t]=n})):(t.object3D.fog=function(e){var t;return(t="exponential"===e.type?new r.FogExp2(e.color,e.density):new r.Fog(e.color,e.near,e.far)).name=e.type,t}(e),void t.systems.material.updateMaterials());o("Fog component can only be applied to <a-scene>")},remove:function(){var e=this.el.object3D.fog;e&&(e.far=0,e.near=.1)}})},{"../../core/component":109,"../../lib/three":157,"../../utils/debug":178}],84:[function(e,t,i){(function(i){var n=e("../../constants").AFRAME_INJECTED,r=e("../../../package"),o=e("../../core/component").registerComponent,a=e("../../utils/");var s,l,c="https://unpkg.com/aframe-inspector@"+(s=r.version,(l=s.split("."))[2]="x",l.join(".")+"/dist/aframe-inspector.min.js"),h="dev"===i.env.INSPECTOR_VERSION?"https://aframe.io/aframe-inspector/dist/aframe-inspector.js":c;t.exports.Component=o("inspector",{schema:{url:{default:h}},init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var e;this.firstPlay&&"false"!==(e=a.getUrlParameter("inspector"))&&e&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(e){73===e.keyCode&&e.ctrlKey&&e.altKey&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(e){"INJECT_AFRAME_INSPECTOR"===e.data&&this.openInspector()},openInspector:function(e){var t,i=this;AFRAME.INSPECTOR||AFRAME.inspectorInjected?AFRAME.INSPECTOR.open(e):(this.showLoader(),(t=document.createElement("script")).src=this.data.url,t.setAttribute("data-name","aframe-inspector"),t.setAttribute(n,""),t.onload=function(){AFRAME.INSPECTOR.open(e),i.hideLoader(),i.removeEventListeners()},t.onerror=function(){i.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(t),AFRAME.inspectorInjected=!0)},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})}).call(this,e("_process"))},{"../../../package":54,"../../constants":101,"../../core/component":109,"../../utils/":182,_process:5}],85:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../utils/").shouldCaptureKeyEvent;t.exports.Component=n("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(e){var t=this.data;this.enterVREnabled=t.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(e){var t=this.el;r(e)&&(this.enterVREnabled&&70===e.keyCode&&t.enterVR(),this.enterVREnabled&&27===e.keyCode&&t.exitVR())}})},{"../../core/component":109,"../../utils/":182}],86:[function(e,t,i){var n=e("../../utils/debug"),r=e("../../core/component").registerComponent,o=n("components:pool:warn");t.exports.Component=r("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},multiple:!0,initPool:function(){var e;for(this.availableEls=[],this.usedEls=[],this.data.mixin||o("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||o("Container "+this.data.container+" not found.")),this.container=this.container||this.el,e=0;e<this.data.size;++e)this.createEntity()},update:function(e){var t=this.data;e.mixin===t.mixin&&e.size===t.size||this.initPool()},createEntity:function(){var e;(e=document.createElement("a-entity")).play=this.wrapPlay(e.play),e.setAttribute("mixin",this.data.mixin),e.object3D.visible=!1,e.pause(),this.container.appendChild(e),this.availableEls.push(e)},wrapPlay:function(e){var t=this.usedEls;return function(){-1!==t.indexOf(this)&&e.call(this)}},requestEntity:function(){var e;if(0===this.availableEls.length){if(!1===this.data.dynamic)return void o("Requested entity from empty pool: "+this.attrName);o("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return e=this.availableEls.shift(),this.usedEls.push(e),e.object3D.visible=!0,e},returnEntity:function(e){var t=this.usedEls.indexOf(e);if(-1!==t)return this.usedEls.splice(t,1),this.availableEls.push(e),e.object3D.visible=!1,e.pause(),e;o("The returned entity was not previously pooled from "+this.attrName)}})},{"../../core/component":109,"../../utils/debug":178}],87:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../lib/three"),o=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),a=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join("\n");t.exports.Component=n("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},init:function(){var e=this.el,t=this;function i(){var i=e.renderer.getContext();i&&(t.cubeMapSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),t.material=new r.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:o,fragmentShader:a,side:r.DoubleSide}),t.quad=new r.Mesh(new r.PlaneBufferGeometry(1,1),t.material),t.quad.visible=!1,t.camera=new r.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),t.canvas=document.createElement("canvas"),t.ctx=t.canvas.getContext("2d"),e.object3D.add(t.quad),t.onKeyDown=t.onKeyDown.bind(t))}e.renderer?i():e.addEventListener("render-target-loaded",i)},getRenderTarget:function(e,t){return new r.WebGLRenderTarget(e,t,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,wrapS:r.ClampToEdgeWrapping,wrapT:r.ClampToEdgeWrapping,format:r.RGBAFormat,type:r.UnsignedByteType})},resize:function(e,t){this.quad.scale.set(e,t,1),this.camera.left=-1*e/2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=-1*t/2,this.camera.updateProjectionMatrix(),this.canvas.width=e,this.canvas.height=t},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(e){var t=83===e.keyCode&&e.ctrlKey&&e.altKey;if(this.data&&t){var i=e.shiftKey?"equirectangular":"perspective";this.capture(i)}},setCapture:function(e){var t,i,n,o=this.el;return"perspective"===e?(this.quad.visible=!1,i=this.data.camera&&this.data.camera.components.camera.camera||o.camera,t={width:this.data.width,height:this.data.height}):(i=this.camera,n=new r.CubeCamera(o.camera.near,o.camera.far,Math.min(this.cubeMapSize,2048)),o.camera.getWorldPosition(n.position),o.camera.getWorldQuaternion(n.quaternion),n.update(o.renderer,o.object3D),this.quad.material.uniforms.map.value=n.renderTarget.texture,t={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:i,size:t,projection:e}},capture:function(e){var t,i=this.el.renderer.xr.enabled,n=this.el.renderer;n.xr.enabled=!1,t=this.setCapture(e),this.renderCapture(t.camera,t.size,t.projection),this.saveCapture(),n.xr.enabled=i},getCanvas:function(e){var t=this.el.renderer.xr.enabled,i=this.el.renderer,n=this.setCapture(e);return i.xr.enabled=!1,this.renderCapture(n.camera,n.size,n.projection),i.xr.enabled=t,this.canvas},renderCapture:function(e,t,i){var n,r,o,a=this.el.renderer.autoClear,s=this.el,l=s.renderer;r=this.getRenderTarget(t.width,t.height),o=new Uint8Array(4*t.width*t.height),this.resize(t.width,t.height),l.autoClear=!0,l.clear(),l.setRenderTarget(r),l.render(s.object3D,e),l.autoClear=a,l.readRenderTargetPixels(r,0,0,t.width,t.height,o),l.setRenderTarget(null),"perspective"===i&&(o=this.flipPixelsVertically(o,t.width,t.height)),n=new ImageData(new Uint8ClampedArray(o),t.width,t.height),this.quad.visible=!1,this.ctx.putImageData(n,0,0)},flipPixelsVertically:function(e,t,i){for(var n=e.slice(0),r=0;r<t;++r)for(var o=0;o<i;++o)n[4*r+o*t*4]=e[4*r+(i-o)*t*4],n[4*r+1+o*t*4]=e[4*r+1+(i-o)*t*4],n[4*r+2+o*t*4]=e[4*r+2+(i-o)*t*4],n[4*r+3+o*t*4]=e[4*r+3+(i-o)*t*4];return n},saveCapture:function(){this.canvas.toBlob((function(e){var t="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",i=document.createElement("a"),n=URL.createObjectURL(e);i.href=n,i.setAttribute("download",t),i.innerHTML="downloading...",i.style.display="none",document.body.appendChild(i),setTimeout((function(){i.click(),document.body.removeChild(i)}),1)}),"image/png")}})},{"../../core/component":109,"../../lib/three":157}],88:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../../vendor/rStats"),o=e("../../utils");e("../../../vendor/rStats.extras"),e("../../lib/rStatsAframe");var a=window.aframeStats,s=o.bind,l="a-hidden",c=window.threeStats;t.exports.Component=n("stats",{schema:{default:!0},init:function(){var e=this.el;"false"!==o.getUrlParameter("stats")&&(this.stats=function(e){var t=new c(e.renderer),i=new a(e),n=e.isMobile?[]:[t,i];return new r({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:n})}(e),this.statsEl=document.querySelector(".rs-base"),this.hideBound=s(this.hide,this),this.showBound=s(this.show,this),e.addEventListener("enter-vr",this.hideBound),e.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var e=this.stats;e&&(e("rAF").tick(),e("FPS").frame(),e().update())},hide:function(){this.statsEl.classList.add(l)},show:function(){this.statsEl.classList.remove(l)}})},{"../../../vendor/rStats":193,"../../../vendor/rStats.extras":192,"../../core/component":109,"../../lib/rStatsAframe":156,"../../utils":182}],89:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../constants/"),o=e("../../utils/"),a=o.bind,s="a-hidden";t.exports.Component=n("vr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterARButton:{default:""}},init:function(){var e=this,t=this.el;"false"!==o.getUrlParameter("ui")&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),t.addEventListener("enter-vr",this.updateEnterInterfaces),t.addEventListener("exit-vr",this.updateEnterInterfaces),t.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",(function(t){"loaderReady"===t.data.type&&(e.insideLoader=!0,e.remove())})),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=a(this.onEnterVRButtonClick,this),this.onEnterARButtonClick=a(this.onEnterARButtonClick,this),this.onModalClick=a(this.onModalClick,this),this.toggleOrientationModalIfNeeded=a(this.toggleOrientationModalIfNeeded,this),this.updateEnterInterfaces=a(this.updateEnterInterfaces,this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var e,t,i,n,a=this.data,l=this.el;if(!a.enabled||this.insideLoader||"false"===o.getUrlParameter("ui"))return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(a.enterVRButton?(this.enterVREl=document.querySelector(a.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=(e=this.onEnterVRButtonClick,(i=document.createElement("div")).classList.add("a-enter-vr"),i.setAttribute(r.AFRAME_INJECTED,""),(t=document.createElement("button")).className="a-enter-vr-button",t.setAttribute("title","Enter VR mode with a headset or fullscreen mode on a desktop. Visit https://webvr.rocks or https://webvr.info for more information."),t.setAttribute(r.AFRAME_INJECTED,""),o.device.isMobile()&&((n=t).addEventListener("touchstart",(function(){n.classList.remove("resethover")})),n.addEventListener("touchend",(function(){n.classList.add("resethover")}))),i.appendChild(t),t.addEventListener("click",(function(t){e(),t.stopPropagation()})),i),l.appendChild(this.enterVREl)),this.orientationModalEl=function(e){var t=document.createElement("div");t.className="a-orientation-modal",t.classList.add(s),t.setAttribute(r.AFRAME_INJECTED,"");var i=document.createElement("button");return i.setAttribute(r.AFRAME_INJECTED,""),i.innerHTML="Exit VR",i.addEventListener("click",e),t.appendChild(i),t}(this.onModalClick),l.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach((function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}))},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var e=this.el;this.enterVREl&&(e.is("vr-mode")?this.enterVREl.classList.add(s):this.enterVREl.classList.remove(s))},toggleEnterARButtonIfNeeded:function(){var e=this.el;this.enterAREl&&(e.is("vr-mode")||!o.device.checkARSupport()?this.enterAREl.classList.add(s):this.enterAREl.classList.remove(s))},toggleOrientationModalIfNeeded:function(){var e=this.el,t=this.orientationModalEl;t&&e.isMobile&&(!o.device.isLandscape()&&e.is("vr-mode")?t.classList.remove(s):t.classList.add(s))}})},{"../../constants/":101,"../../core/component":109,"../../utils/":182}],90:[function(e,t,i){var n=e("../core/component"),r=e("../lib/three"),o=e("../utils/bind"),a=n.registerComponent;t.exports.Component=a("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=o(this.update,this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var e=this.data;this.updateDescendants(e.cast,e.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(e,t){var i=this.el.sceneEl;this.el.object3D.traverse((function(n){if(n instanceof r.Mesh&&(n.castShadow=e,n.receiveShadow=t,i.hasLoaded&&n.material))for(var o=Array.isArray(n.material)?n.material:[n.material],a=0;a<o.length;a++)o[a].needsUpdate=!0}))}})},{"../core/component":109,"../lib/three":157,"../utils/bind":176}],91:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/debug"),o=e("../lib/three"),a=r("components:sound:warn");t.exports.Component=n("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var e=this;this.listener=null,this.audioLoader=new o.AudioLoader,this.pool=new o.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){e.playSound()}},update:function(e){var t,i,n=this.data,r=n.src!==e.src;if(r){if(!n.src)return;this.setupSound()}for(t=0;t<this.pool.children.length;t++)i=this.pool.children[t],n.positional&&(i.setDistanceModel(n.distanceModel),i.setMaxDistance(n.maxDistance),i.setRefDistance(n.refDistance),i.setRolloffFactor(n.rolloffFactor)),i.setLoop(n.loop),i.setVolume(n.volume),i.isPaused=!1;if(n.on!==e.on&&this.updateEventListener(e.on),r){var a=this;this.loaded=!1,this.audioLoader.load(n.src,(function(e){for(t=0;t<a.pool.children.length;t++)(i=a.pool.children[t]).setBuffer(e);a.loaded=!0,o.Cache.remove(n.src),(a.data.autoplay||a.mustPlay)&&a.playSound(),a.el.emit("sound-loaded",a.evtDetail,!1)}))}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var e;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(e=0;e<this.pool.children.length;e++)this.pool.children[e].disconnect()}catch(e){a("Audio source not properly disconnected")}},updateEventListener:function(e){var t=this.el;e&&t.removeEventListener(e,this.playSoundBound),t.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var e,t,i=this.el,n=i.sceneEl,r=this;this.pool.children.length>0&&(this.stopSound(),i.removeObject3D("sound"));var a=this.listener=n.audioListener||new o.AudioListener;for(n.audioListener=a,n.camera&&n.camera.add(a),n.addEventListener("camera-set-active",(function(e){e.detail.cameraEl.getObject3D("camera").add(a)})),this.pool=new o.Group,e=0;e<this.data.poolSize;e++)t=this.data.positional?new o.PositionalAudio(a):new o.Audio(a),this.pool.add(t);for(i.setObject3D(this.attrName,this.pool),e=0;e<this.pool.children.length;e++)(t=this.pool.children[e]).onEnded=function(){this.isPlaying=!1,r.el.emit("sound-ended",r.evtDetail,!1)}},pauseSound:function(){var e,t;for(this.isPlaying=!1,e=0;e<this.pool.children.length;e++)(t=this.pool.children[e]).source&&t.source.buffer&&t.isPlaying&&!t.isPaused&&(t.isPaused=!0,t.pause())},playSound:function(e){var t,i,n;if(!this.loaded)return a("Sound not loaded yet. It will be played once it finished loading"),void(this.mustPlay=!0);for(t=!1,this.isPlaying=!0,i=0;i<this.pool.children.length;i++)(n=this.pool.children[i]).isPlaying||!n.buffer||t||(e&&e(n),n.play(),n.isPaused=!1,t=!0);t?this.mustPlay=!1:a("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el)},stopSound:function(){var e,t;for(this.isPlaying=!1,e=0;e<this.pool.children.length;e++){if(!(t=this.pool.children[e]).source||!t.source.buffer)return;t.stop()}}})},{"../core/component":109,"../lib/three":157,"../utils/debug":178}],92:[function(e,t,i){var n=e("three-bmfont-text"),r=e("load-bmfont"),o=e("../core/component").registerComponent,a=e("../core/shader"),s=e("../lib/three"),l=e("../utils/"),c=l.debug("components:text:error"),h=a.shaders,u=l.debug("components:text:warn"),d="https://cdn.aframe.io/fonts/",p={aileronsemibold:d+"Aileron-Semibold.fnt",dejavu:d+"DejaVu-sdf.fnt",exo2bold:d+"Exo2Bold.fnt",exo2semibold:d+"Exo2SemiBold.fnt",kelsonsans:d+"KelsonSans.fnt",monoid:d+"Monoid.fnt",mozillavr:d+"mozillavr.fnt",roboto:d+"Roboto-msdf.json",sourcecodepro:d+"SourceCodePro.fnt"},f=["roboto"],m="roboto";t.exports.FONTS=p;var v,g,y,b,A=new function(){var e=this.cache={};this.get=function(t,i){return t in e||(e[t]=i()),e[t]}},w={},x={},E=/^\w+:/;function _(e){switch(e){case"back":return s.FrontSide;case"double":return s.DoubleSide;default:return s.BackSide}}function M(e){return new Promise((function(t,i){(new s.ImageLoader).load(e,(function(e){t(e)}),void 0,(function(){c("Error loading font image",e),i(null)}))}))}function T(e,t,i){var n,r;return(r=new h[t].Shader).el=e,r.init(i),r.update(i),(n=r.material).transparent=i.transparent,{material:n,shader:r}}function S(e,t,i){return e||(.5+t)*i}function C(e){var t=0,i=0,n=0;return e.chars.map((function(e){t+=e.xadvance,e.id>=48&&e.id<=57&&(n++,i+=e.xadvance)})),n?i/n:t/e.chars.length}t.exports.Component=o("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"array",default:m},backcolor:{type:"string",default:"0,0,0,0"},textcolor:{type:"string",default:"1,1,1,1"},fontImage:{type:"string"},fontsize:{type:"number"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:h},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=n(),this.createOrUpdateMaterial(),this.mesh=new s.Mesh(this.geometry,this.material),this.textMesh=new s.Object3D,this.textures={},this.el.setObject3D(this.attrName,this.mesh)},update:function(e){let t=this.data,i=this.currentFont;if(this.texture=x[t.font]=new s.Texture,this.texture.anisotropy=16,Array.isArray(t.font))for(let e in t.font){let i=new s.Texture;i.anisotropy=16,this.textures[t.font[e]]=i}else x[t.font]?this.texture=x[t.font]:(this.texture=x[t.font]=new s.Texture,this.texture.anisotropy=16);this.createOrUpdateMaterial(),e.font===t.font?i&&(this.updateGeometry(this.geometry,i),this.updateLayout()):this.updateFont()},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){let e,t,i,n=this.data,r=this.material,o=this.shaderData;if(i=n.shader,-1!==f.indexOf(n.font)||n.font.indexOf("-msdf.")>=0?i="msdf":n.font in p&&-1===f.indexOf(n.font)&&(i="sdf"),Array.isArray(n.font)&&n.font[0].indexOf("-msdf")>=0&&(i="msdf"),e=(this.shaderObject&&this.shaderObject.name)!==i,o.alphaTest=n.alphaTest,o.color=n.color,o.map=this.texture,o.opacity=n.opacity,o.side=_(n.side),o.transparent=n.transparent,o.negate=n.negate,!e)return this.shaderObject.update(o),r.transparent=o.transparent,void(r.side=o.side);t=T(this.el,i,o),this.material=t.material,this.shaderObject=t.shader,this.material.side=o.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){let e,t=this.data,i=this.el,o=this.geometry,a=this;t.font||u("No font specified. Using the default font."),this.mesh.visible=!1,e=this.lookupFont(t.font||m)||t.font;let l=0,h=[],d={},p={};if(Array.isArray(e)){for(let v=0;v<e.length;v++)A.get(e[v],(function(){return i=e[v],n=v,o=t.yOffset,new Promise((function(e,t){r(i,(function(r,a){if(r)return c("Error loading font",i),void t(r);i.indexOf("/Roboto-msdf.json")>=0&&(o=30),o&&a.chars.map((function(e){e.yoffset+=o})),a.index=n,e(a)}))}));var i,n,o})).then(f).catch((function(e){c(e.message),c(e.stack)}));function f(r){let u;l+=1,d[t.font[r.index]]=r,w[e]||(r.widthFactor=w[r]=C(r));let f=a.getOpt(r);p[t.font[r.index]]=f;let m=o.genLayout(f),v=t.value.toString().replace(/\\n/g,"\n").replace(/\\t/g," "),g=-1;for(let e=0,i=v.length;e<i;e++){let i=m.glyphs.find((function(t,i,n){if(i>g&&t.data.char==v[e])return g=i,t}));i&&(i.font=t.font[r.index],h[e]=i)}if(a.currentFont=r,l==e.length){let e=[],o=0;e[0]=0;let l=0;for(let t=0,i=h.length;t<i;t++){let i=h[t];i&&(i.line!=o&&(o=i.line,l=0),e[t]=l,0==i.data.width?l+=27:l+=i.data.width+i.data.xoffset)}let c=[];for(let r=0,o=t.font.length;r<o;r++){let o=p[t.font[r]];o.offsetWidths=e,o.lineHeight=o.font.common.lineHeight=45;let l=n(o);if(0==l.attributes.position.count)continue;console.log(" g0 ",r,o,l.attributes.position),c.push(l.attributes.position.array);let h={};h.alphaTest=t.alphaTest,h.color=t.color,h.map=a.textures[t.font[r]],h.opacity=t.opacity,h.side=_(t.side),h.transparent=t.transparent,h.negate=t.negate,a.textures[t.font[r]].needsUpdate=!0;let u=T(i,"msdf",h),d=u.material;u.shader.update(h),u.material.transparent=h.transparent,u.material.side=h.side,d.depthWrite=!1;let f=new s.Mesh(l,d);f.renderOrder=1,a.textMesh.add(f)}let u=.004;0!=t.fontsize&&(u=t.fontsize/20*.004);let d,f,m=function(e){let t=minY=1e3,i=maxY=-1e3,n=[];for(let r=0,o=e.length;r<o;r++)if(n=e[r],n.length%8==0)for(let e=0,r=n.length/8;e<r;e++)n[8*e+0]<t&&(t=n[8*e+0]),n[8*e+1]<minY&&(minY=n[8*e+1]),n[8*e+4]>i&&(i=n[8*e+4]),n[8*e+5]>maxY&&(maxY=n[8*e+5]);return[t,i,minY,maxY]}(c);f=m[3]-m[2]<=45?45:m[3]-m[2],d=m[1]-m[0];let v=t.backcolor.split(","),g=new s.Color(parseFloat(v[0]),parseFloat(v[1]),parseFloat(v[2])),y=parseFloat(v[3]),b=new s.PlaneGeometry(d,f,1);if(0!=t.fontsize&&0!=t.width&&0!=t.height){let e=t.width/u/190,i=t.height/u/190;b=new s.PlaneGeometry(e,i,1)}let A=new s.MeshBasicMaterial({color:g,side:s.DoubleSide,opacity:y,transparent:!0,depthWrite:!1}),w=new s.Mesh(b,A);w.renderOrder=0,w.scale.copy(new s.Vector3(u,u,u)),a.el.object3D.add(w),a.currentFont=r,a.updateLayout(),a.mesh.visible=!0,a.el.object3D.remove(a.mesh),a.textMesh.position.x=(-m[0]-d/2)*u,a.textMesh.position.y=(m[3]-f/2)*u,a.textMesh.position.z=1*u,0!=t.fontsize&&0!=t.width&&t.height,"left"==t.align&&"left"==t.anchor&&(a.textMesh.position.x=-t.width/190/2),"top"==t.baseline&&(a.textMesh.position.y=(m[3]-f)*u+t.height/190/2),"center"==t.baseline&&(a.textMesh.position.y=(m[3]-.5*f)*u);let x=!1;(function e(){for(let e=0;e<a.el.object3D.children.length;e++)if("Mesh"==a.el.object3D.children[e].type&&"BufferGeometry"==a.el.object3D.children[e].geometry.type){let t=u*d/2,i=u*f/2,n=new Float32Array([-t,i,0,-t,-i,0,t,i,0,-t,-i,0,t,-i,0,t,i,0]);a.el.object3D.children[e].geometry.setAttribute("position",new s.BufferAttribute(n,3)),a.el.object3D.children[e].geometry.computeBoundingSphere(),x=!0,a.el.emit("geometry-set",a.el.object3D.children[e].geometry,!1)}x||(console.log(" *** _setTextGeometry: not done again = ",a.el.object3D),setTimeout(e,500))})(),a.textMesh.scale.copy(new s.Vector3(u,-u,u)),a.el.object3D.add(a.textMesh)}u=a.getFontImageSrc2(r.index),A.get(u,(function(){return M(u)})).then((function(e){let n=a.texture;n.image=e,n.needsUpdate=!0,a.textures[t.font[r.index]].image=e,a.textures[t.font[r.index]].needsUpdate=!0,x[t.font[0]]=n,a.texture=n,i.emit("textfontset",{font:t.font[0],fontObj:r})})).catch((function(e){c(e.message),c(e.stack)}))}}else A.get(e,(function(){return i=e,n=t.yOffset,new Promise((function(e,t){r(i,(function(r,o){if(r)return c("Error loading font",i),void t(r);i.indexOf("/Roboto-msdf.json")>=0&&(n=30),n&&o.chars.map((function(e){e.yoffset+=n})),e(o)}))}));var i,n})).then((function(n){var r;if(1!==n.pages.length)throw new Error("Currently only single-page bitmap fonts are supported.");w[e]||(n.widthFactor=w[n]=C(n)),a.updateGeometry(o,n),a.currentFont=n,a.updateLayout(),console.log(" *** text _updateFont self [object3D, mesh] = ",a.el.object3D,a.mesh),r=a.getFontImageSrc(),A.get(r,(function(){return M(r)})).then((function(e){var r=a.texture;r.image=e,r.needsUpdate=!0,x[t.font]=r,a.texture=r,a.mesh.visible=!0,i.emit("textfontset",{font:t.font,fontObj:n})})).catch((function(e){c(e.message),c(e.stack)}))})).catch((function(e){c(e.message),c(e.stack)}))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var e=this.lookupFont(this.data.font||m)||this.data.font,t=this.currentFont.pages[0];return t.match(E)&&0!==t.indexOf("http")?e.replace(/(\.fnt)|(\.json)/,".png"):s.LoaderUtils.extractUrlBase(e)+t},getFontImageSrc2:function(e){return this.data.font[e].replace("-msdf.json",".png")},updateLayout:function(){var e,t,i,n,r,o,a,s,l,c=this.el,h=this.data,u=this.geometry,d=this.mesh;if(u.layout){if(i=c.getAttribute("geometry"),n=(o=(a=h.width||i&&i.width||1)/S(h.wrapPixels,h.wrapCount,this.currentFont.widthFactor))*((r=u.layout).height+r.descender),i&&"plane"===i.primitive&&(i.width||c.setAttribute("geometry","width",a),i.height||c.setAttribute("geometry","height",n)),"left"===(e="align"===h.anchor?h.align:h.anchor))s=0;else if("right"===e)s=-1*r.width;else{if("center"!==e)throw new TypeError("Invalid text.anchor property value",e);s=-1*r.width/2}if("bottom"===(t=h.baseline))l=0;else if("top"===t)l=-1*r.height+r.ascender;else{if("center"!==t)throw new TypeError("Invalid text.baseline property value",t);l=-1*r.height/2}d.position.x=s*o+h.xOffset,d.position.y=l*o,d.position.z=h.zOffset,d.scale.set(o,-1*o,o)}},lookupFont:function(e){return p[e]},getOpt:function(e){var t={},i=this.data;return t.font=e,t.lineHeight=i.lineHeight&&isFinite(i.lineHeight)?i.lineHeight:e.common.lineHeight,t.text=i.value.toString().replace(/\\n/g,"\n").replace(/\\t/g,"\t"),t.width=S(i.wrapPixels,i.wrapCount,e.widthFactor),l.extend({},i,t)},updateGeometry:(v={},g={},y=/\\n/g,b=/\\t/g,function(e,t){var i=this.data;g.font=t,g.lineHeight=i.lineHeight&&isFinite(i.lineHeight)?i.lineHeight:t.common.lineHeight,g.text=i.value.toString().replace(y,"\n").replace(b,"\t"),g.width=S(i.wrapPixels,i.wrapCount,t.widthFactor),e.update(l.extend(v,i,g))})})},{"../core/component":109,"../core/shader":119,"../lib/three":157,"../utils/":182,"load-bmfont":25,"three-bmfont-text":42}],93:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/tracked-controls"),o=e("../constants").DEFAULT_CAMERA_HEIGHT,a=e("../lib/three"),s=e("../constants").DEFAULT_HANDEDNESS,l=.175,c=-.3,h=-.03,u=0,d=0,p=-.175,f={touches:[]},m="axismove",v="buttonchanged",g="buttondown",y="buttonup",b="touchstart",A="touchend";t.exports.Component=n("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new a.Vector3,this.controllerQuaternion=new a.Quaternion,this.controllerEuler=new a.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(e,t){var i=this.el.getObject3D("mesh");i&&i.update&&i.update(t/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return o},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var e=this.data,t=r.findMatchingControllerWebVR(this.system.controllers,e.id,e.idPrefix,e.hand,e.controller);this.controller=t,this.el.components["tracked-controls"].controller=t,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(e){var t,i,n,r,o=this.controller,a=this.controllerEuler,f=this.controllerQuaternion,m=this.deltaControllerPosition;i=this.getHeadElement().object3D,r=this.defaultUserHeight(),n=o.pose,t=(o?o.hand:void 0)||s,e.copy(i.position),m.set(l*("left"===t?-1:"right"===t?1:0),c,h),m.multiplyScalar(r),m.applyAxisAngle(i.up,i.rotation.y),e.add(m),m.set(u,d,p),m.multiplyScalar(r),n.orientation?f.fromArray(n.orientation):f.copy(i.quaternion),a.setFromQuaternion(f),a.set(a.x,a.y,0),m.applyEuler(a),e.add(m)},updatePose:function(){var e,t,i=this.controller,n=this.data,r=this.el.object3D,o=this.system.vrDisplay;i&&((e=i.pose).position?r.position.fromArray(e.position):n.armModel&&this.applyArmModel(r.position),e.orientation&&r.quaternion.fromArray(e.orientation),o&&e.position&&(t=this.el.sceneEl.renderer.xr.getStandingMatrix(),r.matrix.compose(r.position,r.quaternion,r.scale),r.matrix.multiplyMatrices(t,r.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),r.rotateX(this.data.orientationOffset.x*a.Math.DEG2RAD),r.rotateY(this.data.orientationOffset.y*a.Math.DEG2RAD),r.rotateZ(this.data.orientationOffset.z*a.Math.DEG2RAD))},updateButtons:function(){var e,t,i=this.controller;if(i){for(t=0;t<i.buttons.length;++t)this.buttonStates[t]||(this.buttonStates[t]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[t]||(this.buttonEventDetails[t]={id:t,state:this.buttonStates[t]}),e=i.buttons[t],this.handleButton(t,e);this.handleAxes()}},handleButton:function(e,t){return!!(this.handlePress(e,t)|this.handleTouch(e,t)|this.handleValue(e,t))&&(this.el.emit(v,this.buttonEventDetails[e],!1),!0)},handleAxes:function(){var e,t=!1,i=this.controller.axes,n=this.axis,r=this.changedAxes;for(this.changedAxes.length=0,e=0;e<i.length;++e)r.push(n[e]!==i[e]),r[e]&&(t=!0);if(!t)return!1;for(this.axis.length=0,e=0;e<i.length;e++)this.axis.push(i[e]);return this.el.emit(m,this.axisMoveEventDetail,!1),!0},handlePress:function(e,t){var i,n=this.buttonStates[e];return t.pressed!==n.pressed&&(i=t.pressed?g:y,this.el.emit(i,this.buttonEventDetails[e],!1),n.pressed=t.pressed,!0)},handleTouch:function(e,t){var i,n=this.buttonStates[e];return t.touched!==n.touched&&(i=t.touched?b:A,this.el.emit(i,this.buttonEventDetails[e],!1,f),n.touched=t.touched,!0)},handleValue:function(e,t){var i=this.buttonStates[e];return t.value!==i.value&&(i.value=t.value,!0)}})},{"../constants":101,"../core/component":109,"../lib/three":157,"../utils/tracked-controls":190}],94:[function(e,t,i){var n=e("../utils/tracked-controls"),r=e("../core/component").registerComponent,o="axismove",a="buttonchanged",s="buttondown",l="buttonup",c="touchstart",h="touchend";t.exports.Component=r("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1}},init:function(){this.addSessionEventListeners=this.addSessionEventListeners.bind(this),this.updateController=this.updateController.bind(this),this.emitButtonUpEvent=this.emitButtonUpEvent.bind(this),this.emitButtonDownEvent=this.emitButtonDownEvent.bind(this),this.selectEventDetails={id:"trigger",state:{pressed:!1}},this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},play:function(){var e=this.el.sceneEl;this.updateController(),this.addSessionEventListeners(),e.addEventListener("enter-vr",this.addSessionEventListeners),e.addEventListener("controllersupdated",this.updateController)},pause:function(){var e=this.el.sceneEl;this.removeSessionEventListeners(),e.removeEventListener("enter-vr",this.addSessionEventListeners),e.removeEventListener("controllersupdated",this.updateController)},addSessionEventListeners:function(){var e=this.el.sceneEl;e.xrSession&&(e.xrSession.addEventListener("selectstart",this.emitButtonDownEvent),e.xrSession.addEventListener("selectend",this.emitButtonUpEvent))},removeSessionEventListeners:function(){var e=this.el.sceneEl;e.xrSession&&(e.xrSession.removeEventListener("selectstart",this.emitButtonDownEvent),e.xrSession.removeEventListener("selectend",this.emitButtonUpEvent))},isControllerPresent:function(e){return!(!this.controller||this.controller.gamepad||"none"!==e.inputSource.handedness&&e.inputSource.handedness!==this.data.hand)},emitButtonDownEvent:function(e){this.isControllerPresent(e)&&(this.selectEventDetails.state.pressed=!0,this.el.emit("buttondown",this.selectEventDetails),this.el.emit("buttonchanged",this.selectEventDetails),this.el.emit("triggerdown"))},emitButtonUpEvent:function(e){this.isControllerPresent(e)&&(this.selectEventDetails.state.pressed=!1,this.el.emit("buttonup",this.selectEventDetails),this.el.emit("buttonchanged",this.selectEventDetails),this.el.emit("triggerup"))},updateController:function(){this.controller=n.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var e=this.el.sceneEl;this.controller&&e.frame&&this.system.referenceSpace&&(this.pose=e.frame.getPose(this.controller.targetRaySpace,this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var e=this.el.object3D,t=this.pose;t&&(e.matrix.elements=t.transform.matrix,e.matrix.decompose(e.position,e.rotation,e.scale))},updateButtons:function(){var e,t,i,n=this.controller;if(n&&n.gamepad){for(i=n.gamepad,t=0;t<i.buttons.length;++t)this.buttonStates[t]||(this.buttonStates[t]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[t]||(this.buttonEventDetails[t]={id:t,state:this.buttonStates[t]}),e=i.buttons[t],this.handleButton(t,e);this.handleAxes()}},handleButton:function(e,t){return!!(this.handlePress(e,t)|this.handleTouch(e,t)|this.handleValue(e,t))&&(this.el.emit(a,this.buttonEventDetails[e],!1),!0)},handleAxes:function(){var e,t=!1,i=this.controller.gamepad.axes,n=this.axis,r=this.changedAxes;for(this.changedAxes.length=0,e=0;e<i.length;++e)r.push(n[e]!==i[e]),r[e]&&(t=!0);if(!t)return!1;for(this.axis.length=0,e=0;e<i.length;e++)this.axis.push(i[e]);return this.el.emit(o,this.axisMoveEventDetail,!1),!0},handlePress:function(e,t){var i,n=this.buttonStates[e];return t.pressed!==n.pressed&&(i=t.pressed?s:l,this.el.emit(i,this.buttonEventDetails[e],!1),n.pressed=t.pressed,!0)},handleTouch:function(e,t){var i,n=this.buttonStates[e];return t.touched!==n.touched&&(i=t.touched?c:h,this.el.emit(i,this.buttonEventDetails[e],!1),n.touched=t.touched,!0)},handleValue:function(e,t){var i=this.buttonStates[e];return t.value!==i.value&&(i.value=t.value,!0)}})},{"../core/component":109,"../utils/tracked-controls":190}],95:[function(e,t,i){var n=e("../core/component").registerComponent;t.exports.Component=n("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1}},update:function(){var e=this.data,t=this.el;t.sceneEl.hasWebXR?t.setAttribute("tracked-controls-webxr",{id:e.id,hand:e.hand,index:e.controller,iterateControllerProfiles:e.iterateControllerProfiles}):t.setAttribute("tracked-controls-webvr",e)}})},{"../core/component":109}],96:[function(e,t,i){var n=e("../core/component").registerComponent;t.exports.Component=n("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},{"../core/component":109}],97:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/bind"),o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c=e("../utils/").device.isWebXRAvailable,h=c?"htc-vive-controller-mv":"OpenVR ",u=c?{axes:{thumbstick:[0,1]},buttons:["trigger","grip","trackpad","none","menu"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]};t.exports.Component=n("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:u,init:function(){var e=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=r(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=r(this.onModelLoaded,this),this.onControllersUpdate=r(this.onControllersUpdate,this),this.checkIfControllerPresent=r(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=r(this.removeControllersUpdateListener,this),this.onAxisMoved=r(this.onAxisMoved,this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;a(this,h,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:h,hand:t.hand,controller:this.controllerIndex,orientationOffset:t.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj",mtl:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl"})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,i=this.mapping.buttons[e.detail.id],n=this.buttonMeshes;i&&("trigger"===i&&(t=e.detail.state.value,n&&n.trigger&&(n.trigger.rotation.x=-t*(Math.PI/12))),this.el.emit(i+"changed",e.detail.state))},onModelLoaded:function(e){var t,i=e.detail.model,n=this;this.data.model&&((t=this.buttonMeshes={}).grip={left:i.getObjectByName("leftgrip"),right:i.getObjectByName("rightgrip")},t.menu=i.getObjectByName("menubutton"),t.system=i.getObjectByName("systembutton"),t.trackpad=i.getObjectByName("touchpad"),t.trigger=i.getObjectByName("trigger"),Object.keys(t).forEach((function(e){n.setButtonColor(e,n.data.buttonColor)})),i.position.set(0,-.015,.04))},onAxisMoved:function(e){s(this,this.mapping.axes,e)},updateModel:function(e,t){var i;this.data.model&&(-1!==t.indexOf("touch")||(i="up"===t?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(e,i)))},setButtonColor:function(e,t){var i=this.buttonMeshes,n=this.rendererSystem;if(i){if("grip"===e)return i.grip.left.material.color.set(t),i.grip.right.material.color.set(t),n.applyColorCorrection(i.grip.left.material.color),void n.applyColorCorrection(i.grip.right.material.color);i[e].material.color.set(t),n.applyColorCorrection(i[e].material.color)}}})},{"../core/component":109,"../utils/":182,"../utils/bind":176,"../utils/tracked-controls":190}],98:[function(e,t,i){var n=e("../core/component").registerComponent,r=e("../utils/bind"),o=e("../utils/tracked-controls"),a=o.checkControllerPresentAndSetup,s=o.emitIfAxesChanged,l=o.onButtonEvent,c="HTC Vive Focus";t.exports.Component=n("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=r(this.onModelLoaded,this),this.onControllersUpdate=r(this.onControllersUpdate,this),this.checkIfControllerPresent=r(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=r(this.removeControllersUpdateListener,this),this.onAxisMoved=r(this.onAxisMoved,this)},init:function(){var e=this;this.onButtonChanged=r(this.onButtonChanged,this),this.onButtonDown=function(t){l(t.detail.id,"down",e)},this.onButtonUp=function(t){l(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){l(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){l(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){a(this,c,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{armModel:t.armModel,idPrefix:c,orientationOffset:t.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/vive/focus-controller/focus-controller.gltf")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var t,i=e.detail.model;this.data.model&&((t=this.buttonMeshes={}).trigger=i.getObjectByName("BumperKey"),t.triggerPressed=i.getObjectByName("BumperKey_Press"),t.triggerPressed&&(t.triggerPressed.visible=!1),t.trackpad=i.getObjectByName("TouchPad"),t.trackpadPressed=i.getObjectByName("TouchPad_Press"),t.trackpadPressed&&(t.trackpadPressed.visible=!1))},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){s(this,this.mapping.axes,e)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var i=this.buttonMeshes,n=e+"Pressed";if(i&&i[e]&&i[n]){var r;switch(t){case"down":r=this.data.buttonHighlightColor;break;case"touchstart":r=this.data.buttonTouchedColor}r&&i[n].material.color.set(r),i[n].visible=!!r,i[e].visible=!r}}})},{"../core/component":109,"../utils/bind":176,"../utils/tracked-controls":190}],99:[function(e,t,i){var n,r,o=e("../constants").keyboardevent.KEYCODE_TO_CODE,a=e("../core/component").registerComponent,s=e("../lib/three"),l=e("../utils/"),c=l.bind,h=l.shouldCaptureKeyEvent,u=1e-5,d=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];t.exports.Component=a("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},init:function(){this.keys={},this.easing=1.1,this.velocity=new s.Vector3,this.onBlur=c(this.onBlur,this),this.onFocus=c(this.onFocus,this),this.onKeyDown=c(this.onKeyDown,this),this.onKeyUp=c(this.onKeyUp,this),this.onVisibilityChange=c(this.onVisibilityChange,this),this.attachVisibilityEventListeners()},tick:function(e,t){var i=this.data,n=this.el,r=this.velocity;(r[i.adAxis]||r[i.wsAxis]||!function(e){var t;for(t in e)return!1;return!0}(this.keys))&&(t/=1e3,this.updateVelocity(t),(r[i.adAxis]||r[i.wsAxis])&&n.object3D.position.add(this.getMovementVector(t)))},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(e){var t,i,n,r,o,a=this.data,s=this.keys,l=this.velocity;if(i=a.adAxis,r=a.wsAxis,e>.2)return l[i]=0,void(l[r]=0);var c=Math.pow(1/this.easing,60*e);0!==l[i]&&(l[i]-=l[i]*c),0!==l[r]&&(l[r]-=l[r]*c),Math.abs(l[i])<u&&(l[i]=0),Math.abs(l[r])<u&&(l[r]=0),a.enabled&&(t=a.acceleration,a.adEnabled&&(n=a.adInverted?-1:1,(s.KeyA||s.ArrowLeft)&&(l[i]-=n*t*e),(s.KeyD||s.ArrowRight)&&(l[i]+=n*t*e)),a.wsEnabled&&(o=a.wsInverted?-1:1,(s.KeyW||s.ArrowUp)&&(l[r]-=o*t*e),(s.KeyS||s.ArrowDown)&&(l[r]+=o*t*e)))},getMovementVector:(n=new s.Vector3(0,0,0),r=new s.Euler(0,0,0,"YXZ"),function(e){var t,i=this.el.getAttribute("rotation"),o=this.velocity;return n.copy(o),n.multiplyScalar(e),i?(t=this.data.fly?i.x:0,r.set(s.Math.degToRad(t),s.Math.degToRad(i.y),0),n.applyEuler(r),n):n}),attachVisibilityEventListeners:function(){window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(e){var t;h(e)&&(t=e.code||o[e.keyCode],-1!==d.indexOf(t)&&(this.keys[t]=!0))},onKeyUp:function(e){var t;t=e.code||o[e.keyCode],delete this.keys[t]}})},{"../constants":101,"../core/component":109,"../lib/three":157,"../utils/":182}],100:[function(e,t,i){var n,r=e("../core/component").registerComponent,o=e("../utils/bind"),a=e("../utils/tracked-controls"),s=a.checkControllerPresentAndSetup,l=a.emitIfAxesChanged,c=a.onButtonEvent,h=e("../utils/"),u=h.debug("components:windows-motion-controls:debug"),d=h.debug("components:windows-motion-controls:warn"),p=e("../constants").DEFAULT_HANDEDNESS,f={left:"left.glb",right:"right.glb",default:"universal.glb"},m=e("../utils/").device.isWebXRAvailable,v=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,g=m?"windows-mixed-reality":"Spatial Controller (Spatial Interaction Source) ",y=m?{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"}:{axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"};t.exports.Component=r("windows-motion-controls",{schema:{hand:{default:p},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},mapping:y,bindMethods:function(){this.onModelError=o(this.onModelError,this),this.onModelLoaded=o(this.onModelLoaded,this),this.onControllersUpdate=o(this.onControllersUpdate,this),this.checkIfControllerPresent=o(this.checkIfControllerPresent,this),this.onAxisMoved=o(this.onAxisMoved,this)},init:function(){var e=this,t=this.el;this.onButtonChanged=o(this.onButtonChanged,this),this.onButtonDown=function(t){c(t.detail.id,"down",e)},this.onButtonUp=function(t){c(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){c(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){c(t.detail.id,"touchend",e)},this.onControllerConnected=function(){e.setModelVisibility(!0)},this.onControllerDisconnected=function(){e.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},t.addEventListener("controllerconnected",this.onControllerConnected),t.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-error",this.onModelError),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-error",this.onModelError),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){s(this,g,{hand:this.data.hand,index:this.data.pair})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(this.data.model&&!this.rayOrigin.createdFromMesh){var e=this.createControllerModelUrl();this.loadModel(e)}else this.modelReady()},createControllerModelUrl:function(e){var t=this.el.components["tracked-controls"],i=t?t.controller:null,n="default",r=this.data.hand;if(i&&!window.hasNativeWebXRImplementation&&(r=i.hand,!e)){var o=i.id.match(v);n=o&&o[0]||n}return"https://cdn.aframe.io/controllers/microsoft/"+n+"/"+(f[r]||f.default)},injectTrackedControls:function(){var e=this.data;this.el.setAttribute("tracked-controls",{idPrefix:g,controller:e.pair,hand:e.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(e){var t=this.createControllerModelUrl(!0);e.detail.src!==t?(d("Failed to load controller model for device, attempting to load default."),this.loadModel(t)):d("Failed to load default controller model.")},loadModel:function(e){this.el.setAttribute("gltf-model","url("+e+")")},onModelLoaded:function(e){var t,i,n,r,o=this.controllerModel=e.detail.model,a=this.loadedMeshInfo;if(u("Processing model"),a.buttonMeshes={},a.axisMeshes={},o){for(t=0;t<this.mapping.buttons.length;t++)(i=this.mapping.buttonMeshNames[this.mapping.buttons[t]])?(n=o.getObjectByName(i))?(r={index:t,value:s(n,"VALUE"),pressed:s(n,"PRESSED"),unpressed:s(n,"UNPRESSED")}).value&&r.pressed&&r.unpressed?a.buttonMeshes[this.mapping.buttons[t]]=r:d("Missing button submesh under mesh with name: "+i+"(VALUE: "+!!r.value+", PRESSED: "+!!r.pressed+", UNPRESSED:"+!!r.unpressed+")"):d("Missing button mesh with name: "+i):u("Skipping unknown button at index: "+t+" with mapped name: "+this.mapping.buttons[t]);for(t=0;t<this.mapping.axisMeshNames.length;t++)(i=this.mapping.axisMeshNames[t])?(n=o.getObjectByName(i))?(r={index:t,value:s(n,"VALUE"),min:s(n,"MIN"),max:s(n,"MAX")}).value&&r.min&&r.max?a.axisMeshes[t]=r:d("Missing axis submesh under mesh with name: "+i+"(VALUE: "+!!r.value+", MIN: "+!!r.min+", MAX:"+!!r.max+")"):d("Missing axis mesh with name: "+i):u("Skipping unknown axis at index: "+t);this.calculateRayOriginFromMesh(o),this.setModelVisibility()}function s(e,t){for(var i=0,n=e.children.length;i<n;i++){var r=e.children[i];if(r&&r.name===t)return r}}u("Model load complete.")},calculateRayOriginFromMesh:(n=new THREE.Quaternion,function(e){var t;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,t=e.getObjectByName(this.mapping.pointingPoseMeshName)){var i=e.parent;i&&(e.parent=null,e.updateMatrixWorld(!0),e.parent=i),t.getWorldPosition(this.rayOrigin.origin),t.getWorldQuaternion(n),this.rayOrigin.direction.applyQuaternion(n),i&&e.updateMatrixWorld(!0)}else u("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}),lerpAxisTransform:function(){var e=new THREE.Quaternion;return function(t,i){var n=this.loadedMeshInfo.axisMeshes[t];if(n){var r=n.min,o=n.max,a=n.value,s=.5*i+.5;a.setRotationFromQuaternion(e.copy(r.quaternion).slerp(o.quaternion,s)),a.position.lerpVectors(r.position,o.position,s)}}}(),lerpButtonTransform:function(){var e=new THREE.Quaternion;return function(t,i){var n=this.loadedMeshInfo.buttonMeshes[t];if(n){var r=n.unpressed,o=n.pressed,a=n.value;a.setRotationFromQuaternion(e.copy(r.quaternion).slerp(o.quaternion,i)),a.position.lerpVectors(r.position,o.position,i)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(t,e.detail.state.value),this.el.emit(t+"changed",e.detail.state))},onAxisMoved:function(e){var t=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var i=0;i<t;i++)this.lerpAxisTransform(i,e.detail.axis[i]||0);l(this,this.mapping.axes,e)},setModelVisibility:function(e){var t=this.el.getObject3D("mesh");e=void 0!==e?e:this.modelVisible,this.modelVisible=e,t&&(t.visible=e)}})},{"../constants":101,"../core/component":109,"../utils/":182,"../utils/bind":176,"../utils/tracked-controls":190}],101:[function(e,t,i){t.exports={AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:e("./keyboardevent")}},{"./keyboardevent":102}],102:[function(e,t,i){t.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},{}],103:[function(e,t,i){var n=e("./a-node"),r=e("../utils/bind"),o=e("../utils/debug"),a=e("./a-register-element").registerElement,s=e("../lib/three"),l=new s.FileLoader,c=o("core:a-assets:warn");function h(e){if(e.hasAttribute("autoplay")||"auto"===e.getAttribute("preload"))return new Promise((function(t,i){if(4===e.readyState)return t();if(e.error)return i();function n(){for(var i=0,n=0;n<e.buffered.length;n++)i+=e.buffered.end(n)-e.buffered.start(n);i>=e.duration&&("VIDEO"===e.tagName&&(s.Cache.files[e.getAttribute("src")]=e),t())}e.addEventListener("loadeddata",n,!1),e.addEventListener("progress",n,!1),e.addEventListener("error",i,!1)}))}function u(e){var t=function(e){var t;if(e.hasAttribute("crossorigin"))return e;if(null!==(t=e.getAttribute("src"))){if(-1===t.indexOf("://"))return e;if((n=(i=t).indexOf("://")>-1?i.split("/")[2]:i.split("/")[0]).substring(0,n.indexOf(":"))===window.location.host)return e}var i,n;return c('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',t),e.crossOrigin="anonymous",e.cloneNode(!0)}(e);return t.tagName&&"video"===t.tagName.toLowerCase()&&(t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline","")),t!==e&&(e.parentNode.appendChild(t),e.parentNode.removeChild(e)),t}function d(e){var t=p(e),i=t.lastIndexOf(".");return i>=0&&".glb"===t.slice(i,e.search(/\?|#|$/))?"arraybuffer":"text"}function p(e){var t=document.createElement("a");t.href=e;var i=t.search.replace(/^\?/,""),n=e.replace(i,"").replace("?","");return n.substring(n.lastIndexOf("/")+1)}t.exports=a("a-assets",{prototype:Object.create(n.prototype,{createdCallback:{value:function(){this.isAssets=!0,this.fileLoader=l,this.timeout=null}},attachedCallback:{value:function(){var e,t,i,n,o,a,l=this,d=[];if(!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(o=this.querySelectorAll("img"),e=0;e<o.length;e++)n=u(o[e]),d.push(new Promise((function(t,i){s.Cache.files[o[e].getAttribute("src")]=n,n.onload=t,n.onerror=i})));for(i=this.querySelectorAll("audio, video"),e=0;e<i.length;e++)(t=u(i[e])).src||t.srcObject||c("Audio/video asset has neither `src` nor `srcObject` attributes."),d.push(h(t));Promise.all(d).then(r(this.load,this)),a=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout((function(){l.hasLoaded||(c("Asset loading timed out in ",a,"ms"),l.emit("timeout"),l.load())}),a)}},detachedCallback:{value:function(){this.timeout&&clearTimeout(this.timeout)}},load:{value:function(){n.prototype.load.call(this,null,(function(e){return e.isAssetItem&&e.hasAttribute("src")}))}}})}),a("a-asset-item",{prototype:Object.create(n.prototype,{createdCallback:{value:function(){this.data=null,this.isAssetItem=!0}},attachedCallback:{value:function(){var e=this,t=this.getAttribute("src");l.setResponseType(this.getAttribute("response-type")||d(t)),l.load(t,(function(t){e.data=t,setTimeout((function(){n.prototype.load.call(e)}))}),(function(t){e.emit("progress",{loadedBytes:t.loaded,totalBytes:t.total,xhr:t})}),(function(t){e.emit("error",{xhr:t})}))}}})}),t.exports.inferResponseType=d,t.exports.getFileNameFromURL=p},{"../lib/three":157,"../utils/bind":176,"../utils/debug":178,"./a-node":107,"./a-register-element":108}],104:[function(e,t,i){var n=e("../utils/debug"),r=e("./a-register-element").registerElement,o=n("core:cubemap:warn");t.exports=r("a-cubemap",{prototype:Object.create(window.HTMLElement.prototype,{attachedCallback:{value:function(){this.srcs=this.validate()},writable:window.debug},validate:{value:function(){var e,t=this.querySelectorAll("[src]"),i=[];if(6===t.length){for(e=0;e<t.length;e++)i.push(t[e].getAttribute("src"));return i}o("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")},writable:window.debug}})})},{"../utils/debug":178,"./a-register-element":108}],105:[function(e,t,i){var n,r,o,a=e("./a-node"),s=e("./component").components,l=e("./a-register-element").registerElement,c=e("../lib/three"),h=e("../utils/"),u=h.debug("core:a-entity:debug"),d=h.debug("core:a-entity:warn"),p="__",f=["position","rotation","scale","visible"],m={once:!0},v=Object.create(a.prototype,{createdCallback:{value:function(){this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new c.Group,this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}},attributeChangedCallback:{value:function(e,t,i){var n=this.components[e];n&&n.justInitialized&&""===i?delete n.justInitialized:(n||null!==i)&&this.setEntityAttribute(e,t,i)}},attachedCallback:{value:function(){var e,t=this.sceneEl,i=this;this.addToParent(),this.isScene||(t?!(e=t.querySelector("a-assets"))||e.hasLoaded?this.load():e.addEventListener("loaded",(function(){i.load()})):this.load())}},detachedCallback:{value:function(){var e;if(this.parentEl){for(e in this.components)this.removeComponent(e,!1);this.isScene||(this.removeFromParent(),a.prototype.detachedCallback.call(this),this.object3D.el=null)}}},getObject3D:{value:function(e){return this.object3DMap[e]}},setObject3D:{value:function(e,t){var i,n=this;if(!(t instanceof c.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(i=this.getObject3D(e))&&this.object3D.remove(i),t.el=this,t.children.length&&t.traverse((function(e){e.el=n})),this.object3D.add(t),this.object3DMap[e]=t,this.emit("object3dset",{object:t,type:e})}},removeObject3D:{value:function(e){var t=this.getObject3D(e);t?(this.object3D.remove(t),delete this.object3DMap[e],this.emit("object3dremove",{type:e})):d("Tried to remove `Object3D` of type:",e,"which was not defined.")}},getOrCreateObject3D:{value:function(e,t){var i=this.getObject3D(e);return!i&&t&&(i=new t,this.setObject3D(e,i)),d("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),i}},add:{value:function(e){if(!e.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(e.object3D),this.emit("child-attached",{el:e})}},addToParent:{value:function(){var e=this.parentEl=this.parentNode;e&&e.add&&!this.attachedToParent&&(e.add(this),this.attachedToParent=!0)}},removeFromParent:{value:function(){var e=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,e.emit("child-detached",{el:this})}},load:{value:function(){var e=this;!this.hasLoaded&&this.parentEl&&a.prototype.load.call(this,(function(){e.parentEl&&(e.updateComponents(),(e.isScene||e.parentEl.isPlaying)&&e.play())}))},writable:window.debug},remove:{value:function(e){e?this.object3D.remove(e.object3D):this.parentNode&&this.parentNode.removeChild(this)}},getChildEntities:{value:function(){for(var e=this.children,t=[],i=0;i<e.length;i++){var r=e[i];r instanceof n&&t.push(r)}return t}},initComponent:{value:function(e,t,i){var n,r,o,a;if(a=(o=h.split(e,p))[0],r=o.length>2?o.slice(1).join("__"):o[1],s[a]&&(g(this,e)||void 0!==t||i)&&!(e in this.components)){if(this.initComponentDependencies(a),r&&!s[a].multiple)throw new Error("Trying to initialize multiple components of type `"+a+"`. There can only be one component of this type per entity.");n=new s[a].Component(this,t,r),this.isPlaying&&n.play(),this.hasAttribute(e)||(n.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,e,"")),u("Component initialized: %s",e)}},writable:window.debug},initComponentDependencies:{value:function(e){var t,i;if(s[e]&&(t=s[e].dependencies))for(i=0;i<t.length;i++)this.initComponent(t[i],window.HTMLElement.prototype.getAttribute.call(this,t[i])||void 0,!0)}},removeComponent:{value:function(e,t){var i;(i=this.components[e])&&(i.initialized?(i.pause(),i.remove(),t&&(i.destroy(),delete this.components[e]),this.emit("componentremoved",i.evtDetail,!1)):this.addEventListener("componentinitialized",(function i(n){n.detail.name===e&&(this.removeComponent(e,t),this.removeEventListener("componentinitialized",i))})))},writable:window.debug},updateComponents:{value:function(){var e,t,i,n,r,o,a=this.componentsToUpdate;if(this.hasLoaded){for(i=0;i<this.mixinEls.length;i++)for(n in this.mixinEls[i].componentCache)y(n)&&(a[n]=!0);if(this.getExtraComponents)for(n in t=this.getExtraComponents())y(n)&&(a[n]=!0);for(i=0;i<this.attributes.length;++i)n=this.attributes[i].name,-1===f.indexOf(n)&&y(n)&&(a[n]=!0);for(i=0;i<f.length;i++)n=f[i],this.hasAttribute(n)&&this.updateComponent(n,this.getDOMAttribute(n));for(n in a)r=this.getDOMAttribute(n),e=(o=t&&t[n])?o.constructor===Object?h.extend(o,h.styleParser.parse(r||{})):r||o:r,this.updateComponent(n,e),delete a[n]}},writable:window.debug},updateComponent:{value:function(e,t,i){var n=this.components[e];if(n)return null!==t||g(this,e)?void n.updateProperties(t,i):void this.removeComponent(e,!0);this.initComponent(e,t,!1)}},removeAttribute:{value:function(e,t){var i=this.components[e];i&&void 0===t&&this.removeComponent(e,!0),i&&void 0!==t?i.resetProperty(t):("mixin"===e&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,e))}},play:{value:function(){var e,t,i;if(!this.isPlaying&&this.hasLoaded){for(i in this.isPlaying=!0,this.components)this.components[i].play();for(e=this.getChildEntities(),t=0;t<e.length;t++)e[t].play();this.emit("play")}},writable:!0},pause:{value:function(){var e,t,i;if(this.isPlaying){for(i in this.isPlaying=!1,this.components)this.components[i].pause();for(e=this.getChildEntities(),t=0;t<e.length;t++)e[t].pause();this.emit("pause")}},writable:!0},setEntityAttribute:{value:function(e,t,i){if(s[e]||this.components[e])this.updateComponent(e,i);else if("mixin"===e){if(i===this.computedMixinStr)return;this.mixinUpdate(i,t)}}},mixinUpdate:{value:(o=[],function(e,t){var i,n,r,a,s=this;if(this.hasLoaded){for(t=t||this.getAttribute("mixin"),r=this.updateMixins(e,t),o.length=0,a=0;a<this.mixinEls.length;a++)for(i in this.mixinEls[a].componentCache)-1===o.indexOf(i)&&(this.components[i]?this.components[i].handleMixinUpdate():this.initComponent(i,null),o.push(i));for(a=0;a<r.oldMixinIds.length;a++)if(n=document.getElementById(r.oldMixinIds[a]))for(i in n.componentCache)-1===o.indexOf(i)&&this.components[i]&&(this.getDOMAttribute(i)?this.components[i].handleMixinUpdate():this.removeComponent(i,!0))}else this.addEventListener("loaded",(function(){s.mixinUpdate(e,t)}),m)})},setAttribute:{value:(r={},function(e,t,i){var n,o,l,c,u;if(l=(c=e.indexOf(p))>0?e.substring(0,c):e,!s[l])return"mixin"===e&&this.mixinUpdate(t),void a.prototype.setAttribute.call(this,e,t);if(!this.components[e]&&this.hasAttribute(e)&&this.updateComponent(e,window.HTMLElement.prototype.getAttribute.call(this,e)),void 0!==i&&"string"==typeof t&&t.length>0&&"string"==typeof h.styleParser.parse(t)){for(u in r)delete r[u];(n=r)[t]=i,o=!1}else n=t,o=!0===i;this.updateComponent(e,n,o),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[e].flushToDOM()}),writable:window.debug},flushToDOM:{value:function(e){var t,i,n,r=this.components,o=this.children;for(n in r)r[n].flushToDOM();if(e)for(i=0;i<o.length;++i)(t=o[i]).flushToDOM&&t.flushToDOM(e)}},getAttribute:{value:function(e){var t,i,n,r,o;return"position"===e?this.object3D.position:"rotation"===e?(i=this,n=c.Math.radToDeg,r=i.object3D.rotation,(o=i.rotationObj).x=n(r.x),o.y=n(r.y),o.z=n(r.z),o):"scale"===e?this.object3D.scale:"visible"===e?this.object3D.visible:(t=this.components[e])?t.data:window.HTMLElement.prototype.getAttribute.call(this,e)},writable:window.debug},getDOMAttribute:{value:function(e){var t=this.components[e];return t?t.attrValue:window.HTMLElement.prototype.getAttribute.call(this,e)},writable:window.debug},addState:{value:function(e){this.is(e)||(this.states.push(e),this.emit("stateadded",e))}},removeState:{value:function(e){var t=this.states.indexOf(e);-1!==t&&(this.states.splice(t,1),this.emit("stateremoved",e))}},is:{value:function(e){return-1!==this.states.indexOf(e)}},inspect:{value:function(){this.sceneEl.components.inspector.openInspector(this)}},destroy:{value:function(){var e;if(this.parentNode)d("Entity can only be destroyed if detached from scenegraph.");else for(e in this.components)this.components[e].destroy()}}});function g(e,t){return!(!e.components[t]||!e.components[t].attrValue)||function(e,t){var i,n=!1;for(i=0;i<t.length&&!(n=t[i].hasAttribute(e));++i);return n}(t,e.mixinEls)}function y(e){return-1!==e.indexOf(p)&&(e=h.split(e,p)[0]),!!s[e]}n=l("a-entity",{prototype:v}),t.exports=n},{"../lib/three":157,"../utils/":182,"./a-node":107,"./a-register-element":108,"./component":109}],106:[function(e,t,i){var n=e("./a-node"),r=e("./a-register-element").registerElement,o=e("./component").components,a=e("../utils");t.exports=r("a-mixin",{prototype:Object.create(n.prototype,{createdCallback:{value:function(){this.componentCache={},this.id=this.getAttribute("id"),this.isMixin=!0}},attributeChangedCallback:{value:function(e,t,i){this.cacheAttribute(e,i),this.updateEntities()}},attachedCallback:{value:function(){this.sceneEl=this.closestScene(),this.cacheAttributes(),this.updateEntities(),this.load()}},setAttribute:{value:function(e,t){window.HTMLElement.prototype.setAttribute.call(this,e,t),this.cacheAttribute(e,t)}},cacheAttribute:{value:function(e,t){var i,n;n=a.split(e,"__")[0],(i=o[n])&&(void 0===t&&(t=window.HTMLElement.prototype.getAttribute.call(this,e)),this.componentCache[e]=i.parseAttrValueForCache(t))}},getAttribute:{value:function(e){return this.componentCache[e]||window.HTMLElement.prototype.getAttribute.call(this,e)}},cacheAttributes:{value:function(){var e,t,i=this.attributes;for(t=0;t<i.length;t++)e=i[t].name,this.cacheAttribute(e)}},updateEntities:{value:function(){var e,t,i;if(this.sceneEl)for(t=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),i=0;i<t.length;i++)(e=t[i]).hasLoaded&&!e.isMixin&&e.mixinUpdate(this.id)}}})})},{"../utils":182,"./a-node":107,"./a-register-element":108,"./component":109}],107:[function(e,t,i){var n,r,o,a,s=e("./a-register-element").registerElement,l=e("./a-register-element").isNode,c=e("../utils/"),h=c.debug("core:a-node:warn"),u=c.debug("core:a-node:error");t.exports=s("a-node",{prototype:Object.create(window.HTMLElement.prototype,{createdCallback:{value:function(){this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]},writable:window.debug},attachedCallback:{value:function(){var e;this.sceneEl=this.closestScene(),this.sceneEl||h("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(e=this.getAttribute("mixin"))&&this.updateMixins(e)},writable:window.debug},attributeChangedCallback:{value:function(e,t,i){i!==this.computedMixinStr&&("mixin"!==e||this.isMixin||this.updateMixins(i,t))}},closestScene:{value:function(){for(var e=this;e&&!e.isScene;)e=e.parentElement;return e}},closest:{value:function(e){for(var t=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,i=this;i&&!t.call(i,e);)i=i.parentElement;return i}},detachedCallback:{value:function(){this.hasLoaded=!1}},load:{value:function(e,t){var i,n=this;this.hasLoaded||(t=t||l,i=this.getChildren().filter(t).map((function(e){return new Promise((function(t){if(e.hasLoaded)return t();e.addEventListener("loaded",t)}))})),Promise.all(i).then((function(){n.hasLoaded=!0,e&&e(),n.emit("loaded",void 0,!1)})).catch((function(e){u("Failure loading node: ",e)})))},writable:!0},getChildren:{value:function(){return Array.prototype.slice.call(this.children,0)}},updateMixins:{value:(r=[],o=[],a={},function(e,t){var i,n,s;for(r.length=0,o.length=0,n=e?c.split(e.trim(),/\s+/):r,s=t?c.split(t.trim(),/\s+/):o,a.newMixinIds=n,a.oldMixinIds=s,i=0;i<s.length;i++)-1===n.indexOf(s[i])&&this.unregisterMixin(s[i]);for(this.computedMixinStr="",this.mixinEls.length=0,i=0;i<n.length;i++)this.registerMixin(document.getElementById(n[i]));return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),a})},registerMixin:{value:function(e){var t,i,n;if(e){if(n=e.getAttribute("mixin"))for(t=c.split(n.trim(),/\s+/),i=0;i<t.length;i++)this.registerMixin(document.getElementById(t[i]));this.computedMixinStr=this.computedMixinStr+" "+e.id,this.mixinEls.push(e)}}},setAttribute:{value:function(e,t){"mixin"===e&&this.updateMixins(t),window.HTMLElement.prototype.setAttribute.call(this,e,t)}},unregisterMixin:{value:function(e){var t,i=this.mixinEls;for(t=0;t<i.length;++t)if(e===i[t].id){i.splice(t,1);break}}},emit:{value:(n={},function(e,t,i,r){void 0===i&&(i=!0),n.bubbles=!!i,n.detail=t,r&&(n=c.extend({},r,n)),this.dispatchEvent(new CustomEvent(e,n))}),writable:window.debug}})})},{"../utils/":182,"./a-register-element":108}],108:[function(e,t,i){var n,r;e("document-register-element");var o=t.exports.knownTags={};function a(e,t,i,n){t.forEach((function(t){!function(e,t,i,n){var r=i[t],o=n[t];r&&o&&r!==o&&(e[t]={value:function(){return o.apply(this,arguments),r.apply(this,arguments)},writable:window.debug})}(e,t,i,n)}))}function s(e,t){Object.getOwnPropertyNames(e).forEach((function(i){var n;t[i]||(n=Object.getOwnPropertyDescriptor(e,i),t[i]={value:e[i],writable:n.writable})}))}t.exports.isNode=function(e){return e.tagName.toLowerCase()in o||e.isNode},t.exports.registerElement=function(e,t){var i=Object.getPrototypeOf(t.prototype),l=t,c=n&&i===n.prototype,h=r&&i===r.prototype;return(c||h)&&function(e){o[e.toLowerCase()]=!0}(e),c&&(l=function(e){var t={};return a(t,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],e,n.prototype),s(e,t),t}(t.prototype),l={prototype:Object.create(i,l)}),h&&(l=function(e){var t={};return a(t,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],e,n.prototype),a(t,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],e,r.prototype),s(e,t),t}(t.prototype),l={prototype:Object.create(i,l)}),Object.getOwnPropertyNames(l.prototype).forEach((function(e){var t=l.prototype[e];"function"==typeof t&&(t.displayName=e)})),document.registerElement(e,l)},t.exports.wrapMethods=a,n=e("./a-node"),r=e("./a-entity")},{"./a-entity":105,"./a-node":107,"document-register-element":13}],109:[function(e,t,i){var n=e("./schema"),r=e("./scene/scenes"),o=e("./system"),a=e("../utils/"),s=t.exports.components={},l=n.parseProperties,c=n.parseProperty,h=n.process,u=n.isSingleProperty,d=n.stringifyProperties,p=n.stringifyProperty,f=a.styleParser,m=a.debug("core:component:warn"),v=document.currentScript,g=new RegExp("[A-Z]+"),y={},b=t.exports.Component=function(e,t,i){var n=this;this.el=e,this.id=i,this.attrName=this.name+(i?"__"+i:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.isSingleProperty=u(this.schema),this.isSinglePropertyObject=this.isSingleProperty&&_(c(void 0,this.schema))&&!(this.schema.default instanceof window.HTMLElement),this.isObjectBased=!this.isSingleProperty||this.isSinglePropertyObject,this.el.components[this.attrName]=this,this.objectPool=y[this.name];const r=this.events;this.events={},function(e,t){var i;for(i in t)e.events[i]=t[i].bind(e)}(this,r),this.attrValue=void 0,this.isObjectBased?(this.nextData=this.objectPool.use(),a.objectPool.removeUnusedKeys(this.nextData,this.schema),this.oldData=this.objectPool.use(),a.objectPool.removeUnusedKeys(this.oldData,this.schema),this.previousOldData=this.objectPool.use(),a.objectPool.removeUnusedKeys(this.previousOldData,this.schema),this.parsingAttrValue=this.objectPool.use(),a.objectPool.removeUnusedKeys(this.parsingAttrValue,this.schema)):(this.nextData=void 0,this.oldData=void 0,this.previousOldData=void 0,this.parsingAttrValue=void 0),this.throttledEmitComponentChanged=a.throttle((function(){e.emit("componentchanged",n.evtDetail,!1)}),200),this.updateProperties(t)};if(b.prototype={schema:{},init:function(){},events:{},update:function(e){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},parse:function(e,t){var i=this.schema;return this.isSingleProperty?c(e,i):l(f.parse(e),i,!0,this.name,t)},stringify:function(e){var t=this.schema;return"string"==typeof e?e:this.isSingleProperty?p(e,t):(e=d(e,t),f.stringify(e))},updateCachedAttrValue:function(e,t){var i,n,r;if(void 0!==e){if(null===e)return this.isObjectBased&&this.attrValue&&this.objectPool.recycle(this.attrValue),void(this.attrValue=void 0);if(e instanceof Object&&!(e instanceof window.HTMLElement)?(n=this.objectPool.use(),i=a.extend(n,e)):i=this.parseAttrValueForCache(e),this.isObjectBased&&!t&&this.attrValue)for(r in this.attrValue)void 0===i[r]&&(i[r]=this.attrValue[r]);this.isObjectBased&&!this.attrValue&&(this.attrValue=this.objectPool.use()),a.objectPool.clearObject(this.attrValue),this.attrValue=x(this.attrValue,i,this.isObjectBased),a.objectPool.clearObject(n)}},parseAttrValueForCache:function(e){var t;return"string"!=typeof e?e:(this.isSingleProperty?"string"==typeof(t=this.schema.parse(e))&&(t=e):(a.objectPool.clearObject(this.parsingAttrValue),t=f.parse(e,this.parsingAttrValue)),t)},flushToDOM:function(e){var t=e?this.data:this.attrValue;null!=t&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(t))},updateProperties:function(e,t){this.el.hasLoaded?(null!==e&&(e=this.parseAttrValueForCache(e)),this.updateCachedAttrValue(e,t),this.initialized?(this.updateComponent(e,t),this.callUpdateHandler()):this.initComponent()):this.updateCachedAttrValue(e)},initComponent:function(){var e,t=this.el;this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!1,!0)),this.data=this.buildData(this.attrValue),t.initializingComponents[this.name]||(t.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete t.initializingComponents[this.name],this.oldData=x(this.oldData,this.data,this.isObjectBased),e=this.isObjectBased?this.objectPool.use():void 0,this.update(e),this.isObjectBased&&this.objectPool.recycle(e),t.isPlaying&&this.play(),t.emit("componentinitialized",this.evtDetail,!1))},updateComponent:function(e,t){var i,n;if(t)return this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));if(this.isSingleProperty)return this.isObjectBased&&c(e,this.schema),void(this.data=e);if(l(e,this.schema,!0,this.name),this.schemaChangeKeys.length)for(i in e)if(this.schema[i].schemaChange){n=!0;break}if(n)return this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));for(i in e)void 0!==e[i]&&(this.data[i]=e[i])},callUpdateHandler:function(){var e;this.previousOldData instanceof Object&&a.objectPool.clearObject(this.previousOldData),this.isObjectBased?w(this.previousOldData,this.oldData):this.previousOldData=this.oldData,e=!a.deepEqual(this.oldData,this.data),(this.isPositionRotationScale||e)&&(this.oldData instanceof Object&&a.objectPool.clearObject(this.oldData),this.oldData=x(this.oldData,this.data,this.isObjectBased),this.update(this.previousOldData),this.throttledEmitComponentChanged())},handleMixinUpdate:function(){this.data=this.buildData(this.attrValue),this.callUpdateHandler()},resetProperty:function(e){if(this.isObjectBased){if(!(e in this.attrValue))return;delete this.attrValue[e],this.data[e]=this.schema[e].default}else this.attrValue=this.schema.default,this.data=this.schema.default;this.updateProperties(this.attrValue)},extendSchema:function(e){var t;t=a.extend({},s[this.name].schema),a.extend(t,e),this.schema=h(t),this.el.emit("schemachanged",this.evtDetail)},buildData:function(e,t,i){var n,r,o,s,h,u,d,p=this.nextData,f=this.schema,m=this.el.mixinEls;if(n=e&&e.constructor===Array?e.length:null!=e,this.isObjectBased&&a.objectPool.clearObject(p),this.isSingleProperty)r=this.isObjectBased?w(p,f.default):M(f.default)?a.clone(f.default):f.default;else for(s in r=(d=!t&&this.attrValue)instanceof Object?w(p,d):p,f)o=f[s].default,void 0===r[s]&&(r[s]=M(o)?a.clone(o):o);for(u=0;u<m.length;u++)(h=m[u].getAttribute(this.attrName))&&(r=x(r,h,this.isObjectBased));if(n){if(this.isSingleProperty)return _(e)?(w(this.parsingAttrValue,e),c(this.parsingAttrValue,f)):c(e,f);r=x(r,e,this.isObjectBased)}else if(this.isSingleProperty)return c(r,f);return l(r,f,void 0,this.name,i)},eventsAttach:function(){var e;for(e in this.eventsDetach(),this.events)this.el.addEventListener(e,this.events[e])},eventsDetach:function(){var e;for(e in this.events)this.el.removeEventListener(e,this.events[e])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.oldData),this.objectPool.recycle(this.parsingAttrValue),this.attrValue=this.oldData=this.parsingAttrValue=void 0}},window.debug)var A=t.exports.registrationOrderWarnings={};function w(e,t){var i,n;for(n in t)void 0!==t[n]&&(i=t[n],e[n]=M(i)?a.clone(i):i);return e}function x(e,t,i){var n;if(i&&t.constructor===Object){for(n in t)void 0!==t[n]&&(t[n]&&t[n].constructor===Object?e[n]=a.clone(t[n]):e[n]=t[n]);return e}return t}function E(e){return e.tick||e.tock}function _(e){return e&&e.constructor===Object&&!(e instanceof window.HTMLElement)}function M(e){return e&&(e.constructor===Object||e.constructor===Array)&&!(e instanceof window.HTMLElement)}t.exports.registerComponent=function(e,t){var i,n,l,c,d,p,f={};if(document.currentScript&&document.currentScript!==v&&r.forEach((function(t){t.hasLoaded||document.currentScript.compareDocumentPosition(t)!==Node.DOCUMENT_POSITION_FOLLOWING&&(m("The component `"+e+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(A[e]=!0))})),!0===g.test(e)&&m("The component name `"+e+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+e.toLowerCase()+"`"),-1!==e.indexOf("__"))throw new Error("The component name `"+e+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(t).forEach((function(e){f[e]={value:t[e],writable:!0}})),s[e])throw new Error("The component `"+e+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");if((i=function(e,t,i){b.call(this,e,t,i)}).prototype=Object.create(b.prototype,f),i.prototype.name=e,i.prototype.isPositionRotationScale="position"===e||"rotation"===e||"scale"===e,i.prototype.constructor=i,i.prototype.system=o&&o.systems[e],i.prototype.play=(p=i.prototype.play,function(){var e=this.el.sceneEl,t=this.el.isPlaying&&!this.isPlaying;this.initialized&&t&&(p.call(this),this.isPlaying=!0,this.eventsAttach(),E(this)&&e.addBehavior(this))}),i.prototype.pause=(d=i.prototype.pause,function(){var e=this.el.sceneEl;this.isPlaying&&(d.call(this),this.isPlaying=!1,this.eventsDetach(),E(this)&&e.removeBehavior(this))}),l=a.extend(h(i.prototype.schema,i.prototype.name)),!(c=u(i.prototype.schema)))for(n in i.prototype.schemaChangeKeys=[],l)l[n].schemaChange&&i.prototype.schemaChangeKeys.push(n);return y[e]=a.objectPool.createPool(),s[e]={Component:i,dependencies:i.prototype.dependencies,isSingleProp:c,multiple:i.prototype.multiple,name:e,parse:i.prototype.parse,parseAttrValueForCache:i.prototype.parseAttrValueForCache,schema:l,stringify:i.prototype.stringify,type:i.prototype.type},i}},{"../utils/":182,"./scene/scenes":116,"./schema":118,"./system":120}],110:[function(e,t,i){var n=e("./schema").process,r=t.exports.geometries={},o=t.exports.geometryNames=[],a=e("../lib/three"),s=t.exports.Geometry=function(){};s.prototype={schema:{},init:function(e){return this.geometry=new a.Geometry,this.geometry},update:function(e){}},t.exports.registerGeometry=function(e,t){var i,a={};if(Object.keys(t).forEach((function(e){a[e]={value:t[e],writable:!0}})),r[e])throw new Error("The geometry `"+e+"` has been already registered");return(i=function(){s.call(this)}).prototype=Object.create(s.prototype,a),i.prototype.name=e,i.prototype.constructor=i,r[e]={Geometry:i,schema:n(i.prototype.schema)},o.push(e),i}},{"../lib/three":157,"./schema":118}],111:[function(e,t,i){var n=e("../utils/coordinates"),r=e("debug"),o=r("core:propertyTypes:warn"),a=r("core:propertyTypes:warn"),s=t.exports.propertyTypes={},l=/[,> .[\]:]/,c=/\url\((.+)\)/;function h(e,t,i,n){"type"in s?o("Property type "+e+" is already registered."):s[e]={default:t,parse:i||d,stringify:n||p}}function u(e){var t,i;return"string"!=typeof e?e:(i=e.match(c))?i[1]:"#"===e.charAt(0)?(t=document.getElementById(e.substring(1)))?"CANVAS"===t.tagName||"VIDEO"===t.tagName||"IMG"===t.tagName?t:t.getAttribute("src"):void a('"'+e+'" asset not found.'):e}function d(e){return e}function p(e){return null===e?"null":e.toString()}function f(e){return parseInt(e,10)}function m(e){return n.parse(e,this.default)}function v(e,t){if(null===e)return!0;if("object"!=typeof e)return!1;if(Object.keys(e).length!==t)return!1;var i=e.x,n=e.y,r=e.z,o=e.w;return!("number"!=typeof i||"number"!=typeof n||t>2&&"number"!=typeof r||t>3&&"number"!=typeof o)}h("audio","",u),h("array",[],(function(e){return Array.isArray(e)?e:e&&"string"==typeof e?e.split(",").map((function(e){return e.trim()})):[]}),(function(e){return e.join(", ")})),h("asset","",u),h("boolean",!1,(function(e){return"false"!==e&&!1!==e})),h("color","#FFF",d,p),h("int",0,f),h("number",0,(function(e){return parseFloat(e,10)})),h("map","",u),h("model","",u),h("selector",null,(function(e){return e?"string"!=typeof e?e:"#"!==e[0]||l.test(e)?document.querySelector(e):document.getElementById(e.substring(1)):null}),(function(e){return e.getAttribute?"#"+e.getAttribute("id"):p(e)})),h("selectorAll",null,(function(e){return e?"string"!=typeof e?e:Array.prototype.slice.call(document.querySelectorAll(e),0):null}),(function(e){return e instanceof Array?e.map((function(e){return"#"+e.getAttribute("id")})).join(", "):p(e)})),h("src","",(function(e){return a("`src` property type is deprecated. Use `asset` instead."),u(e)})),h("string","",d,p),h("time",0,f),h("vec2",{x:0,y:0},m,n.stringify),h("vec3",{x:0,y:0,z:0},m,n.stringify),h("vec4",{x:0,y:0,z:0,w:1},m,n.stringify),t.exports.registerPropertyType=h,t.exports.isValidDefaultValue=function(e,t){return("audio"!==e||"string"==typeof t)&&!("array"===e&&!Array.isArray(t))&&("asset"!==e||"string"==typeof t)&&("boolean"!==e||"boolean"==typeof t)&&("color"!==e||"string"==typeof t)&&("int"!==e||"number"==typeof t)&&("number"!==e||"number"==typeof t)&&("map"!==e||"string"==typeof t)&&("model"!==e||"string"==typeof t)&&("selector"!==e||"string"==typeof t||null===t)&&("selectorAll"!==e||"string"==typeof t||null===t)&&("src"!==e||"string"==typeof t)&&("string"!==e||"string"==typeof t)&&("time"!==e||"number"==typeof t)&&("vec2"===e?v(t,2):"vec3"===e?v(t,3):"vec4"!==e||v(t,4))},t.exports.isValidDefaultCoordinate=v},{"../utils/coordinates":177,debug:10}],112:[function(e,t,i){var n=e("./metaTags").inject,r=e("./wakelock"),o=e("./loadingScreen"),a=e("../a-register-element"),s=e("./scenes"),l=e("../system").systems,c=e("../../lib/three"),h=e("../../utils/"),u=e("../a-entity"),d=e("../a-node"),p=e("./postMessage"),f=h.bind,m=h.device.isIOS(),v=h.device.isMobile(),g=h.device.isWebXRAvailable,y=a.registerElement,b=h.debug("core:a-scene:warn");function A(e,t,i,n){return t?{height:e.parentElement.offsetHeight,width:e.parentElement.offsetWidth}:function(e,t){var i,n,r=window.devicePixelRatio;return n={height:document.body.offsetHeight,width:document.body.offsetWidth},!e||t||-1===e.width&&-1===e.height||n.width*r<e.width&&n.height*r<e.height||(i=n.width/n.height,n.width*r>e.width&&-1!==e.width&&(n.width=Math.round(e.width/r),n.height=Math.round(e.width/i/r)),n.height*r>e.height&&-1!==e.height&&(n.height=Math.round(e.height/r),n.width=Math.round(e.height*i/r))),n}(i,n)}function w(e){var t;function i(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||e.exitVR(),document.activeElement.blur(),document.body.focus()}(t=document.createElement("canvas")).classList.add("a-canvas"),t.dataset.aframeCanvas=!0,e.appendChild(t),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),t.addEventListener("touchmove",(function(e){e.preventDefault()})),e.canvas=t,e.emit("render-target-loaded",{target:t}),setTimeout(f(e.resize,e),0)}t.exports.AScene=y("a-scene",{prototype:Object.create(u.prototype,{createdCallback:{value:function(){this.clock=new c.Clock,this.isIOS=m,this.isMobile=v,this.hasWebXR=g,this.isAR=!1,this.isScene=!0,this.object3D=new c.Scene;var e=this;this.object3D.onAfterRender=function(t,i,n){e.isPlaying&&e.tock(e.time,e.delta,n)},this.render=f(this.render,this),this.systems={},this.systemNames=[],this.time=this.delta=0,this.behaviors={tick:[],tock:[]},this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("vr-mode-ui",""),this.setAttribute("device-orientation-permission-ui","")}},addFullScreenStyles:{value:function(){document.documentElement.classList.add("a-fullscreen")}},removeFullScreenStyles:{value:function(){document.documentElement.classList.remove("a-fullscreen")}},attachedCallback:{value:function(){var e=this,t=this.hasAttribute("embedded");w(this),this.setupRenderer(),this.resize(),t||this.addFullScreenStyles(),p(this),n(this),r(this),this.onVRPresentChangeBound=f(this.onVRPresentChange,this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){e.enterVR()},this.exitVRBound=function(){e.exitVR()},this.exitVRTrueBound=function(){e.exitVR(!0)},this.pointerRestrictedBound=function(){e.pointerRestricted()},this.pointerUnrestrictedBound=function(){e.pointerUnrestricted()},g||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),this.addEventListener("cameraready",(function(){e.attachedCallbackPostCamera()})),this.initSystems()}},attachedCallbackPostCamera:{value:function(){var e,t=this;e=f(this.resize,this),window.addEventListener("load",e),window.addEventListener("resize",(function(){t.isIOS?setTimeout(e,100):e()})),this.play(),s.push(this)},writable:window.debug},initSystems:{value:function(){var e;for(e in this.initSystem("camera"),l)"camera"!==e&&this.initSystem(e)}},initSystem:{value:function(e){this.systems[e]||(this.systems[e]=new l[e](this),this.systemNames.push(e))}},detachedCallback:{value:function(){var e=s.indexOf(this);s.splice(e,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)}},addBehavior:{value:function(e){var t,i,n=this.behaviors;for(i in n)e[i]&&-1===(t=this.behaviors[i]).indexOf(e)&&t.push(e)}},getPointerLockElement:{value:function(){return document.pointerLockElement},writable:window.debug},checkHeadsetConnected:{value:h.device.checkHeadsetConnected,writable:window.debug},enterAR:{value:function(){if(!this.hasWebXR)throw new Error("Failed to enter AR mode, WebXR not supported.");this.enterVR(!0)}},enterVR:{value:function(e){var t,i=this,n=i.renderer.xr;if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){if(n.enabled=!0,!this.hasWebXR){if(t=h.device.getVRDisplay(),n.setDevice(t),t.isPresenting&&!window.hasNativeWebVRImplementation)return a(),Promise.resolve();var r=this.getAttribute("renderer"),o={highRefreshRate:r.highRefreshRate,foveationLevel:r.foveationLevel};return t.requestPresent([{source:this.canvas,attributes:o}]).then(a,(function(e){throw e&&e.message?new Error("Failed to enter VR mode (`requestPresent`): "+e.message):new Error("Failed to enter VR mode (`requestPresent`).")}))}return this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound),navigator.xr.requestSession(e?"immersive-ar":"immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor"]}).then((function(t){i.xrSession=t,n.setSession(t),t.addEventListener("end",i.exitVRBound),e&&i.addState("ar-mode"),a()})),Promise.resolve()}return a(),Promise.resolve();function a(){var e,t;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(e=new CustomEvent("vrdisplaypresentchange",{detail:{display:h.device.getVRDisplay()}}),window.dispatchEvent(e)),i.addState("vr-mode"),i.emit("enter-vr",{target:i}),!g&&i.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),i.addFullScreenStyles(),i.isMobile||i.checkHeadsetConnected()||((t=i.canvas).requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen).apply(t,[{navigationUI:"hide"}]),i.renderer.setAnimationLoop(i.render),i.resize()}},writable:!0},exitVR:{value:function(){var e,t=this,i=this.renderer.xr;if(!this.is("vr-mode"))return Promise.resolve("Not in VR.");if(this.checkHeadsetConnected()||this.isMobile){if(i.enabled=!1,e=h.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then((function(){}),(function(){})),this.xrSession=void 0,i.setSession(null);else if(e.isPresenting)return e.exitPresent().then(n,(function(e){throw e&&e.message?new Error("Failed to exit VR mode (`exitPresent`): "+e.message):new Error("Failed to exit VR mode (`exitPresent`).")}))}else(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());return n(),Promise.resolve();function n(){t.removeState("vr-mode"),t.removeState("ar-mode"),t.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),t.hasAttribute("embedded")&&t.removeFullScreenStyles(),t.resize(),t.isIOS&&h.forceCanvasResizeSafariMobile(t.canvas),t.renderer.setPixelRatio(window.devicePixelRatio),t.emit("exit-vr",{target:t})}},writable:!0},pointerRestricted:{value:function(){if(this.canvas){var e=this.getPointerLockElement();e&&e!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}},pointerUnrestricted:{value:function(){var e=this.getPointerLockElement();e&&e===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}},onVRPresentChange:{value:function(e){var t=e.display||e.detail.display;t&&t.isPresenting?this.enterVR():this.exitVR()}},getAttribute:{value:function(e){var t=this.systems[e];return t?t.data:u.prototype.getAttribute.call(this,e)}},getComputedAttribute:{value:function(e){b("`getComputedAttribute` is deprecated. Use `getAttribute` instead."),this.getAttribute(e)}},getDOMAttribute:{value:function(e){var t=this.systems[e];return t?t.data:u.prototype.getDOMAttribute.call(this,e)}},setAttribute:{value:function(e,t,i){var n=this.systems[e];if(n)return d.prototype.setAttribute.call(this,e,t),void n.updateProperties(t);u.prototype.setAttribute.call(this,e,t,i)}},removeBehavior:{value:function(e){var t,i,n,r=this.behaviors;for(i in r)e[i]&&-1!==(n=(t=this.behaviors[i]).indexOf(e))&&t.splice(n,1)}},resize:{value:function(){var e,t,i=this.camera,n=this.canvas,r=this.renderer.xr.isPresenting();e=this.renderer.xr.enabled&&r,!i||!n||this.is("vr-mode")&&(this.isMobile||e)||(t=A(n,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),i.aspect=t.width/t.height,i.updateProjectionMatrix(),this.renderer.setSize(t.width,t.height,!1),this.emit("rendererresize",null,!1))},writable:!0},setupRenderer:{value:function(){var e,t,i,n,r=this;n={alpha:!0,antialias:!v,canvas:this.canvas,logarithmicDepthBuffer:!1},this.maxCanvasSize={height:1920,width:1920},this.hasAttribute("renderer")&&(i=this.getAttribute("renderer"),(t=h.styleParser.parse(i)).precision&&(n.precision=t.precision+"p"),t.antialias&&"auto"!==t.antialias&&(n.antialias="true"===t.antialias),t.logarithmicDepthBuffer&&"auto"!==t.logarithmicDepthBuffer&&(n.logarithmicDepthBuffer="true"===t.logarithmicDepthBuffer),t.alpha&&(n.alpha="true"===t.alpha),this.maxCanvasSize={width:t.maxCanvasWidth?parseInt(t.maxCanvasWidth):this.maxCanvasSize.width,height:t.maxCanvasHeight?parseInt(t.maxCanvasHeight):this.maxCanvasSize.height}),(e=this.renderer=new c.WebGLRenderer(n)).setPixelRatio(window.devicePixelRatio),e.sortObjects=!1,this.camera&&e.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",(function(){e.xr.setPoseTarget(r.camera.el.object3D)})),o.setup(this,A)},writable:window.debug},play:{value:function(){var e=this,t=this;this.renderStarted?u.prototype.play.call(this):(this.addEventListener("loaded",(function(){var e,i=this.renderer,n=this.renderer.xr;u.prototype.play.call(this),t.renderStarted||(t.resize(),t.renderer&&(window.performance&&window.performance.mark("render-started"),o.remove(),(e=h.device.getVRDisplay())&&e.isPresenting&&(n.setDevice(e),n.enabled=!0,t.enterVR()),i.setAnimationLoop(this.render),t.renderStarted=!0,t.emit("renderstart")))})),setTimeout((function(){u.prototype.load.call(e)})))}},updateComponent:{value:function(e){e in l||u.prototype.updateComponent.apply(this,arguments)}},tick:{value:function(e,t){var i,n=this.systems;for(i=0;i<this.behaviors.tick.length;i++)this.behaviors.tick[i].el.isPlaying&&this.behaviors.tick[i].tick(e,t);for(i=0;i<this.systemNames.length;i++)n[this.systemNames[i]].tick&&n[this.systemNames[i]].tick(e,t)}},tock:{value:function(e,t,i){var n,r=this.systems;for(n=0;n<this.behaviors.tock.length;n++)this.behaviors.tock[n].el.isPlaying&&this.behaviors.tock[n].tock(e,t,i);for(n=0;n<this.systemNames.length;n++)r[this.systemNames[n]].tock&&r[this.systemNames[n]].tock(e,t,i)}},render:{value:function(e,t){this.renderer,this.frame=t,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var i=null;this.is("ar-mode")&&(i=this.object3D.background,this.object3D.background=null),i&&(this.object3D.background=i)},writable:!0}})}),t.exports.setupCanvas=w},{"../../lib/three":157,"../../utils/":182,"../a-entity":105,"../a-node":107,"../a-register-element":108,"../system":120,"./loadingScreen":113,"./metaTags":114,"./postMessage":115,"./scenes":116,"./wakelock":117}],113:[function(e,t,i){var n,r,o,a=e("../../utils/").styleParser,s="loading-screen";function l(e){var t=n.hasAttribute("embedded"),i=o(n.canvas,t,n.maxCanvasSize,n.is("vr-mode"));e.aspect=i.width/i.height,e.updateProjectionMatrix(),n.renderer.setSize(i.width,i.height,!1)}t.exports.setup=function(e,t){o=t;var i,c,h,u,d,p,f,m,v,g,y=(n=e).hasAttribute(s)?a.parse(n.getAttribute(s)):void 0,b=y&&y.dotsColor||"white",A=y&&y.backgroundColor||"#24CAFF";(void 0===y||"true"===y.enabled||void 0===y.enabled)&&(i=new THREE.Scene,c=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),h=new THREE.MeshBasicMaterial({color:b}),u=new THREE.Mesh(c,h),d=u.clone(),p=u.clone(),f=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),m=new THREE.Clock,v=0,g=function(){n.renderer.render(i,f),v=m.getElapsedTime()%4,u.visible=v>=1,d.visible=v>=2,p.visible=v>=3},i.background=new THREE.Color(A),i.add(f),u.position.set(-1,0,-15),d.position.set(0,0,-15),p.position.set(1,0,-15),f.add(u),f.add(d),f.add(p),(r=document.createElement("div")).className="a-loader-title",r.innerHTML=document.title,r.style.display="none",n.appendChild(r),setTimeout((function(){n.hasLoaded||(l(f),r.style.display="block",window.addEventListener("resize",(function(){l(f)})),n.renderer.setAnimationLoop(g))}),200))},t.exports.remove=function(){window.removeEventListener("resize",l),r&&(r.style.display="none")}},{"../../utils/":182}],114:[function(e,t,i){var n,r=e("../../constants/"),o=e("../../utils").extend,a=t.exports.MOBILE_HEAD_TAGS=[l({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),l({name:"mobile-web-app-capable",content:"yes"}),l({name:"theme-color",content:"black"})],s=[l({name:"apple-mobile-web-app-capable",content:"yes"}),l({name:"apple-mobile-web-app-status-bar-style",content:"black"}),(n={rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"},{tagName:"link",attributes:n,exists:function(){return document.querySelector('link[rel="'+n.rel+'"]')}})];function l(e){return{tagName:"meta",attributes:e,exists:function(){return document.querySelector('meta[name="'+e.name+'"]')}}}t.exports.inject=function(e){var t,i=document.head,n=i.querySelector("script"),l=[];return a.forEach(c),e.isIOS&&s.forEach(c),l;function c(e){e&&!e.exists()&&(t=function(e){if(e&&e.tagName){var t=document.createElement(e.tagName);return t.setAttribute(r.AFRAME_INJECTED,""),o(t,e.attributes)}}(e))&&(n?n.parentNode.insertBefore(t,n):i.appendChild(t),l.push(t))}}},{"../../constants/":101,"../../utils":182}],115:[function(e,t,i){var n=e("../../utils/bind"),r=e("../../utils/").isIframed;function o(e){if(e.data&&"vr"===e.data.type)switch(e.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}t.exports=function(e){r()&&window.addEventListener("message",n(o,e))}},{"../../utils/":182,"../../utils/bind":176}],116:[function(e,t,i){t.exports=[]},{}],117:[function(e,t,i){var n=e("../../../vendor/wakelock/wakelock");t.exports=function(e){if(e.isMobile){var t=e.wakelock=new n;e.addEventListener("enter-vr",(function(){t.request()})),e.addEventListener("exit-vr",(function(){t.release()}))}}},{"../../../vendor/wakelock/wakelock":196}],118:[function(e,t,i){var n,r=e("../utils/"),o=e("./propertyTypes"),a=r.debug,s=o.isValidDefaultValue,l=o.propertyTypes,c=a("core:schema:warn");function h(e){return"type"in e?"string"==typeof e.type:"default"in e}function u(e,t){var i,n,r=e.default,o=e.type;return e.type?"bool"===e.type?o="boolean":"float"===e.type&&(o="number"):o=void 0===r||"boolean"!=typeof r&&"number"!=typeof r?Array.isArray(r)?"array":"string":typeof r,(n=l[o])||c("Unknown property type for component `"+t+"`: "+o),i=!!e.parse,e.parse=e.parse||n.parse,e.stringify=e.stringify||n.stringify,e.type=o,"default"in e?i||s(o,r)||c("Default value `"+r+"` does not match type `"+o+"` in component `"+t+"`"):e.default=n.default,e}function d(e,t){return null!=e&&""!==e||(e=t.default,Array.isArray(e)&&(e=e.slice())),t.parse(e,t.default)}function p(e,t){return"object"!=typeof e?e:t&&null!==e?t.stringify(e):JSON.stringify(e)}t.exports.isSingleProperty=h,t.exports.process=function(e,t){var i;if(h(e))return u(e,t);for(i in e)e[i]=u(e[i],t);return e},t.exports.processPropertyDefinition=u,t.exports.parseProperties=(n=[],function(e,t,i,r,o){var a,s,l,h;for(s in n.length=0,i?e:t)i&&void 0===e[s]||n.push(s);if(null===e||"object"!=typeof e)return e;for(s in e)void 0===e[s]||t[s]||o||c("Unknown property `"+s+"` for component/system `"+r+"`.");for(a=0;a<n.length;a++){if(l=t[s=n[a]],h=e[s],!t[s])return;e[s]=d(h,l)}return e}),t.exports.parseProperty=d,t.exports.stringifyProperties=function(e,t){var i,n,r,o,a={};for(i in e)n=t[i],"object"==typeof(o=r=e[i])&&(o=p(r,n),n||c("Unknown component property: "+i)),a[i]=o;return a},t.exports.stringifyProperty=p},{"../utils/":182,"./propertyTypes":111}],119:[function(e,t,i){var n=e("./schema").process,r=t.exports.shaders={},o=t.exports.shaderNames=[],a=e("../lib/three"),s=e("../utils"),l={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},c=t.exports.Shader=function(){};c.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(e){return this.attributes=this.initVariables(e,"attribute"),this.uniforms=this.initVariables(e,"uniform"),this.material=new(this.raw?a.RawShaderMaterial:a.ShaderMaterial)({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initVariables:function(e,t){var i,n,r=this.schema,o={};for(i in r)r[i].is===t&&(n=l[r[i].type],o[i]={type:n,value:void 0});return o},update:function(e){this.updateVariables(e,"attribute"),this.updateVariables(e,"uniform")},updateVariables:function(e,t){var i,n,r,o=this.schema;for(i in r="uniform"===t?this.uniforms:this.attributes,e)if(o[i]&&o[i].is===t)if("map"!==o[i].type)r[i].value=this.parseValue(o[i].type,e[i]),r[i].needsUpdate=!0;else{if(!r[i]||r[i].value===e[i])continue;n="_texture_"+i,this.setMapOnTextureLoad(r,i,n),s.material.updateMapMaterialFromData(n,i,this,e)}},parseValue:function(e,t){var i;switch(e){case"vec2":return new a.Vector2(t.x,t.y);case"vec3":return new a.Vector3(t.x,t.y,t.z);case"vec4":return new a.Vector4(t.x,t.y,t.z,t.w);case"color":return i=new a.Color(t),new a.Vector3(i.r,i.g,i.b);case"map":return a.ImageUtils.loadTexture(t);default:return t}},setMapOnTextureLoad:function(e,t,i){var n=this;this.el.addEventListener("materialtextureloaded",(function(){e[t].value=n.material[i],e[t].needsUpdate=!0}))}},t.exports.registerShader=function(e,t){var i,a={};if(Object.keys(t).forEach((function(e){a[e]={value:t[e],writable:!0}})),r[e])throw new Error("The shader "+e+" has been already registered");return(i=function(){c.call(this)}).prototype=Object.create(c.prototype,a),i.prototype.name=e,i.prototype.constructor=i,r[e]={Shader:i,schema:n(i.prototype.schema)},o.push(e),i}},{"../lib/three":157,"../utils":182,"./schema":118}],120:[function(e,t,i){var n=e("./component"),r=e("./schema"),o=e("../utils/"),a=r.parseProperties,s=r.parseProperty,l=r.process,c=r.isSingleProperty,h=o.styleParser,u=t.exports.systems={},d=t.exports.System=function(e){var t=n&&n.components[this.name];this.el=e,this.sceneEl=e,t&&(t.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};d.prototype={schema:{},init:function(){},update:function(e){},updateProperties:function(e){var t=this.data;Object.keys(r).length&&(this.buildData(e),this.update(t))},buildData:function(e){var t=this.schema;Object.keys(t).length&&(e=e||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),c(t)?this.data=s(e,t):this.data=a(h.parse(e)||{},t))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},t.exports.registerSystem=function(e,t){var i,n,r={},a=o.findAllScenes(document);if(Object.keys(t).forEach((function(e){r[e]={value:t[e],writable:!0}})),u[e])throw new Error("The system `"+e+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");for((n=function(e){d.call(this,e)}).prototype=Object.create(d.prototype,r),n.prototype.name=e,n.prototype.constructor=n,n.prototype.schema=o.extend(l(n.prototype.schema)),u[e]=n,i=0;i<a.length;i++)a[i].initSystem(e)}},{"../utils/":182,"./component":109,"./schema":118}],121:[function(e,t,i){e("./pivot")},{"./pivot":122}],122:[function(e,t,i){var n=e("../../core/component").registerComponent,r=e("../../lib/three"),o=new r.Vector3,a=new r.Vector3;n("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var e=this.data,t=this.el,i=t.object3D.parent,n=t.object3D,s=new r.Group;o.copy(n.position),a.copy(n.rotation),i.remove(n),s.add(n),i.add(s),t.object3D=s,n.position.set(-1*e.x,-1*e.y,-1*e.z),s.position.set(e.x+o.x,e.y+o.y,e.z+o.z),s.rotation.copy(n.rotation),n.rotation.set(0,0,0)}})},{"../../core/component":109,"../../lib/three":157}],123:[function(e,t,i){var n=e("../../core/component").components,r=e("../../core/shader").shaders,o=e("../../utils/"),a={};function s(e){var t=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();"fog"===e&&(t="material-fog"),"visible"===e&&(t="material-visible"),a[t]="material."+e}Object.keys(n.material.schema).forEach(s),Object.keys(r.standard.schema).forEach(s),t.exports=function(){return{defaultComponents:{material:{}},mappings:o.extend({},a)}}},{"../../core/component":109,"../../core/shader":119,"../../utils/":182}],124:[function(e,t,i){e("./primitives/a-camera"),e("./primitives/a-cursor"),e("./primitives/a-curvedimage"),e("./primitives/a-gltf-model"),e("./primitives/a-image"),e("./primitives/a-light"),e("./primitives/a-link"),e("./primitives/a-obj-model"),e("./primitives/a-sky"),e("./primitives/a-sound"),e("./primitives/a-text"),e("./primitives/a-video"),e("./primitives/a-videosphere"),e("./primitives/meshPrimitives")},{"./primitives/a-camera":126,"./primitives/a-cursor":127,"./primitives/a-curvedimage":128,"./primitives/a-gltf-model":129,"./primitives/a-image":130,"./primitives/a-light":131,"./primitives/a-link":132,"./primitives/a-obj-model":133,"./primitives/a-sky":134,"./primitives/a-sound":135,"./primitives/a-text":136,"./primitives/a-video":137,"./primitives/a-videosphere":138,"./primitives/meshPrimitives":139}],125:[function(e,t,i){var n=e("../../core/a-entity"),r=e("../../core/component").components,o=e("../../core/a-register-element").registerElement,a=e("../../utils/"),s=a.debug,l=a.entity.setComponentProperty,c=s("extras:primitives:debug"),h=s("extras:primitives:warn"),u=t.exports.primitives={};t.exports.registerPrimitive=function(e,t){e=e.toLowerCase(),c("Registering <%s>",e),t.defaultAttributes&&h("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var i=o(e,{prototype:Object.create(n.prototype,{defaultComponentsFromPrimitive:{value:t.defaultComponents||t.defaultAttributes||{}},deprecated:{value:t.deprecated||null},deprecatedMappings:{value:t.deprecatedMappings||{}},mappings:{value:t.mappings||{}},createdCallback:{value:function(){t.deprecated&&console.warn(t.deprecated),this.resolveMappingCollisions()}},resolveMappingCollisions:{value:function(){var e=this.mappings,t=this;Object.keys(e).forEach((function(i){var n;i!==i.toLowerCase()&&h("Mapping keys should be specified in lower case. The mapping key "+i+" may not be recognized"),r[i]&&(n=e[i].replace(".","-"),e[n]=e[i],delete e[i],console.warn("The primitive "+t.tagName.toLowerCase()+" has a mapping collision. The attribute "+i+" has the same name as a registered component and has been renamed to "+n))}))}},getExtraComponents:{value:function(){var e,t,i,n,r,o,s=this;for(t=a.clone(this.defaultComponentsFromPrimitive),(r=this.getAttribute("mixin"))&&(r=r.trim().split(" ")).forEach((function(e){var i=s.sceneEl.querySelector("#"+e).componentCache;Object.keys(i).forEach((function(e){var n,r;t[e]=(n=t[e],r=i[e],l(n)?c(r):l(r)?c(n):h(n)&&h(r)?a.extendDeep(n,r):c(r))}))})),i=0;i<this.attributes.length;i++)e=this.attributes[i],(n=this.mappings[e.name])&&((o=a.entity.getComponentPropertyPath(n)).constructor===Array?(t[o[0]]=t[o[0]]||{},t[o[0]][o[1]]=e.value.trim()):t[o]=e.value.trim());return t;function l(e){return void 0===e}function c(e){return h(e)?a.extendDeep({},e):e}function h(e){return null!==e&&e.constructor===Object}}},attributeChangedCallback:{value:function(e,t,i){var n=this.mappings[e];e in this.deprecatedMappings&&console.warn(this.deprecatedMappings[e]),e&&n&&l(this,n,i)}}})});return u[e]=i,i},t.exports.definePrimitive=function(e,i,n){n=n||{},Object.keys(i).map((function(e){!function(e,t){var i=r[e].schema;Object.keys(i).map((function(i){var n=i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();void 0!==t[n]&&(n=e+"-"+i),t[n]=e+"."+i}))}(e,n)})),t.exports.registerPrimitive(e,a.extendDeep({},null,{defaultComponents:i,mappings:n}))}},{"../../core/a-entity":105,"../../core/a-register-element":108,"../../core/component":109,"../../utils/":182}],126:[function(e,t,i){(0,e("../primitives").registerPrimitive)("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},{"../primitives":125}],127:[function(e,t,i){var n=e("../getMeshMixin");(0,e("../primitives").registerPrimitive)("a-cursor",e("../../../utils/").extendDeep({},n(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],128:[function(e,t,i){var n=e("../getMeshMixin");(0,e("../primitives").registerPrimitive)("a-curvedimage",e("../../../utils/").extendDeep({},n(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],129:[function(e,t,i){(0,e("../primitives").registerPrimitive)("a-gltf-model",{mappings:{src:"gltf-model"}})},{"../primitives":125}],130:[function(e,t,i){var n=e("../getMeshMixin");(0,e("../primitives").registerPrimitive)("a-image",e("../../../utils/").extendDeep({},n(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],131:[function(e,t,i){(0,e("../primitives").registerPrimitive)("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target"}})},{"../primitives":125}],132:[function(e,t,i){(0,e("../primitives").registerPrimitive)("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},{"../primitives":125}],133:[function(e,t,i){var n=e("../getMeshMixin")();(0,e("../primitives").registerPrimitive)("a-obj-model",e("../../../utils/").extendDeep({},n,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],134:[function(e,t,i){var n=e("../getMeshMixin"),r=e("../primitives").registerPrimitive,o=e("../../../utils/"),a=e("./meshPrimitives");r("a-sky",o.extendDeep({},n(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:o.extendDeep({},a["a-sphere"].prototype.mappings)}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125,"./meshPrimitives":139}],135:[function(e,t,i){(0,e("../primitives").registerPrimitive)("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},{"../primitives":125}],136:[function(e,t,i){(0,e("../primitives").definePrimitive)("a-text",{text:{anchor:"align",width:5}})},{"../primitives":125}],137:[function(e,t,i){var n=e("../getMeshMixin");(0,e("../primitives").registerPrimitive)("a-video",e("../../../utils/").extendDeep({},n(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],138:[function(e,t,i){var n=e("../getMeshMixin");(0,e("../primitives").registerPrimitive)("a-videosphere",e("../../../utils/").extendDeep({},n(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},{"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],139:[function(e,t,i){var n=e("../getMeshMixin"),r=e("../../../core/geometry").geometries,o=e("../../../core/geometry").geometryNames,a=e("../primitives").registerPrimitive,s=e("../../../utils/"),l=t.exports={};function c(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}o.forEach((function(e){var t=r[e],i=c(e),o={};Object.keys(t.schema).forEach((function(e){o[c(e)]="geometry."+e}));var h="a-"+i,u=a(h,s.extendDeep({},n(),{defaultComponents:{geometry:{primitive:e}},mappings:o}));l[h]=u}))},{"../../../core/geometry":110,"../../../utils/":182,"../getMeshMixin":123,"../primitives":125}],140:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(e){this.geometry=new r.BoxGeometry(e.width,e.height,e.depth,e.segmentsWidth,e.segmentsHeight,e.segmentsDepth)}})},{"../core/geometry":110,"../lib/three":157}],141:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=r.Math.degToRad;n("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new r.CircleGeometry(e.radius,e.segments,o(e.thetaStart),o(e.thetaLength))}})},{"../core/geometry":110,"../lib/three":157}],142:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=r.Math.degToRad;n("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new r.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,o(e.thetaStart),o(e.thetaLength))}})},{"../core/geometry":110,"../lib/three":157}],143:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=r.Math.degToRad;n("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new r.CylinderGeometry(e.radius,e.radius,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,o(e.thetaStart),o(e.thetaLength))}})},{"../core/geometry":110,"../lib/three":157}],144:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new r.DodecahedronGeometry(e.radius,e.detail)}})},{"../core/geometry":110,"../lib/three":157}],145:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new r.IcosahedronGeometry(e.radius,e.detail)}})},{"../core/geometry":110,"../lib/three":157}],146:[function(e,t,i){e("./box.js"),e("./circle.js"),e("./cone.js"),e("./cylinder.js"),e("./dodecahedron.js"),e("./icosahedron.js"),e("./octahedron.js"),e("./plane.js"),e("./ring.js"),e("./sphere.js"),e("./tetrahedron.js"),e("./torus.js"),e("./torusKnot.js"),e("./triangle.js")},{"./box.js":140,"./circle.js":141,"./cone.js":142,"./cylinder.js":143,"./dodecahedron.js":144,"./icosahedron.js":145,"./octahedron.js":147,"./plane.js":148,"./ring.js":149,"./sphere.js":150,"./tetrahedron.js":151,"./torus.js":152,"./torusKnot.js":153,"./triangle.js":154}],147:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new r.OctahedronGeometry(e.radius,e.detail)}})},{"../core/geometry":110,"../lib/three":157}],148:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(e){this.geometry=new r.PlaneGeometry(e.width,e.height,e.segmentsWidth,e.segmentsHeight)}})},{"../core/geometry":110,"../lib/three":157}],149:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=r.Math.degToRad;n("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new r.RingGeometry(e.radiusInner,e.radiusOuter,e.segmentsTheta,e.segmentsPhi,o(e.thetaStart),o(e.thetaLength))}})},{"../core/geometry":110,"../lib/three":157}],150:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=r.Math.degToRad;n("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(e){this.geometry=new r.SphereGeometry(e.radius,e.segmentsWidth,e.segmentsHeight,o(e.phiStart),o(e.phiLength),o(e.thetaStart),o(e.thetaLength))}})},{"../core/geometry":110,"../lib/three":157}],151:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new r.TetrahedronGeometry(e.radius,e.detail)}})},{"../core/geometry":110,"../lib/three":157}],152:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=r.Math.degToRad;n("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(e){this.geometry=new r.TorusGeometry(e.radius,2*e.radiusTubular,e.segmentsRadial,e.segmentsTubular,o(e.arc))}})},{"../core/geometry":110,"../lib/three":157}],153:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three");n("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(e){this.geometry=new r.TorusKnotGeometry(e.radius,2*e.radiusTubular,e.segmentsTubular,e.segmentsRadial,e.p,e.q)}})},{"../core/geometry":110,"../lib/three":157}],154:[function(e,t,i){var n=e("../core/geometry").registerGeometry,r=e("../lib/three"),o=new r.Quaternion,a=new r.Vector3(0,0,1),s=new r.Vector2,l=new r.Vector2,c=new r.Vector2;n("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(e){var t,i,n,h,u,d;(n=new r.Triangle).a.set(e.vertexA.x,e.vertexA.y,e.vertexA.z),n.b.set(e.vertexB.x,e.vertexB.y,e.vertexB.z),n.c.set(e.vertexC.x,e.vertexC.y,e.vertexC.z),i=n.getNormal(new r.Vector3),o.setFromUnitVectors(i,a),h=n.a.clone().applyQuaternion(o),u=n.b.clone().applyQuaternion(o),d=n.c.clone().applyQuaternion(o),s.set(Math.min(h.x,u.x,d.x),Math.min(h.y,u.y,d.y)),l.set(Math.max(h.x,u.x,d.x),Math.max(h.y,u.y,d.y)),c.set(0,0).subVectors(l,s),h=(new r.Vector2).subVectors(h,s).divide(c),u=(new r.Vector2).subVectors(u,s).divide(c),d=(new r.Vector2).subVectors(d,s).divide(c),(t=this.geometry=new r.Geometry).vertices.push(n.a),t.vertices.push(n.b),t.vertices.push(n.c),t.faces.push(new r.Face3(0,1,2,i)),t.faceVertexUvs[0]=[[h,u,d]]}})},{"../core/geometry":110,"../lib/three":157}],155:[function(e,t,i){if(window.Promise=window.Promise||e("promise-polyfill"),window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=void 0!==navigator.xr,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var n=e("./utils/isIOSOlderThan10")(window.navigator.userAgent)?1/window.devicePixelRatio:1,r=e("webvr-polyfill"),o={BUFFER_SCALE:n,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0};window.webvrpolyfill=new r(o)}var a=e("./utils/"),s=a.debug;a.isIE11&&(e("custom-event-polyfill"),e("../vendor/starts-with-polyfill"));var l=s("A-Frame:error"),c=s("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&c("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),"file:"===window.location.protocol&&l("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/0.5.0/introduction/getting-started.html#using-a-local-server."),e("present"),a.device.isBrowserEnvironment&&(e("./style/aframe.css"),e("./style/rStats.css"));var h=e("./core/scene/a-scene").AScene,u=e("./core/component").components,d=e("./core/component").registerComponent,p=e("./core/geometry").registerGeometry,f=e("./extras/primitives/primitives").registerPrimitive,m=e("./core/shader").registerShader,v=e("./core/system").registerSystem,g=e("./core/shader").shaders,y=e("./core/system").systems,b=window.THREE=e("./lib/three"),A=e("../package");e("./components/index"),e("./geometries/index"),e("./shaders/index"),e("./systems/index");var w=e("./core/a-node"),x=e("./core/a-entity");e("./core/a-assets"),e("./core/a-cubemap"),e("./core/a-mixin"),e("./extras/components/"),e("./extras/primitives/"),console.log("A-Frame Version: 1.0.4 (Date 2020-02-05, Commit #2b359246)"),console.log("three Version (https://github.com/supermedium/three.js):",A.dependencies["super-three"]),console.log("WebVR Polyfill Version:",A.dependencies["webvr-polyfill"]),t.exports=window.AFRAME={AComponent:e("./core/component").Component,AEntity:x,ANode:w,ANIME:e("super-animejs"),AScene:h,components:u,coreComponents:Object.keys(u),geometries:e("./core/geometry").geometries,registerComponent:d,registerElement:e("./core/a-register-element").registerElement,registerGeometry:p,registerPrimitive:f,registerShader:m,registerSystem:v,primitives:{getMeshMixin:e("./extras/primitives/getMeshMixin"),primitives:e("./extras/primitives/primitives").primitives},scenes:e("./core/scene/scenes"),schema:e("./core/schema"),shaders:g,systems:y,THREE:b,utils:a,version:A.version}},{"../package":54,"../vendor/starts-with-polyfill":194,"./components/index":64,"./core/a-assets":103,"./core/a-cubemap":104,"./core/a-entity":105,"./core/a-mixin":106,"./core/a-node":107,"./core/a-register-element":108,"./core/component":109,"./core/geometry":110,"./core/scene/a-scene":112,"./core/scene/scenes":116,"./core/schema":118,"./core/shader":119,"./core/system":120,"./extras/components/":121,"./extras/primitives/":124,"./extras/primitives/getMeshMixin":123,"./extras/primitives/primitives":125,"./geometries/index":146,"./lib/three":157,"./shaders/index":159,"./style/aframe.css":164,"./style/rStats.css":165,"./systems/index":169,"./utils/":182,"./utils/isIOSOlderThan10":184,"custom-event-polyfill":9,present:33,"promise-polyfill":34,"super-animejs":36,"webvr-polyfill":49}],156:[function(e,t,i){window.aframeStats=function(e){var t=null,i=e;return{update:function(){var e;t("te").set((e=i.querySelectorAll("*"),Array.prototype.slice.call(e).filter((function(e){return e.isEntity})),e.length)),window.performance.getEntriesByName&&t("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function(){},end:function(){},attach:function(e){t=e},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}},"object"==typeof t&&(t.exports={aframeStats:window.aframeStats})},{}],157:[function(e,t,i){(function(i){var n=i.THREE=e("super-three");n.TextureLoader&&(n.TextureLoader.prototype.crossOrigin="anonymous"),n.ImageLoader&&(n.ImageLoader.prototype.crossOrigin="anonymous"),n.Cache&&(n.Cache.enabled=!0),e("../../vendor/DeviceOrientationControls"),e("super-three/examples/js/loaders/DRACOLoader"),e("super-three/examples/js/loaders/GLTFLoader"),e("super-three/examples/js/loaders/OBJLoader"),e("super-three/examples/js/loaders/MTLLoader"),n.DRACOLoader.prototype.crossOrigin="anonymous",n.GLTFLoader.prototype.crossOrigin="anonymous",n.MTLLoader.prototype.crossOrigin="anonymous",n.OBJLoader.prototype.crossOrigin="anonymous",t.exports=n}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../vendor/DeviceOrientationControls":191,"super-three":37,"super-three/examples/js/loaders/DRACOLoader":38,"super-three/examples/js/loaders/GLTFLoader":39,"super-three/examples/js/loaders/MTLLoader":40,"super-three/examples/js/loaders/OBJLoader":41}],158:[function(e,t,i){var n=e("../core/shader").registerShader,r=e("../lib/three"),o=e("../utils/");function a(e,t){return t.color.set(e.color),t.fog=e.fog,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,t}t.exports.Shader=n("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(e){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new r.Color},this.textureSrc=null,a(e,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new r.MeshBasicMaterial(this.materialData),o.material.updateMap(this,e)},update:function(e){this.updateMaterial(e),o.material.updateMap(this,e)},updateMaterial:function(e){var t;for(t in a(e,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.materialData)this.material[t]=this.materialData[t]}})},{"../core/shader":119,"../lib/three":157,"../utils/":182}],159:[function(e,t,i){e("./flat"),e("./standard"),e("./sdf"),e("./msdf"),e("./ios10hls")},{"./flat":158,"./ios10hls":160,"./msdf":161,"./sdf":162,"./standard":163}],160:[function(e,t,i){var n=e("../core/shader").registerShader;t.exports.Shader=n("chromaKey",{schema:{color:{type:"color",is:"uniform",default:32768},src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_threshold:{type:"number",is:"uniform",default:.8},_slope:{type:"number",is:"uniform",default:.2}},vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D src;","uniform vec3 color;","uniform float opacity;","varying vec2 vUV;","uniform float _threshold;","uniform float _slope;","void main(){"," vec3 tColor = texture2D( src, vUV ).rgb;"," float a = texture2D( src, vUV ).a;"," float d1, d2, d3, d4, d;"," d1 = abs(length(abs(color.rgb - tColor.rgb)));"," float c1 = abs(length( tColor.g - tColor.r) - length(color.g - color.r));"," float c2 = abs(length( tColor.r - tColor.b) - length(color.r - color.b));"," float c3 = abs(length( tColor.b - tColor.g) - length(color.b - color.g));"," d4 = c1 + c2 + c3;"," d = (d1*2.0 + d4) / 2.0 ;"," float edge0 = _threshold * (1.0 - _slope);"," float alpha = smoothstep(edge0, _threshold, d);"," if (alpha < opacity){","   gl_FragColor = vec4(tColor, alpha*a);"," }"," else{","   gl_FragColor = vec4(tColor, opacity*a);"," }","}"].join("\n")}),t.exports.Shader=n("HSVMatting",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_keyingColorH:{type:"number",is:"uniform",default:.33},_keyingColorS:{type:"number",is:"uniform",default:1},_keyingColorV:{type:"number",is:"uniform",default:.75},_deltaH:{type:"number",is:"uniform",default:.2},_deltaS:{type:"number",is:"uniform",default:.1},_deltaV:{type:"number",is:"uniform",default:.1}},vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","uniform float _keyingColorH;","uniform float _keyingColorS;","uniform float _keyingColorV;","uniform float _deltaH;","uniform float _deltaS;","uniform float _deltaV;","vec3 rgb2hsv(vec3 c){"," vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);"," vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));"," vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));"," float d = q.x - min(q.w, q.y);"," float e = 1.0e-10;"," return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","void main(){"," vec3 tColor = texture2D( src, vUV ).rgb;"," float a = texture2D( src, vUV ).a;"," vec3 HSV = rgb2hsv(tColor);"," float h = abs(HSV.x - _keyingColorH);"," float s = abs(HSV.y - _keyingColorS);"," float v = abs(HSV.z - _keyingColorV);"," float alpha = opacity;"," if (h <= _deltaH * 0.5 && s <= _deltaS && v <= _deltaV){","   alpha = smoothstep((_deltaH * 0.5) * 0.8, _deltaH* 0.6 ,h);"," }","gl_FragColor = vec4(tColor, alpha*a);","}"].join("\n")}),t.exports.Shader=n("ios10hls",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","void main() {","  vec2 offset = vec2(0, 0);","  vec2 repeat = vec2(1, 1);","  vec4 color = texture2D(src, vec2(vUV.x / repeat.x + offset.x, (1.0 - vUV.y) / repeat.y + offset.y)).bgra;","  gl_FragColor = vec4(color.rgb, opacity);","}"].join("\n")})},{"../core/shader":119}],161:[function(e,t,i){var n=e("../core/shader").registerShader;t.exports.Shader=n("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sample = texture2D(map, vUV).rgb;","  if (negate) { sample = 1.0 - sample; }","  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","}"].join("\n")})},{"../core/shader":119}],162:[function(e,t,i){var n=e("../core/shader").registerShader;t.exports.Shader=n("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture2D(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture2D(map, box.xy).a, width)","        + contour(texture2D(map, box.zw).a, width)","        + contour(texture2D(map, box.xw).a, width)","        + contour(texture2D(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture2D(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  gl_FragColor = vec4(color, opacity * alpha);","}"].join("\n")})},{"../core/shader":119}],163:[function(e,t,i){var n=e("../core/shader").registerShader,r=e("../lib/three"),o=e("../utils/"),a=new r.CubeTextureLoader,s={};function l(e,t){return t.color.set(e.color),t.emissive.set(e.emissive),t.emissiveIntensity=e.emissiveIntensity,t.fog=e.fog,t.metalness=e.metalness,t.roughness=e.roughness,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,e.normalMap&&(t.normalScale=e.normalScale),e.ambientOcclusionMap&&(t.aoMapIntensity=e.ambientOcclusionMapIntensity),e.displacementMap&&(t.displacementScale=e.displacementScale,t.displacementBias=e.displacementBias),t}t.exports.Shader=n("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(e){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new r.Color,emissive:new r.Color},l(e,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.material=new r.MeshStandardMaterial(this.materialData),o.material.updateMap(this,e),e.normalMap&&o.material.updateDistortionMap("normal",this,e),e.displacementMap&&o.material.updateDistortionMap("displacement",this,e),e.ambientOcclusionMap&&o.material.updateDistortionMap("ambientOcclusion",this,e),e.metalnessMap&&o.material.updateDistortionMap("metalness",this,e),e.roughnessMap&&o.material.updateDistortionMap("roughness",this,e),this.updateEnvMap(e)},update:function(e){this.updateMaterial(e),o.material.updateMap(this,e),e.normalMap&&o.material.updateDistortionMap("normal",this,e),e.displacementMap&&o.material.updateDistortionMap("displacement",this,e),e.ambientOcclusionMap&&o.material.updateDistortionMap("ambientOcclusion",this,e),e.metalnessMap&&o.material.updateDistortionMap("metalness",this,e),e.roughnessMap&&o.material.updateDistortionMap("roughness",this,e),this.updateEnvMap(e)},updateMaterial:function(e){var t,i=this.material;for(t in l(e,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.materialData)i[t]=this.materialData[t]},updateEnvMap:function(e){var t=this,i=this.material,n=e.envMap,l=e.sphericalEnvMap;if(!n&&!l||this.isLoadingEnvMap)return i.envMap=null,void(i.needsUpdate=!0);this.isLoadingEnvMap=!0,l?this.el.sceneEl.systems.material.loadTexture(l,{src:l},(function(e){t.isLoadingEnvMap=!1,e.mapping=r.SphericalReflectionMapping,i.envMap=e,o.material.handleTextureEvents(t.el,e),i.needsUpdate=!0})):s[n]?s[n].then((function(e){t.isLoadingEnvMap=!1,i.envMap=e,o.material.handleTextureEvents(t.el,e),i.needsUpdate=!0})):s[n]=new Promise((function(e){o.srcLoader.validateCubemapSrc(n,(function(n){a.load(n,(function(n){t.isLoadingEnvMap=!1,i.envMap=n,o.material.handleTextureEvents(t.el,n),e(n)}))}))}))}})},{"../core/shader":119,"../lib/three":157,"../utils/":182}],164:[function(e,t,i){var n="html.a-fullscreen{bottom:0;left:0;position:fixed;right:0;top:0}html.a-fullscreen body{height:100%;margin:0;overflow:hidden;padding:0;width:100%}html.a-fullscreen .a-canvas{width:100%!important;height:100%!important;top:0!important;left:0!important;right:0!important;bottom:0!important;position:fixed!important}html:not(.a-fullscreen) .a-enter-ar,html:not(.a-fullscreen) .a-enter-vr{right:5px;bottom:5px}:-webkit-full-screen{background-color:transparent}.a-hidden{display:none!important}.a-canvas{height:100%;left:0;position:absolute;top:0;width:100%}.a-canvas.a-grab-cursor:hover{cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}canvas.a-canvas.a-mouse-cursor-hover:hover{cursor:pointer}.a-inspector-loader{background-color:#ed3160;position:fixed;left:3px;top:3px;padding:6px 10px;color:#fff;text-decoration:none;font-size:12px;font-family:Roboto,sans-serif;text-align:center;z-index:99999;width:204px}@keyframes dots-1{from{opacity:0}25%{opacity:1}}@keyframes dots-2{from{opacity:0}50%{opacity:1}}@keyframes dots-3{from{opacity:0}75%{opacity:1}}@-webkit-keyframes dots-1{from{opacity:0}25%{opacity:1}}@-webkit-keyframes dots-2{from{opacity:0}50%{opacity:1}}@-webkit-keyframes dots-3{from{opacity:0}75%{opacity:1}}.a-inspector-loader .dots span{animation:dots-1 2s infinite steps(1);-webkit-animation:dots-1 2s infinite steps(1)}.a-inspector-loader .dots span:first-child+span{animation-name:dots-2;-webkit-animation-name:dots-2}.a-inspector-loader .dots span:first-child+span+span{animation-name:dots-3;-webkit-animation-name:dots-3}a-scene{display:block;position:relative;height:100%;width:100%}a-assets,a-scene audio,a-scene img,a-scene video{display:none}.a-enter-vr-modal,.a-orientation-modal{font-family:Consolas,Andale Mono,Courier New,monospace}.a-enter-vr-modal a{border-bottom:1px solid #fff;padding:2px 0;text-decoration:none;transition:.1s color ease-in}.a-enter-vr-modal a:hover{background-color:#fff;color:#111;padding:2px 4px;position:relative;left:-4px}.a-enter-ar,.a-enter-vr{font-family:sans-serif,monospace;font-size:13px;width:100%;font-weight:200;line-height:16px;position:absolute;right:20px;bottom:20px}.a-enter-ar{right:80px}.a-enter-vr-button,.a-enter-vr-modal,.a-enter-vr-modal a{color:#fff;user-select:none;outline:0}.a-enter-vr-button{background:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat rgba(0,0,0,.35)}.a-enter-ar-button{background:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat rgba(0,0,0,.2)}.a-enter-ar-button,.a-enter-vr-button{background-size:90% 90%;border:0;bottom:0;cursor:pointer;min-width:58px;min-height:34px;padding-right:0;padding-top:0;position:absolute;right:0;transition:background-color .05s ease;-webkit-transition:background-color .05s ease;z-index:9999;border-radius:8px;touch-action:manipulation}.a-enter-ar-button{background-size:100% 90%;margin-right:10px;border-radius:7px}.a-enter-ar-button:active,.a-enter-ar-button:hover,.a-enter-vr-button:active,.a-enter-vr-button:hover{background-color:#ef2d5e}.a-enter-vr-button.resethover{background-color:rgba(0,0,0,.35)}[data-a-enter-vr-no-webvr] .a-enter-vr-button{border-color:#666;opacity:.65}[data-a-enter-vr-no-webvr] .a-enter-vr-button:active,[data-a-enter-vr-no-webvr] .a-enter-vr-button:hover{background-color:rgba(0,0,0,.35);cursor:not-allowed}.a-enter-vr-modal{background-color:#666;border-radius:0;display:none;min-height:32px;margin-right:70px;padding:9px;width:280px;right:2%;position:absolute}.a-enter-vr-modal:after{border-bottom:10px solid transparent;border-left:10px solid #666;border-top:10px solid transparent;display:inline-block;content:'';position:absolute;right:-5px;top:5px;width:0;height:0}.a-enter-vr-modal a,.a-enter-vr-modal p{display:inline}.a-enter-vr-modal p{margin:0}.a-enter-vr-modal p:after{content:' '}[data-a-enter-vr-no-headset].a-enter-vr:hover .a-enter-vr-modal,[data-a-enter-vr-no-webvr].a-enter-vr:hover .a-enter-vr-modal{display:block}.a-orientation-modal{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center/50% 50% no-repeat rgba(244,244,244,1);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-orientation-modal:after{color:#666;content:\"Insert phone into Cardboard holder.\";display:block;position:absolute;text-align:center;top:70%;transform:translateY(-70%);width:100%}.a-orientation-modal button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;border:none;height:50px;text-indent:-9999px;width:50px}.a-loader-title{background-color:rgba(0,0,0,.6);font-family:sans-serif,monospace;text-align:center;font-size:20px;height:50px;font-weight:300;line-height:50px;position:absolute;right:0;left:0;top:0;color:#fff}.a-modal{background:0 0/50% 50% rgba(0,0,0,.6);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-dialog{position:relative;left:50%;top:50%;transform:translate(-50%,-50%);z-index:199995;width:300px;height:200px;background-size:contain;background-color:#fff;font-family:sans-serif,monospace;font-size:20px;border-radius:3px;padding:6px}.a-dialog-text-container{width:100%;height:70%;align-self:flex-start;display:flex;justify-content:center;align-content:center;flex-direction:column}.a-dialog-text{display:inline-block;font-weight:400;font-size:14pt;margin:8px}.a-dialog-buttons-container{display:inline-flex;align-self:flex-end;width:100%;height:30%}.a-dialog-button{cursor:pointer;align-self:center;opacity:.9;height:80%;width:50%;font-size:12pt;margin:4px;border-radius:2px;text-align:center;border:none;display:inline-block;-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.2);user-select:none}.a-dialog-permission-button:hover{box-shadow:0 7px 14px rgba(0,0,0,.2),0 2px 2px rgba(0,0,0,.2)}.a-dialog-allow-button{background-color:#00ceff}.a-dialog-deny-button{background-color:#ff005b}.a-dialog-ok-button{background-color:#00ceff;width:100%}";e("browserify-css").createStyle(n,{href:"src\\style\\aframe.css"}),t.exports=n},{"browserify-css":4}],165:[function(e,t,i){var n=".rs-base{background-color:#333;color:#fafafa;border-radius:0;font:10px monospace;left:5px;line-height:1em;opacity:.85;overflow:hidden;padding:10px;position:fixed;top:5px;width:300px;z-index:10000}.rs-base div.hidden{display:none}.rs-base h1{color:#fff;cursor:pointer;font-size:1.4em;font-weight:300;margin:0 0 5px;padding:0}.rs-group{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;margin-bottom:5px}.rs-group:last-child{margin-bottom:0}.rs-counter-base{align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:10px;-webkit-justify-content:space-between;justify-content:space-between;margin:2px 0}.rs-counter-base.alarm{color:#b70000;text-shadow:0 0 0 #b70000,0 0 1px #fff,0 0 1px #fff,0 0 2px #fff,0 0 2px #fff,0 0 3px #fff,0 0 3px #fff,0 0 4px #fff,0 0 4px #fff}.rs-counter-id{font-weight:300;-webkit-box-ordinal-group:0;-webkit-order:0;order:0;width:54px}.rs-counter-value{font-weight:300;-webkit-box-ordinal-group:1;-webkit-order:1;order:1;text-align:right;width:35px}.rs-canvas{-webkit-box-ordinal-group:2;-webkit-order:2;order:2}@media (min-width:480px){.rs-base{left:20px;top:20px}}";e("browserify-css").createStyle(n,{href:"src\\style\\rStats.css"}),t.exports=n},{"browserify-css":4}],166:[function(e,t,i){var n=e("../constants/"),r=e("../core/system").registerSystem,o="data-aframe-default-camera";t.exports.System=r("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var e,t,i=this.sceneEl,n=this;if(!i.camera||i.camera.el.getAttribute("camera").spectator)if((e=i.querySelectorAll("a-camera, [camera]")).length)for(this.numUserCameras=e.length,t=0;t<e.length;t++)e[t].addEventListener("object3dset",(function(e){"camera"===e.detail.type&&n.checkUserCamera(this)})),e[t].isNode?e[t].load():e[t].addEventListener("nodeready",(function(){this.load()}));else this.createDefaultCamera();else i.emit("cameraready",{cameraEl:i.camera.el})},checkUserCamera:function(e){var t,i=this.el.sceneEl;this.numUserCamerasChecked++,this.initialCameraFound||((t=e.getAttribute("camera")).active&&!t.spectator?(this.initialCameraFound=!0,i.camera=e.getObject3D("camera"),i.emit("cameraready",{cameraEl:e})):this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera())},createDefaultCamera:function(){var e,t=this.sceneEl;(e=document.createElement("a-entity")).setAttribute("camera",{active:!0}),e.setAttribute("position",{x:0,y:n.DEFAULT_CAMERA_HEIGHT,z:0}),e.setAttribute("wasd-controls",""),e.setAttribute("look-controls",""),e.setAttribute(n.AFRAME_INJECTED,""),e.addEventListener("object3dset",(function(i){"camera"===i.detail.type&&(t.camera=i.detail.object,t.emit("cameraready",{cameraEl:e}))})),t.appendChild(e)},disableActiveCamera:function(){var e;(e=this.sceneEl.querySelectorAll("[camera]"))[e.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(e){var t,i,n,r,a=this.activeCameraEl,s=this.sceneEl;if((r=e.getObject3D("camera"))&&e!==this.activeCameraEl){var l=s.querySelector("["+o+"]");for(e!==(l&&l.querySelector("[camera]"))&&function(e){var t;e.camera&&(t=e.querySelector("["+o+"]"))&&e.removeChild(t)}(s),this.activeCameraEl=e,this.activeCameraEl.play(),s.camera=r,a&&a.setAttribute("camera","active",!1),i=s.querySelectorAll("[camera]"),n=0;n<i.length;n++)(t=i[n]).isEntity&&e!==t&&(t.setAttribute("camera","active",!1),t.pause());s.emit("camera-set-active",{cameraEl:e})}},setSpectatorCamera:function(e){var t,i=this.spectatorCameraEl,n=this.sceneEl;e.getObject3D("camera")&&e!==this.spectatorCameraEl&&(i&&i.setAttribute("camera","spectator",!1),t=this.spectatorCameraEl=e,n.addEventListener("enter-vr",this.wrapRender),n.addEventListener("exit-vr",this.unwrapRender),t.setAttribute("camera","active",!1),t.play(),n.emit("camera-set-spectator",{cameraEl:e}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){this.spectatorCameraEl&&(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(e,t){var i,n,r=this.sceneEl;i=r.renderer.xr.enabled,this.originalRender.call(r.renderer,e,t),this.spectatorCameraEl&&!r.isMobile&&i&&(n=this.spectatorCameraEl.components.camera.camera,r.renderer.xr.enabled=!1,this.originalRender.call(r.renderer,e,n),r.renderer.xr.enabled=i)}})},{"../constants/":101,"../core/system":120}],167:[function(e,t,i){var n=e("../core/geometry").geometries,r=e("../core/system").registerSystem,o=e("../lib/three");function a(e){var t,i,r=e.primitive,a=n[r]&&n[r].Geometry,s=new a;if(!a)throw new Error("Unknown geometry `"+r+"`");return s.init(e),t=s.geometry,e.buffer?((i=(new o.BufferGeometry).fromGeometry(t)).metadata={type:t.type,parameters:t.parameters||{}},t.dispose(),i):t}t.exports.System=r("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(e){var t,i,n=this.cache;return e.skipCache?a(e):(t=n[i=this.hash(e)],function(e,t){e[t]=void 0===e[t]?1:e[t]+1}(this.cacheCount,i),t||(t=a(e),n[i]=t,t))},unuseGeometry:function(e){var t,i=this.cache,n=this.cacheCount;e.skipCache||i[t=this.hash(e)]&&(function(e,t){e[t]--}(n,t),n[t]>0||(i[t].dispose(),delete i[t],delete n[t]))},hash:function(e){return JSON.stringify(e)}})},{"../core/geometry":110,"../core/system":120,"../lib/three":157}],168:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../lib/three");t.exports.System=n("gltf-model",{schema:{dracoDecoderPath:{default:""}},init:function(){var e=this.data.dracoDecoderPath;this.dracoLoader=new r.DRACOLoader,this.dracoLoader.setDecoderPath(e)},update:function(){var e;this.dracoLoader||(e=this.data.dracoDecoderPath,this.dracoLoader=new r.DRACOLoader,this.dracoLoader.setDecoderPath(e))},getDRACOLoader:function(){return this.dracoLoader}})},{"../core/system":120,"../lib/three":157}],169:[function(e,t,i){e("./camera"),e("./geometry"),e("./gltf-model"),e("./light"),e("./material"),e("./renderer"),e("./shadow"),e("./tracked-controls-webvr"),e("./tracked-controls-webxr")},{"./camera":166,"./geometry":167,"./gltf-model":168,"./light":170,"./material":171,"./renderer":172,"./shadow":173,"./tracked-controls-webvr":174,"./tracked-controls-webxr":175}],170:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../utils/bind"),o=e("../constants/"),a="data-aframe-default-light";t.exports.System=n("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",r(this.setupDefaultLights,this))},registerLight:function(e){e.hasAttribute(a)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var e,t=this.sceneEl;if(this.defaultLights){e=document.querySelectorAll("["+a+"]");for(var i=0;i<e.length;i++)t.removeChild(e[i]);this.defaultLights=!1}},setupDefaultLights:function(){var e,t,i=this.sceneEl;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||((e=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),e.setAttribute(a,""),e.setAttribute(o.AFRAME_INJECTED,""),i.appendChild(e),(t=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),t.setAttribute("position",{x:-.5,y:1,z:1}),t.setAttribute(a,""),t.setAttribute(o.AFRAME_INJECTED,""),i.appendChild(t),this.defaultLights=!0)}})},{"../constants/":101,"../core/system":120,"../utils/bind":176}],171:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../lib/three"),o=e("../utils/"),a=e("../utils/material").isHLS,s=o.bind,l=o.debug,c=l("components:texture:error"),h=new r.TextureLoader,u=l("components:texture:warn");function d(e,t){var i=t.offset||{x:0,y:0},n=t.repeat||{x:1,y:1};!!t.npot&&(e.wrapS=r.ClampToEdgeWrapping,e.wrapT=r.ClampToEdgeWrapping,e.magFilter=r.LinearFilter,e.minFilter=r.LinearFilter),1===n.x&&1===n.y||(e.wrapS=r.RepeatWrapping,e.wrapT=r.RepeatWrapping,e.repeat.set(n.x,n.y)),0===i.x&&0===i.y||e.offset.set(i.x,i.y)}h.setCrossOrigin("anonymous"),t.exports.System=n("material",{init:function(){this.materials={},this.textureCounts={},this.textureCache={},this.sceneEl.addEventListener("materialtextureloaded",s(this.onMaterialTextureLoaded,this))},clearTextureCache:function(){this.textureCache={}},loadTexture:function(e,t,i){var n=this;if("CANVAS"!==e.tagName){if("VIDEO"===e.tagName)return e.src||e.srcObject||e.childElementCount||u("Video element was defined with neither `source` elements nor `src` / `srcObject` attributes."),void this.loadVideo(e,t,i);o.srcLoader.validateSrc(e,(function(e){n.loadImage(e,t,i)}),(function(e){n.loadVideo(e,t,i)}))}else this.loadCanvas(e,t,i)},loadImage:function(e,t,i){var n=this.hash(t),o=this.textureCache;o[n]||(o[n]=function(e,t){return new Promise((function(i,n){function o(e){d(e,t),e.needsUpdate=!0,i(e)}"string"!=typeof e?o(new r.Texture(e)):h.load(e,o,(function(){}),(function(e){c("`$s` could not be fetched (Error code: %s; Response: %s)",e.status,e.statusText)}))}))}(e,t)),o[n].then(i)},loadCanvas:function(e,t,i){var n;d(n=new r.CanvasTexture(e),t),i(n)},loadVideo:function(e,t,i){var n,o,s,l,c=this.textureCache;function h(e){e.texture.needsUpdate=!0,i(e.texture,e.videoEl)}if("string"!=typeof e){if(s=e,c[n=this.hashVideo(t,s)])return void c[n].then(h);!function(e){e.autoplay=e.hasAttribute("autoplay")&&"false"!==e.getAttribute("autoplay"),e.controls=e.hasAttribute("controls")&&"false"!==e.getAttribute("controls"),"false"===e.getAttribute("loop")&&e.removeAttribute("loop"),"false"===e.getAttribute("preload")&&(e.preload="none"),e.crossOrigin=e.crossOrigin||"anonymous",e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline","")}(s)}s=s||function(e,t,i){var n=document.createElement("video");return n.width=t,n.height=i,n.setAttribute("playsinline",""),n.setAttribute("webkit-playsinline",""),n.autoplay=!0,n.loop=!0,n.crossOrigin="anonymous",n.addEventListener("error",(function(){u("`$s` is not a valid video",e)}),!0),n.src=e,n}(e,t.width,t.height),c[n=this.hashVideo(t,s)]?c[n].then(h):((o=new r.VideoTexture(s)).minFilter=r.LinearFilter,d(o,t),this.sceneEl.isIOS&&a(s.src||s.getAttribute("src"),s.type||s.getAttribute("type"))&&(o.format=r.RGBAFormat,o.needsCorrectionBGRA=!0,o.flipY=!1,o.needsCorrectionFlipY=!0),l={texture:o,videoEl:s},c[n]=Promise.resolve(l),h(l))},hash:function(e){return e.src.tagName&&((e=o.extendDeep({},e)).src=e.src.src),JSON.stringify(e)},hashVideo:function(e,t){return function(e,t){var i,n,r,o=t.getAttribute("id");if(o)return o;for(n="",r=e||{},i=0;i<t.attributes.length;i++)r[t.attributes[i].name]=t.attributes[i].value;return Object.keys(r).sort().forEach((function(e){n+=e+":"+r[e]+";"})),n}(e,t)},registerMaterial:function(e){this.materials[e.uuid]=e},unregisterMaterial:function(e){delete this.materials[e.uuid];var t=this.textureCounts;Object.keys(e).filter((function(t){return e[t]&&e[t].isTexture})).forEach((function(i){t[e[i].uuid]--,t[e[i].uuid]<=0&&e[i].dispose()}))},updateMaterials:function(e){var t=this.materials;Object.keys(t).forEach((function(e){t[e].needsUpdate=!0}))},onMaterialTextureLoaded:function(e){this.textureCounts[e.detail.texture.uuid]||(this.textureCounts[e.detail.texture.uuid]=0),this.textureCounts[e.detail.texture.uuid]++}})},{"../core/system":120,"../lib/three":157,"../utils/":182,"../utils/material":185}],172:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../utils/"),o=e("../lib/three"),a=(0,r.debug)("components:renderer:warn");t.exports.System=n("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:r.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:1920},maxCanvasHeight:{default:1920},physicallyCorrectLights:{default:!1},precision:{default:"high",oneOf:["high","medium","low"]},sortObjects:{default:!1},colorManagement:{default:!1},gammaOutput:{default:!1},alpha:{default:!0},foveationLevel:{default:0}},init:function(){var e=this.data,t=this.el,i=t.renderer;i.sortObjects=e.sortObjects,i.physicallyCorrectLights=e.physicallyCorrectLights,(e.colorManagement||e.gammaOutput)&&(i.gammaOutput=!0,i.gammaFactor=2.2,e.gammaOutput&&a('Property `gammaOutput` is deprecated. Use `renderer="colorManagement: true;"` instead.')),t.hasAttribute("antialias")&&a('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),t.hasAttribute("logarithmicDepthBuffer")&&a('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.')},applyColorCorrection:function(e){this.data.colorManagement&&e&&(e.isColor?e.convertSRGBToLinear():e.isTexture&&(e.encoding=o.sRGBEncoding))}})},{"../core/system":120,"../lib/three":157,"../utils/":182}],173:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../lib/three"),o={basic:r.BasicShadowMap,pcf:r.PCFShadowMap,pcfsoft:r.PCFSoftShadowMap};t.exports.System=n("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var e=this.sceneEl,t=this.data;this.shadowMapEnabled=!1,e.renderer&&(e.renderer.shadowMap.type=o[t.type],e.renderer.shadowMap.autoUpdate=t.autoUpdate,this.setShadowMapEnabled(this.shadowMapEnabled))},update:function(e){e.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.data.enabled)},setShadowMapEnabled:function(e){var t=this.sceneEl.renderer;this.shadowMapEnabled=this.data.enabled&&e,t&&(t.shadowMap.enabled=this.shadowMapEnabled)}})},{"../core/system":120,"../lib/three":157}],174:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../utils"),o=r.device.isWebXRAvailable;t.exports.System=n("tracked-controls-webvr",{init:function(){var e=this;this.controllers=[],this.isChrome=-1!==navigator.userAgent.indexOf("Chrome"),this.updateControllerList(),this.throttledUpdateControllerList=r.throttle(this.updateControllerList,500,this),o||navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",(function(){navigator.getVRDisplays().then((function(t){t.length&&(e.vrDisplay=t[0])}))}))},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var e,t,i,n,r=this.controllers;if(t=navigator.getGamepads&&navigator.getGamepads()){for(n=r.length,r.length=0,i=0;i<t.length;++i)(e=t[i])&&e.pose&&r.push(e);r.length!==n&&this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":120,"../utils":182}],175:[function(e,t,i){var n=e("../core/system").registerSystem,r=e("../utils");t.exports.System=n("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=r.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var e=this,t=this.el.xrSession;if(!t)return this.referenceSpace=void 0,this.controllers=[],void(this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1)));t.requestReferenceSpace("local-floor").then((function(t){e.referenceSpace=t}))},updateControllerList:function(){var e=this.el.xrSession;if(!e){if(0===this.oldControllersLength)return;return this.oldControllersLength=0,this.controllers=[],void this.el.emit("controllersupdated",void 0,!1)}this.controllers=e.inputSources,this.oldControllersLength!==this.controllers.length&&(this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1))}})},{"../core/system":120,"../utils":182}],176:[function(e,t,i){t.exports=function(e,t){return i=Array.prototype.slice.call(arguments,2),function(){var n=i.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,n)};var i}},{}],177:[function(e,t,i){var n=e("./debug"),r=e("object-assign"),o=n("utils:coordinates:warn"),a=["x","y","z","w"],s=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;t.exports.regex=s;var l="object",c=/\s+/g;function h(e){return s.test(e)}function u(e){return null!=e&&e.constructor===String?parseFloat(e,10):e}t.exports.parse=function(e,t){var i,n,o,s,h,d,p,f,m;if(e&&e instanceof Object)return d=void 0===e.x?t&&t.x:e.x,p=void 0===e.y?t&&t.y:e.y,f=void 0===e.z?t&&t.z:e.z,m=void 0===e.w?t&&t.w:e.w,null!=d&&(e.x=u(d)),null!=p&&(e.y=u(p)),null!=f&&(e.z=u(f)),null!=m&&(e.w=u(m)),e;if(null==e)return typeof t===l?r({},t):t;for(i=e.trim().split(c),h={},s=0;s<a.length;s++)if(o=a[s],i[s])h[o]=parseFloat(i[s],10);else{if(void 0===(n=t&&t[o]))continue;h[o]=u(n)}return h},t.exports.stringify=function(e){var t;return typeof e!==l?e:(t=e.x+" "+e.y,null!=e.z&&(t+=" "+e.z),null!=e.w&&(t+=" "+e.w),t)},t.exports.isCoordinates=h,t.exports.isCoordinate=function(e){return o("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),h(e)},t.exports.toVector3=function(e){return new THREE.Vector3(e.x,e.y,e.z)}},{"./debug":178,"object-assign":27}],178:[function(e,t,i){(function(i){var n=e("debug"),r=e("object-assign"),o={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},a=function(e){var t=n(e);return t.color=function(e){var t=function(e){var t=e.split(":");return t[t.length-1]}(e);return o.colors&&o.colors[t]||null}(e),t};r(a,n);var s=function(){try{return window.localStorage}catch(e){}}();s&&(parseInt(s.logs,10)||"true"===s.logs)?a.enable("*"):a.enable("*:error,*:info,*:warn"),i.browser&&(window.logs=a),t.exports=a}).call(this,e("_process"))},{_process:5,debug:10,"object-assign":27}],179:[function(e,t,i){(function(i){var n,r=e("debug")("device:error"),o=!1,a=!1,s=t.exports.isWebXRAvailable=!window.debug&&void 0!==navigator.xr;if(window.addEventListener("vrdisplayactivate",(function(e){var t;s||(t=document.createElement("canvas"),n=e.display,t.getContext("webgl",{}),n.requestPresent([{source:t}]).then((function(){}),(function(){})))})),s){var l=function(){var e=document.querySelector("a-scene");e?e.hasLoaded?e.components["vr-mode-ui"].updateEnterInterfaces():e.addEventListener("loaded",l):window.addEventListener("DOMContentLoaded",l)},c=function(e){r("WebXR session support error: "+e.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then((function(e){o=e,l()})).catch(c),navigator.xr.isSessionSupported("immersive-ar").then((function(e){a=e,l()})).catch((function(){}))):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then((function(){o=!0,l()})).catch(c),navigator.xr.supportsSession("immersive-ar").then((function(){a=!0,l()})).catch((function(){}))):r("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then((function(e){var t=document.querySelector("a-scene");n=e.length&&e[0],t&&t.emit("displayconnected",{vrDisplay:n})}));function h(){return n}t.exports.getVRDisplay=h,t.exports.checkHeadsetConnected=function(){return o||a||!!h()},t.exports.checkARSupport=function(){return a};var u,d,p=(d=!1,u=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,4)))&&(d=!0),(m()||f()||b())&&(d=!0),navigator.maxTouchPoints>1&&(d=!0),y()&&(d=!1),function(){return d});function f(e){var t=e||window.navigator.userAgent;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(t)}function m(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function v(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function g(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function y(){return v()||g()}function b(){return/R7 Build/.test(window.navigator.userAgent)}t.exports.isMobile=p,t.exports.isTablet=f,t.exports.isIOS=m,t.exports.isMobileDeviceRequestingDesktopSite=function(){return!p()&&!y()&&void 0!==window.orientation},t.exports.isOculusBrowser=v,t.exports.isFirefoxReality=g,t.exports.isMobileVR=y,t.exports.isR7=b,t.exports.isLandscape=function(){var e=window.orientation;return b()&&(e+=90),90===e||-90===e},t.exports.isBrowserEnvironment=!(i&&!i.browser),t.exports.isNodeEnvironment=!t.exports.isBrowserEnvironment}).call(this,e("_process"))},{_process:5,debug:10}],180:[function(e,t,i){var n={};function r(e,t){return n[t=t||"."]||(n[t]={}),-1!==e.indexOf(t)?n[t][e]=e.split(t):n[t][e]=e,n[t][e]}t.exports.getComponentPropertyPath=r,t.exports.propertyPathCache=n,t.exports.getComponentProperty=function(e,t,i){var n;return i=i||".",-1!==t.indexOf(i)?(n=r(t,i)).constructor===String?e.getAttribute(n):e.getAttribute(n[0])[n[1]]:e.getAttribute(t)},t.exports.setComponentProperty=function(e,t,i,n){var o;n=n||".",-1===t.indexOf(n)?e.setAttribute(t,i):(o=r(t,n)).constructor===String?e.setAttribute(o,i):e.setAttribute(o[0],o[1],i)}},{}],181:[function(e,t,i){t.exports=function(e){var t=e.style.width,i=e.style.height;e.style.width=parseInt(t,10)+1+"px",e.style.height=parseInt(i,10)+1+"px",setTimeout((function(){e.style.width=t,e.style.height=i}),200)}},{}],182:[function(e,t,i){var n=e("./debug"),r=e("deep-assign"),o=e("./device"),a=e("object-assign"),s=e("./object-pool"),l=n("utils:warn");t.exports.bind=e("./bind"),t.exports.coordinates=e("./coordinates"),t.exports.debug=n,t.exports.device=o,t.exports.entity=e("./entity"),t.exports.forceCanvasResizeSafariMobile=e("./forceCanvasResizeSafariMobile"),t.exports.isIE11=e("./is-ie11"),t.exports.material=e("./material"),t.exports.objectPool=s,t.exports.split=e("./split").split,t.exports.styleParser=e("./styleParser"),t.exports.trackedControls=e("./tracked-controls"),t.exports.checkHeadsetConnected=function(){return l("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),o.checkHeadsetConnected(arguments)},t.exports.isGearVR=t.exports.device.isGearVR=function(){l("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},t.exports.isIOS=function(){return l("`utils.isIOS` has moved to `utils.device.isIOS`"),o.isIOS(arguments)},t.exports.isOculusGo=t.exports.device.isOculusGo=function(){l("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},t.exports.isMobile=function(){return l("`utils.isMobile has moved to `utils.device.isMobile`"),o.isMobile(arguments)},t.exports.throttle=function(e,i,n){var r;return n&&(e=t.exports.bind(e,n)),function(){var t=Date.now();(void 0===r||(void 0===r?i:t-r)>=i)&&(r=t,e.apply(null,arguments))}},t.exports.throttleTick=function(e,i,n){var r;return n&&(e=t.exports.bind(e,n)),function(t,n){var o=void 0===r?n:t-r;(void 0===r||o>=i)&&(r=t,e(t,o))}},t.exports.debounce=function(e,t,i){var n;return function(){var r=this,o=arguments,a=i&&!n;clearTimeout(n),n=setTimeout((function(){n=null,i||e.apply(r,o)}),t),a&&e.apply(r,o)}},t.exports.extend=a,t.exports.extendDeep=r,t.exports.clone=function(e){return JSON.parse(JSON.stringify(e))};var c,h,u=(c=s.createPool((function(){return[]})),function(e,t){var i,n,r,o,a,s;if(void 0===e||void 0===t||null===e||null===t||!(e&&t&&e.constructor===Object&&t.constructor===Object||e.constructor===Array&&t.constructor===Array))return e===t;for(i in n=c.use(),r=c.use(),n.length=0,r.length=0,e)n.push(i);for(i in t)r.push(i);if(n.length!==r.length)return c.recycle(n),c.recycle(r),!1;for(o=0;o<n.length;++o)if(a=e[n[o]],s=t[n[o]],"object"==typeof a||"object"==typeof s||Array.isArray(a)&&Array.isArray(s)){if(a===s)continue;if(!u(a,s))return c.recycle(n),c.recycle(r),!1}else if(a!==s)return c.recycle(n),c.recycle(r),!1;return c.recycle(n),c.recycle(r),!0});t.exports.deepEqual=u,t.exports.diff=(h=[],function(e,t,i){var n,r,o,a,s,l,c;for(s in a=i||{},h.length=0,e)h.push(s);if(!t)return a;for(o in t)-1===h.indexOf(o)&&h.push(o);for(l=0;l<h.length;l++)n=e[s=h[l]],r=t[s],((c=n&&r&&n.constructor===Object&&r.constructor===Object)&&!u(n,r)||!c&&n!==r)&&(a[s]=r);return a}),t.exports.shouldCaptureKeyEvent=function(e){return!e.metaKey&&document.activeElement===document.body},t.exports.splitString=function(e,t){void 0===t&&(t=" ");var i=new RegExp(t,"g");return(e=(e||"").replace(i,t)).split(t)},t.exports.getElData=function(e,t){t=t||{};var i={};return Object.keys(t).forEach((function(t){e.hasAttribute(t)&&(i[t]=e.getAttribute(t))})),i},t.exports.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},t.exports.isIframed=function(){return window.top!==window.self},t.exports.findAllScenes=function(e){for(var t=[],i=e.getElementsByTagName("*"),n=0,r=i.length;n<r;n++)i[n].isScene&&t.push(i[n]);return t},t.exports.srcLoader=e("./src-loader")},{"./bind":176,"./coordinates":177,"./debug":178,"./device":179,"./entity":180,"./forceCanvasResizeSafariMobile":181,"./is-ie11":183,"./material":185,"./object-pool":186,"./split":187,"./src-loader":188,"./styleParser":189,"./tracked-controls":190,"deep-assign":12,"object-assign":27}],183:[function(e,t,i){var n,r;t.exports=11===(n=-1,r=navigator.userAgent,"Microsoft Internet Explorer"===navigator.appName?null!=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})").exec(r)&&(n=parseFloat(RegExp.$1)):"Netscape"===navigator.appName&&null!=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})").exec(r)&&(n=parseFloat(RegExp.$1)),n)},{}],184:[function(e,t,i){t.exports=function(e){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(e)}},{}],185:[function(e,t,i){var n=e("../lib/three"),r=["application/x-mpegurl","application/vnd.apple.mpegurl"],o=new Set(["emissiveMap","envMap","map","specularMap"]);function a(e,t){t&&(e.emit("materialtextureloaded",{src:t.image,texture:t}),t.image&&"VIDEO"===t.image.tagName&&(t.image.addEventListener("loadeddata",(function(){e.components&&e.components.material&&(t.needsCorrectionBGRA&&t.needsCorrectionFlipY&&-1!==["standard","flat"].indexOf(e.components.material.data.shader)&&e.setAttribute("material","shader","ios10hls"),e.emit("materialvideoloadeddata",{src:t.image,texture:t}))})),t.image.addEventListener("ended",(function(){e.emit("materialvideoended",{src:t.image,texture:t})}))))}t.exports.updateMapMaterialFromData=function(e,t,i,r){var s=i.el,l=i.material,c=s.sceneEl.systems.renderer,h=r[t];if(i.materialSrcs||(i.materialSrcs={}),!h)return delete i.materialSrcs[e],void u(null);function u(t){l[e]=t,t&&o.has(e)&&c.applyColorCorrection(t),l.needsUpdate=!0,a(s,t)}h!==i.materialSrcs[e]&&(i.materialSrcs[e]=h,h instanceof n.Texture?u(h):s.sceneEl.systems.material.loadTexture(h,{src:h,repeat:r.repeat,offset:r.offset,npot:r.npot},(function(t){i.materialSrcs[e]===h&&u(t)})))},t.exports.updateMap=function(e,i){return t.exports.updateMapMaterialFromData("map","src",e,i)},t.exports.updateDistortionMap=function(e,t,i){var n=e;"ambientOcclusion"===e&&(n="ao");var r=t.el,s=t.material,l=r.sceneEl.systems.renderer,c=i[e+"Map"],h={};if(h.src=c,h.offset=i[e+"TextureOffset"],h.repeat=i[e+"TextureRepeat"],h.wrap=i[e+"TextureWrap"],c){if(c===t[e+"TextureSrc"])return;return t[e+"TextureSrc"]=c,void r.sceneEl.systems.material.loadTexture(c,h,u)}function u(e){var t=n+"Map";s[t]=e,e&&o.has(t)&&l.applyColorCorrection(e),s.needsUpdate=!0,a(r,e)}s.map&&u(null)},t.exports.handleTextureEvents=a,t.exports.isHLS=function(e,t){return!(!t||!r.includes(t.toLowerCase()))||!!(e&&e.toLowerCase().indexOf(".m3u8")>0)}},{"../lib/three":157}],186:[function(e,t,i){var n=Object.freeze(Object.create(null));function r(){return{}}function o(e){var t;if(e&&e.constructor===Object)for(t in e)e[t]=void 0}t.exports.createPool=function(e){var t=[],i=null;function a(n){var r,o;if((n=void 0===n?t.length:n)>0&&null==i&&(i=0),n>0)for(r=t.length,t.length+=Number(n),o=r;o<t.length;o++)t[o]=e();return t.length}return e=e||r,{grow:a,pool:t,recycle:function(e){e instanceof Object&&(null!==i&&-1!==i?t[--i]=e:t[t.length]=e)},size:function(){return t.length},use:function(){var e;return null!==i&&i!==t.length||a(t.length||5),e=t[i],t[i++]=n,o(e),e}}},t.exports.clearObject=o,t.exports.removeUnusedKeys=function(e,t){var i;if(e&&e.constructor===Object)for(i in e)i in t||delete e[i]}},{}],187:[function(e,t,i){var n;t.exports.split=(n={},function(e,t){return t in n||(n[t]={}),e in n[t]||(n[t][e]=e.split(t)),n[t][e]})},{}],188:[function(e,t,i){var n=e("./debug")("utils:src-loader:warn");function r(e,t,i){!function(e,t){var i;e.tagName?t("IMG"===e.tagName):((i=new XMLHttpRequest).open("HEAD",e),i.addEventListener("load",(function(n){var r;i.status>=200&&i.status<300?null==(r=i.getResponseHeader("Content-Type"))?a(e,t):r.startsWith("image")?t(!0):t(!1):a(e,t),i.abort()})),i.send())}(e,(function(n){n?t(e):i(e)}))}function o(e){var t=e.match(/\url\((.+)\)/);if(t)return t[1]}function a(e,t){var i=new Image;i.addEventListener("load",(function(){t(!0)})),i.addEventListener("error",(function(){t(!1)})),i.src=e}t.exports={parseUrl:o,validateSrc:r,validateCubemapSrc:function(e,t){var i,a,s,l="",c=[];for(a=0;a<5;a++)l+="(url\\((?:[^\\)]+)\\),\\s*)";function h(e){c.push(e),6===c.length&&t(c)}if(l+="(url\\((?:[^\\)]+)\\)\\s*)",s=e.match(new RegExp(l)))for(a=1;a<7;a++)r(o(s[a]),h);else if(i=function(e){try{var t=document.querySelector(e);return t||n('No element was found matching the selector: "%s"',e),t}catch(t){return void n('"%s" is not a valid selector',e)}}(e))return"A-CUBEMAP"===i.tagName&&i.srcs?t(i.srcs):void n('Selector "%s" does not point to <a-cubemap>',e)}}},{"./debug":178}],189:[function(e,t,i){var n=/-([a-z])/g;function r(e){return e.replace(n,c)}function o(e){var t,i;for(i in e)i!==(t=r(i))&&(e[t]=e[i],delete e[i]);return e}t.exports.parse=function(e,t){var i;return"string"!=typeof e||(i=function(e,t){var i,n,r,o,a,s;for(t=t||{},i=l(e),n=0;n<i.length;n++)(r=i[n])&&(o=r.indexOf(":"),a=r.substr(0,o).trim(),s=r.substr(o+1).trim(),t[a]=s);return t}(e,t))[""]?e:o(i)},t.exports.stringify=function(e){return"string"==typeof e?e:function(e){var t,i=0,n=0,r="";for(t in e)i++;for(t in e)r+=t+": "+e[t],n<i-1&&(r+="; "),n++;return r}(e)},t.exports.toCamelCase=r,t.exports.transformKeysToCamelCase=o;var a,s,l=(a=[],s=/url\([^)]+$/,function(e){var t,i="",n=0;for(a.length=0;n<e.length;)-1===(t=e.indexOf(";",n))&&(t=e.length),i+=e.substring(n,t),s.test(i)?(i+=";",n=t+1):(a.push(i.trim()),i="",n=t+1);return a});function c(e){return e[1].toUpperCase()}},{}],190:[function(e,t,i){var n=e("../constants").DEFAULT_HANDEDNESS,r=["x","y","z","w"],o=2;function a(e,t,i){var n,r,o=e.el.sceneEl,a=i.index||0;return!!(t&&(r=o&&o.systems["tracked-controls-webvr"])&&(n=r.controllers).length&&l(n,null,t,i.hand,a))}function s(e,t,i){var n,r=e.el.sceneEl,o=r&&r.systems["tracked-controls-webxr"];return!!o&&!(!(n=o.controllers)||!n.length)&&c(n,t,i.hand,i.index,i.iterateControllerProfiles)}function l(e,t,i,r,a){var s,l,c=0;for(l=0;l<e.length;l++)if(s=e[l],(!i||s.id.startsWith(i))&&(i||s.id===t)&&(!r||!s.hand||r===s.hand)){if(!r||s.hand)return s;if(c===o*a+(r===n?0:1))return s;++c}}function c(e,t,i,n,r){var o,a,s,l,c=!1;for(o=0;o<e.length;o++){if(0===(l=(s=e[o]).profiles).length)return;if(r)for(a=0;a<l.length&&!(c=l[a].startsWith(t));a++);else c=l[0].startsWith(t);if(c)if("right"===s.handedness||"left"===s.handedness){if(s.handedness===i)return e[o]}else if(o===n)return e[o]}}t.exports.checkControllerPresentAndSetup=function(e,t,i){var n,r=e.el,o=r.sceneEl.hasWebXR;if(n=!!(o?s:a)(e,t,i),!e.controllerPresent||e.controllerEventsActive||o||e.addEventListeners(),n===e.controllerPresent)return n;e.controllerPresent=n,n?(e.injectTrackedControls(),e.addEventListeners(),r.emit("controllerconnected",{name:e.name,component:e})):(e.removeEventListeners(),r.emit("controllerdisconnected",{name:e.name,component:e}))},t.exports.isControllerPresentWebVR=a,t.exports.isControllerPresentWebXR=s,t.exports.findMatchingControllerWebVR=l,t.exports.findMatchingControllerWebXR=c,t.exports.emitIfAxesChanged=function(e,t,i){var n,o,a,s,l;for(o in t){for(n=t[o],a=!1,l=0;l<n.length;l++)i.detail.changed[n[l]]&&(a=!0);if(a){for(s={},l=0;l<n.length;l++)s[r[l]]=i.detail.axis[n[l]];e.el.emit(o+"moved",s)}}},t.exports.onButtonEvent=function(e,t,i,n){var r=(n?i.mapping[n]:i.mapping).buttons[e];i.el.emit(r+t),i.updateModel&&i.updateModel(r,t)}},{"../constants":101}],191:[function(e,t,i){THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,n,r,o,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},l=(i=new THREE.Vector3(0,0,1),n=new THREE.Euler,r=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,l){n.set(a,t,-s,"YXZ"),e.setFromEuler(n),e.multiply(o),e.multiply(r.setFromAxisAngle(i,-l))});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,n=e.beta?THREE.Math.degToRad(e.beta):0,r=e.gamma?THREE.Math.degToRad(e.gamma):0,o=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;l(t.object.quaternion,i,n,r,o)}}},this.dispose=function(){t.disconnect()},this.connect()}},{}],192:[function(e,t,i){window.glStats=function(){var e=null,t=0,i=0,n=0,r=0,o=0,a=0,s=0;function l(e,t){return function(){t.apply(this,arguments),e.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=l(WebGLRenderingContext.prototype.drawArrays,(function(){t++,arguments[0]==this.POINTS?a+=arguments[2]:o+=arguments[2]})),WebGLRenderingContext.prototype.drawElements=l(WebGLRenderingContext.prototype.drawElements,(function(){i++,r+=arguments[1]/3,o+=arguments[1]})),WebGLRenderingContext.prototype.useProgram=l(WebGLRenderingContext.prototype.useProgram,(function(){n++})),WebGLRenderingContext.prototype.bindTexture=l(WebGLRenderingContext.prototype.bindTexture,(function(){s++})),{update:function(){e("allcalls").set(t+i),e("drawElements").set(i),e("drawArrays").set(t),e("bindTexture").set(s),e("useProgram").set(n),e("glfaces").set(r),e("glvertices").set(o),e("glpoints").set(a)},start:function(){t=0,i=0,n=0,r=0,o=0,a=0,s=0},end:function(){},attach:function(t){e=t},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(e){var t=null;return{update:function(){t("renderer.info.memory.geometries").set(e.info.memory.geometries),t("renderer.info.programs").set(e.info.programs.length),t("renderer.info.memory.textures").set(e.info.memory.textures),t("renderer.info.render.calls").set(e.info.render.calls),t("renderer.info.render.triangles").set(e.info.render.triangles),t("renderer.info.render.points").set(e.info.render.points)},start:function(){},end:function(){},attach:function(e){t=e},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var e=null,t=0,i=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var n=Math.log(1024);function r(e){var t=Math.floor(Math.log(e)/n);return Math.round(100*e/Math.pow(1024,t))/100}return{update:function(){t=r(performance.memory.usedJSHeapSize),i=r(performance.memory.totalJSHeapSize),e("memory").set(t),e("total").set(i)},start:function(){t=0},end:function(){},attach:function(t){e=t},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},"object"==typeof t&&(t.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats})},{}],193:[function(e,t,i){"use strict";!function(){"performance"in window==0&&(window.performance={});var e=window.performance;if("now"in e==0){var t=Date.now();e.timing&&e.timing.navigationStart&&(t=e.timing.navigationStart),e.now=function(){return Date.now()-t}}e.mark||(e.mark=function(){}),e.measure||(e.measure=function(){})}(),window.rStats=function(e){function t(e,t){for(var i=Object.keys(e),n=0,r=i.length;n<r;n++)t(i[n])}var i=e||{},n=i.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],r=(i.CSSPath?i.CSSPath:"")+"rStats.css";(i.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",r]).forEach((function(e){var t,i;t=e,(i=document.createElement("link")).href=t,i.rel="stylesheet",i.type="text/css",document.getElementsByTagName("head")[0].appendChild(i)})),i.values||(i.values={});var o,a,s=10,l=200,c={};function h(e,t,i){var n=i||{},r=document.createElement("canvas"),o=r.getContext("2d"),a=0,c=0,h=n.color?n.color:"#666666",u=document.createElement("canvas"),d=u.getContext("2d");u.width=1,u.height=2*s,d.fillStyle="#444444",d.fillRect(0,0,1,2*s),d.fillStyle=h,d.fillRect(0,s,1,s),d.fillStyle="#ffffff",d.globalAlpha=.5,d.fillRect(0,s,1,1),d.globalAlpha=1;var p=document.createElement("canvas"),f=p.getContext("2d");return p.width=1,p.height=2*s,f.fillStyle="#444444",f.fillRect(0,0,1,2*s),f.fillStyle="#b70000",f.fillRect(0,s,1,s),f.globalAlpha=.5,f.fillStyle="#ffffff",f.fillRect(0,s,1,1),f.globalAlpha=1,r.width=l,r.height=s,r.style.width=r.width+"px",r.style.height=r.height+"px",r.className="rs-canvas",e.appendChild(r),o.fillStyle="#444444",o.fillRect(0,0,r.width,r.height),{draw:function(e,t){(c+=.1*(e-c))>(a*=.99)&&(a=c),o.drawImage(r,1,0,r.width-1,r.height,0,0,r.width-1,r.height),t?o.drawImage(p,r.width-1,r.height-c*r.height/a-s):o.drawImage(u,r.width-1,r.height-c*r.height/a-s)}}}function u(e,i){var r=document.createElement("canvas"),o=r.getContext("2d");return r.width=l,r.height=s*i,r.style.width=r.width+"px",r.style.height=r.height+"px",r.className="rs-canvas",e.appendChild(r),o.fillStyle="#444444",o.fillRect(0,0,r.width,r.height),{draw:function(e){o.drawImage(r,1,0,r.width-1,r.height,0,0,r.width-1,r.height);var i=0;t(e,(function(t){var a=e[t]*r.height;o.fillStyle=n[t],o.fillRect(r.width-1,i,1,a),i+=a}))}}}function d(e,t){var n,r=e,o=0,s=0,l=0,c=0,u=performance.now(),d=0,p=document.createElement("div"),f=document.createElement("span"),m=document.createElement("div"),v=document.createTextNode(""),g=i?i.values[r.toLowerCase()]:null,y=new h(p,r,g),b=!1;function A(e){if(g&&g.average){c+=e,d++;var t=performance.now();t-u>=(g.avgMs||1e3)&&(l=c/d,c=0,u=t,d=0)}}function w(){n=performance.now(),i.userTimingAPI&&performance.mark(r+"-start"),b=!0}function x(){o=performance.now()-n,i.userTimingAPI&&(performance.mark(r+"-end"),b&&performance.measure(r,r+"-start",r+"-end")),A(o)}return f.className="rs-counter-id",f.textContent=g&&g.caption?g.caption:r,m.className="rs-counter-value",m.appendChild(v),p.appendChild(f),p.appendChild(m),t?t.div.appendChild(p):a.appendChild(p),n=performance.now(),{set:function(e){A(o=e)},start:w,tick:function(){x(),w()},end:x,frame:function(){var e=performance.now(),t=e-n;s++,t>1e3&&(o=g&&!1===g.interpolate?s:1e3*s/t,s=0,n=e,A(o))},value:function(){return o},draw:function(){var e=g&&g.average?l:o;v.nodeValue=Math.round(100*e)/100;var t=g&&(g.below&&o<g.below||g.over&&o>g.over);y.draw(o,t),p.className=t?"rs-counter-base alarm":"rs-counter-base"}}}function p(e){var n=e.toLowerCase();if(void 0===n&&(n="default"),c[n])return c[n];var r=null;i&&i.groups&&t(i.groups,(function(e){var t=i.groups[parseInt(e,10)];r||-1===t.values.indexOf(n.toLowerCase())||(r=t)}));var o=new d(n,r);return c[n]=o,o}function f(){t(i.plugins,(function(e){i.plugins[e].update()})),t(c,(function(e){c[e].draw()})),i&&i.fractions&&t(i.fractions,(function(e){var n=i.fractions[parseInt(e,10)],r=[],o=c[n.base.toLowerCase()];o&&(o=o.value(),t(i.fractions[e].steps,(function(t){var n=i.fractions[e].steps[parseInt(t,10)].toLowerCase(),a=c[n];a&&r.push(a.value()/o)}))),n.graph.draw(r)}))}return function(){if(i.plugins){i.values||(i.values={}),i.groups||(i.groups=[]),i.fractions||(i.fractions=[]);for(var e=0;e<i.plugins.length;e++)i.plugins[e].attach(p),t(i.plugins[e].values,(function(t){i.values[t]=i.plugins[e].values[t]})),i.groups=i.groups.concat(i.plugins[e].groups),i.fractions=i.fractions.concat(i.plugins[e].fractions)}else i.plugins={};(o=document.createElement("div")).className="rs-base",(a=document.createElement("div")).className="rs-container",a.style.height="auto",o.appendChild(a),document.body.appendChild(o),i&&(i.groups&&t(i.groups,(function(e){var t=i.groups[parseInt(e,10)],n=document.createElement("div");n.className="rs-group",t.div=n;var r=document.createElement("h1");r.textContent=t.caption,r.addEventListener("click",function(e){this.classList.toggle("hidden"),e.preventDefault()}.bind(n)),a.appendChild(r),a.appendChild(n)})),i.fractions&&t(i.fractions,(function(e){var r=i.fractions[parseInt(e,10)],o=document.createElement("div");o.className="rs-fraction";var l=document.createElement("div");l.className="rs-legend";var c=0;t(i.fractions[e].steps,(function(t){var r=document.createElement("p");r.textContent=i.fractions[e].steps[t],r.style.color=n[c],l.appendChild(r),c++})),o.appendChild(l),o.style.height=c*s+"px",r.div=o;var h=new u(o,c);r.graph=h,a.appendChild(o)})))}(),function(e){return e?p(e):{element:o,update:f}}},"object"==typeof t&&(t.exports=window.rStats)},{}],194:[function(e,t,i){String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e})},{}],195:[function(e,t,i){var n={base64:function(e,t){return"data:"+e+";base64,"+t},isMobile:function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch(e){return!0}},appendQueryParameter:function(e,t,i){var n=e.indexOf("?")<0?"?":"&";return e+(n+t+"=")+i},getQueryParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},isLandscapeMode:function(){return 90==window.orientation||-90==window.orientation}};t.exports=n},{}],196:[function(e,t,i){var n,r=e("./util.js");function o(){var e=document.createElement("video");e.addEventListener("ended",(function(){e.play()})),this.request=function(){e.paused&&(e.src=r.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),e.play())},this.release=function(){e.pause(),e.src=""}}function a(){var e=null;this.request=function(){e||(e=setInterval((function(){window.location.href="/",setTimeout(window.stop,0)}),15e3))},this.release=function(){e&&(clearInterval(e),e=null)}}t.exports=(n=navigator.userAgent||navigator.vendor||window.opera).match(/iPhone/i)||n.match(/iPod/i)?a:o},{"./util.js":195}]},{},[155])(155)}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(143),n(858),n(986),n(989)})();

/***/ }),

/***/ "./lib/testWebpack/logic.min.js":
/*!**************************************!*\
  !*** ./lib/testWebpack/logic.min.js ***!
  \**************************************/
/***/ (() => {

window.Logic||(window.Logic=class{constructor(){this.xmlDoc=null,this.variableList=[],this.intersectObj=[],this.timelineDict={},this.intervalList=[],this.onclickObjectDict={},this.logicSystemState=-1}loadXMLtoDoc(e){let t=this;return new Promise((function(l){let a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(e){if(4===a.readyState)if(200===a.status){let e=(new DOMParser).parseFromString(a.responseText,"text/xml");t.xmlDoc=e,console.log("logicSystem.js: _loadXMLtoDoc: xmlDoc = ",t.xmlDoc),l(t)}else console.error(a.statusText),l("")},a.onerror=function(e){console.error(a.statusText),l("")},a.send(null)}))}parseXML(){let e=this;if(e.logicSystemState=1,"xml"==this.xmlDoc.children[0].tagName){let t=this.xmlDoc.children[0];if("variables"==t.children[0].tagName){let e=t.children[0];e.children.length>0&&this.registLogicVariables(e.children)}if(t.children.length>1)for(let e=1;e<t.children.length;e++)this.parseBlock(t.children[e]);e.logicSystemState=2}}stopLogic=function(){let e=this,t=Object.values(e.timelineDict);t.forEach((e=>{e.pause()})),t.forEach((e=>{e.kill()})),e.timelineDict={},Object.values(e.onclickObjectDict).forEach((e=>{e.forEach((e=>{e.length=0}))})),e.onclickObjectDict={},e.intervalList.forEach((e=>{clearInterval(e)})),e.intervalList.length=0,e.variableList.length=0,e.logicSystemState=0,console.log("logicSystem.js: _stopLogic: done")};registLogicVariables=function(e){for(let t=0;t<e.length;t++){let l=new Object;l.name=e[t].textContent,l.data=null,this.variableList.push(l)}console.log(this.variableList)};getContentByFieldName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].textContent;return null};getBlockByValueName=function(e,t){let l=e.children;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")==t)return l[e].children[0];return null};parseBlock=function(e,t=null){if(!e)return;let l;switch(e.getAttribute("type").split("_")[0]){case"transform":l=this.parse_transform_block(e,t);break;case"actions":l=this.parse_actions_block(e,t);break;case"controls":l=this.parse_controls_block(e,t);break;case"operators":l=this.parse_operators_block(e);break;case"data":l=this.parse_data_block(e,t);break;case"items":l=this.parse_items_block(e);break;case"events":l=this.parse_events_block(e,t);break;case"variables":l=this.parse_variables_block(e,t);break;case"debug":l=this.parse_debug_block(e,t)}return l};clear=function(){this.xmlDoc=null,this.variableList.length=0};checkObjectWorldVisible=function(e){let t=!0;if(0==e.object3D.visible)t=!1;else{let l=!0;e.object3D.traverseAncestors((function(a){"Scene"!=a.type?0==a.visible&&(l=!1):t=1==l&&1==e.object3D.visible}))}return t};checkObjectBehav=function(e){if(e.data&&"TEXT"==e.data.type){let t=e.data.value;if(Array.isArray(vrController.editor_version)&&vrController.editor_version[0]<=3&&vrController.editor_version[1]<=4){let e=vrController.VRSceneResult[vrController.projectIdx].scenes[vrController.sceneIndex].objs.find((e=>e.obj_id==t));if(e&&e.blockly)return!0}else{if("object"!=typeof vrController.editor_version||4!=Object.keys(vrController.editor_version).length)return!1;{let e=Number(vrController.editor_version.v0),l=Number(vrController.editor_version.v1);if(Number(vrController.editor_version.v2),e>3||3==e&&l>=5){let e=vrController.scenesData.scenes[vrController.currentSceneIndex].objs.find((e=>e.generalAttr.obj_id==t));if(e&&e.generalAttr.logic)return!0}}}return!1}return!0}}),Logic.prototype.parse_transform_block=function(e,t){let l=this,a=e.getAttribute("type"),n=new Object;switch(a){case"transform_move_in_second":n.tl=l.transform_move_in_second(e);break;case"transform_move_target_in_second":n.tl=l.transform_move_target_in_second(e);break;case"transform_rotate_in_second":n.tl=l.transform_rotate_in_second(e);break;case"transform_rotate_with_radius_in_second":n.tl=l.transform_rotate_with_radius_in_second(e);break;case"transform_rotate_with_radius_in_second_forever":n.tl=l.transform_rotate_with_radius_in_second_forever(e);break;case"transform_rotate_with_axis_in_second":n.tl=l.transform_rotate_with_axis_in_second(e);break;case"transform_rotate_from_origin_with_axis_in_second":n.tl=l.transform_rotate_from_origin_with_axis_in_second(e);break;case"transform_scale_by_in_second":n.tl=l.transform_scale_by_in_second(e);break;case"transform_set_position":n.tl=l.transform_set_position(e);break;case"transform_get_position":n.data=l.transform_get_position(e);break;case"transform_get_distance":n.data=l.transform_get_distance(e);break;case"transform_set_rotation":n.tl=l.transform_set_rotation(e);break;case"transform_to_look_at_gameobject":n.tl=l.transform_to_look_at_gameobject(e);break;case"transform_to_look_at":n.tl=l.transform_to_look_at(e);break;case"transform_get_rotation":n.data=l.transform_get_rotation(e);break;case"transform_get_rotation_in_space":n.data=l.transform_get_rotation_in_space(e);break;case"transform_get_scale":n.data=l.transform_get_scale(e);break;case"transform_get_scale_in_space":n.data=l.transform_get_scale_in_space(e);break;case"transform_get_scale_axis_in_space":n.data=l.transform_get_scale_axis_in_space(e);break;case"transform_set_scale":n.tl=l.transform_set_scale(e);break;case"transform_set_scale_by_axis":n.tl=l.transform_set_scale_by_axis(e)}return"next"==e.children[e.children.length-1].tagName?n.tl?n.tl.eventCallback("onComplete",(function(){l.parseBlock(e.children[e.children.length-1].children[0],t)})):l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(n.tl?n.tl.eventCallback("onComplete",(function(){t()})):t()),n},Logic.prototype.transform_move_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"METER");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"NUM"!=o.type)return;let c=document.getElementById(a.value);if(null==c)return;let s=c.object3D.position.clone(),u=new THREE.Vector3;switch(t){case"FORWARD":u.set(0,0,1);break;case"BACKWARD":u.set(0,0,-1);break;case"RIGHT":u.set(-1,0,0);break;case"LEFT":u.set(1,0,0);break;case"UP":u.set(0,1,0);break;case"DOWN":u.set(0,-1,0)}u=u.applyEuler(c.object3D.rotation),u.multiplyScalar(r.value),s.add(u);let d=gsap.timeline();return this.timelineDict[e.id]=d,d.to(c.object3D.position,{duration:o.value,delay:0,ease:"none",x:s.x,y:s.y,z:s.z}),d},Logic.prototype.transform_move_target_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=this.getBlockByValueName(e,"SECOND");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=document.getElementById(l.value);if(null==o)return;n.value.multiply(new THREE.Vector3(-1,1,1));let c=gsap.timeline();return this.timelineDict[e.id]=c,c.to(o.object3D.position,{duration:i.value,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),c},Logic.prototype.transform_rotate_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"DEGREE");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"DEGREE"!=r.type)return;let i=this.getBlockByValueName(e,"SECOND");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"NUM"!=o.type)return;let c=document.getElementById(a.value);if(null==c)return;let s=c.object3D.rotation.clone();switch(t){case"CLOCKWISE":s.y-=Math.PI*r.value/180;break;case"COUNTERCLOCKWISE":s.y+=Math.PI*r.value/180}let u=gsap.timeline();return this.timelineDict[e.id]=u,u.to(c.object3D.rotation,{duration:o.value,delay:0,ease:"none",y:s.y}),u},Logic.prototype.rotateAboutPoint=function(e,t,l,a,n){(n=void 0!==n&&n)&&e.parent.localToWorld(e.position),e.position.sub(t),e.position.applyAxisAngle(l,a),e.position.add(t),n&&e.parent.worldToLocal(e.position),e.rotateOnWorldAxis(l,a)},Logic.prototype.transform_rotate_with_radius_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getBlockByValueName(e,"GAME_OBJECT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"DEGREE");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"DEGREE"!=i.type)return;let o=this.getBlockByValueName(e,"RADIUS");if(null==o)return;let c=this.parseBlock(o).data;if(null==c||"NUM"!=c.type)return;c.value<0&&(c.value=0);let s=this.getBlockByValueName(e,"SECOND");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"NUM"!=u.type)return;let d=document.getElementById(n.value);if(null==d)return;let h=new THREE.Vector3(0,0,1).applyEuler(d.object3D.rotation),p=d.object3D.up.clone().applyEuler(d.object3D.rotation),_=d.object3D.position.clone().add(h.multiplyScalar(c.value));switch(l){case"CLOCKWISE":i.value=-i.value;break;case"COUNTERCLOCKWISE":i.value=i.value}let f=gsap.timeline();t.timelineDict[e.id]=f;let g=0;return d.object3D.roundTheta=0,f.to(d.object3D,{duration:u.value,delay:0,ease:"none",roundTheta:i.value,onUpdate:function(){t.rotateAboutPoint(d.object3D,_,p,(d.object3D.roundTheta-g)/180*Math.PI),g=d.object3D.roundTheta}}),f},Logic.prototype.transform_rotate_with_radius_in_second_forever=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getBlockByValueName(e,"GAME_OBJECT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"RADIUS");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;i.value<0&&(i.value=0);let o=this.getBlockByValueName(e,"SECOND");if(null==o)return;let c=this.parseBlock(o).data;if(null==c||"NUM"!=c.type)return;let s=document.getElementById(n.value);if(null==s)return;let u,d=new THREE.Vector3(0,0,1).applyEuler(s.object3D.rotation),h=s.object3D.up.clone().applyEuler(s.object3D.rotation),p=s.object3D.position.clone().add(d.multiplyScalar(i.value));switch(l){case"CLOCKWISE":u=-360;break;case"COUNTERCLOCKWISE":u=360}let _=gsap.timeline();t.timelineDict[e.id]=_;let f=0;return s.object3D.loopTheta=0,_.to(s.object3D,{repeat:-1,duration:c.value,delay:0,ease:"none",loopTheta:u,onUpdate:function(){t.rotateAboutPoint(s.object3D,p,h,(s.object3D.loopTheta-f)/180*Math.PI),f=s.object3D.loopTheta}}),_},Logic.prototype.transform_rotate_with_axis_in_second=function(e){let t=this.getContentByFieldName(e,"DIRECTION");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"ROTATION");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"VEC3"!=r.type)return;let i=this.getBlockByValueName(e,"DEGREE");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"DEGREE"!=o.type)return;let c=this.getBlockByValueName(e,"SECOND");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=document.getElementById(a.value);if(null==u)return;switch(r.value.x=-r.value.x,r.value.normalize(),t){case"CLOCKWISE":o.value=-o.value;break;case"COUNTERCLOCKWISE":o.value=o.value}let d=gsap.timeline();this.timelineDict[e.id]=d;let h=0;return u.object3D.axisTheta=0,d.to(u.object3D,{duration:s.value,delay:0,ease:"none",axisTheta:o.value,onUpdate:function(){u.object3D.rotateOnAxis(r.value,(u.object3D.axisTheta-h)/180*Math.PI),h=u.object3D.axisTheta}}),d},Logic.prototype.transform_rotate_from_origin_with_axis_in_second=function(e){let t=this,l=this.getContentByFieldName(e,"DIRECTION");if(null==l)return;let a=this.getContentByFieldName(e,"ORIGIN_SPACE");if(null==a)return;let n=this.getContentByFieldName(e,"AXIS_SPACE");if(null==n)return;let r=this.getBlockByValueName(e,"GAME_OBJECT");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"TEXT"!=i.type)return;let o=this.getBlockByValueName(e,"ORIGIN");if(null==o)return;let c=this.parseBlock(o).data;if(null==c||"VEC3"!=c.type)return;c.value.multiply(new THREE.Vector3(-1,1,1));let s=this.getBlockByValueName(e,"AXIS");if(null==s)return;let u=this.parseBlock(s).data;if(null==u||"VEC3"!=u.type)return;u.value.multiply(new THREE.Vector3(-1,1,1)),u.value.normalize();let d=this.getBlockByValueName(e,"DEGREE");if(null==d)return;let h=this.parseBlock(d).data;if(null==h||"DEGREE"!=h.type)return;let p=this.getBlockByValueName(e,"SECOND");if(null==p)return;let _=this.parseBlock(p).data;if(null==_||"NUM"!=_.type)return;let f=document.getElementById(i.value);if(null==f)return;switch(l){case"CLOCKWISE":h.value=-h.value;break;case"COUNTERCLOCKWISE":h.value=h.value}switch(a){case"SPACE_LOCAL":c.value=c.value.applyMatrix4(f.object3D.matrix);break;case"SPACE_GLOBAL":c.value=f.object3D.worldToLocal(c.value).applyMatrix4(f.object3D.matrix)}switch(n){case"SPACE_LOCAL":u.value=u.value.applyEuler(f.object3D.rotation);break;case"SPACE_GLOBAL":if("a-entity"==f.parentEl.localName){console.log("has parent");let e=new THREE.Quaternion;f.parentEl.object3D.getWorldQuaternion(e);let t=new THREE.Euler;t.setFromQuaternion(e,"YXZ"),console.log("world eular",t),t.x=-t.x,t.y=-t.y,t.z=-t.z,u.value=u.value.applyEuler(t),console.log(u.value)}}let g=gsap.timeline();t.timelineDict[e.id]=g;let y=0;return f.object3D.Theta=0,g.to(f.object3D,{duration:_.value,delay:0,ease:"none",Theta:h.value,onUpdate:function(){t.rotateAboutPoint(f.object3D,c.value,u.value,(f.object3D.Theta-y)/180*Math.PI),y=f.object3D.Theta}}),g},Logic.prototype.transform_scale_by_in_second=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"SCALE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"SECOND");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=document.getElementById(l.value);if(null==o)return;let c=o.object3D.scale.clone();c.multiplyScalar(n.value);let s=gsap.timeline();return this.timelineDict[e.id]=s,s.to(o.object3D.scale,{duration:i.value,delay:0,ease:"none",x:c.x,y:c.y,z:c.z}),s},Logic.prototype.transform_set_position=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;n.value.multiply(new THREE.Vector3(-1,1,1));let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.position,{duration:.01,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),i},Logic.prototype.transform_get_position=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object;switch(r.type="VEC3",t){case"SPACE_GLOBAL":r.value=n.object3D.getWorldPosition().clone();break;case"SPACE_LOCAL":r.value=n.object3D.position.clone()}return r.value.x=-r.value.x,r},Logic.prototype.transform_get_distance=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=new THREE.Vector3;r.object3D.getWorldPosition(i);let o=document.getElementById(n.value);if(null==o)return;let c=new THREE.Vector3;o.object3D.getWorldPosition(c);let s=new Object;return s.type="NUM",s.value=i.distanceTo(c),s},Logic.prototype.transform_set_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"ROTATION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=n.value.clone();r.y=-1*r.y,r.z=-1*r.z,n.value.copy(r);let i=document.getElementById(l.value);if(null==i)return;let o=gsap.timeline();return this.timelineDict[e.id]=o,o.to(i.object3D.rotation,{duration:.01,delay:0,ease:"none",x:n.value.x/180*Math.PI,y:n.value.y/180*Math.PI,z:n.value.z/180*Math.PI}),o},Logic.prototype.transform_to_look_at_gameobject=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=document.getElementById(n.value);if(null==i)return;let o=new THREE.Vector3;i.object3D.getWorldPosition(o);let c=gsap.timeline();return this.timelineDict[e.id]=c,c.to(r.object3D,{duration:.01,delay:0,ease:"none",onStart:function(){r.object3D.lookAt(o)}}),c},Logic.prototype.transform_to_look_at=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"POSITION");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;n.value.multiply(new THREE.Vector3(-1,1,1));let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(gsapEmpty,{duration:.01,delay:0,ease:"none",onStart:function(){r.object3D.lookAt(n.value)}}),i},Logic.prototype.transform_get_rotation=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;let n=new Object;return n.type="VEC3",n.value=a.object3D.rotation.clone(),n.value.x=n.value.x/Math.PI*180,n.value.y=-n.value.y/Math.PI*180,n.value.z=-n.value.z/Math.PI*180,n},Logic.prototype.transform_get_rotation_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object;switch(r.type="VEC3",t){case"SPACE_GLOBAL":let e=new THREE.Quaternion;n.object3D.getWorldQuaternion(e);let t=new THREE.Euler;t.setFromQuaternion(e,"YXZ"),r.value=t;break;case"SPACE_LOCAL":r.value=n.object3D.rotation.clone()}return r.value.x=r.value.x/Math.PI*180,r.value.y=-r.value.y/Math.PI*180,r.value.z=-r.value.z/Math.PI*180,r},Logic.prototype.transform_get_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null==a)return;let n=new Object;return n.type="NUM",n.value=a.object3D.scale.clone().x,n},Logic.prototype.transform_get_scale_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object,i=new THREE.Vector3;switch(r.type="NUM",t){case"SPACE_GLOBAL":n.object3D.getWorldScale(i),r.value=i.x;break;case"SPACE_LOCAL":r.value=n.object3D.scale.clone().x}return r},Logic.prototype.transform_get_scale_axis_in_space=function(e){let t=this.getContentByFieldName(e,"SPACE");if(null==t)return;let l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=new Object;switch(r.value=new THREE.Vector3,r.type="VEC3",t){case"SPACE_GLOBAL":r.value=n.object3D.getWorldScale(r.value);break;case"SPACE_LOCAL":r.value=n.object3D.scale.clone()}return r},Logic.prototype.transform_set_scale=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"SCALE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.scale,{duration:.01,delay:0,ease:"none",x:n.value,y:n.value,z:n.value}),i},Logic.prototype.transform_set_scale_by_axis=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"AXIS");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"VEC3"!=n.type)return;let r=document.getElementById(l.value);if(null==r)return;let i=gsap.timeline();return this.timelineDict[e.id]=i,i.to(r.object3D.scale,{duration:.01,delay:0,ease:"none",x:n.value.x,y:n.value.y,z:n.value.z}),i},Logic.prototype.parse_actions_block=function(e,t){let l=this,a=e.getAttribute("type"),n=new Object,r=null;switch(a){case"actions_set_color":l.actions_set_color(e);break;case"actions_set_visibility":l.actions_set_visibility(e);break;case"actions_set_opacity":l.actions_set_opacity(e);break;case"actions_set_animation":l.actions_set_animation(e);break;case"actions_set_animation_by_id":l.actions_set_animation_by_id(e);break;case"actions_play_sound_until_finished":r=l.actions_play_sound_until_finished(e,t);break;case"actions_play_sound":l.actions_play_sound(e);break;case"actions_stop_sound":l.actions_stop_sound(e);break;case"actions_play_video_until_finished":r=l.actions_play_video_until_finished(e,t);break;case"actions_play_video":l.actions_play_video(e);break;case"actions_pause_video":l.actions_pause_video(e);break;case"actions_stop_video":l.actions_stop_video(e);break;case"actions_set_light_color":l.actions_set_light_color(e);break;case"actions_set_light_intensity":l.actions_set_light_intensity(e);break;case"actions_set_text":r=l.actions_set_text(e,t);break;case"actions_set_text_color":r=l.actions_set_text_color(e,t);break;case"actions_set_text_bgcolor":r=l.actions_set_text_bgcolor(e,t)}return"next"==e.children[e.children.length-1].tagName?r||l.parseBlock(e.children[e.children.length-1].children[0],t):t&&(r||t()),n},Logic.prototype.actions_set_color=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=this.getBlockByValueName(e,"COLOUR");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type&&"COLOUR"!=n.type)return;let r=10*parseFloat(l[2])+parseFloat(l[3]),i=10*parseFloat(l[0])+parseFloat(l[1]),o=document.getElementById(t);if(null==o)return;console.log(" --- ",o.object3D,l);let c=-1,s=-1;if(o.object3D.children.length>0&&o.object3D.children[0].ModelJson&&o.object3D.children[0].ModelJson.meshes&&o.object3D.children[0].ModelJson.materials&&o.object3D.children[0].ModelJson.nodes){let e=o.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,r==t){c=e[l].mesh,console.log("action.js: _actions_set_color: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_color: meshIndex = ",c),c>=0){let e=o.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_color: get meshData ",c,e),e&&e.primitives){let t=e.primitives[i];t.material>=0&&(s=t.material,console.log("action.js: _actions_set_color: materialIndex=",s))}}}s>=0&&o.object3D.traverse((function(e){if(e.isMesh&&e.el==o.object3D.el){let t=e.material.name.split("_");t[t.length-1]==s&&e.meshIdx==c&&(e.material=e.material.clone(),e.material.color=new THREE.Color(n.value))}}))},Logic.prototype.actions_set_visibility=function(e){let t=this.getBlockByValueName(e,"GAME_OBJECT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"BOOL");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"BOOL"!=n.type)return;let r=document.getElementById(l.value);null!=r&&(r.setAttribute("visible",n.value),r.object3D.traverse((function(e){"Group"==e.type&&e.el.getAttribute("visible")&&e.el.object3D.behav&&e.el.setAttribute("class","clickable")})))},Logic.prototype.actions_set_opacity=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=this.getBlockByValueName(e,"PERCENT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=10*parseFloat(l[2])+parseFloat(l[3]),i=10*parseFloat(l[0])+parseFloat(l[1]),o=document.getElementById(t);if(null==o)return;console.log(" --- ",o.object3D,l);let c=-1,s=-1;if(o.object3D.children.length>0&&o.object3D.children[0].ModelJson&&o.object3D.children[0].ModelJson.meshes&&o.object3D.children[0].ModelJson.materials&&o.object3D.children[0].ModelJson.nodes){let e=o.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,r==t){c=e[l].mesh,console.log("action.js: _actions_set_opacity: get nodeMeshIndex ",e[l]);break}if(console.log("action.js: _actions_set_opacity: meshIndex = ",c),c>=0){let e=o.object3D.children[0].ModelJson.meshes[c];if(console.log("action.js: _actions_set_opacity: get meshData ",c,e),e&&e.primitives){let t=e.primitives[i];t.material>=0&&(s=t.material,console.log("action.js: _actions_set_opacity: materialIndex=",s))}}}s>=0&&o.object3D.traverse((function(e){if(e.isMesh){let t=e.material.name.split("_");t[t.length-1]==s&&e.meshIdx==c&&(e.material=e.material.clone(),e.material.transparent=!0,e.material.opacity=n.value/100,e.material.blending=THREE.NormalBlending,console.log("action.js: _actions_set_opacity: child.material =",e.material))}}))},Logic.prototype.actions_set_animation=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let a,n=document.getElementById(t);if(null!=n)if("None"==l)n.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<n.object3D.children[0].animationSlices.length;e++)n.object3D.children[0].animationSlices[e].name==l&&(a=n.object3D.children[0].animationSlices[e]);a&&(n.setAttribute("animation-mixer","clip: "+a.animationName),n.object3D.children[0].animationSlices[0].loop=a.uid,n.object3D.children[0].animationSlices[0].uid=a.uid,n.object3D.children[0].animationSlices[0].changed=!0,n.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_set_animation_by_id=function(e){let t=this.getContentByFieldName(e,"GAME_OBJECT");if(null==t)return;let l=this.getContentByFieldName(e,"ANIMATION");if(null==l)return;let a=this.getContentByFieldName(e,"TIMES");if(null==a)return;let n=document.getElementById(t);var r;if(null!=n)if("None"==l)n.object3D.children[0].animationSlices[0].uid=-1;else{for(let e=1;e<n.object3D.children[0].animationSlices.length;e++)n.object3D.children[0].animationSlices[e].uid==l&&(r=n.object3D.children[0].animationSlices[e]);n.setAttribute("animation-mixer","clip: "+r.animationName),n.object3D.children[0].animationSlices[0].uid=r.uid,n.object3D.children[0].animationSlices[0].changed=!0,"LOOP"==a&&(n.object3D.children[0].animationSlices[0].loop=r.uid,n.object3D.children[0].animationSlices[0].reset=!0)}},Logic.prototype.actions_play_sound_until_finished=function(e,t){let l=this.getBlockByValueName(e,"SOUND");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=this;if(1==r.checkObjectWorldVisible(n)){n.setAttribute("sound","loop:false"),n.components.sound.playSound();let l=function(a){n.components.sound.stopSound(),n.removeEventListener("sound-ended",l),n.setAttribute("sound","loop:true"),"next"==e.children[e.children.length-1].tagName?r.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return n.addEventListener("sound-ended",l),!0}},Logic.prototype.actions_play_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null!=a&&1==this.checkObjectWorldVisible(a)){let e=a.components.sound.pool.children.find((e=>e.el==a));e&&e.isPlaying||a.components.sound.playSound()}},Logic.prototype.actions_stop_sound=function(e){let t=this.getBlockByValueName(e,"SOUND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);null!=a&&1==this.checkObjectWorldVisible(a)&&a.components.sound.stopSound()},Logic.prototype.actions_play_video_until_finished=function(e,t){let l=this.getBlockByValueName(e,"VIDEO");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=document.getElementById(a.value);if(null==n)return;let r=this;if(1==r.checkObjectWorldVisible(n)){let l=n.getAttribute("src");if(null!=l){l=l.split("#").pop();let a=document.getElementById(l);if(a instanceof HTMLElement){a.loop=!1,a.muted=!1,a.play();let l=function(n){a.currentTime=0,a.pause(),a.removeEventListener("ended",l),a.loop=!0,"next"==e.children[e.children.length-1].tagName?r.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return a.addEventListener("ended",l),!0}}}},Logic.prototype.actions_play_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null!=a&&1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.loop=!0,t.muted=!1,t.play())}}},Logic.prototype.actions_pause_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null!=a&&1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&t.pause()}}},Logic.prototype.actions_stop_video=function(e){let t=this.getBlockByValueName(e,"VIDEO");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=document.getElementById(l.value);if(null!=a&&1==this.checkObjectWorldVisible(a)){let e=a.getAttribute("src");if(null!=e){e=e.split("#").pop();let t=document.getElementById(e);t instanceof HTMLElement&&(t.currentTime=t.duration,t.loop=!1)}}},Logic.prototype.actions_set_light_color=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"COLOUR");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type&&"COLOUR"!=n.type)return;let r=document.getElementById(l.value);null!=r&&(r.object3D.children[0].color=new THREE.Color(n.value))},Logic.prototype.actions_set_light_intensity=function(e){let t=this.getBlockByValueName(e,"LIGHT");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type)return;let a=this.getBlockByValueName(e,"PERCENT");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=document.getElementById(l.value);null!=r&&(r.object3D.children[0].intesity=n.value/100)},Logic.prototype.actions_set_text=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"TEXT");if(null==r)return;let i=this.parseBlock(r).data;if(null==i)return;let o=document.getElementById(n.value);if(null==o)return;let c=l.toString(i);if(o.children[0].getAttribute("value")!=c){o.children[0].components.text.textMesh.children.length=0,o.children[0].object3D.children.length=1,o.children[0].setAttribute("value",c);let a=c.split("\n"),n=0;const r=/[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u,i=e=>r.test(e);for(let e=0;e<a.length;e++){let t=0;for(let l=0;l<a[e].length;l++)i(a[e][l])?t+=1.6:a[e][l]==a[e][l].toUpperCase()&&a[e][l]!=a[e][l].toLowerCase()||a[e][l]==a[e][l].toLowerCase()&&a[e][l]!=a[e][l].toUpperCase()?t+=1:isNaN(1*a[e][l])?t+=1.25:t+=1;t>n&&(n=t)}o.children[0].setAttribute("wrap-count",n+1);let s=function(a){o.children[0].removeEventListener("geometry-set",s),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return o.children[0].addEventListener("geometry-set",s),!0}},Logic.prototype.actions_set_text_color=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"COLOUR");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"TEXT"!=i.type&&"COLOUR"!=i.type)return;let o=document.getElementById(n.value);if(null!=o&&o.children[0].getAttribute("color")!=i.value){o.children[0].components.text.textMesh.children.length=0,o.children[0].object3D.children.length=1,o.children[0].setAttribute("color",i.value);let a=function(n){o.children[0].removeEventListener("geometry-set",a),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return o.children[0].addEventListener("geometry-set",a),!0}},Logic.prototype.actions_set_text_bgcolor=function(e,t){let l=this,a=this.getBlockByValueName(e,"TEXT_ITEM");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type)return;let r=this.getBlockByValueName(e,"COLOUR");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"TEXT"!=i.type&&"COLOUR"!=i.type)return;let o=document.getElementById(n.value);if(null==o)return;let c=new THREE.Color(i.value),s=c.r+","+c.g+","+c.b+",1";if(o.children[0].getAttribute("backcolor")!=s){o.children[0].components.text.textMesh.children.length=0,o.children[0].object3D.children.length=1,o.children[0].setAttribute("backcolor",s);let a=function(n){o.children[0].removeEventListener("geometry-set",a),"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()};return o.children[0].addEventListener("geometry-set",a),!0}},Logic.prototype.parse_controls_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"controls_repeat_forever":a.tl=this.controls_repeat_forever(e,t);break;case"controls_repeat":a.tl=this.controls_repeat(e,t);break;case"controls_for":a.tl=this.controls_for(e,t);break;case"controls_whileUntil":a.tl=this.controls_whileUntil(e,t);break;case"controls_forEach":a.tl=this.controls_forEach(e,t);break;case"controls_flow_statements":a.tl=this.controls_flow_statements(e,t);break;case"controls_if":a.tl=this.controls_if(e,t);break;case"controls_ifelse":a.tl=this.controls_ifelse(e,t);break;case"controls_wait_time":a.tl=this.controls_wait_time(e,t);break;case"controls_run_parallel":a.tl=this.controls_run_parallel(e,t)}return"controls_repeat_forever"!=l&&("next"==e.children[e.children.length-1].tagName?a.tl||this.parseBlock(e.children[e.children.length-1].children[0],t):t&&(a.tl||t())),a},Logic.prototype.controls_repeat_forever=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO");if(null==a)return;let n=gsap.timeline();return l.timelineDict[e.id]=n,n.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?n.restart():"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),n},Logic.prototype.controls_repeat=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO");if(null==a)return;let n=this.getBlockByValueName(e,"TIMES");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=Math.max(0,r.value)-1,o=gsap.timeline();return l.timelineDict[e.id]=o,o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){null==a||"CONTINUE"==a?i>0?(i-=1,o.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t():"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}),o},Logic.prototype.controls_for=function(e,t){let l=this,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let n=this.getBlockByValueName(e,"FROM");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=this.getBlockByValueName(e,"TO");if(null==i)return;let o=this.parseBlock(i).data;if(null==o||"NUM"!=o.type)return;let c=this.getBlockByValueName(e,"BY");if(null==c)return;let s=this.parseBlock(c).data;if(null==s||"NUM"!=s.type)return;let u=this.getBlockByValueName(e,"DO");if(null==u)return;let d,h=r.value;this.variableList.forEach((e=>{e.name==a&&(d=e)}));let p=new Object;p.value=h,p.type="NUM";let _=gsap.timeline();return l.timelineDict[e.id]=_,h<=o.value&&s.value>0||h>=o.value&&s.value<0?(d.data=p,_.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(u,(function(a=null){null==a||"CONTINUE"==a?(h+=s.value,h<=o.value&&s.value>0||h>=o.value&&s.value<0?(d.data.value=h,_.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),_},Logic.prototype.controls_whileUntil=function(e,t){let l=this,a=this.getContentByFieldName(e,"MODE");if(null==a)return;let n=this.getBlockByValueName(e,"DO");if(null==n)return;let r=this.getBlockByValueName(e,"BOOL");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"BOOL"!=i.type)return;let o=gsap.timeline();return l.timelineDict[e.id]=o,"WHILE"==a&&i.value||"UNTIL"==a&&!i.value?o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(n,(function(n=null){null==n||"CONTINUE"==n?(i=l.parseBlock(r).data,"WHILE"==a&&i.value||"UNTIL"==a&&!i.value?o.restart():"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==n&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}}):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),o},Logic.prototype.controls_forEach=function(e,t){let l=this,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let n=this.getBlockByValueName(e,"LIST");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"LIST"!=r.type)return;if(r.value.length<1)return;let i=this.getBlockByValueName(e,"DO");if(null==i)return;let o,c=0;this.variableList.forEach((e=>{e.name==a&&(o=e)}));let s=new Object;s.value=r.value[c].value,s.type=r.value[c].type,o.data=s;let u=gsap.timeline();l.timelineDict[e.id]=u,u.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(i,(function(a=null){null==a||"CONTINUE"==a?(c+=1,c<r.value.length?(o.data.value=r.value[c].value,o.data.type=r.value[c].type,u.restart()):"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()):"BREAK"==a&&("next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t())}))}})},Logic.prototype.controls_flow_statements=function(e,t){let l=this.getContentByFieldName(e,"FLOW");null!=l&&t&&t(l)},Logic.prototype.controls_if=function(e,t){let l=this,a=parseInt(e.children[0].getAttribute("elseif")),n=0,r=gsap.timeline();for(l.timelineDict[e.id]=r;;){let a=this.getBlockByValueName(e,"IF"+n);if(null==a)break;let i=this.parseBlock(a).data;if(null==i||"BOOL"!=i.type)break;let o=this.getBlockByValueName(e,"DO"+n);if(i.value)return o?(r.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(o,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),r):void 0;n+=1}let i=this.getBlockByValueName(e,"ELSE");if(i&&n==a+1)return r.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(i,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),r;"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()},Logic.prototype.controls_ifelse=function(e,t){let l=this,a=this.getBlockByValueName(e,"DO0"),n=this.getBlockByValueName(e,"ELSE");if(null==a&&null==n)return;let r=this.getBlockByValueName(e,"IF0");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"BOOL"!=i.type)return;let o=gsap.timeline();return l.timelineDict[e.id]=o,i.value?o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(a,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}):o.to(gsapEmpty,{delay:0,onStart:function(){l.parseBlock(n,(function(a=null){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(a)}))}}),o},Logic.prototype.controls_wait_time=function(e,t){let l=this,a=this.getContentByFieldName(e,"UNIT");if(null==a)return;let n=this.getBlockByValueName(e,"TIME");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;switch(a){case"SECONDS":r.value=r.value;break;case"MILLISECOND":r.value=r.value/1e3;break;case"MINUTES":r.value=60*r.value}let i=gsap.timeline();return l.timelineDict[e.id]=i,i.to(gsapEmpty,{delay:r.value,onStart:function(){"next"==e.children[e.children.length-1].tagName?l.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()}}),i},Logic.prototype.controls_run_parallel=function(e,t){let l=parseInt(e.children[0].getAttribute("do")),a=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"DO"+(t+1));l&&a.push(l)}if(!(a.length<1))for(let e=0;e<a.length;e++)this.parseBlock(a[e])},Logic.prototype.parse_operators_block=function(e){let t=e.getAttribute("type"),l=new Object;switch(t){case"operators_compare":l.data=this.operators_compare(e);break;case"operators_operation":l.data=this.operators_operation(e);break;case"operators_negate":l.data=this.operators_negate(e);break;case"operators_ternary":l.data=this.operators_ternary(e);break;case"operators_arithmetic":l.data=this.operators_arithmetic(e);break;case"operators_random_int":l.data=this.operators_random_int(e);break;case"operators_random_float_between":l.data=this.operators_random_float_between(e);break;case"operators_constrain":l.data=this.operators_constrain(e);break;case"operators_number_property":l.data=this.operators_number_property(e);break;case"operators_is_divisable":l.data=this.operators_is_divisable(e);break;case"operators_round":l.data=this.operators_round(e);break;case"operators_round_to_decimals":l.data=this.operators_round_to_decimals(e);break;case"operators_single":l.data=this.operators_single(e);break;case"operators_trig":l.data=this.operators_trig(e);break;case"operators_on_list":l.data=this.operators_on_list(e)}return l},Logic.prototype.operators_compare=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a)return;let n=this.getBlockByValueName(e,"B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r)return;if(a.type!=r.type)return null;let i=new Object;switch(i.type="BOOL",t){case"EQ":i.value=a.value==r.value;break;case"NEQ":i.value=a.value!=r.value;break;case"LT":if("NUM"!=a.type)return null;i.value=a.value<r.value;break;case"LTE":if("NUM"!=a.type)return null;i.value=a.value<=r.value;break;case"GT":if("NUM"!=a.type)return null;i.value=a.value>r.value;break;case"GTE":if("NUM"!=a.type)return null;i.value=a.value>=r.value}return i},Logic.prototype.operators_operation=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"BOOL"!=a.type)return;let n=this.getBlockByValueName(e,"B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"BOOL"!=r.type)return;let i=new Object;switch(i.type="BOOL",t){case"AND":i.value=a.value&&r.value;break;case"OR":i.value=a.value||r.value}return i},Logic.prototype.operators_negate=function(e){let t=this.getBlockByValueName(e,"BOOL");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let a=new Object;return a.type="BOOL",a.value=!l.value,a},Logic.prototype.operators_ternary=function(e){let t=this.getBlockByValueName(e,"IF");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"BOOL"!=l.type)return;let a=this.getBlockByValueName(e,"THEN");if(null==a)return;let n=this.parseBlock(a).data,r=this.getBlockByValueName(e,"ELSE");if(null==r)return;let i=this.parseBlock(r).data;return l.value?n:i},Logic.prototype.operators_arithmetic=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=this.getBlockByValueName(e,"B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"NUM"!=r.type)return;let i=new Object;switch(i.type="NUM",t){case"ADD":i.value=a.value+r.value;break;case"MINUS":i.value=a.value-r.value;break;case"MULTIPLY":i.value=a.value*r.value;break;case"DIVIDE":i.value=a.value/r.value;break;case"POWER":i.value=Math.pow(a.value,r.value);break;case"MOD":i.value=a.value%r.value}return i},Logic.prototype.operators_random_int=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"TO");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=parseInt(n.value),i=parseInt(l.value),o=new Object;return o.type="NUM",o.value=parseInt(Math.random()*(r-i))+i,o},Logic.prototype.operators_random_float_between=function(e){let t=this.getBlockByValueName(e,"FROM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"TO");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=new Object;return r.type="NUM",r.value=Math.random()*(n.value-l.value)+l.value,r},Logic.prototype.operators_constrain=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"LOW");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"HIGH");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=new Object;return o.type="NUM",o.value=Math.min(Math.max(l.value,n.value),i.value),o},Logic.prototype.operators_number_property=function(e){let t=this.getContentByFieldName(e,"PROPERTY");if(null==t)return;let l=this.getBlockByValueName(e,"NUMBER_TO_CHECK");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=new Object;switch(n.type="BOOL",CheckPrime=function(e){if(2==e||3==e)return!0;if(!(e>1)||e%1!=0||e%2==0||e%3==0)return!1;for(let t=6;t<=Math.sqrt(e)+1.5;t+=6)if(e%(t-1)==0||e%(t+1)==0)return!1;return!0},t){case"EVEN":n.value=a.value%2==0;break;case"ODD":n.value=a.value%2==1;break;case"PRIME":n.value=CheckPrime(a.value);break;case"WHOLE":n.value=a.value%1==0;break;case"POSITIVE":n.value=a.value>0;break;case"NEGATIVE":n.value=a.value<0}return n},Logic.prototype.operators_is_divisable=function(e){let t=this.getBlockByValueName(e,"DIVIDEND");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"DIVISOR");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=new Object;return r.type="BOOL",r.value=l.value%n.value==0,r},Logic.prototype.operators_round=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=new Object;switch(n.type="NUM",t){case"ROUND":n.value=Math.round(a.value);break;case"ROUNDUP":n.value=Math.ceil(a.value);break;case"ROUNDDOWN":n.value=Math.floor(a.value)}return n},Logic.prototype.operators_round_to_decimals=function(e){let t=this.getBlockByValueName(e,"A");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"B");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=new Object;r.type="NUM";let i=parseInt(n.value);return value=l.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+i:i))),value=value.toString().split("e"),r.value=+(value[0]+"e"+(value[1]?+value[1]-i:-i)),r},Logic.prototype.operators_single=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type)return;let n=new Object;switch(n.type="NUM",t){case"ROOT":n.value=Math.sqrt(a.value);break;case"ABS":n.value=Math.abs(a.value);break;case"NEG":n.value=-a.value;break;case"LN":n.value=Math.log(a.value);break;case"LOG10":n.value=Math.log10(a.value);break;case"EXP":n.value=Math.exp(a.value);break;case"POW10":n.value=Math.pow(10,a.value)}return n},Logic.prototype.operators_trig=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"NUM");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"NUM"!=a.type&&"DEGREE"!=a.type)return;"DEGREE"==a.type&&(a.value=Math.PI*a.value/180);let n=new Object;switch(n.type="NUM",t){case"SIN":n.value=Math.sin(a.value);break;case"COS":n.value=Math.cos(a.value);break;case"TAN":n.value=Math.tan(a.value);break;case"ASIN":n.value=Math.asin(a.value);break;case"ACOS":n.value=Math.acos(a.value);break;case"ATAN":n.value=Math.atan(a.value)}return n},Logic.prototype.operators_on_list=function(e){let t=this.getContentByFieldName(e,"OP");if(null==t)return;let l=this.getBlockByValueName(e,"LIST");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"LIST"!=a.type)return;let n=[],r={};for(let e=0;e<a.value.length;e++){if("NUM"!=a.value[e].type)return;n.push(a.value[e].value),r[a.value[e].value]?r[a.value[e].value]+=1:r[a.value[e].value]=1}let i=new Object;switch(i.type="NUM",t){case"SUM":i.value=n.reduce(((e,t)=>e+t),0);break;case"MIN":i.value=Math.min(...n);break;case"MAX":i.value=Math.max(...n);break;case"AVERAGE":i.value=n.reduce(((e,t)=>e+t),0)/n.length;break;case"MEDIAN":n.sort((function(e,t){return e-t})),n.length%2==1?i.value=n[parseInt(n.length/2)]:i.value=(n[parseInt(n.length/2)-1]+n[parseInt(n.length/2)])/2;break;case"MODE":let e=Math.max(...Object.values(r)),t=[];Object.keys(r).forEach((l=>{if(r[l]==e){let e=new Object;e.value=parseFloat(l),e.type="NUM",t.push(e)}})),i.value=t,i.type="LIST";break;case"STD_DEV":let l=n.reduce(((e,t)=>e+t),0)/n.length,a=0;n.forEach((e=>{let t=e-l;a+=t*t})),i.value=Math.sqrt(a/n.length);break;case"RANDOM":i.value=n[parseInt(Math.random()*n.length)]}return i},Logic.prototype.parse_items_block=function(e){let t,l=e.getAttribute("type");if(Array.isArray(vrController.editor_version)&&vrController.editor_version[0]<=3&&vrController.editor_version[1]<=4)t=vrController.VRSceneResult[vrController.projectIdx].scenes[vrController.sceneIndex].objs;else if("object"==typeof vrController.editor_version&&4==Object.keys(vrController.editor_version).length){let e=Number(vrController.editor_version.v0),l=Number(vrController.editor_version.v1);Number(vrController.editor_version.v2),(e>3||3==e&&l>=5)&&(t=vrController.scenesData.scenes[vrController.currentSceneIndex].objs)}let a=new Object;switch(l){case"items_get_gameobject":case"items_get_model":case"items_get_text":case"items_get_light":case"items_get_sound":case"items_get_video":a.data=this.items_get_gameobject(e);break;case"items_get_name":a.data=this.items_get_name(e,t);break;case"items_get_by_name":a.data=this.items_get_by_name(e,t);break;case"items_is_video_playing":a.data=this.items_is_video_playing(e)}return"items_get_name"!=l&&(this.checkObjectBehav(a)||(a.data=null)),a},Logic.prototype.items_get_gameobject=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type="TEXT",t},Logic.prototype.items_get_name=function(e,t){let l=new Object,a=this.getBlockByValueName(e,"GAME_OBJECT"),n=this.parseBlock(a).data.value;return l.type="TEXT",t.forEach((e=>{e.obj_id==n&&(l.value=e.res_name)})),l},Logic.prototype.items_get_by_name=function(e,t){let l=new Object,a=this.getBlockByValueName(e,"NAME"),n=this.parseBlock(a).data.value;return l.type="TEXT",t.forEach((e=>{e.res_name==n&&(l.value=e.obj_id)})),l},Logic.prototype.items_is_video_playing=function(e){let t=new Object,l=this.getBlockByValueName(e,"VIDEO"),a=this.parseBlock(l).data.value,n=document.getElementById(a);n=document.getElementById(a);let r=document.querySelector("video");if(n)return t.type="BOOL",t.value=!r.paused,t},Logic.prototype.parse_data_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"data_boolean":a.data=this.data_boolean(e);break;case"data_number":a.data=this.data_number(e);break;case"data_angle":a.data=this.data_angle(e);break;case"data_constant":a.data=this.data_constant(e);break;case"data_colour_random":a.data=this.data_colour_random(e);break;case"data_colour_of":a.data=this.data_colour_of(e);break;case"data_colour_picker":a.data=this.data_colour_picker(e);break;case"data_colour_rgb":a.data=this.data_colour_rgb(e);break;case"data_colour_blend":a.data=this.data_colour_blend(e);break;case"data_text":a.data=this.data_text(e);break;case"data_text_join":a.data=this.data_text_join(e);break;case"data_vector3":a.data=this.data_vector3(e);break;case"data_get_axis_from_vector3":a.data=this.data_get_axis_from_vector3(e);break;case"data_length":a.data=this.data_length(e);break;case"data_lists_create_empty":a.data=this.data_lists_create_empty(e);break;case"data_lists_create_list":this.data_lists_create_list(e);break;case"data_lists_create_with":a.data=this.data_lists_create_with(e);break;case"data_lists_add":this.data_lists_add(e);break;case"data_lists_insert_by_index":this.data_lists_insert_by_index(e);break;case"data_lists_delete_by_index":this.data_lists_delete_by_index(e);break;case"data_lists_replace_by_index":this.data_lists_replace_by_index(e);break;case"data_lists_get_by_index":a.data=this.data_lists_get_by_index(e);break;case"data_lists_pop_by_index":a.data=this.data_lists_pop_by_index(e);break;case"data_lists_index":a.data=this.data_lists_index(e);break;case"data_lists_contains":a.data=this.data_lists_contains(e)}return e.children>0&&("next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t()),a},Logic.prototype.data_boolean=function(e){let t=new Object;return"TRUE"==e.children[0].textContent?t.value=!0:"FALSE"==e.children[0].textContent&&(t.value=!1),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_number=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_angle=function(e){let t=new Object;return t.value=parseFloat(e.children[0].textContent),t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_constant=function(e){let t=this.getContentByFieldName(e,"CONSTANT");if(null==t)return;let l=new Object;switch(l.type="NUM",t){case"PI":l.value=Math.PI;break;case"E":l.value=Math.E;break;case"GOLDEN_RATIO":l.value=(1+Math.sqrt(5))/2;break;case"SQRT2":l.value=Math.sqrt(2);break;case"SQRT1_2":l.value=Math.sqrt(.5);break;case"INFINITY":l.value=1/0}return l},Logic.prototype.data_colour_random=function(e){let t=new THREE.Color(Math.random(),Math.random(),Math.random()),l=new Object;return l.value="#"+t.getHexString().toUpperCase(),l.type="COLOUR",l},Logic.prototype.data_colour_of=function(e){let t=this.getContentByFieldName(e,"MODEL");if(null==t)return;let l=this.getContentByFieldName(e,"MATERIAL");if(null==l||"None"==l)return;let a=document.getElementById(t);if(null==a)return;let n=10*parseFloat(l[0])+parseFloat(l[1]),r=10*parseFloat(l[2])+parseFloat(l[3]),i=-1,o=-1;if(a.object3D.children.length>0&&a.object3D.children[0].ModelJson&&a.object3D.children[0].ModelJson.meshes&&a.object3D.children[0].ModelJson.materials&&a.object3D.children[0].ModelJson.nodes){let e=a.object3D.children[0].ModelJson.nodes,t=-1;for(let l=0;l<e.length;l++)if("number"==typeof e[l].mesh&&t++,n==t){i=e[l].mesh,console.log("data.js: _data_colour_of: get nodeMeshIndex ",e[l]);break}if(console.log("data.js: _data_colour_of: meshIndex = ",i),i>=0){let e=a.object3D.children[0].ModelJson.meshes[i];if(console.log("data.js: _data_colour_of: get meshData ",i,e),e&&e.primitives){let t=e.primitives[r];t.material&&(o=t.material,console.log("data.js: _data_colour_of: materialIndex=",o))}}}let c=new Object;if(c.type="COLOUR",o>=0){let e;a.object3D.traverse((function(t){if(t.isMesh){let l=t.material.name.split("_");l[l.length-1]==o&&(e=t.material,console.log("action.js: _data_colour_of: child.material =",t.material))}})),c.value="#"+e.color.getHexString().toUpperCase(),console.log("action.js: _data_colour_of: get material success color =",c.value)}else c.value="#C8C8C8",console.log("action.js: _data_colour_of: get material fail color =",c.value);return c},Logic.prototype.data_colour_picker=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_rgb=function(e){let t=this.getContentByFieldName(e,"COLOUR");if(null==t)return;let l=new Object;return l.value=t,l.type="COLOUR",l},Logic.prototype.data_colour_blend=function(e){let t=this.getBlockByValueName(e,"COLOUR1");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"COLOUR"!=l.type)return;let a=this.getBlockByValueName(e,"COLOUR2");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"TEXT"!=n.type&&"COLOUR"!=n.type)return;let r=this.getBlockByValueName(e,"RATIO");if(null==r)return;let i=this.parseBlock(r).data;if(null==i||"NUM"!=i.type)return;let o=Math.min(100,Math.max(0,i.value))/100;console.log(o);let c=new THREE.Color(l.value),s=new THREE.Color(n.value);console.log(c),console.log(s);let u=c.lerp(s,o);console.log(u);let d=new Object;return d.value="#"+u.getHexString().toUpperCase(),d.type="COLOUR",d},Logic.prototype.data_text=function(e){let t=new Object;return t.value=e.children[0].textContent,t.type=e.children[0].getAttribute("name"),t},Logic.prototype.data_text_join=function(e){let t=parseInt(e.children[0].getAttribute("items")),l=new Object;l.value="",l.type="TEXT";for(let a=0;a<t;a++){let t=this.getBlockByValueName(e,"ADD"+a);if(t){let e=this.parseBlock(t).data;l.value+=this.toString(e)}}return l},Logic.prototype.data_vector3=function(e){let t=new Object;if("X"!=e.children[0].getAttribute("name"))return null;let l=this.parseBlock(e.children[0].children[0]).data;if(null==l||"NUM"!=l.type)return null;if("Y"!=e.children[1].getAttribute("name"))return null;let a=this.parseBlock(e.children[1].children[0]).data;if(null==a||"NUM"!=a.type)return null;if("Z"!=e.children[2].getAttribute("name"))return null;let n=this.parseBlock(e.children[2].children[0]).data;return null==n||"NUM"!=n.type?null:(t.value=new THREE.Vector3(l.value,a.value,n.value),t.type="VEC3",t)},Logic.prototype.data_get_axis_from_vector3=function(e){let t=this.getContentByFieldName(e,"AXIS");if(null==t)return;let l=this.getBlockByValueName(e,"POSITION");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"VEC3"!=a.type)return;let n=new Object;switch(n.type="NUM",t){case"X":n.value=a.value.x;break;case"Y":n.value=a.value.y;break;case"Z":n.value=a.value.z}return n},Logic.prototype.data_length=function(e){let t=this.getBlockByValueName(e,"VALUE");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"TEXT"!=l.type&&"LIST"!=l.type)return;let a=new Object;return a.value=l.value.length,a.type="NUM",a},Logic.prototype.data_lists_create_empty=function(e){let t=new Object;return t.value=[],t.type="LIST",t},Logic.prototype.data_lists_create_list=function(e){let t,l=this.getContentByFieldName(e,"VAR");if(null==l)return;this.variableList.forEach((e=>{e.name==l&&(t=e)}));let a=new Object;a.value=[],a.type="LIST",t.data=a},Logic.prototype.data_lists_create_with=function(e){let t=new Object;t.value=[],t.type="LIST";let l=parseInt(e.children[0].getAttribute("items")),a=[];for(let t=0;t<l;t++){let l=this.getBlockByValueName(e,"ADD"+t);l&&a.push(l)}for(let e=0;e<a.length;e++){let l=this.parseBlock(a[e]).data;if(l){let e=new Object;e.value=l.value,e.type=l.type,t.value.push(e)}}return t},Logic.prototype.data_lists_add=function(e){let t=this.getBlockByValueName(e,"ITEM");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=new Object;r.value=l.value,r.type=l.type,n.value.push(r)},Logic.prototype.data_lists_insert_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"INDEX");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let i=this.parseBlock(r).data;if(null!=i&&"LIST"==i.type&&n.value>=0&&n.value<=i.value.length){let e=new Object;e.value=l.value,e.type=l.type,i.value.splice(n.value,0,e)}},Logic.prototype.data_lists_delete_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;null!=n&&"LIST"==n.type&&l.value>=0&&l.value<n.value.length&&n.value.splice(l.value,1)},Logic.prototype.data_lists_replace_by_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"INDEX");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"NUM"!=n.type)return;let r=this.getBlockByValueName(e,"VALUE");if(null==r)return;let i=this.parseBlock(r).data;if(null!=i&&"LIST"==i.type&&n.value>=0&&n.value<i.value.length){let e=new Object;e.value=l.value,e.type=l.type,i.value.splice(n.value,1,e)}},Logic.prototype.data_lists_get_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=new Object;return l.value>=0&&l.value<n.value.length&&(r=n.value[l.value]),r},Logic.prototype.data_lists_pop_by_index=function(e){let t=this.getBlockByValueName(e,"INDEX");if(null==t)return;let l=this.parseBlock(t).data;if(null==l||"NUM"!=l.type)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=new Object;return l.value>=0&&l.value<n.value.length&&(r=n.value[l.value],n.value.splice(l.value,1)),r},Logic.prototype.data_lists_index=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=[];n.value.forEach((e=>{r.push(e.value)}));let i=new Object;return i.type="NUM",i.value=r.indexOf(l.value),i},Logic.prototype.data_lists_contains=function(e){let t=this.getBlockByValueName(e,"TARGET");if(null==t)return;let l=this.parseBlock(t).data;if(null==l)return;let a=this.getBlockByValueName(e,"VALUE");if(null==a)return;let n=this.parseBlock(a).data;if(null==n||"LIST"!=n.type)return;let r=[];n.value.forEach((e=>{r.push(e.value)}));let i=new Object;i.type="BOOL";let o=r.indexOf(l.value);return i.value=-1!=o,i},Logic.prototype.parse_variables_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"variables_set":a.data=this.variables_set(e,t);break;case"variables_get":a.data=this.variables_get(e)}return a},Logic.prototype.variables_set=function(e,t){let l=new Object,a=this.getContentByFieldName(e,"VAR");if(null==a)return;let n=this.getBlockByValueName(e,"VALUE");return null!=n?(this.variableList.forEach((e=>{e.name==a&&(e.data=this.parseBlock(n).data,l=e.data)})),"next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),l):void 0},Logic.prototype.variables_get=function(e){let t=new Object;return this.variableList.forEach((l=>{l.name==e.children[0].textContent&&(t=l.data)})),t},Logic.prototype.parse_events_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"events_on_click":a.data=this.events_on_click(e);break;case"events_on_collide":a.data=this.events_on_collide(e)}return t&&t(),a},Logic.prototype.events_on_click=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"DO");if(null==n)return;let r=document.getElementById(a.value);if(null!=r&&r.object3D.el){if(r.object3D.el.onclickBlock){let e=!1;if(r.object3D.el.onclickBlock.forEach((t=>{t!=n||(e=!0)})),1==e)return;r.object3D.el.onclickBlock.push(n),r.object3D.el.onclickBlockState.push(!0)}else r.object3D.el.onclickBlock=[],r.object3D.el.onclickBlockState=[],r.object3D.el.onclickBlock.push(n),r.object3D.el.onclickBlockState.push(!0);t.onclickObjectDict[e.id]=[r.object3D.el.onclickBlock,r.object3D.el.onclickBlockState]}},Logic.prototype.events_on_collide=function(e){let t=this,l=this.getBlockByValueName(e,"GAME_OBJECT_A");if(null==l)return;let a=this.parseBlock(l).data;if(null==a||"TEXT"!=a.type)return;let n=this.getBlockByValueName(e,"GAME_OBJECT_B");if(null==n)return;let r=this.parseBlock(n).data;if(null==r||"TEXT"!=r.type)return;let i=t.getBlockByValueName(e,"DO0");if(null==i)return;let o=document.getElementById(a.value),c=document.getElementById(r.value);if(null==o||null==c)return;let s=(new THREE.Box3).setFromObject(o.object3D),u=(new THREE.Box3).setFromObject(c.object3D),d=s.intersectsBox(u),h=!0,p=window.setInterval((function(){if(s=(new THREE.Box3).setFromObject(o.object3D),u=(new THREE.Box3).setFromObject(c.object3D),h&&0==d&&1==s.intersectsBox(u)){d=!0,h=!1;let e=t.checkObjectWorldVisible(o),l=t.checkObjectWorldVisible(c);1==e&&1==l&&t.parseBlock(i,(function(){h=!0,console.log("collide canDo",d,h)}))}else 1==d&&0==s.intersectsBox(u)&&(d=!1)}),1);t.intervalList.push(p)},Logic.prototype.parse_debug_block=function(e,t){let l=e.getAttribute("type"),a=new Object;switch(l){case"debug_print":this.debug_print(e);break;case"debug_comment":this.debug_comment()}return"next"==e.children[e.children.length-1].tagName?this.parseBlock(e.children[e.children.length-1].children[0],t):t&&t(),a},Logic.prototype.toString=function(e){let t=this,l="";return"LIST"==e.type?e.value.forEach((e=>{l+=t.toString(e)})):"VEC3"==e.type?(value=e.value.x.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.y.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6)),value=e.value.z.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):"NUM"==e.type?(value=e.value.toString().split("e"),value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+6:6))),value=value.toString().split("e"),l+=+(value[0]+"e"+(value[1]?+value[1]-6:-6))):l+=e.value,l},Logic.prototype.debug_print=function(e){let t=this.parseBlock(e.children[0].children[0]).data;null!=t&&console.log(this.toString(t))},Logic.prototype.debug_comment=function(){};

/***/ }),

/***/ "./lib/vconsole.min.js":
/*!*****************************!*\
  !*** ./lib/vconsole.min.js ***!
  \*****************************/
/***/ ((module) => {

/*!
 * vConsole v3.3.0 (https://github.com/Tencent/vConsole)
 * 
 * Tencent is pleased to support the open source community by making vConsole available.
 * Copyright (C) 2017 THL A29 Limited, a Tencent company. All rights reserved.
 * Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
 * http://opensource.org/licenses/MIT
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
 */
!function(e,t){ true?module.exports=t():0}(window,function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e,t,o){var n,r,i;r=[t],void 0===(i="function"==typeof(n=function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return"[object Number]"==Object.prototype.toString.call(e)}function n(e){return"[object String]"==Object.prototype.toString.call(e)}function r(e){return"[object Array]"==Object.prototype.toString.call(e)}function i(e){return"[object Boolean]"==Object.prototype.toString.call(e)}function a(e){return void 0===e}function l(e){return null===e}function c(e){return"[object Symbol]"==Object.prototype.toString.call(e)}function s(e){return!("[object Object]"!=Object.prototype.toString.call(e)&&(o(e)||n(e)||i(e)||r(e)||l(e)||d(e)||a(e)||c(e)))}function d(e){return"[object Function]"==Object.prototype.toString.call(e)}function u(e){var t=Object.prototype.toString.call(e);return"[object global]"==t||"[object Window]"==t||"[object DOMWindow]"==t}function f(e){if(!s(e)&&!r(e))return[];if(r(e)){var t=[];return e.forEach(function(e,o){t.push(o)}),t}return Object.getOwnPropertyNames(e).sort()}Object.defineProperty(e,"__esModule",{value:!0}),e.getDate=function(e){var t=e>0?new Date(e):new Date,o=t.getDate()<10?"0"+t.getDate():t.getDate(),n=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getFullYear(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),a=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),l=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),c=t.getMilliseconds()<10?"0"+t.getMilliseconds():t.getMilliseconds();return c<100&&(c="0"+c),{time:+t,year:r,month:n,day:o,hour:i,minute:a,second:l,millisecond:c}},e.isNumber=o,e.isString=n,e.isArray=r,e.isBoolean=i,e.isUndefined=a,e.isNull=l,e.isSymbol=c,e.isObject=s,e.isFunction=d,e.isElement=function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":t(HTMLElement))?e instanceof HTMLElement:e&&"object"===t(e)&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},e.isWindow=u,e.isPlainObject=function(e){var o,n=Object.prototype.hasOwnProperty;if(!e||"object"!==t(e)||e.nodeType||u(e))return!1;try{if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(o in e);return void 0===o||n.call(e,o)},e.htmlEncode=function(e){return document.createElement("a").appendChild(document.createTextNode(e)).parentNode.innerHTML},e.JSONStringify=function(e){if(!s(e)&&!r(e))return JSON.stringify(e);var t="{",o="}";r(e)&&(t="[",o="]");for(var n=t,i=f(e),a=0;a<i.length;a++){var l=i[a],u=e[l];try{r(e)||(s(l)||r(l)||c(l)?n+=Object.prototype.toString.call(l):n+=l,n+=": "),r(u)?n+="Array["+u.length+"]":s(u)||c(u)||d(u)?n+=Object.prototype.toString.call(u):n+=JSON.stringify(u),a<i.length-1&&(n+=", ")}catch(e){continue}}return n+=o},e.getObjAllKeys=f,e.getObjName=function(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")},e.setStorage=function(e,t){window.localStorage&&(e="vConsole_"+e,localStorage.setItem(e,t))},e.getStorage=function(e){if(window.localStorage)return e="vConsole_"+e,localStorage.getItem(e)}})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n,r,i;r=[t,o(0),o(10)],void 0===(i="function"==typeof(n=function(o,n,r){"use strict";var i;Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var a={one:function(e,t){return t?t.querySelector(e):document.querySelector(e)},all:function(e,t){var o,n=[];return(o=t?t.querySelectorAll(e):document.querySelectorAll(e))&&o.length>0&&(n=Array.prototype.slice.call(o)),n},addClass:function(e,t){if(e){(0,n.isArray)(e)||(e=[e]);for(var o=0;o<e.length;o++){var r=e[o].className||"",i=r.split(" ");i.indexOf(t)>-1||(i.push(t),e[o].className=i.join(" "))}}},removeClass:function(e,t){if(e){(0,n.isArray)(e)||(e=[e]);for(var o=0;o<e.length;o++){for(var r=e[o].className.split(" "),i=0;i<r.length;i++)r[i]==t&&(r[i]="");e[o].className=r.join(" ").trim()}}},hasClass:function(e,t){if(!e)return!1;for(var o=e.className.split(" "),n=0;n<o.length;n++)if(o[n]==t)return!0;return!1},bind:function(e,t,o,r){if(e){void 0===r&&(r=!1),(0,n.isArray)(e)||(e=[e]);for(var i=0;i<e.length;i++)e[i].addEventListener(t,o,r)}},delegate:function(e,t,o,n){e&&e.addEventListener(t,function(t){var r=a.all(o,e);if(r)e:for(var i=0;i<r.length;i++)for(var l=t.target;l;){if(l==r[i]){n.call(l,t);break e}if((l=l.parentNode)==e)break}},!1)}};a.render=r.default;var l=a;o.default=l,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n,r,i;r=[t],void 0===(i="function"==typeof(n=function(o){"use strict";function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newPlugin";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.name=o,this.isReady=!1,this.eventList={}}return t=e,(o=[{key:"on",value:function(e,t){return this.eventList[e]=t,this}},{key:"trigger",value:function(e,t){if("function"==typeof this.eventList[e])this.eventList[e].call(this,t);else{var o="on"+e.charAt(0).toUpperCase()+e.slice(1);"function"==typeof this[o]&&this[o].call(this,t)}return this}},{key:"id",get:function(){return this._id},set:function(e){if(!e)throw"Plugin ID cannot be empty";this._id=e.toLowerCase()}},{key:"name",get:function(){return this._name},set:function(e){if(!e)throw"Plugin name cannot be empty";this._name=e}},{key:"vConsole",get:function(){return this._vConsole||void 0},set:function(e){if(!e)throw"vConsole cannot be empty";this._vConsole=e}}])&&n(t.prototype,o),r&&n(t,r),e;var t,o,r}();o.default=r,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var o=function(e,t){var o=e[1]||"",n=e[3];if(!n)return o;if(t&&"function"==typeof btoa){var r=(a=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"});return[o].concat(i).concat([r]).join("\n")}var a;return[o].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+o+"}":o}).join("")},t.i=function(e,o){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},r=0;r<this.length;r++){var i=this[r][0];null!=i&&(n[i]=!0)}for(r=0;r<e.length;r++){var a=e[r];null!=a[0]&&n[a[0]]||(o&&!a[2]?a[2]=o:o&&(a[2]="("+a[2]+") and ("+o+")"),t.push(a))}},t}},function(e,t,o){var n,r,i={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=n.apply(this,arguments)),r}),l=function(e){var t={};return function(e,o){if("function"==typeof e)return e();if(void 0===t[e]){var n=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,o);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),c=null,s=0,d=[],u=o(13);function f(e,t){for(var o=0;o<e.length;o++){var n=e[o],r=i[n.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](n.parts[a]);for(;a<n.parts.length;a++)r.parts.push(m(n.parts[a],t))}else{var l=[];for(a=0;a<n.parts.length;a++)l.push(m(n.parts[a],t));i[n.id]={id:n.id,refs:1,parts:l}}}}function v(e,t){for(var o=[],n={},r=0;r<e.length;r++){var i=e[r],a=t.base?i[0]+t.base:i[0],l={css:i[1],media:i[2],sourceMap:i[3]};n[a]?n[a].parts.push(l):o.push(n[a]={id:a,parts:[l]})}return o}function p(e,t){var o=l(e.insertInto);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===e.insertAt)n?n.nextSibling?o.insertBefore(t,n.nextSibling):o.appendChild(t):o.insertBefore(t,o.firstChild),d.push(t);else if("bottom"===e.insertAt)o.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=l(e.insertAt.before,o);o.insertBefore(t,r)}}function b(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function h(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return o.nc}();n&&(e.attrs.nonce=n)}return g(t,e.attrs),p(e,t),t}function g(e,t){Object.keys(t).forEach(function(o){e.setAttribute(o,t[o])})}function m(e,t){var o,n,r,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var a=s++;o=c||(c=h(t)),n=w.bind(null,o,a,!1),r=w.bind(null,o,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",g(t,e.attrs),p(e,t),t}(t),n=function(e,t,o){var n=o.css,r=o.sourceMap,i=void 0===t.convertToAbsoluteUrls&&r;(t.convertToAbsoluteUrls||i)&&(n=u(n));r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var a=new Blob([n],{type:"text/css"}),l=e.href;e.href=URL.createObjectURL(a),l&&URL.revokeObjectURL(l)}.bind(null,o,t),r=function(){b(o),o.href&&URL.revokeObjectURL(o.href)}):(o=h(t),n=function(e,t){var o=t.css,n=t.media;n&&e.setAttribute("media",n);if(e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}.bind(null,o),r=function(){b(o)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else r()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var o=v(e,t);return f(o,t),function(e){for(var n=[],r=0;r<o.length;r++){var a=o[r];(l=i[a.id]).refs--,n.push(l)}e&&f(v(e,t),t);for(r=0;r<n.length;r++){var l;if(0===(l=n[r]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete i[l.id]}}}};var y,_=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function w(e,t,o,n){var r=o?"":n.css;if(e.styleSheet)e.styleSheet.cssText=_(t,r);else{var i=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}},function(e,t,o){var n,r,i;r=[t,o(0),o(1),o(2),o(20),o(21),o(22)],void 0===(i="function"==typeof(n=function(o,n,r,i,a,l,c){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}(n),r=s(r),i=s(i),a=s(a),l=s(l),c=s(c);var b=1e3,h=[],g={},m=function(e){function t(){var e,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return o=f(this,(e=v(t)).call.apply(e,[this].concat(r))),h.push(o.id),o.tplTabbox="",o.allowUnformattedLog=!0,o.isReady=!1,o.isShow=!1,o.$tabbox=null,o.console={},o.logList=[],o.isInBottom=!0,o.maxLogNumber=b,o.logNumber=0,o.mockConsole(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),o=t,(i=[{key:"onInit",value:function(){this.$tabbox=r.default.render(this.tplTabbox,{}),this.updateMaxLogNumber()}},{key:"onRenderTab",value:function(e){e(this.$tabbox)}},{key:"onAddTopBar",value:function(e){for(var t=this,o=["All","Log","Info","Warn","Error"],n=[],i=0;i<o.length;i++)n.push({name:o[i],data:{type:o[i].toLowerCase()},className:"",onClick:function(){if(r.default.hasClass(this,"vc-actived"))return!1;t.showLogType(this.dataset.type||"all")}});n[0].className="vc-actived",e(n)}},{key:"onAddTool",value:function(e){var t=this,o=[{name:"Clear",global:!1,onClick:function(){t.clearLog(),t.vConsole.triggerEvent("clearLog")}}];e(o)}},{key:"onReady",value:function(){var e=this;e.isReady=!0;var t=r.default.all(".vc-subtab",e.$tabbox);r.default.bind(t,"click",function(o){if(o.preventDefault(),r.default.hasClass(this,"vc-actived"))return!1;r.default.removeClass(t,"vc-actived"),r.default.addClass(this,"vc-actived");var n=this.dataset.type,i=r.default.one(".vc-log",e.$tabbox);r.default.removeClass(i,"vc-log-partly-log"),r.default.removeClass(i,"vc-log-partly-info"),r.default.removeClass(i,"vc-log-partly-warn"),r.default.removeClass(i,"vc-log-partly-error"),"all"==n?r.default.removeClass(i,"vc-log-partly"):(r.default.addClass(i,"vc-log-partly"),r.default.addClass(i,"vc-log-partly-"+n))});var o=r.default.one(".vc-content");r.default.bind(o,"scroll",function(t){e.isShow&&(o.scrollTop+o.offsetHeight>=o.scrollHeight?e.isInBottom=!0:e.isInBottom=!1)});for(var n=0;n<e.logList.length;n++)e.printLog(e.logList[n]);e.logList=[]}},{key:"onRemove",value:function(){window.console.log=this.console.log,window.console.info=this.console.info,window.console.warn=this.console.warn,window.console.debug=this.console.debug,window.console.error=this.console.error,window.console.time=this.console.time,window.console.timeEnd=this.console.timeEnd,window.console.clear=this.console.clear,this.console={};var e=h.indexOf(this.id);e>-1&&h.splice(e,1)}},{key:"onShow",value:function(){this.isShow=!0,1==this.isInBottom&&this.autoScrollToBottom()}},{key:"onHide",value:function(){this.isShow=!1}},{key:"onShowConsole",value:function(){1==this.isInBottom&&this.autoScrollToBottom()}},{key:"onUpdateOption",value:function(){this.vConsole.option.maxLogNumber!=this.maxLogNumber&&(this.updateMaxLogNumber(),this.limitMaxLogs())}},{key:"updateMaxLogNumber",value:function(){this.maxLogNumber=this.vConsole.option.maxLogNumber||b,this.maxLogNumber=Math.max(1,this.maxLogNumber)}},{key:"limitMaxLogs",value:function(){if(this.isReady)for(;this.logNumber>this.maxLogNumber;){var e=r.default.one(".vc-item",this.$tabbox);if(!e)break;e.parentNode.removeChild(e),this.logNumber--}}},{key:"showLogType",value:function(e){var t=r.default.one(".vc-log",this.$tabbox);r.default.removeClass(t,"vc-log-partly-log"),r.default.removeClass(t,"vc-log-partly-info"),r.default.removeClass(t,"vc-log-partly-warn"),r.default.removeClass(t,"vc-log-partly-error"),"all"==e?r.default.removeClass(t,"vc-log-partly"):(r.default.addClass(t,"vc-log-partly"),r.default.addClass(t,"vc-log-partly-"+e))}},{key:"autoScrollToBottom",value:function(){this.vConsole.option.disableLogScrolling||this.scrollToBottom()}},{key:"scrollToBottom",value:function(){var e=r.default.one(".vc-content");e&&(e.scrollTop=e.scrollHeight-e.offsetHeight)}},{key:"mockConsole",value:function(){var e=this,t=this,o=["log","info","warn","debug","error"];window.console?(o.map(function(e){t.console[e]=window.console[e]}),t.console.time=window.console.time,t.console.timeEnd=window.console.timeEnd,t.console.clear=window.console.clear):window.console={},o.map(function(t){window.console[t]=function(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];e.printLog({logType:t,logs:n})}});var n={};window.console.time=function(e){n[e]=Date.now()},window.console.timeEnd=function(e){var t=n[e];t?(console.log(e+":",Date.now()-t+"ms"),delete n[e]):console.log(e+": 0ms")},window.console.clear=function(){t.clearLog();for(var e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];t.console.clear.apply(window.console,o)}}},{key:"clearLog",value:function(){r.default.one(".vc-log",this.$tabbox).innerHTML="",this.logNumber=0,g={}}},{key:"printOriginLog",value:function(e){"function"==typeof this.console[e.logType]&&this.console[e.logType].apply(window.console,e.logs)}},{key:"printLog",value:function(e){var t=e.logs||[];if(t.length||e.content){t=[].slice.call(t||[]);var o=/^\[(\w+)\]$/i,r="",i=!1;if(n.isString(t[0])){var a=t[0].match(o);null!==a&&a.length>0&&(r=a[1].toLowerCase(),i=h.indexOf(r)>-1)}if(r===this.id||!0!==i&&"default"===this.id)if(e._id||(e._id="__vc_"+Math.random().toString(36).substring(2,8)),e.date||(e.date=+new Date),this.isReady){n.isString(t[0])&&i&&(t[0]=t[0].replace(o,""),""===t[0]&&t.shift());for(var l={_id:e._id,logType:e.logType,logText:[],hasContent:!!e.content,count:1},c=0;c<t.length;c++)n.isFunction(t[c])?l.logText.push(t[c].toString()):n.isObject(t[c])||n.isArray(t[c])?l.logText.push(n.JSONStringify(t[c])):l.logText.push(t[c]);l.logText=l.logText.join(" "),l.hasContent||g.logType!==l.logType||g.logText!==l.logText?(this.printNewLog(e,t),g=l):this.printRepeatLog(),this.isInBottom&&this.autoScrollToBottom(),e.noOrigin||this.printOriginLog(e)}else this.logList.push(e);else e.noOrigin||this.printOriginLog(e)}}},{key:"printRepeatLog",value:function(){var e=r.default.one("#"+g._id),t=r.default.one(".vc-item-repeat",e);t||((t=document.createElement("i")).className="vc-item-repeat",e.insertBefore(t,e.lastChild)),g.count,g.count++,t.innerHTML=g.count}},{key:"printNewLog",value:function(e,t){for(var o=r.default.render(a.default,{_id:e._id,logType:e.logType,style:e.style||""}),i=r.default.one(".vc-item-content",o),l=0;l<t.length;l++){var c=void 0;try{if(""===t[l])continue;c=n.isFunction(t[l])?"<span> "+t[l].toString()+"</span>":n.isObject(t[l])||n.isArray(t[l])?this.getFoldedLine(t[l]):"<span> "+n.htmlEncode(t[l]).replace(/\n/g,"<br/>")+"</span>"}catch(e){c="<span> ["+d(t[l])+"]</span>"}c&&("string"==typeof c?i.insertAdjacentHTML("beforeend",c):i.insertAdjacentElement("beforeend",c))}n.isObject(e.content)&&i.insertAdjacentElement("beforeend",e.content),r.default.one(".vc-log",this.$tabbox).insertAdjacentElement("beforeend",o),this.logNumber++,this.limitMaxLogs()}},{key:"getFoldedLine",value:function(e,t){var o=this;if(!t){var i=n.JSONStringify(e),a=i.substr(0,36);t=n.getObjName(e),i.length>36&&(a+="..."),t+=" "+a}var s=r.default.render(l.default,{outer:t,lineType:"obj"});return r.default.bind(r.default.one(".vc-fold-outer",s),"click",function(t){t.preventDefault(),t.stopPropagation(),r.default.hasClass(s,"vc-toggle")?(r.default.removeClass(s,"vc-toggle"),r.default.removeClass(r.default.one(".vc-fold-inner",s),"vc-toggle"),r.default.removeClass(r.default.one(".vc-fold-outer",s),"vc-toggle")):(r.default.addClass(s,"vc-toggle"),r.default.addClass(r.default.one(".vc-fold-inner",s),"vc-toggle"),r.default.addClass(r.default.one(".vc-fold-outer",s),"vc-toggle"));var i=r.default.one(".vc-fold-inner",s);return setTimeout(function(){if(0==i.children.length&&e){for(var t=n.getObjAllKeys(e),a=0;a<t.length;a++){var s=void 0,d="undefined",u="";try{s=e[t[a]]}catch(e){continue}n.isString(s)?(d="string",s='"'+s+'"'):n.isNumber(s)?d="number":n.isBoolean(s)?d="boolean":n.isNull(s)?(d="null",s="null"):n.isUndefined(s)?(d="undefined",s="undefined"):n.isFunction(s)?(d="function",s="function()"):n.isSymbol(s)&&(d="symbol");var f=void 0;if(n.isArray(s)){var v=n.getObjName(s)+"["+s.length+"]";f=o.getFoldedLine(s,r.default.render(c.default,{key:t[a],keyType:u,value:v,valueType:"array"},!0))}else if(n.isObject(s)){var p=n.getObjName(s);f=o.getFoldedLine(s,r.default.render(c.default,{key:n.htmlEncode(t[a]),keyType:u,value:p,valueType:"object"},!0))}else{e.hasOwnProperty&&!e.hasOwnProperty(t[a])&&(u="private");var b={lineType:"kv",key:n.htmlEncode(t[a]),keyType:u,value:n.htmlEncode(s),valueType:d};f=r.default.render(l.default,b)}i.insertAdjacentElement("beforeend",f)}if(n.isObject(e)){var h,g=e.__proto__;h=n.isObject(g)?o.getFoldedLine(g,r.default.render(c.default,{key:"__proto__",keyType:"private",value:n.getObjName(g),valueType:"object"},!0)):r.default.render(c.default,{key:"__proto__",keyType:"private",value:"null",valueType:"null"}),i.insertAdjacentElement("beforeend",h)}}}),!1}),s}}])&&u(o.prototype,i),s&&u(o,s),t;var o,i,s}(i.default);m.AddedLogID=[];var y=m;o.default=y,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n,r,i;r=[t,o(7),o(8),o(2)],void 0===(i="function"==typeof(n=function(o,n,r,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,r=a(r),i=a(i),r.default.VConsolePlugin=i.default;var l=r.default;o.default=l,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n,r,i;r=[],void 0===(i="function"==typeof(n=function(){"use strict";if("undefined"==typeof Symbol){window.Symbol=function(){};var e="__symbol_iterator_key";window.Symbol.iterator=e,Array.prototype[e]=function(){var e=this,t=0;return{next:function(){return{done:e.length===t,value:e.length===t?void 0:e[t++]}}}}}})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n,r,i;r=[t,o(9),o(0),o(1),o(11),o(14),o(15),o(16),o(17),o(18),o(19),o(25),o(27),o(31),o(38)],void 0===(i="function"==typeof(n=function(o,n,r,i,a,l,c,s,d,u,f,v,p,b,h){"use strict";function g(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,n=g(n),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}(r),i=g(i),l=g(l),c=g(c),s=g(s),d=g(d),u=g(u),f=g(f),v=g(v),p=g(p),b=g(b),h=g(h);var y="#__vconsole",_=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i.default.one(y))console.debug("vConsole is already exists.");else{var o=this;if(this.version=n.default.version,this.$dom=null,this.isInited=!1,this.option={defaultPlugins:["system","network","element","storage"]},this.activedTab="",this.tabList=[],this.pluginList={},this.switchPos={x:10,y:10,startX:0,startY:0,endX:0,endY:0},this.tool=r,this.$=i.default,r.isObject(t))for(var a in t)this.option[a]=t[a];this._addBuiltInPlugins();var l,c=function(){o.isInited||(o._render(),o._mockTap(),o._bindEvent(),o._autoRun())};if(void 0!==document)"complete"==document.readyState?c():i.default.bind(window,"load",c);else l=setTimeout(function e(){document&&"complete"==document.readyState?(l&&clearTimeout(l),c()):l=setTimeout(e,1)},1)}}return t=e,(o=[{key:"_addBuiltInPlugins",value:function(){this.addPlugin(new f.default("default","Log"));var e=this.option.defaultPlugins,t={system:{proto:v.default,name:"System"},network:{proto:p.default,name:"Network"},element:{proto:b.default,name:"Element"},storage:{proto:h.default,name:"Storage"}};if(e&&r.isArray(e))for(var o=0;o<e.length;o++){var n=t[e[o]];n?this.addPlugin(new n.proto(e[o],n.name)):console.debug("Unrecognized default plugin ID:",e[o])}}},{key:"_render",value:function(){if(!i.default.one(y)){var e=document.createElement("div");e.innerHTML=l.default,document.documentElement.insertAdjacentElement("beforeend",e.children[0])}this.$dom=i.default.one(y);var t=i.default.one(".vc-switch",this.$dom),o=1*r.getStorage("switch_x"),n=1*r.getStorage("switch_y");(o||n)&&(o+t.offsetWidth>document.documentElement.offsetWidth&&(o=document.documentElement.offsetWidth-t.offsetWidth),n+t.offsetHeight>document.documentElement.offsetHeight&&(n=document.documentElement.offsetHeight-t.offsetHeight),o<0&&(o=0),n<0&&(n=0),this.switchPos.x=o,this.switchPos.y=n,i.default.one(".vc-switch").style.right=o+"px",i.default.one(".vc-switch").style.bottom=n+"px");var a=window.devicePixelRatio||1,c=document.querySelector('[name="viewport"]');if(c&&c.content){var s=c.content.match(/initial\-scale\=\d+(\.\d+)?/),d=s?parseFloat(s[0].split("=")[1]):1;d<1&&(this.$dom.style.fontSize=13*a+"px")}i.default.one(".vc-mask",this.$dom).style.display="none"}},{key:"_mockTap",value:function(){var e,t,o,n=!1,r=null;this.$dom.addEventListener("touchstart",function(n){if(void 0===e){var i=n.targetTouches[0];t=i.pageX,o=i.pageY,e=n.timeStamp,r=n.target.nodeType===Node.TEXT_NODE?n.target.parentNode:n.target}},!1),this.$dom.addEventListener("touchmove",function(e){var r=e.changedTouches[0];(Math.abs(r.pageX-t)>10||Math.abs(r.pageY-o)>10)&&(n=!0)}),this.$dom.addEventListener("touchend",function(t){if(!1===n&&t.timeStamp-e<700&&null!=r){var o=r.tagName.toLowerCase(),i=!1;switch(o){case"textarea":i=!0;break;case"input":switch(r.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":i=!1;break;default:i=!r.disabled&&!r.readOnly}}i?r.focus():t.preventDefault();var a=t.changedTouches[0],l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),l.forwardedTouchEvent=!0,l.initEvent("click",!0,!0),r.dispatchEvent(l)}e=void 0,n=!1,r=null},!1)}},{key:"_bindEvent",value:function(){var e=this,t=i.default.one(".vc-switch",e.$dom);i.default.bind(t,"touchstart",function(t){e.switchPos.startX=t.touches[0].pageX,e.switchPos.startY=t.touches[0].pageY}),i.default.bind(t,"touchend",function(t){e.switchPos.x=e.switchPos.endX,e.switchPos.y=e.switchPos.endY,e.switchPos.startX=0,e.switchPos.startY=0,e.switchPos.endX=0,e.switchPos.endY=0,r.setStorage("switch_x",e.switchPos.x),r.setStorage("switch_y",e.switchPos.y)}),i.default.bind(t,"touchmove",function(o){if(o.touches.length>0){var n=o.touches[0].pageX-e.switchPos.startX,r=o.touches[0].pageY-e.switchPos.startY,i=e.switchPos.x-n,a=e.switchPos.y-r;i+t.offsetWidth>document.documentElement.offsetWidth&&(i=document.documentElement.offsetWidth-t.offsetWidth),a+t.offsetHeight>document.documentElement.offsetHeight&&(a=document.documentElement.offsetHeight-t.offsetHeight),i<0&&(i=0),a<0&&(a=0),t.style.right=i+"px",t.style.bottom=a+"px",e.switchPos.endX=i,e.switchPos.endY=a,o.preventDefault()}}),i.default.bind(i.default.one(".vc-switch",e.$dom),"click",function(){e.show()}),i.default.bind(i.default.one(".vc-hide",e.$dom),"click",function(){e.hide()}),i.default.bind(i.default.one(".vc-mask",e.$dom),"click",function(t){if(t.target!=i.default.one(".vc-mask"))return!1;e.hide()}),i.default.delegate(i.default.one(".vc-tabbar",e.$dom),"click",".vc-tab",function(t){var o=this.dataset.tab;o!=e.activedTab&&e.showTab(o)}),i.default.bind(i.default.one(".vc-panel",e.$dom),"transitionend webkitTransitionEnd oTransitionEnd otransitionend",function(t){if(t.target!=i.default.one(".vc-panel"))return!1;i.default.hasClass(e.$dom,"vc-toggle")||(t.target.style.display="none")});var o=i.default.one(".vc-content",e.$dom),n=!1;i.default.bind(o,"touchstart",function(e){var t=o.scrollTop,r=o.scrollHeight,a=t+o.offsetHeight;0===t?(o.scrollTop=1,0===o.scrollTop&&(i.default.hasClass(e.target,"vc-cmd-input")||(n=!0))):a===r&&(o.scrollTop=t-1,o.scrollTop===t&&(i.default.hasClass(e.target,"vc-cmd-input")||(n=!0)))}),i.default.bind(o,"touchmove",function(e){n&&e.preventDefault()}),i.default.bind(o,"touchend",function(e){n=!1})}},{key:"_autoRun",value:function(){for(var e in this.isInited=!0,this.pluginList)this._initPlugin(this.pluginList[e]);this.tabList.length>0&&this.showTab(this.tabList[0]),this.triggerEvent("ready")}},{key:"triggerEvent",value:function(e,t){e="on"+e.charAt(0).toUpperCase()+e.slice(1),r.isFunction(this.option[e])&&this.option[e].apply(this,t)}},{key:"_initPlugin",value:function(e){var t=this;e.vConsole=this,e.trigger("init"),e.trigger("renderTab",function(o){t.tabList.push(e.id);var n=i.default.render(c.default,{id:e.id,name:e.name});i.default.one(".vc-tabbar",t.$dom).insertAdjacentElement("beforeend",n);var a=i.default.render(s.default,{id:e.id});o&&(r.isString(o)?a.innerHTML+=o:r.isFunction(o.appendTo)?o.appendTo(a):r.isElement(o)&&a.insertAdjacentElement("beforeend",o)),i.default.one(".vc-content",t.$dom).insertAdjacentElement("beforeend",a)}),e.trigger("addTopBar",function(o){if(o)for(var n=i.default.one(".vc-topbar",t.$dom),a=function(t){var a=o[t],l=i.default.render(d.default,{name:a.name||"Undefined",className:a.className||"",pluginID:e.id});if(a.data)for(var c in a.data)l.dataset[c]=a.data[c];r.isFunction(a.onClick)&&i.default.bind(l,"click",function(t){var o=a.onClick.call(l);!1===o||(i.default.removeClass(i.default.all(".vc-topbar-"+e.id),"vc-actived"),i.default.addClass(l,"vc-actived"))}),n.insertAdjacentElement("beforeend",l)},l=0;l<o.length;l++)a(l)}),e.trigger("addTool",function(o){if(o)for(var n=i.default.one(".vc-tool-last",t.$dom),a=function(t){var a=o[t],l=i.default.render(u.default,{name:a.name||"Undefined",pluginID:e.id});1==a.global&&i.default.addClass(l,"vc-global-tool"),r.isFunction(a.onClick)&&i.default.bind(l,"click",function(e){a.onClick.call(l)}),n.parentNode.insertBefore(l,n)},l=0;l<o.length;l++)a(l)}),e.isReady=!0,e.trigger("ready")}},{key:"_triggerPluginsEvent",value:function(e){for(var t in this.pluginList)this.pluginList[t].isReady&&this.pluginList[t].trigger(e)}},{key:"_triggerPluginEvent",value:function(e,t){var o=this.pluginList[e];o&&o.isReady&&o.trigger(t)}},{key:"addPlugin",value:function(e){return void 0!==this.pluginList[e.id]?(console.debug("Plugin "+e.id+" has already been added."),!1):(this.pluginList[e.id]=e,this.isInited&&(this._initPlugin(e),1==this.tabList.length&&this.showTab(this.tabList[0])),!0)}},{key:"removePlugin",value:function(e){e=(e+"").toLowerCase();var t=this.pluginList[e];if(void 0===t)return console.debug("Plugin "+e+" does not exist."),!1;if(t.trigger("remove"),this.isInited){var o=i.default.one("#__vc_tab_"+e);o&&o.parentNode.removeChild(o);for(var n=i.default.all(".vc-topbar-"+e,this.$dom),r=0;r<n.length;r++)n[r].parentNode.removeChild(n[r]);var a=i.default.one("#__vc_log_"+e);a&&a.parentNode.removeChild(a);for(var l=i.default.all(".vc-tool-"+e,this.$dom),c=0;c<l.length;c++)l[c].parentNode.removeChild(l[c])}var s=this.tabList.indexOf(e);s>-1&&this.tabList.splice(s,1);try{delete this.pluginList[e]}catch(t){this.pluginList[e]=void 0}return this.activedTab==e&&this.tabList.length>0&&this.showTab(this.tabList[0]),!0}},{key:"show",value:function(){if(this.isInited){var e=this,t=i.default.one(".vc-panel",this.$dom);t.style.display="block",setTimeout(function(){i.default.addClass(e.$dom,"vc-toggle"),e._triggerPluginsEvent("showConsole");var t=i.default.one(".vc-mask",e.$dom);t.style.display="block"},10)}}},{key:"hide",value:function(){if(this.isInited){i.default.removeClass(this.$dom,"vc-toggle"),this._triggerPluginsEvent("hideConsole");var e=i.default.one(".vc-mask",this.$dom),t=i.default.one(".vc-panel",this.$dom);i.default.bind(e,"transitionend",function(o){e.style.display="none",t.style.display="none"})}}},{key:"showSwitch",value:function(){if(this.isInited){var e=i.default.one(".vc-switch",this.$dom);e.style.display="block"}}},{key:"hideSwitch",value:function(){if(this.isInited){var e=i.default.one(".vc-switch",this.$dom);e.style.display="none"}}},{key:"showTab",value:function(e){if(this.isInited){var t=i.default.one("#__vc_log_"+e);i.default.removeClass(i.default.all(".vc-tab",this.$dom),"vc-actived"),i.default.addClass(i.default.one("#__vc_tab_"+e),"vc-actived"),i.default.removeClass(i.default.all(".vc-logbox",this.$dom),"vc-actived"),i.default.addClass(t,"vc-actived");var o=i.default.all(".vc-topbar-"+e,this.$dom);i.default.removeClass(i.default.all(".vc-toptab",this.$dom),"vc-toggle"),i.default.addClass(o,"vc-toggle"),o.length>0?i.default.addClass(i.default.one(".vc-content",this.$dom),"vc-has-topbar"):i.default.removeClass(i.default.one(".vc-content",this.$dom),"vc-has-topbar"),i.default.removeClass(i.default.all(".vc-tool",this.$dom),"vc-toggle"),i.default.addClass(i.default.all(".vc-tool-"+e,this.$dom),"vc-toggle"),this.activedTab&&this._triggerPluginEvent(this.activedTab,"hide"),this.activedTab=e,this._triggerPluginEvent(this.activedTab,"show")}}},{key:"setOption",value:function(e,t){if(r.isString(e))this.option[e]=t,this._triggerPluginsEvent("updateOption");else if(r.isObject(e)){for(var o in e)this.option[o]=e[o];this._triggerPluginsEvent("updateOption")}else console.debug("The first parameter of vConsole.setOption() must be a string or an object.")}},{key:"destroy",value:function(){if(this.isInited){for(var e=Object.keys(this.pluginList),t=e.length-1;t>=0;t--)this.removePlugin(e[t]);this.$dom.parentNode.removeChild(this.$dom)}}}])&&m(t.prototype,o),a&&m(t,a),e;var t,o,a}();o.default=_,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e){e.exports={name:"vconsole",version:"3.3.0",description:"A lightweight, extendable front-end developer tool for mobile web page.",homepage:"https://github.com/Tencent/vConsole",main:"dist/vconsole.min.js",scripts:{test:"mocha",dist:"webpack"},keywords:["console","debug","mobile"],repository:{type:"git",url:"git+https://github.com/Tencent/vConsole.git"},dependencies:{},devDependencies:{"@babel/core":"^7.2.2","@babel/plugin-proposal-class-properties":"^7.3.0","@babel/plugin-proposal-export-namespace-from":"^7.2.0","@babel/plugin-proposal-object-rest-spread":"^7.3.1","@babel/preset-env":"^7.3.1","babel-loader":"^8.0.4","babel-plugin-add-module-exports":"^1.0.0",chai:"^4.2.0","css-loader":"^2.1.0","html-loader":"^0.5.5",jsdom:"^13.2.0","json-loader":"^0.5.7",less:"^3.9.0","less-loader":"^4.1.0",mocha:"^5.2.0","style-loader":"^0.23.1",webpack:"^4.29.0","webpack-cli":"^3.2.1"},author:"Tencent",license:"MIT"}},function(e,t,o){var n,r,i;r=[t],void 0===(i="function"==typeof(n=function(o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,t,o){var n=/\{\{([^\}]+)\}\}/g,r="",i="",a=0,l=[],c=function(e,t){""!==e&&(t?e.match(/^ ?else/g)?r+="} "+e+" {\n":e.match(/\/(if|for|switch)/g)?r+="}\n":e.match(/^ ?if|for|switch/g)?r+=e+" {\n":e.match(/^ ?(break|continue) ?$/g)?r+=e+";\n":e.match(/^ ?(case|default)/g)?r+=e+":\n":r+="arr.push("+e+");\n":r+='arr.push("'+e.replace(/"/g,'\\"')+'");\n')};for(window.__mito_data=t,window.__mito_code="",window.__mito_result="",e=(e=e.replace(/(\{\{ ?switch(.+?)\}\})[\r\n\t ]+\{\{/g,"$1{{")).replace(/^[\r\n]/,"").replace(/\n/g,"\\\n").replace(/\r/g,"\\\r"),i="(function(){\n",r="var arr = [];\n";l=n.exec(e);)c(e.slice(a,l.index),!1),c(l[1],!0),a=l.index+l[0].length;c(e.substr(a,e.length-a),!1),i+=r="with (__mito_data) {\n"+(r+='__mito_result = arr.join("");')+"\n}",i+="})();";var s=document.getElementsByTagName("script"),d="";s.length>0&&(d=s[0].nonce||"");var u=document.createElement("SCRIPT");u.innerHTML=i,u.setAttribute("nonce",d),document.documentElement.appendChild(u);var f=__mito_result;if(document.documentElement.removeChild(u),!o){var v=document.createElement("DIV");v.innerHTML=f,f=v.children[0]}return f},e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n=o(12);"string"==typeof n&&(n=[[e.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};o(4)(n,r);n.locals&&(e.exports=n.locals)},function(e,t,o){(e.exports=o(3)(!1)).push([e.i,'#__vconsole {\n  color: #000;\n  font-size: 13px;\n  font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\n  /* global */\n  /* compoment */\n}\n#__vconsole .vc-max-height {\n  max-height: 19.23076923em;\n}\n#__vconsole .vc-max-height-line {\n  max-height: 3.38461538em;\n}\n#__vconsole .vc-min-height {\n  min-height: 3.07692308em;\n}\n#__vconsole dd,\n#__vconsole dl,\n#__vconsole pre {\n  margin: 0;\n}\n#__vconsole .vc-switch {\n  display: block;\n  position: fixed;\n  right: 0.76923077em;\n  bottom: 0.76923077em;\n  color: #FFF;\n  background-color: #04BE02;\n  line-height: 1;\n  font-size: 1.07692308em;\n  padding: 0.61538462em 1.23076923em;\n  z-index: 10000;\n  border-radius: 0.30769231em;\n  box-shadow: 0 0 0.61538462em rgba(0, 0, 0, 0.4);\n}\n#__vconsole .vc-mask {\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0);\n  z-index: 10001;\n  transition: background 0.3s;\n  -webkit-tap-highlight-color: transparent;\n  overflow-y: scroll;\n}\n#__vconsole .vc-panel {\n  display: none;\n  position: fixed;\n  min-height: 85%;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 10002;\n  background-color: #EFEFF4;\n  -webkit-transition: -webkit-transform 0.3s;\n  transition: -webkit-transform 0.3s;\n  transition: transform 0.3s;\n  transition: transform 0.3s, -webkit-transform 0.3s;\n  -webkit-transform: translate(0, 100%);\n  transform: translate(0, 100%);\n}\n#__vconsole .vc-tabbar {\n  border-bottom: 1px solid #D9D9D9;\n  overflow-x: auto;\n  height: 3em;\n  width: auto;\n  white-space: nowrap;\n}\n#__vconsole .vc-tabbar .vc-tab {\n  display: inline-block;\n  line-height: 3em;\n  padding: 0 1.15384615em;\n  border-right: 1px solid #D9D9D9;\n  text-decoration: none;\n  color: #000;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n}\n#__vconsole .vc-tabbar .vc-tab:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n#__vconsole .vc-tabbar .vc-tab.vc-actived {\n  background-color: #FFF;\n}\n#__vconsole .vc-content {\n  background-color: #FFF;\n  overflow-x: hidden;\n  overflow-y: auto;\n  position: absolute;\n  top: 3.07692308em;\n  left: 0;\n  right: 0;\n  bottom: 3.07692308em;\n  -webkit-overflow-scrolling: touch;\n  margin-bottom: constant(safe-area-inset-bottom);\n  margin-bottom: env(safe-area-inset-bottom);\n}\n#__vconsole .vc-content.vc-has-topbar {\n  top: 5.46153846em;\n}\n#__vconsole .vc-topbar {\n  background-color: #FBF9FE;\n  display: flex;\n  display: -webkit-box;\n  flex-direction: row;\n  flex-wrap: wrap;\n  -webkit-box-direction: row;\n  -webkit-flex-wrap: wrap;\n  width: 100%;\n}\n#__vconsole .vc-topbar .vc-toptab {\n  display: none;\n  flex: 1;\n  -webkit-box-flex: 1;\n  line-height: 2.30769231em;\n  padding: 0 1.15384615em;\n  border-bottom: 1px solid #D9D9D9;\n  text-decoration: none;\n  text-align: center;\n  color: #000;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n}\n#__vconsole .vc-topbar .vc-toptab.vc-toggle {\n  display: block;\n}\n#__vconsole .vc-topbar .vc-toptab:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n#__vconsole .vc-topbar .vc-toptab.vc-actived {\n  border-bottom: 1px solid #3e82f7;\n}\n#__vconsole .vc-logbox {\n  display: none;\n  position: relative;\n  min-height: 100%;\n}\n#__vconsole .vc-logbox i {\n  font-style: normal;\n}\n#__vconsole .vc-logbox .vc-log {\n  padding-bottom: 3em;\n  -webkit-tap-highlight-color: transparent;\n}\n#__vconsole .vc-logbox .vc-log:empty:before {\n  content: "Empty";\n  color: #999;\n  position: absolute;\n  top: 45%;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  font-size: 1.15384615em;\n  text-align: center;\n}\n#__vconsole .vc-logbox .vc-item {\n  margin: 0;\n  padding: 0.46153846em 0.61538462em;\n  overflow: hidden;\n  line-height: 1.3;\n  border-bottom: 1px solid #EEE;\n  word-break: break-word;\n}\n#__vconsole .vc-logbox .vc-item-info {\n  color: #6A5ACD;\n}\n#__vconsole .vc-logbox .vc-item-debug {\n  color: #DAA520;\n}\n#__vconsole .vc-logbox .vc-item-warn {\n  color: #FFA500;\n  border-color: #FFB930;\n  background-color: #FFFACD;\n}\n#__vconsole .vc-logbox .vc-item-error {\n  color: #DC143C;\n  border-color: #F4A0AB;\n  background-color: #FFE4E1;\n}\n#__vconsole .vc-logbox .vc-log.vc-log-partly .vc-item {\n  display: none;\n}\n#__vconsole .vc-logbox .vc-log.vc-log-partly-log .vc-item-log,\n#__vconsole .vc-logbox .vc-log.vc-log-partly-info .vc-item-info,\n#__vconsole .vc-logbox .vc-log.vc-log-partly-warn .vc-item-warn,\n#__vconsole .vc-logbox .vc-log.vc-log-partly-error .vc-item-error {\n  display: block;\n}\n#__vconsole .vc-logbox .vc-item .vc-item-content {\n  margin-right: 4.61538462em;\n  display: inline-block;\n}\n#__vconsole .vc-logbox .vc-item .vc-item-repeat {\n  display: inline-block;\n  margin-right: 0.30769231em;\n  padding: 0 6.5px;\n  color: #D7E0EF;\n  background-color: #42597F;\n  border-radius: 8.66666667px;\n}\n#__vconsole .vc-logbox .vc-item.vc-item-error .vc-item-repeat {\n  color: #901818;\n  background-color: #DC2727;\n}\n#__vconsole .vc-logbox .vc-item.vc-item-warn .vc-item-repeat {\n  color: #987D20;\n  background-color: #F4BD02;\n}\n#__vconsole .vc-logbox .vc-item .vc-item-code {\n  display: block;\n  white-space: pre-wrap;\n  overflow: auto;\n  position: relative;\n}\n#__vconsole .vc-logbox .vc-item .vc-item-code.vc-item-code-input,\n#__vconsole .vc-logbox .vc-item .vc-item-code.vc-item-code-output {\n  padding-left: 0.92307692em;\n}\n#__vconsole .vc-logbox .vc-item .vc-item-code.vc-item-code-input:before,\n#__vconsole .vc-logbox .vc-item .vc-item-code.vc-item-code-output:before {\n  content: "›";\n  position: absolute;\n  top: -0.23076923em;\n  left: 0;\n  font-size: 1.23076923em;\n  color: #6A5ACD;\n}\n#__vconsole .vc-logbox .vc-item .vc-item-code.vc-item-code-output:before {\n  content: "‹";\n}\n#__vconsole .vc-logbox .vc-item .vc-fold {\n  display: block;\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-outer {\n  display: block;\n  font-style: italic;\n  padding-left: 0.76923077em;\n  position: relative;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-outer:active {\n  background-color: #E6E6E6;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-outer:before {\n  content: "";\n  position: absolute;\n  top: 0.30769231em;\n  left: 0.15384615em;\n  width: 0;\n  height: 0;\n  border: transparent solid 0.30769231em;\n  border-left-color: #000;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-outer.vc-toggle:before {\n  top: 0.46153846em;\n  left: 0;\n  border-top-color: #000;\n  border-left-color: transparent;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-inner {\n  display: none;\n  margin-left: 0.76923077em;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-inner.vc-toggle {\n  display: block;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-inner .vc-code-key {\n  margin-left: 0.76923077em;\n}\n#__vconsole .vc-logbox .vc-item .vc-fold .vc-fold-outer .vc-code-key {\n  margin-left: 0;\n}\n#__vconsole .vc-logbox .vc-code-key {\n  color: #905;\n}\n#__vconsole .vc-logbox .vc-code-private-key {\n  color: #D391B5;\n}\n#__vconsole .vc-logbox .vc-code-function {\n  color: #905;\n  font-style: italic;\n}\n#__vconsole .vc-logbox .vc-code-number,\n#__vconsole .vc-logbox .vc-code-boolean {\n  color: #0086B3;\n}\n#__vconsole .vc-logbox .vc-code-string {\n  color: #183691;\n}\n#__vconsole .vc-logbox .vc-code-null,\n#__vconsole .vc-logbox .vc-code-undefined {\n  color: #666;\n}\n#__vconsole .vc-logbox .vc-cmd {\n  position: absolute;\n  height: 3.07692308em;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  border-top: 1px solid #D9D9D9;\n  display: block!important;\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-input-wrap {\n  display: block;\n  height: 2.15384615em;\n  margin-right: 3.07692308em;\n  padding: 0.46153846em 0.61538462em;\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-input {\n  width: 100%;\n  border: none;\n  resize: none;\n  outline: none;\n  padding: 0;\n  font-size: 0.92307692em;\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-input::-webkit-input-placeholder {\n  line-height: 2.15384615em;\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-btn {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 3.07692308em;\n  border: none;\n  background-color: #EFEFF4;\n  outline: none;\n  -webkit-touch-callout: none;\n  font-size: 1em;\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-btn:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-prompted {\n  position: fixed;\n  width: 100%;\n  background-color: #FBF9FE;\n  border: 1px solid #D9D9D9;\n  overflow-x: scroll;\n  display: none;\n}\n#__vconsole .vc-logbox .vc-cmd .vc-cmd-prompted li {\n  list-style: none;\n  line-height: 30px;\n  padding: 0 0.46153846em;\n  border-bottom: 1px solid #D9D9D9;\n}\n#__vconsole .vc-logbox .vc-group .vc-group-preview {\n  -webkit-touch-callout: none;\n}\n#__vconsole .vc-logbox .vc-group .vc-group-preview:active {\n  background-color: #E6E6E6;\n}\n#__vconsole .vc-logbox .vc-group .vc-group-detail {\n  display: none;\n  padding: 0 0 0.76923077em 1.53846154em;\n  border-bottom: 1px solid #EEE;\n}\n#__vconsole .vc-logbox .vc-group.vc-actived .vc-group-detail {\n  display: block;\n  background-color: #FBF9FE;\n}\n#__vconsole .vc-logbox .vc-group.vc-actived .vc-table-row {\n  background-color: #FFF;\n}\n#__vconsole .vc-logbox .vc-group.vc-actived .vc-group-preview {\n  background-color: #FBF9FE;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-row {\n  display: flex;\n  display: -webkit-flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  -webkit-box-direction: row;\n  -webkit-flex-wrap: wrap;\n  overflow: hidden;\n  border-bottom: 1px solid #EEE;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-row.vc-left-border {\n  border-left: 1px solid #EEE;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col {\n  flex: 1;\n  -webkit-box-flex: 1;\n  padding: 0.23076923em 0.30769231em;\n  border-left: 1px solid #EEE;\n  overflow: auto;\n  white-space: pre-wrap;\n  word-break: break-word;\n  /*white-space: nowrap;\n        text-overflow: ellipsis;*/\n  -webkit-overflow-scrolling: touch;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col:first-child {\n  border: none;\n}\n#__vconsole .vc-logbox .vc-table .vc-small .vc-table-col {\n  padding: 0 0.30769231em;\n  font-size: 0.92307692em;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col-2 {\n  flex: 2;\n  -webkit-box-flex: 2;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col-3 {\n  flex: 3;\n  -webkit-box-flex: 3;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col-4 {\n  flex: 4;\n  -webkit-box-flex: 4;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col-5 {\n  flex: 5;\n  -webkit-box-flex: 5;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col-6 {\n  flex: 6;\n  -webkit-box-flex: 6;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-row-error {\n  border-color: #F4A0AB;\n  background-color: #FFE4E1;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-row-error .vc-table-col {\n  color: #DC143C;\n  border-color: #F4A0AB;\n}\n#__vconsole .vc-logbox .vc-table .vc-table-col-title {\n  font-weight: bold;\n}\n#__vconsole .vc-logbox.vc-actived {\n  display: block;\n}\n#__vconsole .vc-toolbar {\n  border-top: 1px solid #D9D9D9;\n  line-height: 3em;\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  display: -webkit-box;\n  flex-direction: row;\n  -webkit-box-direction: row;\n}\n#__vconsole .vc-toolbar .vc-tool {\n  display: none;\n  text-decoration: none;\n  color: #000;\n  width: 50%;\n  flex: 1;\n  -webkit-box-flex: 1;\n  text-align: center;\n  position: relative;\n  -webkit-touch-callout: none;\n}\n#__vconsole .vc-toolbar .vc-tool.vc-toggle,\n#__vconsole .vc-toolbar .vc-tool.vc-global-tool {\n  display: block;\n}\n#__vconsole .vc-toolbar .vc-tool:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n#__vconsole .vc-toolbar .vc-tool:after {\n  content: " ";\n  position: absolute;\n  top: 0.53846154em;\n  bottom: 0.53846154em;\n  right: 0;\n  border-left: 1px solid #D9D9D9;\n}\n#__vconsole .vc-toolbar .vc-tool-last:after {\n  border: none;\n}\n@supports (bottom: constant(safe-area-inset-bottom)) or (bottom: env(safe-area-inset-bottom)) {\n  #__vconsole .vc-toolbar,\n  #__vconsole .vc-switch {\n    bottom: constant(safe-area-inset-bottom);\n    bottom: env(safe-area-inset-bottom);\n  }\n}\n#__vconsole.vc-toggle .vc-switch {\n  display: none;\n}\n#__vconsole.vc-toggle .vc-mask {\n  background: rgba(0, 0, 0, 0.6);\n  display: block;\n}\n#__vconsole.vc-toggle .vc-panel {\n  -webkit-transform: translate(0, 0);\n  transform: translate(0, 0);\n}\n',""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var o=t.protocol+"//"+t.host,n=o+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var r,i=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(r=0===i.indexOf("//")?i:0===i.indexOf("/")?o+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(e,t){e.exports='<div id="__vconsole" class="">\n  <div class="vc-switch">vConsole</div>\n  <div class="vc-mask">\n  </div>\n  <div class="vc-panel">\n    <div class="vc-tabbar">\n    </div>\n    <div class="vc-topbar">\n    </div>\n    <div class="vc-content">\n    </div>\n    <div class="vc-toolbar">\n      <a class="vc-tool vc-global-tool vc-tool-last vc-hide">Hide</a>\n    </div>\n  </div>\n</div>'},function(e,t){e.exports='<a class="vc-tab" data-tab="{{id}}" id="__vc_tab_{{id}}">{{name}}</a>'},function(e,t){e.exports='<div class="vc-logbox" id="__vc_log_{{id}}">\n  \n</div>'},function(e,t){e.exports='<a class="vc-toptab vc-topbar-{{pluginID}}{{if (className)}} {{className}}{{/if}}">{{name}}</a>'},function(e,t){e.exports='<a class="vc-tool vc-tool-{{pluginID}}">{{name}}</a>'},function(module,exports,__nested_webpack_require_52572__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;factory=function(_exports,_query,tool,_log,_tabbox_default,_item_code){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=_superPropBase(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_query=_interopRequireDefault(_query),tool=_interopRequireWildcard(tool),_log=_interopRequireDefault(_log),_tabbox_default=_interopRequireDefault(_tabbox_default),_item_code=_interopRequireDefault(_item_code);var VConsoleDefaultTab=function(_VConsoleLogTab){function VConsoleDefaultTab(){var e,t;_classCallCheck(this,VConsoleDefaultTab);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(t=_possibleConstructorReturn(this,(e=_getPrototypeOf(VConsoleDefaultTab)).call.apply(e,[this].concat(n)))).tplTabbox=_tabbox_default.default,t}return _inherits(VConsoleDefaultTab,_VConsoleLogTab),_createClass(VConsoleDefaultTab,[{key:"onReady",value:function onReady(){var that=this;_get(_getPrototypeOf(VConsoleDefaultTab.prototype),"onReady",this).call(this),window.winKeys=Object.getOwnPropertyNames(window).sort(),window.keyTypes={};for(var i=0;i<winKeys.length;i++)keyTypes[winKeys[i]]=_typeof(window[winKeys[i]]);var cacheObj={},ID_REGEX=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/,retrievePrecedingIdentifier=function(e,t,o){o=o||ID_REGEX;for(var n=[],r=t-1;r>=0&&o.test(e[r]);r--)n.push(e[r]);if(0==n.length){o=/\./;for(var i=t-1;i>=0&&o.test(e[i]);i--)n.push(e[i])}if(0===n.length){var a=e.match(/[\(\)\[\]\{\}]/gi)||[];return a[a.length-1]}return n.reverse().join("")};_query.default.bind(_query.default.one(".vc-cmd-input"),"keyup",function(e){var isDeleteKeyCode=8===e.keyCode||46===e.keyCode,$prompted=_query.default.one(".vc-cmd-prompted");$prompted.style.display="none",$prompted.innerHTML="";var tempValue=this.value,value=retrievePrecedingIdentifier(this.value,this.value.length);if(value&&value.length>0){if(/\(/.test(value)&&!isDeleteKeyCode)return void(_query.default.one(".vc-cmd-input").value+=")");if(/\[/.test(value)&&!isDeleteKeyCode)return void(_query.default.one(".vc-cmd-input").value+="]");if(/\{/.test(value)&&!isDeleteKeyCode)return void(_query.default.one(".vc-cmd-input").value+="}");if("."===value){var key=retrievePrecedingIdentifier(tempValue,tempValue.length-1);if(!cacheObj[key])try{cacheObj[key]=Object.getOwnPropertyNames(eval("("+key+")")).sort()}catch(e){}try{for(var _i3=0;_i3<cacheObj[key].length;_i3++){var $li=document.createElement("li"),_key=cacheObj[key][_i3];$li.innerHTML=_key,$li.onclick=function(){_query.default.one(".vc-cmd-input").value="",_query.default.one(".vc-cmd-input").value=tempValue+this.innerHTML,$prompted.style.display="none"},$prompted.appendChild($li)}}catch(e){}}else if("."!==value.substring(value.length-1)&&value.indexOf(".")<0){for(var _i4=0;_i4<winKeys.length;_i4++)if(winKeys[_i4].toLowerCase().indexOf(value.toLowerCase())>=0){var _$li=document.createElement("li");_$li.innerHTML=winKeys[_i4],_$li.onclick=function(){_query.default.one(".vc-cmd-input").value="",_query.default.one(".vc-cmd-input").value=this.innerHTML,"function"==keyTypes[this.innerHTML]&&(_query.default.one(".vc-cmd-input").value+="()"),$prompted.style.display="none"},$prompted.appendChild(_$li)}}else{var arr=value.split(".");if(cacheObj[arr[0]]){cacheObj[arr[0]].sort();for(var _i5=0;_i5<cacheObj[arr[0]].length;_i5++){var _$li2=document.createElement("li"),_key3=cacheObj[arr[0]][_i5];_key3.indexOf(arr[1])>=0&&(_$li2.innerHTML=_key3,_$li2.onclick=function(){_query.default.one(".vc-cmd-input").value="",_query.default.one(".vc-cmd-input").value=tempValue+this.innerHTML,$prompted.style.display="none"},$prompted.appendChild(_$li2))}}}if($prompted.children.length>0){var m=Math.min(200,31*$prompted.children.length);$prompted.style.display="block",$prompted.style.height=m+"px",$prompted.style.marginTop=-m+"px"}}else $prompted.style.display="none"}),_query.default.bind(_query.default.one(".vc-cmd",this.$tabbox),"submit",function(e){e.preventDefault();var t=_query.default.one(".vc-cmd-input",e.target),o=t.value;t.value="",""!==o&&that.evalCommand(o);var n=_query.default.one(".vc-cmd-prompted");n&&(n.style.display="none")});var code="";code+="if (!!window) {",code+="window.__vConsole_cmd_result = undefined;",code+="window.__vConsole_cmd_error = false;",code+="}";var scriptList=document.getElementsByTagName("script"),nonce="";scriptList.length>0&&(nonce=scriptList[0].nonce||"");var script=document.createElement("SCRIPT");script.innerHTML=code,script.setAttribute("nonce",nonce),document.documentElement.appendChild(script),document.documentElement.removeChild(script)}},{key:"mockConsole",value:function(){_get(_getPrototypeOf(VConsoleDefaultTab.prototype),"mockConsole",this).call(this);var e=this;tool.isFunction(window.onerror)&&(this.windowOnError=window.onerror),window.onerror=function(t,o,n,r,i){var a=t;o&&(a+="\n"+o.replace(location.origin,"")),(n||r)&&(a+=":"+n+":"+r);var l=!!i&&!!i.stack&&i.stack.toString()||"";e.printLog({logType:"error",logs:[a,l],noOrigin:!0}),tool.isFunction(e.windowOnError)&&e.windowOnError.call(window,t,o,n,r,i)}}},{key:"evalCommand",value:function(e){this.printLog({logType:"log",content:_query.default.render(_item_code.default,{content:e,type:"input"}),style:""});var t,o=void 0;try{o=eval.call(window,"("+e+")")}catch(t){try{o=eval.call(window,e)}catch(e){}}tool.isArray(o)||tool.isObject(o)?t=this.getFoldedLine(o):(tool.isNull(o)?o="null":tool.isUndefined(o)?o="undefined":tool.isFunction(o)?o="function()":tool.isString(o)&&(o='"'+o+'"'),t=_query.default.render(_item_code.default,{content:o,type:"output"})),this.printLog({logType:"log",content:t,style:""}),window.winKeys=Object.getOwnPropertyNames(window).sort()}}]),VConsoleDefaultTab}(_log.default),_default=VConsoleDefaultTab;_exports.default=_default,module.exports=exports.default},__WEBPACK_AMD_DEFINE_ARRAY__=[exports,__nested_webpack_require_52572__(1),__nested_webpack_require_52572__(0),__nested_webpack_require_52572__(5),__nested_webpack_require_52572__(23),__nested_webpack_require_52572__(24)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t){e.exports='<div id="{{_id}}" class="vc-item vc-item-{{logType}} {{style}}">\n\t<div class="vc-item-content"></div>\n</div>'},function(e,t){e.exports='<div class="vc-fold">\n  {{if (lineType == \'obj\')}}\n    <i class="vc-fold-outer">{{outer}}</i>\n    <div class="vc-fold-inner"></div>\n  {{else if (lineType == \'value\')}}\n    <i class="vc-code-{{valueType}}">{{value}}</i>\n  {{else if (lineType == \'kv\')}}\n    <i class="vc-code-key{{if (keyType)}} vc-code-{{keyType}}-key{{/if}}">{{key}}</i>: <i class="vc-code-{{valueType}}">{{value}}</i>\n  {{/if}}\n</div>'},function(e,t){e.exports='<span>\n  <i class="vc-code-key{{if (keyType)}} vc-code-{{keyType}}-key{{/if}}">{{key}}</i>: <i class="vc-code-{{valueType}}">{{value}}</i>\n</span>'},function(e,t){e.exports='<div>\n  <div class="vc-log"></div>\n  <form class="vc-cmd">\n    <button class="vc-cmd-btn" type="submit">OK</button>\n    <ul class=\'vc-cmd-prompted\'></ul>\n    <div class="vc-cmd-input-wrap">\n      <textarea class="vc-cmd-input" placeholder="command..."></textarea>\n    </div>\n  </form>\n</div>'},function(e,t){e.exports='<pre class="vc-item-code vc-item-code-{{type}}">{{content}}</pre>'},function(e,t,o){var n,r,i;r=[t,o(5),o(26)],void 0===(i="function"==typeof(n=function(o,n,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,o){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,n=i(n),r=i(r);var f=function(e){function t(){var e,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(o=c(this,(e=d(t)).call.apply(e,[this].concat(i)))).tplTabbox=r.default,o.allowUnformattedLog=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),o=t,(n=[{key:"onInit",value:function(){s(d(t.prototype),"onInit",this).call(this),this.printSystemInfo()}},{key:"printSystemInfo",value:function(){var e=navigator.userAgent,t="",o=e.match(/(ipod).*\s([\d_]+)/i),n=e.match(/(ipad).*\s([\d_]+)/i),r=e.match(/(iphone)\sos\s([\d_]+)/i),i=e.match(/(android)\s([\d\.]+)/i);t="Unknown",i?t="Android "+i[2]:r?t="iPhone, iOS "+r[2].replace(/_/g,"."):n?t="iPad, iOS "+n[2].replace(/_/g,"."):o&&(t="iPod, iOS "+o[2].replace(/_/g,"."));var a=t,l=e.match(/MicroMessenger\/([\d\.]+)/i);t="Unknown",l&&l[1]?(t=l[1],a+=", WeChat "+t,console.info("[system]","System:",a)):console.info("[system]","System:",a),t="Unknown",t="https:"==location.protocol?"HTTPS":"http:"==location.protocol?"HTTP":location.protocol.replace(":",""),a=t;var c=e.toLowerCase().match(/ nettype\/([^ ]+)/g);t="Unknown",c&&c[0]?(c=c[0].split("/"),t=c[1],a+=", "+t,console.info("[system]","Network:",a)):console.info("[system]","Protocol:",a),console.info("[system]","UA:",e),setTimeout(function(){var e=window.performance||window.msPerformance||window.webkitPerformance;if(e&&e.timing){var t=e.timing;t.navigationStart&&console.info("[system]","navigationStart:",t.navigationStart),t.navigationStart&&t.domainLookupStart&&console.info("[system]","navigation:",t.domainLookupStart-t.navigationStart+"ms"),t.domainLookupEnd&&t.domainLookupStart&&console.info("[system]","dns:",t.domainLookupEnd-t.domainLookupStart+"ms"),t.connectEnd&&t.connectStart&&(t.connectEnd&&t.secureConnectionStart?console.info("[system]","tcp (ssl):",t.connectEnd-t.connectStart+"ms ("+(t.connectEnd-t.secureConnectionStart)+"ms)"):console.info("[system]","tcp:",t.connectEnd-t.connectStart+"ms")),t.responseStart&&t.requestStart&&console.info("[system]","request:",t.responseStart-t.requestStart+"ms"),t.responseEnd&&t.responseStart&&console.info("[system]","response:",t.responseEnd-t.responseStart+"ms"),t.domComplete&&t.domLoading&&(t.domContentLoadedEventStart&&t.domLoading?console.info("[system]","domComplete (domLoaded):",t.domComplete-t.domLoading+"ms ("+(t.domContentLoadedEventStart-t.domLoading)+"ms)"):console.info("[system]","domComplete:",t.domComplete-t.domLoading+"ms")),t.loadEventEnd&&t.loadEventStart&&console.info("[system]","loadEvent:",t.loadEventEnd-t.loadEventStart+"ms"),t.navigationStart&&t.loadEventEnd&&console.info("[system]","total (DOM):",t.loadEventEnd-t.navigationStart+"ms ("+(t.domComplete-t.navigationStart)+"ms)")}},0)}}])&&l(o.prototype,n),i&&l(o,i),t;var o,n,i}(n.default);o.default=f,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t){e.exports='<div>\n  <div class="vc-log"></div>\n</div>'},function(e,t,o){var n,r,i;r=[t,o(1),o(0),o(2),o(28),o(29),o(30)],void 0===(i="function"==typeof(n=function(o,n,r,i,a,l,c){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,n=s(n),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}(r),i=s(i),a=s(a),l=s(l),c=s(c);var b=function(e){function t(){var e,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(o=f(this,(e=v(t)).call.apply(e,[this].concat(i)))).$tabbox=n.default.render(a.default,{}),o.$header=null,o.reqList={},o.domList={},o.isReady=!1,o.isShow=!1,o.isInBottom=!0,o._open=void 0,o._send=void 0,o.mockAjax(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),o=t,(i=[{key:"onRenderTab",value:function(e){e(this.$tabbox)}},{key:"onAddTool",value:function(e){var t=this,o=[{name:"Clear",global:!1,onClick:function(e){t.clearLog()}}];e(o)}},{key:"onReady",value:function(){var e=this;e.isReady=!0,this.renderHeader(),n.default.delegate(n.default.one(".vc-log",this.$tabbox),"click",".vc-group-preview",function(t){var o=this.dataset.reqid,r=this.parentNode;n.default.hasClass(r,"vc-actived")?(n.default.removeClass(r,"vc-actived"),e.updateRequest(o,{actived:!1})):(n.default.addClass(r,"vc-actived"),e.updateRequest(o,{actived:!0})),t.preventDefault()});var t=n.default.one(".vc-content");for(var o in n.default.bind(t,"scroll",function(o){e.isShow&&(t.scrollTop+t.offsetHeight>=t.scrollHeight?e.isInBottom=!0:e.isInBottom=!1)}),e.reqList)e.updateRequest(o,{})}},{key:"onRemove",value:function(){window.XMLHttpRequest&&(window.XMLHttpRequest.prototype.open=this._open,window.XMLHttpRequest.prototype.send=this._send,this._open=void 0,this._send=void 0)}},{key:"onShow",value:function(){this.isShow=!0,1==this.isInBottom&&this.scrollToBottom()}},{key:"onHide",value:function(){this.isShow=!1}},{key:"onShowConsole",value:function(){1==this.isInBottom&&this.scrollToBottom()}},{key:"scrollToBottom",value:function(){var e=n.default.one(".vc-content");e.scrollTop=e.scrollHeight-e.offsetHeight}},{key:"clearLog",value:function(){for(var e in this.reqList={},this.domList)this.domList[e].remove(),this.domList[e]=void 0;this.domList={},this.renderHeader()}},{key:"renderHeader",value:function(){var e=Object.keys(this.reqList).length,t=n.default.render(l.default,{count:e}),o=n.default.one(".vc-log",this.$tabbox);this.$header?this.$header.parentNode.replaceChild(t,this.$header):o.parentNode.insertBefore(t,o),this.$header=t}},{key:"updateRequest",value:function(e,t){var o=Object.keys(this.reqList).length,i=this.reqList[e]||{};for(var a in t)i[a]=t[a];if(this.reqList[e]=i,this.isReady){var l={id:e,url:i.url,status:i.status,method:i.method||"-",costTime:i.costTime>0?i.costTime+"ms":"-",header:i.header||null,getData:i.getData||null,postData:i.postData||null,response:null,actived:!!i.actived};switch(i.responseType){case"":case"text":if(r.isString(i.response))try{l.response=JSON.parse(i.response),l.response=JSON.stringify(l.response,null,1),l.response=r.htmlEncode(l.response)}catch(e){l.response=r.htmlEncode(i.response)}else void 0!==i.response&&(l.response=Object.prototype.toString.call(i.response));break;case"json":void 0!==i.response&&(l.response=JSON.stringify(i.response,null,1),l.response=r.htmlEncode(l.response));break;case"blob":case"document":case"arraybuffer":default:void 0!==i.response&&(l.response=Object.prototype.toString.call(i.response))}0==i.readyState||1==i.readyState?l.status="Pending":2==i.readyState||3==i.readyState?l.status="Loading":4==i.readyState||(l.status="Unknown");var s=n.default.render(c.default,l),d=this.domList[e];i.status>=400&&n.default.addClass(n.default.one(".vc-group-preview",s),"vc-table-row-error"),d?d.parentNode.replaceChild(s,d):n.default.one(".vc-log",this.$tabbox).insertAdjacentElement("beforeend",s),this.domList[e]=s;var u=Object.keys(this.reqList).length;u!=o&&this.renderHeader(),this.isInBottom&&this.scrollToBottom()}}},{key:"mockAjax",value:function(){var e=window.XMLHttpRequest;if(e){var t=this,o=window.XMLHttpRequest.prototype.open,n=window.XMLHttpRequest.prototype.send;t._open=o,t._send=n,window.XMLHttpRequest.prototype.open=function(){var e=this,n=[].slice.call(arguments),r=n[0],i=n[1],a=t.getUniqueID(),l=null;e._requestID=a,e._method=r,e._url=i;var c=e.onreadystatechange||function(){},s=function(){var o=t.reqList[a]||{};if(o.readyState=e.readyState,o.status=0,e.readyState>1&&(o.status=e.status),o.responseType=e.responseType,0==e.readyState)o.startTime||(o.startTime=+new Date);else if(1==e.readyState)o.startTime||(o.startTime=+new Date);else if(2==e.readyState){o.header={};for(var n=e.getAllResponseHeaders()||"",r=n.split("\n"),i=0;i<r.length;i++){var s=r[i];if(s){var d=s.split(": "),u=d[0],f=d.slice(1).join(": ");o.header[u]=f}}}else 3==e.readyState||(4==e.readyState?(clearInterval(l),o.endTime=+new Date,o.costTime=o.endTime-(o.startTime||o.endTime),o.response=e.response):clearInterval(l));return e._noVConsole||t.updateRequest(a,o),c.apply(e,arguments)};e.onreadystatechange=s;var d=-1;return l=setInterval(function(){d!=e.readyState&&(d=e.readyState,s.call(e))},10),o.apply(e,n)},window.XMLHttpRequest.prototype.send=function(){var e=[].slice.call(arguments),o=e[0],i=t.reqList[this._requestID]||{};i.method=this._method.toUpperCase();var a=this._url.split("?");if(i.url=a.shift(),a.length>0){i.getData={},a=(a=a.join("?")).split("&");var l=!0,c=!1,s=void 0;try{for(var d,u=a[Symbol.iterator]();!(l=(d=u.next()).done);l=!0){var f=d.value;f=f.split("="),i.getData[f[0]]=f[1]}}catch(e){c=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(c)throw s}}}if("POST"==i.method)if(r.isString(o)){var v=o.split("&");i.postData={};var p=!0,b=!1,h=void 0;try{for(var g,m=v[Symbol.iterator]();!(p=(g=m.next()).done);p=!0){var y=g.value;y=y.split("="),i.postData[y[0]]=y[1]}}catch(e){b=!0,h=e}finally{try{p||null==m.return||m.return()}finally{if(b)throw h}}}else r.isPlainObject(o)&&(i.postData=o);return this._noVConsole||t.updateRequest(this._requestID,i),n.apply(this,e)}}}},{key:"getUniqueID",value:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)});return e}}])&&u(o.prototype,i),s&&u(o,s),t;var o,i,s}(i.default);o.default=b,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t){e.exports='<div class="vc-table">\n  <div class="vc-log"></div>\n</div>'},function(e,t){e.exports='<dl class="vc-table-row">\n  <dd class="vc-table-col vc-table-col-4">Name {{if (count > 0)}}({{count}}){{/if}}</dd>\n  <dd class="vc-table-col">Method</dd>\n  <dd class="vc-table-col">Status</dd>\n  <dd class="vc-table-col">Time</dd>\n</dl>'},function(e,t){e.exports='<div class="vc-group {{actived ? \'vc-actived\' : \'\'}}">\n  <dl class="vc-table-row vc-group-preview" data-reqid="{{id}}">\n    <dd class="vc-table-col vc-table-col-4">{{url}}</dd>\n    <dd class="vc-table-col">{{method}}</dd>\n    <dd class="vc-table-col">{{status}}</dd>\n    <dd class="vc-table-col">{{costTime}}</dd>\n  </dl>\n  <div class="vc-group-detail">\n    {{if (header !== null)}}\n    <div>\n      <dl class="vc-table-row vc-left-border">\n        <dt class="vc-table-col vc-table-col-title">Headers</dt>\n      </dl>\n      {{for (var key in header)}}\n      <div class="vc-table-row vc-left-border vc-small">\n        <div class="vc-table-col vc-table-col-2">{{key}}</div>\n        <div class="vc-table-col vc-table-col-4 vc-max-height-line">{{header[key]}}</div>\n      </div>\n      {{/for}}\n    </div>\n    {{/if}}\n    {{if (getData !== null)}}\n    <div>\n      <dl class="vc-table-row vc-left-border">\n        <dt class="vc-table-col vc-table-col-title">Query String Parameters</dt>\n      </dl>\n      {{for (var key in getData)}}\n      <div class="vc-table-row vc-left-border vc-small">\n        <div class="vc-table-col vc-table-col-2">{{key}}</div>\n        <div class="vc-table-col vc-table-col-4 vc-max-height-line">{{getData[key]}}</div>\n      </div>\n      {{/for}}\n    </div>\n    {{/if}}\n    {{if (postData !== null)}}\n    <div>\n      <dl class="vc-table-row vc-left-border">\n        <dt class="vc-table-col vc-table-col-title">Form Data</dt>\n      </dl>\n      {{for (var key in postData)}}\n      <div class="vc-table-row vc-left-border vc-small">\n        <div class="vc-table-col vc-table-col-2">{{key}}</div>\n        <div class="vc-table-col vc-table-col-4 vc-max-height-line">{{postData[key]}}</div>\n      </div>\n      {{/for}}\n    </div>\n    {{/if}}\n    <div>\n      <dl class="vc-table-row vc-left-border">\n        <dt class="vc-table-col vc-table-col-title">Response</dt>\n      </dl>\n      <div class="vc-table-row vc-left-border vc-small">\n        <pre class="vc-table-col vc-max-height vc-min-height">{{response || \'\'}}</pre>\n      </div>\n    </div>\n  </div>\n</div>'},function(e,t,o){var n,r,i;r=[t,o(32),o(2),o(34),o(35),o(0),o(1)],void 0===(i="function"==typeof(n=function(o,n,r,i,a,l,c){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,r=s(r),i=s(i),a=s(a),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}(l),c=s(c);var b=function(e){function t(){var e,o,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,l=new Array(a),s=0;s<a;s++)l[s]=arguments[s];n=this,r=(e=f(t)).call.apply(e,[this].concat(l)),o=!r||"object"!==d(r)&&"function"!=typeof r?p(n):r;var u=p(p(o));u.isInited=!1,u.node={},u.$tabbox=c.default.render(i.default,{}),u.nodes=[],u.activedElem={};var v=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return u.observer=new v(function(e){for(var t=0;t<e.length;t++){var o=e[t];u._isInVConsole(o.target)||u.onMutation(o)}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),o=t,(n=[{key:"onRenderTab",value:function(e){e(this.$tabbox)}},{key:"onAddTool",value:function(e){var t=this,o=[{name:"Expand",global:!1,onClick:function(e){if(t.activedElem)if(c.default.hasClass(t.activedElem,"vc-toggle"))for(var o=0;o<t.activedElem.childNodes.length;o++){var n=t.activedElem.childNodes[o];if(c.default.hasClass(n,"vcelm-l")&&!c.default.hasClass(n,"vcelm-noc")&&!c.default.hasClass(n,"vc-toggle")){c.default.one(".vcelm-node",n).click();break}}else c.default.one(".vcelm-node",t.activedElem).click()}},{name:"Collapse",global:!1,onClick:function(e){t.activedElem&&(c.default.hasClass(t.activedElem,"vc-toggle")?c.default.one(".vcelm-node",t.activedElem).click():t.activedElem.parentNode&&c.default.hasClass(t.activedElem.parentNode,"vcelm-l")&&c.default.one(".vcelm-node",t.activedElem.parentNode).click())}}];e(o)}},{key:"onShow",value:function(){if(!this.isInited){this.isInited=!0,this.node=this.getNode(document.documentElement);var e=this.renderView(this.node,c.default.one(".vc-log",this.$tabbox)),t=c.default.one(".vcelm-node",e);t&&t.click(),this.observer.observe(document.documentElement,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}}},{key:"onRemove",value:function(){this.observer.disconnect()}},{key:"onMutation",value:function(e){switch(e.type){case"childList":e.removedNodes.length>0&&this.onChildRemove(e),e.addedNodes.length>0&&this.onChildAdd(e);break;case"attributes":this.onAttributesChange(e);break;case"characterData":this.onCharacterDataChange(e)}}},{key:"onChildRemove",value:function(e){var t=e.target,o=t.__vconsole_node;if(o){for(var n=0;n<e.removedNodes.length;n++){var r=e.removedNodes[n],i=r.__vconsole_node;i&&i.view&&i.view.parentNode.removeChild(i.view)}this.getNode(t)}}},{key:"onChildAdd",value:function(e){var t=e.target,o=t.__vconsole_node;if(o){this.getNode(t),o.view&&c.default.removeClass(o.view,"vcelm-noc");for(var n=0;n<e.addedNodes.length;n++){var r=e.addedNodes[n],i=r.__vconsole_node;if(i)if(null!==e.nextSibling){var a=e.nextSibling.__vconsole_node;a.view&&this.renderView(i,a.view,"insertBefore")}else o.view&&(o.view.lastChild?this.renderView(i,o.view.lastChild,"insertBefore"):this.renderView(i,o.view))}}}},{key:"onAttributesChange",value:function(e){var t=e.target.__vconsole_node;t&&(t=this.getNode(e.target)).view&&this.renderView(t,t.view,!0)}},{key:"onCharacterDataChange",value:function(e){var t=e.target.__vconsole_node;t&&(t=this.getNode(e.target)).view&&this.renderView(t,t.view,!0)}},{key:"renderView",value:function(e,t,o){var n=this,r=new a.default(e).get();switch(e.view=r,c.default.delegate(r,"click",".vcelm-node",function(t){t.stopPropagation();var o=this.parentNode;if(!c.default.hasClass(o,"vcelm-noc")){n.activedElem=o,c.default.hasClass(o,"vc-toggle")?c.default.removeClass(o,"vc-toggle"):c.default.addClass(o,"vc-toggle");for(var r=-1,i=0;i<o.children.length;i++){var a=o.children[i];c.default.hasClass(a,"vcelm-l")&&(r++,a.children.length>0||(e.childNodes[r]?n.renderView(e.childNodes[r],a,"replace"):a.style.display="none"))}}}),o){case"replace":t.parentNode.replaceChild(r,t);break;case"insertBefore":t.parentNode.insertBefore(r,t);break;default:t.appendChild(r)}return r}},{key:"getNode",value:function(e){if(!this._isIgnoredElement(e)){var t=e.__vconsole_node||{};if(t.nodeType=e.nodeType,t.nodeName=e.nodeName,t.tagName=e.tagName||"",t.textContent="",t.nodeType!=e.TEXT_NODE&&t.nodeType!=e.DOCUMENT_TYPE_NODE||(t.textContent=e.textContent),t.id=e.id||"",t.className=e.className||"",t.attributes=[],e.hasAttributes&&e.hasAttributes())for(var o=0;o<e.attributes.length;o++)t.attributes.push({name:e.attributes[o].name,value:e.attributes[o].value||""});if(t.childNodes=[],e.childNodes.length>0)for(var n=0;n<e.childNodes.length;n++){var r=this.getNode(e.childNodes[n]);r&&t.childNodes.push(r)}return e.__vconsole_node=t,t}}},{key:"_isIgnoredElement",value:function(e){return e.nodeType==e.TEXT_NODE&&""==e.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$|\n+/g,"")}},{key:"_isInVConsole",value:function(e){for(var t=e;null!=t;){if("__vconsole"==t.id)return!0;t=t.parentNode||void 0}return!1}}])&&u(o.prototype,n),r&&u(o,r),t;var o,n,r}(r.default);o.default=b,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t,o){var n=o(33);"string"==typeof n&&(n=[[e.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};o(4)(n,r);n.locals&&(e.exports=n.locals)},function(e,t,o){(e.exports=o(3)(!1)).push([e.i,'/* color */\n.vcelm-node {\n  color: #183691;\n}\n.vcelm-k {\n  color: #0086B3;\n}\n.vcelm-v {\n  color: #905;\n}\n/* layout */\n.vcelm-l {\n  padding-left: 8px;\n  position: relative;\n  word-wrap: break-word;\n  line-height: 1;\n}\n/*.vcelm-l.vcelm-noc {\n  padding-left: 0;\n}*/\n.vcelm-l.vc-toggle > .vcelm-node {\n  display: block;\n}\n.vcelm-l .vcelm-node:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n.vcelm-l.vcelm-noc .vcelm-node:active {\n  background-color: transparent;\n}\n.vcelm-t {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n/* level */\n.vcelm-l .vcelm-l {\n  display: none;\n}\n.vcelm-l.vc-toggle > .vcelm-l {\n  margin-left: 4px;\n  display: block;\n}\n/* arrow */\n.vcelm-l:before {\n  content: "";\n  display: block;\n  position: absolute;\n  top: 6px;\n  left: 3px;\n  width: 0;\n  height: 0;\n  border: transparent solid 3px;\n  border-left-color: #000;\n}\n.vcelm-l.vc-toggle:before {\n  display: block;\n  top: 6px;\n  left: 0;\n  border-top-color: #000;\n  border-left-color: transparent;\n}\n.vcelm-l.vcelm-noc:before {\n  display: none;\n}\n',""])},function(e,t){e.exports='<div>\n  <div class="vc-log"></div>\n</div>'},function(e,t,o){var n,r,i;r=[t,o(36),o(37),o(0),o(1)],void 0===(i="function"==typeof(n=function(o,n,r,i,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,n=l(n),r=l(r),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}(i),a=l(a);var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.node=t,this.view=this._create(this.node)}return t=e,(o=[{key:"get",value:function(){return this.view}},{key:"_create",value:function(e,t){var o=document.createElement("DIV");switch(a.default.addClass(o,"vcelm-l"),e.nodeType){case o.ELEMENT_NODE:this._createElementNode(e,o);break;case o.TEXT_NODE:this._createTextNode(e,o);break;case o.COMMENT_NODE:case o.DOCUMENT_NODE:case o.DOCUMENT_TYPE_NODE:case o.DOCUMENT_FRAGMENT_NODE:}return o}},{key:"_createTextNode",value:function(e,t){a.default.addClass(t,"vcelm-t vcelm-noc"),e.textContent&&t.appendChild(function(e){return document.createTextNode(e)}(e.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")))}},{key:"_createElementNode",value:function(e,t){var o,i=(o=(o=e.tagName)?o.toLowerCase():"",["br","hr","img","input","link","meta"].indexOf(o)>-1),l=i;0==e.childNodes.length&&(l=!0);var c=a.default.render(n.default,{node:e}),s=a.default.render(r.default,{node:e});if(l)a.default.addClass(t,"vcelm-noc"),t.appendChild(c),i||t.appendChild(s);else{t.appendChild(c);for(var d=0;d<e.childNodes.length;d++){var u=document.createElement("DIV");a.default.addClass(u,"vcelm-l"),t.appendChild(u)}i||t.appendChild(s)}}}])&&c(t.prototype,o),i&&c(t,i),e;var t,o,i}();o.default=s,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t){e.exports='<span class="vcelm-node">&lt;{{node.tagName.toLowerCase()}}{{if (node.className || node.attributes.length)}}\n  <i class="vcelm-k">\n    {{for (var i = 0; i < node.attributes.length; i++)}}\n      {{if (node.attributes[i].value !== \'\')}}\n        {{node.attributes[i].name}}="<i class="vcelm-v">{{node.attributes[i].value}}</i>"{{else}}\n        {{node.attributes[i].name}}{{/if}}{{/for}}</i>{{/if}}&gt;</span>'},function(e,t){e.exports='<span class="vcelm-node">&lt;/{{node.tagName.toLowerCase()}}&gt;</span>'},function(e,t,o){var n,r,i;r=[t,o(2),o(39),o(40),o(0),o(1)],void 0===(i="function"==typeof(n=function(o,n,r,i,a,l){"use strict";function c(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,n=c(n),r=c(r),i=c(i),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};n.get||n.set?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,t}(a),l=c(l);var p=function(e){function t(){var e,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(o=u(this,(e=f(t)).call.apply(e,[this].concat(i)))).$tabbox=l.default.render(r.default,{}),o.currentType="",o.typeNameMap={cookies:"Cookies",localstorage:"LocalStorage",sessionstorage:"SessionStorage"},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),o=t,(n=[{key:"onRenderTab",value:function(e){e(this.$tabbox)}},{key:"onAddTopBar",value:function(e){for(var t=this,o=["Cookies","LocalStorage","SessionStorage"],n=[],r=0;r<o.length;r++)n.push({name:o[r],data:{type:o[r].toLowerCase()},className:"",onClick:function(){if(l.default.hasClass(this,"vc-actived"))return!1;t.currentType=this.dataset.type,t.renderStorage()}});n[0].className="vc-actived",e(n)}},{key:"onAddTool",value:function(e){var t=this,o=[{name:"Refresh",global:!1,onClick:function(e){t.renderStorage()}},{name:"Clear",global:!1,onClick:function(e){t.clearLog()}}];e(o)}},{key:"onReady",value:function(){}},{key:"onShow",value:function(){""==this.currentType&&(this.currentType="cookies",this.renderStorage())}},{key:"clearLog",value:function(){if(this.currentType&&window.confirm){var e=window.confirm("Remove all "+this.typeNameMap[this.currentType]+"?");if(!e)return!1}switch(this.currentType){case"cookies":this.clearCookieList();break;case"localstorage":this.clearLocalStorageList();break;case"sessionstorage":this.clearSessionStorageList();break;default:return!1}this.renderStorage()}},{key:"renderStorage",value:function(){var e=[];switch(this.currentType){case"cookies":e=this.getCookieList();break;case"localstorage":e=this.getLocalStorageList();break;case"sessionstorage":e=this.getSessionStorageList();break;default:return!1}var t=l.default.one(".vc-log",this.$tabbox);if(0==e.length)t.innerHTML="";else{for(var o=0;o<e.length;o++)e[o].name=a.htmlEncode(e[o].name),e[o].value=a.htmlEncode(e[o].value);t.innerHTML=l.default.render(i.default,{list:e},!0)}}},{key:"getCookieList",value:function(){if(!document.cookie||!navigator.cookieEnabled)return[];for(var e=[],t=document.cookie.split(";"),o=0;o<t.length;o++){var n=t[o].split("="),r=n.shift().replace(/^ /,""),i=n.join("=");try{r=decodeURIComponent(r),i=decodeURIComponent(i)}catch(e){console.log(e,r,i)}e.push({name:r,value:i})}return e}},{key:"getLocalStorageList",value:function(){if(!window.localStorage)return[];try{for(var e=[],t=0;t<localStorage.length;t++){var o=localStorage.key(t),n=localStorage.getItem(o);e.push({name:o,value:n})}return e}catch(e){return[]}}},{key:"getSessionStorageList",value:function(){if(!window.sessionStorage)return[];try{for(var e=[],t=0;t<sessionStorage.length;t++){var o=sessionStorage.key(t),n=sessionStorage.getItem(o);e.push({name:o,value:n})}return e}catch(e){return[]}}},{key:"clearCookieList",value:function(){if(document.cookie&&navigator.cookieEnabled){for(var e=this.getCookieList(),t=0;t<e.length;t++)document.cookie=e[t].name+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT";this.renderStorage()}}},{key:"clearLocalStorageList",value:function(){if(window.localStorage)try{localStorage.clear(),this.renderStorage()}catch(e){alert("localStorage.clear() fail.")}}},{key:"clearSessionStorageList",value:function(){if(window.sessionStorage)try{sessionStorage.clear(),this.renderStorage()}catch(e){alert("sessionStorage.clear() fail.")}}}])&&d(o.prototype,n),c&&d(o,c),t;var o,n,c}(n.default);o.default=p,e.exports=t.default})?n.apply(t,r):n)||(e.exports=i)},function(e,t){e.exports='<div class="vc-table">\n  <div class="vc-log"></div>\n</div>'},function(e,t){e.exports='<div>\n  <dl class="vc-table-row">\n    <dd class="vc-table-col">Name</dd>\n    <dd class="vc-table-col vc-table-col-2">Value</dd>\n  </dl>\n  {{for (var i = 0; i < list.length; i++)}}\n  <dl class="vc-table-row">\n    <dd class="vc-table-col">{{list[i].name}}</dd>\n    <dd class="vc-table-col vc-table-col-2">{{list[i].value}}</dd>\n  </dl>\n  {{/for}}\n</div>'}])});

/***/ }),

/***/ "./node_modules/animejs/lib/anime.es.js":
/*!**********************************************!*\
  !*** ./node_modules/animejs/lib/anime.es.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/*
 * anime.js v3.2.1
 * (c) 2020 Julian Garnier
 * Released under the MIT license
 * animejs.com
 */

// Defaults

var defaultInstanceSettings = {
  update: null,
  begin: null,
  loopBegin: null,
  changeBegin: null,
  change: null,
  changeComplete: null,
  loopComplete: null,
  complete: null,
  loop: 1,
  direction: 'normal',
  autoplay: true,
  timelineOffset: 0
};

var defaultTweenSettings = {
  duration: 1000,
  delay: 0,
  endDelay: 0,
  easing: 'easeOutElastic(1, .5)',
  round: 0
};

var validTransforms = ['translateX', 'translateY', 'translateZ', 'rotate', 'rotateX', 'rotateY', 'rotateZ', 'scale', 'scaleX', 'scaleY', 'scaleZ', 'skew', 'skewX', 'skewY', 'perspective', 'matrix', 'matrix3d'];

// Caching

var cache = {
  CSS: {},
  springs: {}
};

// Utils

function minMax(val, min, max) {
  return Math.min(Math.max(val, min), max);
}

function stringContains(str, text) {
  return str.indexOf(text) > -1;
}

function applyArguments(func, args) {
  return func.apply(null, args);
}

var is = {
  arr: function (a) { return Array.isArray(a); },
  obj: function (a) { return stringContains(Object.prototype.toString.call(a), 'Object'); },
  pth: function (a) { return is.obj(a) && a.hasOwnProperty('totalLength'); },
  svg: function (a) { return a instanceof SVGElement; },
  inp: function (a) { return a instanceof HTMLInputElement; },
  dom: function (a) { return a.nodeType || is.svg(a); },
  str: function (a) { return typeof a === 'string'; },
  fnc: function (a) { return typeof a === 'function'; },
  und: function (a) { return typeof a === 'undefined'; },
  nil: function (a) { return is.und(a) || a === null; },
  hex: function (a) { return /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a); },
  rgb: function (a) { return /^rgb/.test(a); },
  hsl: function (a) { return /^hsl/.test(a); },
  col: function (a) { return (is.hex(a) || is.rgb(a) || is.hsl(a)); },
  key: function (a) { return !defaultInstanceSettings.hasOwnProperty(a) && !defaultTweenSettings.hasOwnProperty(a) && a !== 'targets' && a !== 'keyframes'; },
};

// Easings

function parseEasingParameters(string) {
  var match = /\(([^)]+)\)/.exec(string);
  return match ? match[1].split(',').map(function (p) { return parseFloat(p); }) : [];
}

// Spring solver inspired by Webkit Copyright © 2016 Apple Inc. All rights reserved. https://webkit.org/demos/spring/spring.js

function spring(string, duration) {

  var params = parseEasingParameters(string);
  var mass = minMax(is.und(params[0]) ? 1 : params[0], .1, 100);
  var stiffness = minMax(is.und(params[1]) ? 100 : params[1], .1, 100);
  var damping = minMax(is.und(params[2]) ? 10 : params[2], .1, 100);
  var velocity =  minMax(is.und(params[3]) ? 0 : params[3], .1, 100);
  var w0 = Math.sqrt(stiffness / mass);
  var zeta = damping / (2 * Math.sqrt(stiffness * mass));
  var wd = zeta < 1 ? w0 * Math.sqrt(1 - zeta * zeta) : 0;
  var a = 1;
  var b = zeta < 1 ? (zeta * w0 + -velocity) / wd : -velocity + w0;

  function solver(t) {
    var progress = duration ? (duration * t) / 1000 : t;
    if (zeta < 1) {
      progress = Math.exp(-progress * zeta * w0) * (a * Math.cos(wd * progress) + b * Math.sin(wd * progress));
    } else {
      progress = (a + b * progress) * Math.exp(-progress * w0);
    }
    if (t === 0 || t === 1) { return t; }
    return 1 - progress;
  }

  function getDuration() {
    var cached = cache.springs[string];
    if (cached) { return cached; }
    var frame = 1/6;
    var elapsed = 0;
    var rest = 0;
    while(true) {
      elapsed += frame;
      if (solver(elapsed) === 1) {
        rest++;
        if (rest >= 16) { break; }
      } else {
        rest = 0;
      }
    }
    var duration = elapsed * frame * 1000;
    cache.springs[string] = duration;
    return duration;
  }

  return duration ? solver : getDuration;

}

// Basic steps easing implementation https://developer.mozilla.org/fr/docs/Web/CSS/transition-timing-function

function steps(steps) {
  if ( steps === void 0 ) steps = 10;

  return function (t) { return Math.ceil((minMax(t, 0.000001, 1)) * steps) * (1 / steps); };
}

// BezierEasing https://github.com/gre/bezier-easing

var bezier = (function () {

  var kSplineTableSize = 11;
  var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);

  function A(aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1 }
  function B(aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1 }
  function C(aA1)      { return 3.0 * aA1 }

  function calcBezier(aT, aA1, aA2) { return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT }
  function getSlope(aT, aA1, aA2) { return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1) }

  function binarySubdivide(aX, aA, aB, mX1, mX2) {
    var currentX, currentT, i = 0;
    do {
      currentT = aA + (aB - aA) / 2.0;
      currentX = calcBezier(currentT, mX1, mX2) - aX;
      if (currentX > 0.0) { aB = currentT; } else { aA = currentT; }
    } while (Math.abs(currentX) > 0.0000001 && ++i < 10);
    return currentT;
  }

  function newtonRaphsonIterate(aX, aGuessT, mX1, mX2) {
    for (var i = 0; i < 4; ++i) {
      var currentSlope = getSlope(aGuessT, mX1, mX2);
      if (currentSlope === 0.0) { return aGuessT; }
      var currentX = calcBezier(aGuessT, mX1, mX2) - aX;
      aGuessT -= currentX / currentSlope;
    }
    return aGuessT;
  }

  function bezier(mX1, mY1, mX2, mY2) {

    if (!(0 <= mX1 && mX1 <= 1 && 0 <= mX2 && mX2 <= 1)) { return; }
    var sampleValues = new Float32Array(kSplineTableSize);

    if (mX1 !== mY1 || mX2 !== mY2) {
      for (var i = 0; i < kSplineTableSize; ++i) {
        sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);
      }
    }

    function getTForX(aX) {

      var intervalStart = 0;
      var currentSample = 1;
      var lastSample = kSplineTableSize - 1;

      for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {
        intervalStart += kSampleStepSize;
      }

      --currentSample;

      var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);
      var guessForT = intervalStart + dist * kSampleStepSize;
      var initialSlope = getSlope(guessForT, mX1, mX2);

      if (initialSlope >= 0.001) {
        return newtonRaphsonIterate(aX, guessForT, mX1, mX2);
      } else if (initialSlope === 0.0) {
        return guessForT;
      } else {
        return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);
      }

    }

    return function (x) {
      if (mX1 === mY1 && mX2 === mY2) { return x; }
      if (x === 0 || x === 1) { return x; }
      return calcBezier(getTForX(x), mY1, mY2);
    }

  }

  return bezier;

})();

var penner = (function () {

  // Based on jQuery UI's implemenation of easing equations from Robert Penner (http://www.robertpenner.com/easing)

  var eases = { linear: function () { return function (t) { return t; }; } };

  var functionEasings = {
    Sine: function () { return function (t) { return 1 - Math.cos(t * Math.PI / 2); }; },
    Circ: function () { return function (t) { return 1 - Math.sqrt(1 - t * t); }; },
    Back: function () { return function (t) { return t * t * (3 * t - 2); }; },
    Bounce: function () { return function (t) {
      var pow2, b = 4;
      while (t < (( pow2 = Math.pow(2, --b)) - 1) / 11) {}
      return 1 / Math.pow(4, 3 - b) - 7.5625 * Math.pow(( pow2 * 3 - 2 ) / 22 - t, 2)
    }; },
    Elastic: function (amplitude, period) {
      if ( amplitude === void 0 ) amplitude = 1;
      if ( period === void 0 ) period = .5;

      var a = minMax(amplitude, 1, 10);
      var p = minMax(period, .1, 2);
      return function (t) {
        return (t === 0 || t === 1) ? t : 
          -a * Math.pow(2, 10 * (t - 1)) * Math.sin((((t - 1) - (p / (Math.PI * 2) * Math.asin(1 / a))) * (Math.PI * 2)) / p);
      }
    }
  };

  var baseEasings = ['Quad', 'Cubic', 'Quart', 'Quint', 'Expo'];

  baseEasings.forEach(function (name, i) {
    functionEasings[name] = function () { return function (t) { return Math.pow(t, i + 2); }; };
  });

  Object.keys(functionEasings).forEach(function (name) {
    var easeIn = functionEasings[name];
    eases['easeIn' + name] = easeIn;
    eases['easeOut' + name] = function (a, b) { return function (t) { return 1 - easeIn(a, b)(1 - t); }; };
    eases['easeInOut' + name] = function (a, b) { return function (t) { return t < 0.5 ? easeIn(a, b)(t * 2) / 2 : 
      1 - easeIn(a, b)(t * -2 + 2) / 2; }; };
    eases['easeOutIn' + name] = function (a, b) { return function (t) { return t < 0.5 ? (1 - easeIn(a, b)(1 - t * 2)) / 2 : 
      (easeIn(a, b)(t * 2 - 1) + 1) / 2; }; };
  });

  return eases;

})();

function parseEasings(easing, duration) {
  if (is.fnc(easing)) { return easing; }
  var name = easing.split('(')[0];
  var ease = penner[name];
  var args = parseEasingParameters(easing);
  switch (name) {
    case 'spring' : return spring(easing, duration);
    case 'cubicBezier' : return applyArguments(bezier, args);
    case 'steps' : return applyArguments(steps, args);
    default : return applyArguments(ease, args);
  }
}

// Strings

function selectString(str) {
  try {
    var nodes = document.querySelectorAll(str);
    return nodes;
  } catch(e) {
    return;
  }
}

// Arrays

function filterArray(arr, callback) {
  var len = arr.length;
  var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
  var result = [];
  for (var i = 0; i < len; i++) {
    if (i in arr) {
      var val = arr[i];
      if (callback.call(thisArg, val, i, arr)) {
        result.push(val);
      }
    }
  }
  return result;
}

function flattenArray(arr) {
  return arr.reduce(function (a, b) { return a.concat(is.arr(b) ? flattenArray(b) : b); }, []);
}

function toArray(o) {
  if (is.arr(o)) { return o; }
  if (is.str(o)) { o = selectString(o) || o; }
  if (o instanceof NodeList || o instanceof HTMLCollection) { return [].slice.call(o); }
  return [o];
}

function arrayContains(arr, val) {
  return arr.some(function (a) { return a === val; });
}

// Objects

function cloneObject(o) {
  var clone = {};
  for (var p in o) { clone[p] = o[p]; }
  return clone;
}

function replaceObjectProps(o1, o2) {
  var o = cloneObject(o1);
  for (var p in o1) { o[p] = o2.hasOwnProperty(p) ? o2[p] : o1[p]; }
  return o;
}

function mergeObjects(o1, o2) {
  var o = cloneObject(o1);
  for (var p in o2) { o[p] = is.und(o1[p]) ? o2[p] : o1[p]; }
  return o;
}

// Colors

function rgbToRgba(rgbValue) {
  var rgb = /rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(rgbValue);
  return rgb ? ("rgba(" + (rgb[1]) + ",1)") : rgbValue;
}

function hexToRgba(hexValue) {
  var rgx = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
  var hex = hexValue.replace(rgx, function (m, r, g, b) { return r + r + g + g + b + b; } );
  var rgb = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  var r = parseInt(rgb[1], 16);
  var g = parseInt(rgb[2], 16);
  var b = parseInt(rgb[3], 16);
  return ("rgba(" + r + "," + g + "," + b + ",1)");
}

function hslToRgba(hslValue) {
  var hsl = /hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(hslValue) || /hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(hslValue);
  var h = parseInt(hsl[1], 10) / 360;
  var s = parseInt(hsl[2], 10) / 100;
  var l = parseInt(hsl[3], 10) / 100;
  var a = hsl[4] || 1;
  function hue2rgb(p, q, t) {
    if (t < 0) { t += 1; }
    if (t > 1) { t -= 1; }
    if (t < 1/6) { return p + (q - p) * 6 * t; }
    if (t < 1/2) { return q; }
    if (t < 2/3) { return p + (q - p) * (2/3 - t) * 6; }
    return p;
  }
  var r, g, b;
  if (s == 0) {
    r = g = b = l;
  } else {
    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    var p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }
  return ("rgba(" + (r * 255) + "," + (g * 255) + "," + (b * 255) + "," + a + ")");
}

function colorToRgb(val) {
  if (is.rgb(val)) { return rgbToRgba(val); }
  if (is.hex(val)) { return hexToRgba(val); }
  if (is.hsl(val)) { return hslToRgba(val); }
}

// Units

function getUnit(val) {
  var split = /[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(val);
  if (split) { return split[1]; }
}

function getTransformUnit(propName) {
  if (stringContains(propName, 'translate') || propName === 'perspective') { return 'px'; }
  if (stringContains(propName, 'rotate') || stringContains(propName, 'skew')) { return 'deg'; }
}

// Values

function getFunctionValue(val, animatable) {
  if (!is.fnc(val)) { return val; }
  return val(animatable.target, animatable.id, animatable.total);
}

function getAttribute(el, prop) {
  return el.getAttribute(prop);
}

function convertPxToUnit(el, value, unit) {
  var valueUnit = getUnit(value);
  if (arrayContains([unit, 'deg', 'rad', 'turn'], valueUnit)) { return value; }
  var cached = cache.CSS[value + unit];
  if (!is.und(cached)) { return cached; }
  var baseline = 100;
  var tempEl = document.createElement(el.tagName);
  var parentEl = (el.parentNode && (el.parentNode !== document)) ? el.parentNode : document.body;
  parentEl.appendChild(tempEl);
  tempEl.style.position = 'absolute';
  tempEl.style.width = baseline + unit;
  var factor = baseline / tempEl.offsetWidth;
  parentEl.removeChild(tempEl);
  var convertedUnit = factor * parseFloat(value);
  cache.CSS[value + unit] = convertedUnit;
  return convertedUnit;
}

function getCSSValue(el, prop, unit) {
  if (prop in el.style) {
    var uppercasePropName = prop.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
    var value = el.style[prop] || getComputedStyle(el).getPropertyValue(uppercasePropName) || '0';
    return unit ? convertPxToUnit(el, value, unit) : value;
  }
}

function getAnimationType(el, prop) {
  if (is.dom(el) && !is.inp(el) && (!is.nil(getAttribute(el, prop)) || (is.svg(el) && el[prop]))) { return 'attribute'; }
  if (is.dom(el) && arrayContains(validTransforms, prop)) { return 'transform'; }
  if (is.dom(el) && (prop !== 'transform' && getCSSValue(el, prop))) { return 'css'; }
  if (el[prop] != null) { return 'object'; }
}

function getElementTransforms(el) {
  if (!is.dom(el)) { return; }
  var str = el.style.transform || '';
  var reg  = /(\w+)\(([^)]*)\)/g;
  var transforms = new Map();
  var m; while (m = reg.exec(str)) { transforms.set(m[1], m[2]); }
  return transforms;
}

function getTransformValue(el, propName, animatable, unit) {
  var defaultVal = stringContains(propName, 'scale') ? 1 : 0 + getTransformUnit(propName);
  var value = getElementTransforms(el).get(propName) || defaultVal;
  if (animatable) {
    animatable.transforms.list.set(propName, value);
    animatable.transforms['last'] = propName;
  }
  return unit ? convertPxToUnit(el, value, unit) : value;
}

function getOriginalTargetValue(target, propName, unit, animatable) {
  switch (getAnimationType(target, propName)) {
    case 'transform': return getTransformValue(target, propName, animatable, unit);
    case 'css': return getCSSValue(target, propName, unit);
    case 'attribute': return getAttribute(target, propName);
    default: return target[propName] || 0;
  }
}

function getRelativeValue(to, from) {
  var operator = /^(\*=|\+=|-=)/.exec(to);
  if (!operator) { return to; }
  var u = getUnit(to) || 0;
  var x = parseFloat(from);
  var y = parseFloat(to.replace(operator[0], ''));
  switch (operator[0][0]) {
    case '+': return x + y + u;
    case '-': return x - y + u;
    case '*': return x * y + u;
  }
}

function validateValue(val, unit) {
  if (is.col(val)) { return colorToRgb(val); }
  if (/\s/g.test(val)) { return val; }
  var originalUnit = getUnit(val);
  var unitLess = originalUnit ? val.substr(0, val.length - originalUnit.length) : val;
  if (unit) { return unitLess + unit; }
  return unitLess;
}

// getTotalLength() equivalent for circle, rect, polyline, polygon and line shapes
// adapted from https://gist.github.com/SebLambla/3e0550c496c236709744

function getDistance(p1, p2) {
  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
}

function getCircleLength(el) {
  return Math.PI * 2 * getAttribute(el, 'r');
}

function getRectLength(el) {
  return (getAttribute(el, 'width') * 2) + (getAttribute(el, 'height') * 2);
}

function getLineLength(el) {
  return getDistance(
    {x: getAttribute(el, 'x1'), y: getAttribute(el, 'y1')}, 
    {x: getAttribute(el, 'x2'), y: getAttribute(el, 'y2')}
  );
}

function getPolylineLength(el) {
  var points = el.points;
  var totalLength = 0;
  var previousPos;
  for (var i = 0 ; i < points.numberOfItems; i++) {
    var currentPos = points.getItem(i);
    if (i > 0) { totalLength += getDistance(previousPos, currentPos); }
    previousPos = currentPos;
  }
  return totalLength;
}

function getPolygonLength(el) {
  var points = el.points;
  return getPolylineLength(el) + getDistance(points.getItem(points.numberOfItems - 1), points.getItem(0));
}

// Path animation

function getTotalLength(el) {
  if (el.getTotalLength) { return el.getTotalLength(); }
  switch(el.tagName.toLowerCase()) {
    case 'circle': return getCircleLength(el);
    case 'rect': return getRectLength(el);
    case 'line': return getLineLength(el);
    case 'polyline': return getPolylineLength(el);
    case 'polygon': return getPolygonLength(el);
  }
}

function setDashoffset(el) {
  var pathLength = getTotalLength(el);
  el.setAttribute('stroke-dasharray', pathLength);
  return pathLength;
}

// Motion path

function getParentSvgEl(el) {
  var parentEl = el.parentNode;
  while (is.svg(parentEl)) {
    if (!is.svg(parentEl.parentNode)) { break; }
    parentEl = parentEl.parentNode;
  }
  return parentEl;
}

function getParentSvg(pathEl, svgData) {
  var svg = svgData || {};
  var parentSvgEl = svg.el || getParentSvgEl(pathEl);
  var rect = parentSvgEl.getBoundingClientRect();
  var viewBoxAttr = getAttribute(parentSvgEl, 'viewBox');
  var width = rect.width;
  var height = rect.height;
  var viewBox = svg.viewBox || (viewBoxAttr ? viewBoxAttr.split(' ') : [0, 0, width, height]);
  return {
    el: parentSvgEl,
    viewBox: viewBox,
    x: viewBox[0] / 1,
    y: viewBox[1] / 1,
    w: width,
    h: height,
    vW: viewBox[2],
    vH: viewBox[3]
  }
}

function getPath(path, percent) {
  var pathEl = is.str(path) ? selectString(path)[0] : path;
  var p = percent || 100;
  return function(property) {
    return {
      property: property,
      el: pathEl,
      svg: getParentSvg(pathEl),
      totalLength: getTotalLength(pathEl) * (p / 100)
    }
  }
}

function getPathProgress(path, progress, isPathTargetInsideSVG) {
  function point(offset) {
    if ( offset === void 0 ) offset = 0;

    var l = progress + offset >= 1 ? progress + offset : 0;
    return path.el.getPointAtLength(l);
  }
  var svg = getParentSvg(path.el, path.svg);
  var p = point();
  var p0 = point(-1);
  var p1 = point(+1);
  var scaleX = isPathTargetInsideSVG ? 1 : svg.w / svg.vW;
  var scaleY = isPathTargetInsideSVG ? 1 : svg.h / svg.vH;
  switch (path.property) {
    case 'x': return (p.x - svg.x) * scaleX;
    case 'y': return (p.y - svg.y) * scaleY;
    case 'angle': return Math.atan2(p1.y - p0.y, p1.x - p0.x) * 180 / Math.PI;
  }
}

// Decompose value

function decomposeValue(val, unit) {
  // const rgx = /-?\d*\.?\d+/g; // handles basic numbers
  // const rgx = /[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g; // handles exponents notation
  var rgx = /[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g; // handles exponents notation
  var value = validateValue((is.pth(val) ? val.totalLength : val), unit) + '';
  return {
    original: value,
    numbers: value.match(rgx) ? value.match(rgx).map(Number) : [0],
    strings: (is.str(val) || unit) ? value.split(rgx) : []
  }
}

// Animatables

function parseTargets(targets) {
  var targetsArray = targets ? (flattenArray(is.arr(targets) ? targets.map(toArray) : toArray(targets))) : [];
  return filterArray(targetsArray, function (item, pos, self) { return self.indexOf(item) === pos; });
}

function getAnimatables(targets) {
  var parsed = parseTargets(targets);
  return parsed.map(function (t, i) {
    return {target: t, id: i, total: parsed.length, transforms: { list: getElementTransforms(t) } };
  });
}

// Properties

function normalizePropertyTweens(prop, tweenSettings) {
  var settings = cloneObject(tweenSettings);
  // Override duration if easing is a spring
  if (/^spring/.test(settings.easing)) { settings.duration = spring(settings.easing); }
  if (is.arr(prop)) {
    var l = prop.length;
    var isFromTo = (l === 2 && !is.obj(prop[0]));
    if (!isFromTo) {
      // Duration divided by the number of tweens
      if (!is.fnc(tweenSettings.duration)) { settings.duration = tweenSettings.duration / l; }
    } else {
      // Transform [from, to] values shorthand to a valid tween value
      prop = {value: prop};
    }
  }
  var propArray = is.arr(prop) ? prop : [prop];
  return propArray.map(function (v, i) {
    var obj = (is.obj(v) && !is.pth(v)) ? v : {value: v};
    // Default delay value should only be applied to the first tween
    if (is.und(obj.delay)) { obj.delay = !i ? tweenSettings.delay : 0; }
    // Default endDelay value should only be applied to the last tween
    if (is.und(obj.endDelay)) { obj.endDelay = i === propArray.length - 1 ? tweenSettings.endDelay : 0; }
    return obj;
  }).map(function (k) { return mergeObjects(k, settings); });
}


function flattenKeyframes(keyframes) {
  var propertyNames = filterArray(flattenArray(keyframes.map(function (key) { return Object.keys(key); })), function (p) { return is.key(p); })
  .reduce(function (a,b) { if (a.indexOf(b) < 0) { a.push(b); } return a; }, []);
  var properties = {};
  var loop = function ( i ) {
    var propName = propertyNames[i];
    properties[propName] = keyframes.map(function (key) {
      var newKey = {};
      for (var p in key) {
        if (is.key(p)) {
          if (p == propName) { newKey.value = key[p]; }
        } else {
          newKey[p] = key[p];
        }
      }
      return newKey;
    });
  };

  for (var i = 0; i < propertyNames.length; i++) loop( i );
  return properties;
}

function getProperties(tweenSettings, params) {
  var properties = [];
  var keyframes = params.keyframes;
  if (keyframes) { params = mergeObjects(flattenKeyframes(keyframes), params); }
  for (var p in params) {
    if (is.key(p)) {
      properties.push({
        name: p,
        tweens: normalizePropertyTweens(params[p], tweenSettings)
      });
    }
  }
  return properties;
}

// Tweens

function normalizeTweenValues(tween, animatable) {
  var t = {};
  for (var p in tween) {
    var value = getFunctionValue(tween[p], animatable);
    if (is.arr(value)) {
      value = value.map(function (v) { return getFunctionValue(v, animatable); });
      if (value.length === 1) { value = value[0]; }
    }
    t[p] = value;
  }
  t.duration = parseFloat(t.duration);
  t.delay = parseFloat(t.delay);
  return t;
}

function normalizeTweens(prop, animatable) {
  var previousTween;
  return prop.tweens.map(function (t) {
    var tween = normalizeTweenValues(t, animatable);
    var tweenValue = tween.value;
    var to = is.arr(tweenValue) ? tweenValue[1] : tweenValue;
    var toUnit = getUnit(to);
    var originalValue = getOriginalTargetValue(animatable.target, prop.name, toUnit, animatable);
    var previousValue = previousTween ? previousTween.to.original : originalValue;
    var from = is.arr(tweenValue) ? tweenValue[0] : previousValue;
    var fromUnit = getUnit(from) || getUnit(originalValue);
    var unit = toUnit || fromUnit;
    if (is.und(to)) { to = previousValue; }
    tween.from = decomposeValue(from, unit);
    tween.to = decomposeValue(getRelativeValue(to, from), unit);
    tween.start = previousTween ? previousTween.end : 0;
    tween.end = tween.start + tween.delay + tween.duration + tween.endDelay;
    tween.easing = parseEasings(tween.easing, tween.duration);
    tween.isPath = is.pth(tweenValue);
    tween.isPathTargetInsideSVG = tween.isPath && is.svg(animatable.target);
    tween.isColor = is.col(tween.from.original);
    if (tween.isColor) { tween.round = 1; }
    previousTween = tween;
    return tween;
  });
}

// Tween progress

var setProgressValue = {
  css: function (t, p, v) { return t.style[p] = v; },
  attribute: function (t, p, v) { return t.setAttribute(p, v); },
  object: function (t, p, v) { return t[p] = v; },
  transform: function (t, p, v, transforms, manual) {
    transforms.list.set(p, v);
    if (p === transforms.last || manual) {
      var str = '';
      transforms.list.forEach(function (value, prop) { str += prop + "(" + value + ") "; });
      t.style.transform = str;
    }
  }
};

// Set Value helper

function setTargetsValue(targets, properties) {
  var animatables = getAnimatables(targets);
  animatables.forEach(function (animatable) {
    for (var property in properties) {
      var value = getFunctionValue(properties[property], animatable);
      var target = animatable.target;
      var valueUnit = getUnit(value);
      var originalValue = getOriginalTargetValue(target, property, valueUnit, animatable);
      var unit = valueUnit || getUnit(originalValue);
      var to = getRelativeValue(validateValue(value, unit), originalValue);
      var animType = getAnimationType(target, property);
      setProgressValue[animType](target, property, to, animatable.transforms, true);
    }
  });
}

// Animations

function createAnimation(animatable, prop) {
  var animType = getAnimationType(animatable.target, prop.name);
  if (animType) {
    var tweens = normalizeTweens(prop, animatable);
    var lastTween = tweens[tweens.length - 1];
    return {
      type: animType,
      property: prop.name,
      animatable: animatable,
      tweens: tweens,
      duration: lastTween.end,
      delay: tweens[0].delay,
      endDelay: lastTween.endDelay
    }
  }
}

function getAnimations(animatables, properties) {
  return filterArray(flattenArray(animatables.map(function (animatable) {
    return properties.map(function (prop) {
      return createAnimation(animatable, prop);
    });
  })), function (a) { return !is.und(a); });
}

// Create Instance

function getInstanceTimings(animations, tweenSettings) {
  var animLength = animations.length;
  var getTlOffset = function (anim) { return anim.timelineOffset ? anim.timelineOffset : 0; };
  var timings = {};
  timings.duration = animLength ? Math.max.apply(Math, animations.map(function (anim) { return getTlOffset(anim) + anim.duration; })) : tweenSettings.duration;
  timings.delay = animLength ? Math.min.apply(Math, animations.map(function (anim) { return getTlOffset(anim) + anim.delay; })) : tweenSettings.delay;
  timings.endDelay = animLength ? timings.duration - Math.max.apply(Math, animations.map(function (anim) { return getTlOffset(anim) + anim.duration - anim.endDelay; })) : tweenSettings.endDelay;
  return timings;
}

var instanceID = 0;

function createNewInstance(params) {
  var instanceSettings = replaceObjectProps(defaultInstanceSettings, params);
  var tweenSettings = replaceObjectProps(defaultTweenSettings, params);
  var properties = getProperties(tweenSettings, params);
  var animatables = getAnimatables(params.targets);
  var animations = getAnimations(animatables, properties);
  var timings = getInstanceTimings(animations, tweenSettings);
  var id = instanceID;
  instanceID++;
  return mergeObjects(instanceSettings, {
    id: id,
    children: [],
    animatables: animatables,
    animations: animations,
    duration: timings.duration,
    delay: timings.delay,
    endDelay: timings.endDelay
  });
}

// Core

var activeInstances = [];

var engine = (function () {
  var raf;

  function play() {
    if (!raf && (!isDocumentHidden() || !anime.suspendWhenDocumentHidden) && activeInstances.length > 0) {
      raf = requestAnimationFrame(step);
    }
  }
  function step(t) {
    // memo on algorithm issue:
    // dangerous iteration over mutable `activeInstances`
    // (that collection may be updated from within callbacks of `tick`-ed animation instances)
    var activeInstancesLength = activeInstances.length;
    var i = 0;
    while (i < activeInstancesLength) {
      var activeInstance = activeInstances[i];
      if (!activeInstance.paused) {
        activeInstance.tick(t);
        i++;
      } else {
        activeInstances.splice(i, 1);
        activeInstancesLength--;
      }
    }
    raf = i > 0 ? requestAnimationFrame(step) : undefined;
  }

  function handleVisibilityChange() {
    if (!anime.suspendWhenDocumentHidden) { return; }

    if (isDocumentHidden()) {
      // suspend ticks
      raf = cancelAnimationFrame(raf);
    } else { // is back to active tab
      // first adjust animations to consider the time that ticks were suspended
      activeInstances.forEach(
        function (instance) { return instance ._onDocumentVisibility(); }
      );
      engine();
    }
  }
  if (typeof document !== 'undefined') {
    document.addEventListener('visibilitychange', handleVisibilityChange);
  }

  return play;
})();

function isDocumentHidden() {
  return !!document && document.hidden;
}

// Public Instance

function anime(params) {
  if ( params === void 0 ) params = {};


  var startTime = 0, lastTime = 0, now = 0;
  var children, childrenLength = 0;
  var resolve = null;

  function makePromise(instance) {
    var promise = window.Promise && new Promise(function (_resolve) { return resolve = _resolve; });
    instance.finished = promise;
    return promise;
  }

  var instance = createNewInstance(params);
  var promise = makePromise(instance);

  function toggleInstanceDirection() {
    var direction = instance.direction;
    if (direction !== 'alternate') {
      instance.direction = direction !== 'normal' ? 'normal' : 'reverse';
    }
    instance.reversed = !instance.reversed;
    children.forEach(function (child) { return child.reversed = instance.reversed; });
  }

  function adjustTime(time) {
    return instance.reversed ? instance.duration - time : time;
  }

  function resetTime() {
    startTime = 0;
    lastTime = adjustTime(instance.currentTime) * (1 / anime.speed);
  }

  function seekChild(time, child) {
    if (child) { child.seek(time - child.timelineOffset); }
  }

  function syncInstanceChildren(time) {
    if (!instance.reversePlayback) {
      for (var i = 0; i < childrenLength; i++) { seekChild(time, children[i]); }
    } else {
      for (var i$1 = childrenLength; i$1--;) { seekChild(time, children[i$1]); }
    }
  }

  function setAnimationsProgress(insTime) {
    var i = 0;
    var animations = instance.animations;
    var animationsLength = animations.length;
    while (i < animationsLength) {
      var anim = animations[i];
      var animatable = anim.animatable;
      var tweens = anim.tweens;
      var tweenLength = tweens.length - 1;
      var tween = tweens[tweenLength];
      // Only check for keyframes if there is more than one tween
      if (tweenLength) { tween = filterArray(tweens, function (t) { return (insTime < t.end); })[0] || tween; }
      var elapsed = minMax(insTime - tween.start - tween.delay, 0, tween.duration) / tween.duration;
      var eased = isNaN(elapsed) ? 1 : tween.easing(elapsed);
      var strings = tween.to.strings;
      var round = tween.round;
      var numbers = [];
      var toNumbersLength = tween.to.numbers.length;
      var progress = (void 0);
      for (var n = 0; n < toNumbersLength; n++) {
        var value = (void 0);
        var toNumber = tween.to.numbers[n];
        var fromNumber = tween.from.numbers[n] || 0;
        if (!tween.isPath) {
          value = fromNumber + (eased * (toNumber - fromNumber));
        } else {
          value = getPathProgress(tween.value, eased * toNumber, tween.isPathTargetInsideSVG);
        }
        if (round) {
          if (!(tween.isColor && n > 2)) {
            value = Math.round(value * round) / round;
          }
        }
        numbers.push(value);
      }
      // Manual Array.reduce for better performances
      var stringsLength = strings.length;
      if (!stringsLength) {
        progress = numbers[0];
      } else {
        progress = strings[0];
        for (var s = 0; s < stringsLength; s++) {
          var a = strings[s];
          var b = strings[s + 1];
          var n$1 = numbers[s];
          if (!isNaN(n$1)) {
            if (!b) {
              progress += n$1 + ' ';
            } else {
              progress += n$1 + b;
            }
          }
        }
      }
      setProgressValue[anim.type](animatable.target, anim.property, progress, animatable.transforms);
      anim.currentValue = progress;
      i++;
    }
  }

  function setCallback(cb) {
    if (instance[cb] && !instance.passThrough) { instance[cb](instance); }
  }

  function countIteration() {
    if (instance.remaining && instance.remaining !== true) {
      instance.remaining--;
    }
  }

  function setInstanceProgress(engineTime) {
    var insDuration = instance.duration;
    var insDelay = instance.delay;
    var insEndDelay = insDuration - instance.endDelay;
    var insTime = adjustTime(engineTime);
    instance.progress = minMax((insTime / insDuration) * 100, 0, 100);
    instance.reversePlayback = insTime < instance.currentTime;
    if (children) { syncInstanceChildren(insTime); }
    if (!instance.began && instance.currentTime > 0) {
      instance.began = true;
      setCallback('begin');
    }
    if (!instance.loopBegan && instance.currentTime > 0) {
      instance.loopBegan = true;
      setCallback('loopBegin');
    }
    if (insTime <= insDelay && instance.currentTime !== 0) {
      setAnimationsProgress(0);
    }
    if ((insTime >= insEndDelay && instance.currentTime !== insDuration) || !insDuration) {
      setAnimationsProgress(insDuration);
    }
    if (insTime > insDelay && insTime < insEndDelay) {
      if (!instance.changeBegan) {
        instance.changeBegan = true;
        instance.changeCompleted = false;
        setCallback('changeBegin');
      }
      setCallback('change');
      setAnimationsProgress(insTime);
    } else {
      if (instance.changeBegan) {
        instance.changeCompleted = true;
        instance.changeBegan = false;
        setCallback('changeComplete');
      }
    }
    instance.currentTime = minMax(insTime, 0, insDuration);
    if (instance.began) { setCallback('update'); }
    if (engineTime >= insDuration) {
      lastTime = 0;
      countIteration();
      if (!instance.remaining) {
        instance.paused = true;
        if (!instance.completed) {
          instance.completed = true;
          setCallback('loopComplete');
          setCallback('complete');
          if (!instance.passThrough && 'Promise' in window) {
            resolve();
            promise = makePromise(instance);
          }
        }
      } else {
        startTime = now;
        setCallback('loopComplete');
        instance.loopBegan = false;
        if (instance.direction === 'alternate') {
          toggleInstanceDirection();
        }
      }
    }
  }

  instance.reset = function() {
    var direction = instance.direction;
    instance.passThrough = false;
    instance.currentTime = 0;
    instance.progress = 0;
    instance.paused = true;
    instance.began = false;
    instance.loopBegan = false;
    instance.changeBegan = false;
    instance.completed = false;
    instance.changeCompleted = false;
    instance.reversePlayback = false;
    instance.reversed = direction === 'reverse';
    instance.remaining = instance.loop;
    children = instance.children;
    childrenLength = children.length;
    for (var i = childrenLength; i--;) { instance.children[i].reset(); }
    if (instance.reversed && instance.loop !== true || (direction === 'alternate' && instance.loop === 1)) { instance.remaining++; }
    setAnimationsProgress(instance.reversed ? instance.duration : 0);
  };

  // internal method (for engine) to adjust animation timings before restoring engine ticks (rAF)
  instance._onDocumentVisibility = resetTime;

  // Set Value helper

  instance.set = function(targets, properties) {
    setTargetsValue(targets, properties);
    return instance;
  };

  instance.tick = function(t) {
    now = t;
    if (!startTime) { startTime = now; }
    setInstanceProgress((now + (lastTime - startTime)) * anime.speed);
  };

  instance.seek = function(time) {
    setInstanceProgress(adjustTime(time));
  };

  instance.pause = function() {
    instance.paused = true;
    resetTime();
  };

  instance.play = function() {
    if (!instance.paused) { return; }
    if (instance.completed) { instance.reset(); }
    instance.paused = false;
    activeInstances.push(instance);
    resetTime();
    engine();
  };

  instance.reverse = function() {
    toggleInstanceDirection();
    instance.completed = instance.reversed ? false : true;
    resetTime();
  };

  instance.restart = function() {
    instance.reset();
    instance.play();
  };

  instance.remove = function(targets) {
    var targetsArray = parseTargets(targets);
    removeTargetsFromInstance(targetsArray, instance);
  };

  instance.reset();

  if (instance.autoplay) { instance.play(); }

  return instance;

}

// Remove targets from animation

function removeTargetsFromAnimations(targetsArray, animations) {
  for (var a = animations.length; a--;) {
    if (arrayContains(targetsArray, animations[a].animatable.target)) {
      animations.splice(a, 1);
    }
  }
}

function removeTargetsFromInstance(targetsArray, instance) {
  var animations = instance.animations;
  var children = instance.children;
  removeTargetsFromAnimations(targetsArray, animations);
  for (var c = children.length; c--;) {
    var child = children[c];
    var childAnimations = child.animations;
    removeTargetsFromAnimations(targetsArray, childAnimations);
    if (!childAnimations.length && !child.children.length) { children.splice(c, 1); }
  }
  if (!animations.length && !children.length) { instance.pause(); }
}

function removeTargetsFromActiveInstances(targets) {
  var targetsArray = parseTargets(targets);
  for (var i = activeInstances.length; i--;) {
    var instance = activeInstances[i];
    removeTargetsFromInstance(targetsArray, instance);
  }
}

// Stagger helpers

function stagger(val, params) {
  if ( params === void 0 ) params = {};

  var direction = params.direction || 'normal';
  var easing = params.easing ? parseEasings(params.easing) : null;
  var grid = params.grid;
  var axis = params.axis;
  var fromIndex = params.from || 0;
  var fromFirst = fromIndex === 'first';
  var fromCenter = fromIndex === 'center';
  var fromLast = fromIndex === 'last';
  var isRange = is.arr(val);
  var val1 = isRange ? parseFloat(val[0]) : parseFloat(val);
  var val2 = isRange ? parseFloat(val[1]) : 0;
  var unit = getUnit(isRange ? val[1] : val) || 0;
  var start = params.start || 0 + (isRange ? val1 : 0);
  var values = [];
  var maxValue = 0;
  return function (el, i, t) {
    if (fromFirst) { fromIndex = 0; }
    if (fromCenter) { fromIndex = (t - 1) / 2; }
    if (fromLast) { fromIndex = t - 1; }
    if (!values.length) {
      for (var index = 0; index < t; index++) {
        if (!grid) {
          values.push(Math.abs(fromIndex - index));
        } else {
          var fromX = !fromCenter ? fromIndex%grid[0] : (grid[0]-1)/2;
          var fromY = !fromCenter ? Math.floor(fromIndex/grid[0]) : (grid[1]-1)/2;
          var toX = index%grid[0];
          var toY = Math.floor(index/grid[0]);
          var distanceX = fromX - toX;
          var distanceY = fromY - toY;
          var value = Math.sqrt(distanceX * distanceX + distanceY * distanceY);
          if (axis === 'x') { value = -distanceX; }
          if (axis === 'y') { value = -distanceY; }
          values.push(value);
        }
        maxValue = Math.max.apply(Math, values);
      }
      if (easing) { values = values.map(function (val) { return easing(val / maxValue) * maxValue; }); }
      if (direction === 'reverse') { values = values.map(function (val) { return axis ? (val < 0) ? val * -1 : -val : Math.abs(maxValue - val); }); }
    }
    var spacing = isRange ? (val2 - val1) / maxValue : val1;
    return start + (spacing * (Math.round(values[i] * 100) / 100)) + unit;
  }
}

// Timeline

function timeline(params) {
  if ( params === void 0 ) params = {};

  var tl = anime(params);
  tl.duration = 0;
  tl.add = function(instanceParams, timelineOffset) {
    var tlIndex = activeInstances.indexOf(tl);
    var children = tl.children;
    if (tlIndex > -1) { activeInstances.splice(tlIndex, 1); }
    function passThrough(ins) { ins.passThrough = true; }
    for (var i = 0; i < children.length; i++) { passThrough(children[i]); }
    var insParams = mergeObjects(instanceParams, replaceObjectProps(defaultTweenSettings, params));
    insParams.targets = insParams.targets || params.targets;
    var tlDuration = tl.duration;
    insParams.autoplay = false;
    insParams.direction = tl.direction;
    insParams.timelineOffset = is.und(timelineOffset) ? tlDuration : getRelativeValue(timelineOffset, tlDuration);
    passThrough(tl);
    tl.seek(insParams.timelineOffset);
    var ins = anime(insParams);
    passThrough(ins);
    children.push(ins);
    var timings = getInstanceTimings(children, params);
    tl.delay = timings.delay;
    tl.endDelay = timings.endDelay;
    tl.duration = timings.duration;
    tl.seek(0);
    tl.reset();
    if (tl.autoplay) { tl.play(); }
    return tl;
  };
  return tl;
}

anime.version = '3.2.1';
anime.speed = 1;
// TODO:#review: naming, documentation
anime.suspendWhenDocumentHidden = true;
anime.running = activeInstances;
anime.remove = removeTargetsFromActiveInstances;
anime.get = getOriginalTargetValue;
anime.set = setTargetsValue;
anime.convertPx = convertPxToUnit;
anime.path = getPath;
anime.setDashoffset = setDashoffset;
anime.stagger = stagger;
anime.timeline = timeline;
anime.easing = parseEasings;
anime.penner = penner;
anime.random = function (min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; };

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (anime);


/***/ }),

/***/ "./node_modules/gsap/src/CSSPlugin.js":
/*!********************************************!*\
  !*** ./node_modules/gsap/src/CSSPlugin.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CSSPlugin: () => (/* binding */ CSSPlugin),
/* harmony export */   _createElement: () => (/* binding */ _createElement),
/* harmony export */   _getBBox: () => (/* binding */ _getBBox),
/* harmony export */   checkPrefix: () => (/* binding */ _checkPropPrefix),
/* harmony export */   "default": () => (/* binding */ CSSPlugin)
/* harmony export */ });
/* harmony import */ var _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./gsap-core.js */ "./node_modules/gsap/src/gsap-core.js");
/*!
 * CSSPlugin 3.6.1
 * https://greensock.com
 *
 * Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/* eslint-disable */



let _win, _doc, _docElement, _pluginInitted, _tempDiv, _tempDivStyler, _recentSetterPlugin,
	_windowExists = () => typeof(window) !== "undefined",
	_transformProps = {},
	_RAD2DEG = 180 / Math.PI,
	_DEG2RAD = Math.PI / 180,
	_atan2 = Math.atan2,
	_bigNum = 1e8,
	_capsExp = /([A-Z])/g,
	_horizontalExp = /(?:left|right|width|margin|padding|x)/i,
	_complexExp = /[\s,\(]\S/,
	_propertyAliases = {autoAlpha:"opacity,visibility", scale:"scaleX,scaleY", alpha:"opacity"},
	_renderCSSProp = (ratio, data) => data.set(data.t, data.p, (Math.round((data.s + data.c * ratio) * 10000) / 10000) + data.u, data),
	_renderPropWithEnd = (ratio, data) => data.set(data.t, data.p, ratio === 1 ? data.e : (Math.round((data.s + data.c * ratio) * 10000) / 10000) + data.u, data),
	_renderCSSPropWithBeginning = (ratio, data) => data.set(data.t, data.p, ratio ? (Math.round((data.s + data.c * ratio) * 10000) / 10000) + data.u : data.b, data), //if units change, we need a way to render the original unit/value when the tween goes all the way back to the beginning (ratio:0)
	_renderRoundedCSSProp = (ratio, data) => {
		let value = data.s + data.c * ratio;
		data.set(data.t, data.p, ~~(value + (value < 0 ? -.5 : .5)) + data.u, data);
	},
	_renderNonTweeningValue = (ratio, data) => data.set(data.t, data.p, ratio ? data.e : data.b, data),
	_renderNonTweeningValueOnlyAtEnd = (ratio, data) => data.set(data.t, data.p, ratio !== 1 ? data.b : data.e, data),
	_setterCSSStyle = (target, property, value) => target.style[property] = value,
	_setterCSSProp = (target, property, value) => target.style.setProperty(property, value),
	_setterTransform = (target, property, value) => target._gsap[property] = value,
	_setterScale = (target, property, value) => target._gsap.scaleX = target._gsap.scaleY = value,
	_setterScaleWithRender = (target, property, value, data, ratio) => {
		let cache = target._gsap;
		cache.scaleX = cache.scaleY = value;
		cache.renderTransform(ratio, cache);
	},
	_setterTransformWithRender = (target, property, value, data, ratio) => {
		let cache = target._gsap;
		cache[property] = value;
		cache.renderTransform(ratio, cache);
	},
	_transformProp = "transform",
	_transformOriginProp = _transformProp + "Origin",
	_supports3D,
	_createElement = (type, ns) => {
		let e = _doc.createElementNS ? _doc.createElementNS((ns || "http://www.w3.org/1999/xhtml").replace(/^https/, "http"), type) : _doc.createElement(type); //some servers swap in https for http in the namespace which can break things, making "style" inaccessible.
		return e.style ? e : _doc.createElement(type); //some environments won't allow access to the element's style when created with a namespace in which case we default to the standard createElement() to work around the issue. Also note that when GSAP is embedded directly inside an SVG file, createElement() won't allow access to the style object in Firefox (see https://greensock.com/forums/topic/20215-problem-using-tweenmax-in-standalone-self-containing-svg-file-err-cannot-set-property-csstext-of-undefined/).
	},
	_getComputedProperty = (target, property, skipPrefixFallback) => {
		let cs = getComputedStyle(target);
		return cs[property] || cs.getPropertyValue(property.replace(_capsExp, "-$1").toLowerCase()) || cs.getPropertyValue(property) || (!skipPrefixFallback && _getComputedProperty(target, _checkPropPrefix(property) || property, 1)) || ""; //css variables may not need caps swapped out for dashes and lowercase.
	},
	_prefixes = "O,Moz,ms,Ms,Webkit".split(","),
	_checkPropPrefix = (property, element, preferPrefix) => {
		let e = element || _tempDiv,
			s = e.style,
			i = 5;
		if (property in s && !preferPrefix) {
			return property;
		}
		property = property.charAt(0).toUpperCase() + property.substr(1);
		while (i-- && !((_prefixes[i]+property) in s)) { }
		return (i < 0) ? null : ((i === 3) ? "ms" : (i >= 0) ? _prefixes[i] : "") + property;
	},
	_initCore = () => {
		if (_windowExists() && window.document) {
			_win = window;
			_doc = _win.document;
			_docElement = _doc.documentElement;
			_tempDiv = _createElement("div") || {style:{}};
			_tempDivStyler = _createElement("div");
			_transformProp = _checkPropPrefix(_transformProp);
			_transformOriginProp = _transformProp + "Origin";
			_tempDiv.style.cssText = "border-width:0;line-height:0;position:absolute;padding:0"; //make sure to override certain properties that may contaminate measurements, in case the user has overreaching style sheets.
			_supports3D = !!_checkPropPrefix("perspective");
			_pluginInitted = 1;
		}
	},
	_getBBoxHack = function(swapIfPossible) { //works around issues in some browsers (like Firefox) that don't correctly report getBBox() on SVG elements inside a <defs> element and/or <mask>. We try creating an SVG, adding it to the documentElement and toss the element in there so that it's definitely part of the rendering tree, then grab the bbox and if it works, we actually swap out the original getBBox() method for our own that does these extra steps whenever getBBox is needed. This helps ensure that performance is optimal (only do all these extra steps when absolutely necessary...most elements don't need it).
		let svg = _createElement("svg", (this.ownerSVGElement && this.ownerSVGElement.getAttribute("xmlns")) || "http://www.w3.org/2000/svg"),
			oldParent = this.parentNode,
			oldSibling = this.nextSibling,
			oldCSS = this.style.cssText,
			bbox;
		_docElement.appendChild(svg);
		svg.appendChild(this);
		this.style.display = "block";
		if (swapIfPossible) {
			try {
				bbox = this.getBBox();
				this._gsapBBox = this.getBBox; //store the original
				this.getBBox = _getBBoxHack;
			} catch (e) { }
		} else if (this._gsapBBox) {
			bbox = this._gsapBBox();
		}
		if (oldParent) {
			if (oldSibling) {
				oldParent.insertBefore(this, oldSibling);
			} else {
				oldParent.appendChild(this);
			}
		}
		_docElement.removeChild(svg);
		this.style.cssText = oldCSS;
		return bbox;
	},
	_getAttributeFallbacks = (target, attributesArray) => {
		let i = attributesArray.length;
		while (i--) {
			if (target.hasAttribute(attributesArray[i])) {
				return target.getAttribute(attributesArray[i]);
			}
		}
	},
	_getBBox = target => {
		let bounds;
		try {
			bounds = target.getBBox(); //Firefox throws errors if you try calling getBBox() on an SVG element that's not rendered (like in a <symbol> or <defs>). https://bugzilla.mozilla.org/show_bug.cgi?id=612118
		} catch (error) {
			bounds = _getBBoxHack.call(target, true);
		}
		(bounds && (bounds.width || bounds.height)) || target.getBBox === _getBBoxHack || (bounds = _getBBoxHack.call(target, true));
		//some browsers (like Firefox) misreport the bounds if the element has zero width and height (it just assumes it's at x:0, y:0), thus we need to manually grab the position in that case.
		return (bounds && !bounds.width && !bounds.x && !bounds.y) ? {x: +_getAttributeFallbacks(target, ["x","cx","x1"]) || 0, y:+_getAttributeFallbacks(target, ["y","cy","y1"]) || 0, width:0, height:0} : bounds;
	},
	_isSVG = e => !!(e.getCTM && (!e.parentNode || e.ownerSVGElement) && _getBBox(e)), //reports if the element is an SVG on which getBBox() actually works
	_removeProperty = (target, property) => {
		if (property) {
			let style = target.style;
			if (property in _transformProps && property !== _transformOriginProp) {
				property = _transformProp;
			}
			if (style.removeProperty) {
				if (property.substr(0,2) === "ms" || property.substr(0,6) === "webkit") { //Microsoft and some Webkit browsers don't conform to the standard of capitalizing the first prefix character, so we adjust so that when we prefix the caps with a dash, it's correct (otherwise it'd be "ms-transform" instead of "-ms-transform" for IE9, for example)
					property = "-" + property;
				}
				style.removeProperty(property.replace(_capsExp, "-$1").toLowerCase());
			} else { //note: old versions of IE use "removeAttribute()" instead of "removeProperty()"
				style.removeAttribute(property);
			}
		}
	},
	_addNonTweeningPT = (plugin, target, property, beginning, end, onlySetAtEnd) => {
		let pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(plugin._pt, target, property, 0, 1, onlySetAtEnd ? _renderNonTweeningValueOnlyAtEnd : _renderNonTweeningValue);
		plugin._pt = pt;
		pt.b = beginning;
		pt.e = end;
		plugin._props.push(property);
		return pt;
	},
	_nonConvertibleUnits = {deg:1, rad:1, turn:1},
	//takes a single value like 20px and converts it to the unit specified, like "%", returning only the numeric amount.
	_convertToUnit = (target, property, value, unit) => {
		let curValue = parseFloat(value) || 0,
			curUnit = (value + "").trim().substr((curValue + "").length) || "px", // some browsers leave extra whitespace at the beginning of CSS variables, hence the need to trim()
			style = _tempDiv.style,
			horizontal = _horizontalExp.test(property),
			isRootSVG = target.tagName.toLowerCase() === "svg",
			measureProperty = (isRootSVG ? "client" : "offset") + (horizontal ? "Width" : "Height"),
			amount = 100,
			toPixels = unit === "px",
			toPercent = unit === "%",
			px, parent, cache, isSVG;
		if (unit === curUnit || !curValue || _nonConvertibleUnits[unit] || _nonConvertibleUnits[curUnit]) {
			return curValue;
		}
		(curUnit !== "px" && !toPixels) && (curValue = _convertToUnit(target, property, value, "px"));
		isSVG = target.getCTM && _isSVG(target);
		if ((toPercent || curUnit === "%") && (_transformProps[property] || ~property.indexOf("adius"))) {
			px = isSVG ? target.getBBox()[horizontal ? "width" : "height"] : target[measureProperty];
			return (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(toPercent ? curValue / px * amount : curValue / 100 * px);
		}
		style[horizontal ? "width" : "height"] = amount + (toPixels ? curUnit : unit);
		parent = (~property.indexOf("adius") || (unit === "em" && target.appendChild && !isRootSVG)) ? target : target.parentNode;
		if (isSVG) {
			parent = (target.ownerSVGElement || {}).parentNode;
		}
		if (!parent || parent === _doc || !parent.appendChild) {
			parent = _doc.body;
		}
		cache = parent._gsap;
		if (cache && toPercent && cache.width && horizontal && cache.time === _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._ticker.time) {
			return (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(curValue / cache.width * amount);
		} else {
			(toPercent || curUnit === "%") && (style.position = _getComputedProperty(target, "position"));
			(parent === target) && (style.position = "static"); // like for borderRadius, if it's a % we must have it relative to the target itself but that may not have position: relative or position: absolute in which case it'd go up the chain until it finds its offsetParent (bad). position: static protects against that.
			parent.appendChild(_tempDiv);
			px = _tempDiv[measureProperty];
			parent.removeChild(_tempDiv);
			style.position = "absolute";
			if (horizontal && toPercent) {
				cache = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._getCache)(parent);
				cache.time = _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._ticker.time;
				cache.width = parent[measureProperty];
			}
		}
		return (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(toPixels ? px * curValue / amount : px && curValue ? amount / px * curValue : 0);
	},
	_get = (target, property, unit, uncache) => {
		let value;
		_pluginInitted || _initCore();
		if ((property in _propertyAliases) && property !== "transform") {
			property = _propertyAliases[property];
			if (~property.indexOf(",")) {
				property = property.split(",")[0];
			}
		}
		if (_transformProps[property] && property !== "transform") {
			value = _parseTransform(target, uncache);
			value = (property !== "transformOrigin") ? value[property] : _firstTwoOnly(_getComputedProperty(target, _transformOriginProp)) + " " + value.zOrigin + "px";
		} else {
			value = target.style[property];
			if (!value || value === "auto" || uncache || ~(value + "").indexOf("calc(")) {
				value = (_specialProps[property] && _specialProps[property](target, property, unit)) || _getComputedProperty(target, property) || (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._getProperty)(target, property) || (property === "opacity" ? 1 : 0); // note: some browsers, like Firefox, don't report borderRadius correctly! Instead, it only reports every corner like  borderTopLeftRadius
			}
		}
		return unit && !~(value + "").trim().indexOf(" ") ? _convertToUnit(target, property, value, unit) + unit : value;

	},
	_tweenComplexCSSString = function(target, prop, start, end) { //note: we call _tweenComplexCSSString.call(pluginInstance...) to ensure that it's scoped properly. We may call it from within a plugin too, thus "this" would refer to the plugin.
		if (!start || start === "none") { // some browsers like Safari actually PREFER the prefixed property and mis-report the unprefixed value like clipPath (BUG). In other words, even though clipPath exists in the style ("clipPath" in target.style) and it's set in the CSS properly (along with -webkit-clip-path), Safari reports clipPath as "none" whereas WebkitClipPath reports accurately like "ellipse(100% 0% at 50% 0%)", so in this case we must SWITCH to using the prefixed property instead. See https://greensock.com/forums/topic/18310-clippath-doesnt-work-on-ios/
			let p = _checkPropPrefix(prop, target, 1),
				s = p && _getComputedProperty(target, p, 1);
			if (s && s !== start) {
				prop = p;
				start = s;
			} else if (prop === "borderColor") {
				start = _getComputedProperty(target, "borderTopColor"); // Firefox bug: always reports "borderColor" as "", so we must fall back to borderTopColor. See https://greensock.com/forums/topic/24583-how-to-return-colors-that-i-had-after-reverse/
			}
		}
		let pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(this._pt, target.style, prop, 0, 1, _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._renderComplexString),
			index = 0,
			matchIndex = 0,
			a, result,	startValues, startNum, color, startValue, endValue, endNum, chunk, endUnit, startUnit, relative, endValues;
		pt.b = start;
		pt.e = end;
		start += ""; //ensure values are strings
		end += "";
		if (end === "auto") {
			target.style[prop] = end;
			end = _getComputedProperty(target, prop) || end;
			target.style[prop] = start;
		}
		a = [start, end];
		(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._colorStringFilter)(a); //pass an array with the starting and ending values and let the filter do whatever it needs to the values. If colors are found, it returns true and then we must match where the color shows up order-wise because for things like boxShadow, sometimes the browser provides the computed values with the color FIRST, but the user provides it with the color LAST, so flip them if necessary. Same for drop-shadow().
		start = a[0];
		end = a[1];
		startValues = start.match(_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._numWithUnitExp) || [];
		endValues = end.match(_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._numWithUnitExp) || [];
		if (endValues.length) {
			while ((result = _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._numWithUnitExp.exec(end))) {
				endValue = result[0];
				chunk = end.substring(index, result.index);
				if (color) {
					color = (color + 1) % 5;
				} else if (chunk.substr(-5) === "rgba(" || chunk.substr(-5) === "hsla(") {
					color = 1;
				}
				if (endValue !== (startValue = startValues[matchIndex++] || "")) {
					startNum = parseFloat(startValue) || 0;
					startUnit = startValue.substr((startNum + "").length);
					relative = (endValue.charAt(1) === "=") ? +(endValue.charAt(0) + "1") : 0;
					if (relative) {
						endValue = endValue.substr(2);
					}
					endNum = parseFloat(endValue);
					endUnit = endValue.substr((endNum + "").length);
					index = _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._numWithUnitExp.lastIndex - endUnit.length;
					if (!endUnit) { //if something like "perspective:300" is passed in and we must add a unit to the end
						endUnit = endUnit || _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units[prop] || startUnit;
						if (index === end.length) {
							end += endUnit;
							pt.e += endUnit;
						}
					}
					if (startUnit !== endUnit) {
						startNum = _convertToUnit(target, prop, startValue, endUnit) || 0;
					}
					//these nested PropTweens are handled in a special way - we'll never actually call a render or setter method on them. We'll just loop through them in the parent complex string PropTween's render method.
					pt._pt = {
						_next:pt._pt,
						p:(chunk || (matchIndex === 1)) ? chunk : ",", //note: SVG spec allows omission of comma/space when a negative sign is wedged between two numbers, like 2.5-5.3 instead of 2.5,-5.3 but when tweening, the negative value may switch to positive, so we insert the comma just in case.
						s:startNum,
						c:relative ? relative * endNum : endNum - startNum,
						m:(color && color < 4) || prop === "zIndex" ? Math.round : 0
					};
				}
			}
			pt.c = (index < end.length) ? end.substring(index, end.length) : ""; //we use the "c" of the PropTween to store the final part of the string (after the last number)
		} else {
			pt.r = prop === "display" && end === "none" ? _renderNonTweeningValueOnlyAtEnd : _renderNonTweeningValue;
		}
		_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._relExp.test(end) && (pt.e = 0); //if the end string contains relative values or dynamic random(...) values, delete the end it so that on the final render we don't actually set it to the string with += or -= characters (forces it to use the calculated value).
		this._pt = pt; //start the linked list with this new PropTween. Remember, we call _tweenComplexCSSString.call(pluginInstance...) to ensure that it's scoped properly. We may call it from within another plugin too, thus "this" would refer to the plugin.
		return pt;
	},
	_keywordToPercent = {top:"0%", bottom:"100%", left:"0%", right:"100%", center:"50%"},
	_convertKeywordsToPercentages = value => {
		let split = value.split(" "),
			x = split[0],
			y = split[1] || "50%";
		if (x === "top" || x === "bottom" || y === "left" || y === "right") { //the user provided them in the wrong order, so flip them
			value = x;
			x = y;
			y = value;
		}
		split[0] = _keywordToPercent[x] || x;
		split[1] = _keywordToPercent[y] || y;
		return split.join(" ");
	},
	_renderClearProps = (ratio, data) => {
		if (data.tween && data.tween._time === data.tween._dur) {
			let target = data.t,
				style = target.style,
				props = data.u,
				cache = target._gsap,
				prop, clearTransforms, i;
			if (props === "all" || props === true) {
				style.cssText = "";
				clearTransforms = 1;
			} else {
				props = props.split(",");
				i = props.length;
				while (--i > -1) {
					prop = props[i];
					if (_transformProps[prop]) {
						clearTransforms = 1;
						prop = (prop === "transformOrigin") ? _transformOriginProp : _transformProp;
					}
					_removeProperty(target, prop);
				}
			}
			if (clearTransforms) {
				_removeProperty(target, _transformProp);
				if (cache) {
					cache.svg && target.removeAttribute("transform");
					_parseTransform(target, 1); // force all the cached values back to "normal"/identity, otherwise if there's another tween that's already set to render transforms on this element, it could display the wrong values.
					cache.uncache = 1;
				}
			}
		}
	},
	// note: specialProps should return 1 if (and only if) they have a non-zero priority. It indicates we need to sort the linked list.
	_specialProps = {
		clearProps(plugin, target, property, endValue, tween) {
			if (tween.data !== "isFromStart") {
				let pt = plugin._pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(plugin._pt, target, property, 0, 0, _renderClearProps);
				pt.u = endValue;
				pt.pr = -10;
				pt.tween = tween;
				plugin._props.push(property);
				return 1;
			}
		}
		/* className feature (about 0.4kb gzipped).
		, className(plugin, target, property, endValue, tween) {
			let _renderClassName = (ratio, data) => {
					data.css.render(ratio, data.css);
					if (!ratio || ratio === 1) {
						let inline = data.rmv,
							target = data.t,
							p;
						target.setAttribute("class", ratio ? data.e : data.b);
						for (p in inline) {
							_removeProperty(target, p);
						}
					}
				},
				_getAllStyles = (target) => {
					let styles = {},
						computed = getComputedStyle(target),
						p;
					for (p in computed) {
						if (isNaN(p) && p !== "cssText" && p !== "length") {
							styles[p] = computed[p];
						}
					}
					_setDefaults(styles, _parseTransform(target, 1));
					return styles;
				},
				startClassList = target.getAttribute("class"),
				style = target.style,
				cssText = style.cssText,
				cache = target._gsap,
				classPT = cache.classPT,
				inlineToRemoveAtEnd = {},
				data = {t:target, plugin:plugin, rmv:inlineToRemoveAtEnd, b:startClassList, e:(endValue.charAt(1) !== "=") ? endValue : startClassList.replace(new RegExp("(?:\\s|^)" + endValue.substr(2) + "(?![\\w-])"), "") + ((endValue.charAt(0) === "+") ? " " + endValue.substr(2) : "")},
				changingVars = {},
				startVars = _getAllStyles(target),
				transformRelated = /(transform|perspective)/i,
				endVars, p;
			if (classPT) {
				classPT.r(1, classPT.d);
				_removeLinkedListItem(classPT.d.plugin, classPT, "_pt");
			}
			target.setAttribute("class", data.e);
			endVars = _getAllStyles(target, true);
			target.setAttribute("class", startClassList);
			for (p in endVars) {
				if (endVars[p] !== startVars[p] && !transformRelated.test(p)) {
					changingVars[p] = endVars[p];
					if (!style[p] && style[p] !== "0") {
						inlineToRemoveAtEnd[p] = 1;
					}
				}
			}
			cache.classPT = plugin._pt = new PropTween(plugin._pt, target, "className", 0, 0, _renderClassName, data, 0, -11);
			if (style.cssText !== cssText) { //only apply if things change. Otherwise, in cases like a background-image that's pulled dynamically, it could cause a refresh. See https://greensock.com/forums/topic/20368-possible-gsap-bug-switching-classnames-in-chrome/.
				style.cssText = cssText; //we recorded cssText before we swapped classes and ran _getAllStyles() because in cases when a className tween is overwritten, we remove all the related tweening properties from that class change (otherwise class-specific stuff can't override properties we've directly set on the target's style object due to specificity).
			}
			_parseTransform(target, true); //to clear the caching of transforms
			data.css = new gsap.plugins.css();
			data.css.init(target, changingVars, tween);
			plugin._props.push(...data.css._props);
			return 1;
		}
		*/
	},





	/*
	 * --------------------------------------------------------------------------------------
	 * TRANSFORMS
	 * --------------------------------------------------------------------------------------
	 */
	_identity2DMatrix = [1,0,0,1,0,0],
	_rotationalProperties = {},
	_isNullTransform = value => (value === "matrix(1, 0, 0, 1, 0, 0)" || value === "none" || !value),
	_getComputedTransformMatrixAsArray = target => {
		let matrixString = _getComputedProperty(target, _transformProp);
		return _isNullTransform(matrixString) ? _identity2DMatrix : matrixString.substr(7).match(_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._numExp).map(_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round);
	},
	_getMatrix = (target, force2D) => {
		let cache = target._gsap || (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._getCache)(target),
			style = target.style,
			matrix = _getComputedTransformMatrixAsArray(target),
			parent, nextSibling, temp, addedToDOM;
		if (cache.svg && target.getAttribute("transform")) {
			temp = target.transform.baseVal.consolidate().matrix; //ensures that even complex values like "translate(50,60) rotate(135,0,0)" are parsed because it mashes it into a matrix.
			matrix = [temp.a, temp.b, temp.c, temp.d, temp.e, temp.f];
			return (matrix.join(",") === "1,0,0,1,0,0") ? _identity2DMatrix : matrix;
		} else if (matrix === _identity2DMatrix && !target.offsetParent && target !== _docElement && !cache.svg) { //note: if offsetParent is null, that means the element isn't in the normal document flow, like if it has display:none or one of its ancestors has display:none). Firefox returns null for getComputedStyle() if the element is in an iframe that has display:none. https://bugzilla.mozilla.org/show_bug.cgi?id=548397
			//browsers don't report transforms accurately unless the element is in the DOM and has a display value that's not "none". Firefox and Microsoft browsers have a partial bug where they'll report transforms even if display:none BUT not any percentage-based values like translate(-50%, 8px) will be reported as if it's translate(0, 8px).
			temp = style.display;
			style.display = "block";
			parent = target.parentNode;
			if (!parent || !target.offsetParent) { // note: in 3.3.0 we switched target.offsetParent to _doc.body.contains(target) to avoid [sometimes unnecessary] MutationObserver calls but that wasn't adequate because there are edge cases where nested position: fixed elements need to get reparented to accurately sense transforms. See https://github.com/greensock/GSAP/issues/388 and https://github.com/greensock/GSAP/issues/375
				addedToDOM = 1; //flag
				nextSibling = target.nextSibling;
				_docElement.appendChild(target); //we must add it to the DOM in order to get values properly
			}
			matrix = _getComputedTransformMatrixAsArray(target);
			temp ? (style.display = temp) : _removeProperty(target, "display");
			if (addedToDOM) {
				nextSibling ? parent.insertBefore(target, nextSibling) : parent ? parent.appendChild(target) : _docElement.removeChild(target);
			}
		}
		return (force2D && matrix.length > 6) ? [matrix[0], matrix[1], matrix[4], matrix[5], matrix[12], matrix[13]] : matrix;
	},
	_applySVGOrigin = (target, origin, originIsAbsolute, smooth, matrixArray, pluginToAddPropTweensTo) => {
		let cache = target._gsap,
			matrix = matrixArray || _getMatrix(target, true),
			xOriginOld = cache.xOrigin || 0,
			yOriginOld = cache.yOrigin || 0,
			xOffsetOld = cache.xOffset || 0,
			yOffsetOld = cache.yOffset || 0,
			a = matrix[0],
			b = matrix[1],
			c = matrix[2],
			d = matrix[3],
			tx = matrix[4],
			ty = matrix[5],
			originSplit = origin.split(" "),
			xOrigin = parseFloat(originSplit[0]) || 0,
			yOrigin = parseFloat(originSplit[1]) || 0,
			bounds, determinant, x, y;
		if (!originIsAbsolute) {
			bounds = _getBBox(target);
			xOrigin = bounds.x + (~originSplit[0].indexOf("%") ? xOrigin / 100 * bounds.width : xOrigin);
			yOrigin = bounds.y + (~((originSplit[1] || originSplit[0]).indexOf("%")) ? yOrigin / 100 * bounds.height : yOrigin);
		} else if (matrix !== _identity2DMatrix && (determinant = (a * d - b * c))) { //if it's zero (like if scaleX and scaleY are zero), skip it to avoid errors with dividing by zero.
			x = xOrigin * (d / determinant) + yOrigin * (-c / determinant) + ((c * ty - d * tx) / determinant);
			y = xOrigin * (-b / determinant) + yOrigin * (a / determinant) - ((a * ty - b * tx) / determinant);
			xOrigin = x;
			yOrigin = y;
		}
		if (smooth || (smooth !== false && cache.smooth)) {
			tx = xOrigin - xOriginOld;
			ty = yOrigin - yOriginOld;
			cache.xOffset = xOffsetOld + (tx * a + ty * c) - tx;
			cache.yOffset = yOffsetOld + (tx * b + ty * d) - ty;
		} else {
			cache.xOffset = cache.yOffset = 0;
		}
		cache.xOrigin = xOrigin;
		cache.yOrigin = yOrigin;
		cache.smooth = !!smooth;
		cache.origin = origin;
		cache.originIsAbsolute = !!originIsAbsolute;
		target.style[_transformOriginProp] = "0px 0px"; //otherwise, if someone sets  an origin via CSS, it will likely interfere with the SVG transform attribute ones (because remember, we're baking the origin into the matrix() value).
		if (pluginToAddPropTweensTo) {
			_addNonTweeningPT(pluginToAddPropTweensTo, cache, "xOrigin", xOriginOld, xOrigin);
			_addNonTweeningPT(pluginToAddPropTweensTo, cache, "yOrigin", yOriginOld, yOrigin);
			_addNonTweeningPT(pluginToAddPropTweensTo, cache, "xOffset", xOffsetOld, cache.xOffset);
			_addNonTweeningPT(pluginToAddPropTweensTo, cache, "yOffset", yOffsetOld, cache.yOffset);
		}
		target.setAttribute("data-svg-origin", xOrigin + " " + yOrigin);
	},
	_parseTransform = (target, uncache) => {
		let cache = target._gsap || new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.GSCache(target);
		if ("x" in cache && !uncache && !cache.uncache) {
			return cache;
		}
		let style = target.style,
			invertedScaleX = cache.scaleX < 0,
			px = "px",
			deg = "deg",
			origin = _getComputedProperty(target, _transformOriginProp) || "0",
			x, y, z, scaleX, scaleY, rotation, rotationX, rotationY, skewX, skewY, perspective, xOrigin, yOrigin,
			matrix, angle, cos, sin, a, b, c, d, a12, a22, t1, t2, t3, a13, a23, a33, a42, a43, a32;
		x = y = z = rotation = rotationX = rotationY = skewX = skewY = perspective = 0;
		scaleX = scaleY = 1;
		cache.svg = !!(target.getCTM && _isSVG(target));
		matrix = _getMatrix(target, cache.svg);
		if (cache.svg) {
			t1 = !cache.uncache && !uncache && target.getAttribute("data-svg-origin");
			_applySVGOrigin(target, t1 || origin, !!t1 || cache.originIsAbsolute, cache.smooth !== false, matrix);
		}
		xOrigin = cache.xOrigin || 0;
		yOrigin = cache.yOrigin || 0;
		if (matrix !== _identity2DMatrix) {
			a = matrix[0]; //a11
			b = matrix[1]; //a21
			c = matrix[2]; //a31
			d = matrix[3]; //a41
			x = a12 = matrix[4];
			y = a22 = matrix[5];

			//2D matrix
			if (matrix.length === 6) {
				scaleX = Math.sqrt(a * a + b * b);
				scaleY = Math.sqrt(d * d + c * c);
				rotation = (a || b) ? _atan2(b, a) * _RAD2DEG : 0; //note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn't exist).
				skewX = (c || d) ? _atan2(c, d) * _RAD2DEG + rotation : 0;
				skewX && (scaleY *= Math.abs(Math.cos(skewX * _DEG2RAD)));
				if (cache.svg) {
					x -= xOrigin - (xOrigin * a + yOrigin * c);
					y -= yOrigin - (xOrigin * b + yOrigin * d);
				}

			//3D matrix
			} else {
				a32 = matrix[6];
				a42 = matrix[7];
				a13 = matrix[8];
				a23 = matrix[9];
				a33 = matrix[10];
				a43 = matrix[11];
				x = matrix[12];
				y = matrix[13];
				z = matrix[14];

				angle = _atan2(a32, a33);
				rotationX = angle * _RAD2DEG;
				//rotationX
				if (angle) {
					cos = Math.cos(-angle);
					sin = Math.sin(-angle);
					t1 = a12*cos+a13*sin;
					t2 = a22*cos+a23*sin;
					t3 = a32*cos+a33*sin;
					a13 = a12*-sin+a13*cos;
					a23 = a22*-sin+a23*cos;
					a33 = a32*-sin+a33*cos;
					a43 = a42*-sin+a43*cos;
					a12 = t1;
					a22 = t2;
					a32 = t3;
				}
				//rotationY
				angle = _atan2(-c, a33);
				rotationY = angle * _RAD2DEG;
				if (angle) {
					cos = Math.cos(-angle);
					sin = Math.sin(-angle);
					t1 = a*cos-a13*sin;
					t2 = b*cos-a23*sin;
					t3 = c*cos-a33*sin;
					a43 = d*sin+a43*cos;
					a = t1;
					b = t2;
					c = t3;
				}
				//rotationZ
				angle = _atan2(b, a);
				rotation = angle * _RAD2DEG;
				if (angle) {
					cos = Math.cos(angle);
					sin = Math.sin(angle);
					t1 = a*cos+b*sin;
					t2 = a12*cos+a22*sin;
					b = b*cos-a*sin;
					a22 = a22*cos-a12*sin;
					a = t1;
					a12 = t2;
				}

				if (rotationX && Math.abs(rotationX) + Math.abs(rotation) > 359.9) { //when rotationY is set, it will often be parsed as 180 degrees different than it should be, and rotationX and rotation both being 180 (it looks the same), so we adjust for that here.
					rotationX = rotation = 0;
					rotationY = 180 - rotationY;
				}
				scaleX = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(Math.sqrt(a * a + b * b + c * c));
				scaleY = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(Math.sqrt(a22 * a22 + a32 * a32));
				angle = _atan2(a12, a22);
				skewX = (Math.abs(angle) > 0.0002) ? angle * _RAD2DEG : 0;
				perspective = a43 ? 1 / ((a43 < 0) ? -a43 : a43) : 0;
			}

			if (cache.svg) { //sense if there are CSS transforms applied on an SVG element in which case we must overwrite them when rendering. The transform attribute is more reliable cross-browser, but we can't just remove the CSS ones because they may be applied in a CSS rule somewhere (not just inline).
				t1 = target.getAttribute("transform");
				cache.forceCSS = target.setAttribute("transform", "") || (!_isNullTransform(_getComputedProperty(target, _transformProp)));
				t1 && target.setAttribute("transform", t1);
			}
		}

		if (Math.abs(skewX) > 90 && Math.abs(skewX) < 270) {
			if (invertedScaleX) {
				scaleX *= -1;
				skewX += (rotation <= 0) ? 180 : -180;
				rotation += (rotation <= 0) ? 180 : -180;
			} else {
				scaleY *= -1;
				skewX += (skewX <= 0) ? 180 : -180;
			}
		}
		cache.x = x - ((cache.xPercent = x && (cache.xPercent || (Math.round(target.offsetWidth / 2) === Math.round(-x) ? -50 : 0))) ? target.offsetWidth * cache.xPercent / 100 : 0) + px;
		cache.y = y - ((cache.yPercent = y && (cache.yPercent || (Math.round(target.offsetHeight / 2) === Math.round(-y) ? -50 : 0))) ? target.offsetHeight * cache.yPercent / 100 : 0) + px;
		cache.z = z + px;
		cache.scaleX = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(scaleX);
		cache.scaleY = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(scaleY);
		cache.rotation = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(rotation) + deg;
		cache.rotationX = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(rotationX) + deg;
		cache.rotationY = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(rotationY) + deg;
		cache.skewX = skewX + deg;
		cache.skewY = skewY + deg;
		cache.transformPerspective = perspective + px;
		if ((cache.zOrigin = parseFloat(origin.split(" ")[2]) || 0)) {
			style[_transformOriginProp] = _firstTwoOnly(origin);
		}
		cache.xOffset = cache.yOffset = 0;
		cache.force3D = _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.force3D;
		cache.renderTransform = cache.svg ? _renderSVGTransforms : _supports3D ? _renderCSSTransforms : _renderNon3DTransforms;
		cache.uncache = 0;
		return cache;
	},
	_firstTwoOnly = value => (value = value.split(" "))[0] + " " + value[1], //for handling transformOrigin values, stripping out the 3rd dimension
	_addPxTranslate = (target, start, value) => {
		let unit = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(start);
		return (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(parseFloat(start) + parseFloat(_convertToUnit(target, "x", value + "px", unit))) + unit;
	},
	_renderNon3DTransforms = (ratio, cache) => {
		cache.z = "0px";
		cache.rotationY = cache.rotationX = "0deg";
		cache.force3D = 0;
		_renderCSSTransforms(ratio, cache);
	},
	_zeroDeg = "0deg",
	_zeroPx = "0px",
	_endParenthesis = ") ",
	_renderCSSTransforms = function(ratio, cache) {
		let {xPercent, yPercent, x, y, z, rotation, rotationY, rotationX, skewX, skewY, scaleX, scaleY, transformPerspective, force3D, target, zOrigin} = cache || this,
			transforms = "",
			use3D = (force3D === "auto" && ratio && ratio !== 1) || force3D === true;

		// Safari has a bug that causes it not to render 3D transform-origin values properly, so we force the z origin to 0, record it in the cache, and then do the math here to offset the translate values accordingly (basically do the 3D transform-origin part manually)
		if (zOrigin && (rotationX !== _zeroDeg || rotationY !== _zeroDeg)) {
			let angle = parseFloat(rotationY) * _DEG2RAD,
				a13 = Math.sin(angle),
				a33 = Math.cos(angle),
				cos;
			angle = parseFloat(rotationX) * _DEG2RAD;
			cos = Math.cos(angle);
			x = _addPxTranslate(target, x, a13 * cos * -zOrigin);
			y = _addPxTranslate(target, y, -Math.sin(angle) * -zOrigin);
			z = _addPxTranslate(target, z, a33 * cos * -zOrigin + zOrigin);
		}

		if (transformPerspective !== _zeroPx) {
			transforms += "perspective(" + transformPerspective + _endParenthesis;
		}
		if (xPercent || yPercent) {
			transforms += "translate(" + xPercent + "%, " + yPercent + "%) ";
		}
		if (use3D || x !== _zeroPx || y !== _zeroPx || z !== _zeroPx) {
			transforms += (z !== _zeroPx || use3D) ? "translate3d(" + x + ", " + y + ", " + z + ") " : "translate(" + x + ", " + y + _endParenthesis;
		}
		if (rotation !== _zeroDeg) {
			transforms += "rotate(" + rotation + _endParenthesis;
		}
		if (rotationY !== _zeroDeg) {
			transforms += "rotateY(" + rotationY + _endParenthesis;
		}
		if (rotationX !== _zeroDeg) {
			transforms += "rotateX(" + rotationX + _endParenthesis;
		}
		if (skewX !== _zeroDeg || skewY !== _zeroDeg) {
			transforms += "skew(" + skewX + ", " + skewY + _endParenthesis;
		}
		if (scaleX !== 1 || scaleY !== 1) {
			transforms += "scale(" + scaleX + ", " + scaleY + _endParenthesis;
		}
		target.style[_transformProp] = transforms || "translate(0, 0)";
	},
	_renderSVGTransforms = function(ratio, cache) {
		let {xPercent, yPercent, x, y, rotation, skewX, skewY, scaleX, scaleY, target, xOrigin, yOrigin, xOffset, yOffset, forceCSS} = cache || this,
			tx = parseFloat(x),
			ty = parseFloat(y),
			a11, a21, a12, a22, temp;
		rotation = parseFloat(rotation);
		skewX = parseFloat(skewX);
		skewY = parseFloat(skewY);
		if (skewY) { //for performance reasons, we combine all skewing into the skewX and rotation values. Remember, a skewY of 10 degrees looks the same as a rotation of 10 degrees plus a skewX of 10 degrees.
			skewY = parseFloat(skewY);
			skewX += skewY;
			rotation += skewY;
		}
		if (rotation || skewX) {
			rotation *= _DEG2RAD;
			skewX *= _DEG2RAD;
			a11 = Math.cos(rotation) * scaleX;
			a21 = Math.sin(rotation) * scaleX;
			a12 = Math.sin(rotation - skewX) * -scaleY;
			a22 = Math.cos(rotation - skewX) * scaleY;
			if (skewX) {
				skewY *= _DEG2RAD;
				temp = Math.tan(skewX - skewY);
				temp = Math.sqrt(1 + temp * temp);
				a12 *= temp;
				a22 *= temp;
				if (skewY) {
					temp = Math.tan(skewY);
					temp = Math.sqrt(1 + temp * temp);
					a11 *= temp;
					a21 *= temp;
				}
			}
			a11 = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(a11);
			a21 = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(a21);
			a12 = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(a12);
			a22 = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(a22);
		} else {
			a11 = scaleX;
			a22 = scaleY;
			a21 = a12 = 0;
		}
		if ((tx && !~(x + "").indexOf("px")) || (ty && !~(y + "").indexOf("px"))) {
			tx = _convertToUnit(target, "x", x, "px");
			ty = _convertToUnit(target, "y", y, "px");
		}
		if (xOrigin || yOrigin || xOffset || yOffset) {
			tx = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(tx + xOrigin - (xOrigin * a11 + yOrigin * a12) + xOffset);
			ty = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(ty + yOrigin - (xOrigin * a21 + yOrigin * a22) + yOffset);
		}
		if (xPercent || yPercent) {
			//The SVG spec doesn't support percentage-based translation in the "transform" attribute, so we merge it into the translation to simulate it.
			temp = target.getBBox();
			tx = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(tx + xPercent / 100 * temp.width);
			ty = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._round)(ty + yPercent / 100 * temp.height);
		}
		temp = "matrix(" + a11 + "," + a21 + "," + a12 + "," + a22 + "," + tx + "," + ty + ")";
		target.setAttribute("transform", temp);
		forceCSS && (target.style[_transformProp] = temp); //some browsers prioritize CSS transforms over the transform attribute. When we sense that the user has CSS transforms applied, we must overwrite them this way (otherwise some browser simply won't render the  transform attribute changes!)
	},
	_addRotationalPropTween = function(plugin, target, property, startNum, endValue, relative) {
		let cap = 360,
			isString = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._isString)(endValue),
			endNum = parseFloat(endValue) * ((isString && ~endValue.indexOf("rad")) ? _RAD2DEG : 1),
			change = relative ? endNum * relative : endNum - startNum,
			finalValue = (startNum + change) + "deg",
			direction, pt;
		if (isString) {
			direction = endValue.split("_")[1];
			if (direction === "short") {
				change %= cap;
				if (change !== change % (cap / 2)) {
					change += (change < 0) ? cap : -cap;
				}
			}
			if (direction === "cw" && change < 0) {
				change = ((change + cap * _bigNum) % cap) - ~~(change / cap) * cap;
			} else if (direction === "ccw" && change > 0) {
				change = ((change - cap * _bigNum) % cap) - ~~(change / cap) * cap;
			}
		}
		plugin._pt = pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(plugin._pt, target, property, startNum, change, _renderPropWithEnd);
		pt.e = finalValue;
		pt.u = "deg";
		plugin._props.push(property);
		return pt;
	},
	_assign = (target, source) => { // Internet Explorer doesn't have Object.assign(), so we recreate it here.
		for (let p in source) {
			target[p] = source[p];
		}
		return target;
	},
	_addRawTransformPTs = (plugin, transforms, target) => { //for handling cases where someone passes in a whole transform string, like transform: "scale(2, 3) rotate(20deg) translateY(30em)"
		let startCache = _assign({}, target._gsap),
			exclude = "perspective,force3D,transformOrigin,svgOrigin",
			style = target.style,
			endCache, p, startValue, endValue, startNum, endNum, startUnit, endUnit;
		if (startCache.svg) {
			startValue = target.getAttribute("transform");
			target.setAttribute("transform", "");
			style[_transformProp] = transforms;
			endCache = _parseTransform(target, 1);
			_removeProperty(target, _transformProp);
			target.setAttribute("transform", startValue);
		} else {
			startValue = getComputedStyle(target)[_transformProp];
			style[_transformProp] = transforms;
			endCache = _parseTransform(target, 1);
			style[_transformProp] = startValue;
		}
		for (p in _transformProps) {
			startValue = startCache[p];
			endValue = endCache[p];
			if (startValue !== endValue && exclude.indexOf(p) < 0) { //tweening to no perspective gives very unintuitive results - just keep the same perspective in that case.
				startUnit = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(startValue);
				endUnit = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(endValue);
				startNum = (startUnit !== endUnit) ? _convertToUnit(target, p, startValue, endUnit) : parseFloat(startValue);
				endNum = parseFloat(endValue);
				plugin._pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(plugin._pt, endCache, p, startNum, endNum - startNum, _renderCSSProp);
				plugin._pt.u = endUnit || 0;
				plugin._props.push(p);
			}
		}
		_assign(endCache, startCache);
	};

// handle splitting apart padding, margin, borderWidth, and borderRadius into their 4 components. Firefox, for example, won't report borderRadius correctly - it will only do borderTopLeftRadius and the other corners. We also want to handle paddingTop, marginLeft, borderRightWidth, etc.
(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._forEachName)("padding,margin,Width,Radius", (name, index) => {
	let t = "Top",
		r = "Right",
		b = "Bottom",
		l = "Left",
		props = (index < 3 ? [t,r,b,l] : [t+l, t+r, b+r, b+l]).map(side => index < 2 ? name + side : "border" + side + name);
	_specialProps[(index > 1 ? "border" + name : name)] = function(plugin, target, property, endValue, tween) {
		let a, vars;
		if (arguments.length < 4) { // getter, passed target, property, and unit (from _get())
			a = props.map(prop => _get(plugin, prop, property));
			vars = a.join(" ");
			return vars.split(a[0]).length === 5 ? a[0] : vars;
		}
		a = (endValue + "").split(" ");
		vars = {};
		props.forEach((prop, i) => vars[prop] = a[i] = a[i] || a[(((i - 1) / 2) | 0)]);
		plugin.init(target, vars, tween);
	}
});


const CSSPlugin = {
	name: "css",
	register: _initCore,
	targetTest(target) {
		return target.style && target.nodeType;
	},
	init(target, vars, tween, index, targets) {
		let props = this._props,
			style = target.style,
			startAt = tween.vars.startAt,
			startValue, endValue, endNum, startNum, type, specialProp, p, startUnit, endUnit, relative, isTransformRelated, transformPropTween, cache, smooth, hasPriority;
		_pluginInitted || _initCore();
		for (p in vars) {
			if (p === "autoRound") {
				continue;
			}
			endValue = vars[p];
			if (_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._plugins[p] && (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._checkPlugin)(p, vars, tween, index, target, targets)) { // plugins
				continue;
			}
			type = typeof(endValue);
			specialProp = _specialProps[p];
			if (type === "function") {
				endValue = endValue.call(tween, index, target, targets);
				type = typeof(endValue);
			}
			if (type === "string" && ~endValue.indexOf("random(")) {
				endValue = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._replaceRandom)(endValue);
			}
			if (specialProp) {
				specialProp(this, target, p, endValue, tween) && (hasPriority = 1);
			} else if (p.substr(0,2) === "--") { //CSS variable
				startValue = (getComputedStyle(target).getPropertyValue(p) + "").trim();
				endValue += "";
				_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._colorExp.lastIndex = 0;
				if (!_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._colorExp.test(startValue)) { // colors don't have units
					startUnit = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(startValue);
					endUnit = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(endValue);
				}
				endUnit ? startUnit !== endUnit && (startValue = _convertToUnit(target, p, startValue, endUnit) + endUnit) : startUnit && (endValue += startUnit);
				this.add(style, "setProperty", startValue, endValue, index, targets, 0, 0, p);
			} else if (type !== "undefined") {
				if (startAt && p in startAt) { // in case someone hard-codes a complex value as the start, like top: "calc(2vh / 2)". Without this, it'd use the computed value (always in px)
					startValue = typeof(startAt[p]) === "function" ? startAt[p].call(tween, index, target, targets) : startAt[p];
					(p in _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units) && !(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(startValue) && (startValue += _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units[p]); // for cases when someone passes in a unitless value like {x: 100}; if we try setting translate(100, 0px) it won't work.
					(startValue + "").charAt(1) === "=" && (startValue = _get(target, p)); // can't work with relative values
				} else {
					startValue = _get(target, p);
				}
				startNum = parseFloat(startValue);
				relative = (type === "string" && endValue.charAt(1) === "=") ? +(endValue.charAt(0) + "1") : 0;
				relative && (endValue = endValue.substr(2));
				endNum = parseFloat(endValue);
				if (p in _propertyAliases) {
					if (p === "autoAlpha") { //special case where we control the visibility along with opacity. We still allow the opacity value to pass through and get tweened.
						if (startNum === 1 && _get(target, "visibility") === "hidden" && endNum) { //if visibility is initially set to "hidden", we should interpret that as intent to make opacity 0 (a convenience)
							startNum = 0;
						}
						_addNonTweeningPT(this, style, "visibility", startNum ? "inherit" : "hidden", endNum ? "inherit" : "hidden", !endNum);
					}
					if (p !== "scale" && p !== "transform") {
						p = _propertyAliases[p];
						~p.indexOf(",") && (p = p.split(",")[0]);
					}
				}

				isTransformRelated = (p in _transformProps);

				//--- TRANSFORM-RELATED ---
				if (isTransformRelated) {
					if (!transformPropTween) {
						cache = target._gsap;
						(cache.renderTransform && !vars.parseTransform) || _parseTransform(target, vars.parseTransform); // if, for example, gsap.set(... {transform:"translateX(50vw)"}), the _get() call doesn't parse the transform, thus cache.renderTransform won't be set yet so force the parsing of the transform here.
						smooth = (vars.smoothOrigin !== false && cache.smooth);
						transformPropTween = this._pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(this._pt, style, _transformProp, 0, 1, cache.renderTransform, cache, 0, -1); //the first time through, create the rendering PropTween so that it runs LAST (in the linked list, we keep adding to the beginning)
						transformPropTween.dep = 1; //flag it as dependent so that if things get killed/overwritten and this is the only PropTween left, we can safely kill the whole tween.
					}
					if (p === "scale") {
						this._pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(this._pt, cache, "scaleY", cache.scaleY, relative ? relative * endNum : endNum - cache.scaleY);
						props.push("scaleY", p);
						p += "X";
					} else if (p === "transformOrigin") {
						endValue = _convertKeywordsToPercentages(endValue); //in case something like "left top" or "bottom right" is passed in. Convert to percentages.
						if (cache.svg) {
							_applySVGOrigin(target, endValue, 0, smooth, 0, this);
						} else {
							endUnit = parseFloat(endValue.split(" ")[2]) || 0; //handle the zOrigin separately!
							endUnit !== cache.zOrigin && _addNonTweeningPT(this, cache, "zOrigin", cache.zOrigin, endUnit);
							_addNonTweeningPT(this, style, p, _firstTwoOnly(startValue), _firstTwoOnly(endValue));
						}
						continue;
					} else if (p === "svgOrigin") {
						_applySVGOrigin(target, endValue, 1, smooth, 0, this);
						continue;
					} else if (p in _rotationalProperties) {
						_addRotationalPropTween(this, cache, p, startNum, endValue, relative);
						continue;

					} else if (p === "smoothOrigin") {
						_addNonTweeningPT(this, cache, "smooth", cache.smooth, endValue);
						continue;
					} else if (p === "force3D") {
						cache[p] = endValue;
						continue;
					} else if (p === "transform") {
						_addRawTransformPTs(this, endValue, target);
						continue;
					}
				} else if (!(p in style)) {
					p = _checkPropPrefix(p) || p;
				}

				if (isTransformRelated || ((endNum || endNum === 0) && (startNum || startNum === 0) && !_complexExp.test(endValue) && (p in style))) {
					startUnit = (startValue + "").substr((startNum + "").length);
					endNum || (endNum = 0); // protect against NaN
					endUnit = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.getUnit)(endValue) || ((p in _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units) ? _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units[p] : startUnit);
					startUnit !== endUnit && (startNum = _convertToUnit(target, p, startValue, endUnit));
					this._pt = new _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.PropTween(this._pt, isTransformRelated ? cache : style, p, startNum, relative ? relative * endNum : endNum - startNum, (!isTransformRelated && (endUnit === "px" || p === "zIndex") && vars.autoRound !== false) ? _renderRoundedCSSProp : _renderCSSProp);
					this._pt.u = endUnit || 0;
					if (startUnit !== endUnit) { //when the tween goes all the way back to the beginning, we need to revert it to the OLD/ORIGINAL value (with those units). We record that as a "b" (beginning) property and point to a render method that handles that. (performance optimization)
						this._pt.b = startValue;
						this._pt.r = _renderCSSPropWithBeginning;
					}
				} else if (!(p in style)) {
					if (p in target) { //maybe it's not a style - it could be a property added directly to an element in which case we'll try to animate that.
						this.add(target, p, target[p], endValue, index, targets);
					} else {
						(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._missingPlugin)(p, endValue);
						continue;
					}
				} else {
					_tweenComplexCSSString.call(this, target, p, startValue, endValue);
				}
				props.push(p);
			}
		}
		hasPriority && (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._sortPropTweensByPriority)(this);

	},
	get: _get,
	aliases: _propertyAliases,
	getSetter(target, property, plugin) { //returns a setter function that accepts target, property, value and applies it accordingly. Remember, properties like "x" aren't as simple as target.style.property = value because they've got to be applied to a proxy object and then merged into a transform string in a renderer.
		let p = _propertyAliases[property];
		(p && p.indexOf(",") < 0) && (property = p);
		return (property in _transformProps && property !== _transformOriginProp && (target._gsap.x || _get(target, "x"))) ? (plugin && _recentSetterPlugin === plugin ? (property === "scale" ? _setterScale : _setterTransform) : (_recentSetterPlugin = plugin || {}) && (property === "scale" ? _setterScaleWithRender : _setterTransformWithRender)) : target.style && !(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._isUndefined)(target.style[property]) ? _setterCSSStyle : ~property.indexOf("-") ? _setterCSSProp : (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._getSetter)(target, property);
	},
	core: { _removeProperty, _getMatrix }

};

_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.gsap.utils.checkPrefix = _checkPropPrefix;
(function(positionAndScale, rotation, others, aliases) {
	let all = (0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._forEachName)(positionAndScale + "," + rotation + "," + others, name => {_transformProps[name] = 1});
	(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._forEachName)(rotation, name => {_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units[name] = "deg"; _rotationalProperties[name] = 1});
	_propertyAliases[all[13]] = positionAndScale + "," + rotation;
	(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._forEachName)(aliases, name => {
		let split = name.split(":");
		_propertyAliases[split[1]] = all[split[0]];
	});
})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent", "rotation,rotationX,rotationY,skewX,skewY", "transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective", "0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");
(0,_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._forEachName)("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective", name => {_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__._config.units[name] = "px"});

_gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.gsap.registerPlugin(CSSPlugin);



/***/ }),

/***/ "./node_modules/gsap/src/ScrollToPlugin.js":
/*!*************************************************!*\
  !*** ./node_modules/gsap/src/ScrollToPlugin.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ScrollToPlugin: () => (/* binding */ ScrollToPlugin),
/* harmony export */   "default": () => (/* binding */ ScrollToPlugin)
/* harmony export */ });
/*!
 * ScrollToPlugin 3.6.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/* eslint-disable */

let gsap, _coreInitted, _window, _docEl, _body, _toArray, _config,
	_windowExists = () => typeof(window) !== "undefined",
	_getGSAP = () => gsap || (_windowExists() && (gsap = window.gsap) && gsap.registerPlugin && gsap),
	_isString = value => typeof(value) === "string",
	_isFunction = value => typeof(value) === "function",
	_max = (element, axis) => {
		let dim = (axis === "x") ? "Width" : "Height",
			scroll = "scroll" + dim,
			client = "client" + dim;
		return (element === _window || element === _docEl || element === _body) ? Math.max(_docEl[scroll], _body[scroll]) - (_window["inner" + dim] || _docEl[client] || _body[client]) : element[scroll] - element["offset" + dim];
	},
	_buildGetter = (e, axis) => { //pass in an element and an axis ("x" or "y") and it'll return a getter function for the scroll position of that element (like scrollTop or scrollLeft, although if the element is the window, it'll use the pageXOffset/pageYOffset or the documentElement's scrollTop/scrollLeft or document.body's. Basically this streamlines things and makes a very fast getter across browsers.
		let p = "scroll" + ((axis === "x") ? "Left" : "Top");
		if (e === _window) {
			if (e.pageXOffset != null) {
				p = "page" + axis.toUpperCase() + "Offset";
			} else {
				e = _docEl[p] != null ? _docEl : _body;
			}
		}
		return () => e[p];
	},
	_clean = (value, index, target, targets) => {
		_isFunction(value) && (value = value(index, target, targets));
		if (typeof(value) !== "object") {
			return _isString(value) && value !== "max" && value.charAt(1) !== "=" ? {x: value, y: value} : {y: value}; //if we don't receive an object as the parameter, assume the user intends "y".
		} else if (value.nodeType) {
			return {y: value, x: value};
		} else {
			let result = {}, p;
			for (p in value) {
				result[p] = p !== "onAutoKill" && _isFunction(value[p]) ? value[p](index, target, targets) : value[p];
			}
			return result;
		}
	},
	_getOffset = (element, container) => {
		element = _toArray(element)[0];
		if (!element || !element.getBoundingClientRect) {
			return console.warn("scrollTo target doesn't exist. Using 0") || {x:0, y:0};
		}
		let rect = element.getBoundingClientRect(),
			isRoot = (!container || container === _window || container === _body),
			cRect = isRoot ? {top:_docEl.clientTop - (_window.pageYOffset || _docEl.scrollTop || _body.scrollTop || 0), left:_docEl.clientLeft - (_window.pageXOffset || _docEl.scrollLeft || _body.scrollLeft || 0)} : container.getBoundingClientRect(),
			offsets = {x: rect.left - cRect.left, y: rect.top - cRect.top};
		if (!isRoot && container) { //only add the current scroll position if it's not the window/body.
			offsets.x += _buildGetter(container, "x")();
			offsets.y += _buildGetter(container, "y")();
		}
		return offsets;
	},
	_parseVal = (value, target, axis, currentVal, offset) => !isNaN(value) && typeof(value) !== "object" ? parseFloat(value) - offset : (_isString(value) && value.charAt(1) === "=") ? parseFloat(value.substr(2)) * (value.charAt(0) === "-" ? -1 : 1) + currentVal - offset : (value === "max") ? _max(target, axis) - offset : Math.min(_max(target, axis), _getOffset(value, target)[axis] - offset),
	_initCore = () => {
		gsap = _getGSAP();
		if (_windowExists() && gsap && document.body) {
			_window = window;
			_body = document.body;
			_docEl = document.documentElement;
			_toArray = gsap.utils.toArray;
			gsap.config({autoKillThreshold:7});
			_config = gsap.config();
			_coreInitted = 1;
		}
	};


const ScrollToPlugin = {
	version: "3.6.1",
	name: "scrollTo",
	rawVars: 1,
	register(core) {
		gsap = core;
		_initCore();
	},
	init(target, value, tween, index, targets) {
		_coreInitted || _initCore();
		let data = this;
		data.isWin = (target === _window);
		data.target = target;
		data.tween = tween;
		value = _clean(value, index, target, targets);
		data.vars = value;
		data.autoKill = !!value.autoKill;
		data.getX = _buildGetter(target, "x");
		data.getY = _buildGetter(target, "y");
		data.x = data.xPrev = data.getX();
		data.y = data.yPrev = data.getY();
		if (value.x != null) {
			data.add(data, "x", data.x, _parseVal(value.x, target, "x", data.x, value.offsetX || 0), index, targets);
			data._props.push("scrollTo_x");
		} else {
			data.skipX = 1;
		}
		if (value.y != null) {
			data.add(data, "y", data.y, _parseVal(value.y, target, "y", data.y, value.offsetY || 0), index, targets);
			data._props.push("scrollTo_y");
		} else {
			data.skipY = 1;
		}
	},
	render(ratio, data) {
		let pt = data._pt,
			{ target, tween, autoKill, xPrev, yPrev, isWin } = data,
			x, y, yDif, xDif, threshold;
		while (pt) {
			pt.r(ratio, pt.d);
			pt = pt._next;
		}
		x = (isWin || !data.skipX) ? data.getX() : xPrev;
		y = (isWin || !data.skipY) ? data.getY() : yPrev;
		yDif = y - yPrev;
		xDif = x - xPrev;
		threshold = _config.autoKillThreshold;
		if (data.x < 0) { //can't scroll to a position less than 0! Might happen if someone uses a Back.easeOut or Elastic.easeOut when scrolling back to the top of the page (for example)
			data.x = 0;
		}
		if (data.y < 0) {
			data.y = 0;
		}
		if (autoKill) {
			//note: iOS has a bug that throws off the scroll by several pixels, so we need to check if it's within 7 pixels of the previous one that we set instead of just looking for an exact match.
			if (!data.skipX && (xDif > threshold || xDif < -threshold) && x < _max(target, "x")) {
				data.skipX = 1; //if the user scrolls separately, we should stop tweening!
			}
			if (!data.skipY && (yDif > threshold || yDif < -threshold) && y < _max(target, "y")) {
				data.skipY = 1; //if the user scrolls separately, we should stop tweening!
			}
			if (data.skipX && data.skipY) {
				tween.kill();
				data.vars.onAutoKill && data.vars.onAutoKill.apply(tween, data.vars.onAutoKillParams || []);
			}
		}
		if (isWin) {
			_window.scrollTo((!data.skipX) ? data.x : x, (!data.skipY) ? data.y : y);
		} else {
			data.skipY || (target.scrollTop = data.y);
			data.skipX || (target.scrollLeft = data.x);
		}
		data.xPrev = data.x;
		data.yPrev = data.y;
	},
	kill(property) {
		let both = (property === "scrollTo");
		if (both || property === "scrollTo_x") {
			this.skipX = 1;
		}
		if (both || property === "scrollTo_y") {
			this.skipY = 1;
		}
	}
};

ScrollToPlugin.max = _max;
ScrollToPlugin.getOffset = _getOffset;
ScrollToPlugin.buildGetter = _buildGetter;

_getGSAP() && gsap.registerPlugin(ScrollToPlugin);



/***/ }),

/***/ "./node_modules/gsap/src/ScrollTrigger.js":
/*!************************************************!*\
  !*** ./node_modules/gsap/src/ScrollTrigger.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ScrollTrigger: () => (/* binding */ ScrollTrigger),
/* harmony export */   "default": () => (/* binding */ ScrollTrigger)
/* harmony export */ });
/*!
 * ScrollTrigger 3.6.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/* eslint-disable */

let gsap, _coreInitted, _win, _doc, _docEl, _body, _root, _resizeDelay, _raf, _request, _toArray, _clamp, _time2, _syncInterval, _refreshing, _pointerIsDown, _transformProp, _i, _prevWidth, _prevHeight, _autoRefresh, _sort, _suppressOverwrites, _ignoreResize,
	_limitCallbacks, // if true, we'll only trigger callbacks if the active state toggles, so if you scroll immediately past both the start and end positions of a ScrollTrigger (thus inactive to inactive), neither its onEnter nor onLeave will be called. This is useful during startup.
	_startup = 1,
	_proxies = [],
	_scrollers = [],
	_getTime = Date.now,
	_time1 = _getTime(),
	_lastScrollTime = 0,
	_enabled = 1,
	_passThrough = v => v,
	_round = value => Math.round(value * 100000) / 100000 || 0,
	_windowExists = () => typeof(window) !== "undefined",
	_getGSAP = () => gsap || (_windowExists() && (gsap = window.gsap) && gsap.registerPlugin && gsap),
	_isViewport = e => !!~_root.indexOf(e),
	_getProxyProp = (element, property) => ~_proxies.indexOf(element) && _proxies[_proxies.indexOf(element) + 1][property],
	_getScrollFunc = (element, {s, sc}) => {
		let i = _scrollers.indexOf(element),
			offset = sc === _vertical.sc ? 1 : 2;
		!~i && (i = _scrollers.push(element) - 1);
		return _scrollers[i + offset] || (_scrollers[i + offset] = _getProxyProp(element, s) || (_isViewport(element) ? sc : function(value) { return arguments.length ? (element[s] = value) : element[s]; }));
	},
	_getBoundsFunc = element => _getProxyProp(element, "getBoundingClientRect") || (_isViewport(element) ? () => {_winOffsets.width = _win.innerWidth; _winOffsets.height = _win.innerHeight; return _winOffsets;} : () => _getBounds(element)),
	_getSizeFunc = (scroller, isViewport, {d, d2, a}) => (a = _getProxyProp(scroller, "getBoundingClientRect")) ? () => a()[d] : () => (isViewport ? _win["inner" + d2] : scroller["client" + d2]) || 0,
	_getOffsetsFunc = (element, isViewport) => !isViewport || ~_proxies.indexOf(element) ? _getBoundsFunc(element) : () => _winOffsets,
	_maxScroll = (element, {s, d2, d, a}) => (s = "scroll" + d2) && (a = _getProxyProp(element, s)) ? a() - _getBoundsFunc(element)()[d] : _isViewport(element) ? Math.max(_docEl[s], _body[s]) - (_win["inner" + d2] || _docEl["client" + d2] || _body["client" + d2]) : element[s] - element["offset" + d2],
	_iterateAutoRefresh = (func, events) => {
		for (let i = 0; i < _autoRefresh.length; i += 3) {
			(!events || ~events.indexOf(_autoRefresh[i+1])) && func(_autoRefresh[i], _autoRefresh[i+1], _autoRefresh[i+2]);
		}
	},
	_isString = value => typeof(value) === "string",
	_isFunction = value => typeof(value) === "function",
	_isNumber = value => typeof(value) === "number",
	_isObject = value => typeof(value) === "object",
	_callIfFunc = value => _isFunction(value) && value(),
	_combineFunc = (f1, f2) => () => {
		let result1 = _callIfFunc(f1),
			result2 = _callIfFunc(f2);
		return () => {
			_callIfFunc(result1);
			_callIfFunc(result2);
		}
	},
	_abs = Math.abs,
	_scrollLeft = "scrollLeft",
	_scrollTop = "scrollTop",
	_left = "left",
	_top = "top",
	_right = "right",
	_bottom = "bottom",
	_width = "width",
	_height = "height",
	_Right = "Right",
	_Left = "Left",
	_Top = "Top",
	_Bottom = "Bottom",
	_padding = "padding",
	_margin = "margin",
	_Width = "Width",
	_Height = "Height",
	_px = "px",
	_horizontal = {s: _scrollLeft, p: _left, p2: _Left, os: _right, os2: _Right, d: _width, d2: _Width, a: "x", sc: function(value) { return arguments.length ? _win.scrollTo(value, _vertical.sc()) : _win.pageXOffset || _doc[_scrollLeft] || _docEl[_scrollLeft] || _body[_scrollLeft] || 0}},
	_vertical = {s: _scrollTop, p: _top, p2: _Top, os: _bottom, os2: _Bottom, d: _height, d2: _Height, a: "y", op: _horizontal, sc: function(value) { return arguments.length ? _win.scrollTo(_horizontal.sc(), value) : _win.pageYOffset || _doc[_scrollTop] || _docEl[_scrollTop] || _body[_scrollTop] || 0}},
	_getComputedStyle = element => _win.getComputedStyle(element),
	_makePositionable = element => element.style.position = (_getComputedStyle(element).position === "absolute") ? "absolute" : "relative", // if the element already has position: absolute, leave that, otherwise make it position: relative
	_setDefaults = (obj, defaults) => {
		for (let p in defaults) {
			(p in obj) || (obj[p] = defaults[p]);
		}
		return obj;
	},
	//_isInViewport = element => (element = _getBounds(element)) && !(element.top > (_win.innerHeight || _docEl.clientHeight) || element.bottom < 0 || element.left > (_win.innerWidth || _docEl.clientWidth) || element.right < 0) && element,
	_getBounds = (element, withoutTransforms) => {
		let tween = withoutTransforms && _getComputedStyle(element)[_transformProp] !== "matrix(1, 0, 0, 1, 0, 0)" && gsap.to(element, {x: 0, y: 0, xPercent: 0, yPercent: 0, rotation: 0, rotationX: 0, rotationY: 0, scale: 1, skewX: 0, skewY: 0}).progress(1),
			bounds = element.getBoundingClientRect();
		tween && tween.progress(0).kill();
		return bounds;
	},
	_getSize = (element, {d2}) => element["offset" + d2] || element["client" + d2] || 0,
	_getLabelRatioArray = timeline => {
		let a = [],
			labels = timeline.labels,
			duration = timeline.duration(),
			p;
		for (p in labels) {
			a.push(labels[p] / duration);
		}
		return a;
	},
	_getClosestLabel = animation => value => gsap.utils.snap(_getLabelRatioArray(animation), value),
	_getLabelAtDirection = timeline => {
		return (value, st) => {
			let a = _getLabelRatioArray(timeline),
				i;
			a.sort((a, b) => a - b);
			if (st.direction > 0) {
				value -= 1e-4; // to avoid rounding errors. If we're too strict, it might snap forward, then immediately again, and again.
				for (i = 0; i < a.length; i++) {
					if (a[i] >= value) {
						return a[i];
					}
				}
				return a.pop();
			} else {
				i = a.length;
				value += 1e-4;
				while (i--) {
					if (a[i] <= value) {
						return a[i];
					}
				}
			}
			return a[0];
		};
	},
	_multiListener = (func, element, types, callback) => types.split(",").forEach(type => func(element, type, callback)),
	_addListener = (element, type, func) => element.addEventListener(type, func, {passive: true}),
	_removeListener = (element, type, func) => element.removeEventListener(type, func),
	_markerDefaults = {startColor: "green", endColor: "red", indent: 0, fontSize: "16px", fontWeight:"normal"},
	_defaults = {toggleActions: "play", anticipatePin: 0},
	_keywords = {top: 0, left: 0, center: 0.5, bottom: 1, right: 1},
	_offsetToPx = (value, size) => {
		if (_isString(value)) {
			let eqIndex = value.indexOf("="),
				relative = ~eqIndex ? +(value.charAt(eqIndex-1) + 1) * parseFloat(value.substr(eqIndex + 1)) : 0;
			if (~eqIndex) {
				(value.indexOf("%") > eqIndex) && (relative *= size / 100);
				value = value.substr(0, eqIndex-1);
			}
			value = relative + ((value in _keywords) ? _keywords[value] * size : ~value.indexOf("%") ? parseFloat(value) * size / 100 : parseFloat(value) || 0);
		}
		return value;
	},
	_createMarker = (type, name, container, direction, {startColor, endColor, fontSize, indent, fontWeight}, offset, matchWidthEl) => {
		let e = _doc.createElement("div"),
			useFixedPosition = _isViewport(container) || _getProxyProp(container, "pinType") === "fixed",
			isScroller = type.indexOf("scroller") !== -1,
			parent = useFixedPosition ? _body : container,
			isStart = type.indexOf("start") !== -1,
			color = isStart ? startColor : endColor,
			css = "border-color:" + color + ";font-size:" + fontSize + ";color:" + color + ";font-weight:" + fontWeight + ";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";
		css += "position:" + (isScroller && useFixedPosition ? "fixed;" : "absolute;");
		(isScroller || !useFixedPosition) && (css += (direction === _vertical ? _right : _bottom) + ":" + (offset + parseFloat(indent)) + "px;");
		matchWidthEl && (css += "box-sizing:border-box;text-align:left;width:" + matchWidthEl.offsetWidth + "px;");
		e._isStart = isStart;
		e.setAttribute("class", "gsap-marker-" + type);
		e.style.cssText = css;
		e.innerText = name || name === 0 ? type + "-" + name : type;
		parent.children[0] ? parent.insertBefore(e, parent.children[0]) : parent.appendChild(e);
		e._offset = e["offset" + direction.op.d2];
		_positionMarker(e, 0, direction, isStart);
		return e;
	},
	_positionMarker = (marker, start, direction, flipped) => {
		let vars = {display: "block"},
			side = direction[flipped ? "os2" : "p2"],
			oppositeSide = direction[flipped ? "p2" : "os2"];
		marker._isFlipped = flipped;
		vars[direction.a + "Percent"] = flipped ? -100 : 0;
		vars[direction.a] = flipped ? "1px" : 0;
		vars["border" + side + _Width] = 1;
		vars["border" + oppositeSide + _Width] = 0;
		vars[direction.p] = start + "px";
		gsap.set(marker, vars);
	},
	_triggers = [],
	_ids = {},
	_sync = () => _request || (_request = _raf(_updateAll)),
	_onScroll = () => {
		if (!_request) {
			_request = _raf(_updateAll);
			_lastScrollTime || _dispatch("scrollStart");
			_lastScrollTime = _getTime();
		}
	},
	_onResize = () => !_refreshing && !_ignoreResize && !_doc.fullscreenElement && _resizeDelay.restart(true), // ignore resizes triggered by refresh()
	_listeners = {},
	_emptyArray = [],
	_media = [],
	_creatingMedia, // when ScrollTrigger.matchMedia() is called, we record the current media key here (like "(min-width: 800px)") so that we can assign it to everything that's created during that call. Then we can revert just those when necessary. In the ScrollTrigger's init() call, the _creatingMedia is recorded as a "media" property on the instance.
	_lastMediaTick,
	_onMediaChange = e => {
		let tick = gsap.ticker.frame,
			matches = [],
			i = 0,
			index;
		if (_lastMediaTick !== tick || _startup) {
			_revertAll();
			for (; i < _media.length; i+=4) {
				index = _win.matchMedia(_media[i]).matches;
				if (index !== _media[i+3]) { // note: some browsers fire the matchMedia event multiple times, like when going full screen, so we shouldn't call the function multiple times. Check to see if it's already matched.
					_media[i+3] = index;
					index ? matches.push(i) : _revertAll(1, _media[i]) || (_isFunction(_media[i+2]) && _media[i+2]()); // Firefox doesn't update the "matches" property of the MediaQueryList object correctly - it only does so as it calls its change handler - so we must re-create a media query here to ensure it's accurate.
				}
			}
			_revertRecorded(); // in case killing/reverting any of the animations actually added inline styles back.
			for (i = 0; i < matches.length; i++) {
				index = matches[i];
				_creatingMedia = _media[index];
				_media[index+2] = _media[index+1](e);
			}
			_creatingMedia = 0;
			_coreInitted && _refreshAll(0, 1);
			_lastMediaTick = tick;
			_dispatch("matchMedia");
		}
	},
	_softRefresh = () => _removeListener(ScrollTrigger, "scrollEnd", _softRefresh) || _refreshAll(true),
	_dispatch = type => (_listeners[type] && _listeners[type].map(f => f())) || _emptyArray,
	_savedStyles = [], // when ScrollTrigger.saveStyles() is called, the inline styles are recorded in this Array in a sequential format like [element, cssText, gsCache, media]. This keeps it very memory-efficient and fast to iterate through.
	_revertRecorded = media => {
		for (let i = 0; i < _savedStyles.length; i+=4) {
			if (!media || _savedStyles[i+3] === media) {
				_savedStyles[i].style.cssText = _savedStyles[i+1];
				_savedStyles[i+2].uncache = 1;
			}
		}
	},
	_revertAll = (kill, media) => {
		let trigger;
		for (_i = 0; _i < _triggers.length; _i++) {
			trigger = _triggers[_i];
			if (!media || trigger.media === media) {
				if (kill) {
					trigger.kill(1);
				} else {
					trigger.scroll.rec || (trigger.scroll.rec = trigger.scroll()); // record the scroll positions so that in each refresh() we can ensure that it doesn't shift. Remember, pinning can make things change around, especially if the same element is pinned multiple times. If one was already recorded, don't re-record because unpinning may have occurred and made it shorter.
					trigger.revert();
				}
			}
		}
		_revertRecorded(media);
		media || _dispatch("revert");
	},
	_refreshAll = (force, skipRevert) => {
		if (_lastScrollTime && !force) {
			_addListener(ScrollTrigger, "scrollEnd", _softRefresh);
			return;
		}
		let refreshInits = _dispatch("refreshInit");
		_sort && ScrollTrigger.sort();
		skipRevert || _revertAll();
		for (_i = 0; _i < _triggers.length; _i++) {
			_triggers[_i].refresh();
		}
		refreshInits.forEach(result => result && result.render && result.render(-1)); // if the onRefreshInit() returns an animation (typically a gsap.set()), revert it. This makes it easy to put things in a certain spot before refreshing for measurement purposes, and then put things back.
		_i = _triggers.length;
		while (_i--) {
			_triggers[_i].scroll.rec = 0;
		}
		_resizeDelay.pause();
		_dispatch("refresh");
	},
	_lastScroll = 0,
	_direction = 1,
	_updateAll = () => {
		let l = _triggers.length,
			time = _getTime(),
			recordVelocity = time - _time1 >= 50,
			scroll = l && _triggers[0].scroll();
		_direction = _lastScroll > scroll ? -1 : 1;
		_lastScroll = scroll;
		if (recordVelocity) {
			if (_lastScrollTime && !_pointerIsDown && time - _lastScrollTime > 200) {
				_lastScrollTime = 0;
				_dispatch("scrollEnd");
			}
			_time2 = _time1;
			_time1 = time;
		}
		if (_direction < 0) {
			_i = l;
			while (_i-- > 0) {
				_triggers[_i] && _triggers[_i].update(0, recordVelocity);
			}
			_direction = 1;
		} else {
			for (_i = 0; _i < l; _i++) {
				_triggers[_i] && _triggers[_i].update(0, recordVelocity);
			}
		}
		_request = 0;
	},
	_propNamesToCopy = [_left, _top, _bottom, _right, _margin + _Bottom, _margin + _Right, _margin + _Top, _margin + _Left, "display", "flexShrink", "float", "zIndex"],
	_stateProps = _propNamesToCopy.concat([_width, _height, "boxSizing", "max" + _Width, "max" + _Height, "position", _margin, _padding, _padding + _Top, _padding + _Right, _padding + _Bottom, _padding + _Left]),
	_swapPinOut = (pin, spacer, state) => {
		_setState(state);
		if (pin.parentNode === spacer) {
			let parent = spacer.parentNode;
			if (parent) {
				parent.insertBefore(pin, spacer);
				parent.removeChild(spacer);
			}
		}
	},
	_swapPinIn = (pin, spacer, cs, spacerState) => {
		if (pin.parentNode !== spacer) {
			let i = _propNamesToCopy.length,
				spacerStyle = spacer.style,
				pinStyle = pin.style,
				p;
			while (i--) {
				p = _propNamesToCopy[i];
				spacerStyle[p] = cs[p];
			}
			spacerStyle.position = cs.position === "absolute" ? "absolute" : "relative";
			(cs.display === "inline") && (spacerStyle.display = "inline-block");
			pinStyle[_bottom] = pinStyle[_right] = "auto";
			spacerStyle.overflow = "visible";
			spacerStyle.boxSizing = "border-box";
			spacerStyle[_width] = _getSize(pin, _horizontal) + _px;
			spacerStyle[_height] = _getSize(pin, _vertical) + _px;
			spacerStyle[_padding] = pinStyle[_margin] = pinStyle[_top] = pinStyle[_left] = "0";
			_setState(spacerState);
			pinStyle[_width] = pinStyle["max" + _Width] = cs[_width];
			pinStyle[_height] = pinStyle["max" + _Height] = cs[_height];
			pinStyle[_padding] = cs[_padding];
			pin.parentNode.insertBefore(spacer, pin);
			spacer.appendChild(pin);
		}
	},
	_capsExp = /([A-Z])/g,
	_setState = state => {
		if (state) {
			let style = state.t.style,
				l = state.length,
				i = 0,
				p, value;
			(state.t._gsap || gsap.core.getCache(state.t)).uncache = 1; // otherwise transforms may be off
			for (; i < l; i +=2) {
				value = state[i+1];
				p = state[i];
				if (value) {
					style[p] = value;
				} else if (style[p]) {
					style.removeProperty(p.replace(_capsExp, "-$1").toLowerCase());
				}
			}
		}
	},
	_getState = element => { // returns an Array with alternating values like [property, value, property, value] and a "t" property pointing to the target (element). Makes it fast and cheap.
		let l = _stateProps.length,
			style = element.style,
			state = [],
			i = 0;
		for (; i < l; i++) {
			state.push(_stateProps[i], style[_stateProps[i]]);
		}
		state.t = element;
		return state;
	},
	_copyState = (state, override, omitOffsets) => {
		let result = [],
			l = state.length,
			i = omitOffsets ? 8 : 0, // skip top, left, right, bottom if omitOffsets is true
			p;
		for (; i < l; i += 2) {
			p = state[i];
			result.push(p, (p in override) ? override[p] : state[i+1]);
		}
		result.t = state.t;
		return result;
	},
	_winOffsets = {left:0, top:0},
	_parsePosition = (value, trigger, scrollerSize, direction, scroll, marker, markerScroller, self, scrollerBounds, borderWidth, useFixedPosition, scrollerMax) => {
		_isFunction(value) && (value = value(self));
		if (_isString(value) && value.substr(0,3) === "max") {
			value = scrollerMax + (value.charAt(4) === "=" ? _offsetToPx("0" + value.substr(3), scrollerSize) : 0);
		}
		if (!_isNumber(value)) {
			_isFunction(trigger) && (trigger = trigger(self));
			let element = _toArray(trigger)[0] || _body,
				bounds = _getBounds(element) || {},
				offsets = value.split(" "),
				localOffset, globalOffset, display;
			if ((!bounds || (!bounds.left && !bounds.top)) && _getComputedStyle(element).display === "none") { // if display is "none", it won't report getBoundingClientRect() properly
				display = element.style.display;
				element.style.display = "block";
				bounds = _getBounds(element);
				display ? (element.style.display = display) : element.style.removeProperty("display");
			}
			localOffset = _offsetToPx(offsets[0], bounds[direction.d]);
			globalOffset = _offsetToPx(offsets[1] || "0", scrollerSize);
			value = bounds[direction.p] - scrollerBounds[direction.p] - borderWidth + localOffset + scroll - globalOffset;
			markerScroller && _positionMarker(markerScroller, globalOffset, direction, (scrollerSize - globalOffset < 20 || (markerScroller._isStart && globalOffset > 20)));
			scrollerSize -= scrollerSize - globalOffset; // adjust for the marker
		} else if (markerScroller) {
			_positionMarker(markerScroller, scrollerSize, direction, true);
		}
		if (marker) {
			let position = value + scrollerSize,
				isStart = marker._isStart;
			scrollerMax = "scroll" + direction.d2;
			_positionMarker(marker, position, direction, (isStart && position > 20) || (!isStart && (useFixedPosition ? Math.max(_body[scrollerMax], _docEl[scrollerMax]) : marker.parentNode[scrollerMax]) <= position + 1));
			if (useFixedPosition) {
				scrollerBounds = _getBounds(markerScroller);
				useFixedPosition && (marker.style[direction.op.p] = (scrollerBounds[direction.op.p] - direction.op.m - marker._offset) + _px);
			}
		}
		return Math.round(value);
	},
	_prefixExp = /(?:webkit|moz|length|cssText|inset)/i,
	_reparent = (element, parent, top, left) => {
		if (element.parentNode !== parent) {
			let style = element.style,
				p, cs;
			if (parent === _body) {
				element._stOrig = style.cssText; // record original inline styles so we can revert them later
				cs = _getComputedStyle(element);
				for (p in cs) { // must copy all relevant styles to ensure that nothing changes visually when we reparent to the <body>. Skip the vendor prefixed ones.
					if (!+p && !_prefixExp.test(p) && cs[p] && typeof style[p] === "string" && p !== "0") {
						style[p] = cs[p];
					}
				}
				style.top = top;
				style.left = left;
			} else {
				style.cssText = element._stOrig;
			}
			gsap.core.getCache(element).uncache = 1;
			parent.appendChild(element);
		}
	},
	// returns a function that can be used to tween the scroll position in the direction provided, and when doing so it'll add a .tween property to the FUNCTION itself, and remove it when the tween completes or gets killed. This gives us a way to have multiple ScrollTriggers use a central function for any given scroller and see if there's a scroll tween running (which would affect if/how things get updated)
	_getTweenCreator = (scroller, direction) => {
		let getScroll = _getScrollFunc(scroller, direction),
			prop = "_scroll" + direction.p2, // add a tweenable property to the scroller that's a getter/setter function, like _scrollTop or _scrollLeft. This way, if someone does gsap.killTweensOf(scroller) it'll kill the scroll tween.
			lastScroll1, lastScroll2,
			getTween = (scrollTo, vars, initialValue, change1, change2) => {
				let tween = getTween.tween,
					onComplete = vars.onComplete,
					modifiers = {};
				tween && tween.kill();
				lastScroll1 = Math.round(initialValue);
				vars[prop] = scrollTo;
				vars.modifiers = modifiers;
				modifiers[prop] = value => {
					value = _round(getScroll()); // round because in some [very uncommon] Windows environments, it can get reported with decimals even though it was set without.
					if (value !== lastScroll1 && value !== lastScroll2 && Math.abs(value - lastScroll1) > 2) { // if the user scrolls, kill the tween. iOS Safari intermittently misreports the scroll position, it may be the most recently-set one or the one before that! When Safari is zoomed (CMD-+), it often misreports as 1 pixel off too! So if we set the scroll position to 125, for example, it'll actually report it as 124.
						tween.kill();
						getTween.tween = 0;
					} else {
						value = initialValue + change1 * tween.ratio + change2 * tween.ratio * tween.ratio;
					}
					lastScroll2 = lastScroll1;
					return (lastScroll1 = _round(value));
				};
				vars.onComplete = () => {
					getTween.tween = 0;
					onComplete && onComplete.call(tween);
				};
				tween = getTween.tween = gsap.to(scroller, vars);
				return tween;
			};
		scroller[prop] = getScroll;
		scroller.addEventListener("wheel", () => getTween.tween && getTween.tween.kill() && (getTween.tween = 0)); // Windows machines handle mousewheel scrolling in chunks (like "3 lines per scroll") meaning the typical strategy for cancelling the scroll isn't as sensitive. It's much more likely to match one of the previous 2 scroll event positions. So we kill any snapping as soon as there's a wheel event.
		return getTween;
	};

_horizontal.op = _vertical;



class ScrollTrigger {

	constructor(vars, animation) {
		_coreInitted || ScrollTrigger.register(gsap) || console.warn("Please gsap.registerPlugin(ScrollTrigger)");
		this.init(vars, animation);
	}

	init(vars, animation) {
		this.progress = this.start = 0;
		this.vars && this.kill(1); // in case it's being initted again
		if (!_enabled) {
			this.update = this.refresh = this.kill = _passThrough;
			return;
		}
		vars = _setDefaults((_isString(vars) || _isNumber(vars) || vars.nodeType) ? {trigger: vars} : vars, _defaults);
		let direction = vars.horizontal ? _horizontal : _vertical,
			{onUpdate, toggleClass, id, onToggle, onRefresh, scrub, trigger, pin, pinSpacing, invalidateOnRefresh, anticipatePin, onScrubComplete, onSnapComplete, once, snap, pinReparent} = vars,
			isToggle = !scrub && scrub !== 0,
			scroller = _toArray(vars.scroller || _win)[0],
			scrollerCache = gsap.core.getCache(scroller),
			isViewport = _isViewport(scroller),
			useFixedPosition = "pinType" in vars ? vars.pinType === "fixed" : isViewport || _getProxyProp(scroller, "pinType") === "fixed",
			callbacks = [vars.onEnter, vars.onLeave, vars.onEnterBack, vars.onLeaveBack],
			toggleActions = isToggle && vars.toggleActions.split(" "),
			markers = "markers" in vars ? vars.markers : _defaults.markers,
			borderWidth = isViewport ? 0 : parseFloat(_getComputedStyle(scroller)["border" + direction.p2 + _Width]) || 0,
			self = this,
			onRefreshInit = vars.onRefreshInit && (() => vars.onRefreshInit(self)),
			getScrollerSize = _getSizeFunc(scroller, isViewport, direction),
			getScrollerOffsets = _getOffsetsFunc(scroller, isViewport),
			tweenTo, pinCache, snapFunc, isReverted, scroll1, scroll2, start, end, markerStart, markerEnd, markerStartTrigger, markerEndTrigger, markerVars,
			change, pinOriginalState, pinActiveState, pinState, spacer, offset, pinGetter, pinSetter, pinStart, pinChange, spacingStart, spacerState, markerStartSetter,
			markerEndSetter, cs, snap1, snap2, scrubTween, scrubSmooth, snapDurClamp, snapDelayedCall, prevProgress, prevScroll, prevAnimProgress;

		self.media = _creatingMedia;
		anticipatePin *= 45;
		_triggers.push(self);
		self.scroller = scroller;
		self.scroll = _getScrollFunc(scroller, direction);
		scroll1 = self.scroll();
		self.vars = vars;
		animation = animation || vars.animation;
		("refreshPriority" in vars) && (_sort = 1);
		scrollerCache.tweenScroll = scrollerCache.tweenScroll || {
			top: _getTweenCreator(scroller, _vertical),
			left: _getTweenCreator(scroller, _horizontal)
		};
		self.tweenTo = tweenTo = scrollerCache.tweenScroll[direction.p];
		if (animation) {
			animation.vars.lazy = false;
			animation._initted || (animation.vars.immediateRender !== false && vars.immediateRender !== false && animation.render(0, true, true));
			self.animation = animation.pause();
			animation.scrollTrigger = self;
			scrubSmooth = _isNumber(scrub) && scrub;
			scrubSmooth && (scrubTween = gsap.to(animation, {ease: "power3", duration: scrubSmooth, onComplete: () => onScrubComplete && onScrubComplete(self)}));
			snap1 = 0;
			id || (id = animation.vars.id);
		}
		if (snap) {
			_isObject(snap) || (snap = {snapTo: snap});
			("scrollBehavior" in _body.style) && gsap.set(isViewport ? [_body, _docEl] : scroller, {scrollBehavior: "auto"}); // smooth scrolling doesn't work with snap.
			snapFunc = _isFunction(snap.snapTo) ? snap.snapTo : snap.snapTo === "labels" ? _getClosestLabel(animation) : snap.snapTo === "labelsDirectional" ? _getLabelAtDirection(animation) : gsap.utils.snap(snap.snapTo);
			snapDurClamp = snap.duration || {min: 0.1, max: 2};
			snapDurClamp = _isObject(snapDurClamp) ? _clamp(snapDurClamp.min, snapDurClamp.max) : _clamp(snapDurClamp, snapDurClamp);
			snapDelayedCall = gsap.delayedCall(snap.delay || (scrubSmooth / 2) || 0.1, () => {
				if (Math.abs(self.getVelocity()) < 10 && !_pointerIsDown) {
					let totalProgress = animation && !isToggle ? animation.totalProgress() : self.progress,
						velocity = ((totalProgress - snap2) / (_getTime() - _time2) * 1000) || 0,
						change1 = _abs(velocity / 2) * velocity / 0.185,
						naturalEnd = totalProgress + (snap.inertia === false ? 0 : change1),
						endValue = _clamp(0, 1, snapFunc(naturalEnd, self)),
						scroll = self.scroll(),
						endScroll = Math.round(start + endValue * change),
						{ onStart, onInterrupt, onComplete } = snap,
						tween = tweenTo.tween;
					if (scroll <= end && scroll >= start && endScroll !== scroll) {
						if (tween && !tween._initted && tween.data <= Math.abs(endScroll - scroll)) { // there's an overlapping snap! So we must figure out which one is closer and let that tween live.
							return;
						}
						tweenTo(endScroll, {
							duration: snapDurClamp(_abs( (Math.max(_abs(naturalEnd - totalProgress), _abs(endValue - totalProgress)) * 0.185 / velocity / 0.05) || 0)),
							ease: snap.ease || "power3",
							data: Math.abs(endScroll - scroll), // record the distance so that if another snap tween occurs (conflict) we can prioritize the closest snap.
							onInterrupt: () => snapDelayedCall.restart(true) && onInterrupt && onInterrupt(self),
							onComplete: () => {
								snap1 = snap2 = animation && !isToggle ? animation.totalProgress() : self.progress;
								onSnapComplete && onSnapComplete(self);
								onComplete && onComplete(self);
							}
						}, scroll, change1 * change, endScroll - scroll - change1 * change);
						onStart && onStart(self, tweenTo.tween);
					}
				} else if (self.isActive) {
					snapDelayedCall.restart(true);
				}
			}).pause();
		}
		id && (_ids[id] = self);
		trigger = self.trigger = _toArray(trigger || pin)[0];
		pin = pin === true ? trigger : _toArray(pin)[0];
		_isString(toggleClass) && (toggleClass = {targets: trigger, className: toggleClass});
		if (pin) {
			(pinSpacing === false || pinSpacing === _margin) || (pinSpacing = !pinSpacing && _getComputedStyle(pin.parentNode).display === "flex" ? false : _padding); // if the parent is display: flex, don't apply pinSpacing by default.
			self.pin = pin;
			vars.force3D !== false && gsap.set(pin, {force3D: true});
			pinCache = gsap.core.getCache(pin);
			if (!pinCache.spacer) { // record the spacer and pinOriginalState on the cache in case someone tries pinning the same element with MULTIPLE ScrollTriggers - we don't want to have multiple spacers or record the "original" pin state after it has already been affected by another ScrollTrigger.
				pinCache.spacer = spacer = _doc.createElement("div");
				spacer.setAttribute("class", "pin-spacer" + (id ? " pin-spacer-" + id : ""));
				pinCache.pinState = pinOriginalState = _getState(pin);
			} else {
				pinOriginalState = pinCache.pinState;
			}
			self.spacer = spacer = pinCache.spacer;
			cs = _getComputedStyle(pin);
			spacingStart = cs[pinSpacing + direction.os2];
			pinGetter = gsap.getProperty(pin);
			pinSetter = gsap.quickSetter(pin, direction.a, _px);
			// pin.firstChild && !_maxScroll(pin, direction) && (pin.style.overflow = "hidden"); // protects from collapsing margins, but can have unintended consequences as demonstrated here: https://codepen.io/GreenSock/pen/1e42c7a73bfa409d2cf1e184e7a4248d so it was removed in favor of just telling people to set up their CSS to avoid the collapsing margins (overflow: hidden | auto is just one option. Another is border-top: 1px solid transparent).
			_swapPinIn(pin, spacer, cs);
			pinState = _getState(pin);
		}
		if (markers) {
			markerVars = _isObject(markers) ? _setDefaults(markers, _markerDefaults) : _markerDefaults;
			markerStartTrigger = _createMarker("scroller-start", id, scroller, direction, markerVars, 0);
			markerEndTrigger = _createMarker("scroller-end", id, scroller, direction, markerVars, 0, markerStartTrigger);
			offset = markerStartTrigger["offset" + direction.op.d2];
			markerStart = _createMarker("start", id, scroller, direction, markerVars, offset);
			markerEnd =_createMarker("end", id, scroller, direction, markerVars, offset);
			if (!useFixedPosition) {
				_makePositionable(isViewport ? _body : scroller);
				gsap.set([markerStartTrigger, markerEndTrigger], {force3D: true});
				markerStartSetter = gsap.quickSetter(markerStartTrigger, direction.a, _px);
				markerEndSetter = gsap.quickSetter(markerEndTrigger, direction.a, _px);
			}
		}

		self.revert = revert => {
			let r = revert !== false || !self.enabled,
				prevRefreshing = _refreshing;
			if (r !== isReverted) {
				if (r) {
					prevScroll = Math.max(self.scroll(), self.scroll.rec || 0); // record the scroll so we can revert later (repositioning/pinning things can affect scroll position). In the static refresh() method, we first record all the scroll positions as a reference.
					prevProgress = self.progress;
					prevAnimProgress = animation && animation.progress();
				}
				markerStart && [markerStart, markerEnd, markerStartTrigger, markerEndTrigger].forEach(m => m.style.display = r ? "none" : "block");
				r && (_refreshing = 1);
				self.update(r); // make sure the pin is back in its original position so that all the measurements are correct.
				_refreshing = prevRefreshing;
				pin && (r ? _swapPinOut(pin, spacer, pinOriginalState) : (!pinReparent || !self.isActive) && _swapPinIn(pin, spacer, _getComputedStyle(pin), spacerState));
				isReverted = r;
			}
		}


		self.refresh = (soft, force) => {
			if ((_refreshing || !self.enabled) && !force) {
				return;
			}
			if (pin && soft && _lastScrollTime) {
				_addListener(ScrollTrigger, "scrollEnd", _softRefresh);
				return;
			}

			_refreshing = 1;
			scrubTween && scrubTween.pause();
			invalidateOnRefresh && animation && animation.progress(0).invalidate();
			isReverted || self.revert();
			let size = getScrollerSize(),
				scrollerBounds = getScrollerOffsets(),
				max = _maxScroll(scroller, direction),
				offset = 0,
				otherPinOffset = 0,
				parsedEnd = vars.end,
				parsedEndTrigger = vars.endTrigger || trigger,
				parsedStart = vars.start || (vars.start === 0 || !trigger ? 0 : (pin ? "0 0" : "0 100%")),
				triggerIndex = (trigger && Math.max(0, _triggers.indexOf(self))) || 0,
				i = triggerIndex,
				cs, bounds, scroll, isVertical, override, curTrigger, curPin, oppositeScroll, initted;
			while (i--) { // user might try to pin the same element more than once, so we must find any prior triggers with the same pin, revert them, and determine how long they're pinning so that we can offset things appropriately. Make sure we revert from last to first so that things "rewind" properly.
				curTrigger = _triggers[i];
				curTrigger.end || curTrigger.refresh(0, 1) || (_refreshing = 1); // if it's a timeline-based trigger that hasn't been fully initialized yet because it's waiting for 1 tick, just force the refresh() here, otherwise if it contains a pin that's supposed to affect other ScrollTriggers further down the page, they won't be adjusted properly.
				curPin = curTrigger.pin;
				curPin && (curPin === trigger || curPin === pin) && curTrigger.revert();
			}
			start = _parsePosition(parsedStart, trigger, size, direction, self.scroll(), markerStart, markerStartTrigger, self, scrollerBounds, borderWidth, useFixedPosition, max) || (pin ? -0.001 : 0);
			_isFunction(parsedEnd) && (parsedEnd = parsedEnd(self));
			if (_isString(parsedEnd) && !parsedEnd.indexOf("+=")) {
				if (~parsedEnd.indexOf(" ")) {
					parsedEnd = (_isString(parsedStart) ? parsedStart.split(" ")[0] : "") + parsedEnd;
				} else {
					offset = _offsetToPx(parsedEnd.substr(2), size);
					parsedEnd = _isString(parsedStart) ? parsedStart : start + offset; // _parsePosition won't factor in the offset if the start is a number, so do it here.
					parsedEndTrigger = trigger;
				}
			}
			end = Math.max(start, _parsePosition(parsedEnd || (parsedEndTrigger ? "100% 0" : max), parsedEndTrigger, size, direction, self.scroll() + offset, markerEnd, markerEndTrigger, self, scrollerBounds, borderWidth, useFixedPosition, max)) || -0.001;
			change = (end - start) || ((start -= 0.01) && 0.001);

			offset = 0;
			i = triggerIndex;
			while (i--) {
				curTrigger = _triggers[i];
				curPin = curTrigger.pin;
				if (curPin && curTrigger.start - curTrigger._pinPush < start) {
					cs = curTrigger.end - curTrigger.start;
					curPin === trigger && (offset += cs);
					curPin === pin && (otherPinOffset += cs);
				}
			}
			start += offset;
			end += offset;
			self._pinPush = otherPinOffset;
			if (markerStart && offset) { // offset the markers if necessary
				cs = {};
				cs[direction.a] = "+=" + offset;
				gsap.set([markerStart, markerEnd], cs);
			}

			if (pin) {
				cs = _getComputedStyle(pin);
				isVertical = direction === _vertical;
				scroll = self.scroll(); // recalculate because the triggers can affect the scroll
				pinStart = parseFloat(pinGetter(direction.a)) + otherPinOffset;
				!max && end > 1 && ((isViewport ? _body : scroller).style["overflow-" + direction.a] = "scroll"); // makes sure the scroller has a scrollbar, otherwise if something has width: 100%, for example, it would be too big (exclude the scrollbar). See https://greensock.com/forums/topic/25182-scrolltrigger-width-of-page-increase-where-markers-are-set-to-false/
				_swapPinIn(pin, spacer, cs);
				pinState = _getState(pin);
				// transforms will interfere with the top/left/right/bottom placement, so remove them temporarily. getBoundingClientRect() factors in transforms.
				bounds = _getBounds(pin, true);
				oppositeScroll = useFixedPosition && _getScrollFunc(scroller, isVertical ? _horizontal : _vertical)();
				if (pinSpacing) {
					spacerState = [pinSpacing + direction.os2, change + otherPinOffset + _px];
					spacerState.t = spacer;
					i = (pinSpacing === _padding) ? _getSize(pin, direction) + change + otherPinOffset : 0;
					i && spacerState.push(direction.d, i + _px); // for box-sizing: border-box (must include padding).
					_setState(spacerState);
					useFixedPosition && self.scroll(prevScroll);
				}
				if (useFixedPosition) {
					override = {
						top: (bounds.top + (isVertical ? scroll - start : oppositeScroll)) + _px,
						left: (bounds.left + (isVertical ? oppositeScroll : scroll - start)) + _px,
						boxSizing: "border-box",
						position: "fixed"
					};
					override[_width] = override["max" + _Width] = Math.ceil(bounds.width) + _px;
					override[_height] = override["max" + _Height] = Math.ceil(bounds.height) + _px;
					override[_margin] = override[_margin + _Top] = override[_margin + _Right] = override[_margin + _Bottom] = override[_margin + _Left] = "0";
					override[_padding] = cs[_padding];
					override[_padding + _Top] = cs[_padding + _Top];
					override[_padding + _Right] = cs[_padding + _Right];
					override[_padding + _Bottom] = cs[_padding + _Bottom];
					override[_padding + _Left] = cs[_padding + _Left];
					pinActiveState = _copyState(pinOriginalState, override, pinReparent);
				}
				if (animation) { // the animation might be affecting the transform, so we must jump to the end, check the value, and compensate accordingly. Otherwise, when it becomes unpinned, the pinSetter() will get set to a value that doesn't include whatever the animation did.
					initted = animation._initted; // if not, we must invalidate() after this step, otherwise it could lock in starting values prematurely.
					_suppressOverwrites(1);
					animation.progress(1, true);
					pinChange = pinGetter(direction.a) - pinStart + change + otherPinOffset;
					change !== pinChange && pinActiveState.splice(pinActiveState.length - 2, 2); // transform is the last property/value set in the state Array. Since the animation is controlling that, we should omit it.
					animation.progress(0, true);
					initted || animation.invalidate();
					_suppressOverwrites(0);
				} else {
					pinChange = change
				}
			} else if (trigger && self.scroll()) { // it may be INSIDE a pinned element, so walk up the tree and look for any elements with _pinOffset to compensate because anything with pinSpacing that's already scrolled would throw off the measurements in getBoundingClientRect()
				bounds = trigger.parentNode;
				while (bounds && bounds !== _body) {
					if (bounds._pinOffset) {
						start -= bounds._pinOffset;
						end -= bounds._pinOffset;
					}
					bounds = bounds.parentNode;
				}
			}
			for (i = 0; i < triggerIndex; i++) { // make sure we revert from first to last to make sure things reach their end state properly
				curTrigger = _triggers[i].pin;
				curTrigger && (curTrigger === trigger || curTrigger === pin) && _triggers[i].revert(false);
			}
			self.start = start;
			self.end = end;
			scroll1 = scroll2 = self.scroll(); // reset velocity
			scroll1 < prevScroll && self.scroll(prevScroll);
			self.revert(false);
			_refreshing = 0;
			animation && isToggle && animation._initted && animation.progress(prevAnimProgress, true).render(animation.time(), true, true); // must force a re-render because if saveStyles() was used on the target(s), the styles could have been wiped out during the refresh().
			if (prevProgress !== self.progress) { // ensures that the direction is set properly (when refreshing, progress is set back to 0 initially, then back again to wherever it needs to be) and that callbacks are triggered.
				scrubTween && animation.totalProgress(prevProgress, true); // to avoid issues where animation callbacks like onStart aren't triggered.
				self.progress = prevProgress;
				self.update();
			}
			pin && pinSpacing && (spacer._pinOffset = Math.round(self.progress * pinChange));
			onRefresh && onRefresh(self);
		};

		self.getVelocity = () => ((self.scroll() - scroll2) / (_getTime() - _time2) * 1000) || 0;

		self.update = (reset, recordVelocity) => {
			let scroll = self.scroll(),
				p = reset ? 0 : (scroll - start) / change,
				clipped = p < 0 ? 0 : p > 1 ? 1 : p || 0,
				prevProgress = self.progress,
				isActive, wasActive, toggleState, action, stateChanged, toggled;
			if (recordVelocity) {
				scroll2 = scroll1;
				scroll1 = scroll;
				if (snap) {
					snap2 = snap1;
					snap1 = animation && !isToggle ? animation.totalProgress() : clipped;
				}
			}
			// anticipate the pinning a few ticks ahead of time based on velocity to avoid a visual glitch due to the fact that most browsers do scrolling on a separate thread (not synced with requestAnimationFrame).
			(anticipatePin && !clipped && pin && !_refreshing && !_startup && _lastScrollTime && start < scroll + ((scroll - scroll2) / (_getTime() - _time2)) * anticipatePin) && (clipped = 0.0001);
			if (clipped !== prevProgress && self.enabled) {
				isActive = self.isActive = !!clipped && clipped < 1;
				wasActive = !!prevProgress && prevProgress < 1;
				toggled = isActive !== wasActive;
				stateChanged = toggled || !!clipped !== !!prevProgress; // could go from start all the way to end, thus it didn't toggle but it did change state in a sense (may need to fire a callback)
				self.direction = clipped > prevProgress ? 1 : -1;
				self.progress = clipped;
				if (!isToggle) {
					if (scrubTween && !_refreshing && !_startup) {
						scrubTween.vars.totalProgress = clipped;
						scrubTween.invalidate().restart();
					} else if (animation) {
						animation.totalProgress(clipped, !!_refreshing);
					}
				}
				if (pin) {
					reset && pinSpacing && (spacer.style[pinSpacing + direction.os2] = spacingStart);
					if (!useFixedPosition) {
						pinSetter(pinStart + pinChange * clipped);
					} else if (stateChanged) {
						action = !reset && clipped > prevProgress && end + 1 > scroll && scroll + 1 >= _maxScroll(scroller, direction); // if it's at the VERY end of the page, don't switch away from position: fixed because it's pointless and it could cause a brief flash when the user scrolls back up (when it gets pinned again)
						if (pinReparent) {
							if (!reset && (isActive || action)) {
								let bounds = _getBounds(pin, true),
									offset = scroll - start;
								_reparent(pin, _body, (bounds.top + (direction === _vertical ? offset : 0)) + _px, (bounds.left + (direction === _vertical ? 0 : offset)) + _px);
							} else {
								_reparent(pin, spacer);
							}
						}
						_setState(isActive || action ? pinActiveState : pinState);
						(pinChange !== change && clipped < 1 && isActive) || pinSetter(pinStart + (clipped === 1 && !action ? pinChange : 0));
					}
				}
				snap && !tweenTo.tween && !_refreshing && !_startup && snapDelayedCall.restart(true);
				toggleClass && (toggled || (once && clipped && (clipped < 1 || !_limitCallbacks))) && _toArray(toggleClass.targets).forEach(el => el.classList[isActive || once ? "add" : "remove"](toggleClass.className)); // classes could affect positioning, so do it even if reset or refreshing is true.
				onUpdate && !isToggle && !reset && onUpdate(self);
				if (stateChanged && !_refreshing) {
					toggleState = clipped && !prevProgress ? 0 : clipped === 1 ? 1 : prevProgress === 1 ? 2 : 3; // 0 = enter, 1 = leave, 2 = enterBack, 3 = leaveBack (we prioritize the FIRST encounter, thus if you scroll really fast past the onEnter and onLeave in one tick, it'd prioritize onEnter.
					if (isToggle) {
						action = (!toggled && toggleActions[toggleState + 1] !== "none" && toggleActions[toggleState + 1]) || toggleActions[toggleState]; // if it didn't toggle, that means it shot right past and since we prioritize the "enter" action, we should switch to the "leave" in this case (but only if one is defined)
						if (animation && (action === "complete" || action === "reset" || action in animation)) {
							if (action === "complete") {
								animation.pause().totalProgress(1);
							} else if (action === "reset") {
								animation.restart(true).pause();
							} else {
								animation[action]();
							}
						}
						onUpdate && onUpdate(self);
					}
					if (toggled || !_limitCallbacks) { // on startup, the page could be scrolled and we don't want to fire callbacks that didn't toggle. For example onEnter shouldn't fire if the ScrollTrigger isn't actually entered.
						onToggle && toggled && onToggle(self);
						callbacks[toggleState] && callbacks[toggleState](self);
						once && (clipped === 1 ? self.kill(false, 1) : (callbacks[toggleState] = 0)); // a callback shouldn't be called again if once is true.
						if (!toggled) { // it's possible to go completely past, like from before the start to after the end (or vice-versa) in which case BOTH callbacks should be fired in that order
							toggleState = clipped === 1 ? 1 : 3;
							callbacks[toggleState] && callbacks[toggleState](self);
						}
					}
				} else if (isToggle && onUpdate && !_refreshing) {
					onUpdate(self);
				}
			}
			// update absolutely-positioned markers (only if the scroller isn't the viewport)
			if (markerEndSetter) {
				markerStartSetter(scroll + (markerStartTrigger._isFlipped ? 1 : 0));
				markerEndSetter(scroll);
			}
		};

		self.enable = () => {
			if (!self.enabled) {
				self.enabled = true;
				_addListener(scroller, "resize", _onResize);
				_addListener(scroller, "scroll", _onScroll);
				onRefreshInit && _addListener(ScrollTrigger, "refreshInit", onRefreshInit);
				!animation || !animation.add ? self.refresh() : gsap.delayedCall(0.01, () => start || end || self.refresh()) && (change = 0.01) && (start = end = 0); // if the animation is a timeline, it may not have been populated yet, so it wouldn't render at the proper place on the first refresh(), thus we should schedule one for the next tick.
			}
		};

		self.disable = (reset, allowAnimation) => {
			if (self.enabled) {
				reset !== false && self.revert();
				self.enabled = self.isActive = false;
				allowAnimation || (scrubTween && scrubTween.pause());
				prevScroll = 0;
				pinCache && (pinCache.uncache = 1);
				onRefreshInit && _removeListener(ScrollTrigger, "refreshInit", onRefreshInit);
				if (snapDelayedCall) {
					snapDelayedCall.pause();
					tweenTo.tween && tweenTo.tween.kill() && (tweenTo.tween = 0);
				}
				if (!isViewport) {
					let i = _triggers.length;
					while (i--) {
						if (_triggers[i].scroller === scroller && _triggers[i] !== self) {
							return; //don't remove the listeners if there are still other triggers referencing it.
						}
					}
					_removeListener(scroller, "resize", _onResize);
					_removeListener(scroller, "scroll", _onScroll);
				}
			}
		};

		self.kill = (revert, allowAnimation) => {
			self.disable(revert, allowAnimation);
			id && (delete _ids[id]);
			let i = _triggers.indexOf(self);
			_triggers.splice(i, 1);
			i === _i && _direction > 0 && _i--; // if we're in the middle of a refresh() or update(), splicing would cause skips in the index, so adjust...
			if (animation) {
				animation.scrollTrigger = null;
				revert && animation.render(-1);
				allowAnimation || animation.kill();
			}
			markerStart && [markerStart, markerEnd, markerStartTrigger, markerEndTrigger].forEach(m => m.parentNode.removeChild(m));
			if (pin) {
				pinCache && (pinCache.uncache = 1);
				i = 0;
				_triggers.forEach(t => t.pin === pin && i++);
				i || (pinCache.spacer = 0); // if there aren't any more ScrollTriggers with the same pin, remove the spacer, otherwise it could be contaminated with old/stale values if the user re-creates a ScrollTrigger for the same element.
			}
		};

		self.enable();
	}


	static register(core) {
		if (!_coreInitted) {
			gsap = core || _getGSAP();
			if (_windowExists() && window.document) {
				_win = window;
				_doc = document;
				_docEl = _doc.documentElement;
				_body = _doc.body;
			}
			if (gsap) {
				_toArray = gsap.utils.toArray;
				_clamp = gsap.utils.clamp;
				_suppressOverwrites = gsap.core.suppressOverwrites || _passThrough;
				gsap.core.globals("ScrollTrigger", ScrollTrigger); // must register the global manually because in Internet Explorer, functions (classes) don't have a "name" property.
				if (_body) {
					_raf = _win.requestAnimationFrame || (f => setTimeout(f, 16));
					_addListener(_win, "wheel", _onScroll);
					_root = [_win, _doc, _docEl, _body];
					_addListener(_doc, "scroll", _onScroll); // some browsers (like Chrome), the window stops dispatching scroll events on the window if you scroll really fast, but it's consistent on the document!
					let bodyStyle = _body.style,
						border = bodyStyle.borderTop,
						bounds;
					bodyStyle.borderTop = "1px solid #000"; // works around an issue where a margin of a child element could throw off the bounds of the _body, making it seem like there's a margin when there actually isn't. The border ensures that the bounds are accurate.
					bounds = _getBounds(_body);
					_vertical.m = Math.round(bounds.top + _vertical.sc()) || 0; // accommodate the offset of the <body> caused by margins and/or padding
					_horizontal.m = Math.round(bounds.left + _horizontal.sc()) || 0;
					border ? (bodyStyle.borderTop = border) : bodyStyle.removeProperty("border-top");
					_syncInterval = setInterval(_sync, 200);
					gsap.delayedCall(0.5, () => _startup = 0);
					_addListener(_doc, "touchcancel", _passThrough); // some older Android devices intermittently stop dispatching "touchmove" events if we don't listen for "touchcancel" on the document.
					_addListener(_body, "touchstart", _passThrough); //works around Safari bug: https://greensock.com/forums/topic/21450-draggable-in-iframe-on-mobile-is-buggy/
					_multiListener(_addListener, _doc, "pointerdown,touchstart,mousedown", () => _pointerIsDown = 1);
					_multiListener(_addListener, _doc, "pointerup,touchend,mouseup", () => _pointerIsDown = 0);
					_transformProp = gsap.utils.checkPrefix("transform");
					_stateProps.push(_transformProp);
					_coreInitted = _getTime();
					_resizeDelay = gsap.delayedCall(0.2, _refreshAll).pause();
					_autoRefresh = [_doc, "visibilitychange", () => {
						let w = _win.innerWidth,
							h = _win.innerHeight;
						if (_doc.hidden) {
							_prevWidth = w;
							_prevHeight = h;
						} else if (_prevWidth !== w || _prevHeight !== h) {
							_onResize();
						}
					}, _doc, "DOMContentLoaded", _refreshAll, _win, "load", () => _lastScrollTime || _refreshAll(), _win, "resize", _onResize];
					_iterateAutoRefresh(_addListener);

				}
			}
		}
		return _coreInitted;
	}

	static defaults(config) {
		for (let p in config) {
			_defaults[p] = config[p];
		}
	}

	static kill() {
		_enabled = 0;
		_triggers.slice(0).forEach(trigger => trigger.kill(1));
	}

	static config(vars) {
		("limitCallbacks" in vars) && (_limitCallbacks = !!vars.limitCallbacks);
		let ms = vars.syncInterval;
		ms && clearInterval(_syncInterval) || ((_syncInterval = ms) && setInterval(_sync, ms));
		if ("autoRefreshEvents" in vars) {
			_iterateAutoRefresh(_removeListener) || _iterateAutoRefresh(_addListener, vars.autoRefreshEvents || "none");
			_ignoreResize = (vars.autoRefreshEvents + "").indexOf("resize") === -1;
		}
	}

	static scrollerProxy(target, vars) {
		let t = _toArray(target)[0],
			i = _scrollers.indexOf(t),
			isViewport = _isViewport(t);
		if (~i) {
			_scrollers.splice(i, isViewport ? 6 : 2);
		}
		isViewport ? _proxies.unshift(_win, vars, _body, vars, _docEl, vars) : _proxies.unshift(t, vars);
	}

	static matchMedia(vars) { // _media is populated in the following order: mediaQueryString, onMatch, onUnmatch, isMatched. So if there are two media queries, the Array would have a length of 8
		let mq, p, i, func, result;
		for (p in vars) {
			i = _media.indexOf(p);
			func = vars[p];
			_creatingMedia = p;
			if (p === "all") {
				func();
			} else {
				mq = _win.matchMedia(p);
				if (mq) {
					mq.matches && (result = func());
					if (~i) {
						_media[i + 1] = _combineFunc(_media[i + 1], func);
						_media[i + 2] = _combineFunc(_media[i + 2], result);
					} else {
						i = _media.length;
						_media.push(p, func, result);
						mq.addListener ? mq.addListener(_onMediaChange) : mq.addEventListener("change", _onMediaChange);
					}
					_media[i + 3] = mq.matches;
				}
			}
			_creatingMedia = 0;
		}
		return _media;
	}

	static clearMatchMedia(query) {
		query || (_media.length = 0);
		query = _media.indexOf(query);
		query >= 0 && _media.splice(query, 4);
	}

}

ScrollTrigger.version = "3.6.1";
ScrollTrigger.saveStyles = targets => targets ? _toArray(targets).forEach(target => {
	if (target && target.style) {
		let i = _savedStyles.indexOf(target);
		i >= 0 && _savedStyles.splice(i, 4);
		_savedStyles.push(target, target.style.cssText, gsap.core.getCache(target), _creatingMedia);
	}
}) : _savedStyles;
ScrollTrigger.revert = (soft, media) => _revertAll(!soft, media);
ScrollTrigger.create = (vars, animation) => new ScrollTrigger(vars, animation);
ScrollTrigger.refresh = safe => safe ? _onResize() : _refreshAll(true);
ScrollTrigger.update = _updateAll;
ScrollTrigger.maxScroll = (element, horizontal) => _maxScroll(element, horizontal ? _horizontal : _vertical);
ScrollTrigger.getScrollFunc = (element, horizontal) => _getScrollFunc(_toArray(element)[0], horizontal ? _horizontal : _vertical);
ScrollTrigger.getById = id => _ids[id];
ScrollTrigger.getAll = () => _triggers.slice(0);
ScrollTrigger.isScrolling = () => !!_lastScrollTime;
ScrollTrigger.addEventListener = (type, callback) => {
	let a = _listeners[type] || (_listeners[type] = []);
	~a.indexOf(callback) || a.push(callback);
};
ScrollTrigger.removeEventListener = (type, callback) => {
	let a = _listeners[type],
		i = a && a.indexOf(callback);
	i >= 0 && a.splice(i, 1);
};
ScrollTrigger.batch = (targets, vars) => {
	let result = [],
		varsCopy = {},
		interval = vars.interval || 0.016,
		batchMax = vars.batchMax || 1e9,
		proxyCallback = (type, callback) => {
			let elements = [],
				triggers = [],
				delay = gsap.delayedCall(interval, () => {callback(elements, triggers); elements = []; triggers = [];}).pause();
			return self => {
				elements.length || delay.restart(true);
				elements.push(self.trigger);
				triggers.push(self);
				batchMax <= elements.length && delay.progress(1);
			};
		},
		p;
	for (p in vars) {
		varsCopy[p] = (p.substr(0, 2) === "on" && _isFunction(vars[p]) && p !== "onRefreshInit") ? proxyCallback(p, vars[p]) : vars[p];
	}
	if (_isFunction(batchMax)) {
		batchMax = batchMax();
		_addListener(ScrollTrigger, "refresh", () => batchMax = vars.batchMax());
	}
	_toArray(targets).forEach(target => {
		let config = {};
		for (p in varsCopy) {
			config[p] = varsCopy[p];
		}
		config.trigger = target;
		result.push(ScrollTrigger.create(config));
	});
	return result;
}
ScrollTrigger.sort = func => _triggers.sort(func || ((a, b) => (a.vars.refreshPriority || 0) * -1e6 + a.start - (b.start + (b.vars.refreshPriority || 0) * -1e6)));

_getGSAP() && gsap.registerPlugin(ScrollTrigger);



/***/ }),

/***/ "./node_modules/gsap/src/TextPlugin.js":
/*!*********************************************!*\
  !*** ./node_modules/gsap/src/TextPlugin.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TextPlugin: () => (/* binding */ TextPlugin),
/* harmony export */   "default": () => (/* binding */ TextPlugin)
/* harmony export */ });
/* harmony import */ var _utils_strings_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils/strings.js */ "./node_modules/gsap/src/utils/strings.js");
/*!
 * TextPlugin 3.6.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/* eslint-disable */



let gsap, _tempDiv,
	_getGSAP = () => gsap || (typeof(window) !== "undefined" && (gsap = window.gsap) && gsap.registerPlugin && gsap);


const TextPlugin = {
	version:"3.6.1",
	name:"text",
	init(target, value, tween) {
		let i = target.nodeName.toUpperCase(),
			data = this,
			short, text, original, j, condensedText, condensedOriginal, aggregate, s;
		data.svg = (target.getBBox && (i === "TEXT" || i === "TSPAN"));
		if (!("innerHTML" in target) && !data.svg) {
			return false;
		}
		data.target = target;
		if (typeof(value) !== "object") {
			value = {value:value};
		}
		if (!("value" in value)) {
			data.text = data.original = [""];
			return;
		}
		data.delimiter = value.delimiter || "";
		original = (0,_utils_strings_js__WEBPACK_IMPORTED_MODULE_0__.splitInnerHTML)(target, data.delimiter);
		if (!_tempDiv) {
			_tempDiv = document.createElement("div");
		}
		_tempDiv.innerHTML = value.value;
		text = (0,_utils_strings_js__WEBPACK_IMPORTED_MODULE_0__.splitInnerHTML)(_tempDiv, data.delimiter);
		data.from = tween._from;
		if (data.from) {
			i = original;
			original = text;
			text = i;
		}
		data.hasClass = !!(value.newClass || value.oldClass);
		data.newClass = value.newClass;
		data.oldClass = value.oldClass;
		i = original.length - text.length;
		short = (i < 0) ? original : text;
		data.fillChar = value.fillChar || (value.padSpace ? "&nbsp;" : "");
		if (i < 0) {
			i = -i;
		}
		while (--i > -1) {
			short.push(data.fillChar);
		}
		if (value.type === "diff") {
			j = 0;
			condensedText = [];
			condensedOriginal = [];
			aggregate = "";
			for (i = 0; i < text.length; i++) {
				s = text[i];
				if (s === original[i]) {
					aggregate += s;
				} else {
					condensedText[j] = aggregate + s;
					condensedOriginal[j++] = aggregate + original[i];
					aggregate = "";
				}
			}
			text = condensedText;
			original = condensedOriginal;
			if (aggregate) {
				text.push(aggregate);
				original.push(aggregate);
			}
		}
		if (value.speed) {
			tween.duration(Math.min(0.05 / value.speed * short.length, value.maxDuration || 9999));
		}
		this.original = original;
		this.text = text;
		this._props.push("text");
	},
	render(ratio, data) {
		if (ratio > 1) {
			ratio = 1;
		} else if (ratio < 0) {
			ratio = 0;
		}
		if (data.from) {
			ratio = 1 - ratio;
		}
		let { text, hasClass, newClass, oldClass, delimiter, target, fillChar, original } = data,
			l = text.length,
			i = (ratio * l + 0.5) | 0,
			applyNew, applyOld, str;
		if (hasClass) {
			applyNew = (newClass && i);
			applyOld = (oldClass && i !== l);
			str = (applyNew ? "<span class='" + newClass + "'>" : "") + text.slice(0, i).join(delimiter) + (applyNew ? "</span>" : "") + (applyOld ? "<span class='" + oldClass + "'>" : "") + delimiter + original.slice(i).join(delimiter) + (applyOld ? "</span>" : "");
		} else {
			str = text.slice(0, i).join(delimiter) + delimiter + original.slice(i).join(delimiter);
		}
		if (data.svg) { //SVG text elements don't have an "innerHTML" in Microsoft browsers.
			target.textContent = str;
		} else {
			target.innerHTML = (fillChar === "&nbsp;" && ~str.indexOf("  ")) ? str.split("  ").join("&nbsp;&nbsp;") : str;
		}
	}
};

TextPlugin.splitInnerHTML = _utils_strings_js__WEBPACK_IMPORTED_MODULE_0__.splitInnerHTML;
TextPlugin.emojiSafeSplit = _utils_strings_js__WEBPACK_IMPORTED_MODULE_0__.emojiSafeSplit;
TextPlugin.getText = _utils_strings_js__WEBPACK_IMPORTED_MODULE_0__.getText;

_getGSAP() && gsap.registerPlugin(TextPlugin);



/***/ }),

/***/ "./node_modules/gsap/src/gsap-core.js":
/*!********************************************!*\
  !*** ./node_modules/gsap/src/gsap-core.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Animation: () => (/* binding */ Animation),
/* harmony export */   Back: () => (/* binding */ Back),
/* harmony export */   Bounce: () => (/* binding */ Bounce),
/* harmony export */   Circ: () => (/* binding */ Circ),
/* harmony export */   Cubic: () => (/* binding */ Cubic),
/* harmony export */   Elastic: () => (/* binding */ Elastic),
/* harmony export */   Expo: () => (/* binding */ Expo),
/* harmony export */   GSCache: () => (/* binding */ GSCache),
/* harmony export */   Linear: () => (/* binding */ Linear),
/* harmony export */   Power0: () => (/* binding */ Power0),
/* harmony export */   Power1: () => (/* binding */ Power1),
/* harmony export */   Power2: () => (/* binding */ Power2),
/* harmony export */   Power3: () => (/* binding */ Power3),
/* harmony export */   Power4: () => (/* binding */ Power4),
/* harmony export */   PropTween: () => (/* binding */ PropTween),
/* harmony export */   Quad: () => (/* binding */ Quad),
/* harmony export */   Quart: () => (/* binding */ Quart),
/* harmony export */   Quint: () => (/* binding */ Quint),
/* harmony export */   Sine: () => (/* binding */ Sine),
/* harmony export */   SteppedEase: () => (/* binding */ SteppedEase),
/* harmony export */   Strong: () => (/* binding */ Strong),
/* harmony export */   Timeline: () => (/* binding */ Timeline),
/* harmony export */   TimelineLite: () => (/* binding */ Timeline),
/* harmony export */   TimelineMax: () => (/* binding */ Timeline),
/* harmony export */   Tween: () => (/* binding */ Tween),
/* harmony export */   TweenLite: () => (/* binding */ Tween),
/* harmony export */   TweenMax: () => (/* binding */ Tween),
/* harmony export */   _checkPlugin: () => (/* binding */ _checkPlugin),
/* harmony export */   _colorExp: () => (/* binding */ _colorExp),
/* harmony export */   _colorStringFilter: () => (/* binding */ _colorStringFilter),
/* harmony export */   _config: () => (/* binding */ _config),
/* harmony export */   _forEachName: () => (/* binding */ _forEachName),
/* harmony export */   _getCache: () => (/* binding */ _getCache),
/* harmony export */   _getProperty: () => (/* binding */ _getProperty),
/* harmony export */   _getSetter: () => (/* binding */ _getSetter),
/* harmony export */   _isString: () => (/* binding */ _isString),
/* harmony export */   _isUndefined: () => (/* binding */ _isUndefined),
/* harmony export */   _missingPlugin: () => (/* binding */ _missingPlugin),
/* harmony export */   _numExp: () => (/* binding */ _numExp),
/* harmony export */   _numWithUnitExp: () => (/* binding */ _numWithUnitExp),
/* harmony export */   _plugins: () => (/* binding */ _plugins),
/* harmony export */   _relExp: () => (/* binding */ _relExp),
/* harmony export */   _removeLinkedListItem: () => (/* binding */ _removeLinkedListItem),
/* harmony export */   _renderComplexString: () => (/* binding */ _renderComplexString),
/* harmony export */   _replaceRandom: () => (/* binding */ _replaceRandom),
/* harmony export */   _round: () => (/* binding */ _round),
/* harmony export */   _roundModifier: () => (/* binding */ _roundModifier),
/* harmony export */   _setDefaults: () => (/* binding */ _setDefaults),
/* harmony export */   _sortPropTweensByPriority: () => (/* binding */ _sortPropTweensByPriority),
/* harmony export */   _ticker: () => (/* binding */ _ticker),
/* harmony export */   clamp: () => (/* binding */ clamp),
/* harmony export */   "default": () => (/* binding */ gsap),
/* harmony export */   distribute: () => (/* binding */ distribute),
/* harmony export */   getUnit: () => (/* binding */ getUnit),
/* harmony export */   gsap: () => (/* binding */ gsap),
/* harmony export */   interpolate: () => (/* binding */ interpolate),
/* harmony export */   mapRange: () => (/* binding */ mapRange),
/* harmony export */   normalize: () => (/* binding */ normalize),
/* harmony export */   pipe: () => (/* binding */ pipe),
/* harmony export */   random: () => (/* binding */ random),
/* harmony export */   shuffle: () => (/* binding */ shuffle),
/* harmony export */   snap: () => (/* binding */ snap),
/* harmony export */   splitColor: () => (/* binding */ splitColor),
/* harmony export */   toArray: () => (/* binding */ toArray),
/* harmony export */   unitize: () => (/* binding */ unitize),
/* harmony export */   wrap: () => (/* binding */ wrap),
/* harmony export */   wrapYoyo: () => (/* binding */ wrapYoyo)
/* harmony export */ });
/*!
 * GSAP 3.6.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/* eslint-disable */

let _config = {
		autoSleep: 120,
		force3D: "auto",
		nullTargetWarn: 1,
		units: {lineHeight:""}
	},
	_defaults = {
		duration: .5,
		overwrite: false,
		delay: 0
	},
	_suppressOverwrites,
	_bigNum = 1e8,
	_tinyNum = 1 / _bigNum,
	_2PI = Math.PI * 2,
	_HALF_PI = _2PI / 4,
	_gsID = 0,
	_sqrt = Math.sqrt,
	_cos = Math.cos,
	_sin = Math.sin,
	_isString = value => typeof(value) === "string",
	_isFunction = value => typeof(value) === "function",
	_isNumber = value => typeof(value) === "number",
	_isUndefined = value => typeof(value) === "undefined",
	_isObject = value => typeof(value) === "object",
	_isNotFalse = value => value !== false,
	_windowExists = () => typeof(window) !== "undefined",
	_isFuncOrString = value => _isFunction(value) || _isString(value),
	_isTypedArray = (typeof ArrayBuffer === "function" && ArrayBuffer.isView) || function() {}, // note: IE10 has ArrayBuffer, but NOT ArrayBuffer.isView().
	_isArray = Array.isArray,
	_strictNumExp = /(?:-?\.?\d|\.)+/gi, //only numbers (including negatives and decimals) but NOT relative values.
	_numExp = /[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g, //finds any numbers, including ones that start with += or -=, negative numbers, and ones in scientific notation like 1e-8.
	_numWithUnitExp = /[-+=.]*\d+[.e-]*\d*[a-z%]*/g,
	_complexStringNumExp = /[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi, //duplicate so that while we're looping through matches from exec(), it doesn't contaminate the lastIndex of _numExp which we use to search for colors too.
	_relExp = /[+-]=-?[.\d]+/,
	_delimitedValueExp = /[#\-+.]*\b[a-z\d-=+%.]+/gi,
	_unitExp = /[\d.+\-=]+(?:e[-+]\d*)*/i,
	_globalTimeline, _win, _coreInitted, _doc,
	_globals = {},
	_installScope = {},
	_coreReady,
	_install = scope => (_installScope = _merge(scope, _globals)) && gsap,
	_missingPlugin = (property, value) => console.warn("Invalid property", property, "set to", value, "Missing plugin? gsap.registerPlugin()"),
	_warn = (message, suppress) => !suppress && console.warn(message),
	_addGlobal = (name, obj) => (name && (_globals[name] = obj) && (_installScope && (_installScope[name] = obj))) || _globals,
	_emptyFunc = () => 0,
	_reservedProps = {},
	_lazyTweens = [],
	_lazyLookup = {},
	_lastRenderedFrame,
	_plugins = {},
	_effects = {},
	_nextGCFrame = 30,
	_harnessPlugins = [],
	_callbackNames = "",
	_harness = targets => {
		let target = targets[0],
			harnessPlugin, i;
		_isObject(target) || _isFunction(target) || (targets = [targets]);
		if (!(harnessPlugin = (target._gsap || {}).harness)) { // find the first target with a harness. We assume targets passed into an animation will be of similar type, meaning the same kind of harness can be used for them all (performance optimization)
			i = _harnessPlugins.length;
			while (i-- && !_harnessPlugins[i].targetTest(target)) {	}
			harnessPlugin = _harnessPlugins[i];
		}
		i = targets.length;
		while (i--) {
			(targets[i] && (targets[i]._gsap || (targets[i]._gsap = new GSCache(targets[i], harnessPlugin)))) || targets.splice(i, 1);
		}
		return targets;
	},
	_getCache = target => target._gsap || _harness(toArray(target))[0]._gsap,
	_getProperty = (target, property, v) => (v = target[property]) && _isFunction(v) ? target[property]() : (_isUndefined(v) && target.getAttribute && target.getAttribute(property)) || v,
	_forEachName = (names, func) => ((names = names.split(",")).forEach(func)) || names, //split a comma-delimited list of names into an array, then run a forEach() function and return the split array (this is just a way to consolidate/shorten some code).
	_round = value => Math.round(value * 100000) / 100000 || 0,
	_arrayContainsAny = (toSearch, toFind) => { //searches one array to find matches for any of the items in the toFind array. As soon as one is found, it returns true. It does NOT return all the matches; it's simply a boolean search.
		let l = toFind.length,
			i = 0;
		for (; toSearch.indexOf(toFind[i]) < 0 && ++i < l;) { }
		return (i < l);
	},
	_parseVars = (params, type, parent) => { //reads the arguments passed to one of the key methods and figures out if the user is defining things with the OLD/legacy syntax where the duration is the 2nd parameter, and then it adjusts things accordingly and spits back the corrected vars object (with the duration added if necessary, as well as runBackwards or startAt or immediateRender). type 0 = to()/staggerTo(), 1 = from()/staggerFrom(), 2 = fromTo()/staggerFromTo()
		let isLegacy = _isNumber(params[1]),
			varsIndex = (isLegacy ? 2 : 1) + (type < 2 ? 0 : 1),
			vars = params[varsIndex],
			irVars;
		isLegacy && (vars.duration = params[1]);
		vars.parent = parent;
		if (type) {
			irVars = vars;
			while (parent && !("immediateRender" in irVars)) { // inheritance hasn't happened yet, but someone may have set a default in an ancestor timeline. We could do vars.immediateRender = _isNotFalse(_inheritDefaults(vars).immediateRender) but that'd exact a slight performance penalty because _inheritDefaults() also runs in the Tween constructor. We're paying a small kb price here to gain speed.
				irVars = parent.vars.defaults || {};
				parent = _isNotFalse(parent.vars.inherit) && parent.parent;
			}
			vars.immediateRender = _isNotFalse(irVars.immediateRender);
			type < 2 ? (vars.runBackwards = 1) : (vars.startAt = params[varsIndex - 1]); // "from" vars
		}
		return vars;
	},
	_lazyRender = () => {
		let l = _lazyTweens.length,
			a = _lazyTweens.slice(0),
			i, tween;
		_lazyLookup = {};
		_lazyTweens.length = 0;
		for (i = 0; i < l; i++) {
			tween = a[i];
			tween && tween._lazy && (tween.render(tween._lazy[0], tween._lazy[1], true)._lazy = 0);
		}
	},
	_lazySafeRender = (animation, time, suppressEvents, force) => {
		_lazyTweens.length && _lazyRender();
		animation.render(time, suppressEvents, force);
		_lazyTweens.length && _lazyRender(); //in case rendering caused any tweens to lazy-init, we should render them because typically when someone calls seek() or time() or progress(), they expect an immediate render.
	},
	_numericIfPossible = value => {
		let n = parseFloat(value);
		return (n || n === 0) && (value + "").match(_delimitedValueExp).length < 2 ? n : _isString(value) ? value.trim() : value;
	},
	_passThrough = p => p,
	_setDefaults = (obj, defaults) => {
		for (let p in defaults) {
			(p in obj) || (obj[p] = defaults[p]);
		}
		return obj;
	},
	_setKeyframeDefaults = (obj, defaults) => {
		for (let p in defaults) {
			(p in obj) || p === "duration" || p === "ease" || (obj[p] = defaults[p]);
		}
	},
	_merge = (base, toMerge) => {
		for (let p in toMerge) {
			base[p] = toMerge[p];
		}
		return base;
	},
	_mergeDeep = (base, toMerge) => {
		for (let p in toMerge) {
			p !== "__proto__" && p !== "constructor" && p !== "prototype" && (base[p] = _isObject(toMerge[p]) ? _mergeDeep(base[p] || (base[p] = {}), toMerge[p]) : toMerge[p]);
		}
		return base;
	},
	_copyExcluding = (obj, excluding) => {
		let copy = {},
			p;
		for (p in obj) {
			(p in excluding) || (copy[p] = obj[p]);
		}
		return copy;
	},
	_inheritDefaults = vars => {
		let parent = vars.parent || _globalTimeline,
			func = vars.keyframes ? _setKeyframeDefaults : _setDefaults;
		if (_isNotFalse(vars.inherit)) {
			while (parent) {
				func(vars, parent.vars.defaults);
				parent = parent.parent || parent._dp;
			}
		}
		return vars;
	},
	_arraysMatch = (a1, a2) => {
		let i = a1.length,
			match = i === a2.length;
		while (match && i-- && a1[i] === a2[i]) { }
		return i < 0;
	},
	_addLinkedListItem = (parent, child, firstProp = "_first", lastProp = "_last", sortBy) => {
		let prev = parent[lastProp],
			t;
		if (sortBy) {
			t = child[sortBy];
			while (prev && prev[sortBy] > t) {
				prev = prev._prev;
			}
		}
		if (prev) {
			child._next = prev._next;
			prev._next = child;
		} else {
			child._next = parent[firstProp];
			parent[firstProp] = child;
		}
		if (child._next) {
			child._next._prev = child;
		} else {
			parent[lastProp] = child;
		}
		child._prev = prev;
		child.parent = child._dp = parent;
		return child;
	},
	_removeLinkedListItem = (parent, child, firstProp = "_first", lastProp = "_last") => {
		let prev = child._prev,
			next = child._next;
		if (prev) {
			prev._next = next;
		} else if (parent[firstProp] === child) {
			parent[firstProp] = next;
		}
		if (next) {
			next._prev = prev;
		} else if (parent[lastProp] === child) {
			parent[lastProp] = prev;
		}
		child._next = child._prev = child.parent = null; // don't delete the _dp just so we can revert if necessary. But parent should be null to indicate the item isn't in a linked list.
	},
	_removeFromParent = (child, onlyIfParentHasAutoRemove) => {
		child.parent && (!onlyIfParentHasAutoRemove || child.parent.autoRemoveChildren) && child.parent.remove(child);
		child._act = 0;
	},
	_uncache = (animation, child) => {
		if (animation && (!child || child._end > animation._dur || child._start < 0)) { // performance optimization: if a child animation is passed in we should only uncache if that child EXTENDS the animation (its end time is beyond the end)
			let a = animation;
			while (a) {
				a._dirty = 1;
				a = a.parent;
			}
		}
		return animation;
	},
	_recacheAncestors = animation => {
		let parent = animation.parent;
		while (parent && parent.parent) { //sometimes we must force a re-sort of all children and update the duration/totalDuration of all ancestor timelines immediately in case, for example, in the middle of a render loop, one tween alters another tween's timeScale which shoves its startTime before 0, forcing the parent timeline to shift around and shiftChildren() which could affect that next tween's render (startTime). Doesn't matter for the root timeline though.
			parent._dirty = 1;
			parent.totalDuration();
			parent = parent.parent;
		}
		return animation;
	},
	_hasNoPausedAncestors = animation => !animation || (animation._ts && _hasNoPausedAncestors(animation.parent)),
	_elapsedCycleDuration = animation => animation._repeat ? _animationCycle(animation._tTime, (animation = animation.duration() + animation._rDelay)) * animation : 0,
	// feed in the totalTime and cycleDuration and it'll return the cycle (iteration minus 1) and if the playhead is exactly at the very END, it will NOT bump up to the next cycle.
	_animationCycle = (tTime, cycleDuration) => {
		let whole = Math.floor(tTime /= cycleDuration);
		return tTime && (whole === tTime) ? whole - 1 : whole;
	},
	_parentToChildTotalTime = (parentTime, child) => (parentTime - child._start) * child._ts + (child._ts >= 0 ? 0 : (child._dirty ? child.totalDuration() : child._tDur)),
	_setEnd = animation => (animation._end = _round(animation._start + ((animation._tDur / Math.abs(animation._ts || animation._rts || _tinyNum)) || 0))),
	_alignPlayhead = (animation, totalTime) => { // adjusts the animation's _start and _end according to the provided totalTime (only if the parent's smoothChildTiming is true and the animation isn't paused). It doesn't do any rendering or forcing things back into parent timelines, etc. - that's what totalTime() is for.
		let parent = animation._dp;
		if (parent && parent.smoothChildTiming && animation._ts) {
			animation._start = _round(parent._time - (animation._ts > 0 ? totalTime / animation._ts : ((animation._dirty ? animation.totalDuration() : animation._tDur) - totalTime) / -animation._ts));
			_setEnd(animation);
			parent._dirty || _uncache(parent, animation); //for performance improvement. If the parent's cache is already dirty, it already took care of marking the ancestors as dirty too, so skip the function call here.
		}
		return animation;
	},
	/*
	_totalTimeToTime = (clampedTotalTime, duration, repeat, repeatDelay, yoyo) => {
		let cycleDuration = duration + repeatDelay,
			time = _round(clampedTotalTime % cycleDuration);
		if (time > duration) {
			time = duration;
		}
		return (yoyo && (~~(clampedTotalTime / cycleDuration) & 1)) ? duration - time : time;
	},
	*/
	_postAddChecks = (timeline, child) => {
		let t;
		if (child._time || (child._initted && !child._dur)) { //in case, for example, the _start is moved on a tween that has already rendered. Imagine it's at its end state, then the startTime is moved WAY later (after the end of this timeline), it should render at its beginning.
			t = _parentToChildTotalTime(timeline.rawTime(), child);
			if (!child._dur || _clamp(0, child.totalDuration(), t) - child._tTime > _tinyNum) {
				child.render(t, true);
			}
		}
		//if the timeline has already ended but the inserted tween/timeline extends the duration, we should enable this timeline again so that it renders properly. We should also align the playhead with the parent timeline's when appropriate.
		if (_uncache(timeline, child)._dp && timeline._initted && timeline._time >= timeline._dur && timeline._ts) {
			//in case any of the ancestors had completed but should now be enabled...
			if (timeline._dur < timeline.duration()) {
				t = timeline;
				while (t._dp) {
					(t.rawTime() >= 0) && t.totalTime(t._tTime); //moves the timeline (shifts its startTime) if necessary, and also enables it. If it's currently zero, though, it may not be scheduled to render until later so there's no need to force it to align with the current playhead position. Only move to catch up with the playhead.
					t = t._dp;
				}
			}
			timeline._zTime = -_tinyNum; // helps ensure that the next render() will be forced (crossingStart = true in render()), even if the duration hasn't changed (we're adding a child which would need to get rendered). Definitely an edge case. Note: we MUST do this AFTER the loop above where the totalTime() might trigger a render() because this _addToTimeline() method gets called from the Animation constructor, BEFORE tweens even record their targets, etc. so we wouldn't want things to get triggered in the wrong order.
		}
	},
	_addToTimeline = (timeline, child, position, skipChecks) => {
		child.parent && _removeFromParent(child);
		child._start = _round(position + child._delay);
		child._end = _round(child._start + ((child.totalDuration() / Math.abs(child.timeScale())) || 0));
		_addLinkedListItem(timeline, child, "_first", "_last", timeline._sort ? "_start" : 0);
		timeline._recent = child;
		skipChecks || _postAddChecks(timeline, child);
		return timeline;
	},
	_scrollTrigger = (animation, trigger) => (_globals.ScrollTrigger || _missingPlugin("scrollTrigger", trigger)) && _globals.ScrollTrigger.create(trigger, animation),
	_attemptInitTween = (tween, totalTime, force, suppressEvents) => {
		_initTween(tween, totalTime);
		if (!tween._initted) {
			return 1;
		}
		if (!force && tween._pt && ((tween._dur && tween.vars.lazy !== false) || (!tween._dur && tween.vars.lazy)) && _lastRenderedFrame !== _ticker.frame) {
			_lazyTweens.push(tween);
			tween._lazy = [totalTime, suppressEvents];
			return 1;
		}
	},
	_parentPlayheadIsBeforeStart = ({parent}) => parent && parent._ts && parent._initted && !parent._lock && (parent.rawTime() < 0 || _parentPlayheadIsBeforeStart(parent)), // check parent's _lock because when a timeline repeats/yoyos and does its artificial wrapping, we shouldn't force the ratio back to 0
	_renderZeroDurationTween = (tween, totalTime, suppressEvents, force) => {
		let prevRatio = tween.ratio,
			ratio = totalTime < 0 || (!totalTime && ((!tween._start && _parentPlayheadIsBeforeStart(tween)) || ((tween._ts < 0 || tween._dp._ts < 0) && tween.data !== "isFromStart" && tween.data !== "isStart"))) ? 0 : 1, // if the tween or its parent is reversed and the totalTime is 0, we should go to a ratio of 0.
			repeatDelay = tween._rDelay,
			tTime = 0,
			pt, iteration, prevIteration;
		if (repeatDelay && tween._repeat) { // in case there's a zero-duration tween that has a repeat with a repeatDelay
			tTime = _clamp(0, tween._tDur, totalTime);
			iteration = _animationCycle(tTime, repeatDelay);
			prevIteration = _animationCycle(tween._tTime, repeatDelay);
			tween._yoyo && (iteration & 1) && (ratio = 1 - ratio);
			if (iteration !== prevIteration) {
				prevRatio = 1 - ratio;
				tween.vars.repeatRefresh && tween._initted && tween.invalidate();
			}
		}
		if (ratio !== prevRatio || force || tween._zTime === _tinyNum || (!totalTime && tween._zTime)) {
			if (!tween._initted && _attemptInitTween(tween, totalTime, force, suppressEvents)) { // if we render the very beginning (time == 0) of a fromTo(), we must force the render (normal tweens wouldn't need to render at a time of 0 when the prevTime was also 0). This is also mandatory to make sure overwriting kicks in immediately.
				return;
			}
			prevIteration = tween._zTime;
			tween._zTime = totalTime || (suppressEvents ? _tinyNum : 0); // when the playhead arrives at EXACTLY time 0 (right on top) of a zero-duration tween, we need to discern if events are suppressed so that when the playhead moves again (next time), it'll trigger the callback. If events are NOT suppressed, obviously the callback would be triggered in this render. Basically, the callback should fire either when the playhead ARRIVES or LEAVES this exact spot, not both. Imagine doing a timeline.seek(0) and there's a callback that sits at 0. Since events are suppressed on that seek() by default, nothing will fire, but when the playhead moves off of that position, the callback should fire. This behavior is what people intuitively expect.
			suppressEvents || (suppressEvents = totalTime && !prevIteration); // if it was rendered previously at exactly 0 (_zTime) and now the playhead is moving away, DON'T fire callbacks otherwise they'll seem like duplicates.
			tween.ratio = ratio;
			tween._from && (ratio = 1 - ratio);
			tween._time = 0;
			tween._tTime = tTime;
			pt = tween._pt;
			while (pt) {
				pt.r(ratio, pt.d);
				pt = pt._next;
			}
			tween._startAt && totalTime < 0 && tween._startAt.render(totalTime, true, true);
			tween._onUpdate && !suppressEvents && _callback(tween, "onUpdate");
			tTime && tween._repeat && !suppressEvents && tween.parent && _callback(tween, "onRepeat");
			if ((totalTime >= tween._tDur || totalTime < 0) && tween.ratio === ratio) {
				ratio && _removeFromParent(tween, 1);
				if (!suppressEvents) {
					_callback(tween, (ratio ? "onComplete" : "onReverseComplete"), true);
					tween._prom && tween._prom();
				}
			}
		} else if (!tween._zTime) {
			tween._zTime = totalTime;
		}
	},
	_findNextPauseTween = (animation, prevTime, time) => {
		let child;
		if (time > prevTime) {
			child = animation._first;
			while (child && child._start <= time) {
				if (!child._dur && child.data === "isPause" && child._start > prevTime) {
					return child;
				}
				child = child._next;
			}
		} else {
			child = animation._last;
			while (child && child._start >= time) {
				if (!child._dur && child.data === "isPause" && child._start < prevTime) {
					return child;
				}
				child = child._prev;
			}
		}
	},
	_setDuration = (animation, duration, skipUncache, leavePlayhead) => {
		let repeat = animation._repeat,
			dur = _round(duration) || 0,
			totalProgress = animation._tTime / animation._tDur;
		totalProgress && !leavePlayhead && (animation._time *= dur / animation._dur);
		animation._dur = dur;
		animation._tDur = !repeat ? dur : repeat < 0 ? 1e10 : _round(dur * (repeat + 1) + (animation._rDelay * repeat));
		totalProgress && !leavePlayhead ? _alignPlayhead(animation, (animation._tTime = animation._tDur * totalProgress)) : animation.parent && _setEnd(animation);
		skipUncache || _uncache(animation.parent, animation);
		return animation;
	},
	_onUpdateTotalDuration = animation => (animation instanceof Timeline) ? _uncache(animation) : _setDuration(animation, animation._dur),
	_zeroPosition = {_start:0, endTime:_emptyFunc},
	_parsePosition = (animation, position) => {
		let labels = animation.labels,
			recent = animation._recent || _zeroPosition,
			clippedDuration = animation.duration() >= _bigNum ? recent.endTime(false) : animation._dur, //in case there's a child that infinitely repeats, users almost never intend for the insertion point of a new child to be based on a SUPER long value like that so we clip it and assume the most recently-added child's endTime should be used instead.
			i, offset;
		if (_isString(position) && (isNaN(position) || (position in labels))) { //if the string is a number like "1", check to see if there's a label with that name, otherwise interpret it as a number (absolute value).
			i = position.charAt(0);
			if (i === "<" || i === ">") {
				return (i === "<" ? recent._start : recent.endTime(recent._repeat >= 0)) + (parseFloat(position.substr(1)) || 0);
			}
			i = position.indexOf("=");
			if (i < 0) {
				(position in labels) || (labels[position] = clippedDuration);
				return labels[position];
			}
			offset = +(position.charAt(i-1) + position.substr(i+1));
			return (i > 1) ? _parsePosition(animation, position.substr(0, i-1)) + offset : clippedDuration + offset;
		}
		return (position == null) ? clippedDuration : +position;
	},
	_conditionalReturn = (value, func) => value || value === 0 ? func(value) : func,
	_clamp = (min, max, value) => value < min ? min : value > max ? max : value,
	getUnit = value => {
		if (typeof(value) !== "string") {
			return "";
		}
		let v = _unitExp.exec(value);
		return v ? value.substr(v.index + v[0].length) : "";
	}, // note: protect against padded numbers as strings, like "100.100". That shouldn't return "00" as the unit. If it's numeric, return no unit.
	clamp = (min, max, value) => _conditionalReturn(value, v => _clamp(min, max, v)),
	_slice = [].slice,
	_isArrayLike = (value, nonEmpty) => value && (_isObject(value) && "length" in value && ((!nonEmpty && !value.length) || ((value.length - 1) in value && _isObject(value[0]))) && !value.nodeType && value !== _win),
	_flatten = (ar, leaveStrings, accumulator = []) => ar.forEach(value => (_isString(value) && !leaveStrings) || _isArrayLike(value, 1) ? accumulator.push(...toArray(value)) : accumulator.push(value)) || accumulator,
	//takes any value and returns an array. If it's a string (and leaveStrings isn't true), it'll use document.querySelectorAll() and convert that to an array. It'll also accept iterables like jQuery objects.
	toArray = (value, leaveStrings) => _isString(value) && !leaveStrings && (_coreInitted || !_wake()) ? _slice.call(_doc.querySelectorAll(value), 0) : _isArray(value) ? _flatten(value, leaveStrings) : _isArrayLike(value) ? _slice.call(value, 0) : value ? [value] : [],
	shuffle = a => a.sort(() => .5 - Math.random()), // alternative that's a bit faster and more reliably diverse but bigger:   for (let j, v, i = a.length; i; j = Math.floor(Math.random() * i), v = a[--i], a[i] = a[j], a[j] = v); return a;
	//for distributing values across an array. Can accept a number, a function or (most commonly) a function which can contain the following properties: {base, amount, from, ease, grid, axis, length, each}. Returns a function that expects the following parameters: index, target, array. Recognizes the following
	distribute = v => {
		if (_isFunction(v)) {
			return v;
		}
		let vars = _isObject(v) ? v : {each:v}, //n:1 is just to indicate v was a number; we leverage that later to set v according to the length we get. If a number is passed in, we treat it like the old stagger value where 0.1, for example, would mean that things would be distributed with 0.1 between each element in the array rather than a total "amount" that's chunked out among them all.
			ease = _parseEase(vars.ease),
			from = vars.from || 0,
			base = parseFloat(vars.base) || 0,
			cache = {},
			isDecimal = (from > 0 && from < 1),
			ratios = isNaN(from) || isDecimal,
			axis = vars.axis,
			ratioX = from,
			ratioY = from;
		if (_isString(from)) {
			ratioX = ratioY = {center:.5, edges:.5, end:1}[from] || 0;
		} else if (!isDecimal && ratios) {
			ratioX = from[0];
			ratioY = from[1];
		}
		return (i, target, a) => {
			let l = (a || vars).length,
				distances = cache[l],
				originX, originY, x, y, d, j, max, min, wrapAt;
			if (!distances) {
				wrapAt = (vars.grid === "auto") ? 0 : (vars.grid || [1, _bigNum])[1];
				if (!wrapAt) {
					max = -_bigNum;
					while (max < (max = a[wrapAt++].getBoundingClientRect().left) && wrapAt < l) { }
					wrapAt--;
				}
				distances = cache[l] = [];
				originX = ratios ? (Math.min(wrapAt, l) * ratioX) - .5 : from % wrapAt;
				originY = ratios ? l * ratioY / wrapAt - .5 : (from / wrapAt) | 0;
				max = 0;
				min = _bigNum;
				for (j = 0; j < l; j++) {
					x = (j % wrapAt) - originX;
					y = originY - ((j / wrapAt) | 0);
					distances[j] = d = !axis ? _sqrt(x * x + y * y) : Math.abs((axis === "y") ? y : x);
					(d > max) && (max = d);
					(d < min) && (min = d);
				}
				(from === "random") && shuffle(distances);
				distances.max = max - min;
				distances.min = min;
				distances.v = l = (parseFloat(vars.amount) || (parseFloat(vars.each) * (wrapAt > l ? l - 1 : !axis ? Math.max(wrapAt, l / wrapAt) : axis === "y" ? l / wrapAt : wrapAt)) || 0) * (from === "edges" ? -1 : 1);
				distances.b = (l < 0) ? base - l : base;
				distances.u = getUnit(vars.amount || vars.each) || 0; //unit
				ease = (ease && l < 0) ? _invertEase(ease) : ease;
			}
			l = ((distances[i] - distances.min) / distances.max) || 0;
			return _round(distances.b + (ease ? ease(l) : l) * distances.v) + distances.u; //round in order to work around floating point errors
		};
	},
	_roundModifier = v => { //pass in 0.1 get a function that'll round to the nearest tenth, or 5 to round to the closest 5, or 0.001 to the closest 1000th, etc.
		let p = v < 1 ? Math.pow(10, (v + "").length - 2) : 1; //to avoid floating point math errors (like 24 * 0.1 == 2.4000000000000004), we chop off at a specific number of decimal places (much faster than toFixed()
		return raw => {
			let n = Math.round(parseFloat(raw) / v) * v * p;
			return (n - n % 1) / p + (_isNumber(raw) ? 0 : getUnit(raw)); // n - n % 1 replaces Math.floor() in order to handle negative values properly. For example, Math.floor(-150.00000000000003) is 151!
		};
	},
	snap = (snapTo, value) => {
		let isArray = _isArray(snapTo),
			radius, is2D;
		if (!isArray && _isObject(snapTo)) {
			radius = isArray = snapTo.radius || _bigNum;
			if (snapTo.values) {
				snapTo = toArray(snapTo.values);
				if ((is2D = !_isNumber(snapTo[0]))) {
					radius *= radius; //performance optimization so we don't have to Math.sqrt() in the loop.
				}
			} else {
				snapTo = _roundModifier(snapTo.increment);
			}
		}
		return _conditionalReturn(value, !isArray ? _roundModifier(snapTo) : _isFunction(snapTo) ? raw => {is2D = snapTo(raw); return Math.abs(is2D - raw) <= radius ? is2D : raw; } : raw => {
			let x = parseFloat(is2D ? raw.x : raw),
				y = parseFloat(is2D ? raw.y : 0),
				min = _bigNum,
				closest = 0,
				i = snapTo.length,
				dx, dy;
			while (i--) {
				if (is2D) {
					dx = snapTo[i].x - x;
					dy = snapTo[i].y - y;
					dx = dx * dx + dy * dy;
				} else {
					dx = Math.abs(snapTo[i] - x);
				}
				if (dx < min) {
					min = dx;
					closest = i;
				}
			}
			closest = (!radius || min <= radius) ? snapTo[closest] : raw;
			return (is2D || closest === raw || _isNumber(raw)) ? closest : closest + getUnit(raw);
		});
	},
	random = (min, max, roundingIncrement, returnFunction) => _conditionalReturn(_isArray(min) ? !max : roundingIncrement === true ? !!(roundingIncrement = 0) : !returnFunction, () => _isArray(min) ? min[~~(Math.random() * min.length)] : (roundingIncrement = roundingIncrement || 1e-5) && (returnFunction = roundingIncrement < 1 ? 10 ** ((roundingIncrement + "").length - 2) : 1) && (Math.floor(Math.round((min - roundingIncrement / 2 + Math.random() * (max - min + roundingIncrement * .99)) / roundingIncrement) * roundingIncrement * returnFunction) / returnFunction)),
	pipe = (...functions) => value => functions.reduce((v, f) => f(v), value),
	unitize = (func, unit) => value => func(parseFloat(value)) + (unit || getUnit(value)),
	normalize = (min, max, value) => mapRange(min, max, 0, 1, value),
	_wrapArray = (a, wrapper, value) => _conditionalReturn(value, index => a[~~wrapper(index)]),
	wrap = function(min, max, value) { // NOTE: wrap() CANNOT be an arrow function! A very odd compiling bug causes problems (unrelated to GSAP).
		let range = max - min;
		return _isArray(min) ? _wrapArray(min, wrap(0, min.length), max) : _conditionalReturn(value, value => ((range + (value - min) % range) % range) + min);
	},
	wrapYoyo = (min, max, value) => {
		let range = max - min,
			total = range * 2;
		return _isArray(min) ? _wrapArray(min, wrapYoyo(0, min.length - 1), max) : _conditionalReturn(value, value => {
			value = (total + (value - min) % total) % total || 0;
			return min + ((value > range) ? (total - value) : value);
		});
	},
	_replaceRandom = value => { //replaces all occurrences of random(...) in a string with the calculated random value. can be a range like random(-100, 100, 5) or an array like random([0, 100, 500])
		let prev = 0,
			s = "",
			i, nums, end, isArray;
		while (~(i = value.indexOf("random(", prev))) {
			end = value.indexOf(")", i);
			isArray = value.charAt(i + 7) === "[";
			nums = value.substr(i + 7, end - i - 7).match(isArray ? _delimitedValueExp : _strictNumExp);
			s += value.substr(prev, i - prev) + random(isArray ? nums : +nums[0], isArray ? 0 : +nums[1], +nums[2] || 1e-5);
			prev = end + 1;
		}
		return s + value.substr(prev, value.length - prev);
	},
	mapRange = (inMin, inMax, outMin, outMax, value) => {
		let inRange = inMax - inMin,
			outRange = outMax - outMin;
		return _conditionalReturn(value, value => outMin + ((((value - inMin) / inRange) * outRange) || 0));
	},
	interpolate = (start, end, progress, mutate) => {
		let func = isNaN(start + end) ? 0 : p => (1 - p) * start + p * end;
		if (!func) {
			let isString = _isString(start),
				master = {},
				p, i, interpolators, l, il;
			progress === true && (mutate = 1) && (progress = null);
			if (isString) {
				start = {p: start};
				end = {p: end};

			} else if (_isArray(start) && !_isArray(end)) {
				interpolators = [];
				l = start.length;
				il = l - 2;
				for (i = 1; i < l; i++) {
					interpolators.push(interpolate(start[i-1], start[i])); //build the interpolators up front as a performance optimization so that when the function is called many times, it can just reuse them.
				}
				l--;
				func = p => {
					p *= l;
					let i = Math.min(il, ~~p);
					return interpolators[i](p - i);
				};
				progress = end;
			} else if (!mutate) {
				start = _merge(_isArray(start) ? [] : {}, start);
			}
			if (!interpolators) {
				for (p in end) {
					_addPropTween.call(master, start, p, "get", end[p]);
				}
				func = p => _renderPropTweens(p, master) || (isString ? start.p : start);
			}
		}
		return _conditionalReturn(progress, func);
	},
	_getLabelInDirection = (timeline, fromTime, backward) => { //used for nextLabel() and previousLabel()
		let labels = timeline.labels,
			min = _bigNum,
			p, distance, label;
		for (p in labels) {
			distance = labels[p] - fromTime;
			if ((distance < 0) === !!backward && distance && min > (distance = Math.abs(distance))) {
				label = p;
				min = distance;
			}
		}
		return label;
	},
	_callback = (animation, type, executeLazyFirst) => {
		let v = animation.vars,
			callback = v[type],
			params, scope;
		if (!callback) {
			return;
		}
		params = v[type + "Params"];
		scope = v.callbackScope || animation;
		executeLazyFirst && _lazyTweens.length && _lazyRender(); //in case rendering caused any tweens to lazy-init, we should render them because typically when a timeline finishes, users expect things to have rendered fully. Imagine an onUpdate on a timeline that reports/checks tweened values.
		return params ? callback.apply(scope, params) : callback.call(scope);
	},
	_interrupt = animation => {
		_removeFromParent(animation);
		animation.scrollTrigger && animation.scrollTrigger.kill(false);
		animation.progress() < 1 && _callback(animation, "onInterrupt");
		return animation;
	},
	_quickTween,
	_createPlugin = config => {
		config = !config.name && config.default || config; //UMD packaging wraps things oddly, so for example MotionPathHelper becomes {MotionPathHelper:MotionPathHelper, default:MotionPathHelper}.
		let name = config.name,
			isFunc = _isFunction(config),
			Plugin = (name && !isFunc && config.init) ? function() { this._props = []; } : config, //in case someone passes in an object that's not a plugin, like CustomEase
			instanceDefaults = {init:_emptyFunc, render:_renderPropTweens, add:_addPropTween, kill:_killPropTweensOf, modifier:_addPluginModifier, rawVars:0},
			statics = {targetTest:0, get:0, getSetter:_getSetter, aliases:{}, register:0};
		_wake();
		if (config !== Plugin) {
			if (_plugins[name]) {
				return;
			}
			_setDefaults(Plugin, _setDefaults(_copyExcluding(config, instanceDefaults), statics)); //static methods
			_merge(Plugin.prototype, _merge(instanceDefaults, _copyExcluding(config, statics))); //instance methods
			_plugins[(Plugin.prop = name)] = Plugin;
			if (config.targetTest) {
				_harnessPlugins.push(Plugin);
				_reservedProps[name] = 1;
			}
			name = (name === "css" ? "CSS" : name.charAt(0).toUpperCase() + name.substr(1)) + "Plugin"; //for the global name. "motionPath" should become MotionPathPlugin
		}
		_addGlobal(name, Plugin);
		config.register && config.register(gsap, Plugin, PropTween);
	},
















/*
 * --------------------------------------------------------------------------------------
 * COLORS
 * --------------------------------------------------------------------------------------
 */

	_255 = 255,
	_colorLookup = {
		aqua:[0,_255,_255],
		lime:[0,_255,0],
		silver:[192,192,192],
		black:[0,0,0],
		maroon:[128,0,0],
		teal:[0,128,128],
		blue:[0,0,_255],
		navy:[0,0,128],
		white:[_255,_255,_255],
		olive:[128,128,0],
		yellow:[_255,_255,0],
		orange:[_255,165,0],
		gray:[128,128,128],
		purple:[128,0,128],
		green:[0,128,0],
		red:[_255,0,0],
		pink:[_255,192,203],
		cyan:[0,_255,_255],
		transparent:[_255,_255,_255,0]
	},
	_hue = (h, m1, m2) => {
		h = (h < 0) ? h + 1 : (h > 1) ? h - 1 : h;
		return ((((h * 6 < 1) ? m1 + (m2 - m1) * h * 6 : (h < .5) ? m2 : (h * 3 < 2) ? m1 + (m2 - m1) * (2 / 3 - h) * 6 : m1) * _255) + .5) | 0;
	},
	splitColor = (v, toHSL, forceAlpha) => {
		let a = !v ? _colorLookup.black : _isNumber(v) ? [v >> 16, (v >> 8) & _255, v & _255] : 0,
			r, g, b, h, s, l, max, min, d, wasHSL;
		if (!a) {
			if (v.substr(-1) === ",") { //sometimes a trailing comma is included and we should chop it off (typically from a comma-delimited list of values like a textShadow:"2px 2px 2px blue, 5px 5px 5px rgb(255,0,0)" - in this example "blue," has a trailing comma. We could strip it out inside parseComplex() but we'd need to do it to the beginning and ending values plus it wouldn't provide protection from other potential scenarios like if the user passes in a similar value.
				v = v.substr(0, v.length - 1);
			}
			if (_colorLookup[v]) {
				a = _colorLookup[v];
			} else if (v.charAt(0) === "#") {
				if (v.length < 6) { //for shorthand like #9F0 or #9F0F (could have alpha)
					r = v.charAt(1);
					g = v.charAt(2);
					b = v.charAt(3);
					v = "#" + r + r + g + g + b + b + (v.length === 5 ? v.charAt(4) + v.charAt(4) : "");
				}
				if (v.length === 9) { // hex with alpha, like #fd5e53ff
					a = parseInt(v.substr(1, 6), 16);
					return [a >> 16, (a >> 8) & _255, a & _255, parseInt(v.substr(7), 16) / 255];
				}
				v = parseInt(v.substr(1), 16);
				a = [v >> 16, (v >> 8) & _255, v & _255];
			} else if (v.substr(0, 3) === "hsl") {
				a = wasHSL = v.match(_strictNumExp);
				if (!toHSL) {
					h = (+a[0] % 360) / 360;
					s = +a[1] / 100;
					l = +a[2] / 100;
					g = (l <= .5) ? l * (s + 1) : l + s - l * s;
					r = l * 2 - g;
					a.length > 3 && (a[3] *= 1); //cast as number
					a[0] = _hue(h + 1 / 3, r, g);
					a[1] = _hue(h, r, g);
					a[2] = _hue(h - 1 / 3, r, g);
				} else if (~v.indexOf("=")) { //if relative values are found, just return the raw strings with the relative prefixes in place.
					a = v.match(_numExp);
					forceAlpha && a.length < 4 && (a[3] = 1);
					return a;
				}
			} else {
				a = v.match(_strictNumExp) || _colorLookup.transparent;
			}
			a = a.map(Number);
		}
		if (toHSL && !wasHSL) {
			r = a[0] / _255;
			g = a[1] / _255;
			b = a[2] / _255;
			max = Math.max(r, g, b);
			min = Math.min(r, g, b);
			l = (max + min) / 2;
			if (max === min) {
				h = s = 0;
			} else {
				d = max - min;
				s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
				h = (max === r) ? (g - b) / d + (g < b ? 6 : 0) : (max === g) ? (b - r) / d + 2 : (r - g) / d + 4;
				h *= 60;
			}
			a[0] = ~~(h + .5);
			a[1] = ~~(s * 100 + .5);
			a[2] = ~~(l * 100 + .5);
		}
		forceAlpha && a.length < 4 && (a[3] = 1);
		return a;
	},
	_colorOrderData = v => { // strips out the colors from the string, finds all the numeric slots (with units) and returns an array of those. The Array also has a "c" property which is an Array of the index values where the colors belong. This is to help work around issues where there's a mis-matched order of color/numeric data like drop-shadow(#f00 0px 1px 2px) and drop-shadow(0x 1px 2px #f00). This is basically a helper function used in _formatColors()
		let values = [],
			c = [],
			i = -1;
		v.split(_colorExp).forEach(v => {
			let a = v.match(_numWithUnitExp) || [];
			values.push(...a);
			c.push(i += a.length + 1);
		});
		values.c = c;
		return values;
	},
	_formatColors = (s, toHSL, orderMatchData) => {
		let result = "",
			colors = (s + result).match(_colorExp),
			type = toHSL ? "hsla(" : "rgba(",
			i = 0,
			c, shell, d, l;
		if (!colors) {
			return s;
		}
		colors = colors.map(color => (color = splitColor(color, toHSL, 1)) && type + (toHSL ? color[0] + "," + color[1] + "%," + color[2] + "%," + color[3] : color.join(",")) + ")");
		if (orderMatchData) {
			d = _colorOrderData(s);
			c = orderMatchData.c;
			if (c.join(result) !== d.c.join(result)) {
				shell = s.replace(_colorExp, "1").split(_numWithUnitExp);
				l = shell.length - 1;
				for (; i < l; i++) {
					result += shell[i] + (~c.indexOf(i) ? colors.shift() || type + "0,0,0,0)" : (d.length ? d : colors.length ? colors : orderMatchData).shift());
				}
			}
		}
		if (!shell) {
			shell = s.split(_colorExp);
			l = shell.length - 1;
			for (; i < l; i++) {
				result += shell[i] + colors[i];
			}
		}
		return result + shell[l];
	},
	_colorExp = (function() {
		let s = "(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b", //we'll dynamically build this Regular Expression to conserve file size. After building it, it will be able to find rgb(), rgba(), # (hexadecimal), and named color values like red, blue, purple, etc.,
			p;
		for (p in _colorLookup) {
			s += "|" + p + "\\b";
		}
		return new RegExp(s + ")", "gi");
	})(),
	_hslExp = /hsl[a]?\(/,
	_colorStringFilter = a => {
		let combined = a.join(" "),
			toHSL;
		_colorExp.lastIndex = 0;
		if (_colorExp.test(combined)) {
			toHSL = _hslExp.test(combined);
			a[1] = _formatColors(a[1], toHSL);
			a[0] = _formatColors(a[0], toHSL, _colorOrderData(a[1])); // make sure the order of numbers/colors match with the END value.
			return true;
		}
	},
















/*
 * --------------------------------------------------------------------------------------
 * TICKER
 * --------------------------------------------------------------------------------------
 */
	_tickerActive,
	_ticker = (function() {
		let _getTime = Date.now,
			_lagThreshold = 500,
			_adjustedLag = 33,
			_startTime = _getTime(),
			_lastUpdate = _startTime,
			_gap = 1000 / 240,
			_nextTime = _gap,
			_listeners = [],
			_id, _req, _raf, _self, _delta, _i,
			_tick = v => {
				let elapsed = _getTime() - _lastUpdate,
					manual = v === true,
					overlap, dispatch, time, frame;
				elapsed > _lagThreshold && (_startTime += elapsed - _adjustedLag);
				_lastUpdate += elapsed;
				time = _lastUpdate - _startTime;
				overlap = time - _nextTime;
				if (overlap > 0 || manual) {
					frame = ++_self.frame;
					_delta = time - _self.time * 1000;
					_self.time = time = time / 1000;
					_nextTime += overlap + (overlap >= _gap ? 4 : _gap - overlap);
					dispatch = 1;
				}
				manual || (_id = _req(_tick)); //make sure the request is made before we dispatch the "tick" event so that timing is maintained. Otherwise, if processing the "tick" requires a bunch of time (like 15ms) and we're using a setTimeout() that's based on 16.7ms, it'd technically take 31.7ms between frames otherwise.
				if (dispatch) {
					for (_i = 0; _i < _listeners.length; _i++) { // use _i and check _listeners.length instead of a variable because a listener could get removed during the loop, and if that happens to an element less than the current index, it'd throw things off in the loop.
						_listeners[_i](time, _delta, frame, v);
					}
				}
			};
		_self = {
			time:0,
			frame:0,
			tick() {
				_tick(true);
			},
			deltaRatio(fps) {
				return _delta / (1000 / (fps || 60));
			},
			wake() {
				if (_coreReady) {
					if (!_coreInitted && _windowExists()) {
						_win = _coreInitted = window;
						_doc = _win.document || {};
						_globals.gsap = gsap;
						(_win.gsapVersions || (_win.gsapVersions = [])).push(gsap.version);
						_install(_installScope || _win.GreenSockGlobals || (!_win.gsap && _win) || {});
						_raf = _win.requestAnimationFrame;
					}
					_id && _self.sleep();
					_req = _raf || (f => setTimeout(f, (_nextTime - _self.time * 1000 + 1) | 0));
					_tickerActive = 1;
					_tick(2);
				}
			},
			sleep() {
				(_raf ? _win.cancelAnimationFrame : clearTimeout)(_id);
				_tickerActive = 0;
				_req = _emptyFunc;
			},
			lagSmoothing(threshold, adjustedLag) {
				_lagThreshold = threshold || (1 / _tinyNum); //zero should be interpreted as basically unlimited
				_adjustedLag = Math.min(adjustedLag, _lagThreshold, 0);
			},
			fps(fps) {
				_gap = 1000 / (fps || 240);
				_nextTime = _self.time * 1000 + _gap;
			},
			add(callback) {
				_listeners.indexOf(callback) < 0 && _listeners.push(callback);
				_wake();
			},
			remove(callback) {
				let i;
				~(i = _listeners.indexOf(callback)) && _listeners.splice(i, 1) && _i >= i && _i--;
			},
			_listeners:_listeners
		};
		return _self;
	})(),
	_wake = () => !_tickerActive && _ticker.wake(), //also ensures the core classes are initialized.














/*
* -------------------------------------------------
* EASING
* -------------------------------------------------
*/
	_easeMap = {},
	_customEaseExp = /^[\d.\-M][\d.\-,\s]/,
	_quotesExp = /["']/g,
	_parseObjectInString = value => { //takes a string like "{wiggles:10, type:anticipate})" and turns it into a real object. Notice it ends in ")" and includes the {} wrappers. This is because we only use this function for parsing ease configs and prioritized optimization rather than reusability.
		let obj = {},
			split = value.substr(1, value.length-3).split(":"),
			key = split[0],
			i = 1,
			l = split.length,
			index, val, parsedVal;
		for (; i < l; i++) {
			val = split[i];
			index = i !== l-1 ? val.lastIndexOf(",") : val.length;
			parsedVal = val.substr(0, index);
			obj[key] = isNaN(parsedVal) ? parsedVal.replace(_quotesExp, "").trim() : +parsedVal;
			key = val.substr(index+1).trim();
		}
		return obj;
	},
	_valueInParentheses = value => {
		let open = value.indexOf("(") + 1,
			close = value.indexOf(")"),
			nested = value.indexOf("(", open);
		return value.substring(open, ~nested && nested < close ? value.indexOf(")", close + 1) : close);
	},
	_configEaseFromString = name => { //name can be a string like "elastic.out(1,0.5)", and pass in _easeMap as obj and it'll parse it out and call the actual function like _easeMap.Elastic.easeOut.config(1,0.5). It will also parse custom ease strings as long as CustomEase is loaded and registered (internally as _easeMap._CE).
		let split = (name + "").split("("),
			ease = _easeMap[split[0]];
		return (ease && split.length > 1 && ease.config) ? ease.config.apply(null, ~name.indexOf("{") ? [_parseObjectInString(split[1])] : _valueInParentheses(name).split(",").map(_numericIfPossible)) : (_easeMap._CE && _customEaseExp.test(name)) ? _easeMap._CE("", name) : ease;
	},
	_invertEase = ease => p => 1 - ease(1 - p),
	// allow yoyoEase to be set in children and have those affected when the parent/ancestor timeline yoyos.
	_propagateYoyoEase = (timeline, isYoyo) => {
		let child = timeline._first, ease;
		while (child) {
			if (child instanceof Timeline) {
				_propagateYoyoEase(child, isYoyo);
			} else if (child.vars.yoyoEase && (!child._yoyo || !child._repeat) && child._yoyo !== isYoyo) {
				if (child.timeline) {
					_propagateYoyoEase(child.timeline, isYoyo);
				} else {
					ease = child._ease;
					child._ease = child._yEase;
					child._yEase = ease;
					child._yoyo = isYoyo;
				}
			}
			child = child._next;
		}
	},
	_parseEase = (ease, defaultEase) => !ease ? defaultEase : (_isFunction(ease) ? ease : _easeMap[ease] || _configEaseFromString(ease)) || defaultEase,
	_insertEase = (names, easeIn, easeOut = p => 1 - easeIn(1 - p), easeInOut = (p => p < .5 ? easeIn(p * 2) / 2 : 1 - easeIn((1 - p) * 2) / 2)) => {
		let ease = {easeIn, easeOut, easeInOut},
			lowercaseName;
		_forEachName(names, name => {
			_easeMap[name] = _globals[name] = ease;
			_easeMap[(lowercaseName = name.toLowerCase())] = easeOut;
			for (let p in ease) {
				_easeMap[lowercaseName + (p === "easeIn" ? ".in" : p === "easeOut" ? ".out" : ".inOut")] = _easeMap[name + "." + p] = ease[p];
			}
		});
		return ease;
	},
	_easeInOutFromOut = easeOut => (p => p < .5 ? (1 - easeOut(1 - (p * 2))) / 2 : .5 + easeOut((p - .5) * 2) / 2),
	_configElastic = (type, amplitude, period) => {
		let p1 = (amplitude >= 1) ? amplitude : 1, //note: if amplitude is < 1, we simply adjust the period for a more natural feel. Otherwise the math doesn't work right and the curve starts at 1.
			p2 = (period || (type ? .3 : .45)) / (amplitude < 1 ? amplitude : 1),
			p3 = p2 / _2PI * (Math.asin(1 / p1) || 0),
			easeOut = p => p === 1 ? 1 : p1 * (2 ** (-10 * p)) * _sin((p - p3) * p2) + 1,
			ease = (type === "out") ? easeOut : (type === "in") ? p => 1 - easeOut(1 - p) : _easeInOutFromOut(easeOut);
		p2 = _2PI / p2; //precalculate to optimize
		ease.config = (amplitude, period) => _configElastic(type, amplitude, period);
		return ease;
	},
	_configBack = (type, overshoot = 1.70158) => {
		let easeOut = p => p ? ((--p) * p * ((overshoot + 1) * p + overshoot) + 1) : 0,
			ease = (type === "out") ? easeOut : (type === "in") ? p => 1 - easeOut(1 - p) : _easeInOutFromOut(easeOut);
		ease.config = overshoot => _configBack(type, overshoot);
		return ease;
	};
	// a cheaper (kb and cpu) but more mild way to get a parameterized weighted ease by feeding in a value between -1 (easeIn) and 1 (easeOut) where 0 is linear.
	// _weightedEase = ratio => {
	// 	let y = 0.5 + ratio / 2;
	// 	return p => (2 * (1 - p) * p * y + p * p);
	// },
	// a stronger (but more expensive kb/cpu) parameterized weighted ease that lets you feed in a value between -1 (easeIn) and 1 (easeOut) where 0 is linear.
	// _weightedEaseStrong = ratio => {
	// 	ratio = .5 + ratio / 2;
	// 	let o = 1 / 3 * (ratio < .5 ? ratio : 1 - ratio),
	// 		b = ratio - o,
	// 		c = ratio + o;
	// 	return p => p === 1 ? p : 3 * b * (1 - p) * (1 - p) * p + 3 * c * (1 - p) * p * p + p * p * p;
	// };

_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong", (name, i) => {
	let power = i < 5 ? i + 1 : i;
	_insertEase(name + ",Power" + (power - 1), i ? p => p ** power : p => p, p => 1 - (1 - p) ** power, p => p < .5 ? (p * 2) ** power / 2 : 1 - ((1 - p) * 2) ** power / 2);
});
_easeMap.Linear.easeNone = _easeMap.none = _easeMap.Linear.easeIn;
_insertEase("Elastic", _configElastic("in"), _configElastic("out"), _configElastic());
((n, c) => {
	let n1 = 1 / c,
		n2 = 2 * n1,
		n3 = 2.5 * n1,
		easeOut = p => (p < n1) ? n * p * p : (p < n2) ? n * (p - 1.5 / c) ** 2 + .75 : (p < n3) ? n * (p -= 2.25 / c) * p + .9375 : n * (p - 2.625 / c) ** 2 + .984375;
	_insertEase("Bounce", p => 1 - easeOut(1 - p), easeOut);
})(7.5625, 2.75);
_insertEase("Expo", p => p ? 2 ** (10 * (p - 1)) : 0);
_insertEase("Circ", p => -(_sqrt(1 - (p * p)) - 1));
_insertEase("Sine", p => p === 1 ? 1 : -_cos(p * _HALF_PI) + 1);
_insertEase("Back", _configBack("in"), _configBack("out"), _configBack());
_easeMap.SteppedEase = _easeMap.steps = _globals.SteppedEase = {
	config(steps = 1, immediateStart) {
		let p1 = 1 / steps,
			p2 = steps + (immediateStart ? 0 : 1),
			p3 = immediateStart ? 1 : 0,
			max = 1 - _tinyNum;
		return p => (((p2 * _clamp(0, max, p)) | 0) + p3) * p1;
	}
};
_defaults.ease = _easeMap["quad.out"];


_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt", name => _callbackNames += name + "," + name + "Params,");














/*
 * --------------------------------------------------------------------------------------
 * CACHE
 * --------------------------------------------------------------------------------------
 */
class GSCache {

	constructor(target, harness) {
		this.id = _gsID++;
		target._gsap = this;
		this.target = target;
		this.harness = harness;
		this.get = harness ? harness.get : _getProperty;
		this.set = harness ? harness.getSetter : _getSetter;
	}

}















/*
 * --------------------------------------------------------------------------------------
 * ANIMATION
 * --------------------------------------------------------------------------------------
 */

class Animation {

	constructor(vars, time) {
		let parent = vars.parent || _globalTimeline;
		this.vars = vars;
		this._delay = +vars.delay || 0;
		if ((this._repeat = vars.repeat === Infinity ? -2 : vars.repeat || 0)) { // TODO: repeat: Infinity on a timeline's children must flag that timeline internally and affect its totalDuration, otherwise it'll stop in the negative direction when reaching the start.
			this._rDelay = vars.repeatDelay || 0;
			this._yoyo = !!vars.yoyo || !!vars.yoyoEase;
		}
		this._ts = 1;
		_setDuration(this, +vars.duration, 1, 1);
		this.data = vars.data;
		_tickerActive || _ticker.wake();
		parent && _addToTimeline(parent, this, (time || time === 0) ? time : parent._time, 1);
		vars.reversed && this.reverse();
		vars.paused && this.paused(true);
	}

	delay(value) {
		if (value || value === 0) {
			this.parent && this.parent.smoothChildTiming && (this.startTime(this._start + value - this._delay));
			this._delay = value;
			return this;
		}
		return this._delay;
	}

	duration(value) {
		return arguments.length ? this.totalDuration(this._repeat > 0 ? value + (value + this._rDelay) * this._repeat : value) : this.totalDuration() && this._dur;
	}

	totalDuration(value) {
		if (!arguments.length) {
			return this._tDur;
		}
		this._dirty = 0;
		return _setDuration(this, this._repeat < 0 ? value : (value - (this._repeat * this._rDelay)) / (this._repeat + 1));
	}

	totalTime(totalTime, suppressEvents) {
		_wake();
		if (!arguments.length) {
			return this._tTime;
		}
		let parent = this._dp;
		if (parent && parent.smoothChildTiming && this._ts) {
			_alignPlayhead(this, totalTime);
			!parent._dp || parent.parent || _postAddChecks(parent, this); // edge case: if this is a child of a timeline that already completed, for example, we must re-activate the parent.
			//in case any of the ancestor timelines had completed but should now be enabled, we should reset their totalTime() which will also ensure that they're lined up properly and enabled. Skip for animations that are on the root (wasteful). Example: a TimelineLite.exportRoot() is performed when there's a paused tween on the root, the export will not complete until that tween is unpaused, but imagine a child gets restarted later, after all [unpaused] tweens have completed. The start of that child would get pushed out, but one of the ancestors may have completed.
			while (parent.parent) {
				if (parent.parent._time !== parent._start + (parent._ts >= 0 ? parent._tTime / parent._ts : (parent.totalDuration() - parent._tTime) / -parent._ts)) {
					parent.totalTime(parent._tTime, true);
				}
				parent = parent.parent;
			}
			if (!this.parent && this._dp.autoRemoveChildren && ((this._ts > 0 && totalTime < this._tDur) || (this._ts < 0 && totalTime > 0) || (!this._tDur && !totalTime) )) { //if the animation doesn't have a parent, put it back into its last parent (recorded as _dp for exactly cases like this). Limit to parents with autoRemoveChildren (like globalTimeline) so that if the user manually removes an animation from a timeline and then alters its playhead, it doesn't get added back in.
				_addToTimeline(this._dp, this, this._start - this._delay);
			}
		}
        if (this._tTime !== totalTime || (!this._dur && !suppressEvents) || (this._initted && Math.abs(this._zTime) === _tinyNum) || (!totalTime && !this._initted && (this.add || this._ptLookup))) { // check for _ptLookup on a Tween instance to ensure it has actually finished being instantiated, otherwise if this.reverse() gets called in the Animation constructor, it could trigger a render() here even though the _targets weren't populated, thus when _init() is called there won't be any PropTweens (it'll act like the tween is non-functional)
        	this._ts || (this._pTime = totalTime); // otherwise, if an animation is paused, then the playhead is moved back to zero, then resumed, it'd revert back to the original time at the pause
	        //if (!this._lock) { // avoid endless recursion (not sure we need this yet or if it's worth the performance hit)
		    //   this._lock = 1;
		        _lazySafeRender(this, totalTime, suppressEvents);
		    //   this._lock = 0;
	        //}
		}
		return this;
	}

	time(value, suppressEvents) {
		return arguments.length ? this.totalTime((Math.min(this.totalDuration(), value + _elapsedCycleDuration(this)) % this._dur) || (value ? this._dur : 0), suppressEvents) : this._time; // note: if the modulus results in 0, the playhead could be exactly at the end or the beginning, and we always defer to the END with a non-zero value, otherwise if you set the time() to the very end (duration()), it would render at the START!
	}

	totalProgress(value, suppressEvents) {
		return arguments.length ? this.totalTime( this.totalDuration() * value, suppressEvents) : this.totalDuration() ? Math.min(1, this._tTime / this._tDur) : this.ratio;
	}

	progress(value, suppressEvents) {
		return arguments.length ? this.totalTime( this.duration() * (this._yoyo && !(this.iteration() & 1) ? 1 - value : value) + _elapsedCycleDuration(this), suppressEvents) : (this.duration() ? Math.min(1, this._time / this._dur) : this.ratio);
	}

	iteration(value, suppressEvents) {
		let cycleDuration = this.duration() + this._rDelay;
		return arguments.length ? this.totalTime(this._time + (value - 1) * cycleDuration, suppressEvents) : this._repeat ? _animationCycle(this._tTime, cycleDuration) + 1 : 1;
	}

	// potential future addition:
	// isPlayingBackwards() {
	// 	let animation = this,
	// 		orientation = 1; // 1 = forward, -1 = backward
	// 	while (animation) {
	// 		orientation *= animation.reversed() || (animation.repeat() && !(animation.iteration() & 1)) ? -1 : 1;
	// 		animation = animation.parent;
	// 	}
	// 	return orientation < 0;
	// }

	timeScale(value) {
		if (!arguments.length) {
			return this._rts === -_tinyNum ? 0 : this._rts; // recorded timeScale. Special case: if someone calls reverse() on an animation with timeScale of 0, we assign it -_tinyNum to remember it's reversed.
		}
		if (this._rts === value) {
			return this;
		}
		let tTime = this.parent && this._ts ? _parentToChildTotalTime(this.parent._time, this) : this._tTime; // make sure to do the parentToChildTotalTime() BEFORE setting the new _ts because the old one must be used in that calculation.
		// prioritize rendering where the parent's playhead lines up instead of this._tTime because there could be a tween that's animating another tween's timeScale in the same rendering loop (same parent), thus if the timeScale tween renders first, it would alter _start BEFORE _tTime was set on that tick (in the rendering loop), effectively freezing it until the timeScale tween finishes.
		this._rts = +value || 0;
		this._ts = (this._ps || value === -_tinyNum) ? 0 : this._rts; // _ts is the functional timeScale which would be 0 if the animation is paused.
		return _recacheAncestors(this.totalTime(_clamp(-this._delay, this._tDur, tTime), true));
	}

	paused(value) {
		if (!arguments.length) {
			return this._ps;
		}
		if (this._ps !== value) {
			this._ps = value;
			if (value) {
				this._pTime = this._tTime || Math.max(-this._delay, this.rawTime()); // if the pause occurs during the delay phase, make sure that's factored in when resuming.
				this._ts = this._act = 0; // _ts is the functional timeScale, so a paused tween would effectively have a timeScale of 0. We record the "real" timeScale as _rts (recorded time scale)
			} else {
				_wake();
				this._ts = this._rts;
				//only defer to _pTime (pauseTime) if tTime is zero. Remember, someone could pause() an animation, then scrub the playhead and resume(). If the parent doesn't have smoothChildTiming, we render at the rawTime() because the startTime won't get updated.
				this.totalTime(this.parent && !this.parent.smoothChildTiming ? this.rawTime() : this._tTime || this._pTime, (this.progress() === 1) && (this._tTime -= _tinyNum) && Math.abs(this._zTime) !== _tinyNum); // edge case: animation.progress(1).pause().play() wouldn't render again because the playhead is already at the end, but the call to totalTime() below will add it back to its parent...and not remove it again (since removing only happens upon rendering at a new time). Offsetting the _tTime slightly is done simply to cause the final render in totalTime() that'll pop it off its timeline (if autoRemoveChildren is true, of course). Check to make sure _zTime isn't -_tinyNum to avoid an edge case where the playhead is pushed to the end but INSIDE a tween/callback, the timeline itself is paused thus halting rendering and leaving a few unrendered. When resuming, it wouldn't render those otherwise.
			}
		}
		return this;
	}

	startTime(value) {
		if (arguments.length) {
			this._start = value;
			let parent = this.parent || this._dp;
			parent && (parent._sort || !this.parent) && _addToTimeline(parent, this, value - this._delay);
			return this;
		}
		return this._start;
	}

	endTime(includeRepeats) {
		return this._start + (_isNotFalse(includeRepeats) ? this.totalDuration() : this.duration()) / Math.abs(this._ts);
	}

	rawTime(wrapRepeats) {
		let parent = this.parent || this._dp; // _dp = detatched parent
		return !parent ? this._tTime : (wrapRepeats && (!this._ts || (this._repeat && this._time && this.totalProgress() < 1))) ? this._tTime % (this._dur + this._rDelay) : !this._ts ? this._tTime : _parentToChildTotalTime(parent.rawTime(wrapRepeats), this);
	}

	globalTime(rawTime) {
		let animation = this,
			time = arguments.length ? rawTime : animation.rawTime();
		while (animation) {
			time = animation._start + time / (animation._ts || 1);
			animation = animation._dp;
		}
		return time;
	}

	repeat(value) {
		if (arguments.length) {
			this._repeat = value === Infinity ? -2 : value;
			return _onUpdateTotalDuration(this);
		}
		return this._repeat === -2 ? Infinity : this._repeat;
	}

	repeatDelay(value) {
		if (arguments.length) {
			this._rDelay = value;
			return _onUpdateTotalDuration(this);
		}
		return this._rDelay;
	}

	yoyo(value) {
		if (arguments.length) {
			this._yoyo = value;
			return this;
		}
		return this._yoyo;
	}

	seek(position, suppressEvents) {
		return this.totalTime(_parsePosition(this, position), _isNotFalse(suppressEvents));
	}

	restart(includeDelay, suppressEvents) {
		return this.play().totalTime(includeDelay ? -this._delay : 0, _isNotFalse(suppressEvents));
	}

	play(from, suppressEvents) {
		from != null && this.seek(from, suppressEvents);
		return this.reversed(false).paused(false);
	}

	reverse(from, suppressEvents) {
		from != null && this.seek(from || this.totalDuration(), suppressEvents);
		return this.reversed(true).paused(false);
	}

	pause(atTime, suppressEvents) {
		atTime != null && this.seek(atTime, suppressEvents);
		return this.paused(true);
	}

	resume() {
		return this.paused(false);
	}

	reversed(value) {
		if (arguments.length) {
			!!value !== this.reversed() && this.timeScale(-this._rts || (value ? -_tinyNum : 0)); // in case timeScale is zero, reversing would have no effect so we use _tinyNum.
			return this;
		}
		return this._rts < 0;
	}

	invalidate() {
		this._initted = this._act = 0;
		this._zTime = -_tinyNum;
		return this;
	}

	isActive() {
		let parent = this.parent || this._dp,
			start = this._start,
			rawTime;
		return !!(!parent || (this._ts && this._initted && parent.isActive() && (rawTime = parent.rawTime(true)) >= start && rawTime < this.endTime(true) - _tinyNum));
	}

	eventCallback(type, callback, params) {
		let vars = this.vars;
		if (arguments.length > 1) {
			if (!callback) {
				delete vars[type];
			} else {
				vars[type] = callback;
				params && (vars[type + "Params"] = params);
				type === "onUpdate" && (this._onUpdate = callback);
			}
			return this;
		}
		return vars[type];
	}

	then(onFulfilled) {
		let self = this;
		return new Promise(resolve => {
			let f = _isFunction(onFulfilled) ? onFulfilled : _passThrough,
				_resolve = () => {
					let _then = self.then;
					self.then = null; // temporarily null the then() method to avoid an infinite loop (see https://github.com/greensock/GSAP/issues/322)
					_isFunction(f) && (f = f(self)) && (f.then || f === self) && (self.then = _then);
					resolve(f);
					self.then = _then;
				};
			if (self._initted && (self.totalProgress() === 1 && self._ts >= 0) || (!self._tTime && self._ts < 0)) {
				_resolve();
			} else {
				self._prom = _resolve;
			}
		});
	}

	kill() {
		_interrupt(this);
	}

}

_setDefaults(Animation.prototype, {_time:0, _start:0, _end:0, _tTime:0, _tDur:0, _dirty:0, _repeat:0, _yoyo:false, parent:null, _initted:false, _rDelay:0, _ts:1, _dp:0, ratio:0, _zTime:-_tinyNum, _prom:0, _ps:false, _rts:1});


















/*
 * -------------------------------------------------
 * TIMELINE
 * -------------------------------------------------
 */

class Timeline extends Animation {

	constructor(vars = {}, time) {
		super(vars, time);
		this.labels = {};
		this.smoothChildTiming = !!vars.smoothChildTiming;
		this.autoRemoveChildren = !!vars.autoRemoveChildren;
		this._sort = _isNotFalse(vars.sortChildren);
		this.parent && _postAddChecks(this.parent, this);
		vars.scrollTrigger && _scrollTrigger(this, vars.scrollTrigger);
	}

	to(targets, vars, position) {
		new Tween(targets, _parseVars(arguments, 0, this), _parsePosition(this, _isNumber(vars) ? arguments[3] : position));
		return this;
	}

	from(targets, vars, position) {
		new Tween(targets, _parseVars(arguments, 1, this), _parsePosition(this, _isNumber(vars) ? arguments[3] : position));
		return this;
	}

	fromTo(targets, fromVars, toVars, position) {
		new Tween(targets, _parseVars(arguments, 2, this), _parsePosition(this, _isNumber(fromVars) ? arguments[4] : position));
		return this;
	}

	set(targets, vars, position) {
		vars.duration = 0;
		vars.parent = this;
		_inheritDefaults(vars).repeatDelay || (vars.repeat = 0);
		vars.immediateRender = !!vars.immediateRender;
		new Tween(targets, vars, _parsePosition(this, position), 1);
		return this;
	}

	call(callback, params, position) {
		return _addToTimeline(this, Tween.delayedCall(0, callback, params), _parsePosition(this, position));
	}

	//ONLY for backward compatibility! Maybe delete?
	staggerTo(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams) {
		vars.duration = duration;
		vars.stagger = vars.stagger || stagger;
		vars.onComplete = onCompleteAll;
		vars.onCompleteParams = onCompleteAllParams;
		vars.parent = this;
		new Tween(targets, vars, _parsePosition(this, position));
		return this;
	}

	staggerFrom(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams) {
		vars.runBackwards = 1;
		_inheritDefaults(vars).immediateRender = _isNotFalse(vars.immediateRender);
		return this.staggerTo(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams);
	}

	staggerFromTo(targets, duration, fromVars, toVars, stagger, position, onCompleteAll, onCompleteAllParams) {
		toVars.startAt = fromVars;
		_inheritDefaults(toVars).immediateRender = _isNotFalse(toVars.immediateRender);
		return this.staggerTo(targets, duration, toVars, stagger, position, onCompleteAll, onCompleteAllParams);
	}

	render(totalTime, suppressEvents, force) {
		let prevTime = this._time,
			tDur = this._dirty ? this.totalDuration() : this._tDur,
			dur = this._dur,
			tTime = (this !== _globalTimeline && totalTime > tDur - _tinyNum && totalTime >= 0) ? tDur : (totalTime < _tinyNum) ? 0 : totalTime,
			crossingStart = (this._zTime < 0) !== (totalTime < 0) && (this._initted || !dur),
			time, child, next, iteration, cycleDuration, prevPaused, pauseTween, timeScale, prevStart, prevIteration, yoyo, isYoyo;
		if (tTime !== this._tTime || force || crossingStart) {
			if (prevTime !== this._time && dur) { //if totalDuration() finds a child with a negative startTime and smoothChildTiming is true, things get shifted around internally so we need to adjust the time accordingly. For example, if a tween starts at -30 we must shift EVERYTHING forward 30 seconds and move this timeline's startTime backward by 30 seconds so that things align with the playhead (no jump).
				tTime += this._time - prevTime;
				totalTime += this._time - prevTime;
			}
			time = tTime;
			prevStart = this._start;
			timeScale = this._ts;
			prevPaused = !timeScale;
			if (crossingStart) {
				dur || (prevTime = this._zTime);
				 //when the playhead arrives at EXACTLY time 0 (right on top) of a zero-duration timeline, we need to discern if events are suppressed so that when the playhead moves again (next time), it'll trigger the callback. If events are NOT suppressed, obviously the callback would be triggered in this render. Basically, the callback should fire either when the playhead ARRIVES or LEAVES this exact spot, not both. Imagine doing a timeline.seek(0) and there's a callback that sits at 0. Since events are suppressed on that seek() by default, nothing will fire, but when the playhead moves off of that position, the callback should fire. This behavior is what people intuitively expect.
				(totalTime || !suppressEvents) && (this._zTime = totalTime);
			}
			if (this._repeat) { //adjust the time for repeats and yoyos
				yoyo = this._yoyo;
				cycleDuration = dur + this._rDelay;
				if (this._repeat < -1 && totalTime < 0) {
					return this.totalTime(cycleDuration * 100 + totalTime, suppressEvents, force);
				}
				time = _round(tTime % cycleDuration); //round to avoid floating point errors. (4 % 0.8 should be 0 but some browsers report it as 0.79999999!)
				if (tTime === tDur) { // the tDur === tTime is for edge cases where there's a lengthy decimal on the duration and it may reach the very end but the time is rendered as not-quite-there (remember, tDur is rounded to 4 decimals whereas dur isn't)
					iteration = this._repeat;
					time = dur;
				} else {
					iteration = ~~(tTime / cycleDuration);
					if (iteration && iteration === tTime / cycleDuration) {
						time = dur;
						iteration--;
					}
					time > dur && (time = dur);
				}
				prevIteration = _animationCycle(this._tTime, cycleDuration);
				!prevTime && this._tTime && prevIteration !== iteration && (prevIteration = iteration); // edge case - if someone does addPause() at the very beginning of a repeating timeline, that pause is technically at the same spot as the end which causes this._time to get set to 0 when the totalTime would normally place the playhead at the end. See https://greensock.com/forums/topic/23823-closing-nav-animation-not-working-on-ie-and-iphone-6-maybe-other-older-browser/?tab=comments#comment-113005
				if (yoyo && (iteration & 1)) {
					time = dur - time;
					isYoyo = 1;
				}
				/*
				make sure children at the end/beginning of the timeline are rendered properly. If, for example,
				a 3-second long timeline rendered at 2.9 seconds previously, and now renders at 3.2 seconds (which
				would get translated to 2.8 seconds if the timeline yoyos or 0.2 seconds if it just repeats), there
				could be a callback or a short tween that's at 2.95 or 3 seconds in which wouldn't render. So
				we need to push the timeline to the end (and/or beginning depending on its yoyo value). Also we must
				ensure that zero-duration tweens at the very beginning or end of the Timeline work.
				*/
				if (iteration !== prevIteration && !this._lock) {
					let rewinding = (yoyo && (prevIteration & 1)),
						doesWrap = (rewinding === (yoyo && (iteration & 1)));
					iteration < prevIteration && (rewinding = !rewinding);
					prevTime = rewinding ? 0 : dur;
					this._lock = 1;
					this.render(prevTime || (isYoyo ? 0 : _round(iteration * cycleDuration)), suppressEvents, !dur)._lock = 0;
					!suppressEvents && this.parent && _callback(this, "onRepeat");
					this.vars.repeatRefresh && !isYoyo && (this.invalidate()._lock = 1);
					if ((prevTime && prevTime !== this._time) || prevPaused !== !this._ts || (this.vars.onRepeat && !this.parent && !this._act)) { // if prevTime is 0 and we render at the very end, _time will be the end, thus won't match. So in this edge case, prevTime won't match _time but that's okay. If it gets killed in the onRepeat, eject as well.
						return this;
					}
					dur = this._dur; // in case the duration changed in the onRepeat
					tDur = this._tDur;
					if (doesWrap) {
						this._lock = 2;
						prevTime = rewinding ? dur : -0.0001;
						this.render(prevTime, true);
					}
					this._lock = 0;
					if (!this._ts && !prevPaused) {
						return this;
					}
					//in order for yoyoEase to work properly when there's a stagger, we must swap out the ease in each sub-tween.
					_propagateYoyoEase(this, isYoyo);
				}
			}
			if (this._hasPause && !this._forcing && this._lock < 2) {
				pauseTween = _findNextPauseTween(this, _round(prevTime), _round(time));
				if (pauseTween) {
					tTime -= time - (time = pauseTween._start);
				}
			}

			this._tTime = tTime;
			this._time = time;
			this._act = !timeScale; //as long as it's not paused, force it to be active so that if the user renders independent of the parent timeline, it'll be forced to re-render on the next tick.

			if (!this._initted) {
				this._onUpdate = this.vars.onUpdate;
				this._initted = 1;
				this._zTime = totalTime;
				prevTime = 0; // upon init, the playhead should always go forward; someone could invalidate() a completed timeline and then if they restart(), that would make child tweens render in reverse order which could lock in the wrong starting values if they build on each other, like tl.to(obj, {x: 100}).to(obj, {x: 0}).
			}
			!prevTime && time && !suppressEvents && _callback(this, "onStart");
			if (time >= prevTime && totalTime >= 0) {
				child = this._first;
				while (child) {
					next = child._next;
					if ((child._act || time >= child._start) && child._ts && pauseTween !== child) {
						if (child.parent !== this) { // an extreme edge case - the child's render could do something like kill() the "next" one in the linked list, or reparent it. In that case we must re-initiate the whole render to be safe.
							return this.render(totalTime, suppressEvents, force);
						}
						child.render(child._ts > 0 ? (time - child._start) * child._ts : (child._dirty ? child.totalDuration() : child._tDur) + (time - child._start) * child._ts, suppressEvents, force);
						if (time !== this._time || (!this._ts && !prevPaused)) { //in case a tween pauses or seeks the timeline when rendering, like inside of an onUpdate/onComplete
							pauseTween = 0;
							next && (tTime += (this._zTime = -_tinyNum));  // it didn't finish rendering, so flag zTime as negative so that so that the next time render() is called it'll be forced (to render any remaining children)
							break;
						}
					}
					child = next;
				}
			} else {
				child = this._last;
				let adjustedTime = totalTime < 0 ? totalTime : time; //when the playhead goes backward beyond the start of this timeline, we must pass that information down to the child animations so that zero-duration tweens know whether to render their starting or ending values.
				while (child) {
					next = child._prev;
					if ((child._act || adjustedTime <= child._end) && child._ts && pauseTween !== child) {
						if (child.parent !== this) { // an extreme edge case - the child's render could do something like kill() the "next" one in the linked list, or reparent it. In that case we must re-initiate the whole render to be safe.
							return this.render(totalTime, suppressEvents, force);
						}
						child.render(child._ts > 0 ? (adjustedTime - child._start) * child._ts : (child._dirty ? child.totalDuration() : child._tDur) + (adjustedTime - child._start) * child._ts, suppressEvents, force);
						if (time !== this._time || (!this._ts && !prevPaused)) { //in case a tween pauses or seeks the timeline when rendering, like inside of an onUpdate/onComplete
							pauseTween = 0;
							next && (tTime += (this._zTime = adjustedTime ? -_tinyNum : _tinyNum)); // it didn't finish rendering, so adjust zTime so that so that the next time render() is called it'll be forced (to render any remaining children)
							break;
						}
					}
					child = next;
				}
			}
			if (pauseTween && !suppressEvents) {
				this.pause();
				pauseTween.render(time >= prevTime ? 0 : -_tinyNum)._zTime = time >= prevTime ? 1 : -1;
				if (this._ts) { //the callback resumed playback! So since we may have held back the playhead due to where the pause is positioned, go ahead and jump to where it's SUPPOSED to be (if no pause happened).
					this._start = prevStart; //if the pause was at an earlier time and the user resumed in the callback, it could reposition the timeline (changing its startTime), throwing things off slightly, so we make sure the _start doesn't shift.
					_setEnd(this);
					return this.render(totalTime, suppressEvents, force);
				}
			}
			this._onUpdate && !suppressEvents && _callback(this, "onUpdate", true);
			if ((tTime === tDur && tDur >= this.totalDuration()) || (!tTime && prevTime)) if (prevStart === this._start || Math.abs(timeScale) !== Math.abs(this._ts)) if (!this._lock) {
				(totalTime || !dur) && ((tTime === tDur && this._ts > 0) || (!tTime && this._ts < 0)) && _removeFromParent(this, 1); // don't remove if the timeline is reversed and the playhead isn't at 0, otherwise tl.progress(1).reverse() won't work. Only remove if the playhead is at the end and timeScale is positive, or if the playhead is at 0 and the timeScale is negative.
				if (!suppressEvents && !(totalTime < 0 && !prevTime) && (tTime || prevTime)) {
					_callback(this, (tTime === tDur ? "onComplete" : "onReverseComplete"), true);
					this._prom && !(tTime < tDur && this.timeScale() > 0) && this._prom();
				}
			}
		}
		return this;
	}

	add(child, position) {
		_isNumber(position) || (position = _parsePosition(this, position));
		if (!(child instanceof Animation)) {
			if (_isArray(child)) {
				child.forEach(obj => this.add(obj, position));
				return this;
			}
			if (_isString(child)) {
				return this.addLabel(child, position);
			}
			if (_isFunction(child)) {
				child = Tween.delayedCall(0, child);
			} else {
				return this;
			}
		}
		return this !== child ? _addToTimeline(this, child, position) : this; //don't allow a timeline to be added to itself as a child!
	}

	getChildren(nested = true, tweens = true, timelines = true, ignoreBeforeTime = -_bigNum) {
		let a = [],
			child = this._first;
		while (child) {
			if (child._start >= ignoreBeforeTime) {
				if (child instanceof Tween) {
					tweens && a.push(child);
				} else {
					timelines && a.push(child);
					nested && a.push(...child.getChildren(true, tweens, timelines));
				}
			}
			child = child._next;
		}
		return a;
	}

	getById(id) {
		let animations = this.getChildren(1, 1, 1),
			i = animations.length;
		while(i--) {
			if (animations[i].vars.id === id) {
				return animations[i];
			}
		}
	}

	remove(child) {
		if (_isString(child)) {
			return this.removeLabel(child);
		}
		if (_isFunction(child)) {
			return this.killTweensOf(child);
		}
		_removeLinkedListItem(this, child);
		if (child === this._recent) {
			this._recent = this._last;
		}
		return _uncache(this);
	}

	totalTime(totalTime, suppressEvents) {
		if (!arguments.length) {
			return this._tTime;
		}
		this._forcing = 1;
		if (!this._dp && this._ts) { //special case for the global timeline (or any other that has no parent or detached parent).
			this._start = _round(_ticker.time - (this._ts > 0 ? totalTime / this._ts : (this.totalDuration() - totalTime) / -this._ts));
		}
		super.totalTime(totalTime, suppressEvents);
		this._forcing = 0;
		return this;
	}

	addLabel(label, position) {
		this.labels[label] = _parsePosition(this, position);
		return this;
	}

	removeLabel(label) {
		delete this.labels[label];
		return this;
	}

	addPause(position, callback, params) {
		let t = Tween.delayedCall(0, callback || _emptyFunc, params);
		t.data = "isPause";
		this._hasPause = 1;
		return _addToTimeline(this, t, _parsePosition(this, position));
	}

	removePause(position) {
		let child = this._first;
		position = _parsePosition(this, position);
		while (child) {
			if (child._start === position && child.data === "isPause") {
				_removeFromParent(child);
			}
			child = child._next;
		}
	}

	killTweensOf(targets, props, onlyActive) {
		let tweens = this.getTweensOf(targets, onlyActive),
			i = tweens.length;
		while (i--) {
			(_overwritingTween !== tweens[i]) && tweens[i].kill(targets, props);
		}
		return this;
	}

	getTweensOf(targets, onlyActive) {
		let a = [],
			parsedTargets = toArray(targets),
			child = this._first,
			isGlobalTime = _isNumber(onlyActive), // a number is interpreted as a global time. If the animation spans
			children;
		while (child) {
			if (child instanceof Tween) {
				if (_arrayContainsAny(child._targets, parsedTargets) && (isGlobalTime ? (!_overwritingTween || (child._initted && child._ts)) && child.globalTime(0) <= onlyActive && child.globalTime(child.totalDuration()) > onlyActive : !onlyActive || child.isActive())) { // note: if this is for overwriting, it should only be for tweens that aren't paused and are initted.
					a.push(child);
				}
			} else if ((children = child.getTweensOf(parsedTargets, onlyActive)).length) {
				a.push(...children);
			}
			child = child._next;
		}
		return a;
	}

	// potential future feature - targets() on timelines
	// targets() {
	// 	let result = [];
	// 	this.getChildren(true, true, false).forEach(t => result.push(...t.targets()));
	// 	return result;
	// }

	tweenTo(position, vars) {
		vars = vars || {};
		let tl = this,
			endTime = _parsePosition(tl, position),
			{ startAt, onStart, onStartParams, immediateRender } = vars,
			tween = Tween.to(tl, _setDefaults({
				ease: vars.ease || "none",
				lazy: false,
				immediateRender: false,
				time: endTime,
				overwrite: "auto",
				duration: vars.duration || (Math.abs((endTime - ((startAt && "time" in startAt) ? startAt.time : tl._time)) / tl.timeScale())) || _tinyNum,
				onStart: () => {
					tl.pause();
					let duration = vars.duration || Math.abs((endTime - tl._time) / tl.timeScale());
					(tween._dur !== duration) && _setDuration(tween, duration, 0, 1).render(tween._time, true, true);
					onStart && onStart.apply(tween, onStartParams || []); //in case the user had an onStart in the vars - we don't want to overwrite it.
				}
			}, vars));
		return immediateRender ? tween.render(0) : tween;
	}

	tweenFromTo(fromPosition, toPosition, vars) {
		return this.tweenTo(toPosition, _setDefaults({startAt:{time:_parsePosition(this, fromPosition)}}, vars));
	}

	recent() {
		return this._recent;
	}

	nextLabel(afterTime = this._time) {
		return _getLabelInDirection(this, _parsePosition(this, afterTime));
	}

	previousLabel(beforeTime = this._time) {
		return _getLabelInDirection(this, _parsePosition(this, beforeTime), 1);
	}

	currentLabel(value) {
		return arguments.length ? this.seek(value, true) : this.previousLabel(this._time + _tinyNum);
	}

	shiftChildren(amount, adjustLabels, ignoreBeforeTime = 0) {
		let child = this._first,
			labels = this.labels,
			p;
		while (child) {
			if (child._start >= ignoreBeforeTime) {
				child._start += amount;
				child._end += amount;
			}
			child = child._next;
		}
		if (adjustLabels) {
			for (p in labels) {
				if (labels[p] >= ignoreBeforeTime) {
					labels[p] += amount;
				}
			}
		}
		return _uncache(this);
	}

	invalidate() {
		let child = this._first;
		this._lock = 0;
		while (child) {
			child.invalidate();
			child = child._next;
		}
		return super.invalidate();
	}

	clear(includeLabels = true) {
		let child = this._first,
			next;
		while (child) {
			next = child._next;
			this.remove(child);
			child = next;
		}
		this._dp && (this._time = this._tTime = this._pTime = 0);
		includeLabels && (this.labels = {});
		return _uncache(this);
	}

	totalDuration(value) {
		let max = 0,
			self = this,
			child = self._last,
			prevStart = _bigNum,
			prev, start, parent;
		if (arguments.length) {
			return self.timeScale((self._repeat < 0 ? self.duration() : self.totalDuration()) / (self.reversed() ? -value : value));
		}
		if (self._dirty) {
			parent = self.parent;
			while (child) {
				prev = child._prev; //record it here in case the tween changes position in the sequence...
				child._dirty && child.totalDuration(); //could change the tween._startTime, so make sure the animation's cache is clean before analyzing it.
				start = child._start;
				if (start > prevStart && self._sort && child._ts && !self._lock) { //in case one of the tweens shifted out of order, it needs to be re-inserted into the correct position in the sequence
					self._lock = 1; //prevent endless recursive calls - there are methods that get triggered that check duration/totalDuration when we add().
					_addToTimeline(self, child, start - child._delay, 1)._lock = 0;
				} else {
					prevStart = start;
				}
				if (start < 0 && child._ts) { //children aren't allowed to have negative startTimes unless smoothChildTiming is true, so adjust here if one is found.
					max -= start;
					if ((!parent && !self._dp) || (parent && parent.smoothChildTiming)) {
						self._start += start / self._ts;
						self._time -= start;
						self._tTime -= start;
					}
					self.shiftChildren(-start, false, -1e999);
					prevStart = 0;
				}
				child._end > max && child._ts && (max = child._end);
				child = prev;
			}
			_setDuration(self, (self === _globalTimeline && self._time > max) ? self._time : max, 1, 1);
			self._dirty = 0;
		}
		return self._tDur;
	}

	static updateRoot(time) {
		if (_globalTimeline._ts) {
			_lazySafeRender(_globalTimeline, _parentToChildTotalTime(time, _globalTimeline));
			_lastRenderedFrame = _ticker.frame;
		}
		if (_ticker.frame >= _nextGCFrame) {
			_nextGCFrame += _config.autoSleep || 120;
			let child = _globalTimeline._first;
			if (!child || !child._ts) if (_config.autoSleep && _ticker._listeners.length < 2) {
				while (child && !child._ts) {
					child = child._next;
				}
				child || _ticker.sleep();
			}
		}
	}

}

_setDefaults(Timeline.prototype, {_lock:0, _hasPause:0, _forcing:0});




















let _addComplexStringPropTween = function(target, prop, start, end, setter, stringFilter, funcParam) { //note: we call _addComplexStringPropTween.call(tweenInstance...) to ensure that it's scoped properly. We may call it from within a plugin too, thus "this" would refer to the plugin.
		let pt = new PropTween(this._pt, target, prop, 0, 1, _renderComplexString, null, setter),
			index = 0,
			matchIndex = 0,
			result,	startNums, color, endNum, chunk, startNum, hasRandom, a;
		pt.b = start;
		pt.e = end;
		start += ""; //ensure values are strings
		end += "";
		if ((hasRandom = ~end.indexOf("random("))) {
			end = _replaceRandom(end);
		}
		if (stringFilter) {
			a = [start, end];
			stringFilter(a, target, prop); //pass an array with the starting and ending values and let the filter do whatever it needs to the values.
			start = a[0];
			end = a[1];
		}
		startNums = start.match(_complexStringNumExp) || [];
		while ((result = _complexStringNumExp.exec(end))) {
			endNum = result[0];
			chunk = end.substring(index, result.index);
			if (color) {
				color = (color + 1) % 5;
			} else if (chunk.substr(-5) === "rgba(") {
				color = 1;
			}
			if (endNum !== startNums[matchIndex++]) {
				startNum = parseFloat(startNums[matchIndex-1]) || 0;
				//these nested PropTweens are handled in a special way - we'll never actually call a render or setter method on them. We'll just loop through them in the parent complex string PropTween's render method.
				pt._pt = {
					_next:pt._pt,
					p:(chunk || matchIndex === 1) ? chunk : ",", //note: SVG spec allows omission of comma/space when a negative sign is wedged between two numbers, like 2.5-5.3 instead of 2.5,-5.3 but when tweening, the negative value may switch to positive, so we insert the comma just in case.
					s:startNum,
					c:endNum.charAt(1) === "=" ? parseFloat(endNum.substr(2)) * (endNum.charAt(0) === "-" ? -1 : 1) : parseFloat(endNum) - startNum,
					m:(color && color < 4) ? Math.round : 0
				};
				index = _complexStringNumExp.lastIndex;
			}
		}
		pt.c = (index < end.length) ? end.substring(index, end.length) : ""; //we use the "c" of the PropTween to store the final part of the string (after the last number)
		pt.fp = funcParam;
		if (_relExp.test(end) || hasRandom) {
			pt.e = 0; //if the end string contains relative values or dynamic random(...) values, delete the end it so that on the final render we don't actually set it to the string with += or -= characters (forces it to use the calculated value).
		}
		this._pt = pt; //start the linked list with this new PropTween. Remember, we call _addComplexStringPropTween.call(tweenInstance...) to ensure that it's scoped properly. We may call it from within a plugin too, thus "this" would refer to the plugin.
		return pt;
	},
	_addPropTween = function(target, prop, start, end, index, targets, modifier, stringFilter, funcParam) {
		_isFunction(end) && (end = end(index || 0, target, targets));
		let currentValue = target[prop],
			parsedStart = (start !== "get") ? start : !_isFunction(currentValue) ? currentValue : (funcParam ? target[(prop.indexOf("set") || !_isFunction(target["get" + prop.substr(3)])) ? prop : "get" + prop.substr(3)](funcParam) : target[prop]()),
			setter = !_isFunction(currentValue) ? _setterPlain : funcParam ? _setterFuncWithParam : _setterFunc,
			pt;
		if (_isString(end)) {
			if (~end.indexOf("random(")) {
				end = _replaceRandom(end);
			}
			if (end.charAt(1) === "=") {
				end = parseFloat(parsedStart) + parseFloat(end.substr(2)) * (end.charAt(0) === "-" ? -1 : 1) + (getUnit(parsedStart) || 0);
			}
		}
		if (parsedStart !== end) {
			if (!isNaN(parsedStart * end)) {
				pt = new PropTween(this._pt, target, prop, +parsedStart || 0, end - (parsedStart || 0), typeof(currentValue) === "boolean" ? _renderBoolean : _renderPlain, 0, setter);
				funcParam && (pt.fp = funcParam);
				modifier && pt.modifier(modifier, this, target);
				return (this._pt = pt);
			}
			!currentValue && !(prop in target) && _missingPlugin(prop, end);
			return _addComplexStringPropTween.call(this, target, prop, parsedStart, end, setter, stringFilter || _config.stringFilter, funcParam);
		}
	},
	//creates a copy of the vars object and processes any function-based values (putting the resulting values directly into the copy) as well as strings with "random()" in them. It does NOT process relative values.
	_processVars = (vars, index, target, targets, tween) => {
		_isFunction(vars) && (vars = _parseFuncOrString(vars, tween, index, target, targets));
		if (!_isObject(vars) || (vars.style && vars.nodeType) || _isArray(vars) || _isTypedArray(vars)) {
			return _isString(vars) ? _parseFuncOrString(vars, tween, index, target, targets) : vars;
		}
		let copy = {},
			p;
		for (p in vars) {
			copy[p] = _parseFuncOrString(vars[p], tween, index, target, targets);
		}
		return copy;
	},
	_checkPlugin = (property, vars, tween, index, target, targets) => {
		let plugin, pt, ptLookup, i;
		if (_plugins[property] && (plugin = new _plugins[property]()).init(target, plugin.rawVars ? vars[property] : _processVars(vars[property], index, target, targets, tween), tween, index, targets) !== false) {
			tween._pt = pt = new PropTween(tween._pt, target, property, 0, 1, plugin.render, plugin, 0, plugin.priority);
			if (tween !== _quickTween) {
				ptLookup = tween._ptLookup[tween._targets.indexOf(target)]; //note: we can't use tween._ptLookup[index] because for staggered tweens, the index from the fullTargets array won't match what it is in each individual tween that spawns from the stagger.
				i = plugin._props.length;
				while (i--) {
					ptLookup[plugin._props[i]] = pt;
				}
			}
		}
		return plugin;
	},
	_overwritingTween, //store a reference temporarily so we can avoid overwriting itself.
	_initTween = (tween, time) => {
		let vars = tween.vars,
			{ ease, startAt, immediateRender, lazy, onUpdate, onUpdateParams, callbackScope, runBackwards, yoyoEase, keyframes, autoRevert } = vars,
			dur = tween._dur,
			prevStartAt = tween._startAt,
			targets = tween._targets,
			parent = tween.parent,
			//when a stagger (or function-based duration/delay) is on a Tween instance, we create a nested timeline which means that the "targets" of that tween don't reflect the parent. This function allows us to discern when it's a nested tween and in that case, return the full targets array so that function-based values get calculated properly.
			fullTargets = (parent && parent.data === "nested") ? parent.parent._targets : targets,
			autoOverwrite = (tween._overwrite === "auto") && !_suppressOverwrites,
			tl = tween.timeline,
			cleanVars, i, p, pt, target, hasPriority, gsData, harness, plugin, ptLookup, index, harnessVars, overwritten;
		tl && (!keyframes || !ease) && (ease = "none");
		tween._ease = _parseEase(ease, _defaults.ease);
		tween._yEase = yoyoEase ? _invertEase(_parseEase(yoyoEase === true ? ease : yoyoEase, _defaults.ease)) : 0;
		if (yoyoEase && tween._yoyo && !tween._repeat) { //there must have been a parent timeline with yoyo:true that is currently in its yoyo phase, so flip the eases.
			yoyoEase = tween._yEase;
			tween._yEase = tween._ease;
			tween._ease = yoyoEase;
		}
		if (!tl) { //if there's an internal timeline, skip all the parsing because we passed that task down the chain.
			harness = targets[0] ? _getCache(targets[0]).harness : 0;
			harnessVars = harness && vars[harness.prop]; //someone may need to specify CSS-specific values AND non-CSS values, like if the element has an "x" property plus it's a standard DOM element. We allow people to distinguish by wrapping plugin-specific stuff in a css:{} object for example.
			cleanVars = _copyExcluding(vars, _reservedProps);
			prevStartAt && prevStartAt.render(-1, true).kill();
			if (startAt) {
				_removeFromParent(tween._startAt = Tween.set(targets, _setDefaults({data: "isStart", overwrite: false, parent: parent, immediateRender: true, lazy: _isNotFalse(lazy), startAt: null, delay: 0, onUpdate: onUpdate, onUpdateParams: onUpdateParams, callbackScope: callbackScope, stagger: 0}, startAt))); //copy the properties/values into a new object to avoid collisions, like var to = {x:0}, from = {x:500}; timeline.fromTo(e, from, to).fromTo(e, to, from);
				if (immediateRender) {
					if (time > 0) {
						autoRevert || (tween._startAt = 0); //tweens that render immediately (like most from() and fromTo() tweens) shouldn't revert when their parent timeline's playhead goes backward past the startTime because the initial render could have happened anytime and it shouldn't be directly correlated to this tween's startTime. Imagine setting up a complex animation where the beginning states of various objects are rendered immediately but the tween doesn't happen for quite some time - if we revert to the starting values as soon as the playhead goes backward past the tween's startTime, it will throw things off visually. Reversion should only happen in Timeline instances where immediateRender was false or when autoRevert is explicitly set to true.
					} else if (dur && !(time < 0 && prevStartAt)) {
						time && (tween._zTime = time);
						return; //we skip initialization here so that overwriting doesn't occur until the tween actually begins. Otherwise, if you create several immediateRender:true tweens of the same target/properties to drop into a Timeline, the last one created would overwrite the first ones because they didn't get placed into the timeline yet before the first render occurs and kicks in overwriting.
					}
				} else if (autoRevert === false) {
					tween._startAt = 0;
				}
			} else if (runBackwards && dur) {
				//from() tweens must be handled uniquely: their beginning values must be rendered but we don't want overwriting to occur yet (when time is still 0). Wait until the tween actually begins before doing all the routines like overwriting. At that time, we should render at the END of the tween to ensure that things initialize correctly (remember, from() tweens go backwards)
				if (prevStartAt) {
					!autoRevert && (tween._startAt = 0);
				} else {
					time && (immediateRender = false); //in rare cases (like if a from() tween runs and then is invalidate()-ed), immediateRender could be true but the initial forced-render gets skipped, so there's no need to force the render in this context when the _time is greater than 0
					p = _setDefaults({
						overwrite: false,
						data: "isFromStart", //we tag the tween with as "isFromStart" so that if [inside a plugin] we need to only do something at the very END of a tween, we have a way of identifying this tween as merely the one that's setting the beginning values for a "from()" tween. For example, clearProps in CSSPlugin should only get applied at the very END of a tween and without this tag, from(...{height:100, clearProps:"height", delay:1}) would wipe the height at the beginning of the tween and after 1 second, it'd kick back in.
						lazy: immediateRender && _isNotFalse(lazy),
						immediateRender: immediateRender, //zero-duration tweens render immediately by default, but if we're not specifically instructed to render this tween immediately, we should skip this and merely _init() to record the starting values (rendering them immediately would push them to completion which is wasteful in that case - we'd have to render(-1) immediately after)
						stagger: 0,
						parent: parent //ensures that nested tweens that had a stagger are handled properly, like gsap.from(".class", {y:gsap.utils.wrap([-100,100])})
					}, cleanVars);
					harnessVars && (p[harness.prop] = harnessVars); // in case someone does something like .from(..., {css:{}})
					_removeFromParent(tween._startAt = Tween.set(targets, p));
					if (!immediateRender) {
						_initTween(tween._startAt, _tinyNum); //ensures that the initial values are recorded
					} else if (!time) {
						return;
					}
				}
			}
			tween._pt = 0;
			lazy = (dur && _isNotFalse(lazy)) || (lazy && !dur);
			for (i = 0; i < targets.length; i++) {
				target = targets[i];
				gsData = target._gsap || _harness(targets)[i]._gsap;
				tween._ptLookup[i] = ptLookup = {};
				_lazyLookup[gsData.id] && _lazyTweens.length && _lazyRender(); //if other tweens of the same target have recently initted but haven't rendered yet, we've got to force the render so that the starting values are correct (imagine populating a timeline with a bunch of sequential tweens and then jumping to the end)
				index = fullTargets === targets ? i : fullTargets.indexOf(target);
				if (harness && (plugin = new harness()).init(target, harnessVars || cleanVars, tween, index, fullTargets) !== false) {
					tween._pt = pt = new PropTween(tween._pt, target, plugin.name, 0, 1, plugin.render, plugin, 0, plugin.priority);
					plugin._props.forEach(name => {ptLookup[name] = pt;});
					plugin.priority && (hasPriority = 1);
				}
				if (!harness || harnessVars) {
					for (p in cleanVars) {
						if (_plugins[p] && (plugin = _checkPlugin(p, cleanVars, tween, index, target, fullTargets))) {
							plugin.priority && (hasPriority = 1);
						} else {
							ptLookup[p] = pt = _addPropTween.call(tween, target, p, "get", cleanVars[p], index, fullTargets, 0, vars.stringFilter);
						}
					}
				}
				tween._op && tween._op[i] && tween.kill(target, tween._op[i]);
				if (autoOverwrite && tween._pt) {
					_overwritingTween = tween;
					_globalTimeline.killTweensOf(target, ptLookup, tween.globalTime(0)); //Also make sure the overwriting doesn't overwrite THIS tween!!!
					overwritten = !tween.parent;
					_overwritingTween = 0;
				}
				tween._pt && lazy && (_lazyLookup[gsData.id] = 1);
			}
			hasPriority && _sortPropTweensByPriority(tween);
			tween._onInit && tween._onInit(tween); //plugins like RoundProps must wait until ALL of the PropTweens are instantiated. In the plugin's init() function, it sets the _onInit on the tween instance. May not be pretty/intuitive, but it's fast and keeps file size down.
		}
		tween._from = !tl && !!vars.runBackwards; //nested timelines should never run backwards - the backwards-ness is in the child tweens.
		tween._onUpdate = onUpdate;
		tween._initted = (!tween._op || tween._pt) && !overwritten; // if overwrittenProps resulted in the entire tween being killed, do NOT flag it as initted or else it may render for one tick.
	},
	_addAliasesToVars = (targets, vars) => {
		let harness = targets[0] ? _getCache(targets[0]).harness : 0,
			propertyAliases = (harness && harness.aliases),
			copy, p, i, aliases;
		if (!propertyAliases) {
			return vars;
		}
		copy = _merge({}, vars);
		for (p in propertyAliases) {
			if (p in copy) {
				aliases = propertyAliases[p].split(",");
				i = aliases.length;
				while(i--) {
					copy[aliases[i]] = copy[p];
				}
			}

		}
		return copy;
	},
	_parseFuncOrString = (value, tween, i, target, targets) => (_isFunction(value) ? value.call(tween, i, target, targets) : (_isString(value) && ~value.indexOf("random(")) ? _replaceRandom(value) : value),
	_staggerTweenProps = _callbackNames + "repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",
	_staggerPropsToSkip = (_staggerTweenProps + ",id,stagger,delay,duration,paused,scrollTrigger").split(",");























/*
 * --------------------------------------------------------------------------------------
 * TWEEN
 * --------------------------------------------------------------------------------------
 */

class Tween extends Animation {

	constructor(targets, vars, time, skipInherit) {
		if (typeof(vars) === "number") {
			time.duration = vars;
			vars = time;
			time = null;
		}
		super(skipInherit ? vars : _inheritDefaults(vars), time);
		let { duration, delay, immediateRender, stagger, overwrite, keyframes, defaults, scrollTrigger, yoyoEase } = this.vars,
			parent = this.parent,
			parsedTargets = (_isArray(targets) || _isTypedArray(targets) ? _isNumber(targets[0]) : ("length" in vars)) ? [targets] : toArray(targets), // edge case: someone might try animating the "length" of an object with a "length" property that's initially set to 0 so don't interpret that as an empty Array-like object.
			tl, i, copy, l, p, curTarget, staggerFunc, staggerVarsToMerge;
		this._targets = parsedTargets.length ? _harness(parsedTargets) : _warn("GSAP target " + targets + " not found. https://greensock.com", !_config.nullTargetWarn) || [];
		this._ptLookup = []; //PropTween lookup. An array containing an object for each target, having keys for each tweening property
		this._overwrite = overwrite;
		if (keyframes || stagger || _isFuncOrString(duration) || _isFuncOrString(delay)) {
			vars = this.vars;
			tl = this.timeline = new Timeline({data:"nested", defaults:defaults || {}});
			tl.kill();
			tl.parent = tl._dp = this;
			tl._start = 0;
			if (keyframes) {
				_setDefaults(tl.vars.defaults, {ease:"none"});
				keyframes.forEach(frame => tl.to(parsedTargets, frame, ">"));

			} else {
				l = parsedTargets.length;
				staggerFunc = stagger ? distribute(stagger) : _emptyFunc;
				if (_isObject(stagger)) { //users can pass in callbacks like onStart/onComplete in the stagger object. These should fire with each individual tween.
					for (p in stagger) {
						if (~_staggerTweenProps.indexOf(p)) {
							staggerVarsToMerge || (staggerVarsToMerge = {});
							staggerVarsToMerge[p] = stagger[p];
						}
					}
				}
				for (i = 0; i < l; i++) {
					copy = {};
					for (p in vars) {
						if (_staggerPropsToSkip.indexOf(p) < 0) {
							copy[p] = vars[p];
						}
					}
					copy.stagger = 0;
					yoyoEase && (copy.yoyoEase = yoyoEase);
					staggerVarsToMerge && _merge(copy, staggerVarsToMerge);
					curTarget = parsedTargets[i];
					//don't just copy duration or delay because if they're a string or function, we'd end up in an infinite loop because _isFuncOrString() would evaluate as true in the child tweens, entering this loop, etc. So we parse the value straight from vars and default to 0.
					copy.duration = +_parseFuncOrString(duration, this, i, curTarget, parsedTargets);
					copy.delay = (+_parseFuncOrString(delay, this, i, curTarget, parsedTargets) || 0) - this._delay;
					if (!stagger && l === 1 && copy.delay) { // if someone does delay:"random(1, 5)", repeat:-1, for example, the delay shouldn't be inside the repeat.
						this._delay = delay = copy.delay;
						this._start += delay;
						copy.delay = 0;
					}
					tl.to(curTarget, copy, staggerFunc(i, curTarget, parsedTargets));
				}
				tl.duration() ? (duration = delay = 0) : (this.timeline = 0); // if the timeline's duration is 0, we don't need a timeline internally!
			}
			duration || this.duration((duration = tl.duration()));

		} else {
			this.timeline = 0; //speed optimization, faster lookups (no going up the prototype chain)
		}

		if (overwrite === true && !_suppressOverwrites) {
			_overwritingTween = this;
			_globalTimeline.killTweensOf(parsedTargets);
			_overwritingTween = 0;
		}
		parent && _postAddChecks(parent, this);
		if (immediateRender || (!duration && !keyframes && this._start === _round(parent._time) && _isNotFalse(immediateRender) && _hasNoPausedAncestors(this) && parent.data !== "nested")) {
			this._tTime = -_tinyNum; //forces a render without having to set the render() "force" parameter to true because we want to allow lazying by default (using the "force" parameter always forces an immediate full render)
			this.render(Math.max(0, -delay)); //in case delay is negative
		}
		scrollTrigger && _scrollTrigger(this, scrollTrigger);
	}

	render(totalTime, suppressEvents, force) {
		let prevTime = this._time,
			tDur = this._tDur,
			dur = this._dur,
			tTime = (totalTime > tDur - _tinyNum && totalTime >= 0) ? tDur : (totalTime < _tinyNum) ? 0 : totalTime,
			time, pt, iteration, cycleDuration, prevIteration, isYoyo, ratio, timeline, yoyoEase;
		if (!dur) {
			_renderZeroDurationTween(this, totalTime, suppressEvents, force);
		} else if (tTime !== this._tTime || !totalTime || force || (!this._initted && this._tTime) || (this._startAt && (this._zTime < 0) !== (totalTime < 0))) { //this senses if we're crossing over the start time, in which case we must record _zTime and force the render, but we do it in this lengthy conditional way for performance reasons (usually we can skip the calculations): this._initted && (this._zTime < 0) !== (totalTime < 0)
			time = tTime;
			timeline = this.timeline;
			if (this._repeat) { //adjust the time for repeats and yoyos
				cycleDuration = dur + this._rDelay;
				if (this._repeat < -1 && totalTime < 0) {
					return this.totalTime(cycleDuration * 100 + totalTime, suppressEvents, force);
				}
				time = _round(tTime % cycleDuration); //round to avoid floating point errors. (4 % 0.8 should be 0 but some browsers report it as 0.79999999!)
				if (tTime === tDur) { // the tDur === tTime is for edge cases where there's a lengthy decimal on the duration and it may reach the very end but the time is rendered as not-quite-there (remember, tDur is rounded to 4 decimals whereas dur isn't)
					iteration = this._repeat;
					time = dur;
				} else {
					iteration = ~~(tTime / cycleDuration);
					if (iteration && iteration === tTime / cycleDuration) {
						time = dur;
						iteration--;
					}
					time > dur && (time = dur);
				}
				isYoyo = this._yoyo && (iteration & 1);
				if (isYoyo) {
					yoyoEase = this._yEase;
					time = dur - time;
				}
				prevIteration = _animationCycle(this._tTime, cycleDuration);
				if (time === prevTime && !force && this._initted) {
					//could be during the repeatDelay part. No need to render and fire callbacks.
					return this;
				}
				if (iteration !== prevIteration) {
					timeline && this._yEase && _propagateYoyoEase(timeline, isYoyo);
					//repeatRefresh functionality
					if (this.vars.repeatRefresh && !isYoyo && !this._lock) {
						this._lock = force = 1; //force, otherwise if lazy is true, the _attemptInitTween() will return and we'll jump out and get caught bouncing on each tick.
						this.render(_round(cycleDuration * iteration), true).invalidate()._lock = 0;
					}
				}
			}

			if (!this._initted) {
				if (_attemptInitTween(this, totalTime < 0 ? totalTime : time, force, suppressEvents)) {
					this._tTime = 0; // in constructor if immediateRender is true, we set _tTime to -_tinyNum to have the playhead cross the starting point but we can't leave _tTime as a negative number.
					return this;
				}
				if (dur !== this._dur) { // while initting, a plugin like InertiaPlugin might alter the duration, so rerun from the start to ensure everything renders as it should.
					return this.render(totalTime, suppressEvents, force);
				}
			}

			this._tTime = tTime;
			this._time = time;

			if (!this._act && this._ts) {
				this._act = 1; //as long as it's not paused, force it to be active so that if the user renders independent of the parent timeline, it'll be forced to re-render on the next tick.
				this._lazy = 0;
			}

			this.ratio = ratio = (yoyoEase || this._ease)(time / dur);
			if (this._from) {
				this.ratio = ratio = 1 - ratio;
			}

			time && !prevTime && !suppressEvents && _callback(this, "onStart");

			pt = this._pt;
			while (pt) {
				pt.r(ratio, pt.d);
				pt = pt._next;
			}

			(timeline && timeline.render(totalTime < 0 ? totalTime : !time && isYoyo ? -_tinyNum : timeline._dur * ratio, suppressEvents, force)) || (this._startAt && (this._zTime = totalTime));

			if (this._onUpdate && !suppressEvents) {
				totalTime < 0 && this._startAt && this._startAt.render(totalTime, true, force); //note: for performance reasons, we tuck this conditional logic inside less traveled areas (most tweens don't have an onUpdate). We'd just have it at the end before the onComplete, but the values should be updated before any onUpdate is called, so we ALSO put it here and then if it's not called, we do so later near the onComplete.
				_callback(this, "onUpdate");
			}

			this._repeat && iteration !== prevIteration && this.vars.onRepeat && !suppressEvents && this.parent && _callback(this, "onRepeat");

			if ((tTime === this._tDur || !tTime) && this._tTime === tTime) {
				totalTime < 0 && this._startAt && !this._onUpdate && this._startAt.render(totalTime, true, true);
				(totalTime || !dur) && ((tTime === this._tDur && this._ts > 0) || (!tTime && this._ts < 0)) && _removeFromParent(this, 1); // don't remove if we're rendering at exactly a time of 0, as there could be autoRevert values that should get set on the next tick (if the playhead goes backward beyond the startTime, negative totalTime). Don't remove if the timeline is reversed and the playhead isn't at 0, otherwise tl.progress(1).reverse() won't work. Only remove if the playhead is at the end and timeScale is positive, or if the playhead is at 0 and the timeScale is negative.
			    if (!suppressEvents && !(totalTime < 0 && !prevTime) && (tTime || prevTime)) { // if prevTime and tTime are zero, we shouldn't fire the onReverseComplete. This could happen if you gsap.to(... {paused:true}).play();
					_callback(this, (tTime === tDur ? "onComplete" : "onReverseComplete"), true);
					this._prom && !(tTime < tDur && this.timeScale() > 0) && this._prom();
				}
			}

		}
		return this;
	}

	targets() {
		return this._targets;
	}

	invalidate() {
		this._pt = this._op = this._startAt = this._onUpdate = this._lazy = this.ratio = 0;
		this._ptLookup = [];
		this.timeline && this.timeline.invalidate();
		return super.invalidate();
	}

	kill(targets, vars = "all") {
		if (!targets && (!vars || vars === "all")) {
			this._lazy = this._pt = 0;
			return this.parent ? _interrupt(this) : this;
		}
		if (this.timeline) {
			let tDur = this.timeline.totalDuration();
			this.timeline.killTweensOf(targets, vars, _overwritingTween && _overwritingTween.vars.overwrite !== true)._first || _interrupt(this); // if nothing is left tweening, interrupt.
			this.parent && tDur !== this.timeline.totalDuration() && _setDuration(this, this._dur * this.timeline._tDur / tDur, 0, 1); // if a nested tween is killed that changes the duration, it should affect this tween's duration. We must use the ratio, though, because sometimes the internal timeline is stretched like for keyframes where they don't all add up to whatever the parent tween's duration was set to.
			return this;
		}
		let parsedTargets = this._targets,
			killingTargets = targets ? toArray(targets) : parsedTargets,
			propTweenLookup = this._ptLookup,
			firstPT = this._pt,
			overwrittenProps, curLookup, curOverwriteProps, props, p, pt, i;
		if ((!vars || vars === "all") && _arraysMatch(parsedTargets, killingTargets)) {
			vars === "all" && (this._pt = 0);
			return _interrupt(this);
		}
		overwrittenProps = this._op = this._op || [];
		if (vars !== "all") { //so people can pass in a comma-delimited list of property names
			if (_isString(vars)) {
				p = {};
				_forEachName(vars, name => p[name] = 1);
				vars = p;
			}
			vars = _addAliasesToVars(parsedTargets, vars);
		}
		i = parsedTargets.length;
		while (i--) {
			if (~killingTargets.indexOf(parsedTargets[i])) {
				curLookup = propTweenLookup[i];
				if (vars === "all") {
					overwrittenProps[i] = vars;
					props = curLookup;
					curOverwriteProps = {};
				} else {
					curOverwriteProps = overwrittenProps[i] = overwrittenProps[i] || {};
					props = vars;
				}
				for (p in props) {
					pt = curLookup && curLookup[p];
					if (pt) {
						if (!("kill" in pt.d) || pt.d.kill(p) === true) {
							_removeLinkedListItem(this, pt, "_pt");
						}
						delete curLookup[p];
					}
					if (curOverwriteProps !== "all") {
						curOverwriteProps[p] = 1;
					}
				}
			}
		}
		this._initted && !this._pt && firstPT && _interrupt(this); //if all tweening properties are killed, kill the tween. Without this line, if there's a tween with multiple targets and then you killTweensOf() each target individually, the tween would technically still remain active and fire its onComplete even though there aren't any more properties tweening.
		return this;
	}


	static to(targets, vars) {
		return new Tween(targets, vars, arguments[2]);
	}

	static from(targets, vars) {
		return new Tween(targets, _parseVars(arguments, 1));
	}

	static delayedCall(delay, callback, params, scope) {
		return new Tween(callback, 0, {immediateRender:false, lazy:false, overwrite:false, delay:delay, onComplete:callback, onReverseComplete:callback, onCompleteParams:params, onReverseCompleteParams:params, callbackScope:scope});
	}

	static fromTo(targets, fromVars, toVars) {
		return new Tween(targets, _parseVars(arguments, 2));
	}

	static set(targets, vars) {
		vars.duration = 0;
		vars.repeatDelay || (vars.repeat = 0);
		return new Tween(targets, vars);
	}

	static killTweensOf(targets, props, onlyActive) {
		return _globalTimeline.killTweensOf(targets, props, onlyActive);
	}
}

_setDefaults(Tween.prototype, {_targets:[], _lazy:0, _startAt:0, _op:0, _onInit:0});

//add the pertinent timeline methods to Tween instances so that users can chain conveniently and create a timeline automatically. (removed due to concerns that it'd ultimately add to more confusion especially for beginners)
// _forEachName("to,from,fromTo,set,call,add,addLabel,addPause", name => {
// 	Tween.prototype[name] = function() {
// 		let tl = new Timeline();
// 		return _addToTimeline(tl, this)[name].apply(tl, toArray(arguments));
// 	}
// });

//for backward compatibility. Leverage the timeline calls.
_forEachName("staggerTo,staggerFrom,staggerFromTo", name => {
	Tween[name] = function() {
		let tl = new Timeline(),
			params = _slice.call(arguments, 0);
		params.splice(name === "staggerFromTo" ? 5 : 4, 0, 0);
		return tl[name].apply(tl, params);
	}
});
















/*
 * --------------------------------------------------------------------------------------
 * PROPTWEEN
 * --------------------------------------------------------------------------------------
 */
let _setterPlain = (target, property, value) => target[property] = value,
	_setterFunc = (target, property, value) => target[property](value),
	_setterFuncWithParam = (target, property, value, data) => target[property](data.fp, value),
	_setterAttribute = (target, property, value) => target.setAttribute(property, value),
	_getSetter = (target, property) => _isFunction(target[property]) ? _setterFunc : _isUndefined(target[property]) && target.setAttribute ? _setterAttribute : _setterPlain,
	_renderPlain = (ratio, data) => data.set(data.t, data.p, Math.round((data.s + data.c * ratio) * 10000) / 10000, data),
	_renderBoolean = (ratio, data) => data.set(data.t, data.p, !!(data.s + data.c * ratio), data),
	_renderComplexString = function(ratio, data) {
		let pt = data._pt,
			s = "";
		if (!ratio && data.b) { //b = beginning string
			s = data.b;
		} else if (ratio === 1 && data.e) { //e = ending string
			s = data.e;
		} else {
			while (pt) {
				s = pt.p + (pt.m ? pt.m(pt.s + pt.c * ratio) : (Math.round((pt.s + pt.c * ratio) * 10000) / 10000)) + s; //we use the "p" property for the text inbetween (like a suffix). And in the context of a complex string, the modifier (m) is typically just Math.round(), like for RGB colors.
				pt = pt._next;
			}
			s += data.c; //we use the "c" of the PropTween to store the final chunk of non-numeric text.
		}
		data.set(data.t, data.p, s, data);
	},
	_renderPropTweens = function(ratio, data) {
		let pt = data._pt;
		while (pt) {
			pt.r(ratio, pt.d);
			pt = pt._next;
		}
	},
	_addPluginModifier = function(modifier, tween, target, property) {
		let pt = this._pt,
			next;
		while (pt) {
			next = pt._next;
			pt.p === property && pt.modifier(modifier, tween, target);
			pt = next;
		}
	},
	_killPropTweensOf = function(property) {
		let pt = this._pt,
			hasNonDependentRemaining, next;
		while (pt) {
			next = pt._next;
			if ((pt.p === property && !pt.op) || pt.op === property) {
				_removeLinkedListItem(this, pt, "_pt");
			} else if (!pt.dep) {
				hasNonDependentRemaining = 1;
			}
			pt = next;
		}
		return !hasNonDependentRemaining;
	},
	_setterWithModifier = (target, property, value, data) => {
		data.mSet(target, property, data.m.call(data.tween, value, data.mt), data);
	},
	_sortPropTweensByPriority = parent => {
		let pt = parent._pt,
			next, pt2, first, last;
		//sorts the PropTween linked list in order of priority because some plugins need to do their work after ALL of the PropTweens were created (like RoundPropsPlugin and ModifiersPlugin)
		while (pt) {
			next = pt._next;
			pt2 = first;
			while (pt2 && pt2.pr > pt.pr) {
				pt2 = pt2._next;
			}
			if ((pt._prev = pt2 ? pt2._prev : last)) {
				pt._prev._next = pt;
			} else {
				first = pt;
			}
			if ((pt._next = pt2)) {
				pt2._prev = pt;
			} else {
				last = pt;
			}
			pt = next;
		}
		parent._pt = first;
	};

//PropTween key: t = target, p = prop, r = renderer, d = data, s = start, c = change, op = overwriteProperty (ONLY populated when it's different than p), pr = priority, _next/_prev for the linked list siblings, set = setter, m = modifier, mSet = modifierSetter (the original setter, before a modifier was added)
class PropTween {

	constructor(next, target, prop, start, change, renderer, data, setter, priority) {
		this.t = target;
		this.s = start;
		this.c = change;
		this.p = prop;
		this.r = renderer || _renderPlain;
		this.d = data || this;
		this.set = setter || _setterPlain;
		this.pr = priority || 0;
		this._next = next;
		if (next) {
			next._prev = this;
		}
	}

	modifier(func, tween, target) {
		this.mSet = this.mSet || this.set; //in case it was already set (a PropTween can only have one modifier)
		this.set = _setterWithModifier;
		this.m = func;
		this.mt = target; //modifier target
		this.tween = tween;
	}
}



//Initialization tasks
_forEachName(_callbackNames + "parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger", name => _reservedProps[name] = 1);
_globals.TweenMax = _globals.TweenLite = Tween;
_globals.TimelineLite = _globals.TimelineMax = Timeline;
_globalTimeline = new Timeline({sortChildren: false, defaults: _defaults, autoRemoveChildren: true, id:"root", smoothChildTiming: true});
_config.stringFilter = _colorStringFilter;

















/*
 * --------------------------------------------------------------------------------------
 * GSAP
 * --------------------------------------------------------------------------------------
 */
const _gsap = {
	registerPlugin(...args) {
		args.forEach(config => _createPlugin(config));
	},
	timeline(vars) {
		return new Timeline(vars);
	},
	getTweensOf(targets, onlyActive) {
		return _globalTimeline.getTweensOf(targets, onlyActive);
	},
	getProperty(target, property, unit, uncache) {
		_isString(target) && (target = toArray(target)[0]); //in case selector text or an array is passed in
		let getter = _getCache(target || {}).get,
			format = unit ? _passThrough : _numericIfPossible;
		unit === "native" && (unit = "");
		return !target ? target : !property ? (property, unit, uncache) => format(((_plugins[property] && _plugins[property].get) || getter)(target, property, unit, uncache)) : format(((_plugins[property] && _plugins[property].get) || getter)(target, property, unit, uncache));
	},
	quickSetter(target, property, unit) {
		target = toArray(target);
		if (target.length > 1) {
			let setters = target.map(t => gsap.quickSetter(t, property, unit)),
				l = setters.length;
			return value => {
				let i = l;
				while(i--) {
					setters[i](value);
				}
			}
		}
		target = target[0] || {};
		let Plugin = _plugins[property],
			cache = _getCache(target),
			p = (cache.harness && (cache.harness.aliases || {})[property]) || property, // in case it's an alias, like "rotate" for "rotation".
			setter = Plugin ? value => {
				let p = new Plugin();
				_quickTween._pt = 0;
				p.init(target, unit ? value + unit : value, _quickTween, 0, [target]);
				p.render(1, p);
				_quickTween._pt && _renderPropTweens(1, _quickTween);
			} : cache.set(target, p);
		return Plugin ? setter : value => setter(target, p, unit ? value + unit : value, cache, 1);
	},
	isTweening(targets) {
		return _globalTimeline.getTweensOf(targets, true).length > 0;
	},
	defaults(value) {
		value && value.ease && (value.ease = _parseEase(value.ease, _defaults.ease));
		return _mergeDeep(_defaults, value || {});
	},
	config(value) {
		return _mergeDeep(_config, value || {});
	},
	registerEffect({name, effect, plugins, defaults, extendTimeline}) {
		(plugins || "").split(",").forEach(pluginName => pluginName && !_plugins[pluginName] && !_globals[pluginName] && _warn(name + " effect requires " + pluginName + " plugin."));
		_effects[name] = (targets, vars, tl) => effect(toArray(targets), _setDefaults(vars || {}, defaults), tl);
		if (extendTimeline) {
			Timeline.prototype[name] = function(targets, vars, position) {
				return this.add(_effects[name](targets, _isObject(vars) ? vars : (position = vars) && {}, this), position);
			};
		}
	},
	registerEase(name, ease) {
		_easeMap[name] = _parseEase(ease);
	},
	parseEase(ease, defaultEase) {
		return arguments.length ? _parseEase(ease, defaultEase) : _easeMap;
	},
	getById(id) {
		return _globalTimeline.getById(id);
	},
	exportRoot(vars = {}, includeDelayedCalls) {
		let tl = new Timeline(vars),
			child, next;
		tl.smoothChildTiming = _isNotFalse(vars.smoothChildTiming);
		_globalTimeline.remove(tl);
		tl._dp = 0; //otherwise it'll get re-activated when adding children and be re-introduced into _globalTimeline's linked list (then added to itself).
		tl._time = tl._tTime = _globalTimeline._time;
		child = _globalTimeline._first;
		while (child) {
			next = child._next;
			if (includeDelayedCalls || !(!child._dur && child instanceof Tween && child.vars.onComplete === child._targets[0])) {
				_addToTimeline(tl, child, child._start - child._delay);
			}
			child = next;
		}
		_addToTimeline(_globalTimeline, tl, 0);
		return tl;
	},
	utils: { wrap, wrapYoyo, distribute, random, snap, normalize, getUnit, clamp, splitColor, toArray, mapRange, pipe, unitize, interpolate, shuffle },
	install: _install,
	effects: _effects,
	ticker: _ticker,
	updateRoot: Timeline.updateRoot,
	plugins: _plugins,
	globalTimeline: _globalTimeline,
	core: {PropTween, globals: _addGlobal, Tween, Timeline, Animation, getCache: _getCache, _removeLinkedListItem, suppressOverwrites: value => _suppressOverwrites = value}
};

_forEachName("to,from,fromTo,delayedCall,set,killTweensOf", name => _gsap[name] = Tween[name]);
_ticker.add(Timeline.updateRoot);
_quickTween = _gsap.to({}, {duration:0});




// ---- EXTRA PLUGINS --------------------------------------------------------


let _getPluginPropTween = (plugin, prop) => {
		let pt = plugin._pt;
		while (pt && pt.p !== prop && pt.op !== prop && pt.fp !== prop) {
			pt = pt._next;
		}
		return pt;
	},
	_addModifiers = (tween, modifiers) => {
			let	targets = tween._targets,
				p, i, pt;
			for (p in modifiers) {
				i = targets.length;
				while (i--) {
					pt = tween._ptLookup[i][p];
					if (pt && (pt = pt.d)) {
						if (pt._pt) { // is a plugin
							pt = _getPluginPropTween(pt, p);
						}
						pt && pt.modifier && pt.modifier(modifiers[p], tween, targets[i], p);
					}
				}
			}
	},
	_buildModifierPlugin = (name, modifier) => {
		return {
			name: name,
			rawVars: 1, //don't pre-process function-based values or "random()" strings.
			init(target, vars, tween) {
				tween._onInit = tween => {
					let temp, p;
					if (_isString(vars)) {
						temp = {};
						_forEachName(vars, name => temp[name] = 1); //if the user passes in a comma-delimited list of property names to roundProps, like "x,y", we round to whole numbers.
						vars = temp;
					}
					if (modifier) {
						temp = {};
						for (p in vars) {
							temp[p] = modifier(vars[p]);
						}
						vars = temp;
					}
					_addModifiers(tween, vars);
				};
			}
		};
	};

//register core plugins
const gsap = _gsap.registerPlugin({
		name:"attr",
		init(target, vars, tween, index, targets) {
			let p, pt;
			for (p in vars) {
				pt = this.add(target, "setAttribute", (target.getAttribute(p) || 0) + "", vars[p], index, targets, 0, 0, p);
				pt && (pt.op = p);
				this._props.push(p);
			}
		}
	}, {
		name:"endArray",
		init(target, value) {
			let i = value.length;
			while (i--) {
				this.add(target, i, target[i] || 0, value[i]);
			}
		}
	},
	_buildModifierPlugin("roundProps", _roundModifier),
	_buildModifierPlugin("modifiers"),
	_buildModifierPlugin("snap", snap)
) || _gsap; //to prevent the core plugins from being dropped via aggressive tree shaking, we must include them in the variable declaration in this way.

Tween.version = Timeline.version = gsap.version = "3.6.1";
_coreReady = 1;
if (_windowExists()) {
	_wake();
}

const { Power0, Power1, Power2, Power3, Power4, Linear, Quad, Cubic, Quart, Quint, Strong, Elastic, Back, SteppedEase, Bounce, Sine, Expo, Circ } = _easeMap;

//export some internal methods/orojects for use in CSSPlugin so that we can externalize that file and allow custom builds that exclude it.


/***/ }),

/***/ "./node_modules/gsap/src/index.js":
/*!****************************************!*\
  !*** ./node_modules/gsap/src/index.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Back: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Back),
/* harmony export */   Bounce: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Bounce),
/* harmony export */   CSSPlugin: () => (/* reexport safe */ _CSSPlugin_js__WEBPACK_IMPORTED_MODULE_1__.CSSPlugin),
/* harmony export */   Circ: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Circ),
/* harmony export */   Cubic: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Cubic),
/* harmony export */   Elastic: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Elastic),
/* harmony export */   Expo: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Expo),
/* harmony export */   Linear: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Linear),
/* harmony export */   Power0: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Power0),
/* harmony export */   Power1: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Power1),
/* harmony export */   Power2: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Power2),
/* harmony export */   Power3: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Power3),
/* harmony export */   Power4: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Power4),
/* harmony export */   Quad: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Quad),
/* harmony export */   Quart: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Quart),
/* harmony export */   Quint: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Quint),
/* harmony export */   Sine: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Sine),
/* harmony export */   SteppedEase: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.SteppedEase),
/* harmony export */   Strong: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.Strong),
/* harmony export */   TimelineLite: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.TimelineLite),
/* harmony export */   TimelineMax: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.TimelineMax),
/* harmony export */   TweenLite: () => (/* reexport safe */ _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.TweenLite),
/* harmony export */   TweenMax: () => (/* binding */ TweenMaxWithCSS),
/* harmony export */   "default": () => (/* binding */ gsapWithCSS),
/* harmony export */   gsap: () => (/* binding */ gsapWithCSS)
/* harmony export */ });
/* harmony import */ var _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./gsap-core.js */ "./node_modules/gsap/src/gsap-core.js");
/* harmony import */ var _CSSPlugin_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./CSSPlugin.js */ "./node_modules/gsap/src/CSSPlugin.js");



const gsapWithCSS = _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.gsap.registerPlugin(_CSSPlugin_js__WEBPACK_IMPORTED_MODULE_1__.CSSPlugin) || _gsap_core_js__WEBPACK_IMPORTED_MODULE_0__.gsap, // to protect from tree shaking
	TweenMaxWithCSS = gsapWithCSS.core.Tween;



/***/ }),

/***/ "./node_modules/gsap/src/utils/strings.js":
/*!************************************************!*\
  !*** ./node_modules/gsap/src/utils/strings.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   emojiExp: () => (/* binding */ emojiExp),
/* harmony export */   emojiSafeSplit: () => (/* binding */ emojiSafeSplit),
/* harmony export */   getText: () => (/* binding */ getText),
/* harmony export */   splitInnerHTML: () => (/* binding */ splitInnerHTML)
/* harmony export */ });
/*!
 * strings: 3.6.1
 * https://greensock.com
 *
 * Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/* eslint-disable */

let _trimExp = /(^\s+|\s+$)/g;

const emojiExp = /([\uD800-\uDBFF][\uDC00-\uDFFF](?:[\u200D\uFE0F][\uD800-\uDBFF][\uDC00-\uDFFF]){2,}|\uD83D\uDC69(?:\u200D(?:(?:\uD83D\uDC69\u200D)?\uD83D\uDC67|(?:\uD83D\uDC69\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC6F\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3C-\uDD3E\uDDD6-\uDDDF])\u200D[\u2640\u2642]\uFE0F|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])\uFE0F|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC69\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708]))\uFE0F|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83D\uDC69\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69]))|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]))|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D(?:(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F)/;

function getText(e) {
	let type = e.nodeType,
		result = "";
	if (type === 1 || type === 9 || type === 11) {
		if (typeof(e.textContent) === "string") {
			return e.textContent;
		} else {
			for (e = e.firstChild; e; e = e.nextSibling ) {
				result += getText(e);
			}
		}
	} else if (type === 3 || type === 4) {
		return e.nodeValue;
	}
	return result;
}

function splitInnerHTML(element, delimiter, trim) {
	let node = element.firstChild,
		result = [];
	while (node) {
		if (node.nodeType === 3) {
			result.push(...emojiSafeSplit((node.nodeValue + "").replace(/^\n+/g, "").replace(/\s+/g, " "), delimiter, trim));
		} else if ((node.nodeName + "").toLowerCase() === "br") {
			result[result.length-1] += "<br>";
		} else {
			result.push(node.outerHTML);
		}
		node = node.nextSibling;
	}
	return result;
}

/*
//smaller kb version that only handles the simpler emoji's, which is often perfectly adequate.

let _emoji = "[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2694-\u2697]|\uD83E[\uDD10-\uDD5D]|[\uD800-\uDBFF][\uDC00-\uDFFF]",
	_emojiExp = new RegExp(_emoji),
	_emojiAndCharsExp = new RegExp(_emoji + "|.", "g"),
	_emojiSafeSplit = (text, delimiter, trim) => {
		if (trim) {
			text = text.replace(_trimExp, "");
		}
		return ((delimiter === "" || !delimiter) && _emojiExp.test(text)) ? text.match(_emojiAndCharsExp) : text.split(delimiter || "");
	};
 */
function emojiSafeSplit(text, delimiter, trim) {
	text += ""; // make sure it's cast as a string. Someone may pass in a number.
	if (trim) {
		text = text.replace(_trimExp, "");
	}
	if (delimiter && delimiter !== "") {
		return text.replace(/>/g, "&gt;").replace(/</g, "&lt;").split(delimiter);
	}
	let result = [],
		l = text.length,
		i = 0,
		j, character;
	for (; i < l; i++) {
		character = text.charAt(i);
		if ((character.charCodeAt(0) >= 0xD800 && character.charCodeAt(0) <= 0xDBFF) || (text.charCodeAt(i+1) >= 0xFE00 && text.charCodeAt(i+1) <= 0xFE0F)) { //special emoji characters use 2 or 4 unicode characters that we must keep together.
			j = ((text.substr(i, 12).split(emojiExp) || [])[1] || "").length || 2;
			character = text.substr(i, j);
			result.emoji = 1;
			i += j - 1;
		}
		result.push(character === ">" ? "&gt;" : (character === "<") ? "&lt;" : character);
	}
	return result;
}

/***/ }),

/***/ "../scripts/DefaultResource.js":
/*!*************************************!*\
  !*** ../scripts/DefaultResource.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
const data = {
    "data": {
        "list": [
            {
                "res_id": "Cone",
                "res_name": "Cone",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Cone/Cone.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Cone/Cone.png",
                "default_shader_name": "",
                "size": "30096",
                "create_date": "",
                "show": true
            },
            {
                "res_id": "Cylinder",
                "res_name": "Cylinder",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Cylinder/Cylinder.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Cylinder/Cylinder.png",
                "default_shader_name": "",
                "size": "28416",
                "create_date": "",
                "show": true
            },
            {
                "res_id": "Circle",
                "res_name": "Circle",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Circle/Circle.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Circle/Circle.png",
                "default_shader_name": "",
                "size": "41392",
                "create_date": "",
                "show": true
            },
            {
                "res_id": "Rectangle",
                "res_name": "Rectangle",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Rectangle/Rectangle.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Rectangle/Rectangle.png",
                "default_shader_name": "",
                "size": "23584",
                "create_date": "",
                "show": true
            },
            {
                "res_id": "Torus",
                "res_name": "Torus",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Torus/Torus.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Torus/Torus.png",
                "default_shader_name": "",
                "size": "34192",
                "create_date": "",
                "show": true
            },
            {
                "res_id": "Square",
                "res_name": "Square",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Square/Square.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Square/Square.png",
                "default_shader_name": "",
                "size": "23568",
                "create_date": "",
                "show": true
            },
            {
                "res_id": "Triangle",
                "res_name": "Triangle",
                "main_type": "model",
                "sub_type": "glb",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Triangle/Triangle.glb",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/3D/Triangle/Triangle.png",
                "default_shader_name": "",
                "size": "22816",
                "create_date": "",
                "show": true
            },
            {
                "res_name": "Cube",
                "sub_type": "glb",
                "show": false,
                "res_id": "Cube",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Cube.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/Cube.png",
                "create_date": "",
                "main_type": "model",
                "size": "2772 bytes"
            },
            {
                "res_name": "Capsule",
                "sub_type": "glb",
                "show": false,
                "res_id": "Capsule",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Capsule.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/Capsule.png",
                "create_date": "",
                "main_type": "model",
                "size": "37380 bytes"
            },
            {
                "res_name": "Sphere",
                "sub_type": "glb",
                "show": false,
                "res_id": "Sphere",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Sphere.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/Sphere.png",
                "create_date": "",
                "main_type": "model",
                "size": "35016 bytes"
            },
            {
                "res_id": "img_fb_1",
                "sub_type": "png",
                "show": true,
                "res_name": "FB icon",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_fb_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_fb_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "133759 bytes"
            },
            {
                "res_id": "img_ig_1",
                "sub_type": "png",
                "show": true,
                "res_name": "IG icon",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_ig_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_ig_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "194879 bytes"
            },
            {
                "res_id": "img_line_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Line icon",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_line_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_line_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "163576 bytes"
            },
            {
                "res_id": "img_web_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Web icon_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_web_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_web_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "112540 bytes"
            },
            {
                "res_id": "img_map_1",
                "sub_type": "png",
                "show": true,
                "res_name": "GPS icon_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_map_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_map_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "99764 bytes"
            },
            {
                "res_id": "img_phone_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Phone icon_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_phone_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_phone_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "75327 bytes"
            },
            {
                "res_id": "img_mail_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Mail icon_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_mail_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_mail_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "113394 bytes"
            },
            {
                "res_id": "img_home_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Home icon_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_home_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_home_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "103003 bytes"
            },
            {
                "res_id": "img_arrow_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Arrow icon_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_arrow_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_arrow_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "80170 bytes"
            },
            {
                "res_id": "img_button_back_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Back button_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_back_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_back_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "91617 bytes"
            },
            {
                "res_id": "img_button_next_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Next button_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_next_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_next_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "89832 bytes"
            },
            {
                "res_id": "img_button_play_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Play button_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_play_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_play_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "89261 bytes"
            },
            {
                "res_id": "img_button_start_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Start button_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_start_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_start_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "92002 bytes"
            },
            {
                "res_id": "img_dialog_1",
                "sub_type": "png",
                "show": true,
                "res_name": "Msg bubble_Teal",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_dialog_1.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_dialog_1.png",
                "create_date": "",
                "main_type": "image",
                "size": "147377 bytes"
            },
            {
                "res_id": "img_web_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Web icon_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_web_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_web_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "17544 bytes"
            },
            {
                "res_id": "img_map_2",
                "sub_type": "png",
                "show": true,
                "res_name": "GPS icon_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_map_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_map_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "17371 bytes"
            },
            {
                "res_id": "img_phone_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Phone icon_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_phone_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_phone_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "11311 bytes"
            },
            {
                "res_id": "img_mail_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Mail icon_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_mail_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_mail_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "10518 bytes"
            },
            {
                "res_id": "img_home_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Home icon_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_home_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_home_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "13172 bytes"
            },
            {
                "res_id": "img_arrow_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Arrow icon_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_arrow_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_arrow_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "8860 bytes"
            },
            {
                "res_id": "img_button_back_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Back button_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_back_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_back_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "7059 bytes"
            },
            {
                "res_id": "img_button_next_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Next button_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_next_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_next_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "5536 bytes"
            },
            {
                "res_id": "img_button_play_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Play button_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_play_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_play_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "5919 bytes"
            },
            {
                "res_id": "img_button_start_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Start button_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_start_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_button_start_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "7060 bytes"
            },
            {
                "res_id": "img_dialog_2",
                "sub_type": "png",
                "show": true,
                "res_name": "Msg bubble_Gray",
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_dialog_2.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/defaultImg/img_dialog_2.png",
                "create_date": "",
                "main_type": "image",
                "size": "3788 bytes"
            },
            {
                "res_name": "Text",
                "sub_type": "txt",
                "show": false,
                "res_id": "Text",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Text.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/Text.png",
                "create_date": "",
                "main_type": "text",
                "size": "2772 bytes"
            },
            {
                "res_name": "Light",
                "sub_type": "light",
                "show": false,
                "res_id": "Light",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Light.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/Light.png",
                "create_date": "",
                "main_type": "light",
                "size": "0 bytes"
            },
            {
                "res_name": "Curve",
                "sub_type": "curve",
                "show": false,
                "res_id": "Curve",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/Light.glb",
                "default_shader_name": "",
                "snapshot_url": "",
                "create_date": "",
                "main_type": "curve",
                "size": "0 bytes"
            },
            {
                "res_name": "ch_Bojue",
                "sub_type": "glb",
                "show": false,
                "res_id": "ch_Bojue",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/ch_Bojue.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/ch_Bojue.png",
                "create_date": "",
                "main_type": "model",
                "size": "360240 bytes"
            },
            {
                "res_name": "ch_Fei",
                "sub_type": "glb",
                "show": false,
                "res_id": "ch_Fei",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/ch_Fei.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/ch_Fei.png",
                "create_date": "",
                "main_type": "model",
                "size": "348876 bytes"
            },
            {
                "res_name": "ch_Lina",
                "sub_type": "glb",
                "show": false,
                "res_id": "ch_Lina",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/ch_Lina.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/ch_Lina.png",
                "create_date": "",
                "main_type": "model",
                "size": "384992 bytes"
            },
            {
                "res_name": "ch_Poyuan",
                "sub_type": "glb",
                "show": false,
                "res_id": "ch_Poyuan",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/ch_Poyuan.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/ch_Poyuan.png",
                "create_date": "",
                "main_type": "model",
                "size": "369416 bytes"
            },
            {
                "res_name": "ch_Roger",
                "sub_type": "glb",
                "show": false,
                "res_id": "ch_Roger",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/3D/sceneDefaultModels/ch_Roger.glb",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/modelSnapshots/ch_Roger.png",
                "create_date": "",
                "main_type": "model",
                "size": "371072 bytes"
            },
            {
                "res_name": "FB_icon",
                "sub_type": "png",
                "show": false,
                "res_id": "FB_icon",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/FB_icon.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/FB_icon.png",
                "create_date": "",
                "main_type": "image",
                "size": "4235 bytes"
            },
            {
                "res_name": "Line_icon",
                "sub_type": "png",
                "show": false,
                "res_id": "Line_icon",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/Line_icon.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/Line_icon.png",
                "create_date": "",
                "main_type": "image",
                "size": "8855 bytes"
            },
            {
                "res_name": "MakAR_Room",
                "sub_type": "png",
                "show": false,
                "res_id": "MakAR_Room",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/MakAR_Room.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/MakAR_Room.png",
                "create_date": "",
                "main_type": "image",
                "size": "22787 bytes"
            },
            {
                "res_name": "MakAR_Call",
                "sub_type": "png",
                "show": false,
                "res_id": "MakAR_Call",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/MakAR_Call.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/MakAR_Call.png",
                "create_date": "",
                "main_type": "image",
                "size": "22432 bytes"
            },
            {
                "res_name": "MakAR_Mail",
                "sub_type": "png",
                "show": false,
                "res_id": "MakAR_Mail",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/MakAR_Mail.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/MakAR_Mail.png",
                "create_date": "",
                "main_type": "image",
                "size": "21586 bytes"
            },
            {
                "res_name": "SphericalImage",
                "sub_type": "png",
                "show": false,
                "res_id": "SphericalImage",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/snapshots/imageSnapshots/SphericalImage.png",
                "create_date": "",
                "main_type": "spherical_image",
                "size": "4258816 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_name": "InputField",
                "sub_type": "inputfield",
                "show": false,
                "res_id": "InputField",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/inputField/inputfield.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/inputField/inputfield.png",
                "create_date": "",
                "main_type": "inputfield",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_name": "Button",
                "sub_type": "button",
                "show": false,
                "res_id": "Button",
                // "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button.png",
                "res_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png",
                "default_shader_name": "",
                // "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button.png",
                "snapshot_url": "https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/button_withText.png",
                "create_date": "",
                "main_type": "button",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "PointCard_Background",
                "res_name": "PointCard_Background",
                "main_type": "image",
                "sub_type": "png",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/pointCard/PointCard_Background.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/pointCard/PointCard_Background.png",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "PointCard_Point_Before",
                "res_name": "PointCard_Point_Before",
                "main_type": "image",
                "sub_type": "png",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/pointCard/PointCard_DefaultPoint_Before.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/pointCard/PointCard_DefaultPoint_Before.png",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "PointCard_Point_After",
                "res_name": "PointCard_Point_After",
                "main_type": "image",
                "sub_type": "png",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/pointCard/PointCard_DefaultPoint_After.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/pointCard/PointCard_DefaultPoint_After.png",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "camera",
                "res_name": "Camera",
                "main_type": "camera",
                "sub_type": "camera",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/Camera/Camera.glb",
                "default_shader_name": "",
                "snapshot_url": "",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "ScratchCard_Background",
                "res_name": "ScratchCard_Background",
                "main_type": "image",
                "sub_type": "png",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/scratchCard/ScratchCardBackground.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/scratchCard/ScratchCardBackground.png",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "ScratchCard_Default",
                "res_name": "ScratchCard_Default",
                "main_type": "image",
                "sub_type": "png",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/scratchCard/ScratchCard_Default.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/scratchCard/ScratchCard_Default.png",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "AcratchCard_Default",
                "res_name": "AcratchCard_Default",
                "main_type": "image",
                "sub_type": "png",
                "show": false,
                "res_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/scratchCard/AcratchCard_Default.png",
                "default_shader_name": "",
                "snapshot_url": "https://mifly0makar0assets.s3.ap-northeast-1.amazonaws.com/DefaultResource/2D/modules/scratchCard/AcratchCard_Default.png",
                "create_date": "",
                "size": "0 bytes"
            },
            {
                "comment": "這是一個特殊物件，該物件不展示給使用者使用，但工廠會使用到",
                "res_id": "Curve_Cell",
                "res_name": "Cell",
                "main_type": "curve_cell",
                "sub_type": "curve_cell",
                "show": false,
                "res_url": "",
                "default_shader_name": "",
                "snapshot_url": "",
                "create_date": "",
                "size": "0 bytes"
            }
        ]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (data);

/***/ }),

/***/ "../scripts/MakarEvents.js":
/*!*********************************!*\
  !*** ../scripts/MakarEvents.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
//// an extension to deal with makar events
//// 為了讓event在sdk上能更直接的處理 但又不想在 vrController增加東西


//// 問:  Dialing, email, url, display2D, videoTogglePlayPause 的對應方式
class MakarEvents{

    //// 預先考慮了使用 mix專案 的情況
    currentController;

    //// 指定一個 html element 讓他發布事件 之後就監聽它
    eventDispatchTarget;

    constructor(currentController, eventDispatchTarget){
        this.currentController = currentController;
        this.eventDispatchTarget = eventDispatchTarget;
    }

    //// 發布事件
    //// 參數: originalEventData   : 來自editor記錄的behav
    ////       eventDispatchTarget : html Element
    dispatchEvent( originalEventData, eventDispatchTarget=this.eventDispatchTarget ){
        let event = this.genenrateCustomEvent(originalEventData)
        eventDispatchTarget.dispatchEvent(event)
    }

    genenrateCustomEvent( originalEventData ){
        // console.log("originalEventData", originalEventData)

        //// 原本editor傳過來的data, general的部分
        let customEvent = new CustomEvent("MakarEvent", {
            detail: {
                behavType: originalEventData.behav_type,
                sourceID: originalEventData.trigger_obj_id,
                delay: originalEventData.delay,
                triggerType: originalEventData.trigger_type,
                typeAttr: {},
                _originalData: originalEventData,
            },
        });

        //// typeAttr: 把不general的分隔出來
        //// 為了避免混淆, 都改為駝峰式大小寫     注意"底線分隔"or"駝峰式大小寫" (由於editor歷經多次改版 命名方式不一定相同)
        const _typeAttrDict = {
            "URL": {
                "url": originalEventData.url,
                "background": originalEventData.background,
            },
            "Dialing": {
                "phone": originalEventData.phone,
            },
            "Email": {
                "body": originalEventData.body,
                "mailTo": originalEventData.mail_to,
                "subject": originalEventData.subject,
            },
            "Animation": {
                "uid": originalEventData.uid,
                "loop": originalEventData.loop,
                "reset": originalEventData.reset,
                "towardID": originalEventData.obj_id,
            },
            "TTS": {
                "pitch": originalEventData.pitch,
                "speed": originalEventData.speed,
                "language": originalEventData.language,
                "towardID": originalEventData.obj_id,
            },
            "Scenes": {
                "sceneID": originalEventData.scene_id,
                "previousID": originalEventData.previousID
            },
            "Skybox": {
                "skyboxID": originalEventData.skybox_id,
                "previousID": originalEventData.previousID
            },
            "Display": {
                "group": originalEventData.group,
                "towardID": originalEventData.obj_id,
                "switchType": originalEventData.switch_type,
                "reset": originalEventData.reset,
            },
            "Facing": {
                "isFront": originalEventData.is_front,
                "towarID": originalEventData.toward_id,
            },
        }

        // customEvent.detail.typeAttr = _typeAttr
        customEvent.detail.typeAttr = _typeAttrDict[originalEventData.behav_type] 
        return customEvent
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MakarEvents);

/***/ }),

/***/ "../scripts/mIndexedDB.js":
/*!********************************!*\
  !*** ../scripts/mIndexedDB.js ***!
  \********************************/
/***/ (() => {

"use strict";


class mIndexedDB {
  constructor() {
    if (!window.indexedDB) {
      window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");
    };

    
    let makarWebViewerDBVersion =    1   ; // must be integer
    // this.db ;
    const dBOpenRequest = window.indexedDB.open('makarWebViewerDB',  makarWebViewerDBVersion );

    // console.log(' _______ mdb open _________ ', dBOpenRequest );

    dBOpenRequest.addEventListener('upgradeneeded', event => {
      this.db  = event.target.result;
      console.log(`Upgrading to version ${this.db .version}`);
      
      //// 建構紀錄當下使用者瀏覽過哪個專案的表單 目前預計只先紀錄 帶有模組(括括卡、集點卡)的專案
      if (!this.db.objectStoreNames.contains("loadedProject")){
        // Create an objectStore for this database
        var objectStore = this.db.createObjectStore('loadedProject', { 
          keyPath: 'proj_id' , 
          // autoIncrement: true, 
        });
        // define what data items the objectStore will contain
        objectStore.createIndex('create_date', 'create_date', { unique: false });
        objectStore.createIndex('last_update_date', 'last_update_date', { unique: false });
        objectStore.createIndex('user_id', 'user_id', { unique: false });
        objectStore.createIndex('proj_name', 'proj_name', { unique: false });
        objectStore.createIndex('proj_type', 'proj_type', { unique: false });
        objectStore.createIndex('proj_platform', 'proj_platform', { unique: false });
        objectStore.createIndex('module_type', 'module_type', { unique: false });
        objectStore.createIndex('editor_ver', 'editor_ver', { unique: false });

      }

      //// 2022 1024 此表單暫時無用
      if (!this.db.objectStoreNames.contains("searchInfo")){
        // Create an objectStore for this database
        var searchInfoOS = this.db.createObjectStore('searchInfo', { 
          keyPath: 'keyword' , 
        });
        // define what data items the searchInfoOS will contain
        searchInfoOS.createIndex('user_id', 'user_id', { unique: false });
        searchInfoOS.createIndex('proj_name', 'proj_name', { unique: false });
      }
      
      //// 2022 1024 此表單暫時無用
      //// 建構紀錄當下使用者的登入資訊
      if (!this.db.objectStoreNames.contains("user")){
        // Create an objectStore for this database
        var userOS = this.db.createObjectStore('user', { 
          keyPath: 'user_id' ,  
        });
        // define what data items the objectStore will contain
        userOS.createIndex('loginDate', 'loginDate', { unique: false });

      }

      //// 2022 1024 此表單新增
      //// 建構紀錄「拍照圖片」
      if (!this.db.objectStoreNames.contains("snapImageBase")){
        // Create an objectStore for this database
        var snapImageBaseOS = this.db.createObjectStore('snapImageBase', { 
          keyPath: 'device_id' ,  
        });
        // snapImageBaseOS.createIndex('loginDate', 'loginDate', { unique: false });
      }

      console.log("___________ upgradeneeded ______________ ", this.db   );
    });

    dBOpenRequest.onsuccess = (event) => {

      // let db = event.target.result;
      // console.log(' _______ mdb sucess 2_________ ', db );

      // if ( db && db.objectStoreNames && !db.objectStoreNames.contains("snapImageBase")){
      //   // Create an objectStore for this database
      //   var snapImageBaseOS = db.createObjectStore('snapImageBase', { 
      //     keyPath: 'device_id' ,  
      //   });
        
      // }


    }

    //// 假如判斷為「已經有較新版本，則無條件關閉」
    dBOpenRequest.onerror = (event) => {
      console.log(' _______ mdb error 2_________ ', event );

      if ( event.target.error  ){
        if ( event.target.error.name == "VersionError" ){
          window.indexedDB.deleteDatabase( 'makarWebViewerDB' );
          window.mdb = new mIndexedDB();
        }
      }

    }


    dBOpenRequest.addEventListener('success', event => {
      //// test //// 
      this.db = event.target.result;

      // console.log(' _______ mdb sucess _________ ');

      // for ( let i = 0; i < 10; i++){
      //   let testProj = {
      //     proj_id: "pp123_" + i,
      //     type: "world",
      //     proj_name:  Math.floor(Math.random() * 10 ) ,
      //   };
      //   let objectStore = this.db.transaction("loadedProject", "readwrite").objectStore("loadedProject").put( testProj ) ;     
      // }
      // console.log("indexedDB.js: dBOpenRequest success  ", this.db , objectStore   );

      // console.log("indexedDB.js: dBOpenRequest success  ", this.db );

    });
  };

  //// 未完成 暫時不使用
  async setSearchKeyword ( keyword , callback ){
    if ( !this.db ) {
      console.error("indexedDB.js: _addProject: db null return ", this.db );  
      return;
    }
    
    //// event control
    let transaction = this.db.transaction("searchInfo", "readwrite");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _setSearchKeyword: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _setSearchKeyword: transaction error, event= ", event );  
    };

    let searchInfoOS = transaction.objectStore("searchInfo");
    let addRequest =  searchInfoOS.add( projInfo ) ;
    addRequest.onsuccess = function(event){
      // console.log("indexedDB.js: _setSearchKeyword: addRequest success, event= ", event );
      // event.target.result will be the KeyPath ;
      if (callback){
        callback(event);
      }
    };
    addRequest.onerror = function(event){
      console.error("indexedDB.js: _setSearchKeyword: addRequest error, event= ", event );    
    };
    
    return await addRequest;
  }


  ////// customized function for makar 
  ////// Fei 測試 get 的 return await request 並不會等 onsuccess 之後再回傳 基本上還是要用 callback來處理，MDN上的範例也是如此 
  ////// 括括卡模組 相關

  async initProject( projInfo ){

    let self = this;
    return new Promise(function(resolve, reject) {
      
      if ( !self.db ) {
        console.error("indexedDB.js: _initProject: db null return ", self.db );  
        return;
      }
      if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
        console.error("indexedDB.js: _initProject: proj_id null return ", projInfo );  
        return;
      }
      
      self.getProject(projInfo.proj_id, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          // console.log("indexedDB.js: _initProject: _get: already have the project with same proj_id ", getEvent.target.result );
          resolve(getEvent.target.result);
        }else{
          // console.log("indexedDB.js: _initProject: _get no proj exist, add one, getEvent= ", getEvent.target.readyState , getEvent.target, projInfo );    
          projInfo.scratchCardState = 0; //// [ 0:init , 1:getAward , 2:scratched , 3:exchanged  ]
          projInfo.getAwardIndex = -1;
          self.addProject(projInfo);
          resolve(projInfo);
        }
      });

    });
    // return await getRequest;
  }


  //// 查找「存放照片」，基本上目前會先「固定key」方式進行，因為不需要「多組圖片」的功能
  async getSnapshopData ( device_id ){
    let self = this;

    let pGet = new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _saveSnapshop: db null return ", self.db );  
        resolve( -1 );
        return;
      }

      device_id = '20221024_snap';

      if ( device_id == undefined || device_id == '' ){
        resolve( -1 );
        return;
      }

      let transaction = self.db.transaction("snapImageBase", "readonly");
      
       //// event control
      transaction.oncomplete = function(event) {
        // console.log("indexedDB.js: _getSnapshopData: transaction complete, event= ", event );    
      };
      transaction.onerror = function(event) {
        console.error("indexedDB.js: _getSnapshopData: transaction error, event= ", event );  
      };

      let snapOS = transaction.objectStore("snapImageBase");
      let getRequest =  snapOS.get( device_id ) ;
      getRequest.onsuccess = function(event){
        console.log("indexedDB.js: _getSnapshopData: getRequest success, event= ", event, event.target.readyState, event.target.result, device_id );    
        // event.target.result will be the object ;
        resolve( event.target.result );
      };
      getRequest.onerror = function(event){
        console.error("indexedDB.js: _getSnapshopData: getRequest error, event= ", event );    
      };

    });

    return pGet;

  }

  //// 儲存「照片」，基本上目前會先「固定key」方式進行，因為不需要「多組圖片」的功能
  async saveSnapshop ( imageData = {} ){
    let self = this;
    let pSave = new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _saveSnapshop: db null return ", self.db );  
        resolve( -1 );
        return;
      }
      
      imageData.device_id = '20221024_snap';
      
      if ( !imageData || imageData.device_id == undefined ){
        resolve( -1 );
        return;
      }

      let transaction = self.db.transaction("snapImageBase", "readwrite");
      let snapOS = transaction.objectStore("snapImageBase");
      let addRequest =  snapOS.put( imageData ) ;
      addRequest.onsuccess = function(event){
        // event.target.result will be the KeyPath ;
        console.log(' _saveSnapshop: success ', event );
        resolve( event );

      };
      addRequest.onerror = function(event){
        console.error("indexedDB.js: _saveSnapshop: addRequest error, event= ", event );    
        resolve( -1 );
      };

    });

    return pSave;
  }

  async clearSnapShot(){

    let self = this;
    let pSave = new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _clearSnapShot: db null return ", self.db );  
        resolve( -1 );
        return;
      }
      

      let transaction = self.db.transaction("snapImageBase", "readwrite");
      let snapOS = transaction.objectStore("snapImageBase");
      let addRequest =  snapOS.clear();
      addRequest.onsuccess = function(event){
        // event.target.result will be the KeyPath ;
        console.log(' _clearSnapShot: success ', event );
        resolve( event );

      };
      addRequest.onerror = function(event){
        console.error("indexedDB.js: _clearSnapShot: addRequest error, event= ", event );    
        resolve( -1 );
      };

    });

    return pSave;

  }


  async getScratchProject ( proj_id ){

    let self = this;
    return new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _getScratchProjectAward: db null return ", self.db );  
        return;
      }
      if ( !proj_id || proj_id == "" ) {
        console.error("indexedDB.js: _getScratchProjectAward: proj_id null return ", proj_id );  
        return;
      }
      
      self.getProject(proj_id, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          console.log("indexedDB.js: _getScratchProjectAward: _get: already have the project with same proj_id ", getEvent.target.result , getEvent.target.result.getAwardIndex );
          //// if first time, return -1, 
          resolve( getEvent.target.result );
          
        }else{
          console.log("indexedDB.js: _getScratchProjectAward: _get no proj exist getEvent= ", getEvent.target.readyState , getEvent.target ); 
          resolve( {} );
        }
      });

    });
    // return await getRequest;
  }

  async setScratchProject ( projInfo ){

    let self = this;
    return new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _setScratchProject: db null return ", self.db );  
        return;
      }
      if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
        console.error("indexedDB.js: _setScratchProject: proj_id null return ", projInfo );  
        return;
      }
      
      self.putProject(projInfo, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          console.log("indexedDB.js: _setScratchProject: put: getEvent.target.result= ", getEvent.target.result );    
          // resolve(getEvent.target.result);
        }else{

        }
      });

    });
    // return await getRequest;
  }

  async setScratchProjectStateFromProjID ( proj_id , scratchCardState ){

    let self = this;
    return new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _setScratchProjectStateFromProjID: db null return ", self.db );  
        return;
      }
      if ( !proj_id || proj_id == "" ) {
        console.error("indexedDB.js: _setScratchProjectStateFromProjID: proj_id null return ", proj_id );  
        return;
      }
      if (!scratchCardState || !Number.isInteger(scratchCardState) || scratchCardState < 1 ){
        console.error("indexedDB.js: _setScratchProjectStateFromProjID: scratchCardState null return ", scratchCardState );  
        return;
      }
      console.log("indexedDB.js: _setScratchProjectStateFromProjID: put: start, [proj_id , scratchCardState]= ", scratchCardState , proj_id );

      self.getProject(proj_id , function(getEvent){

        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          let projInfo = getEvent.target.result;
          projInfo.scratchCardState = scratchCardState;
          self.putProject(projInfo, function(putEvent){
            if (putEvent.target.readyState == "done" && putEvent.target.result ){
              console.log("indexedDB.js: _setScratchProjectStateFromProjID: put: getEvent.target.result= ", putEvent.target.result );
              resolve(projInfo);
            }else{
              // console.log("indexedDB.js: _initProject: _get callback getEvent= ", getEvent.target.readyState , getEvent.target );    
              resolve(projInfo);
            }
          });
          
        }else{
          console.log("indexedDB.js: _getScratchProjectAward: _get no proj exist getEvent= ", getEvent.target.readyState , getEvent.target );    
          // resolve(projInfo);
        }
      });

    });
    // return await getRequest;
  }

  ////// 集點卡模組相關
  async initPointCardProject( projInfo ){

    let self = this;
    return new Promise(function(resolve, reject) {
      
      if ( !self.db ) {
        console.error("indexedDB.js: _initPointCardProject: db null return ", self.db );  
        return;
      }
      if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
        console.error("indexedDB.js: _initPointCardProject: proj_id null return ", projInfo );  
        return;
      }
      
      self.getProject(projInfo.proj_id, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          // console.log("indexedDB.js: _initPointCardProject: _get: already have the project with same proj_id ", getEvent.target.result );
          resolve(getEvent.target.result);
        }else{
          // console.log("indexedDB.js: _initPointCardProject: _get no proj exist, add one, getEvent= ", getEvent.target.readyState , getEvent.target, projInfo );    
          // projInfo.scratchCardState = 0; //// [ 0:init , 1:getAward , 2:scratched , 3:exchanged  ]
          // projInfo.getAwardIndex = -1;
          self.addProject(projInfo);
          resolve(projInfo);
        }
      });

    });
    // return await getRequest;
  }

  async getPointCardProject ( proj_id ){

    let self = this;
    return new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _getPointCardProject: db null return ", self.db );  
        return;
      }
      if ( !proj_id || proj_id == "" ) {
        console.error("indexedDB.js: _getPointCardProject: proj_id null return ", proj_id );  
        return;
      }
      
      self.getProject(proj_id, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          console.log("indexedDB.js: _getPointCardProject: _get: already have the project with same proj_id ", getEvent.target.result , getEvent.target.result.getAwardIndex );
          //// if first time, return -1, 
          resolve( getEvent.target.result );
          
        }else{
          console.log("indexedDB.js: _getPointCardProject: _get no proj exist getEvent= ", getEvent.target.readyState , getEvent.target );    
          resolve( {} );
          
        }
      });

    });
    // return await getRequest;
  }

  async setPointCardProject ( projInfo ){

    let self = this;
    return new Promise(function(resolve, reject) {
      if ( !self.db ) {
        console.error("indexedDB.js: _setPointCardProject: db null return ", self.db );  
        return;
      }
      if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
        console.error("indexedDB.js: _setPointCardProject: proj_id null return ", projInfo );  
        return;
      }
      
      self.putProject(projInfo, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          console.log("indexedDB.js: _setPointCardProject: put: getEvent.target.result= ", getEvent );    
          resolve(getEvent.target.result);
        }else{

        }
      });

    });
    

  }

  ////// 集點卡結束


  //[start-20231114-renhaohsu-add]//
  //// 問答模組相關
  //// 仿照 getPointCardProject ，多增加判斷 專案類型是否為"quiz"
  async getQuizProject ( proj_id ){
    return new Promise( (resolve, reject) => {      
      if ( !this.db ) {
        reject({ status: "rejected", message: "indexedDB.js: _getQuizProject: db null return ", db: this.db })
        return;
      }
      if ( !proj_id || proj_id == "" ) {
        reject({ status: "rejected", message: "indexedDB.js: _getQuizProject: proj_id null return ", proj_id: proj_id })
        return;
      }

      this.getProject(proj_id, function(getEvent){
        if ( getEvent.target.readyState == "done" && getEvent.target.result ){
          // if(getEvent.target.result.type == "quiz"){
            // console.log("indexedDB.js: _getQuizProject: _get: already have the project with same proj_id ", getEvent.target.result );
            resolve( getEvent.target.result );            
          // } else {
          //   console.log("indexedDB.js: _getQuizProject: _get: the project's module is not quiz", getEvent.target.result );
          //   reject('not quiz proj')
          // }
          
        }else{
          console.log("indexedDB.js: _getQuizProject: _get no proj exist getEvent= ", getEvent.target.readyState , getEvent.target );    
          resolve( {} );          
        }
      });
    })
  }

  async putQuizProject ( projInfo ){

    return new Promise( (resolve, reject) => {
      if ( !this.db ) {
        console.error("indexedDB.js: putQuizProject: db null return ", this.db );  
        return;
      }
      if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
        console.error("indexedDB.js: putQuizProject: proj_id null return ", projInfo );  
        return;
      }
      
      this.putProject(projInfo, function(getEvent){
        if (getEvent.target.readyState == "done" && getEvent.target.result ){
          console.log("indexedDB.js: putQuizProject: put: getEvent.target.result= ", getEvent );    
          resolve(getEvent.target.result);
        }else{
          //// does that means putProject failed?
          console.warn("indexedDB.js: putQuizProject: put: ", getEvent)
        }
      });
    });    

  }
  //// Quiz 結束 
	//[end-20231114-renhaohsu-add]//


  ////// general function [ add , delete, get, put, getByCursor, getByKeyCursor ]

  async addProject( projInfo , callback ){
    if ( !this.db ) {
      console.error("indexedDB.js: _addProject: db null return ", this.db );  
      return;
    }
    if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
      console.error("indexedDB.js: _addProject: proj_id null return ", proj_id );  
      return;
    }
    
    //// event control
    let transaction = this.db.transaction("loadedProject", "readwrite");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _addProject: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _addProject: transaction error, event= ", event );  
    };

    let projOS = transaction.objectStore("loadedProject");
    let addRequest =  projOS.add( projInfo ) ;
    addRequest.onsuccess = function(event){
      // console.log("indexedDB.js: _addProject: addRequest success, event= ", event );
      // event.target.result will be the KeyPath ;
      if (callback){
        callback(event);
      }
    };
    addRequest.onerror = function(event){
      console.error("indexedDB.js: _addProject: addRequest error, event= ", event );    
    };
    
    return await addRequest;
  }

  async deleteProject( proj_id , callback){
    if ( !this.db ) {
      console.error("indexedDB.js: _deleteProject: db null return ", this.db );  
      return;
    }
    if ( !proj_id || proj_id == "" ) {
      console.error("indexedDB.js: _deleteProject: proj_id null return ", proj_id );  
      return;
    }
    
    //// event control
    let transaction = this.db.transaction("loadedProject", "readwrite");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _deleteProject: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _deleteProject: transaction error, event= ", event );  
    };

    let projOS = transaction.objectStore("loadedProject");
    let deleteRequest =  projOS.delete( proj_id ) ;
    deleteRequest.onsuccess = function(event){
      // console.log("indexedDB.js: _deleteProject: deleteRequest success, event= ", event );    
      // event.target.result will be the KeyPath ;
      if (callback){
        callback(event);
      }
    };
    deleteRequest.onerror = function(event){
      console.error("indexedDB.js: _deleteProject: deleteRequest error, event= ", event );    
    };
    
    return await deleteRequest;
  }


  async putProject( projInfo , callback){
    if ( !this.db ) {
      console.error("indexedDB.js: _putProject: db null return ", this.db );  
      return;
    }
    if ( !projInfo.proj_id || projInfo.proj_id == "" ) {
      console.error("indexedDB.js: _putProject: proj_id null return ", projInfo.proj_id );  
      return;
    }
    
    //// event control
    let transaction = this.db.transaction("loadedProject", "readwrite");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _putProject: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _putProject: transaction error, event= ", event );  
    };

    let projOS = transaction.objectStore("loadedProject");
    let putRequest =  projOS.put( projInfo ) ;
    putRequest.onsuccess = function(event){
      // console.log("indexedDB.js: _putProject: putRequest success, event= ", event );    
      // event.target.result will be the KeyPath ;
      if (callback){
        callback(event);
      }
    };
    putRequest.onerror = function(event){
      console.error("indexedDB.js: _putProject: putRequest error, event= ", event );    
    };
    
    return await putRequest;
  }

  async getProject( proj_id , callback ){
    if ( !this.db ) {
      console.error("indexedDB.js: _getProject: db null return ", this.db );  
      return;
    }
    if ( !proj_id || proj_id == "" ) {
      console.error("indexedDB.js: _getProject: proj_id null return ", proj_id );  
      return;
    }
    
    //// event control
    let transaction = this.db.transaction("loadedProject", "readonly");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _getProject: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _getProject: transaction error, event= ", event );  
    };

    let projOS = transaction.objectStore("loadedProject");
    let getRequest =  projOS.get( proj_id ) ;
    getRequest.onsuccess = function(event){
      // console.log("indexedDB.js: _getProject: getRequest success, event= ", event, event.target.readyState, event.target.result, proj_id );    
      // event.target.result will be the object ;
      if (callback){
        callback(event);
      }
    };
    getRequest.onerror = function(event){
      console.error("indexedDB.js: _getProject: getRequest error, event= ", event );    
    };
    
    return await getRequest;
  }

  //// 請不要隨意呼叫這個function, 會直接清空表單
  async clearProjOS ( pwd, callback ){
    if ( !this.db ) {
      console.error("indexedDB.js: _clearProjOS: db null return ", this.db );  
      return;
    }
    if (!pwd || pwd != "deep123" ){
      console.error("indexedDB.js: _clearProjOS: pwd wrong, denied ", pwd );  
      return;
    }
    //// event control
    let transaction = this.db.transaction("loadedProject", "readwrite");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _clearProjOS: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _clearProjOS: transaction error, event= ", event );  
    };

    let projOS = transaction.objectStore("loadedProject");
    let projOSClearRequest = projOS.clear();

    projOSClearRequest.onsuccess = function(event){
      console.log("indexedDB.js: _clearProjOS: projOSClearRequest success, event= ", event );    
      // event.target.result will be the object ;
      if (callback){
        callback();
      }
    };
    projOSClearRequest.onerror = function(event){
      console.error("indexedDB.js: _clearProjOS: projOSClearRequest error, event= ", event );    
    };
    
    return await projOSClearRequest;
  }


  async getAllProjectByCursor( callback ){
    if ( !this.db ) {
      console.error("indexedDB.js: _getAllProjectByCursor: db null return ", this.db );  
      return;
    }    
    //// event control
    let transaction = this.db.transaction("loadedProject", "readonly");
    transaction.oncomplete = function(event) {
      // console.log("indexedDB.js: _getAllProjectByCursor: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _getAllProjectByCursor: transaction error, event= ", event );  
    };

    let getProjs = [];

    let projOS = transaction.objectStore("loadedProject");
    let cursorRequest = projOS.openCursor() ;
    cursorRequest.onsuccess = function(event){
      // console.log("indexedDB.js: _getAllProjectByCursor: cursorRequest success, event= ", event );    
      // event.target.result will be the object ;
      let cursor = event.target.result;
      if (cursor) {
        // console.log("proj_id=" + cursor.key + ",  " + Object.keys(cursor.value) , Object.values(cursor.value) ,"\n" , cursor.value  );
        let tempObj = {}
        Object.keys(cursor.value).forEach((item, index, array) =>{
          tempObj[item] = Object.values(cursor.value)[index];
          // console.log( "______", item , "::", index , "::" ,  Object.values(cursor.value)[index]  );
        });
        getProjs.push(tempObj);
        cursor.continue();
      }else{
        console.log("indexedDB.js: _getAllProjectByCursor: cursor end  ", getProjs );
        if (callback){
          callback(getProjs);
        }
      }
    };
    cursorRequest.onerror = function(event){
      console.error("indexedDB.js: _getAllProjectByCursor: cursorRequest error, event= ", event );    
    };
    
    return await cursorRequest;
  }

  async getAllProjectByKeyCursor( searchKey , callback ){
    if ( !this.db ) {
      console.error("indexedDB.js: _getAllProjectByKeyCursor: db null return ", this.db );  
      return;
    }
    if (!searchKey || searchKey == ""){
      searchKey = "proj_name";
    }
    //// event control
    let transaction = this.db.transaction("loadedProject", "readonly");
    transaction.oncomplete = function(event) {
      console.log("indexedDB.js: _getAllProjectByKeyCursor: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _getAllProjectByKeyCursor: transaction error, event= ", event );  
    };

    let projOS = transaction.objectStore("loadedProject");
    let projOSIndex = projOS.index( searchKey );

    let getKeys = [];

    let cursorRequest = projOSIndex.openKeyCursor();
    cursorRequest.onsuccess = function(event) {
      var cursor = event.target.result;
      if (cursor) {
        // cursor.key is a name, like "Bill", and cursor.value is the SSN.
        // No way to directly get the rest of the stored object.
        console.log("11 indexedDB.js: key: " + cursor.key + ", value: " + cursor.value);
        getKeys.push(cursor.key);
        cursor.continue();
      }else{
        console.log("indexedDB.js: _getAllProjectByKeyCursor: cursor end  ", event , getKeys );
        if (callback){
          callback(getKeys);
        }
      }
    }
    
    return await cursorRequest;
  }

  async getAllProjectByKeyCursorWithRange ( searchKey ){
    if ( !this.db ) {
      console.error("indexedDB.js: _getAllProjectByKeyCursor: db null return ", this.db );  
      return;
    }
    if (!searchKey || searchKey == ""){
      searchKey = "proj_name";
    }
    //// event control
    let transaction = this.db.transaction("loadedProject", "readonly");
    transaction.oncomplete = function(event) {
      console.log("indexedDB.js: _getAllProjectByKeyCursor: transaction complete, event= ", event );    
    };
    transaction.onerror = function(event) {
      console.error("indexedDB.js: _getAllProjectByKeyCursor: transaction error, event= ", event );  
    };

    var boundKeyRange = IDBKeyRange.bound( 1 , 5 , false, true);


    let projOS = transaction.objectStore("loadedProject");
    let projOSIndex = projOS.index( searchKey );
    let cursorRequest = projOSIndex.openKeyCursor(  boundKeyRange  );
    cursorRequest.onsuccess = function(event) {
      var cursor = event.target.result;
      if (cursor) {
        // cursor.key is a name, like "Bill", and cursor.value is the SSN.
        // No way to directly get the rest of the stored object.
        console.log("11 indexedDB.js: key: " + cursor.key + ", value: " + cursor.value);
        cursor.continue();
      }
    }
    
    return await cursorRequest;
  }

}

//// 基本上只有在「重新整理」後才會觸發
if ( typeof( window.mdb ) != 'object'   ){
  console.log('_mIndexedDB: create' );
  window.mdb = new mIndexedDB();
}




/***/ }),

/***/ "?30e5":
/*!********************!*\
  !*** fs (ignored) ***!
  \********************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?c470":
/*!**********************!*\
  !*** path (ignored) ***!
  \**********************/
/***/ (() => {

/* (ignored) */

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	__webpack_require__("./js/VrSdk/makarSDK.js");
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	__webpack_require__("./lib/vconsole.min.js");
/******/ 	__webpack_require__("./lib/testWebpack/aframe-v1.0.4.min.js");
/******/ 	__webpack_require__("./js/VrSdk/whiteList.min.js");
/******/ 	__webpack_require__("./js/checkBrowser.js");
/******/ 	__webpack_require__("./js/networkAgentVR.js");
/******/ 	__webpack_require__("../scripts/mIndexedDB.js");
/******/ 	__webpack_require__("./js/VrSdk/vrVersionControl.js");
/******/ 	__webpack_require__("./lib/testWebpack/logic.min.js");
/******/ 	__webpack_require__("./lib/orbitControls_customize.js");
/******/ 	__webpack_require__("./lib/chromaShader.js");
/******/ 	var __webpack_exports__ = __webpack_require__("./lib/testWebpack/UI.min.js");
/******/ 	
/******/ })()
;